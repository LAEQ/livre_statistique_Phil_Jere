<!DOCTYPE html>
<html lang="fr" xml:lang="fr">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Méthodes quantitatives en sciences sociales avec R</title>
  <meta name="description" content="Ce livre vise à décrire une panoplie de méthodes quantitatives utilisées en sciences sociales avec le logiciel ouvert R. Il a d’ailleurs été écrit intégralement dans R avec rmarkdown. Le contenu est pensé pour être accessible à tous et toutes, même à ceux et celles n’ayant presque aucune base en statistique ou en programmation. Les personnes plus expérimentées y découvriront des sections sur des méthodes plus avancées comme les modèles à effets mixtes, les modèles multiniveaux, les modèles généralisés additifs ainsi que les méthodes factorielles et de classification. Ceux et celles souhaitant migrer progressivement d’un autre logiciel statistique vers R trouveront dans cet ouvrage les éléments pour une transition en douceur. La philosophie de ce livre est de donner toutes les clefs de compréhension et de mise en œuvre des méthodes abordées dans R. La présentation des méthodes est basée sur une approche compréhensive et intuitive plutôt que mathématique, sans pour autant que la rigueur statistique ne soit négligée." />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="Méthodes quantitatives en sciences sociales avec R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="<a href="https://laeq.github.io/LivreStatistique_website/" class="uri">https://laeq.github.io/LivreStatistique_website/</a>" />
  <meta property="og:image" content="<a href="https://laeq.github.io/LivreStatistique_website/" class="uri">https://laeq.github.io/LivreStatistique_website/</a>images/cover.png" />
  <meta property="og:description" content="Ce livre vise à décrire une panoplie de méthodes quantitatives utilisées en sciences sociales avec le logiciel ouvert R. Il a d’ailleurs été écrit intégralement dans R avec rmarkdown. Le contenu est pensé pour être accessible à tous et toutes, même à ceux et celles n’ayant presque aucune base en statistique ou en programmation. Les personnes plus expérimentées y découvriront des sections sur des méthodes plus avancées comme les modèles à effets mixtes, les modèles multiniveaux, les modèles généralisés additifs ainsi que les méthodes factorielles et de classification. Ceux et celles souhaitant migrer progressivement d’un autre logiciel statistique vers R trouveront dans cet ouvrage les éléments pour une transition en douceur. La philosophie de ce livre est de donner toutes les clefs de compréhension et de mise en œuvre des méthodes abordées dans R. La présentation des méthodes est basée sur une approche compréhensive et intuitive plutôt que mathématique, sans pour autant que la rigueur statistique ne soit négligée." />
  <meta name="github-repo" content="LAEQ/livre_statistique_Phil_Jere" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Méthodes quantitatives en sciences sociales avec R" />
  
  <meta name="twitter:description" content="Ce livre vise à décrire une panoplie de méthodes quantitatives utilisées en sciences sociales avec le logiciel ouvert R. Il a d’ailleurs été écrit intégralement dans R avec rmarkdown. Le contenu est pensé pour être accessible à tous et toutes, même à ceux et celles n’ayant presque aucune base en statistique ou en programmation. Les personnes plus expérimentées y découvriront des sections sur des méthodes plus avancées comme les modèles à effets mixtes, les modèles multiniveaux, les modèles généralisés additifs ainsi que les méthodes factorielles et de classification. Ceux et celles souhaitant migrer progressivement d’un autre logiciel statistique vers R trouveront dans cet ouvrage les éléments pour une transition en douceur. La philosophie de ce livre est de donner toutes les clefs de compréhension et de mise en œuvre des méthodes abordées dans R. La présentation des méthodes est basée sur une approche compréhensive et intuitive plutôt que mathématique, sans pour autant que la rigueur statistique ne soit négligée." />
  <meta name="twitter:image" content="<a href="https://laeq.github.io/LivreStatistique_website/" class="uri">https://laeq.github.io/LivreStatistique_website/</a>images/cover.png" />

<meta name="author" content="Philippe Apparicio et Jérémy Gelb" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/d3-4.13.0/d3.min.js"></script>
<script src="libs/d3-tip-0.8.1/index.js"></script>
<link href="libs/chorddiag-0.1.2.9000/chorddiag.css" rel="stylesheet" />
<script src="libs/chorddiag-0.1.2.9000/chorddiag.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/quizlib.min.css" type="text/css" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Méthodes quantitatives en sciences sociales avec R</h1>
<p class="author"><em>Philippe Apparicio et Jérémy Gelb</em></p>
<p class="date"><em>25 mars 2022</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#préface">Préface</a><ul>
<li><a href="#sect001">Un manuel sous la forme d’une ressource éducative libre</a></li>
<li><a href="#sect002">Un manuel conçu comme un projet collaboratif</a></li>
<li><a href="#sect003">Comment lire ce livre?</a></li>
<li><a href="#sect003B">Comment utiliser les données du livre pour reproduire les exemples?</a></li>
<li><a href="#sect004">Structure du livre</a></li>
<li><a href="#sect005">Pourquoi faut-il programmer en sciences sociales?</a></li>
<li><a href="#sect006">Remerciements</a></li>
<li><a href="#sect007">Dédicace toute spéciale à Cargo et Ambrée</a></li>
</ul></li>
<li><a href="#auteurs">À propos des auteurs</a></li>
<li><a href="#part-découverte-de-r">(PART) Découverte de R</a></li>
<li><a href="#chap01"><span class="toc-section-number">1</span> Prise en main de R</a><ul>
<li><a href="#sect011"><span class="toc-section-number">1.1</span> Histoire et philosophie de R</a></li>
<li><a href="#sect012"><span class="toc-section-number">1.2</span> Environnement de travail</a><ul>
<li><a href="#sect0121"><span class="toc-section-number">1.2.1</span> Installation de R</a></li>
<li><a href="#sect0122"><span class="toc-section-number">1.2.2</span> Environnement RStudio</a></li>
<li><a href="#sect0123"><span class="toc-section-number">1.2.3</span> Installation et chargement un <em>package</em></a></li>
<li><a href="#aide-disponible"><span class="toc-section-number">1.2.4</span> Aide disponible</a></li>
</ul></li>
<li><a href="#sect013"><span class="toc-section-number">1.3</span> Bases du langage R</a><ul>
<li><a href="#sect0131"><span class="toc-section-number">1.3.1</span> <em>Hello World</em>!</a></li>
<li><a href="#sect0132"><span class="toc-section-number">1.3.2</span> Objets et expressions</a></li>
<li><a href="#sect0_133"><span class="toc-section-number">1.3.3</span> Fonctions et arguments</a></li>
<li><a href="#sect0134"><span class="toc-section-number">1.3.4</span> Principaux types de données</a></li>
<li><a href="#sect0135"><span class="toc-section-number">1.3.5</span> Opérateurs</a></li>
<li><a href="#sect0136"><span class="toc-section-number">1.3.6</span> Structures de données</a></li>
</ul></li>
<li><a href="#sect014"><span class="toc-section-number">1.4</span> Manipulation de données</a><ul>
<li><a href="#sect0141"><span class="toc-section-number">1.4.1</span> Chargement d’un <em>DataFrame</em> depuis un fichier</a></li>
<li><a href="#sect0142"><span class="toc-section-number">1.4.2</span> Manipulation d’un <em>DataFrame</em></a></li>
</ul></li>
<li><a href="#sect016"><span class="toc-section-number">1.5</span> Code R bien structuré</a></li>
<li><a href="#sect017"><span class="toc-section-number">1.6</span> Enregistrement des résultats</a></li>
<li><a href="#sect018"><span class="toc-section-number">1.7</span> Session de travail</a></li>
<li><a href="#sect019"><span class="toc-section-number">1.8</span> Conclusion et ressources pertinentes</a></li>
<li><a href="#sect019"><span class="toc-section-number">1.9</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#part-analyses-univariées-et-graphiques-dans-r">(PART) Analyses univariées et graphiques dans R</a></li>
<li><a href="#chap02"><span class="toc-section-number">2</span> Statistiques descriptives univariées</a><ul>
<li><a href="#sect021"><span class="toc-section-number">2.1</span> Notion et types de variable</a><ul>
<li><a href="#sect0211"><span class="toc-section-number">2.1.1</span> Notion de variable</a></li>
<li><a href="#sect0212"><span class="toc-section-number">2.1.2</span> Types de variables</a></li>
</ul></li>
<li><a href="#sect022"><span class="toc-section-number">2.2</span> Types de données</a><ul>
<li><a href="#sect0221"><span class="toc-section-number">2.2.1</span> Données secondaires <em>versus</em> données primaires</a></li>
<li><a href="#sect0222"><span class="toc-section-number">2.2.2</span> Données transversales <em>versus</em> données longitudinales</a></li>
<li><a href="#sect0223"><span class="toc-section-number">2.2.3</span> Données spatiales versus données aspatiales</a></li>
<li><a href="#sect0224"><span class="toc-section-number">2.2.4</span> Données individuelles <em>versus</em> données agrégées</a></li>
</ul></li>
<li><a href="#sect023"><span class="toc-section-number">2.3</span> Statistique descriptive et statistique inférentielle</a><ul>
<li><a href="#sect0231"><span class="toc-section-number">2.3.1</span> Population, échantillon et inférence</a></li>
<li><a href="#sect0232"><span class="toc-section-number">2.3.2</span> Deux grandes familles de méthodes statistiques</a></li>
</ul></li>
<li><a href="#sect024"><span class="toc-section-number">2.4</span> Notion de distribution</a><ul>
<li><a href="#définition-générale"><span class="toc-section-number">2.4.1</span> Définition générale</a></li>
<li><a href="#anatomie-dune-distribution"><span class="toc-section-number">2.4.2</span> Anatomie d’une distribution</a></li>
<li><a href="#principales-distributions"><span class="toc-section-number">2.4.3</span> Principales distributions</a></li>
<li><a href="#conclusion-sur-les-distributions"><span class="toc-section-number">2.4.4</span> Conclusion sur les distributions</a></li>
</ul></li>
<li><a href="#sect025"><span class="toc-section-number">2.5</span> Statistiques descriptives sur des variables quantitatives</a><ul>
<li><a href="#sect0251"><span class="toc-section-number">2.5.1</span> Paramètres de tendance centrale</a></li>
<li><a href="#sect0252"><span class="toc-section-number">2.5.2</span> Paramètres de position</a></li>
<li><a href="#sect0253"><span class="toc-section-number">2.5.3</span> Paramètres de dispersion</a></li>
<li><a href="#sect0254"><span class="toc-section-number">2.5.4</span> Paramètres de forme</a></li>
<li><a href="#sect0255"><span class="toc-section-number">2.5.5</span> Transformation des variables</a></li>
<li><a href="#sect0256"><span class="toc-section-number">2.5.6</span> Mise en œuvre dans R</a></li>
</ul></li>
<li><a href="#sect026"><span class="toc-section-number">2.6</span> Statistiques descriptives sur des variables qualitatives et semi-qualitatives</a><ul>
<li><a href="#sect0261"><span class="toc-section-number">2.6.1</span> Fréquences</a></li>
<li><a href="#sect0262"><span class="toc-section-number">2.6.2</span> Mise en œuvre dans R</a></li>
</ul></li>
<li><a href="#sect027"><span class="toc-section-number">2.7</span> Statistiques descriptives pondérées : pour aller plus loin</a></li>
<li><a href="#sect028"><span class="toc-section-number">2.8</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#chap03"><span class="toc-section-number">3</span> La magie des graphiques</a><ul>
<li><a href="#sect031"><span class="toc-section-number">3.1</span> Philosophie du ggplot2</a><ul>
<li><a href="#sect0311"><span class="toc-section-number">3.1.1</span> Grammaire</a></li>
<li><a href="#sect0312"><span class="toc-section-number">3.1.2</span> Types de géométries</a></li>
<li><a href="#sect0313"><span class="toc-section-number">3.1.3</span> Habillage</a></li>
<li><a href="#utilisation-des-thèmes"><span class="toc-section-number">3.1.4</span> Utilisation des thèmes</a></li>
<li><a href="#sect0314"><span class="toc-section-number">3.1.5</span> Composer une figure avec plusieurs graphiques</a></li>
<li><a href="#sect0315"><span class="toc-section-number">3.1.6</span> Couleur</a></li>
</ul></li>
<li><a href="#sect032"><span class="toc-section-number">3.2</span> Principaux graphiques</a><ul>
<li><a href="#sect0321"><span class="toc-section-number">3.2.1</span> Histogramme</a></li>
<li><a href="#sect0322"><span class="toc-section-number">3.2.2</span> Graphique de densité</a></li>
<li><a href="#sect0323"><span class="toc-section-number">3.2.3</span> Nuage de points</a></li>
<li><a href="#sect0324"><span class="toc-section-number">3.2.4</span> Graphique en ligne</a></li>
<li><a href="#sect0325"><span class="toc-section-number">3.2.5</span> Boîtes à moustaches</a></li>
<li><a href="#sect0326"><span class="toc-section-number">3.2.6</span> Graphique en violon</a></li>
<li><a href="#sect0327"><span class="toc-section-number">3.2.7</span> Graphique en barre</a></li>
<li><a href="#sect0328"><span class="toc-section-number">3.2.8</span> Graphique circulaire</a></li>
</ul></li>
<li><a href="#sect033"><span class="toc-section-number">3.3</span> Graphiques spéciaux</a><ul>
<li><a href="#sect0331"><span class="toc-section-number">3.3.1</span> Graphique en radar</a></li>
<li><a href="#sect0332"><span class="toc-section-number">3.3.2</span> Diagramme d’accord</a></li>
<li><a href="#sect0333"><span class="toc-section-number">3.3.3</span> Nuage de mots</a></li>
<li><a href="#sect0334"><span class="toc-section-number">3.3.4</span> Carte proportionnelle</a></li>
</ul></li>
<li><a href="#sect034"><span class="toc-section-number">3.4</span> Cartes</a></li>
<li><a href="#sect035"><span class="toc-section-number">3.5</span> Exporter des graphiques</a></li>
<li><a href="#sect036"><span class="toc-section-number">3.6</span> Conclusion sur les graphiques</a></li>
</ul></li>
<li><a href="#part-analyses-bivariées">(PART) Analyses bivariées</a></li>
<li><a href="#chap04"><span class="toc-section-number">4</span> Relation linéaire entre deux variables quantitatives</a><ul>
<li><a href="#sect041"><span class="toc-section-number">4.1</span> Bref retour sur le postulat de la relation linéaire</a></li>
<li><a href="#sect042"><span class="toc-section-number">4.2</span> Covariance</a><ul>
<li><a href="#sect0421"><span class="toc-section-number">4.2.1</span> Formulation</a></li>
<li><a href="#sect0422"><span class="toc-section-number">4.2.2</span> Interprétation</a></li>
</ul></li>
<li><a href="#sect043"><span class="toc-section-number">4.3</span> Corrélation</a><ul>
<li><a href="#sect0431"><span class="toc-section-number">4.3.1</span> Formulation</a></li>
<li><a href="#sect0432"><span class="toc-section-number">4.3.2</span> Interprétation</a></li>
<li><a href="#sect0433"><span class="toc-section-number">4.3.3</span> Corrélations pour des variables anormalement distribuées (coefficient de Spearman, tau de Kendall)</a></li>
<li><a href="#sect0434"><span class="toc-section-number">4.3.4</span> Corrélations robustes (<em>Biweight midcorrelation</em>, <em>Percentage bend correlation</em> et la corrélation <em>pi</em> de Shepherd)</a></li>
<li><a href="#sect0435"><span class="toc-section-number">4.3.5</span> Significativité des coefficients de corrélation</a></li>
<li><a href="#sect0436"><span class="toc-section-number">4.3.6</span> Corrélation partielle</a></li>
<li><a href="#sect0437"><span class="toc-section-number">4.3.7</span> Mise en œuvre dans R</a></li>
<li><a href="#sect0438"><span class="toc-section-number">4.3.8</span> Comment rapporter des valeurs de corrélations?</a></li>
</ul></li>
<li><a href="#sect044"><span class="toc-section-number">4.4</span> Régression linéaire simple</a><ul>
<li><a href="#sect0441"><span class="toc-section-number">4.4.1</span> Principe de base de la régression linéaire simple</a></li>
<li><a href="#sect0442"><span class="toc-section-number">4.4.2</span> Formulation de la droite de régression des moindres carrés ordinaires</a></li>
<li><a href="#sect0443"><span class="toc-section-number">4.4.3</span> Mesure de la qualité d’ajustement du modèle</a></li>
<li><a href="#sect0444"><span class="toc-section-number">4.4.4</span> Mise en œuvre dans R</a></li>
<li><a href="#sect0445"><span class="toc-section-number">4.4.5</span> Comment rapporter une régression linéaire simple</a></li>
</ul></li>
<li><a href="#sect045"><span class="toc-section-number">4.5</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#chap05"><span class="toc-section-number">5</span> Relation entre deux variables qualitatives</a><ul>
<li><a href="#sect051"><span class="toc-section-number">5.1</span> Construction de tableau de contingence</a></li>
<li><a href="#sect052"><span class="toc-section-number">5.2</span> Test du khi-deux</a></li>
<li><a href="#sect053"><span class="toc-section-number">5.3</span> Mise en œuvre dans R</a></li>
<li><a href="#sect054"><span class="toc-section-number">5.4</span> Interprétation d’un tableau de contingence</a></li>
<li><a href="#sect055"><span class="toc-section-number">5.5</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#chap06"><span class="toc-section-number">6</span> Relation entre une variable qualitative et une variable quantitative</a><ul>
<li><a href="#sect061"><span class="toc-section-number">6.1</span> Relation entre une variable quantitative et une variable qualitative à deux modalités</a><ul>
<li><a href="#sect0611"><span class="toc-section-number">6.1.1</span> Test <em>t</em> et ses différentes variantes</a></li>
<li><a href="#sect0612"><span class="toc-section-number">6.1.2</span> Test non paramétrique de Wilcoxon</a></li>
</ul></li>
<li><a href="#sect062"><span class="toc-section-number">6.2</span> Relation entre une variable quantitative et une variable qualitative à plus de deux modalités</a><ul>
<li><a href="#sect0621"><span class="toc-section-number">6.2.1</span> Analyse de variance</a></li>
<li><a href="#sect0622"><span class="toc-section-number">6.2.2</span> Test non paramétrique de Kruskal-Wallis</a></li>
<li><a href="#sect0623"><span class="toc-section-number">6.2.3</span> Mise en œuvre dans R</a></li>
<li><a href="#sect0624"><span class="toc-section-number">6.2.4</span> Comment rapporter les résultats d’une ANOVA et du test de Kruskal-Wallis</a></li>
</ul></li>
<li><a href="#sect063"><span class="toc-section-number">6.3</span> Conclusion sur la troisième partie</a></li>
<li><a href="#sect064"><span class="toc-section-number">6.4</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#part-modèles-de-régression">(PART) Modèles de régression</a></li>
<li><a href="#chap07"><span class="toc-section-number">7</span> Régression linéaire multiple</a><ul>
<li><a href="#sect071"><span class="toc-section-number">7.1</span> Objectifs de la régression linéaire multiple et construction d’un modèle de régression</a></li>
<li><a href="#sect072"><span class="toc-section-number">7.2</span> Principes de base de la régression linéaire multiple</a><ul>
<li><a href="#sect0721"><span class="toc-section-number">7.2.1</span> Un peu d’équations…</a></li>
<li><a href="#sect0722"><span class="toc-section-number">7.2.2</span> Hypothèses de la régression linéaire multiple</a></li>
</ul></li>
<li><a href="#sect073"><span class="toc-section-number">7.3</span> Évaluation de la qualité d’ajustement du modèle</a><ul>
<li><a href="#sect0731"><span class="toc-section-number">7.3.1</span> Mesures de la qualité d’un modèle</a></li>
<li><a href="#sect0732"><span class="toc-section-number">7.3.2</span> Comparaison des modèles incrémentiels</a></li>
</ul></li>
<li><a href="#sect074"><span class="toc-section-number">7.4</span> Différentes mesures pour les coefficients de régression</a><ul>
<li><a href="#sect0741"><span class="toc-section-number">7.4.1</span> Coefficients de régression : évaluer l’effet des variables indépendantes</a></li>
<li><a href="#sect0742"><span class="toc-section-number">7.4.2</span> Coefficients de régression standardisés : repérer les variables les plus importantes du modèle</a></li>
<li><a href="#sect0743"><span class="toc-section-number">7.4.3</span> Significativité des coefficients de régression : valeurs de <em>t</em> et de <em>p</em></a></li>
<li><a href="#sect0744"><span class="toc-section-number">7.4.4</span> Intervalle de confiance des coefficients</a></li>
</ul></li>
<li><a href="#sect075"><span class="toc-section-number">7.5</span> Introduction de variables explicatives particulières</a><ul>
<li><a href="#sect0751"><span class="toc-section-number">7.5.1</span> Exploration des relations non linéaires</a></li>
<li><a href="#sect0752"><span class="toc-section-number">7.5.2</span> Variable indépendante qualitative dichotomique</a></li>
<li><a href="#sect0753"><span class="toc-section-number">7.5.3</span> Variable indépendante qualitative polytomique</a></li>
<li><a href="#sect0754"><span class="toc-section-number">7.5.4</span> Variables d’interaction</a></li>
</ul></li>
<li><a href="#sect076"><span class="toc-section-number">7.6</span> Diagnostics de la régression</a><ul>
<li><a href="#sect0761"><span class="toc-section-number">7.6.1</span> Nombre d’observations</a></li>
<li><a href="#sect0762"><span class="toc-section-number">7.6.2</span> Normalité des résidus</a></li>
<li><a href="#sect0763"><span class="toc-section-number">7.6.3</span> Linéarité et homoscédasticité des résidus</a></li>
<li><a href="#sect0764"><span class="toc-section-number">7.6.4</span> Absence de multicolinéarité excessive</a></li>
<li><a href="#sect0766"><span class="toc-section-number">7.6.5</span> Absence d’observations aberrantes</a></li>
</ul></li>
<li><a href="#sect077"><span class="toc-section-number">7.7</span> Mise en œuvre dans R</a><ul>
<li><a href="#sect0771"><span class="toc-section-number">7.7.1</span> Fonctions <code>lm</code>, <code>summary()</code> et <code>confint()</code></a></li>
<li><a href="#sect0772"><span class="toc-section-number">7.7.2</span> Comparaison des modèles</a></li>
<li><a href="#sect0773"><span class="toc-section-number">7.7.3</span> Diagnostic sur un modèle</a></li>
<li><a href="#sect0774"><span class="toc-section-number">7.7.4</span> Graphiques pour les effets marginaux</a></li>
</ul></li>
<li><a href="#sect078"><span class="toc-section-number">7.8</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#chap08"><span class="toc-section-number">8</span> Régressions linéaires généralisées (GLM)</a><ul>
<li><a href="#sect081"><span class="toc-section-number">8.1</span> Qu’est qu’un modèle GLM?</a><ul>
<li><a href="#sect0811"><span class="toc-section-number">8.1.1</span> Formulation d’un GLM</a></li>
<li><a href="#sect0812"><span class="toc-section-number">8.1.2</span> Autres distributions et rôle de la fonction de lien</a></li>
<li><a href="#sect0813"><span class="toc-section-number">8.1.3</span> Conditions d’application</a></li>
<li><a href="#sect0814"><span class="toc-section-number">8.1.4</span> Résidus et déviance</a></li>
<li><a href="#sect0815"><span class="toc-section-number">8.1.5</span> Vérifier l’ajustement</a></li>
<li><a href="#sect0816"><span class="toc-section-number">8.1.6</span> Comparaison de deux modèles GLM</a></li>
</ul></li>
<li><a href="#sect082"><span class="toc-section-number">8.2</span> Modèles GLM pour des variables qualitatives</a><ul>
<li><a href="#sect0821"><span class="toc-section-number">8.2.1</span> Modèle logistique binomial</a></li>
<li><a href="#sect0822"><span class="toc-section-number">8.2.2</span> Modèle probit binomial</a></li>
<li><a href="#sect0823"><span class="toc-section-number">8.2.3</span> Modèle logistique des cotes proportionnelles</a></li>
<li><a href="#sect0824"><span class="toc-section-number">8.2.4</span> Modèle logistique multinomial</a></li>
<li><a href="#conclusion-sur-les-modèles-pour-des-variables-qualitatives"><span class="toc-section-number">8.2.5</span> Conclusion sur les modèles pour des variables qualitatives</a></li>
</ul></li>
<li><a href="#sect084"><span class="toc-section-number">8.3</span> Modèles GLM pour des variables de comptage</a><ul>
<li><a href="#sect0841"><span class="toc-section-number">8.3.1</span> Modèle de Poisson</a></li>
<li><a href="#sect0842"><span class="toc-section-number">8.3.2</span> Modèle binomial négatif</a></li>
<li><a href="#sect0843"><span class="toc-section-number">8.3.3</span> Modèle de Poisson avec excès fixe de zéros</a></li>
<li><a href="#sect0844"><span class="toc-section-number">8.3.4</span> Modèle de Poisson avec excès ajusté de zéros</a></li>
<li><a href="#sect0845"><span class="toc-section-number">8.3.5</span> Conclusion sur les modèles destinés à des variables de comptage</a></li>
</ul></li>
<li><a href="#sect085"><span class="toc-section-number">8.4</span> Modèles GLM pour des variables continues</a><ul>
<li><a href="#sect0851"><span class="toc-section-number">8.4.1</span> Modèle GLM gaussien</a></li>
<li><a href="#sect0852"><span class="toc-section-number">8.4.2</span> Modèle GLM avec une distribution de Student</a></li>
<li><a href="#sect0853"><span class="toc-section-number">8.4.3</span> Modèle GLM avec distribution Gamma</a></li>
<li><a href="#sect0854"><span class="toc-section-number">8.4.4</span> Modèle GLM avec une distribution bêta</a></li>
</ul></li>
<li><a href="#sect086"><span class="toc-section-number">8.5</span> Conclusion sur les modèles linéaires généralisés</a></li>
<li><a href="#sect087"><span class="toc-section-number">8.6</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#chap09"><span class="toc-section-number">9</span> Régressions à effets mixtes (GLMM)</a><ul>
<li><a href="#sect091"><span class="toc-section-number">9.1</span> Introduction</a><ul>
<li><a href="#sect0911"><span class="toc-section-number">9.1.1</span> Indépendance des observations et effets de groupes</a></li>
<li><a href="#sect0912"><span class="toc-section-number">9.1.2</span> Terminologie: effets fixes et effets aléatoires</a></li>
</ul></li>
<li><a href="#sect092"><span class="toc-section-number">9.2</span> Principes de base des GLMM</a><ul>
<li><a href="#sect0921"><span class="toc-section-number">9.2.1</span> GLMM avec constantes aléatoires</a></li>
<li><a href="#sect0923"><span class="toc-section-number">9.2.2</span> GLMM avec pentes aléatoires</a></li>
<li><a href="#sect0924"><span class="toc-section-number">9.2.3</span> GLMM avec constantes et pentes aléatoires</a></li>
</ul></li>
<li><a href="#sect093"><span class="toc-section-number">9.3</span> Conditions d’application des GLMM</a><ul>
<li><a href="#sect0931"><span class="toc-section-number">9.3.1</span> Vérification de la distribution des effets aléatoires</a></li>
<li><a href="#sect0932"><span class="toc-section-number">9.3.2</span> Homogénéité des variances au sein des groupes</a></li>
</ul></li>
<li><a href="#sect094"><span class="toc-section-number">9.4</span> Inférence dans les modèles GLMM</a><ul>
<li><a href="#sect0941"><span class="toc-section-number">9.4.1</span> Inférence pour les effets fixes</a></li>
<li><a href="#sect0942"><span class="toc-section-number">9.4.2</span> Inférence pour les effets aléatoires, impact global</a></li>
<li><a href="#sect0943"><span class="toc-section-number">9.4.3</span> Inférence pour les effets aléatoires, constantes et pentes</a></li>
</ul></li>
<li><a href="#sect095"><span class="toc-section-number">9.5</span> Conclusion sur les GLMM</a></li>
<li><a href="#sect096"><span class="toc-section-number">9.6</span> Mise en œuvre des GLMM dans R</a><ul>
<li><a href="#sect0961"><span class="toc-section-number">9.6.1</span> Ajustement du modèle avec uniquement une constante aléatoire</a></li>
<li><a href="#sect0962"><span class="toc-section-number">9.6.2</span> Ajustement du modèle avec constantes et pentes aléatoires</a></li>
</ul></li>
<li><a href="#sect097"><span class="toc-section-number">9.7</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#chap10"><span class="toc-section-number">10</span> Régressions multiniveaux</a><ul>
<li><a href="#sect101"><span class="toc-section-number">10.1</span> Modèles multiniveaux : deux intérêts majeurs</a><ul>
<li><a href="#sect1011"><span class="toc-section-number">10.1.1</span> Répartition de la variance entre les différents niveaux</a></li>
<li><a href="#sect1012"><span class="toc-section-number">10.1.2</span> Estimation des coefficients aux différents niveaux</a></li>
</ul></li>
<li><a href="#sect102"><span class="toc-section-number">10.2</span> Différents types de modèles multiniveaux</a><ul>
<li><a href="#sect1021"><span class="toc-section-number">10.2.1</span> Description du jeu de données utilisé</a></li>
<li><a href="#sect1022"><span class="toc-section-number">10.2.2</span> Démarche classique pour les modèles multiniveaux</a></li>
</ul></li>
<li><a href="#sect103"><span class="toc-section-number">10.3</span> Conditions d’application des régressions multiniveaux</a></li>
<li><a href="#sect104"><span class="toc-section-number">10.4</span> Mise en œuvre dans R</a><ul>
<li><a href="#sect1041"><span class="toc-section-number">10.4.1</span> Le modèle vide</a></li>
<li><a href="#sect1042"><span class="toc-section-number">10.4.2</span> Modèle avec les variables indépendantes du niveau 1</a></li>
<li><a href="#sect1043"><span class="toc-section-number">10.4.3</span> Modèle avec les variables indépendantes aux niveaux 1 et 2</a></li>
<li><a href="#sect10414"><span class="toc-section-number">10.4.4</span> Modèle complet avec une interaction</a></li>
<li><a href="#sect1045"><span class="toc-section-number">10.4.5</span> Comparaison des quatre modèles</a></li>
</ul></li>
<li><a href="#sect105"><span class="toc-section-number">10.5</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#chap11"><span class="toc-section-number">11</span> Modèles généralisés additifs</a><ul>
<li><a href="#sect111"><span class="toc-section-number">11.1</span> Introduction</a><ul>
<li><a href="#sect1111"><span class="toc-section-number">11.1.1</span> Non linéarité fonctionnelle</a></li>
<li><a href="#sect1112"><span class="toc-section-number">11.1.2</span> Non linéarité avec des polynomiales</a></li>
<li><a href="#sect1113"><span class="toc-section-number">11.1.3</span> Non linéarité par segments</a></li>
<li><a href="#sect1114"><span class="toc-section-number">11.1.4</span> Non linéarité avec des <em>splines</em></a></li>
</ul></li>
<li><a href="#sect112"><span class="toc-section-number">11.2</span> <em>Spline</em> de régression et <em>spline</em> de lissage</a></li>
<li><a href="#sect113"><span class="toc-section-number">11.3</span> Interprétation d’une <em>spline</em></a></li>
<li><a href="#sect114"><span class="toc-section-number">11.4</span> Multicolinéarité non linéaire</a></li>
<li><a href="#sect115"><span class="toc-section-number">11.5</span> Aller plus loin avec les <em>splines</em></a><ul>
<li><a href="#sect1151"><span class="toc-section-number">11.5.1</span> <em>Splines</em> cycliques</a></li>
<li><a href="#sect1152"><span class="toc-section-number">11.5.2</span> Splines par groupe</a></li>
<li><a href="#sect1153"><span class="toc-section-number">11.5.3</span> <em>Splines</em> multivariées et <em>splines</em> d’interaction</a></li>
</ul></li>
<li><a href="#sect116"><span class="toc-section-number">11.6</span> Mise en oeuvre dans R</a></li>
<li><a href="#sect117"><span class="toc-section-number">11.7</span> GAMM</a></li>
<li><a href="#sect118"><span class="toc-section-number">11.8</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#chap13"><span class="toc-section-number">12</span> Méthodes de classification non supervisée</a><ul>
<li><a href="#sect131"><span class="toc-section-number">12.1</span> Méthodes de classification : un aperçu</a></li>
<li><a href="#sect132"><span class="toc-section-number">12.2</span> Notions essentielles en classification</a><ul>
<li><a href="#sect1321"><span class="toc-section-number">12.2.1</span> Distance</a></li>
<li><a href="#sect1322"><span class="toc-section-number">12.2.2</span> Inertie</a></li>
</ul></li>
<li><a href="#sect133"><span class="toc-section-number">12.3</span> Classification ascendante hiérarchique</a><ul>
<li><a href="#sect1331"><span class="toc-section-number">12.3.1</span> Fonctionnement de l’algorithme</a></li>
<li><a href="#sect1332"><span class="toc-section-number">12.3.2</span> Choisir le bon nombre de groupes</a></li>
<li><a href="#sect1333"><span class="toc-section-number">12.3.3</span> Limites de la classification ascendante hiérarchique</a></li>
<li><a href="#sect1334"><span class="toc-section-number">12.3.4</span> Mise en oeuvre dans R</a></li>
</ul></li>
<li><a href="#sect134"><span class="toc-section-number">12.4</span> Nuées dynamiques</a><ul>
<li><a href="#sect1341"><span class="toc-section-number">12.4.1</span> <em>K-means</em></a></li>
<li><a href="#sect1342"><span class="toc-section-number">12.4.2</span> K-médianes</a></li>
<li><a href="#sect1343"><span class="toc-section-number">12.4.3</span> K-médioïde</a></li>
<li><a href="#sect1344"><span class="toc-section-number">12.4.4</span> Mise en oeuvre dans R</a></li>
<li><a href="#sect1346"><span class="toc-section-number">12.4.5</span> Extensions en logique floue : <em>c-means</em>, <em>c-medoids</em></a></li>
</ul></li>
<li><a href="#sect135"><span class="toc-section-number">12.5</span> Conclusion sur la cinquième partie</a></li>
<li><a href="#sect136"><span class="toc-section-number">12.6</span> Quiz de révision du chapitre</a></li>
</ul></li>
<li><a href="#conclusion"><span class="toc-section-number">13</span> Conclusion</a><ul>
<li><a href="#sect141"><span class="toc-section-number">13.1</span> Synthèse des méthodes abordées</a></li>
<li><a href="#sect142"><span class="toc-section-number">13.2</span> Autres méthodes non abordées</a><ul>
<li><a href="#sect1421"><span class="toc-section-number">13.2.1</span> Régressions par quantile</a></li>
<li><a href="#sect1422"><span class="toc-section-number">13.2.2</span> Régressions par panel</a></li>
<li><a href="#sect1423"><span class="toc-section-number">13.2.3</span> Régressions par Tobit</a></li>
<li><a href="#sect1424"><span class="toc-section-number">13.2.4</span> Analyses de survie</a></li>
<li><a href="#sect1425"><span class="toc-section-number">13.2.5</span> Équations structurelles</a></li>
</ul></li>
<li><a href="#sect143"><span class="toc-section-number">13.3</span> Deux écoles de statistique inférielle : fréquentiste et bayésienne</a></li>
<li><a href="#sect144"><span class="toc-section-number">13.4</span> Éthique en méthodes quantitatives</a></li>
</ul></li>
<li><a href="#annexes"><span class="toc-section-number">14</span> Annexes</a><ul>
<li><a href="#annexe1"><span class="toc-section-number">14.1</span> Table des valeurs critiques de khi-deux</a></li>
<li><a href="#annexe2"><span class="toc-section-number">14.2</span> Table des valeurs critiques de Fisher</a></li>
<li><a href="#annexe3"><span class="toc-section-number">14.3</span> Table des valeurs critiques de <em>t</em></a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Méthodes quantitatives en sciences sociales avec R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="préface" class="section level1 unnumbered">
<h1>Préface</h1>
<p>Ce livre vise à décrire une panoplie de méthodes quantitatives utilisées en sciences sociales avec le logiciel ouvert R. Il a d’ailleurs été écrit intégralement dans R avec <a href="https://rmarkdown.rstudio.com/">rmarkdown</a>. Le contenu est pensé pour être accessible à tous et toutes, même à ceux et celles n’ayant presque aucune base en statistique ou en programmation. Les personnes plus expérimentées y découvriront des sections sur des méthodes plus avancées comme les modèles à effets mixtes, les modèles multiniveaux, les modèles généralisés additifs ainsi que les méthodes factorielles et de classification. Ceux et celles souhaitant migrer progressivement d’un autre logiciel statistique vers R trouveront dans cet ouvrage les éléments pour une transition en douceur. La philosophie de ce livre est de donner toutes les clefs de compréhension et de mise en œuvre des méthodes abordées dans R. La présentation des méthodes est basée sur une approche compréhensive et intuitive plutôt que mathématique, sans pour autant que la rigueur statistique ne soit négligée. Servez-vous votre boisson chaude ou froide favorite et installez-vous dans votre meilleur fauteuil. Bonne lecture!</p>
<div id="sect001" class="section level2 unnumbered">
<h2>Un manuel sous la forme d’une ressource éducative libre</h2>
<p><strong>Pourquoi un manuel de statistique en sciences sociales sous licence libre?</strong> Les logiciels libres sont aujourd’hui très répandus. Comparativement aux logiciels propriétaires, l’accès au code source permet à quiconque de l’utiliser, de le modifier, de le dupliquer et de le partager. Le logiciel R, dans lequel sont mises en œuvre les méthodes quantitatives décrites dans ce livre, est d’ailleurs à la fois un langage de programmation et un logiciel libre (sous la licence publique générale <a href="https://fr.wikipedia.org/wiki/Licence_publique_g%C3%A9n%C3%A9rale_GNU">GNU GLPv2</a>). Par analogie aux logiciels libres, il existe aussi des <strong>ressources éducatives libres (REL)</strong> « dont la licence accorde les permissions désignées par les 5R (<strong>Retenir — Réutiliser — Réviser — Remixer — Redistribuer</strong>) et donc permet nécessairement la modification » (<a href="https://fabriquerel.org/rel/"><strong><em>fabriqueREL</em></strong></a>). La licence de ce livre, CC BY-SA (figure @ref(fig:Licence)), permet donc de :</p>
<ul>
<li><strong>Retenir</strong>, c’est-à-dire télécharger et d’imprimer gratuitement le livre. Notez qu’il aurait été plutôt surprenant d’écrire un livre payant sur un logiciel libre et donc gratuit. Aussi, nous aurions été très embarrassés que des personnes étudiantes avec des ressources financières limitées doivent payer pour avoir accès au livre, sans pour autant savoir préalablement si le contenu est réellement adapté à leurs besoins.</li>
<li><strong>Réutiliser</strong>, c’est-à-dire utiliser la totalité ou une section du livre sans limitation et sans compensation financière. Cela permet ainsi à d’autres personnes enseignantes de l’utiliser dans le cadre d’activités pédagogiques.</li>
<li><strong>Réviser</strong>, c’est-à-dire modifier, adapter et traduire le contenu en fonction d’un besoin pédagogique précis puisqu’aucun manuel n’est parfait, tant s’en faut! Rappelons que le livre a d’ailleurs été écrit intégralement dans R avec <a href="https://rmarkdown.rstudio.com/">rmarkdown</a>. Quiconque peut ainsi télécharger gratuitement le code source du livre sur <a href="https://LAEQ.github.io/livre_statistique_Phil_Jere/">github</a> et le modifier à sa guise (voir l’encadré intitulé <em>Suggestions d’adaptation du manuel</em>).</li>
<li><strong>Remixer</strong>, c’est-à-dire « de combiner la ressource avec d’autres ressources dont la licence le permet aussi pour créer une nouvelle ressource intégrée » (<a href="https://fabriquerel.org/rel/"><strong><em>fabriqueREL</em></strong></a>).</li>
<li><strong>Redistribuer</strong>, c’est-à-dire distribuer en totalité ou partiellement le manuel ou une version révisée sur d’autres canaux que le site Web du livre (par exemple, sur le site Moodle de votre université ou en faire une version imprimée).</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/Licence.JPG" alt="Licence Creative Commons du livre" width="100%" />
<p class="caption">
(#fig:Licence)Licence Creative Commons du livre
</p>
</div>
<p>La licence de ce livre, CC BY-SA (figure @ref(fig:Licence)), oblige donc de :</p>
<ul>
<li>Attribuer la paternité de l’auteur dans vos versions dérivées, ainsi qu’une mention concernant les grandes modifications apportées, en utilisant la formulation suivante :
Apparicio, Philippe et Jérémy Gelb. 2022. <em>Méthodes quantitatives en sciences sociales avec R</em>. Institut national de la recherche scientifique. CC BY-SA (4.0).</li>
<li>Utiliser la même licence ou une licence similaire à toutes versions dérivées.</li>
</ul>
<div class="bloc_astuce">
<p><strong>Suggestions d’adaptation du manuel</strong></p>
<p>Notez que pour chaque méthode statistique abordée dans le livre sont disponibles une description détaillée et une mise en œuvre dans R. Par conséquent, plusieurs adaptations du manuel sont possibles :</p>
<ul>
<li>Conserver uniquement les chapitres sur les méthodes statistiques ciblées dans votre cours.</li>
<li>En faire une version imprimée et la distribuer aux personnes étudiantes.</li>
<li>Modifier la description d’une ou plusieurs méthodes en effectuant les mises à jour directement dans les chapitres.</li>
<li>Insérer ses propres jeux de données dans les sections intitulées <em>Mise en œuvre dans R</em>.</li>
<li>Modifier les tableaux et figures.</li>
<li>Ajouter une série d’exercices.</li>
<li>Rédiger un nouveau chapitre.</li>
<li>Modifier des syntaxes R. Plusieurs <em>packages</em> R peuvent être utilisés pour mettre en œuvre telle ou telle méthode statistique. Ces derniers évoluent aussi très vite et de nouveaux <em>packages</em> sont proposés fréquemment! Par conséquent, il peut être judicieux de modifier une syntaxe R du livre en fonction de ses habitudes de programmation dans R (utilisation d’autres <em>packages</em> que ceux utilisés dans le manuel par exemple) ou de bien mettre à jour une syntaxe à la suite de la parution d’un nouveau <em>package</em> plus performant ou intéressant.</li>
<li>Toute autre adaptation qui permet de répondre au mieux à un besoin pédagogique.</li>
</ul>
</div>
</div>
<div id="sect002" class="section level2 unnumbered">
<h2>Un manuel conçu comme un projet collaboratif</h2>
<p>Il existe actuellement de nombreux livres sous licence ouverte écrits avec <a href="https://rmarkdown.rstudio.com/">rmarkdown</a> avec le <em>package</em> <code>bookdown</code> <span class="citation">(Xie <a href="#ref-xie2016bookdown" role="doc-biblioref">2016</a>)</span>, répertoriés sur le site de <a href="https://bookdown.org/">https://bookdown.org/</a>. Sans surprise, R étant un logiciel libre dédié aux méthodes statistiques et à la science des données, plusieurs abordent les méthodes quantitatives, notamment :</p>
<ul>
<li><a href="https://bookdown.org/roback/bookdown-BeyondMLR/">Beyond Multiple Linear Regression: Applied Generalized Linear Models and Multilevel Models in R</a> <span class="citation">(Roback et Legler <a href="#ref-roback2021beyond" role="doc-biblioref">2021</a>)</span>, CC BY-NC-SA.</li>
<li><a href="https://www.econometrics-with-r.org/">Introduction to Econometrics with R</a> <span class="citation">(Hanck et al. <a href="#ref-hanck2019introduction" role="doc-biblioref">2019</a>)</span>, CC BY-NC-SA.</li>
<li><a href="https://moderndive.com/">Statistical Inference via Data Science: A ModernDive into R and the Tidyverse</a> <span class="citation">(Ismay et Kim <a href="#ref-ismay2019statistical" role="doc-biblioref">2019</a>)</span>, CC BY-NC-SA.</li>
<li><a href="https://r-graphics.org/">R Graphics Cookbook, 2nd edition</a> <span class="citation">(Chang <a href="#ref-Chang2018" role="doc-biblioref">2018</a>)</span>, CC BY.</li>
</ul>
<p>Par contre, la grande majorité de ces livres numériques rédigés avec <code>bookdown</code> sont en anglais. À notre connaissance, ce projet constitue le premier manuel numérique en français sur les méthodes quantitatives appliquées aux sciences sociales réalisé avec <code>bookdown</code>. La première version du livre étant lancée, il est grand temps de planifier les suivantes! Pour ce faire, nous considérons ce livre comme un <strong>projet collaboratif visant à mobiliser la communauté universitaire francophone qui enseigne les statistiques en sciences sociales avec R</strong>. Plusieurs raisons motivent cette vision collaborative :</p>
<ul>
<li><strong>Rien n’est parfait!</strong> Cette première version comprend sûrement des coquilles et certaines sections mériteraient d’être améliorées. Les commentaires et suggestions visant à améliorer son contenu sont les bienvenus.</li>
<li><strong>La table des matières doit être impérativement extensible!</strong> De nombreuses méthodes statistiques très utilisées en sciences sociales ne sont pas abordées dans ce livre et mériteraient d’être ajoutées dans une version ultérieure : certaines extensions des régressions linéaires (régressions Rigge et Lasso, Tobit, quantile, etc.), les modèles d’équations simultanées, les analyses de données longitudinales (entre autres, modèles de survie, régression par panel), les modèles d’équations structurelles et bien d’autres! Par conséquent, si vous êtes intéressé(e)s, à ajouter un nouveau chapitre ou une partie du livre, nous vous invitons vivement à communiquer avec nous ou à diffuser sous une licence similaire votre version dérivée. L’objectif étant de continuer à faire tourner la roue du libre et, idéalement, que les futures versions soient corédigées par une communauté d’auteurs et d’autrices spécialistes en méthodes quantitatives.</li>
</ul>
</div>
<div id="sect003" class="section level2 unnumbered">
<h2>Comment lire ce livre?</h2>
<p>Si vous googlez l’expression « comment lire un livre? », vous trouverez une multitude de conseils et astuces. Pour ce livre, nous vous conseillons de le lire de gauche à droite et page par page! Plus sérieusement, le livre comprend plusieurs types de blocs de texte qui, nous l’espèrons, en facilitent la lecture.</p>
<div class="bloc_package">
<p><strong>Bloc <em>packages</em></strong>. Habituellement localisé au début d’un chapitre, il comprend la liste des <em>packages</em> R utilisés pour un chapitre.</p>
</div>
<div class="bloc_objectif">
<p><strong>Bloc objectif</strong>. Il comprend une description des objectifs d’un chapitre ou d’une section.</p>
</div>
<div class="bloc_notes">
<p><strong>Bloc notes</strong>. Il comprend une information secondaire sur une notion, un élément, une idée abordée dans une section.</p>
</div>
<div class="bloc_aller_loin">
<p><strong>Bloc pour aller plus loin</strong>. Il comprend des références ou des extensions d’une méthode statistique abordée dans une section.</p>
</div>
<div class="bloc_astuce">
<p><strong>Bloc astuce</strong>. Il décrit un élément qui vous facilitera le vie : une propriété statistique, un <em>package</em>, une fonction, une syntaxe R.</p>
</div>
<div class="bloc_attention">
<p><strong>Bloc attention</strong>. Il comprend une notion ou un élément important à bien maîtriser.</p>
</div>
</div>
<div id="sect003B" class="section level2 unnumbered">
<h2>Comment utiliser les données du livre pour reproduire les exemples?</h2>
<p>Ce livre propose des exemples détaillés et appliqués dans R pour chacune des méthodes abordées. Ces exemples se basent sur des jeux de données structurés et mis à disposition avec le livre. Ils sont disponibles sur le <em>repo github</em> dans le sous-dossier <code>data</code>, à l’adresse <a href="https://github.com/LAEQ/livre_statistique_Phil_Jere/tree/master/data" class="uri">https://github.com/LAEQ/livre_statistique_Phil_Jere/tree/master/data</a>.</p>
<p>Pour télécharger l’intégralité des données, vous pouvez utiliser le lien suivant : <a href="https://downgit.github.io/#/home?url=https://github.com/LAEQ/livre_statistique_Phil_Jere/tree/master/data" class="uri">https://downgit.github.io/#/home?url=https://github.com/LAEQ/livre_statistique_Phil_Jere/tree/master/data</a>. Cela est rendu possible grâce à l’outil <a href="https://downgit.github.io/#/home">DownGit</a>.</p>
<p>Une autre option est de télécharger le <em>repo</em> complet du livre directement sur <em>github</em> (<a href="https://github.com/LAEQ/livre_statistique_Phil_Jere" class="uri">https://github.com/LAEQ/livre_statistique_Phil_Jere</a>) en cliquant sur le bouton <code>Code</code>, puis le bouton <code>Download ZIP</code> (figure @ref(fig:downloaffromgit)). Les données se trouvent alors dans le sous-dossier nommé <code>data</code>.</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/download_github.png" alt="Téléchargement de l'intégralité du livre" width="50%" />
<p class="caption">
(#fig:downloaffromgit)Téléchargement de l’intégralité du livre
</p>
</div>
</div>
<div id="sect004" class="section level2 unnumbered">
<h2>Structure du livre</h2>
<p>Le livre est organisé autour de cinq grandes parties.</p>
<p><strong>Partie 1. La découverte de R.</strong> Dans cette première partie, nous discutons brièvement de l’histoire et de la philosophie de R. Nous voyons ensuite comment installer R et RStudio. Les bases du langage R (particulièrement les principaux objets que sont le vecteur, la matrice, la liste et le <em>dataframe</em>) ainsi que la manipulation des données avec R sont aussi largement abordés dans le chapitre @ref(chap01).</p>
<p><strong>Partie 2. Analyses univariées et représentations graphiques</strong>. Cette seconde partie comprend deux chapitres. Dans le chapitre @ref(chap02), nous décrivons dans un premier temps les différents types de données (primaires <em>versus</em> secondaires, transversales <em>versus</em> longitudinales, spatiales <em>versus</em> aspatiales, individuelles <em>versus</em> agrégées), les différents types de variables quantitatives (discrètes et continues) et qualitatives (nominales et ordinales) et les principales distributions de variables utilisées en sciences sociales (uniforme, Bernoulli, binomiale, géométrique, binomiale négative, poisson, poisson avec excès de zéros, gaussienne, gaussienne asymétrique, log-normale, Student, Cauchy, Chi-carré, exponentielle, gamma, bêta, Weibull et Pareto). Dans un second temps, nous abordons les statistiques descriptives pour des variables quantitatives (paramètres de tendance centrale, paramètres de position, paramètres de dispersion, paramètres de forme), puis qualitatives (fréquences absolues, relatives et cumulées).</p>
<p>Dans le chapitre @ref(chap03), nous illustrons les incroyables capacités graphiques de R en mettant en œuvre les principaux graphiques (histogramme, graphique de densité, nuage de points, graphique en lignes, boîtes à moustache, graphique en violon, graphique en barre, graphique circulaire), quelques graphiques particuliers (graphique en radar, diagramme d’accord, nuage de mots, carte proportionnelle) et une initiation aux cartes choroplèthes.</p>
<p><strong>Partie 3. Analyses bivariées.</strong> Cette troisième partie comprend trois chapitres dans lesquelles sont présentées les principales méthodes exploratoires et confirmatoires bivariées permettant d’évaluer la relation entre deux variables. Plus spécifiquement, nous présentons puis mettons en œuvre dans R les méthodes permettant d’explorer les relations entre deux variables quantitatives (covariance, corrélation et régression linéaire simple) dans le chapitre @ref(chap04), deux variables qualitatives (tableau de contingence et test du khi-deux) dans le chapitre @ref(chap05) et une variable quantitative avec une variable qualitative avec deux modalités (tests de Student, de Welch et de Wilcoxon) ou avec plus de deux modalités (ANOVA et test de Kruskal-Wallis) dans le chapitre @ref(chap06).</p>
<p><strong>Partie 4. Modèles de régression</strong>. Dans cette quatrième partie, sont présentées les principales méthodes de statistique inférentielle utilisées en sciences sociales : la régression linéaire multiple (chapitre @ref(chap07)), les régressions linéaires généralisées (chapitre @ref(chap08)), les régressions à effets mixtes (chapitre @ref(chap09)), les régressions multiniveaux (chapitre @ref(chap10)), (chapitre @ref(chap11)) et les modèles généralisés additifs (chapitre @ref(chap11)).</p>
<p><strong>Partie 5. Analyses exploratoires multivariées</strong>. Dans cette cinquième partie, sont abordées les méthodes de statistique exploratoire et descriptive permettant de décrire des tableaux de données comprenant plusieurs variables. Nous décrivons d’abord les méthodes de réduction de données : les méthodes factorielles dans le chapitre @ref(chap12) (analyses de composantes principales, analyses factorielles de correspondances, analyses factorielles de correspondances multiples) et les méthodes de classification non supervisées dans le chapitre @ref(chap13) (classification ascendante hiérarchique, k-moyennes, k-médianes, k-médoïdes et leurs extensions en logique floue comme les c-moyennes et c-médianes).</p>
</div>
<div id="sect005" class="section level2 unnumbered">
<h2>Pourquoi faut-il programmer en sciences sociales?</h2>
<p>Vous contrasterez rapidement que R est un véritable langage de programmation. L’apprentissage de ce language de programmation est-il pour autant pertinent pour les étudiants et étudiantes en sciences sociales? Il est vrai que la programmation n’est pas une compétence qui vient d’emblée à l’esprit lorsque l’on s’intéresse à la recherche aux sciences sociales. Pourtant, elle est de plus en plus importante, et ce, pour plusieurs raisons :</p>
<ul>
<li>Une part toujours plus grande des phénomènes sociaux se produisent ou peuvent s’observer au travers d’environnements numériques. Être capable d’exploiter efficacement ces outils permet d’extraire des données riches sur des phénomènes complexes, tel qu’en témoignent des études récentes sur la propagation de la désinformation sur les réseaux sociaux <span class="citation">(Allcott et Gentzkow <a href="#ref-allcott2017social" role="doc-biblioref">2017</a>)</span>, la migration des personnes <span class="citation">(Spyratos et al. <a href="#ref-spyratos2019quantifying" role="doc-biblioref">2019</a>)</span>, la propagation et les risques de contamination de la COVID-19 <span class="citation">(Boulos et Geraghty <a href="#ref-boulos2020geographical" role="doc-biblioref">2020</a>)</span>. Le plus souvent, les interfaces (API par exemple) permettant d’accéder à ces données nécessitent des habiletés en programmation.</li>
<li>La quantité de données numériques ouvertes et accessibles en ligne croit chaque année sur des sujets très divers. La plupart des villes et des gouvernements ont maintenant leur portail de données ouvertes auxquelles s’ajoutent les données produites par des projets collaboratifs comme <a href="https://www.openstreetmap.org">OpenStreetMap</a> ou <a href="https://noise-planet.org/map_noisecapture/index.html">NoisePlanet</a>. Récupérer ces données et les structurer pour les utiliser à des fins de recherche nécessitent le plus souvent des compétences en programmation.</li>
<li>Les méthodes quantitatives connaissent également un développement très important. Les logiciels propriétaires peinent à suivre la cadence de ce développement, contrairement aux logiciels à code source ouvert (comme R) qui permettent d’avoir accès aux dernières méthodes. Il est souvent long et coûteux de développer une interface graphique pour un logiciel, ce qui explique que la plupart de ces programmes en sont dépourvus et nécessitent alors de savoir programmer pour les utiliser.</li>
<li>Savoir programmer donne une liberté considérable en recherche. Cette compétence permet notamment de ne plus être limité(e) aux fonctionnalités proposées par des logiciels spécifiques. Il devient possible d’innover tant en matière de structuration, d’exploration et d’analyse des données que de représentation des résultats en écrivant ses propres fonctions. Cette flexibilité contribue directement à la production d’une recherche de meilleure qualité et plus diversifiée.</li>
<li>Programmer permet également d’automatiser des tâches qui autrement seraient extrêmement répétitives comme : déplacer et renommer une centaine de fichiers; retirer les lignes inutiles dans un ensemble de fichiers et les compiler dans une seule base de données; vérifier parmi des milliers d’adresses lesquelles sont valides; récupérer chaque jour les messages postés sur un forum. Autant de tâches faciles à automatiser si l’on sait programmer.</li>
<li>Dans un logiciel avec une interface graphique, il est compliqué de conserver un historique des opérations effectuées. Programmer permet au contraire de garder une trace de l’ensemble des actions effectuées au cours d’un projet de recherche. En effet, le code utilisé reste disponible et permet de reproduire (ou d’adapter) la méthode et les résultats obtenus, ce qui est essentiel dans le monde de la recherche. À cela s’ajoute le fait que chaque ligne de code que vous écrivez vient s’ajouter à un capital de code que vous possédez, car elles pourront être réutilisées dans d’autres projets!</li>
</ul>
</div>
<div id="sect006" class="section level2 unnumbered">
<h2>Remerciements</h2>
<p>De nombreuses personnes ont contribué à l’élaboration de ce manuel. Ce projet a bénéficié du soutien pédagogique et financier de la <a href="https://fabriquerel.org/"><strong><em>fabriqueREL</em></strong></a> (ressources éducatives libres). Les différentes rencontres avec le comité de suivi nous ont permis de comprendre l’univers des ressources éducatives libres (REL) et notamment leurs <a href="https://fabriquerel.org/rel/">fameux 5R</a> (Retenir — Réutiliser — Réviser — Remixer — Redistribuer), de mieux définir le besoin pédagogique visé par ce manuel, d’identifier des outils et des ressources pédagogiques pertinents pour son élaboration. Ainsi, nous remercions chaleureusement les membres de suivi de la <em>fabriqueREL</em> pour leur support inconditionnel :</p>
<ul>
<li>Myriam Beaudet, bibliothécaire à l’Université de Sherbrooke.</li>
<li>Marianne Dubé, conseillère pédagogique à l’Université de Sherbrooke et coordonnatrice de la fabriqueREL.</li>
<li>Myrian Grondin, bibliothécaire à l’Institut national de la recherche scientifique (INRS).</li>
<li>Claude Potvin, conseiller en formation à l’Université Laval.</li>
<li>Serge Allary, vice-recteur adjoint aux études de l’Université de Sherbrooke.</li>
</ul>
<p>Nous tenons aussi à remercier sincèrement les étudiants et étudiantes du cours <strong>Méthodes quantitatives appliquées aux études urbaines (EUR8219)</strong> du programme de maîtrise en études urbaines de l’INRS. Leurs commentaires et suggestions nous ont permis d’améliorer grandement les versions préliminaires de ce manuel qui ont été utilisées dans le cadre de ce cours.</p>
<p>Nous remercions les membres du comité de révision pour leurs commentaires et suggestions très constructifs. Ce comité est composé de trois étudiantes et deux professeurs de l’<a href="https://inrs.ca/">INRS</a> :</p>
<ul>
<li>Victoria Gay-Gauvin, étudiante à la maîtrise en études urbaines.</li>
<li>Salomé Vallette, étudiante au doctorat en études urbaines.</li>
<li>Diana Pena Ruiz, étudiante au doctorat en études des populations.</li>
<li><a href="https://inrs.ca/la-recherche/professeurs/benoit-laplante/">Benoît Laplante</a>, professeur enseignant aux programmes de maîtrise et de doctorat en études des populations.</li>
<li><a href="https://inrs.ca/la-recherche/professeurs/xavier-leloup/">Xavier Leloup</a>, professeur enseignant au programme de doctorat en études urbaines.</li>
</ul>
<p>Finalement, nous remercions Denise Latreille, réviseure linguistique et chargée de cours à l’Université Sherbrooke, pour la révision du manuel.</p>
</div>
<div id="sect007" class="section level2 unnumbered">
<h2>Dédicace toute spéciale à Cargo et Ambrée</h2>
<p>Fait cocasse, l’écriture de ce livre a démarré lorsque Philippe Apparicio était famille d’accueil d’un chiot de la <a href="https://www.mira.ca/fr/">Fondation Mira</a>, un organisme à but non lucratif qui forme des chiens-guides et d’assistance pour accroître l’autonomie et l’inclusion sociale des personnes vivant avec un handicap visuel ou moteur, ainsi que des jeunes présentant un trouble du spectre de l’autisme (TSA). En fin de rédaction du livre, ce fût au tour de Jérémy Gelb d’être famille d’accueil d’un autre chiot Mira. Nous remercions chaleureusement la <a href="https://www.mira.ca/fr/">Fondation Mira</a> pour nous avoir donné l’occasion de vivre cette expérience incroyable. Ce livre est donc dédié au beau Cargo et à la belle Ambrée qui nous ont tant supportés dans l’écriture du livre. Il n’y a rien de plus relaxant que d’écrire un livre de statistique avec un chiot qui dort à ses pieds!</p>
<div class="figure" style="text-align: center">
<img src="images/CargoAmbre.png" alt="Cargo et Ambrée, chiots de la Fondation Mira" width="70%" />
<p class="caption">
(#fig:CargoAmbre)Cargo et Ambrée, chiots de la Fondation Mira
</p>
</div>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="auteurs" class="section level1 unnumbered">
<h1>À propos des auteurs</h1>
<p><strong>Philippe Apparicio</strong> (<a href="http://www.inrs.ca/philippe-apparicio" class="uri">http://www.inrs.ca/philippe-apparicio</a>) est professeur titulaire au Centre Urbanisation Culture Société de l’Institut national de la recherche scientifique (INRS, <a href="http://www.inrs.ca/" class="uri">http://www.inrs.ca/</a>). Il enseigne au programme de maîtrise en études urbaines (<a href="https://inrs.ca/les-etudes/programmes-d-etudes/etudier-en-sciences-sociales/" class="uri">https://inrs.ca/les-etudes/programmes-d-etudes/etudier-en-sciences-sociales/</a>) les cours <em>Méthodes quantitatives appliquées aux études urbaines</em> et <em>Analyses spatiales appliquées aux études urbaines</em>. Il a aussi créé et enseigné, il y a plusieurs années, le cours <em>Systèmes d’information géographique appliqués aux études urbaines</em>. Durant les dernières années, il a offert plusieurs formations aux Écoles d’été du Centre interuniversitaire québécois de statistiques sociales (CIQSS, <a href="https://www.ciqss.org/" class="uri">https://www.ciqss.org/</a>). Il est le directeur du <strong>laboratoire d’équité environnementale</strong> (<a href="http://laeq.ucs.inrs.ca" class="uri">http://laeq.ucs.inrs.ca</a>). Géographe de formation, ses intérêts de recherche actuels incluent la justice et l’équité environnementale, la pollution atmosphérique, le bruit et le vélo en ville. Il a publié une centaine d’articles scientifiques dans différents domaines des études urbaines et de la géographie.</p>
<p><strong>Jérémy Gelb</strong> a obtenu un doctorat en études urbaines à l’INRS en 2022, sous la supervision de Philippe Apparicio. Il est membre du <strong>laboratoire d’équité environnementale</strong> (<a href="http://laeq.ucs.inrs.ca" class="uri">http://laeq.ucs.inrs.ca</a>). Son sujet de thèse porte sur l’exposition des cyclistes aux pollutions atmosphériques et sonores en milieu urbain. Il utilise quotidiennement des systèmes d’information géographique (SIG) et est tombé dans la marmite de l’<em>open source</em> avec le triptyque QGIS, R et Python au début de sa maîtrise. Il a récemment développé deux <em>packages</em> R : <a href="https://cran.r-project.org/web/packages/geocmeans/index.html"><code>geocmeans</code></a> et <a href="https://cran.r-project.org/web/packages/spNetwork/index.html"><code>spNetwork</code></a>, permettant respectivement d’effectuer des analyses de classification floue non supervisée pondérée spatialement et des estimations de densité par kernel sur réseau.</p>
<p>Philippe et Jérémy travaillent étroitement ensemble depuis plusieurs années. Avec d’autres collègues, ils ont copublié plusieurs articles <span class="citation">(Apparicio, Gelb, Jarry et al. <a href="#ref-2021_1" role="doc-biblioref">2021</a>; Apparicio, Maignan et Gelb <a href="#ref-2021_2" role="doc-biblioref">2021</a>; Gelb et Apparicio <a href="#ref-2021_3" role="doc-biblioref">2021</a><a href="#ref-2021_3" role="doc-biblioref">a</a>; Gelb et Apparicio <a href="#ref-2021_4" role="doc-biblioref">2021</a><a href="#ref-2021_4" role="doc-biblioref">b</a>; Apparicio et Gelb <a href="#ref-2020_1" role="doc-biblioref">2020</a>; Buregeya, Apparicio et Gelb <a href="#ref-2020_2" role="doc-biblioref">2020</a>; Gelb et Apparicio <a href="#ref-2020_3" role="doc-biblioref">2020</a>; Apparicio, Gelb et Mathieu <a href="#ref-2019_1" role="doc-biblioref">2019</a>; Delaunay et al. <a href="#ref-2019_2" role="doc-biblioref">2019</a>; Gelb et Apparicio <a href="#ref-2019_3" role="doc-biblioref">2019</a>; Apparicio, Gelb, Carrier et al. <a href="#ref-2018_1" role="doc-biblioref">2018</a><a href="#ref-2018_1" role="doc-biblioref">a</a>; Apparicio, Gelb, Dubé et al. <a href="#ref-2017_1" role="doc-biblioref">2017</a>; Apparicio, Carrier et al. <a href="#ref-2016_1" role="doc-biblioref">2016</a>)</span>. Tous deux s’intéressent à l’exposition des cyclistes à la pollution atmosphérique et sonore dans plusieurs villes à travers le monde : Philippe ayant une préférence pour les collectes dans les villes des Suds (notamment indiennes, africaines et latino-américaines) et Jérémy dans les villes des Nords (européennes et nord-américaines).</p>
<div class="figure" style="text-align: center">
<img src="images/01_about_figure01.jpg" alt="Philippe Apparicio et Jérémy Gelb lors d’une collecte de données à vélo à Delhi" width="33%" />
<p class="caption">
(#fig:JerPhil)Philippe Apparicio et Jérémy Gelb lors d’une collecte de données à vélo à Delhi
</p>
</div>
<!--chapter:end:00-auteurs.Rmd-->
</div>
<div id="part-découverte-de-r" class="section level1 unnumbered">
<h1>(PART) Découverte de R</h1>
</div>
<div id="chap01" class="section level1">
<h1><span class="header-section-number">1</span> Prise en main de R</h1>
<p>Dans ce chapitre, nous revenons brièvement sur l’histoire de R et la philosophie qui entoure le logiciel. Nous donnons quelques conseils pour son installation et la mise en place d’un environnement de développement. Nous présentons les principaux objets qui sous-tendent le travail effectué avec R (<em>DataFrame</em>, vecteur, matrice, etc.) et comment les manipuler avec des exemples appliqués. Si vous maîtrisez déjà R, nullement besoin de lire ce chapitre!</p>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons principalement les <em>packages</em> suivants :</p>
<ul>
<li>Pour importer des fichiers externes :
<ul>
<li><code>foreign</code> pour entre autres les fichiers <em>dbase</em> et ceux des logiciels SPSS et Stata.</li>
<li><code>sas7bdat</code> pour les fichiers du logiciel SAS.</li>
<li><code>xlsx</code> pour les fichiers Excel.</li>
</ul></li>
<li>Pour manipuler des chaînes de caractères et des dates :
<ul>
<li><code>stringr</code> pour les chaînes de caractères.</li>
<li><code>lubridate</code> pour les dates.</li>
</ul></li>
<li>Pour manipuler des données :
<ul>
<li><code>dplyr</code> du <code>tidyverse</code> propose une grammaire pour manipuler et structurer des données.</li>
</ul></li>
</ul>
</div>
<div id="sect011" class="section level2">
<h2><span class="header-section-number">1.1</span> Histoire et philosophie de R</h2>
<p>R est à la fois un langage de programmation et un logiciel libre (sous la licence publique générale GNU) dédié à l’analyse statistique et soutenu par une fondation : <em>R Foundation for Statistical Computing</em>. Il est principalement écrit en C et en Fortran, deux langages de programmation de « bas niveau », proches du langage machine. À l’inverse, R est un langage de « haut niveau », car plus proche du langage humain.</p>
<p>R a été créé par Ross Ihaka et Robert Gentleman à l’Université d’Auckland en Nouvelle-Zélande. Si vous avez un jour l’occasion de passer dans le coin, une plaque est affichée dans le département de statistique de l’université; ça mérite le détour (figure @ref(fig:fig01)). Une version expérimentale a été publiée en 1996, mais la première version stable ne date que de 2000. Il s’agit donc d’un logiciel relativement récent si nous le comparons à ses concurrents SPSS (1968), SAS (1976) et Stata (1984).</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/plaque.jpg" alt="Lieu de pèlerinage de R" width="40%" />
<p class="caption">
(#fig:fig01)Lieu de pèlerinage de R
</p>
</div>
<p>R a cependant réussi à s’imposer tant dans le milieu de la recherche que dans le secteur privé. Pour s’en convaincre, il suffit de lire l’excellent article concernant la popularité des logiciels d’analyse de données tiré du site <a href="http://r4stats.com/articles/popularity" target="_blank">r4stats.com</a> (figure @ref(fig:fig02)).</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/r_citations.jpg" alt="Nombre d'articles trouvés sur Google Scholar (source : Robert A. Muenchen)" width="50%" />
<p class="caption">
(#fig:fig02)Nombre d’articles trouvés sur Google Scholar (source : Robert A. Muenchen)
</p>
</div>
<p>Les nombreux atouts de R justifient largement sa popularité sans cesse croissante :</p>
<ul>
<li>R est un logiciel à code source ouvert (<em>open source</em>) et ainsi accessible à tous gratuitement.</li>
<li>Le développement du langage R est centralisé, mais la communauté peut créer et partager facilement des <em>packages</em>. Les nouvelles méthodes sont ainsi rapidement implémentées comparativement aux logiciels propriétaires.</li>
<li>R est un logiciel multiplateforme, fonctionnant sur Linux, Unix, Windows et Mac.</li>
<li>Comparativement à ses concurrents, R dispose d’excellentes solutions pour manipuler des données et réaliser des graphiques.</li>
<li>R dispose de nombreuses interfaces lui permettant de communiquer, notamment avec des systèmes de bases de données SQL et non SQL (MySQL, PostgresSQL, MongoDB, etc.), avec des systèmes de <em>big data</em> (Spark, Hadoop), avec des systèmes d’information géographique (QGIS, ArcGIS) et même avec des services en ligne comme Microsoft Azure ou Amazon AWS.</li>
<li>R est un langage de programmation à part entière, ce qui lui donne plus de flexibilité que ses concurrents commerciaux (SPSS, SAS, STATA). Avec R, vous pouvez accomplir de nombreuses tâches : monter un site web, créer un robot collectant des données en ligne, combiner des fichiers PDF, composer des diapositives pour une présentation ou même éditer un livre (comme celui-ci), mais aussi, et surtout, réaliser des analyses statistiques.</li>
</ul>
<p>Un des principaux attraits de R est la quantité astronomique de <em>packages</em> actuellement disponibles. <strong>Un <em>package</em> est un ensemble de nouvelles fonctionnalités développées par des personnes utilisatrices de R et mises à disposition de l’ensemble de la communauté</strong>. Par exemple, le <em>package</em> <code>ggplot2</code> est dédié à la réalisation de graphiques; les <em>packages</em> <code>data.table</code> et <code>dplyr</code> permettent de manipuler des tableaux de données; le <em>package</em> <code>car</code> offre de nombreux outils pour faciliter l’analyse de modèles de régressions, etc. Ce partage de <em>packages</em> rend accessible à tous des méthodes d’analyses complexes et récentes et favorise grandement la reproductibilité de la recherche. Cependant, ce fonctionnement implique quelques désavantages :</p>
<ul>
<li>Il existe généralement plusieurs <em>packages</em> pour effectuer le même type d’analyse, ce qui peut devenir une source de confusion.</li>
<li>Certains <em>packages</em> cessent d’être mis à jour au fil des années, ce qui nécessite de trouver des solutions de rechange (et ainsi apprendre la syntaxe de nouveaux <em>packages</em>).</li>
<li>Il est impératif de s’assurer de la fiabilité des <em>packages</em> que vous souhaitez utiliser, car n’importe qui peut proposer un <em>package</em>.</li>
</ul>
<p>Il nous semble important de relativiser d’emblée la portée du dernier point. Il est rarement nécessaire de lire et d’analyser le code source d’un <em>package</em> pour s’assurer de sa fiabilité. Nous ne sommes pas des spécialistes de tous les sujets et il peut être extrêmement ardu de comprendre la logique d’un code écrit par une autre personne. Nous vous recommandons donc de privilégier l’utilisation de <em>packages</em> qui :</p>
<ul>
<li>ont fait l’objet d’une publication dans une revue à comité de lecture ou qui ont déjà été cités dans des études ayant fait l’objet d’une publication revue par les pairs;</li>
<li>font partie de projets comme <a href="https://ropensci.github.io/reproducibility-guide/sections/introduction/" target="_blank">ROpensci</a> prônant la vérification par les pairs ou subventionnés par des organisations comme <a href="https://www.r-consortium.org/" target="_blank">R Consortium</a>;</li>
<li>sont disponibles sur l’un des deux principaux répertoires de <em>packages</em> R, soit <a href="https://cran.r-project.org/" target="_blank">CRAN</a> et <a href="https://www.bioconductor.org/" target="_blank">Bioconductor</a>.</li>
</ul>
<p>Toujours pour nuancer notre propos, il convient de distinguer <em>package</em> de <em>package</em>! Certains d’entre eux sont des ensembles très complexes de fonctions permettant de réaliser des analyses poussées alors que d’autres sont des projets plus modestes dont l’objectif principal est de simplifier le travail des personnes utilisant R. Ces derniers ressemblent à de petites boîtes à outils et font généralement moins l’objet d’une vérification intensive.</p>
<p>Pour conclure cette section, l’illustration partagée sur Twitter par Darren L Dahly résume avec humour la force du logiciel R et de sa communauté
(figure @ref(fig:fig03)) : R apparaît clairement comme une communauté hétéroclite, mais diversifiée et adaptable.</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/softwares_and_cars.jpeg" alt="Métaphore sur les langages et programmes d'analyse statistique" width="60%" />
<p class="caption">
(#fig:fig03)Métaphore sur les langages et programmes d’analyse statistique
</p>
</div>
<p>Dans ce livre, nous détaillons les <em>packages</em> utilisés dans chaque section avec un encadré spécifique, accompagné de l’icône présentée à la figure @ref(fig:fig04).</p>
<div class="figure" style="text-align: center">
<img src="css/images/package.png" alt="Icône des encadrés dédiés aux packages" width="20%" />
<p class="caption">
(#fig:fig04)Icône des encadrés dédiés aux packages
</p>
</div>
</div>
<div id="sect012" class="section level2">
<h2><span class="header-section-number">1.2</span> Environnement de travail</h2>
<p>Dans cette section, nous vous proposons une visite de l’environnement de travail classique R.</p>
<div id="sect0121" class="section level3">
<h3><span class="header-section-number">1.2.1</span> Installation de R</h3>
<p>La première étape pour travailler avec R est bien sûr de l’installer. Pour cela, il suffit de visiter le site web de <a href="https://cran.r-project.org/" target="_blank">CRAN</a> et de télécharger la dernière version de R en fonction de votre système d’exploitation : Windows, Linux ou Mac. Une fois installé, si vous démarrez R immédiatement, vous aurez accès à une console, plutôt rudimentaire, attendant sagement vos instructions (figure @ref(fig:fig05)).</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/r_console.jpeg" alt="Console de base de R" width="85%" />
<p class="caption">
(#fig:fig05)Console de base de R
</p>
</div>
<p>Notez que vous pouvez aussi télécharger des versions plus anciennes de R en allant sur ce <a href="https://cran.r-project.org/bin/windows/base/old/" target="_blank">lien</a>. Cela peut être intéressant lorsque vous voulez reproduire des résultats d’une autre étude ou que certains <em>packages</em> ne sont plus disponibles dans les nouvelles versions.</p>
</div>
<div id="sect0122" class="section level3">
<h3><span class="header-section-number">1.2.2</span> Environnement RStudio</h3>
<p>Rares sont les adeptes de R qui préfèrent travailler directement avec la console classique. Nous vous recommandons vivement d’utiliser RStudio, un environnement de développement (<em>IDE</em>) dédié à R offrant une intégration très intéressante d’une console, d’un éditeur de texte, d’une fenêtre de visualisation des données et d’une autre pour les graphiques, d’un accès à la documentation, etc. En d’autres termes, si R est un vélo minimaliste, RStudio permet d’y rajouter des freins, des vitesses, un porte-bagages, des garde-boues et une selle confortable. Vous pouvez <a href="https://rstudio.com/products/rstudio/download" target="_blank">télécharger</a> et installer RStudio sur Windows, Linux et Mac. La version de base est gratuite, mais l’entreprise qui développe ce logiciel propose aussi des versions commerciales du logiciel qui assurent essentiellement une assistance technique. Il existe d’autres environnements de développement pour travailler avec R (VisualStudio, Jupyter, Tinn-R, Radiant, RIDE, etc.), mais RStudio offre à ce jour la meilleure option en termes de facilité d’installation, de prise en main et de fonctionnalités proposées (voir l’interface de RStudio à la figure @ref(fig:fig06)).</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/r_studio_01.jpeg" alt="Environnement de base de RStudio" width="85%" />
<p class="caption">
(#fig:fig06)Environnement de base de RStudio
</p>
</div>
<p>Avant d’aller plus loin, notez que :</p>
<ul>
<li>La console actuellement ouverte dans RStudio vous informe de la version de R que vous utilisez. Vous pouvez en effet avoir plusieurs versions de R installées sur votre ordinateur et passer de l’une à l’autre avec RStudio. Pour cela, naviguez dans l’onglet <em>Tools/Global Options</em> et dans le volet <em>General</em>, puis sélectionnez la version de R que vous souhaitez utiliser.</li>
<li>L’aspect de RStudio peut être modifié en navigant dans l’onglet <em>Tools/Global Options</em> et dans le volet <em>Appearance</em>. Nous avons une préférence pour le mode sombre avec le style <em>pastel on dark</em>, mais libre à vous de choisir le style qui vous convient.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/introduction/r_studio_02.jpeg" alt="RStudio avec le style pastel on dark" width="85%" />
<p class="caption">
(#fig:fig07)RStudio avec le style pastel on dark
</p>
</div>
<p>Une fois ces détails réglés, vous pouvez ouvrir votre première feuille de code en allant dans l’onglet <em>File/New File/R Script</em>. Votre environnement est maintenant découpé en quatre fenêtres (figure @ref(fig:fig08)) :</p>
<ol style="list-style-type: decimal">
<li>L’éditeur de code, vous permettant d’écrire le script que vous voulez exécuter et de garder une trace de votre travail. Ce script peut être enregistré sur votre ordinateur avec l’extension <strong>.R</strong>, mais ce n’est qu’un simple fichier texte.</li>
<li>La console vous permettant d’exécuter votre code R et de voir les résultats s’afficher au fur et à mesure.</li>
<li>La fenêtre d’environnement vous montrant les objets, les fonctions et les jeux de données actuellement disponibles dans votre session (chargés dans la mémoire vive).</li>
<li>La fenêtre de l’aide, des graphiques et de l’explorateur de fichiers. Vous pouvez accéder ici à la documentation de R et des <em>packages</em> que vous utilisez, aux sorties graphiques que vous produisez et aux dossiers de votre environnement de travail.</li>
</ol>
<div class="figure" style="text-align: center">
<img src="images/introduction/r_studio_03.jpeg" alt="Fenêtres de RStudio" width="90%" />
<p class="caption">
(#fig:fig08)Fenêtres de RStudio
</p>
</div>
<p>Prenons un bref exemple : tapez la syntaxe suivante dans l’éditeur de code (fenêtre 1 à la figure @ref(fig:fig08)) :</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>ma_somme &lt;-<span class="st"> </span><span class="dv">4</span><span class="op">+</span><span class="dv">4</span></span></code></pre></div>
<p>Sélectionnez ensuite cette syntaxe (mettre en surbrillance avec la souris) et utilisez le raccourci <em>Ctrl+Entrée</em> ou cliquez sur le bouton <em>Run</em> (avec la flèche verte) pour envoyer cette syntaxe à la console qui l’exécutera immédiatement. Notez que rien ne se passe tant que le code n’est pas envoyé à la console. Il s’agit donc de deux étapes distinctes : écrire son code, puis l’envoyer à la console. Constatez également qu’un objet <em>ma_somme</em> est apparu dans votre environnement et que sa valeur est bien 8. Votre console se « souvient » de cette valeur : elle est actuellement stockée dans votre mémoire vive sous le nom de <em>ma_somme</em> (figure @ref(fig:fig09)).</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/r_studio_04.jpeg" alt="Exécuter du code dans RStudio" width="90%" />
<p class="caption">
(#fig:fig09)Exécuter du code dans RStudio
</p>
</div>
<p>Pour conclure cette section, nous vous invitons à enregistrer votre première syntaxe R (<em>File/Save As</em>) dans un fichier <strong>.R</strong> que vous pouvez appeler <code>mon_premier_script.R</code> par exemple. Fermez ensuite RStudio, redémarrez-le et ouvrez (<em>File/Open File</em>) votre fichier <code>mon_premier_script.R</code>. Vous pouvez constater que votre code est toujours présent, mais que votre environnement est vide tant que vous n’exécutez pas votre syntaxe. En effet, lorsque vous fermez RStudio, l’environnement est vidé pour libérer de la mémoire vive. Cela peut poser problème lorsque certains codes sont très longs à exécuter, nous verrons donc plus tard comment enregistrer l’environnement en cours pour le recharger par la suite.</p>
</div>
<div id="sect0123" class="section level3">
<h3><span class="header-section-number">1.2.3</span> Installation et chargement un <em>package</em></h3>
<p>Dans la section sur la Philosophie de R, nous avons souligné la place centrale jouée par les <em>packages</em>. Notez que les termes <em>paquet</em> et plus rarement <em>librairie</em> sont parfois utilisés en français. Voyons ensemble comment installer un <em>package</em>, par exemple celui intitulé <code>lubridate</code>, qui nous permettra plus tard de manipuler des données temporelles.</p>
<div id="sect01231" class="section level4">
<h4><span class="header-section-number">1.2.3.1</span> Installation d’un <em>package</em> depuis <em>CRAN</em></h4>
<p>Pour installer un <em>package</em>, il est nécessaire d’être connecté à Internet puisque R va accéder au répertoire de <em>packages</em> <em>CRAN</em> pour télécharger le <em>package</em> et l’installer sur votre machine. Cette opération est réalisée avec la fonction <code>install.packages</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;lubridate&quot;</span>)</span></code></pre></div>
<p>Notez qu’une fois que le <em>package</em> est installé, il demeure disponible localement sur votre ordinateur, à moins de le désinstaller explicitement avec la fonction <code>remove.packages</code>.</p>
</div>
<div id="sect01232" class="section level4">
<h4><span class="header-section-number">1.2.3.2</span> Installation d’un <em>package</em> depuis GitHub</h4>
<p><em>CRAN</em> est le répertoire officiel des <em>packages</em> de R. Vous pouvez cependant télécharger des <em>packages</em> provenant d’autres sources. Très souvent, les <em>packages</em> sont disponibles sur le site web <a href="https://github.com/" target="_blank">GitHub</a> et nous pouvons même y trouver des versions en développement avec des fonctionnalités encore non intégrées dans la version sur <em>CRAN</em>. Reprenons le cas de <code>lubridate</code>, mais sur GitHub (il est disponible <a href="https://github.com/tidyverse/lubridate" target="_blank">ici</a>). Pour l’installer, nous devons d’abord installer un autre <em>package</em> appelé <code>remotes</code> (depuis <em>CRAN</em>).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span></code></pre></div>
<p>Maintenant que nous disposons de <code>remotes</code>, nous pouvons utiliser la fonction d’installation <code>remotes::install_github</code> pour directement télécharger <code>lubridate</code> depuis GitHub.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;tidyverse/lubridate&quot;</span>)</span></code></pre></div>
</div>
<div id="sect01233" class="section level4">
<h4><span class="header-section-number">1.2.3.3</span> Chargement d’un <em>package</em></h4>
<p>Maintenant que <code>lubridate</code> est installé, nous pouvons le charger dans notre session actuelle de R et accéder aux fonctions qu’il propose. Pour cela, il suffit d’utiliser la fonction <code>library</code>. Conventionnellement, l’appel des <em>packages</em> se fait au tout début du script que vous rédigez. Rien ne vous empêche de le faire au fur et à mesure de votre code, mais ce dernier perd alors en lisibilité. Notez que pour chaque nouvelle session (redémarrage de R), il faut recharger les <em>packages</em> dont vous avez besoin avec la fonction <code>library</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">library</span>(lubridate)</span></code></pre></div>
<p>Si vous obtenez un message d’erreur du type :</p>
<p><span class="error_message">Error in library(monPackage) : aucun package nommé ‘monPackage’ n’est trouvé</span></p>
<p>Cela signifie que le <em>package</em> que vous tentez de charger n’est pas encore installé sur votre ordinateur. Dans ce cas, réessayer de l’installer avec la fonction <code>install.packages</code>. Si le problème persiste, vérifiez que vous n’avez pas fait une faute de frappe dans le nom du <em>package.</em> Vous pouvez également redémarrer RStudio et réessayer d’installer ce <em>package</em>.</p>
</div>
</div>
<div id="aide-disponible" class="section level3">
<h3><span class="header-section-number">1.2.4</span> Aide disponible</h3>
<p>Lorsque vous installez des <em>packages</em> dans R, vous téléchargez aussi leur documentation. Tous les <em>packages</em> de <em>CRAN</em> disposent d’une documentation, ce qui n’est pas forcément vrai pour ceux sur <em>GitHub</em>. Dans RStudio, vous pouvez accéder à la documentation des <em>packages</em> dans l’onglet <strong>Packages</strong> (figure @ref(fig:fig010)). Vous pouvez utiliser la barre de recherche pour retrouver rapidement un <em>package</em> installé. Si vous cliquez sur le nom du <em>package</em>, vous accédez directement à sa documentation dans cette fenêtre.</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/rstudio_packages.jpeg" alt="Description des packages" width="45%" />
<p class="caption">
(#fig:fig010)Description des packages
</p>
</div>
<p>Vous pouvez également accéder à ces informations en utilisant la syntaxe suivante dans votre console :</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">help</span>(<span class="dt">package =</span> <span class="st">&#39;lubridate&#39;</span>)</span></code></pre></div>
<p>Souvent, vous aurez besoin d’accéder à la documentation d’une fonction spécifique d’un <em>package</em>. Affichons la documentation de la fonction <code>now</code> de <code>lubridate</code> :</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">help</span>(now, <span class="dt">package =</span> <span class="st">&#39;lubridate&#39;</span>)</span></code></pre></div>
<p>ou plus simplement :</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>?lubridate<span class="op">::</span>now</span></code></pre></div>
<p>Vous pouvez aussi utiliser le raccourci suivant.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>?now</span></code></pre></div>
<p>Si vous ne vous souvenez plus à quel <em>package</em> la fonction appartient, lancez une recherche en utilisant un double point d’interrogation :</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>??now</span></code></pre></div>
<p>Vous découvrirez ainsi que la fonction <code>now</code> n’existe pas que dans <code>lubridate</code>, ce qui souligne l’importance de bien connaître les <em>packages</em> que nous installons et que nous chargeons dans notre session !</p>
<p>Maintenant que nous avons fait le tour de l’environnement de travail, nous pouvons passer aux choses sérieuses, soit les bases du langage R.</p>
</div>
</div>
<div id="sect013" class="section level2">
<h2><span class="header-section-number">1.3</span> Bases du langage R</h2>
<p>R est un langage de programmation. Il vous permet de communiquer avec votre ordinateur pour lui donner des tâches à accomplir. Dans cette section, nous abordons les bases du langage. Ce type de section introductive à R est présente dans tous les manuels sur R; elle est donc incontournable. À la première lecture, elle vous semblera probablement aride, et ce, d’autant plus que nous ne réalisons pas d’analyse à proprement parler. Gardez en tête que l’analyse de données requiert au préalable une phase de structuration de ces dernières, opération qui nécessite la maîtrise des notions abordées dans cette section. Nous vous recommandons une première lecture de ce chapitre pour comprendre les manipulations que vous pouvez effectuer avec R, avant de poursuivre avec de la lecture des chapitres suivants dédiés aux analyses statistiques. Vous pourrez revenir consulter cette section au besoin. Notez aussi que la maîtrise des différents objets et des différentes opérations de base de R ne s’acquiert qu’en pratiquant. Vous gagnerez cette expertise au fil de vos prochains codes R, période durant laquelle vous pourrez consulter ce chapitre tel un guide de référence des objets et des notions fondamentales de R.</p>
<div id="sect0131" class="section level3">
<h3><span class="header-section-number">1.3.1</span> <em>Hello World</em>!</h3>
<p>Une introduction à un langage de programmation se doit de commencer par le rite de passage <em>Hello World</em>. Il s’agit d’une forme de tradition consistant à montrer aux néophites comment afficher le message <code>Hello World</code> à l’écran avec le langage en question.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">print</span>(<span class="st">&quot;Hello World&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Hello World&quot;</code></pre>
<p>Bravo! Vous venez officiellement de faire votre premier pas dans R!</p>
</div>
<div id="sect0132" class="section level3">
<h3><span class="header-section-number">1.3.2</span> Objets et expressions</h3>
<p>Dans R, nous passons notre temps à manipuler des <strong>objets</strong> à l’aide d’<strong>expressions</strong>. Prenons un exemple concret : si vous tapez la syntaxe <code>4 + 3</code>, vous manipulez deux objets (4 et 3) avec une expression indiquant que vous souhaitez obtenir la somme des deux objets.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="dv">4</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<p>Cette expression est correcte, R comprend vos indications et effectue le calcul.</p>
<p>Il est possible d’enregistrer le résultat d’une expression et de le conserver dans un nouvel objet. On appelle cette opération : « déclarer une variable ».</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>ma_somme &lt;-<span class="st"> </span><span class="dv">4</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span></span></code></pre></div>
<p>Concrètement, nous venons de demander à R d’enregistrer le résultat de <code>4 + 3</code> dans un espace spécifique de notre mémoire vive. Si vous regardez dans votre fenêtre <strong>Environment</strong>, vous verrez en effet qu’un objet appelé ma_somme est actuellement en mémoire et a pour valeur 7.</p>
<p>Notez ici que le nom des variables ne peut être composé que de lettres, de chiffres, de points (.) et de tirets bas (_) et doit commencer par une lettre. R est sensible à la casse; en d’autres termes, les variables <code>Ma_somme</code>, <code>ma_sommE</code>, <code>ma_SOMME</code>, et <code>MA_SOMME</code> renvoient toutes à un objet différent. Attention donc aux fautes de frappe. Si vous déclarez une variable en utilisant le nom d’une variable existante, la première est écrasée par la seconde :</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>age &lt;-<span class="st"> </span><span class="dv">35</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>age</span></code></pre></div>
<pre><code>## [1] 35</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>age &lt;-<span class="st"> </span><span class="dv">45</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>age</span></code></pre></div>
<pre><code>## [1] 45</code></pre>
<p>Portez alors attention aux noms de variables que vous utilisez et réutilisez. Réutilisons notre objet <code>ma_somme</code> dans une nouvelle expression :</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>ma_somme2 &lt;-<span class="st"> </span>ma_somme <span class="op">+</span><span class="st"> </span>ma_somme</span></code></pre></div>
<p>Avec cette nouvelle expression, nous indiquons à R que nous souhaitons déclarer une nouvelle variable appelée <code>ma_somme2</code>, et que cette variable aura pour valeur <code>ma_somme + ma_somme</code>, soit <code>7 + 7</code>. Sans surprise, <code>ma_somme2</code> a pour valeur 14.</p>
<p>Notez que la mémoire vive (l’environnement) est vidée lorsque vous fermez R. Autrement dit, R perd complètement la mémoire lorsque vous le fermez. Vous pouvez bien sûr recréer vos objets en relançant les mêmes syntaxes. C’est pourquoi vous devez conserver vos feuilles de codes et ne pas seulement travailler dans la console. La console ne garde aucune trace de votre travail. Pensez donc à bien enregistrer votre code!</p>
<p>Nous verrons dans une prochaine section comment sauvegarder des objets et les recharger dans une session ultérieure de R (section @ref(sect017)). Ce type d’opération est pertinent quand le temps de calcul nécessaire à la production de certains objets est très long.</p>
</div>
<div id="sect0_133" class="section level3">
<h3><span class="header-section-number">1.3.3</span> Fonctions et arguments</h3>
<p>Dans R, nous manipulons le plus souvent nos objets avec des <strong>fonctions</strong>. Une fonction est elle-même un objet, mais qui a la particularité de pouvoir effectuer des opérations sur d’autres objets. Par exemple, déclarons l’objet <code>taille</code> avec une valeur de 175,897 :</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>taille &lt;-<span class="st"> </span><span class="fl">175.897</span></span></code></pre></div>
<p>Nous utilisons la fonction <code>round</code>, dont l’objectif est d’arrondir un nombre avec décimales pour obtenir un nombre entier.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">round</span>(taille)</span></code></pre></div>
<pre><code>## [1] 176</code></pre>
<p>Pour effectuer leurs opérations, les fonctions ont généralement besoin d’<strong>arguments</strong>. Ici, <code>taille</code> est un argument passé à la fonction <code>round</code>. Si nous regardons la documentation de <code>round</code> avec <code>help(round)</code> (figure @ref(fig:fig011)), nous constatons que cette fonction prend en réalité deux arguments : <em>x</em> et <em>digits</em>. Le premier est le nombre que nous souhaitons arrondir et le second est le nombre de décimales à conserver. Nous pouvons lire dans la documentation que la valeur par défaut de <em>digits</em> est 0, ce qui explique que <code>round(taille)</code> a produit le résultat de 176.</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/help_round.jpeg" alt="Arguments de la fonction round" width="45%" />
<p class="caption">
(#fig:fig011)Arguments de la fonction round
</p>
</div>
<p>Réutilisons maintenant la fonction <code>round</code>, mais en gardant une décimale :</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">round</span>(taille, <span class="dt">digits =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 175.9</code></pre>
<p>Il est aussi possible que certaines fonctions ne requièrent pas d’argument. Par exemple, la fonction <code>now</code> indique la date précise (avec l’heure) et n’a besoin d’aucun argument pour le faire :</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">now</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2022-03-25 16:51:09 EDT&quot;</code></pre>
<p>Par contre, si nous essayons de lancer la fonction <code>round</code> sans argument, nous obtenons une erreur :</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">round</span>()</span></code></pre></div>
<p><span class="error_message">Erreur : 0 argument passé à ‘round’ qui en exige 1 ou 2</span></p>
<p>Le message est très clair, <code>round</code> a besoin d’au moins un argument pour fonctionner. Si, au lieu d’un nombre, nous avions donné du texte à la fonction <code>round</code>, nous aurions aussi obtenu une erreur :</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">round</span>(<span class="st">&quot;Hello World&quot;</span>)</span></code></pre></div>
<p><span class="error_message">Erreur dans round(“Hello World”) : argument non numérique pour une fonction mathématique</span></p>
<p>À nouveau le message est très explicite : nous avons passé un argument non numérique à une fonction mathématique. Lisez toujours vos messages d’erreurs : ils permettent de repérer les coquilles et de corriger votre code!</p>
<p>Nous terminons cette section avec une fonction essentielle, <code>print</code>, qui permet d’afficher la valeur d’une variable.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">print</span>(ma_somme)</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
</div>
<div id="sect0134" class="section level3">
<h3><span class="header-section-number">1.3.4</span> Principaux types de données</h3>
<p>Depuis le début de ce chapitre, nous avons déclaré plusieurs variables et essentiellement des données numériques. Dans R, il existe trois principaux types de données de base :</p>
<ul>
<li>Les données numériques qui peuvent être des nombres entiers (appelés <em>integers</em>) ou des nombres décimaux (appelés <em>floats</em> ou <em>doubles</em>), par exemple <code>15</code> et <code>15.3</code>.</li>
<li>Les données de type texte qui sont des chaînes de caractères (appelées <em>strings</em>) et déclarées entre guillemets <code>"abcdefg"</code>.</li>
<li>Les données booléennes (<em>booleans</em>) qui peuvent n’avoir que deux valeurs : vrai (<code>TRUE</code>) ou faux (<code>FALSE</code>).</li>
</ul>
<p>Déclarons une variable pour chacun de ces types :</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>age &lt;-<span class="st"> </span><span class="dv">35</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>taille &lt;-<span class="st"> </span><span class="fl">175.5</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>adresse &lt;-<span class="st"> &#39;4225 rue de la gauchetiere&#39;</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>proprietaire &lt;-<span class="st"> </span><span class="ot">TRUE</span></span></code></pre></div>
<div class="bloc_notes">
<p><strong>Simples ou doubles quotes?</strong></p>
<p>Pour déclarer des données de type texte, il est possible d’utiliser des quotes simples <code>'</code> (apostrophe) ou des quotes doubles <code>"</code> (guillemets), cela ne fait aucune différence pour R. Cependant, si la chaîne de caractères que vous créez contient une apostrophe, il est nécessaire d’utiliser des quotes doubles et inversement si votre chaîne de caractère contient des guillemets.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>phrase1 &lt;-<span class="st"> &quot;J&#39;adore le langage R!&quot;</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>phrase2 &lt;-<span class="st"> &#39;Je cite : &quot;il est le meilleur langage de statistique&quot;.&#39;</span></span></code></pre></div>
<p>Si la chaîne de caractère contient des guillemets et des apostrophes, il est nécessaire d’utiliser la barre oblique inversée <code>\</code> pour indiquer à R que ces apostrophes ou ces guillemets ne doivent pas être considérés comme la fin de la chaîne de caractère.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>phrase3 &lt;-<span class="st"> &quot;Je cite : </span><span class="ch">\&quot;</span><span class="st">j&#39;en rêve la nuit</span><span class="ch">\&quot;</span><span class="st">.&quot;</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="kw">cat</span>(phrase3)</span></code></pre></div>
<pre><code>## Je cite : &quot;j&#39;en rêve la nuit&quot;.</code></pre>
<p>Les barres obliques inversées ne font pas partie de la chaîne de caractère, ils sont là pour “échapper” les guillemets qui doivent rester dans la chaîne de caractère. Si une chaîne de caractère doit contenir une barre oblique inversée, alors il faut l’échapper également en utilisant une deuxième barre oblique inversée.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>phrase4 &lt;-<span class="st"> &quot;Une phrase avec une barre oblique inversée : </span><span class="ch">\\</span><span class="st">&quot;</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="kw">cat</span>(phrase4)</span></code></pre></div>
<pre><code>## Une phrase avec une barre oblique inversée : \</code></pre>
<p>Faites attention à la coloration syntaxique de RStudio! Elle peut vous aider à repérer facilement une chaîne de caractère qui aurait été interrompue par un guillemet ou une apostrophe mal placés.</p>
</div>
<p>Si vous avez un doute sur le type de données stockées dans une variable, vous pouvez utiliser la fonction <code>typeof</code>. Par exemple, cela permet de repérer si des données qui sont censées être numériques sont en fait stockées sous forme de texte comme dans l’exemple ci-dessous.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">typeof</span>(age)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">typeof</span>(taille)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Ici tailletxt est définie comme une chaîne de caractère car la valeur est </span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="co"># définie entre des guillemets.</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>tailletxt &lt;-<span class="st"> &quot;175.5&quot;</span></span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="kw">typeof</span>(tailletxt)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Notez également qu’il existe des types pour représenter l’absence de données :</p>
<ul>
<li>pour représenter un objet vide, nous utilisons l’objet <code>NULL</code>,</li>
<li>pour représenter une donnée manquante, nous utilisons l’objet <code>NA</code>,</li>
<li>pour représenter un texte vide, nous utilisons une chaîne de caractère de longueur 0, soit <code>""</code>.</li>
</ul>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>age2 &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>taille2 &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>adresse2 &lt;-<span class="st"> &#39;&#39;</span></span></code></pre></div>
</div>
<div id="sect0135" class="section level3">
<h3><span class="header-section-number">1.3.5</span> Opérateurs</h3>
<p>Nous avons vu que les fonctions permettent de manipuler des objets. Nous pouvons également effectuer un grand nombre d’opérations avec les opérateurs.</p>
<div id="sect01351" class="section level4">
<h4><span class="header-section-number">1.3.5.1</span> Opérateurs mathématiques</h4>
<p>Les opérateurs mathématiques (tableau @ref(tab:tableOperateurMath)) permettent d’effectuer des calculs avec des données de type numérique.</p>
<table>
<caption>
(#tab:tableOperateurMath)Opérateurs mathématiques
</caption>
<thead>
<tr>
<th style="text-align:left;">
Opérateur
</th>
<th style="text-align:left;">
Description
</th>
<th style="text-align:left;">
Syntaxe
</th>
<th style="text-align:right;">
Résultat
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>+</code>
</td>
<td style="text-align:left;">
Addition
</td>
<td style="text-align:left;">
<code>4 + 4</code>
</td>
<td style="text-align:right;">
8,0
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>-</code>
</td>
<td style="text-align:left;">
Soustraction
</td>
<td style="text-align:left;">
<code>4 - 3</code>
</td>
<td style="text-align:right;">
1,0
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>*</code>
</td>
<td style="text-align:left;">
Multiplication
</td>
<td style="text-align:left;">
<code>4 * 3</code>
</td>
<td style="text-align:right;">
12,0
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>/</code>
</td>
<td style="text-align:left;">
Division
</td>
<td style="text-align:left;">
<code>12 / 4</code>
</td>
<td style="text-align:right;">
3,0
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>^</code>
</td>
<td style="text-align:left;">
Exponentiel
</td>
<td style="text-align:left;">
<code>4 ^ 3</code>
</td>
<td style="text-align:right;">
64,0
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>**</code>
</td>
<td style="text-align:left;">
Exponentiel
</td>
<td style="text-align:left;">
<code>4 ** 3</code>
</td>
<td style="text-align:right;">
64,0
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>%%</code>
</td>
<td style="text-align:left;">
Reste de division
</td>
<td style="text-align:left;">
<code>15,5 %% 2</code>
</td>
<td style="text-align:right;">
1,5
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>%/%</code>
</td>
<td style="text-align:left;">
Division entière
</td>
<td style="text-align:left;">
<code>15,5 %/% 2</code>
</td>
<td style="text-align:right;">
7,0
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect01352" class="section level4">
<h4><span class="header-section-number">1.3.5.2</span> Opérateurs relationnels</h4>
<p>Les opérateurs relationnels (tableau @ref(tab:tableOperateurRela)) permettent de vérifier des conditions dans R. Ils renvoient un booléen, <code>TRUE</code> si la condition est vérifiée et <code>FALSE</code> si ce n’est pas le cas.</p>
<table>
<caption>
(#tab:tableOperateurRela)Opérateurs relationnels
</caption>
<thead>
<tr>
<th style="text-align:left;">
Opérateur
</th>
<th style="text-align:left;">
Description
</th>
<th style="text-align:left;">
Syntaxe
</th>
<th style="text-align:left;">
Résultat
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>==</code>
</td>
<td style="text-align:left;">
Égalité
</td>
<td style="text-align:left;">
<code>4 == 4</code>
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>!=</code>
</td>
<td style="text-align:left;">
Différence
</td>
<td style="text-align:left;">
<code>4 != 4</code>
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>&gt;</code>
</td>
<td style="text-align:left;">
Est supérieur
</td>
<td style="text-align:left;">
<code>5 &gt; 4</code>
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>&lt;</code>
</td>
<td style="text-align:left;">
Est inférieur
</td>
<td style="text-align:left;">
<code>5 &lt; 4</code>
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>&gt;=</code>
</td>
<td style="text-align:left;">
Est supérieur ou égal
</td>
<td style="text-align:left;">
<code>5 &gt;= 4</code>
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>&lt;=</code>
</td>
<td style="text-align:left;">
Est inférieur ou égal
</td>
<td style="text-align:left;">
<code>5 &lt;= 4</code>
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect01353" class="section level4">
<h4><span class="header-section-number">1.3.5.3</span> Opérateurs logiques</h4>
<p>Les opérateurs logiques (tableau @ref(tab:tableOperateurLogi)) permettent de combiner plusieurs conditions :</p>
<ul>
<li><p>L’opérateur <strong>ET</strong> (<code>&amp;</code>) permet de vérifier que deux conditions (l’une ET l’autre) sont TRUE. Si l’une des deux est FALSE, il renvoie FALSE.</p></li>
<li><p>L’opérateur <strong>OU</strong> (<code>|</code>) permet de vérifier que l’une des deux conditions est TRUE (l’une OU l’autre). Si les deux sont FALSE, alors il renvoie FALSE.</p></li>
<li><p>L’opérateur <strong>NOT</strong> (<code>!</code>) permet d’inverser une condition. Ainsi, NOT TRUE donne FALSE et NOT FALSE donne TRUE.</p></li>
</ul>
<table>
<caption>
(#tab:tableOperateurLogi)Opérateurs logiques
</caption>
<thead>
<tr>
<th style="text-align:left;">
Opérateur
</th>
<th style="text-align:left;">
Description
</th>
<th style="text-align:left;">
Syntaxe
</th>
<th style="text-align:left;">
Résultat
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>&amp;</code>
</td>
<td style="text-align:left;">
ET
</td>
<td style="text-align:left;">
<code>TRUE &amp; FALSE</code>
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>|</code>
</td>
<td style="text-align:left;">
OU
</td>
<td style="text-align:left;">
<code>TRUE | FALSE</code>
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>!</code>
</td>
<td style="text-align:left;">
NOT
</td>
<td style="text-align:left;">
<code>! TRUE</code>
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
</tbody>
</table>
<p>Prenons le temps pour un rapide exemple :</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>A &lt;-<span class="st"> </span><span class="dv">4</span> </span>
<span id="cb45-2"><a href="#cb45-2"></a>B &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>C &lt;-<span class="st"> </span><span class="dv">-5</span></span>
<span id="cb45-4"><a href="#cb45-4"></a></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="co"># Produit TRUE car A est bien plus petit que B et C est bien plus petit que A</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>A <span class="op">&lt;</span><span class="st"> </span>B <span class="op">&amp;</span><span class="st"> </span>C <span class="op">&lt;</span><span class="st"> </span>A</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># Produit FALSE car si A est bien plus petit que B, </span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="co"># B est en revanche plus grand que c</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>A <span class="op">&lt;</span><span class="st"> </span>B <span class="op">&amp;</span><span class="st"> </span>B <span class="op">&lt;</span><span class="st"> </span>C</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># Produit TRUE car la seconde condition est inversée</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>A <span class="op">&lt;</span><span class="st"> </span>B <span class="op">&amp;</span><span class="st">  </span><span class="op">!</span><span class="st"> </span>B <span class="op">&lt;</span><span class="st"> </span>C</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Produit TRUE car au moins une des deux conditions est juste</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>A <span class="op">&lt;</span><span class="st"> </span>B <span class="op">|</span><span class="st">  </span>B <span class="op">&lt;</span><span class="st"> </span>C</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Notez que l’opérateur <strong>ET</strong> est prioritaire sur l’opérateur <strong>OU</strong> et que les parenthèses sont prioritaires sur tous les opérateurs :</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># Produit TRUE car nous commençons par tester A &lt; B puis B &lt; C ce qui donne FALSE</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="co"># On obtient ensuite</span></span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="co"># FALSE |  A &gt; C</span></span>
<span id="cb53-4"><a href="#cb53-4"></a><span class="co"># Enfin, A est bien supérieur à C, donc l&#39;une des deux conditions est vraie</span></span>
<span id="cb53-5"><a href="#cb53-5"></a>A <span class="op">&lt;</span><span class="st"> </span>B <span class="op">&amp;</span><span class="st"> </span>B <span class="op">&lt;</span><span class="st"> </span>C <span class="op">|</span><span class="st">  </span>A <span class="op">&gt;</span><span class="st"> </span>C</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Notez qu’en arrière-plan, les opérateurs sont en réalité des fonctions déguisées. Il est donc possible de définir de nouveaux comportements pour les opérateurs. Il est par exemple possible d’additionner ou de comparer des objets spéciaux comme des dates, des géométries, des graphes, etc.</p>
</div>
</div>
<div id="sect0136" class="section level3">
<h3><span class="header-section-number">1.3.6</span> Structures de données</h3>
<p>Jusqu’à présent, nous avons utilisé des objets ne comprenant qu’une seule valeur. Or, des analyses statistiques nécessitent de travailler avec des volumes de données bien plus grands. Pour stocker des valeurs, nous travaillons avec différentes structures de données : les vecteurs, les matrices, les tableaux de données et les listes.</p>
<div id="sect01361" class="section level4">
<h4><span class="header-section-number">1.3.6.1</span> Vecteurs</h4>
<p>Les vecteurs sont la brique élémentaire de R. Ils permettent de stocker une série de valeurs <strong>du même type</strong> dans une seule variable. Pour déclarer un vecteur, nous utilisons la fonction <code>c()</code> :</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>ages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">35</span>,<span class="dv">45</span>,<span class="dv">72</span>,<span class="dv">56</span>,<span class="dv">62</span>)</span>
<span id="cb55-2"><a href="#cb55-2"></a>tailles &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">175.5</span>,<span class="fl">180.3</span>,<span class="fl">168.2</span>,<span class="fl">172.8</span>,<span class="fl">167.6</span>)</span>
<span id="cb55-3"><a href="#cb55-3"></a>adresses &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;4225 rue de la gauchetiere&#39;</span>,</span>
<span id="cb55-4"><a href="#cb55-4"></a>              <span class="st">&#39;4223 rue de la gauchetiere&#39;</span>,</span>
<span id="cb55-5"><a href="#cb55-5"></a>              <span class="st">&#39;4221 rue de la gauchetiere&#39;</span>,</span>
<span id="cb55-6"><a href="#cb55-6"></a>              <span class="st">&#39;4219 rue de la gauchetiere&#39;</span>,</span>
<span id="cb55-7"><a href="#cb55-7"></a>              <span class="st">&#39;4217 rue de la gauchetiere&#39;</span>)</span>
<span id="cb55-8"><a href="#cb55-8"></a>proprietaires &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>,<span class="ot">TRUE</span>,<span class="ot">FALSE</span>,<span class="ot">TRUE</span>,<span class="ot">TRUE</span>)</span></code></pre></div>
<p>Nous venons ainsi de déclarer quatre nouvelles variables étant chacune un vecteur de longueur cinq (comprenant chacun cinq valeurs). Ces vecteurs représentent, par exemple, les réponses de plusieurs personnes à un questionnaire.</p>
<div class="bloc_attention">
<p>Il existe dans R une subtilité à l’origine de nombreux malentendus : la distinction entre un vecteur de type <strong>texte</strong> et un vecteur de type <strong>facteur</strong>. Dans l’exemple précédent, le vecteur <em>adresses</em> est un vecteur de type texte. Chaque nouvelle valeur ajoutée dans le vecteur peut être n’importe quelle nouvelle adresse. Déclarons un nouveau vecteur qui contient cette fois-ci la couleur des yeux de personnes ayant répondu au questionnaire.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>couleurs_yeux &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;marron&#39;</span>,<span class="st">&#39;marron&#39;</span>,<span class="st">&#39;bleu&#39;</span>,<span class="st">&#39;bleu&#39;</span>,<span class="st">&#39;marron&#39;</span>,<span class="st">&#39;vert&#39;</span>)</span></code></pre></div>
<p>Contrairement aux adresses, il y a un nombre limité de couleurs que nous pouvons mettre dans ce vecteur. Il est donc intéressant de fixer les valeurs possibles du vecteur pour éviter d’en ajouter de nouvelles par erreur. Pour cela, nous devons convertir ce vecteur texte en vecteur de type facteur, ci-après nommé simplement facteur, avec la fonction <code>as.factor</code>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>couleurs_yeux_facteur &lt;-<span class="st"> </span><span class="kw">as.factor</span>(couleurs_yeux)</span></code></pre></div>
<p>Notez qu’à présent, nous pouvons ajouter une nouvelle couleur dans le premier vecteur, mais pas dans le second.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>couleurs_yeux[<span class="dv">7</span>] &lt;-<span class="st"> &quot;rouge&quot;</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>couleurs_yeux_facteur[<span class="dv">7</span>] &lt;-<span class="st"> &quot;rouge&quot;</span></span></code></pre></div>
<pre><code>## Warning in `[&lt;-.factor`(`*tmp*`, 7, value = &quot;rouge&quot;): invalid factor level, NA
## generated</code></pre>
<p>Le message d’erreur nous informe que nous avons tenté d’introduire une valeur invalide dans le facteur.</p>
<p>Les facteurs peuvent sembler restrictifs et, très régulièrement, nous préférons travailler avec de simples vecteurs de type texte plutôt que des facteurs. Cependant, de nombreuses fonctions d’analyse nécessitent d’utiliser des facteurs, car ils assurent une certaine cohérence dans les données. Il est donc essentiel de savoir passer du texte au facteur avec la fonction <code>as.factor</code>. À l’inverse, il est parfois nécessaire de revenir à une variable de type texte avec la fonction <code>as.character</code>.</p>
<p>Notez que des vecteurs numériques peuvent aussi être convertis en facteurs :</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>tailles_facteur &lt;-<span class="st"> </span><span class="kw">as.factor</span>(tailles)</span></code></pre></div>
<p>Cependant, si vous souhaitez reconvertir ce facteur en format numérique, il faudra passer dans un premier temps par le format texte :</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="kw">as.numeric</span>(tailles_facteur)</span></code></pre></div>
<pre><code>## [1] 4 5 2 3 1</code></pre>
<p>Comme vous pouvez le voir, convertir un facteur en valeur numérique renvoie des nombres entiers. Ceci est dû au fait que les valeurs dans un facteur sont recodées sous forme de nombres entiers, chaque nombre correspondant à une des valeurs originales (appelées niveaux). Si nous convertissons un facteur en valeurs numériques, nous obtenons donc ces nombres entiers.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(tailles_facteur))</span></code></pre></div>
<pre><code>## [1] 175.5 180.3 168.2 172.8 167.6</code></pre>
<p>Morale de l’histoire : ne confondez pas les données de type texte et de type facteur. Dans le doute, vous pouvez demander à R quel est le type d’un vecteur avec la fonction <code>class</code>.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="kw">class</span>(tailles)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="kw">class</span>(tailles_facteur)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="kw">class</span>(couleurs_yeux)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="kw">class</span>(couleurs_yeux_facteur)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
</div>
<p>Quasiment toutes les fonctions utilisent des vecteurs. Par exemple, nous pouvons calculer la moyenne du vecteur <em>ages</em> en utilisant la fonction <code>mean</code> présente de base dans R.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="kw">mean</span>(ages)</span></code></pre></div>
<pre><code>## [1] 54</code></pre>
<p>Cela démontre bien que le vecteur est la brique élémentaire de R! Toutes les variables que nous avons déclarées dans les sections précédentes sont aussi des vecteurs, mais de longueur 1.</p>
</div>
<div id="sect01362" class="section level4">
<h4><span class="header-section-number">1.3.6.2</span> Matrices</h4>
<p>Il est possible de combiner des vecteurs pour former des matrices. Une matrice est un tableau en deux dimensions (colonnes et lignes) et est généralement utilisée pour représenter certaines structures de données comme des images (pixels), effectuer du calcul matriciel ou plus simplement présenter des matrices de corrélations. Vous aurez rarement à travailler directement avec des matrices, mais il est bon de savoir ce qu’elles sont. Créons deux matrices à partir de nos précédents vecteurs.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a>matrice1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(ages,tailles)</span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="co"># Afficher la matrice 1</span></span>
<span id="cb75-3"><a href="#cb75-3"></a><span class="kw">print</span>(matrice1)</span></code></pre></div>
<pre><code>##      ages tailles
## [1,]   35   175.5
## [2,]   45   180.3
## [3,]   72   168.2
## [4,]   56   172.8
## [5,]   62   167.6</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># Afficher les dimensions de la matrice 1 (1er chiffre : lignes; 2e chiffre : colonnes)</span></span>
<span id="cb77-2"><a href="#cb77-2"></a><span class="kw">print</span>(<span class="kw">dim</span>(matrice1))</span></code></pre></div>
<pre><code>## [1] 5 2</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>matrice2 &lt;-<span class="st"> </span><span class="kw">rbind</span>(ages, tailles)</span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="co"># Afficher la matrice 2</span></span>
<span id="cb79-3"><a href="#cb79-3"></a><span class="kw">print</span>(matrice2)</span></code></pre></div>
<pre><code>##          [,1]  [,2]  [,3]  [,4]  [,5]
## ages     35.0  45.0  72.0  56.0  62.0
## tailles 175.5 180.3 168.2 172.8 167.6</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="co"># Afficher les dimensions de la matrice 2</span></span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="kw">print</span>(<span class="kw">dim</span>(matrice2))</span></code></pre></div>
<pre><code>## [1] 2 5</code></pre>
<p>Comme vous pouvez le constater, la fonction <code>cbind</code> permet de concaténer des vecteurs comme s’ils étaient les colonnes d’une matrice, alors que <code>rbind</code> les combine comme s’ils étaient les lignes d’une matrice. La figure @ref(fig:fig012) présente graphiquement le passage du vecteur à la matrice.</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/vecteur_to_matrix.png" alt="Du vecteur à la matrice" width="30%" />
<p class="caption">
(#fig:fig012)Du vecteur à la matrice
</p>
</div>
<p>Notez que vous pouvez transposer une matrice avec la fonction <code>t</code>. Si nous essayons maintenant de comparer la matrice 1 à la matrice 2 nous allons avoir une erreur, car elles n’ont pas les mêmes dimensions.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>matrice1 <span class="op">==</span><span class="st"> </span>matrice2</span></code></pre></div>
<p><span class="error_message">Erreur dans matrice1 == matrice2 : tableaux de tailles inadéquates</span></p>
<p>En revanche, nous pouvons transposer la matrice 1 et refaire cette comparaison :</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="kw">t</span>(matrice1) <span class="op">==</span><span class="st"> </span>matrice2</span></code></pre></div>
<pre><code>##         [,1] [,2] [,3] [,4] [,5]
## ages    TRUE TRUE TRUE TRUE TRUE
## tailles TRUE TRUE TRUE TRUE TRUE</code></pre>
<p>Le résultat souligne bien que nous avons les mêmes valeurs dans les deux matrices. Il est aussi possible de construire des matrices directement avec la fonction <code>matrix</code>, ce que nous montrons dans la prochaine section.</p>
</div>
<div id="sect01363" class="section level4">
<h4><span class="header-section-number">1.3.6.3</span> <em>Arrays</em></h4>
<p>S’il est rare de travailler avec des matrices, il est encore plus rare de manipuler des <em>arrays</em>. Un <em>array</em> est une matrice spéciale qui peut avoir plus que deux dimensions. Un cas simple serait un <em>array</em> en trois dimensions : lignes, colonnes, profondeur, que nous pourrions représenter comme un cube, ou une série de matrices de mêmes dimensions et empilées. Au-delà de trois dimensions, il devient difficile de les représenter mentalement. Cette structure de données peut être utilisée pour représenter les différentes bandes spectrales d’une image satellitaire. Les lignes et les colonnes délimiteraient les pixels de l’image et la profondeur délimiterait les différentes bandes composant l’image (figure @ref(fig:fig012)).</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/array.png" alt="Un array avec trois dimensions" width="15%" />
<p class="caption">
(#fig:fig013)Un array avec trois dimensions
</p>
</div>
<p>Créons un <em>array</em> en combinant trois matrices avec la fonction <code>array</code>. Chacune de ces matrices est composée respectivement de 1, de 2 et de 3 et a une dimension de 5 x 5. L’<em>array</em> final a donc une dimension de 5 x 5 x 3.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>mat1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>, <span class="dt">nrow =</span> <span class="dv">5</span>, <span class="dt">ncol =</span> <span class="dv">5</span>)</span>
<span id="cb86-2"><a href="#cb86-2"></a>mat2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">5</span>, <span class="dt">ncol =</span> <span class="dv">5</span>)</span>
<span id="cb86-3"><a href="#cb86-3"></a>mat3 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">3</span>, <span class="dt">nrow =</span> <span class="dv">5</span>, <span class="dt">ncol =</span> <span class="dv">5</span>)</span>
<span id="cb86-4"><a href="#cb86-4"></a></span>
<span id="cb86-5"><a href="#cb86-5"></a>mon_array &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">c</span>(mat1, mat2, mat3), <span class="dt">dim =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">3</span>))</span>
<span id="cb86-6"><a href="#cb86-6"></a></span>
<span id="cb86-7"><a href="#cb86-7"></a><span class="kw">print</span>(mon_array)</span></code></pre></div>
<pre><code>## , , 1
## 
##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    1    1    1    1
## [2,]    1    1    1    1    1
## [3,]    1    1    1    1    1
## [4,]    1    1    1    1    1
## [5,]    1    1    1    1    1
## 
## , , 2
## 
##      [,1] [,2] [,3] [,4] [,5]
## [1,]    2    2    2    2    2
## [2,]    2    2    2    2    2
## [3,]    2    2    2    2    2
## [4,]    2    2    2    2    2
## [5,]    2    2    2    2    2
## 
## , , 3
## 
##      [,1] [,2] [,3] [,4] [,5]
## [1,]    3    3    3    3    3
## [2,]    3    3    3    3    3
## [3,]    3    3    3    3    3
## [4,]    3    3    3    3    3
## [5,]    3    3    3    3    3</code></pre>
</div>
<div id="sect01364" class="section level4">
<h4><span class="header-section-number">1.3.6.4</span> <em>DataFrames</em></h4>
<p>S’il est rare de manipuler des matrices et des <em>arrays</em>, le <em>DataFrame</em> (tableau de données en français) est la structure de données la plus souvent utilisée. Dans cette structure, chaque ligne du tableau représente un individu et chaque colonne représente une caractéristique de cet individu. Ces colonnes ont des noms qui permettent facilement d’accéder à leurs valeurs. Créons un <em>DataFrame</em> (tableau @ref(tab:tabfirsttable)) à partir de nos quatre vecteurs et de la fonction <code>data.frame</code>.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb88-2"><a href="#cb88-2"></a>  <span class="st">&quot;age&quot;</span> =<span class="st"> </span>ages,</span>
<span id="cb88-3"><a href="#cb88-3"></a>  <span class="st">&quot;taille&quot;</span> =<span class="st"> </span>tailles,</span>
<span id="cb88-4"><a href="#cb88-4"></a>  <span class="st">&quot;adresse&quot;</span> =<span class="st"> </span>adresses,</span>
<span id="cb88-5"><a href="#cb88-5"></a>  <span class="st">&quot;proprietaire&quot;</span> =<span class="st"> </span>proprietaires</span>
<span id="cb88-6"><a href="#cb88-6"></a>)</span></code></pre></div>
<table>
<caption>
(#tab:tabfirsttable)Premier DataFrame
</caption>
<thead>
<tr>
<th style="text-align:center;">
age
</th>
<th style="text-align:center;">
taille
</th>
<th style="text-align:left;">
adresse
</th>
<th style="text-align:left;">
proprietaire
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
35
</td>
<td style="text-align:center;">
175,5
</td>
<td style="text-align:left;">
4225 rue de la gauchetiere
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;">
45
</td>
<td style="text-align:center;">
180,3
</td>
<td style="text-align:left;">
4223 rue de la gauchetiere
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;">
72
</td>
<td style="text-align:center;">
168,2
</td>
<td style="text-align:left;">
4221 rue de la gauchetiere
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:center;">
56
</td>
<td style="text-align:center;">
172,8
</td>
<td style="text-align:left;">
4219 rue de la gauchetiere
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;">
62
</td>
<td style="text-align:center;">
167,6
</td>
<td style="text-align:left;">
4217 rue de la gauchetiere
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
</table>
<p>Dans RStudio, vous pouvez visualiser votre tableau de données avec la fonction <code>View(df)</code>. Comme vous pouvez le constater, chaque vecteur est devenu une colonne de votre tableau de données <em>df</em>. La figure @ref(fig:fig014) résume ce passage d’une simple donnée à un <em>DataFrame</em> en passant par un vecteur.</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/vecteur_to_dataframe.png" alt="De la donnée au DataFrame" width="25%" />
<p class="caption">
(#fig:fig014)De la donnée au DataFrame
</p>
</div>
<p>Plusieurs fonctions de base de R fournissent des informations importantes sur un <em>DataFrame</em> :</p>
<ul>
<li><code>names</code> renvoie les noms des colonnes du <em>DataFrame</em>;</li>
<li><code>nrow</code> renvoie le nombre de lignes;</li>
<li><code>ncol</code> renvoie le nombre de colonnes.</li>
</ul>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="kw">names</span>(df)</span></code></pre></div>
<pre><code>## [1] &quot;age&quot;          &quot;taille&quot;       &quot;adresse&quot;      &quot;proprietaire&quot;</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="kw">nrow</span>(df)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="kw">ncol</span>(df)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>Vous pouvez accéder à chaque colonne de <em>df</em> en utilisant le symbole <code>$</code> ou <code>[["nom_de_la_colonne"]]</code>. Recalculons ainsi la moyenne des âges :</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="kw">mean</span>(df<span class="op">$</span>age)</span></code></pre></div>
<pre><code>## [1] 54</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="kw">mean</span>(df[[<span class="st">&quot;age&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 54</code></pre>
</div>
<div id="sect01365" class="section level4">
<h4><span class="header-section-number">1.3.6.5</span> Listes</h4>
<p>La dernière structure de données à connaître est la liste. Elle ressemble à un vecteur, au sens où elle permet de stocker un ensemble d’objets les uns à la suite des autres. Cependant, une liste peut contenir n’importe quel type d’objets. Vous pouvez ainsi construire des listes de matrices, des listes d’<em>arrays</em>, des listes mixant des vecteurs, des graphiques, des <em>DataFrames</em>, des listes de listes…</p>
<p>Créons ensemble une liste qui va contenir des vecteurs et des matrices à l’aide de la fonction <code>list.</code></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a>ma_liste &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb99-2"><a href="#cb99-2"></a>                 <span class="kw">matrix</span>(<span class="dv">1</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">nrow =</span> <span class="dv">5</span>),</span>
<span id="cb99-3"><a href="#cb99-3"></a>                 <span class="kw">matrix</span>(<span class="dv">5</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">nrow =</span> <span class="dv">7</span>),</span>
<span id="cb99-4"><a href="#cb99-4"></a>                 <span class="st">&#39;A&#39;</span></span>
<span id="cb99-5"><a href="#cb99-5"></a>                 )</span></code></pre></div>
<p>Il est possible d’accéder aux éléments de la liste par leur position dans cette dernière en utilisant les doubles crochets <code>[[ ]]</code> :</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="kw">print</span>(ma_liste[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] 1 2 3 4</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="kw">print</span>(ma_liste[[<span class="dv">4</span>]])</span></code></pre></div>
<pre><code>## [1] &quot;A&quot;</code></pre>
<p>Il est aussi possible de donner des noms aux éléments de la liste et d’utiliser le symbole <code>$</code> pour y accéder. Créons une nouvelle liste de vecteurs et donnons-leur des noms avec la fonction <code>names</code>.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a>liste2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">35</span>,<span class="dv">45</span>,<span class="dv">72</span>,<span class="dv">56</span>,<span class="dv">62</span>), </span>
<span id="cb104-2"><a href="#cb104-2"></a>               <span class="kw">c</span>(<span class="fl">175.5</span>,<span class="fl">180.3</span>,<span class="fl">168.2</span>,<span class="fl">172.8</span>,<span class="fl">167.6</span>),</span>
<span id="cb104-3"><a href="#cb104-3"></a>               <span class="kw">c</span>(<span class="ot">TRUE</span>,<span class="ot">TRUE</span>,<span class="ot">FALSE</span>,<span class="ot">TRUE</span>,<span class="ot">TRUE</span>)</span>
<span id="cb104-4"><a href="#cb104-4"></a>)</span>
<span id="cb104-5"><a href="#cb104-5"></a><span class="kw">names</span>(liste2) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>,<span class="st">&#39;taille&#39;</span>,<span class="st">&#39;proprietaire&#39;</span>)</span>
<span id="cb104-6"><a href="#cb104-6"></a></span>
<span id="cb104-7"><a href="#cb104-7"></a><span class="kw">print</span>(liste2<span class="op">$</span>age)</span></code></pre></div>
<pre><code>## [1] 35 45 72 56 62</code></pre>
<p>Si vous avez bien suivi, vous devriez avoir compris qu’un <em>DataFrame</em> n’est en fait rien d’autre qu’une liste de vecteurs avec des noms!</p>
<p>Bravo! Vous venez de faire le tour des bases du langage R. Vous allez apprendre désormais à manipuler des données dans des <em>DataFrames</em>!</p>
</div>
</div>
</div>
<div id="sect014" class="section level2">
<h2><span class="header-section-number">1.4</span> Manipulation de données</h2>
<p>Dans cette section, vous apprendrez à charger et à manipuler des <em>DataFrames</em> en vue d’effectuer des opérations classiques de gestion de données.</p>
<div id="sect0141" class="section level3">
<h3><span class="header-section-number">1.4.1</span> Chargement d’un <em>DataFrame</em> depuis un fichier</h3>
<p>Il est rarement nécessaire de créer vos <em>DataFrames</em> manuellement. Le plus souvent, vous disposerez de fichiers contenant vos données et utiliserez des fonctions pour les importer dans R sous forme d’un <em>DataFrame</em>. Les formats à importer les plus répandus sont :</p>
<ul>
<li><em>.csv</em>, soit un fichier texte dont chaque ligne représente une ligne du tableau de données et dont les colonnes sont séparées par un délimiteur (généralement une virgule ou un point-virgule);</li>
<li><em>.dbf</em>, ou fichier <em>dBase</em>, souvent associés à des fichiers d’information géographique au format <em>ShapeFile</em>;</li>
<li><em>.xls</em> et <em>.xlsx</em>, soit des fichiers générés par Excel;</li>
<li><em>.json</em>, soit un fichier texte utilisant la norme d’écriture propre au langage JavaScript.</li>
</ul>
<p>Plus rarement, il se peut que vous ayez à charger des fichiers provenant de logiciels propriétaires :</p>
<ul>
<li><em>.sas7bdat</em> (SAS);</li>
<li><em>.sav</em> (SPSS);</li>
<li><em>.dta</em> (STATA).</li>
</ul>
<p>Pour lire la plupart de ces fichiers, nous utilisons le <em>package</em> <code>foreign</code> dédié à l’importation d’une multitude de formats. Nous commençons donc par l’installer (<code>install.packages("foreign")</code>). Ensuite, nous chargeons cinq fois le même jeu de données enregistré dans des formats différents (<em>csv</em>, <em>dbf</em>, <em>dta</em>, <em>sas7bdat</em> et <em>xlsx</em>) et nous mesurons le temps nécessaire pour importer chacun de ces fichiers avec la fonction <code>Sys.time</code>.</p>
<div id="sect01411" class="section level4">
<h4><span class="header-section-number">1.4.1.1</span> Lecture d’un fichier <em>csv</em></h4>
<p>Pour le format <em>csv</em>, il n’est pas nécessaire d’utiliser un <em>package</em> puisque R dispose d’une fonction de base pour lire ce format.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb106-2"><a href="#cb106-2"></a>df1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/priseenmain/SR_MTL_2016.csv&quot;</span>, </span>
<span id="cb106-3"><a href="#cb106-3"></a>         <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="dt">dec =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb106-4"><a href="#cb106-4"></a>         <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb106-5"><a href="#cb106-5"></a>t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb106-6"><a href="#cb106-6"></a>d1 &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">difftime</span>(t2,t1,<span class="dt">units=</span><span class="st">&quot;secs&quot;</span>))</span>
<span id="cb106-7"><a href="#cb106-7"></a></span>
<span id="cb106-8"><a href="#cb106-8"></a><span class="kw">cat</span>(<span class="st">&quot;le DataFrame df1 a &quot;</span>,<span class="kw">nrow</span>(df1),<span class="st">&#39; observations&#39;</span>,</span>
<span id="cb106-9"><a href="#cb106-9"></a>    <span class="st">&#39;et &#39;</span>,<span class="kw">ncol</span>(df1),<span class="st">&quot;colonnes</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## le DataFrame df1 a  951  observations et  48 colonnes</code></pre>
<p>Rien de bien compliqué! Notez tout de même que :</p>
<ul>
<li>Lorsque vous chargez un fichier <em>csv</em>, vous devez connaître le <strong>délimiteur</strong> (ou <strong>séparateur</strong>), soit le caractère utilisé pour délimiter les colonnes. Dans le cas présent, il s’agit d’une virgule (spécifiez avec l’argument <code>sep = ","</code>), mais il pourrait tout aussi bien être un point virgule (<code>sep = ";"</code>), une tabulation (<code>sep = "    "</code>), etc.</li>
<li>Vous devez également spécifier le caractère utilisé comme séparateur de décimales. Le plus souvent, ce sera le point (<code>dec = "."</code>), mais certains logiciels avec des paramètres régionaux de langue française (notamment Excel) exportent des fichiers <em>csv</em> avec des virgules comme séparateur de décimales (utilisez alors <code>dec = ","</code>).</li>
<li>L’argument <code>header</code> indique si la première ligne (l’entête) du fichier comprend ou non les noms des colonnes du jeu de données (avec les valeurs <code>TRUE</code> ou <code>FALSE</code>). Il arrive que certains fichiers <em>csv</em> soient fournis sans entête et que le nom et la description des colonnes soient fournis dans un autre fichier.</li>
<li>L’argument <code>stringsAsFactors</code> permet d’indiquer à R que les colonnes comportant du texte doivent être chargées comme des vecteurs de type texte et non de type facteur.</li>
</ul>
</div>
<div id="sect01412" class="section level4">
<h4><span class="header-section-number">1.4.1.2</span> Lecture d’un fichier <em>dbase</em></h4>
<p>Pour lire un fichier <em>dbase</em> (.dbf), nous utilisons la fonction <code>read.dbf</code> du <em>package</em> <code>foreign</code> installé précédemment :</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="kw">library</span>(foreign)</span>
<span id="cb108-2"><a href="#cb108-2"></a></span>
<span id="cb108-3"><a href="#cb108-3"></a>t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb108-4"><a href="#cb108-4"></a>df2 &lt;-<span class="st"> </span><span class="kw">read.dbf</span>(<span class="st">&quot;data/priseenmain/SR_MTL_2016.dbf&quot;</span>)</span>
<span id="cb108-5"><a href="#cb108-5"></a>t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb108-6"><a href="#cb108-6"></a>d2 &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">difftime</span>(t2,t1,<span class="dt">units=</span><span class="st">&quot;secs&quot;</span>))</span>
<span id="cb108-7"><a href="#cb108-7"></a></span>
<span id="cb108-8"><a href="#cb108-8"></a><span class="kw">cat</span>(<span class="st">&quot;le DataFrame df2 a &quot;</span>,<span class="kw">nrow</span>(df2),<span class="st">&quot; observations&quot;</span>,</span>
<span id="cb108-9"><a href="#cb108-9"></a>    <span class="st">&quot;et &quot;</span>,<span class="kw">ncol</span>(df2),<span class="st">&quot; colonnes</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## le DataFrame df2 a  951  observations et  48  colonnes</code></pre>
<p>Comme vous pouvez le constater, nous obtenons les mêmes résultats qu’avec le fichier <em>csv</em>.</p>
</div>
<div id="sect01413" class="section level4">
<h4><span class="header-section-number">1.4.1.3</span> Lecture d’un fichier <em>dta</em> (Stata)</h4>
<p>Si vous travaillez avec des collègues utilisant le logiciel Stata, il se peut que ces derniers vous partagent des fichiers <em>dta</em>. Toujours en utilisant le <em>package</em> <code>foreign</code>, vous serez en mesure de les charger directement dans R.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb110-2"><a href="#cb110-2"></a>df3 &lt;-<span class="st"> </span><span class="kw">read.dta</span>(<span class="st">&quot;data/priseenmain/SR_MTL_2016.dta&quot;</span>)</span>
<span id="cb110-3"><a href="#cb110-3"></a>t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb110-4"><a href="#cb110-4"></a>d3 &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">difftime</span>(t2,t1,<span class="dt">units=</span><span class="st">&quot;secs&quot;</span>))</span>
<span id="cb110-5"><a href="#cb110-5"></a></span>
<span id="cb110-6"><a href="#cb110-6"></a><span class="kw">cat</span>(<span class="st">&quot;le DataFrame df3 a &quot;</span>,<span class="kw">nrow</span>(df3),<span class="st">&quot; observations &quot;</span>,</span>
<span id="cb110-7"><a href="#cb110-7"></a>    <span class="st">&quot;et &quot;</span>,<span class="kw">ncol</span>(df3),<span class="st">&quot;colonnes</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## le DataFrame df3 a 951 observations et 48colonnes</code></pre>
</div>
<div id="sect01414" class="section level4">
<h4><span class="header-section-number">1.4.1.4</span> Lecture d’un fichier <em>sav</em> (SPSS)</h4>
<p>Pour importer un fichier <em>sav</em> provenant du logiciel statistique SPSS, utilisez la fonction <code>read.spss</code> du <em>package</em> <code>foreign</code>.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a>t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb112-2"><a href="#cb112-2"></a>df4 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">read.spss</span>(<span class="st">&quot;data/priseenmain/SR_MTL_2016.sav&quot;</span>))</span>
<span id="cb112-3"><a href="#cb112-3"></a>t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb112-4"><a href="#cb112-4"></a>d4 &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">difftime</span>(t2,t1,<span class="dt">units=</span><span class="st">&quot;secs&quot;</span>))</span>
<span id="cb112-5"><a href="#cb112-5"></a></span>
<span id="cb112-6"><a href="#cb112-6"></a><span class="kw">cat</span>(<span class="st">&quot;le DataFrame df4 a &quot;</span>,<span class="kw">nrow</span>(df4),<span class="st">&quot; observations &quot;</span>,</span>
<span id="cb112-7"><a href="#cb112-7"></a>    <span class="st">&quot;et &quot;</span>,<span class="kw">ncol</span>(df4),<span class="st">&quot;colonnes</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## le DataFrame df4 a 951 observations et 48colonnes</code></pre>
</div>
<div id="sect01415" class="section level4">
<h4><span class="header-section-number">1.4.1.5</span> Lecture d’un fichier <em>sas7bdat</em> (SAS)</h4>
<p>Pour importer un fichier <em>sas7bdat</em> provenant du logiciel statistique SAS, utilisez la fonction <code>read.sas7bdat</code> du <em>package</em> <code>sas7bdat</code>. Installez préalablement le <em>package</em> (<code>install.packages("sas7bdat")</code>) et chargez-le (<code>library(sas7bdat)</code>).</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a><span class="kw">library</span>(sas7bdat)</span>
<span id="cb114-2"><a href="#cb114-2"></a></span>
<span id="cb114-3"><a href="#cb114-3"></a>t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb114-4"><a href="#cb114-4"></a>df5 &lt;-<span class="st"> </span><span class="kw">read.sas7bdat</span>(<span class="st">&quot;data/priseenmain/SR_MTL_2016.sas7bdat&quot;</span>)</span>
<span id="cb114-5"><a href="#cb114-5"></a>t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb114-6"><a href="#cb114-6"></a>d5 &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">difftime</span>(t2,t1,<span class="dt">units=</span><span class="st">&quot;secs&quot;</span>))</span>
<span id="cb114-7"><a href="#cb114-7"></a></span>
<span id="cb114-8"><a href="#cb114-8"></a><span class="kw">cat</span>(<span class="st">&quot;le DataFrame df5 a &quot;</span>,<span class="kw">nrow</span>(df5),<span class="st">&quot; observations &quot;</span>,</span>
<span id="cb114-9"><a href="#cb114-9"></a>    <span class="st">&quot;et &quot;</span>,<span class="kw">ncol</span>(df5),<span class="st">&quot; colonnes</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## le DataFrame df5 a 951 observations et 48 colonnes</code></pre>
</div>
<div id="sect01416" class="section level4">
<h4><span class="header-section-number">1.4.1.6</span> Lecture d’un fichier <em>xlsx</em> (Excel)</h4>
<p>Lire un fichier Excel dans R n’est pas toujours une tâche facile. Généralement, nous recommandons d’exporter le fichier en question au format <em>csv</em> dans un premier temps, puis de le lire avec la fonction <code>read.csv</code> dans un second temps (section @ref(sect01411)).</p>
<p>Il est néanmoins possible de lire directement un fichier <em>xlsx</em> avec le <em>package</em> <code>xlsx</code>. Ce dernier requiert que le logiciel JAVA soit installé sur votre ordinateur (Windows, Mac ou Linux). Si vous utilisez la version 64 bit de R, vous devrez télécharger et installer la version 64 bit de JAVA. Une fois que ce logiciel tiers est installé, il ne vous restera plus qu’à installer (<code>install.packages("xlsx")</code>) et charger (<code>library(xlsx)</code>) le <em>package</em> <code>xlsx</code>. Sous windows, il est possible que vous deviez également installer manuellement le <em>package</em> <code>rJava</code> et indiquer à R où se trouve JAVA sur votre ordinateur. La procédure est détaillée <a href="https://cimentadaj.github.io/blog/2018-05-25-installing-rjava-on-windows-10/installing-rjava-on-windows-10/">ici</a>.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="kw">library</span>(xlsx)</span>
<span id="cb116-2"><a href="#cb116-2"></a></span>
<span id="cb116-3"><a href="#cb116-3"></a>t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb116-4"><a href="#cb116-4"></a>df6 &lt;-<span class="st"> </span><span class="kw">read.xlsx</span>(<span class="dt">file=</span><span class="st">&quot;data/priseenmain/SR_MTL_2016.xlsx&quot;</span>,</span>
<span id="cb116-5"><a href="#cb116-5"></a>                 <span class="dt">sheetIndex =</span> <span class="dv">1</span>,</span>
<span id="cb116-6"><a href="#cb116-6"></a>                 <span class="dt">as.data.frame =</span> <span class="ot">TRUE</span>)</span>
<span id="cb116-7"><a href="#cb116-7"></a>t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb116-8"><a href="#cb116-8"></a>d6 &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">difftime</span>(t2,t1,<span class="dt">units=</span><span class="st">&quot;secs&quot;</span>))</span>
<span id="cb116-9"><a href="#cb116-9"></a></span>
<span id="cb116-10"><a href="#cb116-10"></a><span class="kw">cat</span>(<span class="st">&quot;le DataFrame df6 a &quot;</span>,<span class="kw">nrow</span>(df6),<span class="st">&quot; observations &quot;</span>,</span>
<span id="cb116-11"><a href="#cb116-11"></a>    <span class="st">&quot;et &quot;</span>,<span class="kw">ncol</span>(df6),<span class="st">&quot; colonnes</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## le DataFrame df6 a 951 observations et 48 colonnes</code></pre>
<p>Il est possible d’accélérer significativement la vitesse de lecture d’un fichier <em>xlsx</em> en utilisant la fonction <code>read.xlsx2</code>. Il faut cependant indiquer à cette dernière le type de données de chaque colonne. Dans le cas présent, les cinq premières colonnes contiennent des données de type texte (<code>character</code>), alors que les 43 autres sont des données numériques (<code>numeric</code>). Nous utilisons la fonction <code>rep</code> afin de ne pas avoir à écrire plusieurs fois <em>character</em> et <em>numeric</em>.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="kw">library</span>(xlsx)</span>
<span id="cb118-2"><a href="#cb118-2"></a></span>
<span id="cb118-3"><a href="#cb118-3"></a>t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb118-4"><a href="#cb118-4"></a>df7 &lt;-<span class="st"> </span><span class="kw">read.xlsx2</span>(<span class="dt">file=</span><span class="st">&quot;data/priseenmain/SR_MTL_2016.xlsx&quot;</span>,</span>
<span id="cb118-5"><a href="#cb118-5"></a>                  <span class="dt">sheetIndex =</span> <span class="dv">1</span>, </span>
<span id="cb118-6"><a href="#cb118-6"></a>                  <span class="dt">as.data.frame =</span> <span class="ot">TRUE</span>,</span>
<span id="cb118-7"><a href="#cb118-7"></a>                  <span class="dt">colClasses =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;character&quot;</span>,<span class="dv">5</span>),<span class="kw">rep</span>(<span class="st">&quot;numeric&quot;</span>,<span class="dv">43</span>))</span>
<span id="cb118-8"><a href="#cb118-8"></a>                  )</span>
<span id="cb118-9"><a href="#cb118-9"></a>t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</span>
<span id="cb118-10"><a href="#cb118-10"></a>d7 &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">difftime</span>(t2,t1,<span class="dt">units=</span><span class="st">&quot;secs&quot;</span>))</span>
<span id="cb118-11"><a href="#cb118-11"></a></span>
<span id="cb118-12"><a href="#cb118-12"></a><span class="kw">cat</span>(<span class="st">&quot;le DataFrame df6 a &quot;</span>,<span class="kw">nrow</span>(df7),<span class="st">&quot; observations &quot;</span>,</span>
<span id="cb118-13"><a href="#cb118-13"></a>    <span class="st">&quot;et &quot;</span>,<span class="kw">ncol</span>(df7),<span class="st">&quot;colonnes</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## le DataFrame df6 a 951 observations et 48colonnes</code></pre>
<p>Si nous comparons les temps d’exécution (tableau @ref(tab:tableduration)), nous constatons que la lecture des fichiers <em>xlsx</em> peut être extrêmement longue si nous ne spécifions pas le type des colonnes, ce qui peut devenir problématique pour des fichiers volumineux. Notez également que la lecture d’un fichier <em>csv</em> devient de plus en plus laborieuse à mesure que sa taille augmente. Si vous devez un jour charger des fichiers <em>csv</em> de plusieurs gigaoctets, nous vous recommandons vivement d’utiliser la fonction <code>fread</code> du <em>package</em> <code>data.table</code> qui est beaucoup plus rapide.</p>
<table>
<caption>
(#tab:tableduration)Temps nécessaire pour lire les données en fonction du type de fichiers
</caption>
<thead>
<tr>
<th style="text-align:right;">
Durée (secondes)
</th>
<th style="text-align:left;">
Fonction
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0,03
</td>
<td style="text-align:left;">
read.csv
</td>
</tr>
<tr>
<td style="text-align:right;">
0,04
</td>
<td style="text-align:left;">
read.dbf
</td>
</tr>
<tr>
<td style="text-align:right;">
0,01
</td>
<td style="text-align:left;">
read.spss
</td>
</tr>
<tr>
<td style="text-align:right;">
0,01
</td>
<td style="text-align:left;">
read.dta
</td>
</tr>
<tr>
<td style="text-align:right;">
0,98
</td>
<td style="text-align:left;">
read.sas7bdat
</td>
</tr>
<tr>
<td style="text-align:right;">
19,34
</td>
<td style="text-align:left;">
read.xlsx
</td>
</tr>
<tr>
<td style="text-align:right;">
0,47
</td>
<td style="text-align:left;">
read.xlsx2
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="sect0142" class="section level3">
<h3><span class="header-section-number">1.4.2</span> Manipulation d’un <em>DataFrame</em></h3>
<p>Une fois le <em>DataFrame</em> chargé, voyons comment il est possible de le manipuler.</p>
<div id="sect01421" class="section level4">
<h4><span class="header-section-number">1.4.2.1</span> Petit mot sur le <code>tidyverse</code></h4>
<p><code>tidyverse</code> est un ensemble de <em>packages</em> conçus pour faciliter la structuration et la manipulation des données dans R. Avant d’aller plus loin, il est important d’aborder brièvement un débat actuel dans la Communauté R. Entre 2010 et 2020, l’utilisation du <code>tidyverse</code> s’est peu à peu répandue. Développé et maintenu par Hadley Wickham, <code>tidyverse</code> introduit une philosophie et une grammaire spécifiques qui diffèrent du langage R traditionnel. Une partie de la communauté a pour ainsi dire complètement embrassé le <code>tidyverse</code> et de nombreux <em>packages</em>, en dehors du <code>tidyverse</code>, ont adopté sa grammaire et sa philosophie. À l’inverse, une autre partie de la communauté est contre cette évolution (<a href="https://blog.ephorie.de/why-i-dont-use-the-tidyverse" target="_blank">voir l’article du blogue suivant</a>). Les arguments pour et contre <code>tidyverse</code> sont résumés dans le tableau suivant.</p>
<table>
<caption>
(#tab:tableTidyverse)Avantages et inconvénients du tidyverse
</caption>
<thead>
<tr>
<th style="text-align:left;">
Avantage du tidyverse
</th>
<th style="text-align:left;">
Problème posé par le tidyverse
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Simplicité d’écriture et d’apprentissage
</td>
<td style="text-align:left;">
Nouvelle syntaxe à apprendre
</td>
</tr>
<tr>
<td style="text-align:left;">
Ajout de l’opérateur <code>%&gt;%</code> permettant d’enchaîner les traitements
</td>
<td style="text-align:left;">
Perte de lisibilité avec l’opérateur <code>-&gt;</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
La meilleure librairie pour réaliser des graphiques : <code>ggplot2</code>
</td>
<td style="text-align:left;">
Remplacement de certaines fonctions de base par d’autres provenant du <code>tidyverse</code> lors de son chargement, pouvant créer des erreurs.
</td>
</tr>
<tr>
<td style="text-align:left;">
Crée un écosystème cohérent
</td>
<td style="text-align:left;">
Ajout d’une dépendance dans le code
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Package</em> en développement et de plus en plus utilisé
</td>
<td style="text-align:left;">
Philosophie d’évolution agressive, aucune assurance de rétrocompatibilité
</td>
</tr>
</tbody>
</table>
<p>Le dernier point est probablement le plus problématique. Dans sa volonté d’évoluer au mieux et sans restriction, le <em>package</em> <code>tidyverse</code> n’offre aucune garantie de rétrocompatibilité. En d’autre termes, des changements importants peuvent être introduits d’une version à l’autre rendant potentiellement obsolète votre ancien code. Nous n’avons pas d’opinion tranchée sur le sujet : <code>tidyverse</code> est un outil très intéressant dans de nombreux cas; nous évitons simplement de l’utiliser systématiquement et préférons charger directement des sous-<em>packages</em> (comme <code>dplyr</code> ou <code>ggplot2</code>) du <code>tidyverse</code>. Notez que le <em>package</em> <code>data.table</code> offre une alternative au <code>tidyverse</code> dans la manipulation de données. Au prix d’une syntaxe généralement un peu plus complexe, le package <code>data.table</code> offre une vitesse de calcul bien supérieure au <code>tidyverse</code> et assure une bonne rétrocompatibilité.</p>
</div>
<div id="sect01422" class="section level4">
<h4><span class="header-section-number">1.4.2.2</span> Gestion des colonnes d’un <em>DataFrame</em></h4>
<p>Repartons du <em>DataFrame</em> que nous avions chargé précédemment en important un fichier <em>csv</em>.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a>df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file=</span><span class="st">&quot;data/priseenmain/SR_MTL_2016.csv&quot;</span>, </span>
<span id="cb120-2"><a href="#cb120-2"></a>               <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="dt">dec =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb120-3"><a href="#cb120-3"></a>               <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="sect014221" class="section level5">
<h5><span class="header-section-number">1.4.2.2.1</span> Sélection d’une colonne</h5>
<p>Rappelons qu’il est possible d’accéder aux colonnes dans ce <em>DataFrame</em> en utilisant le symbole dollar <code>$ma_colonne</code> ou les doubles crochets <code>[["ma_colonne"]]</code>.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="co"># Calcul de la superficie totale de l&#39;Île de Montréal</span></span>
<span id="cb121-2"><a href="#cb121-2"></a><span class="kw">sum</span>(df<span class="op">$</span>KM2)</span></code></pre></div>
<pre><code>## [1] 4680.543</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="kw">sum</span>(df[[<span class="st">&quot;KM2&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 4680.543</code></pre>
</div>
<div id="sect014222" class="section level5">
<h5><span class="header-section-number">1.4.2.2.2</span> Sélection de plusieurs colonnes</h5>
<p>Il est possible de sélectionner plusieurs colonnes d’un <em>DataFrame</em> et de filtrer ainsi les colonnes inutiles. Pour cela, nous pouvons utiliser un vecteur contenant soit les positions des colonnes (1 pour la première colonne, 2 pour la seconde et ainsi de suite), soit les noms des colonnes.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="co"># Conserver les 5 premières colonnes</span></span>
<span id="cb125-2"><a href="#cb125-2"></a>df2 &lt;-<span class="st"> </span>df[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb125-3"><a href="#cb125-3"></a></span>
<span id="cb125-4"><a href="#cb125-4"></a><span class="co"># Conserver les colonnes 1, 5, 10 et 15</span></span>
<span id="cb125-5"><a href="#cb125-5"></a>df3 &lt;-<span class="st"> </span>df[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>)]</span>
<span id="cb125-6"><a href="#cb125-6"></a></span>
<span id="cb125-7"><a href="#cb125-7"></a><span class="co"># Cela peut aussi être utilisé pour changer l&#39;ordre des champs</span></span>
<span id="cb125-8"><a href="#cb125-8"></a>df3 &lt;-<span class="st"> </span>df[<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">1</span>,<span class="dv">5</span>)]</span>
<span id="cb125-9"><a href="#cb125-9"></a></span>
<span id="cb125-10"><a href="#cb125-10"></a><span class="co"># Conserver les colonnes 1 à 5, 7 à 12, 17 et 22</span></span>
<span id="cb125-11"><a href="#cb125-11"></a>df4 &lt;-<span class="st"> </span>df[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">7</span><span class="op">:</span><span class="dv">12</span>,<span class="dv">17</span>,<span class="dv">22</span>)]</span>
<span id="cb125-12"><a href="#cb125-12"></a></span>
<span id="cb125-13"><a href="#cb125-13"></a><span class="co"># Conserver les colonnes avec leurs noms</span></span>
<span id="cb125-14"><a href="#cb125-14"></a>df5 &lt;-<span class="st"> </span>df[<span class="kw">c</span>(<span class="st">&quot;SRIDU&quot;</span>,<span class="st">&quot;KM2&quot;</span>,<span class="st">&quot;Pop2016&quot;</span>,<span class="st">&quot;MaisonIndi&quot;</span>,<span class="st">&quot;LoyerMed&quot;</span>)]</span></code></pre></div>
</div>
<div id="sect014223" class="section level5">
<h5><span class="header-section-number">1.4.2.2.3</span> Suppression de colonnes</h5>
<p>Il est parfois plus intéressant et rapide de supprimer directement des colonnes plutôt que de recréer un nouveau <em>DataFrame</em>. Pour ce faire, nous attribuons la valeur <code>NULL</code> à ces colonnes.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a><span class="co"># Supprimer le colonnes 2, 3 et 5</span></span>
<span id="cb126-2"><a href="#cb126-2"></a>df3[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span>
<span id="cb126-3"><a href="#cb126-3"></a></span>
<span id="cb126-4"><a href="#cb126-4"></a><span class="co"># Supprimer une colonne avec son nom</span></span>
<span id="cb126-5"><a href="#cb126-5"></a>df4<span class="op">$</span>OID &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb126-6"><a href="#cb126-6"></a></span>
<span id="cb126-7"><a href="#cb126-7"></a><span class="co"># Supprimer plusieurs colonnes par leur nom</span></span>
<span id="cb126-8"><a href="#cb126-8"></a>df5[<span class="kw">c</span>(<span class="st">&quot;SRIDU&quot;</span>,<span class="st">&quot;LoyerMed&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>)</span></code></pre></div>
<p>Notez que si vous supprimez une colonne, vous ne pouvez pas revenir en arrière. Il faudra recharger votre jeu de données ou éventuellement relancer les calculs qui avaient produit cette colonne.</p>
</div>
<div id="sect014224" class="section level5">
<h5><span class="header-section-number">1.4.2.2.4</span> Modification du nom des colonnes</h5>
<p>Il est possible de changer le nom d’une colonne. Cette opération est importante pour faciliter la lecture du <em>DataFrame</em> ou encore s’assurer que l’exportation du <em>DataFrame</em> dans un format particulier (tel que <em>.dbf</em> qui ne supporte que les noms de colonnes avec moins de 10 caractères) ne posera pas de problème.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="co"># Voici les noms des colonnes</span></span>
<span id="cb127-2"><a href="#cb127-2"></a><span class="kw">names</span>(df5)</span></code></pre></div>
<pre><code>## [1] &quot;KM2&quot;        &quot;Pop2016&quot;    &quot;MaisonIndi&quot;</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="co"># Renommer toutes les colonnes</span></span>
<span id="cb129-2"><a href="#cb129-2"></a><span class="kw">names</span>(df5) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;superficie_km2&#39;</span>,<span class="st">&#39;population_2016&#39;</span>, <span class="st">&#39;maison_individuelle_prt&#39;</span>)</span>
<span id="cb129-3"><a href="#cb129-3"></a><span class="kw">names</span>(df5)</span></code></pre></div>
<pre><code>## [1] &quot;superficie_km2&quot;          &quot;population_2016&quot;        
## [3] &quot;maison_individuelle_prt&quot;</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a><span class="co"># Renommer avec dplyr</span></span>
<span id="cb131-2"><a href="#cb131-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb131-3"><a href="#cb131-3"></a>df4 &lt;-<span class="st"> </span><span class="kw">rename</span>(df4, <span class="st">&quot;population_2016&quot;</span> =<span class="st"> &quot;Pop2016&quot;</span>,</span>
<span id="cb131-4"><a href="#cb131-4"></a>              <span class="st">&quot;prs_moins_14ans_prt&quot;</span> =<span class="st"> &quot;A014&quot;</span>,</span>
<span id="cb131-5"><a href="#cb131-5"></a>              <span class="st">&quot;prs_15_64_ans_prt&quot;</span> =<span class="st"> &quot;A1564&quot;</span>,</span>
<span id="cb131-6"><a href="#cb131-6"></a>              <span class="st">&quot;prs_65plus_ans_prt&quot;</span> =<span class="st"> &quot;A65plus&quot;</span></span>
<span id="cb131-7"><a href="#cb131-7"></a>              )</span></code></pre></div>
</div>
</div>
<div id="sect01423" class="section level4">
<h4><span class="header-section-number">1.4.2.3</span> Calcul de nouvelles variables</h4>
<p>Il est possible d’utiliser les colonnes de type numérique pour calculer de nouvelles colonnes en utilisant les opérateurs mathématiques vus dans la section @ref(sect0135). Prenons un exemple concret : calculons la densité de population par secteur de recensement dans notre <em>DataFrame</em>, puis affichons un résumé de cette nouvelle variable.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a><span class="co"># Calcul de la densité</span></span>
<span id="cb132-2"><a href="#cb132-2"></a>df<span class="op">$</span>pop_density_<span class="dv">2016</span> &lt;-<span class="st"> </span>df<span class="op">$</span>Pop2016 <span class="op">/</span><span class="st"> </span>df<span class="op">$</span>KM2</span>
<span id="cb132-3"><a href="#cb132-3"></a></span>
<span id="cb132-4"><a href="#cb132-4"></a><span class="co"># Statistiques descriptives</span></span>
<span id="cb132-5"><a href="#cb132-5"></a><span class="kw">summary</span>(df<span class="op">$</span>pop_density_<span class="dv">2016</span>)</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
##    17.45  1946.96  3700.50  5465.03  7918.39 48811.79</code></pre>
<p>Nous pouvons aussi calculer le ratio entre le nombre de maisons et le nombre d’appartements.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="co"># Calcul du ratio</span></span>
<span id="cb134-2"><a href="#cb134-2"></a>df<span class="op">$</span>total_maison &lt;-<span class="st"> </span>(df<span class="op">$</span>MaisonIndi <span class="op">+</span><span class="st"> </span>df<span class="op">$</span>MaisJumule <span class="op">+</span><span class="st"> </span>df<span class="op">$</span>MaisRangee <span class="op">+</span><span class="st"> </span>df<span class="op">$</span>AutreMais)</span>
<span id="cb134-3"><a href="#cb134-3"></a>df<span class="op">$</span>total_apt &lt;-<span class="st"> </span>(df<span class="op">$</span>AppDuplex <span class="op">+</span><span class="st"> </span>df<span class="op">$</span>App5Moins <span class="op">+</span><span class="st"> </span>df<span class="op">$</span>App5Plus)</span>
<span id="cb134-4"><a href="#cb134-4"></a>df<span class="op">$</span>ratio_maison_apt &lt;-<span class="st"> </span>df<span class="op">$</span>total_maison <span class="op">/</span><span class="st"> </span>df<span class="op">$</span>total_apt</span></code></pre></div>
<p>Retenez ici que R applique le calcul à chaque ligne de votre jeu de données et stocke le résultat dans une nouvelle colonne. Cette opération est du calcul vectoriel : toute la colonne est calculée en une seule fois. R est d’ailleurs optimisé pour le calcul vectoriel.</p>
</div>
<div id="sect01424" class="section level4">
<h4><span class="header-section-number">1.4.2.4</span> Fonctions mathématiques</h4>
<p>R propose un ensemble de fonctions de base pour effectuer du calcul. Voici une liste non exhaustive des principales fonctions :</p>
<ul>
<li><code>abs</code> calcule la valeur absolue de chaque valeur d’un vecteur;</li>
<li><code>sqrt</code> calcule la racine carrée de chaque valeur d’un vecteur;</li>
<li><code>log</code> calcule le logarithme de chaque valeur d’un vecteur;</li>
<li><code>exp</code> calcule l’exponentielle de chaque valeur d’un vecteur;</li>
<li><code>factorial</code> calcule la factorielle de chaque valeur d’un vecteur;</li>
<li><code>round</code> arrondit la valeur d’un vecteur;</li>
<li><code>ceiling</code>, <code>floor</code> arrondit à l’unité supérieure ou inférieure de chaque valeur d’un vecteur;</li>
<li><code>sin</code>, <code>asin</code>, <code>cos</code>, <code>acos</code>, <code>tan</code>, <code>atan</code> sont des fonctions de trigonométrie;</li>
<li><code>cumsum</code> calcule la somme cumulative des valeurs d’un vecteur.</li>
</ul>
<p>Ces fonctions sont des fonctions vectorielles puisqu’elles s’appliquent à tous les éléments d’un vecteur. Si votre vecteur en entrée comprend cinq valeurs, le vecteur en sortie comprendra aussi cinq valeurs.</p>
<p>À l’inverse, les fonctions suivantes s’appliquent directement à l’ensemble d’un vecteur et ne vont renvoyer qu’une seule valeur :</p>
<ul>
<li><code>sum</code> calcule la somme des valeurs d’un vecteur;</li>
<li><code>prod</code> calcule le produit des valeurs d’un vecteur;</li>
<li><code>min</code>, <code>max</code> renvoient les valeurs maximale et minimale d’un vecteur;</li>
<li><code>mean</code>, <code>median</code> renvoient la moyenne et la médiane d’un vecteur;</li>
<li><code>quantile</code> renvoie les percentiles d’un vecteur.</li>
</ul>
</div>
<div id="sect01425" class="section level4">
<h4><span class="header-section-number">1.4.2.5</span> Fonctions pour manipuler des chaînes de caractères</h4>
<p>Outre les données numériques, vous aurez à travailler avec des données de type texte (<code>string</code>). Le <code>tidyverse</code> avec le <em>package</em> <code>stringr</code> offre des fonctions très intéressantes pour manipuler ce type de données. Pour un aperçu de toutes les fonctions offertes par <code>stringr</code>, référez-vous à sa <a href="https://github.com/rstudio/cheatsheets/blob/master/strings.pdf" target="_blank"><em>Cheat Sheet</em></a>. Commençons avec un <em>DataFrame</em> assez simple comprenant des adresses et des noms de personnes.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a><span class="kw">library</span>(stringr)</span>
<span id="cb135-2"><a href="#cb135-2"></a></span>
<span id="cb135-3"><a href="#cb135-3"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb135-4"><a href="#cb135-4"></a>  <span class="dt">noms =</span> <span class="kw">c</span>(<span class="st">&quot;Jérémy Toutanplace&quot;</span>,<span class="st">&quot;constant Tinople&quot;</span>,<span class="st">&quot;dino Resto&quot;</span>,<span class="st">&quot;Luce tancil&quot;</span>),</span>
<span id="cb135-5"><a href="#cb135-5"></a>  <span class="dt">adresses =</span> <span class="kw">c</span>(<span class="st">&#39;15 rue Levy&#39;</span>, <span class="st">&#39;413 Blvd Saint-Laurent&#39;</span>, <span class="st">&#39;3606 rue Duké&#39;</span>, <span class="st">&#39;2457 route St Marys&#39;</span>)</span>
<span id="cb135-6"><a href="#cb135-6"></a>)</span></code></pre></div>
<div id="sect014251" class="section level5">
<h5><span class="header-section-number">1.4.2.5.1</span> Majuscules et minuscules</h5>
<p>Pour harmoniser ce <em>DataFrame</em>, nous mettons, dans un premier temps, des majuscules à la première lettre des prénoms et des noms des individus avec la fonction <code>str_to_title</code>.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a>df<span class="op">$</span>noms_corr &lt;-<span class="st"> </span><span class="kw">str_to_title</span>(df<span class="op">$</span>noms)</span>
<span id="cb136-2"><a href="#cb136-2"></a><span class="kw">print</span>(df<span class="op">$</span>noms_corr)</span></code></pre></div>
<pre><code>## [1] &quot;Jérémy Toutanplace&quot; &quot;Constant Tinople&quot;   &quot;Dino Resto&quot;        
## [4] &quot;Luce Tancil&quot;</code></pre>
<p>Nous pourrions également tout mettre en minuscules ou tout en majuscules.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a>df<span class="op">$</span>noms_min &lt;-<span class="st"> </span><span class="kw">tolower</span>(df<span class="op">$</span>noms)</span>
<span id="cb138-2"><a href="#cb138-2"></a>df<span class="op">$</span>noms_maj &lt;-<span class="st"> </span><span class="kw">toupper</span>(df<span class="op">$</span>noms)</span>
<span id="cb138-3"><a href="#cb138-3"></a><span class="kw">print</span>(df<span class="op">$</span>noms_min)</span></code></pre></div>
<pre><code>## [1] &quot;jérémy toutanplace&quot; &quot;constant tinople&quot;   &quot;dino resto&quot;        
## [4] &quot;luce tancil&quot;</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="kw">print</span>(df<span class="op">$</span>noms_maj)</span></code></pre></div>
<pre><code>## [1] &quot;JÉRÉMY TOUTANPLACE&quot; &quot;CONSTANT TINOPLE&quot;   &quot;DINO RESTO&quot;        
## [4] &quot;LUCE TANCIL&quot;</code></pre>
</div>
<div id="sect014252" class="section level5">
<h5><span class="header-section-number">1.4.2.5.2</span> Remplacement du texte</h5>
<p>Les adresses comprennent des caractères accentués. Ce type de caractères cause régulièrement des problèmes d’encodage. Nous pourrions alors décider de les remplacer par des caractères simples avec la fonction <code>str_replace_all</code>.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a>df<span class="op">$</span>adresses_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(df<span class="op">$</span>adresses,<span class="st">&#39;é&#39;</span>,<span class="st">&#39;e&#39;</span>)</span>
<span id="cb142-2"><a href="#cb142-2"></a><span class="kw">print</span>(df<span class="op">$</span>adresses_<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;15 rue Levy&quot;            &quot;413 Blvd Saint-Laurent&quot; &quot;3606 rue Duke&quot;         
## [4] &quot;2457 route St Marys&quot;</code></pre>
<p>La même fonction peut être utilisée pour remplacer les <em>St</em> par <em>Saint</em> et les <em>Blvd</em> par <em>Boulevard</em>.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a>df<span class="op">$</span>adresses_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(df<span class="op">$</span>adresses_<span class="dv">1</span>,<span class="st">&#39; St &#39;</span>,<span class="st">&#39; Saint &#39;</span>)</span>
<span id="cb144-2"><a href="#cb144-2"></a>df<span class="op">$</span>adresses_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(df<span class="op">$</span>adresses_<span class="dv">2</span>,<span class="st">&#39; Blvd &#39;</span>,<span class="st">&#39; Boulevard &#39;</span>)</span>
<span id="cb144-3"><a href="#cb144-3"></a><span class="kw">print</span>(df<span class="op">$</span>adresses_<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] &quot;15 rue Levy&quot;                 &quot;413 Boulevard Saint-Laurent&quot;
## [3] &quot;3606 rue Duke&quot;               &quot;2457 route Saint Marys&quot;</code></pre>
</div>
<div id="sect014253" class="section level5">
<h5><span class="header-section-number">1.4.2.5.3</span> Découpage du texte</h5>
<p>Il est parfois nécessaire de découper du texte pour en extraire des éléments. Nous devons alors choisir un caractère de découpage. Dans notre exemple, nous pourrions vouloir extraire les numéros civiques des adresses en sélectionnant le premier espace comme caractère de découpage, et en utilisant la fonction <code>str_split_fixed</code>.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a>df<span class="op">$</span>num_civique &lt;-<span class="st"> </span><span class="kw">str_split_fixed</span>(df<span class="op">$</span>adresses_<span class="dv">3</span>, <span class="st">&#39; &#39;</span>,<span class="dt">n=</span><span class="dv">2</span>)[,<span class="dv">1</span>]</span>
<span id="cb146-2"><a href="#cb146-2"></a><span class="kw">print</span>(df<span class="op">$</span>num_civique)</span></code></pre></div>
<pre><code>## [1] &quot;15&quot;   &quot;413&quot;  &quot;3606&quot; &quot;2457&quot;</code></pre>
<p>Pour être exact, sachez que pour notre exemple, la fonction <code>str_split_fixed</code> renvoie deux colonnes de texte : une avec le texte avant le premier espace, soit le numéro civique, et une avec le reste du texte. Le nombre de colonnes est contrôlé par l’argument <code>n</code>. Si <code>n = 1</code>, la fonction ne fait aucun découpage; avec <code>n = 2</code> la fonction découpe en deux parties le texte avec la première occurrence du délimiteur et ainsi de suite. En ajoutant <code>[,1]</code> à la fin, nous indiquons que nous souhaitons garder seulement la première des deux colonnes.</p>
<p>Il est également possible d’extraire des parties de texte et de ne garder par exemple que les <em>N</em> premiers caractères ou les <em>N</em> derniers caractères :</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a><span class="co"># Ne garder que les 5 premiers caractères</span></span>
<span id="cb148-2"><a href="#cb148-2"></a><span class="kw">substr</span>(df<span class="op">$</span>adresses_<span class="dv">3</span>,<span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">stop =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;15 ru&quot; &quot;413 B&quot; &quot;3606 &quot; &quot;2457 &quot;</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1"></a><span class="co"># Ne garder que les 5 derniers caractères</span></span>
<span id="cb150-2"><a href="#cb150-2"></a>n_caract &lt;-<span class="st"> </span><span class="kw">nchar</span>(df<span class="op">$</span>adresses_<span class="dv">3</span>)</span>
<span id="cb150-3"><a href="#cb150-3"></a><span class="kw">substr</span>(df<span class="op">$</span>adresses_<span class="dv">3</span>, <span class="dt">start =</span> n_caract<span class="dv">-4</span>, <span class="dt">stop =</span> n_caract)</span></code></pre></div>
<pre><code>## [1] &quot; Levy&quot; &quot;urent&quot; &quot; Duke&quot; &quot;Marys&quot;</code></pre>
<p>Notez que les paramètres <code>start</code> et <code>stop</code> de la fonction <code>substr</code> peuvent accepter un vecteur de valeurs. Il est ainsi possible d’appliquer une sélection de texte différente à chaque chaîne de caractères dans notre vecteur en entrée. Nous pourrions par exemple vouloir récupérer tout le texte avant le second espace pour garder uniquement le numéro civique et le type de rue.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a><span class="co"># Étape 1 : récupérer les positions des espaces pour chaque adresses</span></span>
<span id="cb152-2"><a href="#cb152-2"></a>positions &lt;-<span class="st"> </span><span class="kw">str_locate_all</span>(df<span class="op">$</span>adresses_<span class="dv">3</span>, <span class="st">&quot; &quot;</span>)</span>
<span id="cb152-3"><a href="#cb152-3"></a></span>
<span id="cb152-4"><a href="#cb152-4"></a><span class="co"># Étape 2 : récupérer les positions des seconds espaces</span></span>
<span id="cb152-5"><a href="#cb152-5"></a>sec_positions &lt;-<span class="st"> </span><span class="kw">sapply</span>(positions, <span class="cf">function</span>(i){</span>
<span id="cb152-6"><a href="#cb152-6"></a>  i[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb152-7"><a href="#cb152-7"></a>})</span>
<span id="cb152-8"><a href="#cb152-8"></a></span>
<span id="cb152-9"><a href="#cb152-9"></a><span class="co"># Étape 3 : appliquer le découpage</span></span>
<span id="cb152-10"><a href="#cb152-10"></a><span class="kw">substr</span>(df<span class="op">$</span>adresses_<span class="dv">3</span>, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">stop =</span> sec_positions<span class="dv">-1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;15 rue&quot;        &quot;413 Boulevard&quot; &quot;3606 rue&quot;      &quot;2457 route&quot;</code></pre>
</div>
<div id="sect014254" class="section level5">
<h5><span class="header-section-number">1.4.2.5.4</span> Concaténation du texte</h5>
<p>À l’inverse du découpage, il est parfois nécessaire de concaténer des éléments de texte, ce qu’il est possible de réaliser avec la fonction <code>paste</code>.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1"></a>df<span class="op">$</span>texte_complet &lt;-<span class="st"> </span><span class="kw">paste</span>(df<span class="op">$</span>noms_corr, df<span class="op">$</span>adresses_<span class="dv">3</span>, <span class="dt">sep =</span> <span class="st">&quot; : &quot;</span>)</span>
<span id="cb154-2"><a href="#cb154-2"></a><span class="kw">print</span>(df<span class="op">$</span>texte_complet)</span></code></pre></div>
<pre><code>## [1] &quot;Jérémy Toutanplace : 15 rue Levy&quot;              
## [2] &quot;Constant Tinople : 413 Boulevard Saint-Laurent&quot;
## [3] &quot;Dino Resto : 3606 rue Duke&quot;                    
## [4] &quot;Luce Tancil : 2457 route Saint Marys&quot;</code></pre>
<p>Le paramètre <code>sep</code> permet d’indiquer le ou les caractères à intercaler entre les éléments à concaténer. Notez qu’il est possible de concaténer plus que deux éléments.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1"></a>df<span class="op">$</span>ville &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Montreal&#39;</span>,<span class="st">&#39;Montreal&#39;</span>,<span class="st">&#39;Montreal&#39;</span>,<span class="st">&#39;Montreal&#39;</span>)</span>
<span id="cb156-2"><a href="#cb156-2"></a><span class="kw">paste</span>(df<span class="op">$</span>noms_corr, df<span class="op">$</span>adresses_<span class="dv">3</span>, df<span class="op">$</span>ville, <span class="dt">sep =</span> <span class="st">&quot;, &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Jérémy Toutanplace, 15 rue Levy, Montreal&quot;              
## [2] &quot;Constant Tinople, 413 Boulevard Saint-Laurent, Montreal&quot;
## [3] &quot;Dino Resto, 3606 rue Duke, Montreal&quot;                    
## [4] &quot;Luce Tancil, 2457 route Saint Marys, Montreal&quot;</code></pre>
<p>Si vous souhaitez concaténer des éléments de texte sans séparateur, la fonction <code>paste0</code> peut être plus simple à utiliser.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1"></a><span class="kw">paste0</span>(<span class="st">&quot;Please conca&quot;</span>, <span class="st">&quot;tenate me!&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Please concatenate me!&quot;</code></pre>
</div>
</div>
<div id="sect01426" class="section level4">
<h4><span class="header-section-number">1.4.2.6</span> Manipulation des colonnes de type date</h4>
<p>Nous avons vu que les principaux types de données dans R sont le numérique, le texte, le booléen et le facteur. Il existe d’autres types introduits par différents <em>packages</em>. Nous abordons ici les types date et heure (<em>date</em> and <em>time</em>). Pour les manipuler, nous privilégions l’utilisation du <em>package</em> <code>lubridate</code> du <code>tidyverse</code>. Pour illustrer le tout, nous l’utilisons avec un jeu de données ouvertes de la Ville de Montréal représentant les collisions routières impliquant au moins un cycliste survenues après le 1<sup>er</sup> janvier 2017.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1"></a>accidents_df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file=</span><span class="st">&quot;data/priseenmain/accidents.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb160-2"><a href="#cb160-2"></a><span class="kw">names</span>(accidents_df)</span></code></pre></div>
<pre><code>## [1] &quot;HEURE_ACCDN&quot;       &quot;DT_ACCDN&quot;          &quot;NB_VICTIMES_TOTAL&quot;</code></pre>
<p>Nous disposons de trois colonnes représentant respectivement l’heure, la date et le nombre de victimes impliquées dans la collision.</p>
<div id="sect014261" class="section level5">
<h5><span class="header-section-number">1.4.2.6.1</span> Du texte à la date</h5>
<p>Actuellement, les colonnes <code>HEURE_ACCDN</code> et <code>DT_ACCDN</code> sont au format texte. Nous pouvons afficher quelques lignes du jeu de données avec la fonction <code>head</code> pour visualiser comment elles ont été saisies.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1"></a><span class="kw">head</span>(accidents_df, <span class="dt">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##         HEURE_ACCDN   DT_ACCDN NB_VICTIMES_TOTAL
## 1 16:00:00-16:59:00 2017/11/02                 0
## 2 06:00:00-06:59:00 2017/01/16                 1
## 3 18:00:00-18:59:00 2017/04/18                 0
## 4 11:00:00-11:59:00 2017/05/28                 1
## 5 15:00:00-15:59:00 2017/05/28                 1</code></pre>
<p>Un peu de ménage s’impose : les heures sont indiquées comme des périodes d’une heure. Nous utilisons la fonction <code>str_split_fixed</code> du <em>package</em> <code>stringr</code> pour ne garder que la première partie de l’heure (avant le tiret). Ensuite, Nous concaténons l’heure et la date avec la fonction <code>paste</code>, puis nous convertissons ce résultat en un objet <em>date-time</em>.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb164-2"><a href="#cb164-2"></a></span>
<span id="cb164-3"><a href="#cb164-3"></a><span class="co"># Étape 1 : découper la colonne Heure_ACCDN</span></span>
<span id="cb164-4"><a href="#cb164-4"></a>accidents_df<span class="op">$</span>heure &lt;-<span class="st"> </span><span class="kw">str_split_fixed</span>(accidents_df<span class="op">$</span>HEURE_ACCDN, <span class="st">&quot;-&quot;</span>, <span class="dt">n=</span><span class="dv">2</span>)[,<span class="dv">1</span>]</span>
<span id="cb164-5"><a href="#cb164-5"></a></span>
<span id="cb164-6"><a href="#cb164-6"></a><span class="co"># Étape 2 : concaténer l&#39;heure et la date</span></span>
<span id="cb164-7"><a href="#cb164-7"></a>accidents_df<span class="op">$</span>date_heure &lt;-<span class="st"> </span><span class="kw">paste</span>(accidents_df<span class="op">$</span>DT_ACCDN, </span>
<span id="cb164-8"><a href="#cb164-8"></a>                                 accidents_df<span class="op">$</span>heure,</span>
<span id="cb164-9"><a href="#cb164-9"></a>                                 <span class="dt">sep =</span> <span class="st">&#39; &#39;</span>)</span>
<span id="cb164-10"><a href="#cb164-10"></a></span>
<span id="cb164-11"><a href="#cb164-11"></a><span class="co"># Étape 3 : convertir au format datetime</span></span>
<span id="cb164-12"><a href="#cb164-12"></a>accidents_df<span class="op">$</span>datetime &lt;-<span class="st"> </span><span class="kw">as_datetime</span>(accidents_df<span class="op">$</span>date_heure,</span>
<span id="cb164-13"><a href="#cb164-13"></a>                                     <span class="dt">format =</span> <span class="st">&quot;%Y/%m/%d %H:%M:%S&quot;</span>)</span></code></pre></div>
<p>Pour effectuer la conversion, nous avons utilisé la fonction <code>as_datetime</code> du <em>package</em> <code>lubridate</code>. Elle prend comme paramètre un vecteur de texte et une indication du format de ce vecteur de texte. Il existe de nombreuses façons de spécifier une date et une heure et l’argument <em>format</em> permet d’indiquer celle à utiliser. Dans cet exemple, la date est structurée comme suit :
<code>année/mois/jour heure:minute:seconde</code>, ce qui se traduit par le format <code>%Y/%m/%d %H:%M:%S</code>.</p>
<ul>
<li>%Y signifie une année indiquée avec quatre caractères : 2017;</li>
<li>%m signifie un mois, indiqué avec deux caractères : 01, 02, 03, … 12;</li>
<li>%d signifie un jour, indiqué avec deux caractères : 01, 02, 03, … 31;</li>
<li>%H signifie une heure, au format 24 heures avec deux caractères : 00, 02, … 23;</li>
<li>%M signifie des minutes indiquées avec deux caractères : 00, 02, … 59;</li>
<li>%S signifie des secondes, indiquées avec deux caractères : 00, 02, … 59.</li>
</ul>
<p>Notez que les caractères séparant les années, jours, heures, etc. sont aussi à indiquer dans le format. Dans notre exemple, nous utilisons la barre oblique (<code>/</code>) pour séparer les éléments de la date et le deux points (<code>:</code>) pour l’heure, et une espace pour séparer la date et l’heure.</p>
<p>Il existe d’autres nomenclatures pour spécifier un format <em>datetime</em> : par exemple, des mois renseignés par leur nom, l’indication AM-PM, etc. Vous pouvez vous référer à la documentation de la fonction <code>strptime</code> (<code>help(strptime)</code>) pour explorer les différentes nomenclatures et choisir celle qui vous convient. Bien évidemment, il est nécessaire que toutes les dates de votre colonne soient renseignées dans le même format, pour éviter que la fonction ne retourne la valeur <code>NA</code> lorsqu’elle ne peut lire le format. Après toutes ces opérations, rejetons un oeil à notre <em>DataFrame</em>.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1"></a><span class="kw">head</span>(accidents_df, <span class="dt">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##         HEURE_ACCDN   DT_ACCDN NB_VICTIMES_TOTAL    heure          date_heure
## 1 16:00:00-16:59:00 2017/11/02                 0 16:00:00 2017/11/02 16:00:00
## 2 06:00:00-06:59:00 2017/01/16                 1 06:00:00 2017/01/16 06:00:00
## 3 18:00:00-18:59:00 2017/04/18                 0 18:00:00 2017/04/18 18:00:00
## 4 11:00:00-11:59:00 2017/05/28                 1 11:00:00 2017/05/28 11:00:00
## 5 15:00:00-15:59:00 2017/05/28                 1 15:00:00 2017/05/28 15:00:00
##              datetime
## 1 2017-11-02 16:00:00
## 2 2017-01-16 06:00:00
## 3 2017-04-18 18:00:00
## 4 2017-05-28 11:00:00
## 5 2017-05-28 15:00:00</code></pre>
</div>
<div id="sect014262" class="section level5">
<h5><span class="header-section-number">1.4.2.6.2</span> Extraction des informations d’une date</h5>
<p>À partir de la nouvelle colonne <code>datetime</code>, nous sommes en mesure d’extraire des informations intéressantes comme :</p>
<ul>
<li>le nom du jour de la semaine avec la fonction <code>weekdays</code></li>
</ul>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1"></a>accidents_df<span class="op">$</span>jour &lt;-<span class="st"> </span><span class="kw">weekdays</span>(accidents_df<span class="op">$</span>datetime)</span></code></pre></div>
<ul>
<li>la période de la journée avec les fonctions <code>am</code> et <code>pm</code></li>
</ul>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a>accidents_df<span class="op">$</span>AM &lt;-<span class="st"> </span><span class="kw">am</span>(accidents_df<span class="op">$</span>datetime)</span>
<span id="cb168-2"><a href="#cb168-2"></a>accidents_df<span class="op">$</span>PM &lt;-<span class="st"> </span><span class="kw">pm</span>(accidents_df<span class="op">$</span>datetime)</span>
<span id="cb168-3"><a href="#cb168-3"></a><span class="kw">head</span>(accidents_df[<span class="kw">c</span>(<span class="st">&quot;jour&quot;</span>, <span class="st">&quot;AM&quot;</span>, <span class="st">&quot;PM&quot;</span>)], <span class="dt">n=</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>##       jour    AM    PM
## 1    jeudi FALSE  TRUE
## 2    lundi  TRUE FALSE
## 3    mardi FALSE  TRUE
## 4 dimanche  TRUE FALSE
## 5 dimanche FALSE  TRUE</code></pre>
<p>Il est aussi possible d’accéder aux sous-éléments d’un <em>datetime</em> comme l’année, le mois, le jour, l’heure, la minute et la seconde avec les fonctions <code>year()</code>, <code>month()</code>,<code>day()</code>, <code>hour()</code>, <code>minute()</code> et <code>second()</code>.</p>
</div>
<div id="sect014263" class="section level5">
<h5><span class="header-section-number">1.4.2.6.3</span> Calcul d’une durée entre deux <em>datetime</em></h5>
<p>Une autre utilisation intéressante du format <em>datetime</em> est de calculer des différences de temps. Par exemple, nous pourrions utiliser le nombre de minutes écoulées depuis 7 h comme une variable dans une analyse visant à déterminer le moment critique des collisions routières durant l’heure de pointe du matin.
Pour cela, nous devons créer un <em>datetime</em> de référence en concaténant la date de chaque observation, et le temps <code>07:00:00</code>, qui est notre point de départ.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1"></a>accidents_df<span class="op">$</span>date_heure_<span class="dv">07</span> &lt;-<span class="st"> </span><span class="kw">paste</span>(accidents_df<span class="op">$</span>DT_ACCDN, </span>
<span id="cb170-2"><a href="#cb170-2"></a>                                 <span class="st">&#39;07:00:00&#39;</span>,</span>
<span id="cb170-3"><a href="#cb170-3"></a>                                 <span class="dt">sep =</span> <span class="st">&#39; &#39;</span>)</span>
<span id="cb170-4"><a href="#cb170-4"></a>accidents_df<span class="op">$</span>ref_datetime &lt;-<span class="st"> </span><span class="kw">as_datetime</span>(accidents_df<span class="op">$</span>date_heure_<span class="dv">07</span>,</span>
<span id="cb170-5"><a href="#cb170-5"></a>                                     <span class="dt">format =</span> <span class="st">&quot;%Y/%m/%d %H:%M:%S&quot;</span>)</span></code></pre></div>
<p>Il ne nous reste plus qu’à calculer la différence de temps entre la colonne <em>datetime</em> et notre temps de référence <em>ref_datetime</em>.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1"></a>accidents_df<span class="op">$</span>diff_time &lt;-<span class="st"> </span><span class="kw">difftime</span>(accidents_df<span class="op">$</span>datetime,</span>
<span id="cb171-2"><a href="#cb171-2"></a>                                   accidents_df<span class="op">$</span>ref_datetime,</span>
<span id="cb171-3"><a href="#cb171-3"></a>                                   <span class="dt">units =</span> <span class="st">&#39;min&#39;</span>)</span></code></pre></div>
<p>Notez qu’ici la colonne <em>diff_time</em> est d’un type spécial : une différence temporelle (<em>difftime</em>). Il faut encore la convertir au format numérique pour l’utiliser avec la fonction <code>as.numeric</code>. Par curiosité, réalisons rapidement un histogramme avec la fonction <code>hist</code> pour analyser rapidement cette variable d’écart de temps!</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1"></a>accidents_df<span class="op">$</span>diff_time_num &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(accidents_df<span class="op">$</span>diff_time)</span>
<span id="cb172-2"><a href="#cb172-2"></a><span class="kw">hist</span>(accidents_df<span class="op">$</span>diff_time_num, <span class="dt">breaks =</span> <span class="dv">50</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig015-1.png" alt="Répartition temporelle des accidents à vélo" width="65%" />
<p class="caption">
(#fig:fig015)Répartition temporelle des accidents à vélo
</p>
</div>
<p>Nous observons clairement deux pics, un premier entre 0 et 100 (entre 7 h et 8 h 30 environ) et un second plus important entre 550 et 650 (entre 16 h et 17 h 30 environ), ce qui correspond sans surprise aux heures de pointe (figure @ref(fig:fig015)). Il est intéressant de noter que plus d’accidents se produisent à l’heure de pointe du soir qu’à celle du matin.</p>
</div>
<div id="sect014264" class="section level5">
<h5><span class="header-section-number">1.4.2.6.4</span> Fuseau horaire</h5>
<p>Lorsque nous travaillons avec des données provenant de différents endroits dans le monde ou que nous devons tenir compte des heures d’été et d’hiver, il convient de tenir compte du fuseau horaire. Pour créer une date avec un fuseau horaire, il est possible d’utiliser le paramètre <code>tz</code> dans la fonction <code>as_datetime</code> et d’utiliser l’identifiant du fuseau approprié. Dans notre cas, les données d’accident ont été collectées à Montréal, qui a un décalage de -5 heures par rapport au temps de référence UTC (+1 heure en été). Le code spécifique de ce fuseau horaire est <em>EDT</em>; il est facile de trouver ces codes avec le site web <a href="https://www.timeanddate.com/time/map/">timeanddate.com</a>.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1"></a>accidents_df<span class="op">$</span>datetime &lt;-<span class="st"> </span><span class="kw">as_datetime</span>(accidents_df<span class="op">$</span>date_heure,</span>
<span id="cb173-2"><a href="#cb173-2"></a>                                     <span class="dt">format =</span> <span class="st">&quot;%Y/%m/%d %H:%M:%S&quot;</span>,</span>
<span id="cb173-3"><a href="#cb173-3"></a>                                     <span class="dt">tz =</span> <span class="st">&quot;EDT&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="sect01427" class="section level4">
<h4><span class="header-section-number">1.4.2.7</span> Recodage des variables</h4>
<p>Recoder une variable signifie changer ses valeurs selon une condition afin d’obtenir une nouvelle variable. Si nous reprenons le jeu de données précédent sur les accidents à vélo, nous pourrions vouloir créer une nouvelle colonne nous indiquant si la collision a eu lieu en heures de pointe ou non. Nous obtiendrions ainsi une nouvelle variable avec seulement deux catégories plutôt que la variable numérique originale. Nous pourrions aussi définir quatre catégories avec l’heure de pointe du matin, l’heure de pointe du soir, le reste de la journée et la nuit.</p>
<div id="sect014271" class="section level5">
<h5><span class="header-section-number">1.4.2.7.1</span> Cas binaire avec <code>ifelse</code></h5>
<p>Si nous ne souhaitons créer que deux catégories, le plus simple est d’utiliser la fonction <code>ifelse</code>. Cette fonction évalue une condition (section @ref(sect0135)) pour chaque ligne d’un <em>DataFrame</em> et produit un nouveau vecteur. Créons donc une variable binaire indiquant si une collision a eu lieu durant les heures de pointe ou hors heures de pointe. Nous devons alors évaluer les conditions suivantes :</p>
<p>Est-ce que l’accident a eu lieu entre 7 h (0) <strong>ET</strong> 9 h (120), <strong>OU</strong> entre 16 h 30 (570) <strong>ET</strong> 18 h 30 (690)?</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1"></a><span class="kw">table</span>(<span class="kw">is.na</span>(accidents_df<span class="op">$</span>diff_time_num))</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
##  2414    40</code></pre>
<p>Notons dans un premier temps que nous avons 40 observations sans valeur pour la colonne <code>diff_time_num</code>. Il s’agit d’observations pour lesquelles nous ne disposions pas de dates au départ.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1"></a>Cond1 &lt;-<span class="st"> </span>accidents_df<span class="op">$</span>diff_time_num <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>accidents_df<span class="op">$</span>diff_time_num <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span></span>
<span id="cb176-2"><a href="#cb176-2"></a>Cond2 &lt;-<span class="st"> </span>accidents_df<span class="op">$</span>diff_time_num <span class="op">&gt;=</span><span class="st"> </span><span class="dv">570</span> <span class="op">&amp;</span><span class="st"> </span>accidents_df<span class="op">$</span>diff_time_num <span class="op">&lt;=</span><span class="st"> </span><span class="dv">690</span></span>
<span id="cb176-3"><a href="#cb176-3"></a></span>
<span id="cb176-4"><a href="#cb176-4"></a>accidents_df<span class="op">$</span>moment_bin &lt;-<span class="st"> </span><span class="kw">ifelse</span>(Cond1 <span class="op">|</span><span class="st"> </span>Cond2,</span>
<span id="cb176-5"><a href="#cb176-5"></a>                                  <span class="st">&quot;en heures de pointe&quot;</span>,</span>
<span id="cb176-6"><a href="#cb176-6"></a>                                  <span class="st">&quot;hors heures de pointe&quot;</span>)</span></code></pre></div>
<p>Comme vous pouvez le constater, la fonction <code>ifelse</code> nécessite trois arguments :</p>
<ul>
<li>une condition, pouvant être <code>TRUE</code> ou <code>FALSE</code>;</li>
<li>la valeur à renvoyer si la condition est <code>FALSE</code>;</li>
<li>la valeur à renvoyer si la condition est <code>TRUE</code>.</li>
</ul>
<p>Avec la fonction <code>table</code>, nous pouvons rapidement visualiser les effectifs des deux catégories ainsi créées :</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a><span class="kw">table</span>(accidents_df<span class="op">$</span>moment_bin)</span></code></pre></div>
<pre><code>## 
##   en heures de pointe hors heures de pointe 
##                   841                  1573</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="co"># Vérifier si nous avons toujours seulement 40 NA</span></span>
<span id="cb179-2"><a href="#cb179-2"></a><span class="kw">table</span>(<span class="kw">is.na</span>(accidents_df<span class="op">$</span>moment_bin))</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
##  2414    40</code></pre>
<p>Les heures de pointe représentent quatre heures de la journée, ce qui nous laisse neuf heures hors heures de pointe entre 7 h et 20 h.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1"></a><span class="co"># Ratio de collisions routières en heures de pointe</span></span>
<span id="cb181-2"><a href="#cb181-2"></a>(<span class="dv">841</span> <span class="op">/</span><span class="st"> </span><span class="dv">2414</span>) <span class="op">/</span><span class="st"> </span>(<span class="dv">4</span> <span class="op">/</span><span class="st"> </span><span class="dv">13</span>)</span></code></pre></div>
<pre><code>## [1] 1.132249</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1"></a><span class="co"># Ratio de collisions routières hors heure de pointe</span></span>
<span id="cb183-2"><a href="#cb183-2"></a>(<span class="dv">1573</span> <span class="op">/</span><span class="st"> </span><span class="dv">2414</span>) <span class="op">/</span><span class="st"> </span>(<span class="dv">9</span> <span class="op">/</span><span class="st"> </span><span class="dv">13</span>)</span></code></pre></div>
<pre><code>## [1] 0.9412225</code></pre>
<p>En rapportant les collisions aux durées des deux périodes, nous observons une nette surreprésentation des collisions impliquant un vélo pendant les heures de pointe d’environ 13 % comparativement à la période hors des heures de pointe.</p>
</div>
<div id="sect014272" class="section level5">
<h5><span class="header-section-number">1.4.2.7.2</span> Cas multiple avec la <code>case_when</code></h5>
<p>Lorsque nous souhaitons créer plus que deux catégories, il est possible soit d’enchaîner plusieurs fonctions <code>ifelse</code> (ce qui produit un code plus long et moins lisible), soit d’utiliser la fonction <code>case_when</code> du <em>package</em> <code>dplyr</code> du <code>tidyverse</code>. Reprenons notre exemple et créons quatre catégories :</p>
<ul>
<li>en heures de pointe du matin;</li>
<li>en heures de pointe du soir;</li>
<li>le reste de la journée (entre 7 h et 20 h);</li>
<li>la nuit (entre 21 h et 7 h).</li>
</ul>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb185-2"><a href="#cb185-2"></a></span>
<span id="cb185-3"><a href="#cb185-3"></a>accidents_df<span class="op">$</span>moment_multi &lt;-<span class="st"> </span><span class="kw">case_when</span>(</span>
<span id="cb185-4"><a href="#cb185-4"></a>  accidents_df<span class="op">$</span>diff_time_num <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>accidents_df<span class="op">$</span>diff_time_num <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span> <span class="op">~</span><span class="st"> &quot;pointe matin&quot;</span>,</span>
<span id="cb185-5"><a href="#cb185-5"></a>  accidents_df<span class="op">$</span>diff_time_num <span class="op">&gt;=</span><span class="st"> </span><span class="dv">570</span> <span class="op">&amp;</span><span class="st"> </span>accidents_df<span class="op">$</span>diff_time_num <span class="op">&lt;=</span><span class="st"> </span><span class="dv">690</span> <span class="op">~</span><span class="st"> &quot;pointe soir&quot;</span>,</span>
<span id="cb185-6"><a href="#cb185-6"></a>  accidents_df<span class="op">$</span>diff_time_num <span class="op">&gt;</span><span class="st"> </span><span class="dv">690</span> <span class="op">&amp;</span><span class="st"> </span>accidents_df<span class="op">$</span>diff_time_num <span class="op">&lt;</span><span class="st"> </span><span class="dv">780</span> <span class="op">~</span><span class="st"> &quot;journee&quot;</span>,</span>
<span id="cb185-7"><a href="#cb185-7"></a>  accidents_df<span class="op">$</span>diff_time_num <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span> <span class="op">&amp;</span><span class="st"> </span>accidents_df<span class="op">$</span>diff_time_num <span class="op">&lt;</span><span class="st"> </span><span class="dv">570</span> <span class="op">~</span><span class="st"> &quot;journee&quot;</span>,</span>
<span id="cb185-8"><a href="#cb185-8"></a>  accidents_df<span class="op">$</span>diff_time_num <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>accidents_df<span class="op">$</span>diff_time_num <span class="op">&gt;=</span><span class="st"> </span><span class="dv">780</span> <span class="op">~</span><span class="st"> &quot;nuit&quot;</span></span>
<span id="cb185-9"><a href="#cb185-9"></a>)</span>
<span id="cb185-10"><a href="#cb185-10"></a></span>
<span id="cb185-11"><a href="#cb185-11"></a><span class="kw">table</span>(accidents_df<span class="op">$</span>moment_multi)</span></code></pre></div>
<pre><code>## 
##      journee         nuit pointe matin  pointe soir 
##         1155          418          404          437</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1"></a><span class="co"># Vérifions encore les NA</span></span>
<span id="cb187-2"><a href="#cb187-2"></a><span class="kw">table</span>(<span class="kw">is.na</span>(accidents_df<span class="op">$</span>moment_multi))</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE 
##  2414    40</code></pre>
<p>La syntaxe de cette fonction est un peu particulière. Elle accepte un nombre illimité (ou presque) d’arguments. Chaque argument est composé d’une condition et d’une valeur à renvoyer si la condition est vraie; ces deux éléments étant reliés par le symbole <code>~</code>. Notez que toutes les évaluations sont effectuées dans l’ordre des arguments. En d’autres termes, la fonction teste d’abord la première condition et assigne ses valeurs, puis recommence pour les prochaines conditions. Ainsi, si une observation (ligne du tableau de données) obtient <code>TRUE</code> à plusieurs conditions, elle obtient au final la valeur de la dernière condition validée. Dans l’exemple précédent, si la première condition est <code>accidents_df$diff_time_num &gt;= 0 | accidents_df$diff_time_num &lt;= 120</code>, alors nous obtenons pour seule valeur en résultat <code>"pointe matin"</code> puisque chaque observation a une valeur supérieure à 0 et que nous avons remplacé l’opérateur <code>&amp;</code> (ET) par l’opérateur <code>|</code> (OU).</p>
</div>
</div>
<div id="sect01428" class="section level4">
<h4><span class="header-section-number">1.4.2.8</span> Sous-sélection d’un <em>DataFrame</em></h4>
<p>Dans cette section, nous voyons comment extraire des sous-parties d’un <em>DataFrame</em>. Il est possible de sous-sélectionner des lignes et des colonnes en se basant sur des conditions ou leur index. Pour cela, nous utilisons un jeu de données fourni avec R : le jeu de données <strong>iris</strong> décrivant des fleurs du même nom.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1"></a><span class="kw">data</span>(<span class="st">&quot;iris&quot;</span>)</span>
<span id="cb189-2"><a href="#cb189-2"></a></span>
<span id="cb189-3"><a href="#cb189-3"></a><span class="co"># Nombre de lignes et de colonnes</span></span>
<span id="cb189-4"><a href="#cb189-4"></a><span class="kw">dim</span>(iris)</span></code></pre></div>
<pre><code>## [1] 150   5</code></pre>
<div id="sect014281" class="section level5">
<h5><span class="header-section-number">1.4.2.8.1</span> Sous-sélection des lignes</h5>
<p>Sous-sélectionner des lignes par index est relativement simple. Admettons que nous souhaitons sélectionner les lignes 1 à 5, 10 à 25, 37 et 58.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1"></a>sub_iris &lt;-<span class="st"> </span>iris[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">10</span><span class="op">:</span><span class="dv">25</span>, <span class="dv">37</span>, <span class="dv">58</span>),]</span>
<span id="cb191-2"><a href="#cb191-2"></a><span class="kw">nrow</span>(sub_iris)</span></code></pre></div>
<pre><code>## [1] 23</code></pre>
<p>Sous-sélectionner des lignes avec une condition peut être effectué soit avec une syntaxe similaire, soit en utilisant la fonction <code>subset</code>. Sélectionnons toutes les fleurs de l’espèce Virginica.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1"></a>iris_virginica1 &lt;-<span class="st"> </span>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span>,]</span>
<span id="cb193-2"><a href="#cb193-2"></a>iris_virginica2 &lt;-<span class="st"> </span><span class="kw">subset</span>(iris, iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span>)</span>
<span id="cb193-3"><a href="#cb193-3"></a></span>
<span id="cb193-4"><a href="#cb193-4"></a><span class="co"># Vérifions que les deux DataFrames ont le même nombre de lignes</span></span>
<span id="cb193-5"><a href="#cb193-5"></a><span class="kw">nrow</span>(iris_virginica1) <span class="op">==</span><span class="st"> </span><span class="kw">nrow</span>(iris_virginica2)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Vous pouvez utiliser, dans les deux cas, tous les opérateurs vus dans les sections @ref(sect01352) et @ref(sect01353). L’enjeu est d’arriver à créer un vecteur booléen final permettant d’identifier les observations à conserver.</p>
</div>
<div id="sect014282" class="section level5">
<h5><span class="header-section-number">1.4.2.8.2</span> Sous-sélection des colonnes</h5>
<p>Nous avons déjà vu comment sélectionner des colonnes en utilisant leur nom ou leur index dans la section @ref(sect014221). Ajoutons ici un cas particulier où nous souhaitons sélectionner des colonnes selon une condition. Par exemple, nous pourrions vouloir conserver que les colonnes comprenant le mot <em>Length</em>. Pour cela, nous utilisons la fonction <code>grepl</code>, permettant de déterminer si des caractères sont présents dans une chaîne de caractères.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1"></a>nom_cols &lt;-<span class="st"> </span><span class="kw">names</span>(iris)</span>
<span id="cb195-2"><a href="#cb195-2"></a><span class="kw">print</span>(nom_cols)</span></code></pre></div>
<pre><code>## [1] &quot;Sepal.Length&quot; &quot;Sepal.Width&quot;  &quot;Petal.Length&quot; &quot;Petal.Width&quot;  &quot;Species&quot;</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1"></a>test_nom &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;Length&quot;</span>,nom_cols, <span class="dt">fixed =</span> <span class="ot">TRUE</span>)</span>
<span id="cb197-2"><a href="#cb197-2"></a>ok_nom &lt;-<span class="st"> </span>nom_cols[test_nom]</span>
<span id="cb197-3"><a href="#cb197-3"></a></span>
<span id="cb197-4"><a href="#cb197-4"></a>iris_<span class="dv">2</span> &lt;-<span class="st"> </span>iris[ok_nom]</span>
<span id="cb197-5"><a href="#cb197-5"></a><span class="kw">print</span>(<span class="kw">names</span>(iris_<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] &quot;Sepal.Length&quot; &quot;Petal.Length&quot;</code></pre>
<p>Il est possible d’obtenir ce résultat en une seule ligne de code, mais elle est un peu moins lisible.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1"></a>iris2 &lt;-<span class="st"> </span>iris[<span class="kw">names</span>(iris)[<span class="kw">grepl</span>(<span class="st">&quot;Length&quot;</span>,<span class="kw">names</span>(iris), <span class="dt">fixed =</span> <span class="ot">TRUE</span>)]]</span></code></pre></div>
</div>
<div id="sect014283" class="section level5">
<h5><span class="header-section-number">1.4.2.8.3</span> Sélection des colonnes et des lignes</h5>
<p>Nous avons vu qu’avec les crochets <code>[]</code>, nous pouvons extraire les colonnes et les lignes d’un <em>DataFrame</em>. Il est possible de combiner les deux opérations simultanément. Pour ce faire, il faut indiquer en premier les index ou la condition permettant de sélectionner une ligne, puis les index ou la condition pour sélectionner les colonnes : <code>[index_lignes , index_colonnes]</code>. Sélectionnons cinq premières lignes et les trois premières colonnes du jeu de données iris :</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1"></a>iris_5x3 &lt;-<span class="st"> </span>iris[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>),<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)]</span>
<span id="cb200-2"><a href="#cb200-2"></a><span class="kw">print</span>(iris_5x3)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length
## 1          5.1         3.5          1.4
## 2          4.9         3.0          1.4
## 3          4.7         3.2          1.3
## 4          4.6         3.1          1.5
## 5          5.0         3.6          1.4</code></pre>
<p>Combinons nos deux exemples précédents pour sélectionner uniquement les lignes avec des fleurs de l’espèce <em>virginica</em>, et les colonnes avec le mot <em>Length</em>.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1"></a>iris_virginica3 &lt;-<span class="st"> </span>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span>,</span>
<span id="cb202-2"><a href="#cb202-2"></a>                       <span class="kw">names</span>(iris)[<span class="kw">grepl</span>(<span class="st">&quot;Length&quot;</span>,<span class="kw">names</span>(iris), <span class="dt">fixed =</span> <span class="ot">TRUE</span>)]]</span>
<span id="cb202-3"><a href="#cb202-3"></a><span class="kw">head</span>(iris_virginica3, <span class="dt">n=</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>##     Sepal.Length Petal.Length
## 101          6.3          6.0
## 102          5.8          5.1
## 103          7.1          5.9
## 104          6.3          5.6
## 105          6.5          5.8</code></pre>
</div>
</div>
<div id="sect01429" class="section level4">
<h4><span class="header-section-number">1.4.2.9</span> Fusion de <em>DataFrames</em></h4>
<p>Terminons cette section avec la fusion de <em>DataFrames</em>. Nous distinguons deux méthodes répondant à des besoins différents : par ajout ou par jointure.</p>
<div id="sect014291" class="section level5">
<h5><span class="header-section-number">1.4.2.9.1</span> Fusion de <em>DataFrames</em> par ajout</h5>
<p>Ajouter deux <em>DataFrames</em> peut se faire en fonction de leurs colonnes ou en fonction de leurs lignes. Dans ces deux cas, nous utilisons respectivement les fonctions <code>cbind</code> et <code>rbind</code>. La figure @ref(fig:fig016) résume graphiquement le fonctionnement des deux fonctions.</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/rbind_cbind.png" alt="Fusion de DataFrames" width="30%" />
<p class="caption">
(#fig:fig016)Fusion de DataFrames
</p>
</div>
<p>Pour que <code>cbind</code> fonctionne, il faut que les deux <em>DataFrames</em> aient le même nombre de lignes. Pour <code>rbind</code>, les deux <em>DataFrames</em> doivent avoir le même nombre de colonnes. Prenons à nouveau comme exemple le jeu de données iris. Nous commençons par le séparer en trois sous-jeux de données comprenant chacun une espèce d’iris. Puis, nous fusionnons deux d’entre eux avec la fonction <code>rbind</code>.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1"></a>iris1 &lt;-<span class="st"> </span><span class="kw">subset</span>(iris, iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;virginica&quot;</span>)</span>
<span id="cb204-2"><a href="#cb204-2"></a>iris2 &lt;-<span class="st"> </span><span class="kw">subset</span>(iris, iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;versicolor&quot;</span>)</span>
<span id="cb204-3"><a href="#cb204-3"></a>iris3 &lt;-<span class="st"> </span><span class="kw">subset</span>(iris, iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>)</span>
<span id="cb204-4"><a href="#cb204-4"></a></span>
<span id="cb204-5"><a href="#cb204-5"></a>iris_comb &lt;-<span class="st"> </span><span class="kw">rbind</span>(iris2,iris3)</span></code></pre></div>
<p>Nous pourrions aussi extraire dans les deux <em>DataFrames</em> les colonnes comprenant le mot <em>Length</em> et le mot <em>Width</em>, puis les fusionner.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1"></a>iris_l &lt;-<span class="st"> </span>iris[<span class="kw">names</span>(iris)[<span class="kw">grepl</span>(<span class="st">&quot;Length&quot;</span>,<span class="kw">names</span>(iris), <span class="dt">fixed =</span> <span class="ot">TRUE</span>)]]</span>
<span id="cb205-2"><a href="#cb205-2"></a>iris_w &lt;-<span class="st"> </span>iris[<span class="kw">names</span>(iris)[<span class="kw">grepl</span>(<span class="st">&quot;Width&quot;</span>,<span class="kw">names</span>(iris), <span class="dt">fixed =</span> <span class="ot">TRUE</span>)]]</span>
<span id="cb205-3"><a href="#cb205-3"></a></span>
<span id="cb205-4"><a href="#cb205-4"></a>iris_comb &lt;-<span class="st"> </span><span class="kw">cbind</span>(iris_l,iris_w)</span>
<span id="cb205-5"><a href="#cb205-5"></a><span class="kw">names</span>(iris_comb)</span></code></pre></div>
<pre><code>## [1] &quot;Sepal.Length&quot; &quot;Petal.Length&quot; &quot;Sepal.Width&quot;  &quot;Petal.Width&quot;</code></pre>
</div>
<div id="sect014292" class="section level5">
<h5><span class="header-section-number">1.4.2.9.2</span> Jointure de <em>DataFrames</em></h5>
<p>Une jointure est une opération un peu plus complexe qu’un simple ajout. L’idée est d’associer des informations de plusieurs <em>DataFrames</em> en utilisant une colonne (appelée une clef) présente dans les deux jeux de données. Nous distinguons plusieurs types de jointure :</p>
<ul>
<li>les jointures internes permettant de combiner les éléments communs entre deux <em>DataFrames</em> A <strong>et</strong> B;</li>
<li>la jointure complète permettant de combiner les éléments présents dans A <strong>ou</strong> B;</li>
<li>la jointure à gauche, permettant de ne conserver que les éléments présents dans A même s’ils n’ont pas de correspondance dans B.</li>
</ul>
<p>Ces trois jointures sont présentées à la figure @ref(fig:fig017); pour ces trois cas, la colonne commune se nomme <em>id</em>.</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/merging.png" alt="Jointure de DataFrames" width="30%" />
<p class="caption">
(#fig:fig017)Jointure de DataFrames
</p>
</div>
<p>Vous retiendrez que les deux dernières jointures peuvent produire des valeurs manquantes. Pour réaliser ces opérations, nous utilisons la fonction <code>merge</code>. Prenons un exemple simple à partir d’un petit jeu de données.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1"></a>auteurs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb207-2"><a href="#cb207-2"></a>    <span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;Tukey&quot;</span>, <span class="st">&quot;Venables&quot;</span>, <span class="st">&quot;Tierney&quot;</span>, <span class="st">&quot;Ripley&quot;</span>, <span class="st">&quot;McNeil&quot;</span>, <span class="st">&quot;Apparicio&quot;</span>),</span>
<span id="cb207-3"><a href="#cb207-3"></a>    <span class="dt">nationality =</span> <span class="kw">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;Australia&quot;</span>, <span class="st">&quot;US&quot;</span>, <span class="st">&quot;UK&quot;</span>, <span class="st">&quot;Australia&quot;</span>, <span class="st">&quot;Canada&quot;</span>),</span>
<span id="cb207-4"><a href="#cb207-4"></a>    <span class="dt">retired =</span> <span class="kw">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;no&quot;</span>, <span class="dv">5</span>)))</span>
<span id="cb207-5"><a href="#cb207-5"></a>livres &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb207-6"><a href="#cb207-6"></a>    <span class="dt">aut =</span> <span class="kw">c</span>(<span class="st">&quot;Tukey&quot;</span>, <span class="st">&quot;Venables&quot;</span>, <span class="st">&quot;Tierney&quot;</span>, <span class="st">&quot;Ripley&quot;</span>, <span class="st">&quot;Ripley&quot;</span>, <span class="st">&quot;McNeil&quot;</span>,<span class="st">&quot;Wickham&quot;</span>),</span>
<span id="cb207-7"><a href="#cb207-7"></a>    <span class="dt">title =</span> <span class="kw">c</span>(<span class="st">&quot;Exploratory Data Analysis&quot;</span>,</span>
<span id="cb207-8"><a href="#cb207-8"></a>              <span class="st">&quot;Modern Applied Statistics ...&quot;</span>,</span>
<span id="cb207-9"><a href="#cb207-9"></a>              <span class="st">&quot;LISP-STAT&quot;</span>,</span>
<span id="cb207-10"><a href="#cb207-10"></a>              <span class="st">&quot;Spatial Statistics&quot;</span>, <span class="st">&quot;Stochastic Simulation&quot;</span>,</span>
<span id="cb207-11"><a href="#cb207-11"></a>               <span class="st">&quot;Interactive Data Analysis&quot;</span>, <span class="st">&quot;R for Data Science&quot;</span>))</span></code></pre></div>
<p>Nous avons donc deux <em>DataFrames</em>, le premier décrivant des auteurs et le second des livres. Effectuons une première jointure interne afin de savoir pour chaque livre la nationnalité de son auteur et si ce dernier est à la retraite.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1"></a>df1 &lt;-<span class="st"> </span><span class="kw">merge</span>(livres, auteurs, <span class="co">#les deux DataFrames </span></span>
<span id="cb208-2"><a href="#cb208-2"></a>             <span class="dt">by.x =</span> <span class="st">&quot;aut&quot;</span>, <span class="dt">by.y =</span> <span class="st">&#39;name&#39;</span>, <span class="co">#les noms des colonnes de jointures</span></span>
<span id="cb208-3"><a href="#cb208-3"></a>             <span class="dt">all.x =</span> <span class="ot">FALSE</span>, <span class="dt">all.y =</span> <span class="ot">FALSE</span>)</span>
<span id="cb208-4"><a href="#cb208-4"></a></span>
<span id="cb208-5"><a href="#cb208-5"></a><span class="kw">print</span>(df1)</span></code></pre></div>
<pre><code>##        aut                         title nationality retired
## 1   McNeil     Interactive Data Analysis   Australia      no
## 2   Ripley            Spatial Statistics          UK      no
## 3   Ripley         Stochastic Simulation          UK      no
## 4  Tierney                     LISP-STAT          US      no
## 5    Tukey     Exploratory Data Analysis          US     yes
## 6 Venables Modern Applied Statistics ...   Australia      no</code></pre>
<p>Cette jointure est interne, car les deux paramètres <em>all.x</em> et <em>all.y</em> ont pour valeur <code>FALSE</code>. Ainsi, nous indiquons à la fonction que nous ne souhaitons ni garder tous les éléments du premier <em>DataFrame</em> ni tous les éléments du second, mais uniquement les éléments présents dans les deux. Vous noterez ainsi que le livre “R for Data Science” n’est pas présent dans le jeu de données final, car son auteur “Wickham” ne fait pas partie du <em>DataFrame</em> auteurs. De même, l’auteur “Apparicio” n’apparaît pas dans la jointure, car aucun livre dans le <em>DataFrame</em> books n’a été écrit par cet auteur.</p>
<p>Pour conserver tous les livres, nous pouvons effectuer une jointure à gauche en renseignant <code>all.x = TRUE</code>. Nous forçons ainsi la fonction à garder tous les livres et à mettre des valeurs vides aux informations manquantes des auteurs.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1"></a>df2 &lt;-<span class="st"> </span><span class="kw">merge</span>(livres, auteurs, <span class="co">#les deux DataFrames </span></span>
<span id="cb210-2"><a href="#cb210-2"></a>             <span class="dt">by.x =</span> <span class="st">&quot;aut&quot;</span>, <span class="dt">by.y =</span> <span class="st">&#39;name&#39;</span>, <span class="co">#les noms des colonnes de jointures</span></span>
<span id="cb210-3"><a href="#cb210-3"></a>             <span class="dt">all.x =</span> <span class="ot">TRUE</span>, <span class="dt">all.y =</span> <span class="ot">FALSE</span>)</span>
<span id="cb210-4"><a href="#cb210-4"></a></span>
<span id="cb210-5"><a href="#cb210-5"></a><span class="kw">print</span>(df2)</span></code></pre></div>
<pre><code>##        aut                         title nationality retired
## 1   McNeil     Interactive Data Analysis   Australia      no
## 2   Ripley            Spatial Statistics          UK      no
## 3   Ripley         Stochastic Simulation          UK      no
## 4  Tierney                     LISP-STAT          US      no
## 5    Tukey     Exploratory Data Analysis          US     yes
## 6 Venables Modern Applied Statistics ...   Australia      no
## 7  Wickham            R for Data Science        &lt;NA&gt;    &lt;NA&gt;</code></pre>
<p>Pour garder tous les livres et tous les auteurs, nous pouvons faire une jointure complète en indiquant <code>all.x = TRUE</code> et <code>all.y = TRUE</code>.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a>df3 &lt;-<span class="st"> </span><span class="kw">merge</span>(livres, auteurs, <span class="co">#les deux DataFrames </span></span>
<span id="cb212-2"><a href="#cb212-2"></a>             <span class="dt">by.x =</span> <span class="st">&quot;aut&quot;</span>, <span class="dt">by.y =</span> <span class="st">&#39;name&#39;</span>, <span class="co">#les noms des colonnes de jointures</span></span>
<span id="cb212-3"><a href="#cb212-3"></a>             <span class="dt">all.x =</span> <span class="ot">TRUE</span>, <span class="dt">all.y =</span> <span class="ot">TRUE</span>)</span>
<span id="cb212-4"><a href="#cb212-4"></a></span>
<span id="cb212-5"><a href="#cb212-5"></a><span class="kw">print</span>(df3)</span></code></pre></div>
<pre><code>##         aut                         title nationality retired
## 1 Apparicio                          &lt;NA&gt;      Canada      no
## 2    McNeil     Interactive Data Analysis   Australia      no
## 3    Ripley            Spatial Statistics          UK      no
## 4    Ripley         Stochastic Simulation          UK      no
## 5   Tierney                     LISP-STAT          US      no
## 6     Tukey     Exploratory Data Analysis          US     yes
## 7  Venables Modern Applied Statistics ...   Australia      no
## 8   Wickham            R for Data Science        &lt;NA&gt;    &lt;NA&gt;</code></pre>
</div>
</div>
</div>
</div>
<div id="sect016" class="section level2">
<h2><span class="header-section-number">1.5</span> Code R bien structuré</h2>
<p>Terminons ici avec quelques conseils sur la rédaction d’un code R. Bien rédiger son code est essentiel pour trois raisons :</p>
<ol style="list-style-type: decimal">
<li>Pouvoir relire et réutiliser son code dans le futur.</li>
<li>Permettre à d’autres personnes de bien lire et de réutiliser votre code.</li>
<li>Minimiser les risques d’erreurs.</li>
</ol>
<p>Ne négligez pas l’importance d’un code bien rédigé et bien documenté, vous vous éviterez ainsi des migraines lorsque vous devrez exhumer du code écrit il y a plusieurs mois.</p>
<p>Voici quelques lignes directrices peu contraignantes, mais qui devraient vous être utiles :</p>
<ol style="list-style-type: decimal">
<li><strong>Privilégier la clarté à la concision</strong> : il vaut mieux parfois scinder une ligne de code en plusieurs sous-étapes afin de faciliter la lecture de l’opération réalisée. Par exemple, si nous reprenons une ligne de code d’une section précédente où nous sélectionnions l’ensemble des colonnes du jeu de données <code>iris</code> comprenant le mot <code>Length</code> :</li>
</ol>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1"></a>iris_l &lt;-<span class="st"> </span>iris[<span class="kw">names</span>(iris)[<span class="kw">grepl</span>(<span class="st">&quot;Length&quot;</span>,<span class="kw">names</span>(iris), <span class="dt">fixed =</span> <span class="ot">TRUE</span>)]]</span></code></pre></div>
<p>Nous pouvons simplifier la lecture de ce code en détaillant les différentes étapes comme suit :</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1"></a>noms_cols &lt;-<span class="st"> </span><span class="kw">names</span>(iris)</span>
<span id="cb215-2"><a href="#cb215-2"></a>sel_noms &lt;-<span class="st"> </span>noms_cols[<span class="kw">grepl</span>(<span class="st">&quot;Length&quot;</span>,noms_cols, <span class="dt">fixed =</span> <span class="ot">TRUE</span>)]</span>
<span id="cb215-3"><a href="#cb215-3"></a>iris_l &lt;-<span class="st"> </span>iris[sel_noms]</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Documenter et commenter son code le plus possible</strong> : il est possible d’ajouter du texte dans un code R qui ne sera pas exécuté, ce que nous appelons des commentaires. Typiquement, une ligne commençant par un <code>#</code> n’est pas interprétée par le logiciel. Utilisez des commentaires le plus souvent possible pour décrire les actions que vous souhaitez effectuer avec votre code. Il sera ainsi plus facile de le relire, de naviguer dedans, mais également de repérer d’éventuelles erreurs. Si nous reprenons l’exemple précédent :</li>
</ol>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1"></a><span class="co"># Récupération du nom des colonnes dans le DataFrame iris</span></span>
<span id="cb216-2"><a href="#cb216-2"></a>noms_cols &lt;-<span class="st"> </span><span class="kw">names</span>(iris)</span>
<span id="cb216-3"><a href="#cb216-3"></a></span>
<span id="cb216-4"><a href="#cb216-4"></a><span class="co"># Sélection des colonnes avec les caractères &quot;Length&quot;</span></span>
<span id="cb216-5"><a href="#cb216-5"></a>sel_noms &lt;-<span class="st"> </span>noms_cols[<span class="kw">grepl</span>(<span class="st">&quot;Length&quot;</span>,noms_cols, <span class="dt">fixed =</span> <span class="ot">TRUE</span>)]</span>
<span id="cb216-6"><a href="#cb216-6"></a></span>
<span id="cb216-7"><a href="#cb216-7"></a><span class="co"># Extraction des colonnes sélectionnées dans un nouveau DataFrame</span></span>
<span id="cb216-8"><a href="#cb216-8"></a>iris_l &lt;-<span class="st"> </span>iris[sel_noms]</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><p><strong>Éviter le code à rallonge…</strong> : typiquement, essayez de vous limiter à des lignes de code d’une longueur maximale de 80 caractères. Au-delà de ce seuil, il est judicieux de découper votre code en plusieurs lignes.</p></li>
<li><p><strong>Adopter une convention d’écriture</strong> : une convention d’écriture est un ensemble de règles strictes définissant comment un code doit être rédigé. À titre d’exemple, il est parfois recommandé d’utiliser le <em>lowerCamelCase</em>, le <em>UpperCamelCase</em>, ou encore de séparer les mots par des tirets bas <em>upper_camel_case</em>. Un mélange de ces différentes conventions peut être utilisé pour distinguer les variables, les fonctions et les classes. Il peut être difficile de réellement arrêter une telle convention, car les différents <em>packages</em> dans R utilisent des conventions différentes. Dans vos propres codes, il est surtout important d’avoir une certaine cohérence et ne pas changer de convention.</p></li>
<li><p><strong>Indenter le code</strong> : l’indentation du code permet de le rendre beaucoup plus lisible. Indenter son code signifie d’insérer, au début de chaque ligne de code, un certain nombre d’espaces permettant d’indiquer à quel niveau de profondeur nous nous situons. Typiquement, lorsque des accolades ou des parenthèses sont ouvertes dans une fonction, une boucle ou une condition, nous rajoutons deux ou quatre espaces en début de ligne. Prenons un exemple très concret : admettons que nous écrivons une fonction affichant un résumé statistique à chaque colonne d’un jeu de données si cette colonne est de type numérique. L’indentation dans cette fonction joue un rôle crucial dans sa lisibilité.
Sans indentation et sans respecter la règle des 80 caractères, nous obtenons ceci :</p></li>
</ol>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1"></a>summary_all_num_cols &lt;-<span class="st"> </span><span class="cf">function</span>(dataset){<span class="cf">for</span>(col <span class="cf">in</span> <span class="kw">names</span>(dataset)){<span class="cf">if</span>(<span class="kw">class</span>(dataset[[col]] <span class="op">==</span><span class="st"> &quot;numeric&quot;</span>)){<span class="kw">print</span>(<span class="kw">summary</span>(dataset[[col]]))}}}</span></code></pre></div>
<p>Avec de l’indentation et des commentaires, la syntaxe est beaucoup plus lisible puisqu’elle permet de repérer facilement trois niveaux/paliers dans le code :</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1"></a><span class="co"># Définition d&#39;une fonction</span></span>
<span id="cb218-2"><a href="#cb218-2"></a>summary_all_num_cols &lt;-<span class="st"> </span><span class="cf">function</span>(dataset){</span>
<span id="cb218-3"><a href="#cb218-3"></a>  <span class="co"># Itération sur chaque colonne de la fonction</span></span>
<span id="cb218-4"><a href="#cb218-4"></a>  <span class="cf">for</span>(col <span class="cf">in</span> <span class="kw">names</span>(dataset)){</span>
<span id="cb218-5"><a href="#cb218-5"></a>    <span class="co"># A chaque itération, testons si la colonne est de type numérique</span></span>
<span id="cb218-6"><a href="#cb218-6"></a>    <span class="cf">if</span>(<span class="kw">class</span>(dataset[[col]] <span class="op">==</span><span class="st"> &quot;numeric&quot;</span>)){</span>
<span id="cb218-7"><a href="#cb218-7"></a>      <span class="co"># Si oui, nous affichons un résumé statistique pour cette colonne</span></span>
<span id="cb218-8"><a href="#cb218-8"></a>      <span class="kw">print</span>(<span class="kw">summary</span>(dataset[[col]]))</span>
<span id="cb218-9"><a href="#cb218-9"></a>    } <span class="co"># Ici nous sortons de la condition (niveau 3)</span></span>
<span id="cb218-10"><a href="#cb218-10"></a>  } <span class="co"># Ici nous sortons de la boucle (niveau 2)</span></span>
<span id="cb218-11"><a href="#cb218-11"></a>}<span class="co"># Ici nous sortons de la fonction (niveau 1)</span></span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li><strong>Adopter une structure globale pour vos scripts</strong> : un code R peut être comparé à une recette de cuisine. Si tous les éléments sont dans le désordre et sans structure globale, la recette risque d’être très difficile à suivre. Cette structure risque de changer quelque peu en fonction de la recette ou de l’auteur(e), mais les principaux éléments restent les mêmes. Dans un code R, nous pouvons distinguer plusieurs éléments récurrents que nous vous recommandons d’organiser de la façon suivante :</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Charger les différents <em>packages</em> <strong>utilisés</strong> par le script. Cela permet dès le début du code de savoir quelles sont les fonctions et méthodes qui seront employées dans le script. Cela limite aussi les risques d’oublier des <em>packages</em> qui seraient chargés plus loin dans le code.</li>
<li>Définir les fonctions dont vous aurez besoin en plus de celles présentes dans les <em>packages.</em> Idem, placer nos fonctions en début de code évite d’oublier de les charger ou de les chercher quand nous en avons besoin.</li>
<li>Définir le répertoire de travail avec la fonction <code>setwd</code> et charger les données nécessaires.</li>
<li>Effectuer au besoin les opérations de manipulation sur les données.</li>
<li>Effectuer les analyses nécessaires en scindant si possible les différentes étapes. Notez également que l’étape de définition des fonctions complémentaires peut être effectuée dans une feuille de code séparée, et l’ensemble de ces fonctions chargées à l’aide de la fonction <code>source</code>. De même, si la manipulation des données est conséquente, il est recommandé de l’effectuer avec un code à part, d’enregistrer les données structurées, puis de les charger directement au début de votre code dédié à l’analyse.</li>
</ol>
<ol start="7" style="list-style-type: decimal">
<li><strong>Exploiter les commentaires délimitant les sections dans RStudio</strong> : il est possible d’écrire des commentaires d’une certaine façon pour que l’IDE les détecte comme des délimiteurs de sections. L’intérêt principal est que nous pouvons ensuite facilement naviguer entre ces sections en utilisant RStudio comme montré à la figure @ref(fig:sectionsRstudio), mais aussi masquer des sections afin de faciliter la lecture du reste du code. Pour délimiter une section, il suffit d’ajouter une ligne de commentaire comprenant quatre fois les caractères <code>-</code>, <code>=</code> ou <code>#</code> à la suite :</li>
</ol>
<pre class="{r"><code>
# Voici ma section 1 ----------------------------------

# Voici ma section 2 ==================================

# Voici ma section 3 ##################################

# Autre exemple pour mieux marquer la rupture dans un code : 

#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
#### Titre de ma section 4 ####
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</code></pre>
<div class="figure" style="text-align: center">
<img src="images/introduction/sections_rstudio.png" alt="Navigation dans des sections de codes avec RStudio" width="50%" />
<p class="caption">
(#fig:sectionsRstudio)Navigation dans des sections de codes avec RStudio
</p>
</div>
<ol start="8" style="list-style-type: decimal">
<li><strong>Adopter une structure globale pour vos projets</strong> : au-delà du script, il est nécessaire de bien structurer vos projets, le plus important étant d’utiliser une structure commune à chaque projet pour vous faciliter le travail. Nous proposons à la figure @ref(fig:structFolder) un exemple de structure assez générale pouvant être utilisée dans la plupart des cas. Elle sépare notamment les données originales des données structurées, ainsi que les fonctions complémentaires et la structuration des données du principal bloc d’analyse.</li>
</ol>
<div class="figure" style="text-align: center">
<img src="images/introduction/structurationprojet.png" alt="Structure de dossier recommandée pour un projet avec R" width="50%" />
<p class="caption">
(#fig:structFolder)Structure de dossier recommandée pour un projet avec R
</p>
</div>
<p><strong>Ne négligez jamais l’importance d’un code bien écrit et documenté !</strong></p>
</div>
<div id="sect017" class="section level2">
<h2><span class="header-section-number">1.6</span> Enregistrement des résultats</h2>
<p>Comme nous l’avons indiqué précédemment, l’ensemble des objets actuellement chargés dans votre session R sont perdus si vous la fermez. Cela peut être problématique si certains résultats nécessitent de longs temps de calcul ou si vous avez besoin de partager les objets obtenus avec d’autres personnes, mais pas le code pour les obtenir. Il est possible de retrouver les résultats d’une session précédente si ceux-ci ont été enregistrés sur votre disque dur puisque l’action d’enregistrer permet de faire passer vos objets présents dans votre mémoire vive dans des fichiers stockés sur votre disque dur. Vous pouvez pour cela utiliser la fonction <code>save.image</code> ou <code>save</code>.</p>
<p><code>save.image</code> enregistre une copie exacte de votre session actuelle avec tous les objets présents dans votre environnement dans un fichier <code>RData</code>. La fonction <code>save</code> permet d’être plus sélectif et de ne garder que certains objets spécifiques.</p>
<p>Voici la syntaxe pour enregistrer toute votre session :</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1"></a><span class="kw">save.image</span>(<span class="dt">file =</span> <span class="st">&#39;chemin/vers/mon/fichier/session.RData&#39;</span>, <span class="dt">compress =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Vous pouvez aussi utiliser le bouton d’enregistrement dans l’onglet <em>Environnement</em> dans RStudio (figure @ref(fig:saveobj)).</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/save_session.png" alt="Bouton enregistrer la session" width="50%" />
<p class="caption">
(#fig:saveobj)Bouton enregistrer la session
</p>
</div>
<p>Il est recommandé de compresser ces fichiers (<code>compress = TRUE</code>) pour minimiser leur taille. Pour n’enregistrer que certains objets (ici <code>iris</code> et <code>noms_cols</code>), vous pouvez adapter cette syntaxe :</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1"></a><span class="kw">save</span>(iris, noms_cols, <span class="dt">file =</span> <span class="st">&#39;chemin/vers/mon/fichier/mes_objet.RData&#39;</span>, <span class="dt">compress =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Pour récupérer ces objets dans une autre session, il suffit d’utiliser la fonction <code>load</code> :</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1"></a><span class="kw">load</span>(<span class="dt">file =</span> <span class="st">&#39;chemin/vers/mon/fichier/mes_objet.RData&#39;</span>)</span></code></pre></div>
<p>ou d’utiliser le bouton <em>ouvrir</em> de l’onglet <em>Environnement</em> dans RStudio (figure @ref(fig:loadobj)).</p>
<div class="figure" style="text-align: center">
<img src="images/introduction/load_session.png" alt="Bouton charger un fichier RDA" width="50%" />
<p class="caption">
(#fig:loadobj)Bouton charger un fichier RDA
</p>
</div>
</div>
<div id="sect018" class="section level2">
<h2><span class="header-section-number">1.7</span> Session de travail</h2>
<p>Comme vous avez pu le constater dans les sections @ref(sect017) et @ref(sect0141), il est nécessaire de connaître les chemins vers les fichiers que vous souhaitez utiliser dans votre code R. Si tous ces fichiers sont organisés dans un même dossier (ce que nous vous recommandons à la figure @ref(fig:structFolder)), il est possible de définir un répertoire de travail avec la fonction <code>setwd</code>.
Il est recommandé d’effectuer cette étape au début de votre code R, après le chargement des <em>packages</em>. Ainsi, vous n’aurez pas besoin de réécrire à chaque fois le chemin complet pour accéder à vos fichiers.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1"></a><span class="co"># Chemin complet</span></span>
<span id="cb223-2"><a href="#cb223-2"></a>mes_donnes &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:/projets/articles/2022/mon_projet/data/mes_donnes.csv&quot;</span>)</span>
<span id="cb223-3"><a href="#cb223-3"></a></span>
<span id="cb223-4"><a href="#cb223-4"></a><span class="co"># Utilisation de setwd</span></span>
<span id="cb223-5"><a href="#cb223-5"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/projets/articles/2022/mon_projet&quot;</span>)</span>
<span id="cb223-6"><a href="#cb223-6"></a>mes_donnes &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/mes_donnes.csv&quot;</span>)</span></code></pre></div>
<p>La fonction <code>getwd</code> permet d’afficher le répertoire de travail utilisé actuellement par R.</p>
<p>Si vous utilisez RStudio, il est possible d’utiliser une petite astuce pour définir comme répertoire de travail le dossier dans lequel se trouve le fichier de code R que vous utilisez actuellement :</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1"></a><span class="kw">setwd</span>(<span class="kw">dirname</span>(rstudioapi<span class="op">::</span><span class="kw">getActiveDocumentContext</span>()<span class="op">$</span>path))</span></code></pre></div>
<p>Admettons que votre code R se trouve dans un sous dossier appelé <em>CodeR</em> de votre répertoire de travail, vous pouvez remonter d’un niveau dans votre arborescence en utilisant la syntaxe suivante :</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1"></a><span class="kw">setwd</span>(<span class="kw">paste0</span>(<span class="kw">dirname</span>(rstudioapi<span class="op">::</span><span class="kw">getActiveDocumentContext</span>()<span class="op">$</span>path), <span class="st">&quot;/..&quot;</span>))</span></code></pre></div>
<p>Le double point (<code>..</code>) indique que nous souhaitons remonter dans le dossier parent du dossier dans lequel nous se trouvons acutellement.</p>
<p>Il existe deux solutions de rechange à l’utilisation de <code>setwd</code> que certains jugent un peu démodé.</p>
<ul>
<li>La première est le package <code>here</code> permettant de spécifier plus facilement des chemins relatifs et de définir un <em>top-level directory</em> pour votre projet.</li>
<li>La seconde est l’utilisation de la fonctionnalité <a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects">projects</a> de RStudio.</li>
</ul>
</div>
<div id="sect019" class="section level2">
<h2><span class="header-section-number">1.8</span> Conclusion et ressources pertinentes</h2>
<p>Voilà qui conclut ce chapitre sur les bases du langage R. Vous avez maintenant les connaissances nécessaires pour commencer à travailler. N’hésitez pas à revenir sur les différentes sous-sections au besoin! Quelques ressources pertinentes qui pourraient vous être utiles sont aussi reportées au tableau @ref(tab:tableRessources).</p>
<table>
<caption>
(#tab:tableRessources)Ressources pertinente pour en apprendre plus sur R
</caption>
<thead>
<tr>
<th>
Ressource
</th>
<th>
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://www.r-bloggers.com" target="_blank">Rbloggers</a>
</td>
<td>
Un recueil de nombreux blogues sur R : parfait pour être tenu au courant des nouveautés et faire des découvertes.
</td>
</tr>
<tr>
<td>
<a href="https://cran.r-project.org/web/packages/available_packages_by_date.html" target="_blank">CRAN packages by date</a>
</td>
<td>
Les derniers <em>packages</em> publiés sur <em>CRAN</em> : cela permet de garder un oeil sur les nouvelles fonctionnalités de ses <em>packages</em> préférés.
</td>
</tr>
<tr>
<td>
<a href="https://juba.github.io/tidyverse/index.html" target="_blank">Introduction à R et au TidyVerse</a>
</td>
<td>
Une excellente ressource en français pour en apprendre plus sur le tidyverse.
</td>
</tr>
<tr>
<td>
<a href="https://www.youtube.com/user/TheLearnR/featured" target="_blank">Numyard</a>
</td>
<td>
Une chaîne YouTube pour revoir les bases de R en vidéo.
</td>
</tr>
<tr>
<td>
<a href="https://rstudio.com/resources/cheatsheets" target="_blank">Cheasheets</a>
</td>
<td>
Des feuilles de triche résumant les fonctionnalités de nombreux <em>packages</em>.
</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div id="sect019" class="section level2">
<h2><span class="header-section-number">1.9</span> Quiz de révision du chapitre</h2>
<div id="quizz_intro" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_quizz_intro;
  window.onload = function() {
    quizz_quizz_intro = new Quiz('quizz_intro', ['4','2','2','1',['1', '2', '3'],'2','4']);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Avec quelle fonction peut-on sélectionner son répertoire de travail?
</div>
<div>
Relisez au besoin la section @ref(sect018).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>get.wd</label>
</td>
<td>
<input type="radio" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>set.wd</label>
</td>
<td>
<input type="radio" name="q1" value="2"/>
</td>
</tr>
<tr>
<td>
<label>setWd</label>
</td>
<td>
<input type="radio" name="q1" value="3"/>
</td>
</tr>
<tr>
<td>
<label>setwd</label>
</td>
<td>
<input type="radio" name="q1" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Installer RStudio est suffisant pour pouvoir utiliser R.
</div>
<div>
Relisez au besoin le début de la section @ref(sect012).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q2" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un package doit être réinstallé à chaque fois que l’on souhaite l’utiliser.
</div>
<div>
Relisez au besoin la section @ref(sect0123).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q3" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
La brique de données élémentaire dans R est :
</div>
<div>
Relisez au besoin la section @ref(sect0136).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Le vecteur</label>
</td>
<td>
<input type="radio" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Le DataFrame</label>
</td>
<td>
<input type="radio" name="q4" value="2"/>
</td>
</tr>
<tr>
<td>
<label>La liste</label>
</td>
<td>
<input type="radio" name="q4" value="3"/>
</td>
</tr>
<tr>
<td>
<label>La matrice</label>
</td>
<td>
<input type="radio" name="q4" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un vecteur peut contenir :
</div>
<div>
Relisez au besoin la section @ref(sect0136).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>uniquement des valeurs numériques</label>
</td>
<td>
<input type="checkbox" name="q5" value="1"/>
</td>
</tr>
<tr>
<td>
<label>uniquement des valeurs textuelles</label>
</td>
<td>
<input type="checkbox" name="q5" value="2"/>
</td>
</tr>
<tr>
<td>
<label>uniquement des valeurs booléennes</label>
</td>
<td>
<input type="checkbox" name="q5" value="3"/>
</td>
</tr>
<tr>
<td>
<label>des valeurs de types différents</label>
</td>
<td>
<input type="checkbox" name="q5" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
La jointure et la concaténation de DataFrames désignent exactement la même opération.
</div>
<div>
Relisez au besoin la section @ref(sect01429).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q6" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q6" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Comparativement à une jointure complète, une jointure interne génère un DataFrame avec :
</div>
<div>
Relisez le deuxième encadré à la section @ref(sect014292).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>nécessairement moins d’observations</label>
</td>
<td>
<input type="radio" name="q7" value="1"/>
</td>
</tr>
<tr>
<td>
<label>nécessairement plus d’observations</label>
</td>
<td>
<input type="radio" name="q7" value="2"/>
</td>
</tr>
<tr>
<td>
<label>au moins autant d’observations</label>
</td>
<td>
<input type="radio" name="q7" value="3"/>
</td>
</tr>
<tr>
<td>
<label>autant ou moins d’observations</label>
</td>
<td>
<input type="radio" name="q7" value="4"/>
</td>
</tr>
<tr>
<td>
<label>le même nombre d’observation</label>
</td>
<td>
<input type="radio" name="q7" value="5"/>
</td>
</tr>
</table>
</div>
</div>
<button type="button" onclick="showResults(quizz_quizz_intro);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:01-priseenmainR.Rmd-->
</div>
</div>
<div id="part-analyses-univariées-et-graphiques-dans-r" class="section level1 unnumbered">
<h1>(PART) Analyses univariées et graphiques dans R</h1>
</div>
<div id="chap02" class="section level1">
<h1><span class="header-section-number">2</span> Statistiques descriptives univariées</h1>
<p>Comprendre la notion de variable et de ses différents types est essentiel en statistiques. En effet, en fonction du type de variable à l’étude, les méthodes de statistique exploratoire ou inférentielle sont différentes. Nous distinguons ainsi cinq types de variables : nominale, ordinale, discrète, continue et semi-quantitative. Aussi, nous abordons un concept central de la statistique : les distributions. Finalement, dans ce chapitre, nous présentons les différentes statistiques descriptives univariées qui peuvent s’appliquer à ces types de variables.</p>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons principalement les <em>packages</em> suivants :</p>
<ul>
<li>Pour créer des graphiques :
<ul>
<li><code>ggplot2</code>, le seul, l’unique!</li>
<li><code>ggpubr</code> pour combiner des graphiques et réaliser des diagrammes quantiles-quantiles.</li>
</ul></li>
<li>Pour créer des distributions :
<ul>
<li><code>fitdistrplus</code> pour générer différentes distributions.</li>
<li><code>actuar</code> pour la fonction de densité de Pareto.</li>
<li><code>gamlss.dist</code> pour des distributions de Poisson.</li>
</ul></li>
<li>Pour les statistiques descriptives :
<ul>
<li><code>stats</code> et <code>moments</code> pour les statistiques descriptives.</li>
<li><code>nortest</code> pour le test de Kolmogorov-Smirnov.</li>
<li><code>DescTools</code> pour les tests de Lilliefors, Shapiro-Wilk, Anderson-Darling et Jarque-Bera.</li>
</ul></li>
<li>Autres <em>packages</em> :
<ul>
<li><code>Hmisc</code> et <code>Weighted.Desc.Stat</code> pour les statistiques descriptives pondérées.</li>
<li><code>foreign</code> pour importer des fichiers externes.</li>
</ul></li>
</ul>
</div>
<div id="sect021" class="section level2">
<h2><span class="header-section-number">2.1</span> Notion et types de variable</h2>
<div id="sect0211" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Notion de variable</h3>
<p>D’un point de vue empirique, une variable est une propriété, une caractéristique d’une unité statistique, d’une observation. Il convient alors de bien saisir à quelle unité d’analyse (ou unité d’observation) s’appliquent les valeurs d’une variable : des personnes, des ménages, des municipalités, des entreprises, etc. Par exemple, pour des individus, l’<em>âge</em>, le <em>genre</em> ou encore le <em>revenu</em> sont autant de caractéristiques qui peuvent être mesurées à partir de variables. Autrement dit, une variable permet de mesurer un phénomène (dans un intervalle de valeurs, c’est-à-dire de manière quantitative) ou de le qualifier (avec plusieurs catégories, c’est-à-dire de manière qualitative).</p>
<p>D’un point de vue plus théorique, une variable permet d’opérationnaliser un concept en sciences sociales <span class="citation">(Gilles et Maranda <a href="#ref-gilles1994elements" role="doc-biblioref">1994</a>, 30)</span>, soit une « idée générale et abstraite que se fait l’esprit humain d’un objet de pensée concret ou abstrait, et qui lui permet de rattacher à ce même objet les diverses perceptions qu’il en a, et d’en organiser les connaissances » (<a href="https://www.larousse.fr/dictionnaires/francais/concept/17875?q=concept#17749" target="_blank">Larousse</a>). En effet, la construction d’un modèle théorique suppose d’opérationnaliser différents concepts et d’établir les relations qu’ils partagent entre eux. Or, l’opérationnalisation d’un concept nécessite soit de mesurer (dans un intervalle de valeurs, c’est-à-dire de manière quantitative), soit de qualifier (avec plusieurs catégories, c’est-à-dire de manière qualitative) un phénomène.</p>
<div class="bloc_attention">
<p><strong>Maîtriser la définition des variables que vous utilisez : un enjeu crucial! </strong></p>
<p>Ne pas maîtriser la définition d’une variable revient à ne pas bien saisir la caractéristique ou encore le concept sous-jacent qu’elle tente de mesurer. Si vous exploitez des données secondaires – par exemple, issues d’un recensement de population ou d’une enquête longitudinale ou transversale –, il faut impérativement lire les définitions des variables que vous souhaitez utiliser. Ne pas le faire risque d’aboutir à :</p>
<ul>
<li><p>Une mauvaise opérationnalisation de votre modèle théorique, même si votre analyse est bien menée statistiquement parlant. Autrement dit, vous risquez de ne pas sélectionner les bonnes variables : prenons un exemple concret. Vous avez construit un modèle théorique dans lequel vous souhaitez inclure un concept sur la langue des personnes. Dans le recensement canadien de 2016, plusieurs variables relatives à la langue sont disponibles : connaissance des langues officielles, langue parlée à la maison, langue maternelle, première langue officielle parlée, connaissance des langues non officielles et langue de travail (<a href="https://www12.statcan.gc.ca/census-recensement/2016/ref/guides/003/98-500-x2016003-fra.cfm" class="uri">https://www12.statcan.gc.ca/census-recensement/2016/ref/guides/003/98-500-x2016003-fra.cfm</a>). La sélection de l’une de ces variables doit être faite de manière rigoureuse, c’est-à-dire en lien avec votre cadre théorique et suite à une bonne compréhension des définitions des variables. Dans une étude sur le marché du travail, nous sélectionnerions probablement la variable <em>sur la connaissance des langues officielles du Canada</em>, afin d’évaluer son effet sur l’employabilité, toutes choses étant égales par ailleurs. Dans une autre étude portant sur la réussite ou la performance scolaire, il est probable que nous utiliserions la <em>langue maternelle</em>.</p></li>
<li><p>Une mauvaise interprétation et discussion de vos résultats en lien avec votre cadre théorique.</p></li>
<li><p>Une mauvaise identification des pistes de recherche.</p></li>
</ul>
<p>Finalement, la définition d’une variable peut évoluer à travers plusieurs recensements de population : la société évolue, les variables aussi! Par conséquent, si vous comptez utiliser plusieurs années de recensement dans une même étude, assurez-vous que les définitions des variables sont similaires d’un jeu de données à l’autre et qu’elles mesurent ainsi la même chose.</p>
<p><strong>Comprendre les variables utilisées dans un article scientifique : un exercice indispensable dans l’élaboration d’une revue de littérature</strong></p>
<p>Une lecture rigoureuse d’un article scientifique suppose, entre autres, de bien comprendre les concepts et les variables mobilisés. Il convient alors de lire attentivement la section méthodologique (pas uniquement la section des résultats ou pire, celle du résumé), sans quoi vous risquez d’aboutir à une revue de littérature approximative.
Ayez aussi un <strong>regard critique</strong> sur les variables utilisées en lien avec le cadre théorique. Certains concepts sont très difficiles à traduire en variables; leurs opérationnalisations (mesures) peuvent ainsi faire l’objet de vifs débats au sein de la communauté scientifique. Très succinctement, c’est notamment le cas du concept de capital social. D’une part, les définitions et ancrages sont bien différents selon Bourdieu (sociologue, ancrage au niveau des individus) et Putman (politologue, ancrage au niveau des collectivités); d’autre part, aucun consensus ne semble clairement se dégager quant à la définition de variables permettant de mesurer le capital social efficacement (de manière quantitative).</p>
<p><strong>Variable de substitution (<em>proxy variable</em> en anglais)</strong></p>
<p>Nous faisons la moins pire des recherches! En effet, les données disponibles sont parfois imparfaites pour répondre avec précision à une question de recherche; nous pouvons toujours les exploiter, tout en signalant honnêtement leurs faiblesses et limites, et ce, tant pour les données que pour les variables utilisées.</p>
<ul>
<li><p>Des bases de données peuvent être en effet imparfaites. Par exemple, en criminologie, lorsqu’une étude est basée sur l’exploitation de données policières, la limite du <strong>chiffre noir</strong> est souvent signalée : les données policières comprennent uniquement les crimes et délits découverts par la police et occultent ainsi les crimes non découverts; ils ne peuvent ainsi refléter la criminalité réelle sur un territoire donné.</p></li>
<li><p>Des variables peuvent aussi être imparfaites. Dans un jeu de données, il est fréquent qu’une variable ne soit pas disponible ou qu’elle n’ait tout simplement pas été mesurée. Nous cherchons alors une variable de substitution (<em>proxy</em>) pour la remplacer. Prenons un exemple concret portant sur l’exposition des cyclistes à la pollution atmosphérique ou au bruit environnemental. L’un des principaux facteurs d’exposition à ces pollutions est le trafic routier : plus ce dernier est élevé, plus les cyclistes risquent de rouler dans un environnement bruyant et pollué. Toutefois, il est rare de disposer de mesures du trafic en temps réel qui nécessitent des comptages de véhicules pendant le trajet des cyclistes (par exemple, à partir de vidéos captées par une caméra fixée sur le guidon). Pour pallier l’absence de mesures directes, plusieurs auteur(e)s utilisent des variables de substitution de la densité du trafic, comme la typologie des types d’axes (primaire, secondaire, tertiaire, rue locale, etc.), supposant ainsi qu’un axe primaire supporte un volume de véhicules supérieur à un axe secondaire.</p></li>
</ul>
</div>
</div>
<div id="sect0212" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Types de variables</h3>
<p>Nous distinguons habituellement les variables qualitatives (nominale ou ordinale) des variables quantitatives (discrète ou continue). Tel qu’illustré à la figure @ref(fig:figunivarie1), plusieurs mécanismes différents visent à qualifier, à classer, à compter ou à mesurer afin de caractériser les unités statistiques (observations) d’une population ou d’un échantillon.</p>
<div class="figure" style="text-align: center">
<img src="images/univariee/figure1.jpg" alt="Types de variables" width="70%" />
<p class="caption">
(#fig:figunivarie1)Types de variables
</p>
</div>
<div id="sect02121" class="section level4">
<h4><span class="header-section-number">2.1.2.1</span> Variables qualitatives</h4>
<p><strong>Une variable nominale</strong> permet de <strong>qualifier</strong> des observations (individus) à partir de plusieurs catégories dénommées modalités. Par exemple, la variable <em>couleur des yeux</em> pourrait comprendre les modalités <em>bleu</em>, <em>marron</em>, <em>vert</em>, <em>noir</em> tandis que le <em>type de famille</em> compendrait les modalités <em>couple marié</em>, <em>couple en union libre</em> et <em>famille monoparentale</em>.</p>
<p><strong>Une variable ordinale</strong> permet de <strong>classer</strong> des observations à partir de plusieurs modalités hiérarchisées. L’exemple le plus connu est certainement l’échelle de Likert, très utilisée dans les sondages évaluant le degré d’accord d’une personne à une affirmation avec les modalités suivantes : <em>tout à fait d’accord</em>, <em>d’accord</em>, <em>ni en désaccord ni d’accord</em>, <em>pas d’accord</em> et <em>pas du tout d’accord</em>. Une multitude de variantes sont toutefois possibles pour classer la fréquence d’un phénomène (<em>très souvent</em>, <em>souvent</em>, <em>parfois</em>, <em>rarement</em>, <em>jamais</em>), l’importance accordée à un phénomène (<em>pas du tout important</em>, <em>peu important</em>, <em>plus ou moins important</em>, <em>important</em>, <em>très important</em>) ou la proximité perçue d’un lieu (<em>très éloigné</em>, <em>loin</em>, <em>plus ou moins proche</em>, <em>proche</em>, <em>très proche</em>).</p>
<p>En fonction du nombre de modalités qu’elle comprend, une variable qualitative (nominale ou ordinale) est soit <strong>dichtomique (binaire)</strong> (deux modalités), soit <strong>polytomique</strong> (plus de deux modalités). Par exemple, dans le recensement canadien, le <em>sexe</em> est une variable binaire (avec les modalités <em>sexe masculin</em>, <em>sexe féminin</em>), tandis que le <em>genre</em> est une variable polytomique (avec les modalités <em>genre masculin</em>, <em>genre féminin</em> et <em>diverses identités de genre</em>).</p>
<div class="bloc_attention">
<p>Les variables nominales et ordinales sont habituellement encodées avec des valeurs numériques entières (par exemple, 1 pour <em>couple marié</em>, 2 pour <em>couple en union libre</em> et 3 pour <em>famille monoparentale</em>). Toutefois, aucune opération arithmétique (moyenne ou écart-type par exemple) n’est possible sur ces valeurs. Dans R, nous utilisons un facteur pour attribuer un intitulé à chacune des valeurs numériques de la variable qualitative :</p>
<p><code>df$Famille &lt;- factor(df$Famille, c(1,2,3), labels = c("couple marié","couple en union libre", "famille monoparentale"))</code></p>
<p>Nous calculons toutefois les fréquences des différentes modalités pour une variable nominale ou ordinale. Il est aussi possible de calculer la médiane sur une variable ordinale.</p>
</div>
</div>
<div id="sect02122" class="section level4">
<h4><span class="header-section-number">2.1.2.2</span> Variables quantitatives</h4>
<p><strong>Une variable discrète</strong> permet de <strong>compter</strong> un phénomène dans un ensemble fini de valeurs, comme le nombre d’accidents impliquant un ou une cycliste à une intersection sur une période de cinq ans ou encore le nombre de vélos en libre service disponibles à une station. Il existe ainsi une variable binaire sous-jacente : la présence ou non d’un accident à l’intersection ou la disponibilité d’un vélo ou non à la station pour laquelle nous opérons un comptage. Habituellement, une variable discrète ne peut prendre que des valeurs entières (sans décimale), comme le nombre de personnes fréquentant un parc.</p>
<p><strong>Une variable continue</strong> permet de <strong>mesurer</strong> un phénomène avec un nombre infini de valeurs réelles (avec décimales) dans un intervalle donné. Par exemple, une variable relative à la distance de dépassement d’un ou d’une cycliste par un véhicule motorisé pourrait varier de 0 à 5 mètres (<span class="math inline">\(X \in \left[0,5\right]\)</span>); toutefois, cette distance peut être de 0,759421 ou de 4,785612 mètres. Le nombre de décimales de la valeur réelle dépend de la précision et de la fiabilité de la mesure. Pour un capteur de distance de dépassement, le nombre de décimales dépend de la précision du lidar ou du sonar de l’appareil; aussi, l’utilisation de trois décimales – soit une précision au millimètre – est largement suffisante pour mesurer la distance de dépassement. De plus, une variable continue est soit une variable d’intervalle, soit une variable de rapport. Les <strong>variables d’intervalle</strong> ont une échelle relative, c’est-à-dire que les intervalles entre les valeurs de la variable ne sont pas constants; elles n’ont pas de vrai zéro. Autrement dit, ce type de variable a une échelle relative avec un zéro arbitraire. Ces valeurs peuvent être manipulées uniquement par addition et soustraction et non par multiplication et division. La variable d’intervalle la plus connue est certainement celle de la température. S’il fait 10 degrés Celsius à Montréal et 30 °C à Mumbai (soit 50 et 86 degrés en Fahrenheit), nous pouvons affirmer qu’il y a 20 °C ou 36 °F d’écart entre les deux villes, mais ne pouvons pas affirmer qu’il fait trois fois plus chaud à Mumbai. Presque toutes les mesures statistiques sur une variable d’intervalle peuvent être calculées, exceptés le coefficient de variation et la moyenne géométrique puisqu’il n’y a pas de vrai zéro ni d’intervalles constants entre les valeurs. À l’inverse, les <strong>variables de rapport</strong> ont une échelle absolue, c’est-à-dire que les intervalles entre les valeurs sont constants et elles ont un vrai zéro. Elles peuvent ainsi être manipulées par addition, soustraction, multiplication et division. Par exemple, le prix d’un produit exprimé dans une unité monétaire ou la distance exprimée dans le système métrique sont des variables de rapport. Un vélo dont le prix affiché est de 1000 $ est bien deux fois plus cher qu’un autre à 500 $, une piste cyclable hors rue à 25 mètres du tronçon routier le plus proche est bien quatre fois plus proche qu’une autre à 100 mètres.</p>
<p><strong>Une variable semi-quantitative</strong>, appelée aussi variable quantitative ordonnée, est une variable discrète ou continue dont les valeurs ont été regroupées en classes hiérarchisées. Par exemple, l’âge est une variable continue pouvant être transformée avec les groupes d’âge ordonnés suivants : <em>moins 25 ans</em>, <em>25 à 44 ans</em>, <em>45 à 64 ans</em> et <em>65 ans et plus</em>.</p>
</div>
</div>
</div>
<div id="sect022" class="section level2">
<h2><span class="header-section-number">2.2</span> Types de données</h2>
<p>Différents types de données sont utilisés en sciences sociales. L’objectif ici n’est pas de les décrire en détail, mais plutôt de donner quelques courtes définitions. En fonction de votre question de recherche et des bases des données disponibles, il s’agit de sélectionner le ou les types de données les plus appropriés à votre étude.</p>
<div id="sect0221" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Données secondaires <em>versus</em> données primaires</h3>
<p>Les <strong>données secondaires</strong> sont des données qui existent déjà au début de votre projet de recherche : nul besoin de les collecter, il suffit de les exploiter! Une multitude de données de recensements ou d’enquêtes de Statistique Canada sont disponibles et largement exploitées en sciences sociales (par exemple, l’enquête nationale auprès des ménages – ENM, l’enquête sur la dynamique du marché du travail et du revenu – EDTR, l’enquête longitudinale auprès des immigrants – ELIC, etc.).</p>
<div class="bloc_notes">
<p>Au Canada, les personnes qui font de la recherche, qui étudient ou qui enseignent ont accès aux microdonnées des enquêtes de Statistique Canada dans les centres de données de recherche (CDR). Vous pouvez consulter le moteur de recherche du Réseau canadien des Centres de données de recherche (<a href="https://crdcn.org/fr/donn%C3%A9es" class="uri">https://crdcn.org/fr/donn%C3%A9es</a>) afin d’explorer les différentes enquêtes disponibles.</p>
<p>Au Québec, l’accès à ces enquêtes est possible dans les différentes antennes du Centre interuniversitaire québécois de statistiques sociales de Statistique Canada (<a href="https://www.ciqss.org/" class="uri">https://www.ciqss.org/</a>).</p>
</div>
<p>Par opposition, les <strong>données primaires</strong> n’existent pas quand vous démarrez votre projet : vous devez les collecter spécifiquement pour votre étude! Par exemple, une chercheure souhaitant analyser l’exposition des cyclistes au bruit et à la pollution dans une ville donnée doit réaliser une collecte de données avec idéalement plusieurs personnes participantes (équipées de différents capteurs), et ce, sur plusieurs jours.
Une collecte de données primaires peut aussi être réalisée avec une enquête par sondage. Brièvement, réaliser une collecte de données primaires nécessite différentes phases complexes comme la définition de la méthode de collecte et de la population à l’étude, l’estimation de la taille de l’échantillon, la validation des outils de collecte avec une phase de test, la réalisation de la collecte, la structuration, la gestion et l’exploitation de données collectées. Finalement, dans le milieu académique, une collecte de données primaires auprès d’individus doit être approuvée par le comité d’éthique de la recherche de l’université à laquelle est affiliée la personne responsable du projet de recherche.</p>
</div>
<div id="sect0222" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Données transversales <em>versus</em> données longitudinales</h3>
<p>Les <strong>données transversales</strong> sont des mesures pour une période relativement courte. L’exemple classique est un jeu de données constitué des variables extraites d’un recensement de population pour une année donnée (comme celui de 2016 de Statistique Canada).</p>
<p>Les <strong>données longitudinales</strong>, appelées aussi données par panel, sont des mesures répétées pour plusieurs observations au cours du temps (<em>N</em> observations pour <em>T</em> dates). Par exemple, des observations pourraient être des pays, les dates pourraient être différentes années (de 1990 à 2019) pour lesquelles différentes variables seraient disponibles (population totale, taux d’urbanisation, produit intérieur brut par habitant, émissions de gaz à effet de serre par habitant, etc.).</p>
</div>
<div id="sect0223" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Données spatiales versus données aspatiales</h3>
<p>Les observations des <strong>données spatiales</strong> sont des unités spatiales géoréférencées. Elles peuvent être par exemple :</p>
<ul>
<li>des points <em>(x,y)</em> ou <em>(lat-long)</em> représentant des entreprises avec plusieurs variables (adresse, date de création, nombre d’employés, secteurs d’activité, etc.);</li>
<li>les lignes représentant des tronçons de rues pour lesquels plusieurs variables sont disponibles (type de rue, longueur en mètres, nombre de voies, débit journalier moyen annuel, etc.);</li>
<li>des polygones délimitant des régions ou des arrondissements pour lesquels une multitude de variables sociodémographiques et socioéconomiques sont disponibles;</li>
<li>les pixels des bandes spectrales d’une image satellite.</li>
</ul>
<p>À l’inverse, aucune information spatiale n’est disponible pour des <strong>données aspatiales</strong>.</p>
</div>
<div id="sect0224" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Données individuelles <em>versus</em> données agrégées</h3>
<p>Comme son nom l’indique, pour des <strong>données individuelles</strong>, chaque observation correspond à un individu. Les microdonnées de recensements ou d’enquêtes, par exemple, sont des données individuelles pour lesquelles toute une série de variables sont disponibles. Une étude analysant les caractéristiques de chaque arbre d’un quartier nécessite aussi des données individuelles : l’information doit être disponible pour chaque arbre. Pour les microdonnées des recensements canadiens, « chaque enregistrement au niveau de la personne comprend des identifiants (comme les identifiants du ménage et de la famille), des variables géographiques et des variables directes et dérivées tirées du questionnaire » (<a href="https://www150.statcan.gc.ca/n1/pub/12-002-x/2012001/article/11642-fra.htm" target="_blank">Statistique Canada</a>). Comme signalé plus haut, ces microdonnées de recensements ou d’enquêtes sont uniquement accessibles dans les centres de données de recherche (CDR).</p>
<p>Les données individuelles peuvent être <strong>agrégées</strong> à un niveau supérieur. Prenons le cas de microdonnées d’un recensement. Les informations disponibles pour chaque individu sont agrégées par territoire géographique (province, région économique, division de recensement, subdivision de recensement, région et agglomération de recensement, secteurs de recensement, aires de diffusion, etc.) en fonction du lieu de résidence des individus. Des sommaires statistiques – basés sur la moyenne, la médiane, la somme ou la proportion de chacune des variables mesurées au niveau individuel (âge, sexe, situation familiale, revenu, etc.) – sont alors construits pour ces différents découpages géographiques (<a href="https://www.statcan.gc.ca/fra/idd/trousse/section5#a4" target="_blank">Statistique Canada</a>).</p>
<p>L’agrégation n’est pas nécessairement géographique. En éducation, il est fréquent de travailler avec des données concernant les élèves, mais agrégées au niveau des écoles. La figure @ref(fig:figunivarie1b) donne un exemple simple d’agrégation de données individuelles.</p>
<div class="figure" style="text-align: center">
<img src="images/univariee/aggregation.png" alt="Exemple d'agrégation de données individuelles" width="65%" />
<p class="caption">
(#fig:figunivarie1b)Exemple d’agrégation de données individuelles
</p>
</div>
<div class="bloc_attention">
<p><strong>Erreur écologique et erreur atomiste</strong>: attention aux interprétations abusives.</p>
<p>Il convient d’être prudent dans l’analyse des données agrégées. Très fréquente en géographie, l’<strong>erreur écologique</strong> (<em>ecological fallacy</em> en anglais) est une mauvaise interprétation des résultats. Elle consiste à attribuer des constats obtenus à partir de données agrégées pour un territoire aux individus qui forment la population de ce territoire. À l’inverse, attribuer des résultats à partir de données individuelles à des territoires est une <strong>erreur atomiste</strong>.</p>
<p>Prenons un exemple concret tiré d’une étude récente sur la localisation des écoles primaires et le bruit aérien dans la région métropolitaine de Toronto <span class="citation">(Audrin, Apparicio et Séguin <a href="#ref-audrin2021localisation" role="doc-biblioref">2021</a>)</span>. Un des objectifs de cette étude est de vérifier si les écoles primaires (ns = 1420) avec des niveaux de bruit aérien élevés présentent des niveaux de réussite scolaire plus faibles. Les résultats de leur étude démontrent que les enfants scolarisés dans les écoles primaires exposées à des niveaux élevés de bruit aérien sont issus de milieux plus défavorisés et ont plus souvent une langue maternelle autre que la langue d’enseignement. Aussi, les écoles avec des niveaux de bruit aérien élevés présentent des niveaux de réussite scolaire plus faibles.</p>
<p>Toutefois, étant donné que les variables sur la réussite scolaire sont mesurées au niveau de l’école (soit les pourcentages d’élèves ayant atteint ou dépassé la norme provinciale en lecture, en écriture et en mathématique, respectivement pour la 3<sup>e</sup> année et la 6<sup>e</sup> année) et non au niveau individuel, nous ne pouvons pas conclure que le bruit aérien à un impact significatif sur la réussite scolaire des élèves :</p>
<p>« Nous avons pu démontrer que les écoles primaires localisées dans la zone NEF 25 présentent des taux de réussite plus faibles. Rappelons toutefois qu’une association obtenue avec des données agrégées ne peut pas nous permettre de conclure à une influence directe au niveau individuel, car l’agrégation des données entraîne une perte d’information. Cette erreur d’interprétation dite erreur écologique (<em>ecological fallacy</em>) tend à laisser penser que les associations entre les groupes s’appliquent à chaque individu (Robinson, 1950). Nos résultats gagneraient à être corroborés à partir d’analyses reposant sur des données individuelles ».</p>
</div>
<p>Pour le cas de l’agrégation géographique, il convient alors de bien comprendre la hiérarchie des régions géographiques délimitées par l’organisme ou l’agence ayant la responsabilité de produire, de gérer et de diffuser les données des recensements et des enquêtes, puis de sélectionner le découpage géographique qui répond le mieux à votre question de recherche.</p>
<div class="bloc_astuce">
<p>Pour le recensement de 2016 de Statistique Canada vous pouvez consulter :</p>
<ul>
<li>la hiérarchie des régions géographiques normalisées pour la diffusion (<a href="https://www12.statcan.gc.ca/census-recensement/2016/ref/dict/figures/f1_1-fra.cfm" class="uri">https://www12.statcan.gc.ca/census-recensement/2016/ref/dict/figures/f1_1-fra.cfm</a>)</li>
<li>le glossaire illustré (<a href="https://www150.statcan.gc.ca/n1/pub/92-195-x/92-195-x2016001-fra.htm" class="uri">https://www150.statcan.gc.ca/n1/pub/92-195-x/92-195-x2016001-fra.htm</a>) des régions géographiques</li>
<li>les différents profils du recensement de 2016 à télécharger pour les différentes régions géographiques (<a href="https://www12.statcan.gc.ca/census-recensement/2016/dp-pd/prof/details/download-telecharger/comp/page_dl-tc.cfm?Lang=F" class="uri">https://www12.statcan.gc.ca/census-recensement/2016/dp-pd/prof/details/download-telecharger/comp/page_dl-tc.cfm?Lang=F</a>).</li>
</ul>
</div>
<div class="bloc_notes">
<p>Bien entendu, les différents types de données abordés ci-dessus ne sont pas exclusifs. Par exemple, des données pour des régions administratives extraites de plusieurs recensements sont en fait des données secondaires, spatiales, agrégées et longitudinales.</p>
<p>Une collecte de données sur la pollution atmosphérique et sonore réalisée à vélo (avec différents capteurs et un GPS) sont des données spatiales primaires.</p>
</div>
</div>
</div>
<div id="sect023" class="section level2">
<h2><span class="header-section-number">2.3</span> Statistique descriptive et statistique inférentielle</h2>
<div id="sect0231" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Population, échantillon et inférence</h3>
<p>Les notions de <strong>population</strong> et d’<strong>échantillon</strong> sont essentielles en statistique puisqu’elles sont le socle de l’inférence statistique.
Un échantillon est un <strong>sous-ensemble représentatif</strong> d’une population donnée. Prenons un exemple concret : une chercheure veut comprendre la mobilité des personnes étudiant dans une université. Bien entendu, elle ne peut interroger toutes les personnes étudiantes de son université. Elle devra donc s’assurer d’obtenir un échantillon de taille suffisante et représentatif de la population étudiante. Une fois les données collectées (avec un sondage par exemple), elle pourra utiliser des techniques inférentielles pour analyser la mobilité des personnes interrogées. Si son échantillon est représentatif, les résultats obtenus pourront être inférés – c’est-à-dire généralisés, extrapolés – à l’ensemble de la population.</p>
<div class="bloc_aller_loin">
<p><strong>Les méthodes d’échantillonnage</strong></p>
<p>Nous n’abordons pas ici les méthodes d’échantillonnage. Sachez toutefois qu’il existe plusieurs méthodes probabilistes pour constituer un échantillon, notamment de manière aléatoire, systématique, stratifiée, par grappes. Consultez par exemple cette publication de Statistique Canada (<a href="https://www150.statcan.gc.ca/n1/edu/power-pouvoir/ch13/prob/5214899-fra.htm" class="uri">https://www150.statcan.gc.ca/n1/edu/power-pouvoir/ch13/prob/5214899-fra.htm</a>).</p>
</div>
<p>Autre exemple, une autre chercheure souhaite comprendre les facteurs influençant le sentiment de sécurité des cyclistes dans un quartier. De nouveau, elle ne peut pas enquêter sur l’ensemble des cyclistes du quartier et devra constituer un échantillon représentatif. Par la suite, la mise en œuvre de techniques inférentielles lui permettra d’identifier les caractéristiques individuelles (âge, sexe, habiletés à vélo, etc.) et de l’environnement urbain (types de voies empruntés, niveaux de trafic, de pollution, de bruit, etc.) ayant des effets significatifs sur le sentiment de sécurité. Si l’échantillon est représentatif, les résultats pourront être généralisés à l’ensemble des cyclistes du quartier.</p>
</div>
<div id="sect0232" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Deux grandes familles de méthodes statistiques</h3>
<p>Nous distinguons habituellement deux grandes familles de méthodes statistiques : la statistique descriptive et exploratoire et la statistiques inférentielle et confirmatoire. Il existe de nombreuses définitions de ces deux branches de la statistique, celles proposées de Lebart et al. <span class="citation">(<a href="#ref-lebart1995statistique" role="doc-biblioref">1995</a>)</span> étant parmi les plus abouties :</p>
<ul>
<li>« <strong>La statistique descriptive et exploratoire</strong> : elle permet, par des résumés et des graphiques plus ou moins élaborés, de décrire des ensembles de données statistiques, d’établir des relations entre les variables sans faire jouer de rôle privilégié à une variable particulière. Les conclusions ne portent dans cette phase de travail que sur les données étudiées, sans être inférées à une population plus large. L’analyse exploratoire s’appuie essentiellement sur des notions élémentaires telles que des indicateurs de moyenne et de dispersion, sur des représentations graphiques. […]</li>
<li><strong>La statistique inférentielle et confirmatoire</strong> : elle permet de valider ou d’infirmer, à partir de tests statistiques ou de modèles probabilistes, des hypothèses formulées a priori (ou après une phase exploratoire), et d’extrapoler, c’est-à-dire d’étendre certaines propriétés d’un échantillon à une population plus large. Les conclusions obtenues à partir des données vont au-delà de ces données. La statistique confirmatoire fait surtout appel aux méthodes dites explicatives et prévisionnelles, destinées, comme leurs noms l’indiquent, à expliquer puis à prévoir, suivant des règles de décision, une variable privilégiée à l’aide d’une ou plusieurs variables explicatives (régressions multiples et logistiques, analyse de variance, analyse discriminante, segmentation, etc.) » <span class="citation">(Lebart, Morineau et Piron <a href="#ref-lebart1995statistique" role="doc-biblioref">1995</a>, 3:209)</span>.</li>
</ul>
</div>
</div>
<div id="sect024" class="section level2">
<h2><span class="header-section-number">2.4</span> Notion de distribution</h2>
<div class="bloc_objectif">
<p>Dans cette section, nous abordons un concept central de la statistique : les distributions. Prenez le temps de lire cette section à tête reposée et assurez-vous de bien comprendre chaque idée avant de passer à la suivante. N’hésitez pas à y revenir plusieurs fois si nécessaire, car la compréhension de ces concepts est essentielle pour utiliser adéquatement les méthodes que nous abordons dans ce livre.</p>
</div>
<div id="définition-générale" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Définition générale</h3>
<p>En probabilité, nous nous intéressons aux résultats d’expériences. Du point de vue de la théorie des probabilités, lancer un dé, mesurer la pollution atmosphérique, compter le nombre de collisions à une intersection, et demander à une personne d’évaluer son sentiment de sécurité sur une échelle de 1 à 10 sont autant d’expériences pouvant produire des résultats.</p>
<p><strong>Une distribution est un modèle mathématique permettant d’associer pour chaque résultat possible d’une expérience la probabilité d’obtenir ce résultat</strong>. D’un point de vue pratique, si nous disposons de la distribution régissant l’expérience : « mesurer la concentration d’ozone à Montréal à 13 h en été », nous pouvons calculer la probabilité de mesurer une valeur inférieure à 15 μg/m<sup>3</sup>.</p>
<div class="bloc_attention">
<p><strong>Loi de probabilité et distribution</strong></p>
<p>L’utilisation que nous faisons ici du terme « distribution » est un anglicisme (éhonté diront certaines personnes). En effet, en français, la définition précédente est plus proche du terme « loi de probabilité ». Cependant, la quasi-totalité de la documentation sur R est en anglais et, dans la pratique, ces deux termes ont tendance à se confondre. Nous avons donc fait le choix de poursuivre avec ce terme dans le reste du livre.</p>
</div>
<p>Une distribution est toujours définie dans un intervalle en dehors duquel elle n’est définie; les valeurs dans cet intervalle sont appelées <strong>l’espace d’échantillonnage</strong>. Il s’agit donc des valeurs possibles que peut produire l’expérience. La somme des probabilités de l’ensemble des valeurs de l’espace d’échantillonnage est 1 (100 %). Intuitivement, cela signifie que si nous réalisons l’expérience, nous obtenons nécessairement un résultat, et que la somme des probabilités est répartie entre tous les résultats possibles de l’expérience. En langage mathématique, nous disons que l’intégrale de la fonction de densité d’une distribution est 1 dans son intervalle de définition.</p>
<p>Prenons un exemple concret avec l’expérience suivante : tirer à pile ou face avec une pièce de monnaie non truquée. Si l’on souhaite décrire la probabilité d’obtenir pile ou face, nous pouvons utiliser une distribution qui aura comme espace d’échantillonnage [pile; face] et ces deux valeurs auront chacune comme probabilité 0,5. Il est facile d’étendre cet exemple au cas d’un dé à six faces. La distribution de probabilité décrivant l’expérience « lancer le dé » a pour espace d’échantillonnage [1,2,3,4,5,6], chacune de ces valeurs étant associée à la probabilité de 1/6.</p>
<p>Chacune des deux expériences précédentes est régie par une distribution appartenant à la famille des distributions <strong>discrètes</strong>. Elles servent à représenter des expériences dont le nombre de valeurs possibles est fini. Par opposition, la seconde famille de distributions regroupe les distributions <strong>continues</strong>, décrivant des expériences dont le nombre de résultats possibles est en principe infini. Par exemple, mesurer la taille d’une personne adulte sélectionnée au hasard peut produire en principe un nombre infini de valeurs. Les distributions sont utiles pour décrire les résultats potentiels d’une expérience. Reprenons notre exemple du dé. Nous savons que chaque face a une chance sur six d’être tirée au hasard. Nous pouvons représenter cette distribution avec un graphique (figure @ref(fig:fig251)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig251-1.png" alt="Distribution théorique d'un lancer de dé" width="50%" />
<p class="caption">
(#fig:fig251)Distribution théorique d’un lancer de dé
</p>
</div>
<p>Nous avons donc sous les yeux un modèle statistique décrivant le comportement attendu d’un dé, soit sa distribution <strong>théorique</strong>. Cependant, si nous effectuons dix fois l’expérience (nous collectons donc un échantillon), nous obtiendrons une distribution différente de cette distribution théorique (figure @ref(fig:fig252)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig252-1.png" alt="Distribution empirique d'un lancer de dé (n=10)" width="50%" />
<p class="caption">
(#fig:fig252)Distribution empirique d’un lancer de dé (n=10)
</p>
</div>
<p>Il s’agit de la distribution <strong>empirique</strong>. Chaque échantillon aura sa propre distribution empirique. Cependant, comme le prédit la loi des grands nombres : si une expérience est répétée un grand nombre de fois, la probabilité empirique d’un résultat se rapproche de la probabilité théorique à mesure que le nombre de répétitions augmente. Du point de vue de la théorie des probabilités, chaque échantillon correspond à un ensemble de tirages aléatoires effectués à partir de la distribution théorique du phénomène étudié.</p>
<div style="page-break-after: always;"></div>
<p>Pour nous en convaincre, collectons trois échantillons de lancer de dé de respectivement 30, 100 et 1000 observations (figure @ref(fig:fig253)). Comme le montre la figure @ref(fig:fig252), nous connaissons la distribution théorique qui régit cette expérience.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig253-1.png" alt="Distribution empirique d'un lancer de dé" width="70%" />
<p class="caption">
(#fig:fig253)Distribution empirique d’un lancer de dé
</p>
</div>
<p>Nous constatons bien qu’au fur et à mesure que la taille de l’échantillon augmente, nous tendons vers la distribution théorique.</p>
<p>Cette relation a été étudiée pour la première fois au XVIII<sup>e</sup> siècle par le mathématicien Daniel Bernoulli, qui a montré que la probabilité que la moyenne d’une distribution empirique soit éloignée de la moyenne de la distribution théorique dont elle est tirée diminuait lorsque nous augmentons le nombre des tirages et donc la taille de l’échantillon. Un autre mathématicien, Siméon-Denis Poisson, a fait connaître cette relation sous le nom de « loi des grands nombres ».</p>
<p>Les distributions théoriques sont utilisées pour modéliser des phénomènes réels et sont à la base de presque tous les tests statistiques d’inférence fréquentiste ou bayésienne. En pratique, la question que nous nous posons le plus souvent est : quelle distribution théorique peut le mieux décrire le phénomène empirique à l’étude? Pour répondre à cette question, deux approches sont possibles :</p>
<ul>
<li>Considérant la littérature existante sur le sujet, les connaissances accumulées et la nature de la variable étudiée, sélectionner des distributions théoriques pouvant vraisemblablement correspondre au phénomène mesuré.</li>
<li>Comparer visuellement ou à l’aide de tests statistiques la distribution empirique de la variable et diverses distributions théoriques pour trouver la plus adaptée.</li>
</ul>
<p>Idéalement, le choix d’une distribution théorique devrait reposer sur ces deux méthodes combinées.</p>
</div>
<div id="anatomie-dune-distribution" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Anatomie d’une distribution</h3>
<p>Une distribution (ou loi de probabilité) est une fonction. Il est possible de la représenter à l’aide d’une formule mathématique (appelée <strong>fonction de masse</strong> pour les distributions discrètes et <strong>fonction de densité</strong> pour les distributions continues) associant chaque résultat possible de l’expérience régie par la distribution à la probabilité d’observer ce résultat. Prenons un premier exemple concret avec la distribution théorique associée au lancer de pièce de monnaie : la distribution de <strong>Bernoulli</strong>. Sa formule est la suivante :</p>

<p><span class="math display">\[\begin{equation} f(x ; p)=\left\{\begin{array}{ll}
q=1-p &amp; \text { si } x=0 \\
p &amp; \text { si } x=1
\end{array}\right.
(\#eq:Bernoulli)
\end{equation}\]</span>
</p>
<p>avec <em>p</em> la probabilité d’obtenir <span class="math inline">\(x = 1\)</span> (pile), et <span class="math inline">\(1 – p\)</span> la probabilité d’avoir <span class="math inline">\(x = 0\)</span> (face). La distribution de Bernoulli ne dépend que d’un paramètre : <em>p</em>. Avec différentes valeurs de <em>p</em>, nous pouvons obtenir différentes formes pour la distribution de Bernoulli. Si <em>p</em> = 1/2, la distribution de Bernoulli décrit parfaitement l’expérience : obtenir pile à un lancer de pièce de monnaie. Si <em>p</em> = 1/6, elle décrit alors l’expérience : obtenir 4 (tout comme n’importe quelle valeur de 1 à 6) à un lancer de dé. Pour un exemple plus appliqué, la distribution de Bernoulli est utilisée en analyse spatiale pour étudier la concentration d’accidents de la route ou de crimes en milieu urbain. À chaque endroit du territoire, il est possible de calculer la probabilité qu’un tel évènement ait lieu ou non en modélisant les données observées au moyen de la loi de Bernoulli.
La distribution continue la plus simple à décrire est certainement la distribution <strong>uniforme</strong>. Il s’agit d’une distribution un peu spéciale puisqu’elle attribue la même probabilité à toutes ses valeurs dans son espace d’échantillonnage. Elle est définie sur l’intervalle <span class="math inline">\([-\infty; +\infty]\)</span> et a la fonction de densité suivante :</p>

<p><span class="math display">\[\begin{equation} f(x ; \mathrm{a} ; \mathrm{b})=\left\{\begin{array}{cc}
\frac{1}{a-b} &amp; \text { si } a \geq x \geq b \\
0 &amp; \text { sinon }
\end{array}\right.
(\#eq:Uniforme)
\end{equation}\]</span>
</p>
<p>La fonction de densité de la distribution uniforme a donc deux paramètres, <em>a</em> et <em>b</em>, représentant respectivement les valeurs maximale et minimale au-delà desquelles les valeurs ont une probabilité 0 d’être obtenues. Pour avoir une meilleure intuition de ce que décrit une fonction de densité, il est intéressant de la représenter avec un graphique (figure @ref(fig:fig254)). Notez que sur ce graphique, l’axe des ordonnées n’indique pas précisément la probabilité associée à chaque valeur, car celle-ci est infinitésimale. Il sert uniquement à représenter la valeur de la fonction de densité de la distribution pour chaque valeur de x.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig254-1.png" alt="Distributions uniformes continues" width="60%" />
<p class="caption">
(#fig:fig254)Distributions uniformes continues
</p>
</div>
<p>Nous observons clairement que toutes les valeurs de <em>x</em> entre <em>a</em> et <em>b</em> ont la même probabilité pour chacune de trois distributions uniformes présentées dans le graphique. Plus l’étendue est grande (<span class="math inline">\(a-b\)</span>), plus l’espace d’échantillonnage est grand et plus la probabilité totale est répartie dans cet espace. Cette distribution est donc idéale pour décrire un phénomène pour lequel chaque valeur a autant de chance de se produire qu’une autre. Prenons pour exemple un cas fictif avec un jeu de hasard qui vous proposerait la situation suivante : en tirant sur la manette d’une machine à sous, un nombre est tiré aléatoirement entre -60 et +50. Si le nombre est négatif, vous perdez de l’argent et inversement si le nombre est positif. Nous pouvons représenter cette situation avec une distribution uniforme continue et l’utiliser pour calculer quelques informations essentielles :</p>
<ol style="list-style-type: decimal">
<li>Selon cette distribution, quelle est la probabilité de gagner de l’argent lors d’un tirage (x &gt; 0)?</li>
<li>Quelle est la probabilité de perdre de l’argent (x &lt; 0)?</li>
<li>Si je perds moins de 30 $ au premier tirage, quelle est la probabilité que j’ai de récupérer au moins ma mise au second tirage (x &gt; 30)?</li>
</ol>
<p>Il est assez facile de calculer ces probabilités en utilisant la fonction <code>punif</code> dans R. Concrètement, cela permet de calculer l’intégrale de la fonction de masse sur un intervalle donné.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1"></a><span class="co"># Probabilité d&#39;obtenir une valeur supérieure ou égale à 0</span></span>
<span id="cb226-2"><a href="#cb226-2"></a><span class="kw">punif</span>(<span class="dv">0</span>,<span class="dt">min =</span> <span class="dv">-60</span>, <span class="dt">max =</span> <span class="dv">50</span>)</span></code></pre></div>
<pre><code>## [1] 0.5454545</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1"></a><span class="co"># Probabilité d&#39;obtenir une valeur inférieure à 0</span></span>
<span id="cb228-2"><a href="#cb228-2"></a><span class="kw">punif</span>(<span class="dv">0</span>,<span class="dt">min =</span> <span class="dv">-60</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">lower.tail =</span> F)</span></code></pre></div>
<pre><code>## [1] 0.4545455</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1"></a><span class="co"># Probabilité d&#39;obtenir une valeur supérieure à 30</span></span>
<span id="cb230-2"><a href="#cb230-2"></a><span class="kw">punif</span>(<span class="dv">30</span>, <span class="dt">min =</span> <span class="dv">-60</span>, <span class="dt">max =</span> <span class="dv">50</span>,<span class="dt">lower.tail =</span> F)</span></code></pre></div>
<pre><code>## [1] 0.1818182</code></pre>
<p>Les paramètres permettent donc d’ajuster la fonction de masse ou de densité d’une distribution afin de lui permettre de prendre des formes différentes. Certains paramètres changent la localisation de la distribution (la déplacer vers la droite ou la gauche de l’axe des X), d’autres changent son degré de dispersion (distribution pointue ou aplatie) ou encore sa forme (symétrie). Les différents paramètres d’une distribution correspondent donc à sa carte d’identité et donnent une idée précise sur sa nature.</p>
<div class="bloc_aller_loin">
<p><strong>Fonction de répartition, de survie et d’intensité</strong></p>
<p>Si les fonctions de densité ou de masse d’une distribution sont le plus souvent utilisée pour décrire une distribution, d’autres types de fonctions peuvent également être employées et disposent de propriétés intéressantes.</p>
<ol style="list-style-type: decimal">
<li>La fonction de répartition : il s’agit d’une fonction décrivant le cumul de probabilités d’une distribution. Cette fonction a un minimum de zéro qui est obtenu pour la plus petite valeur de l’espace d’échantillonnage de la distribution, et un maximum d’un pour la plus grande valeur de ce même espace. Formellement, la fonction de répartition (<span class="math inline">\(F\)</span>) est l’intégrale de la fonction de densité (<span class="math inline">\(f\)</span>).</li>
</ol>
<p><span class="math display">\[F(x) = \int_{-\infty}^{x}f(u)du\]</span>
2. La fonction de survie : soit l’inverse additif de la fonction de répartition (<span class="math inline">\(R\)</span>)</p>
<p><span class="math display">\[R(x) = 1-F(x)\]</span>
3. La fonction de d’intensité, soit le quotient de la fonction de densité et de la fonction de survie (<span class="math inline">\(D\)</span>).
<span class="math display">\[D(x) = \frac{f(x)}{D(x)}\]</span>
Ces fonctions jouent notamment un rôle central dans la modélisation des phénomènes qui régissent la survenue des événements, par exemple la mort, les accidents de la route ou les bris d’équipement.</p>
</div>
</div>
<div id="principales-distributions" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Principales distributions</h3>
<p>Il existe un très grand nombre de distributions théoriques et parmi elles, de nombreuses sont en fait des cas spéciaux d’autres distributions. Pour un petit aperçu du « bestiaire », vous pouvez faire un saut à la page <a href="http://www.math.wm.edu/~leemis/chart/UDR/UDR.html" target="_blank"><em>Univariate Distribution Relationships</em></a>, qui liste près de 80 distributions.</p>
<p>Nous nous concentrons ici sur une sélection de dix-huit distributions très répandues en sciences sociales. La figure @ref(fig:figdistribs) présente graphiquement leurs fonctions de masse et de densité présentées dans cette section. Notez que ces graphiques correspondent tous à une forme possible de chaque distribution. En modifiant leurs paramètres, il est possible de produire une figure très différente. Les distributions discrètes sont représentées avec des graphiques en barre, et les distributions continues avec des graphiques de densité.</p>
<p>(ref:figdistribs) Dix-huit distributions essentielles, figure inspirée de <span class="citation">Sean (<a href="#ref-SeanOwendist" role="doc-biblioref">2018</a>)</span></p>
<div class="figure" style="text-align: center">
<img src="images/distributions/all_distributions.png" alt="(ref:figdistribs)" width="95%" />
<p class="caption">
(#fig:figdistribs)(ref:figdistribs)
</p>
</div>
<div id="distribution-uniforme-discrète" class="section level4">
<h4><span class="header-section-number">2.4.3.1</span> Distribution uniforme discrète</h4>
<p>Nous avons déjà abordé cette distribution dans les exemples précédents. Elle permet de décrire un phénomène dont tous les résultats possibles ont exactement la même probabilité de se produire. L’exemple classique est bien sûr un lancer de dé.</p>
</div>
<div id="distribution-de-bernoulli" class="section level4">
<h4><span class="header-section-number">2.4.3.2</span> Distribution de Bernoulli</h4>
<p>La distribution de Bernoulli permet de décrire une expérience pour laquelle deux résultats sont possibles. Son espace d’échantillonnage est donc <span class="math inline">\([0; 1]\)</span>. Sa fonction de masse est la suivante :</p>

<p><span class="math display">\[\begin{equation} f(x ; p)=\left\{\begin{array}{ll}
q=1-p &amp; \text { si } x=0 \\
p &amp; \text { si } x=1
\end{array}\right.
(\#eq:BernoulliB)
\end{equation}\]</span>
</p>
<p>avec <em>p</em> la probabilité d’obtenir <span class="math inline">\(x = 1\)</span> (réussite) et donc <span class="math inline">\(1 – p\)</span> la probabilité d’avoir <span class="math inline">\(x = 0\)</span> (échec). La distribution de Bernoulli ne dépend que d’un paramètre : <em>p</em>, contrôlant la probabilité de réussite de l’expérience. Notez que si <span class="math inline">\(p = 1/2\)</span>, alors la distribution de Bernoulli est également une distribution uniforme. Un exemple d’application de la distribution de Bernoulli en études urbaines est la modélisation de la survie d’un ou d’une cycliste (1 pour survie, 0 pour décès) lors d’une collision avec un véhicule motorisé, selon une vitesse donnée.</p>
</div>
<div id="distribution-binomiale" class="section level4">
<h4><span class="header-section-number">2.4.3.3</span> Distribution binomiale</h4>
<p>La distribution binomiale est utilisée pour caractériser la somme de variables aléatoires (expériences) suivant chacune une distribution de Bernoulli. Un exemple simple est l’accumulation des lancers d’une pièce de monnaie. Si nous comptons le nombre de fois où nous obtenons pile, cette expérience est décrite par une distribution binomiale. Son espace d’échantillonnage est donc <span class="math inline">\([0; +\infty[\)</span> (limité aux nombres entiers). Sa fonction de masse est la suivante :</p>

<p><span class="math display">\[\begin{equation} 
    f(x ; n )=\binom{n}{x}p^x(1-p)^{n-x}
(\#eq:Binomial)
\end{equation}\]</span>
</p>
<p>avec <em>x</em> le nombre de tirages réussis sur <em>n</em> essais avec une probabilité <em>p</em> de réussite à chaque tirage (figure @ref(fig:fig256)). Pour reprendre l’exemple précédent concernant les accidents de la route, une distribution binomiale permettrait de représenter la distribution du nombre de cyclistes ayant survécu sur dix personnes à vélo impliquées dans un accident avec une voiture à une intersection.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig256-1.png" alt="Distribution binomiale" width="95%" />
<p class="caption">
(#fig:fig256)Distribution binomiale
</p>
</div>
</div>
<div id="distribution-géométrique" class="section level4">
<h4><span class="header-section-number">2.4.3.4</span> Distribution géométrique</h4>
<p>La distribution géométrique permet de représenter le nombre de tirages qu’il faut faire avec une distribution de Bernoulli avant d’obtenir une réussite. Par exemple, avec un lancer de dé, l’idée serait de compter le nombre de lancers nécessaires avant de tomber sur un 6. Son espace d’échantillonnage est donc <span class="math inline">\([1; +\infty[\)</span> (limité aux nombres entiers). Sa distribution de masse est la suivante :</p>

<p><span class="math display">\[\begin{equation} f(x; p)= (1-p)^xp
(\#eq:geometrique)
\end{equation}\]</span>
</p>
<p>avec <em>x</em> le nombre de tentatives avant d’obtenir une réussite, <span class="math inline">\(f(x)\)</span> la probabilité que le premier succès n’arrive qu’après <em>x</em> tentatives et <em>p</em> la probabilité de réussite à chaque tentative (figure @ref(fig:fig257)). Cette distribution est notamment utilisée en marketing pour modéliser le nombre d’appels nécessaires avant de réussir une vente.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig257-1.png" alt="Distribution géométrique" width="95%" />
<p class="caption">
(#fig:fig257)Distribution géométrique
</p>
</div>
</div>
<div id="distribution-binomiale-négative" class="section level4">
<h4><span class="header-section-number">2.4.3.5</span> Distribution binomiale négative</h4>
<p>La distribution binomiale négative est proche de la distribution géométrique. Elle permet de représenter le nombre de tentatives nécessaires afin d’obtenir un nombre <em>n</em> de réussites <span class="math inline">\([1; +\infty[\)</span> (limité aux nombres entiers positifs). Sa formule est la suivante :</p>

<p><span class="math display">\[\begin{equation} f(x; n; p)=\left(\begin{array}{c}
x+n-1 \\
n
\end{array}\right) p^{n}(1-p)^{x}
(\#eq:binomialnegative)
\end{equation}\]</span>
</p>
<p>avec <em>x</em> le nombre de tentatives avant d’obtenir <em>n</em> réussites et <em>p</em> la probabilité d’obtenir une réussite à chaque tentative (figure @ref(fig:fig258)). Cette distribution pourrait être utilisée pour modéliser le nombre de questionnaires <em>x</em> à envoyer pour une enquête pour obtenir au moins <em>n</em> réponses, sachant que la probabilité d’une réponse est <em>p</em>.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig258-1.png" alt="Distribution binomiale négative" width="95%" />
<p class="caption">
(#fig:fig258)Distribution binomiale négative
</p>
</div>
</div>
<div id="distribution-de-poisson" class="section level4">
<h4><span class="header-section-number">2.4.3.6</span> Distribution de Poisson</h4>
<p>La distribution de Poisson est utilisée pour modéliser des comptages. Son espace d’échantillonnage est donc <span class="math inline">\([0; +\infty[\)</span> (limité aux nombres entiers positifs). Par exemple, il est possible de compter à une intersection le nombre de collisions entre des automobilistes et des cyclistes sur une période donnée. Cet exemple devrait vous faire penser à la distribution binomiale vue plus haut. En effet, il est possible de noter chaque rencontre entre une voiture et un ou une cycliste et de considérer que leur collision est une « réussite » (0 : pas d’accidents, 1 : accident). Cependant, ce type de données est fastidieux à collecter comparativement au simple comptage des accidents. La distribution de Poisson a une fonction de densité avec un seul paramètre généralement noté <span class="math inline">\(\lambda\)</span> (lambda) et est décrite par la formule suivante :</p>

<p><span class="math display">\[\begin{equation} f(x; \lambda)=\frac{\lambda^{x}}{x !} e^{-\lambda}
(\#eq:poisson)
\end{equation}\]</span>
</p>
<p>avec <em>x</em> le nombre de cas, <em>f(x)</em> la probabilité d’obtenir <em>x</em> sachant <span class="math inline">\(\lambda\)</span>. <span class="math inline">\(\lambda\)</span> peut être vu comme le taux moyen d’occurrences (nombre d’évènements divisé par la durée totale de l’expérience). Il permet à la fois de caractériser le centre et la dispersion de la distribution. Notez également que plus le paramètre <span class="math inline">\(\lambda\)</span> augmente, plus la distribution de Poisson tend vers une distribution normale.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig259-1.png" alt="Distribution de Poisson" width="95%" />
<p class="caption">
(#fig:fig259)Distribution de Poisson
</p>
</div>
</div>
<div id="sectpoissonzero" class="section level4">
<h4><span class="header-section-number">2.4.3.7</span> Distribution de Poisson avec excès de zéros</h4>
<p>Il arrive régulièrement qu’une variable de comptage mesurée produise un très grand nombre de zéros. Prenons pour exemple le nombre de seringues de drogue injectable par tronçon de rue ramassées sur une période d’un mois. À l’échelle de toute une ville, un très grand nombre de tronçons n’auront tout simplement aucune seringue et dans ce contexte, la distribution classique de Poisson n’est pas adaptée. Nous lui préfèrons alors une autre distribution : la distribution de Poisson avec excès de zéros (ou distribution de Pólya) qui inclut un paramètre contrôlant la forte présence de zéros. Sa fonction de densité est la suivante :</p>

<p><span class="math display">\[\begin{equation} f(x; \lambda; p)=(1-p)\frac{\lambda^{x}}{x !} e^{-\lambda}
(\#eq:poissonzi)
\end{equation}\]</span>
</p>
<p>Plus exactement, la distribution de Poisson avec excès de zéro (<em>zero-inflated</em> en anglais) est une combinaison de deux processus générant des zéros. En effet, un zéro peut être produit par la distribution de Poisson proprement dite (aussi appelé vrai zéro) ou alors par le processus générant les zéros excédentaires dans le jeu de données, capturé par la probabilité <em>p</em> (faux zéro). <em>p</em> est donc le paramètre contrôlant la probabilité d’obtenir un zéro, indépendamment du phénomène étudié.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig259b-1.png" alt="Distribution de Poisson avec excès de zéros" width="95%" />
<p class="caption">
(#fig:fig259b)Distribution de Poisson avec excès de zéros
</p>
</div>
</div>
<div id="distribution-gaussienne" class="section level4">
<h4><span class="header-section-number">2.4.3.8</span> Distribution gaussienne</h4>
<p>Plus communément appelée la distribution normale, la distribution gaussienne est utilisée pour représenter des variables continues centrées sur leur moyenne. Son espace d’échantillonnage est <span class="math inline">\(]-\infty; +\infty[\)</span>. Cette distribution joue un rôle central en statistique. Selon la formule consacrée, cette distribution résulte de la superposition d’un très grand nombre de petits effets fortuits indépendants. C’est ce qu’exprime formellement le théorème central limite qui montre que la somme d’un grand nombre de variables aléatoires tend généralement vers une distribution normale. Autrement dit, lorsque nous répétons une même expérience et que nous conservons les résultats de ces expériences, la distribution du résultat de ces expériences tend vers la normalité. Cela s’explique par le fait qu’en moyenne, chaque répétition de l’expérience produit le même résultat, mais qu’un ensemble de petits facteurs aléatoires viennent ajouter de la variabilité dans les données collectées. Prenons un exemple concret : si nous plantons une centaine d’arbres simultanément dans un parc avec un degré d’ensoleillement identique et que nous leur apportons les mêmes soins pendant dix ans, la distribution de leurs tailles suivra une distribution normale. Un ensemble de facteurs aléatoires (composition du sol, exposition au vent, aléas génétiques, passage de nuages, etc.) auront affecté différemment chaque arbre, ajoutant ainsi un peu de hasard dans leur taille finale. Cette dernière est cependant davantage affectée par des paramètres majeurs (comme l’espèce, l’ensoleillement, l’arrosage, etc.), et est donc centrée autour d’une moyenne.
La fonction de densité de la distribution normale est la suivante :</p>

<p><span class="math display">\[\begin{equation} f(x ; \mu ; \sigma)=\frac{1}{\sigma \sqrt{2 \pi}} e^{-\frac{1}{2}\left(\frac{x-\mu}{\sigma}\right)^{2}}
(\#eq:gaussien)
\end{equation}\]</span>
</p>
<p>avec <em>x</em> une valeur dont nous souhaitons connaître la probabilité, <em>f(x)</em> sa probabilité, <span class="math inline">\(\mu\)</span> (mu) la moyenne de la distribution normale (paramètre de localisation) et <span class="math inline">\(\sigma\)</span> (sigma) son écart-type (paramètre de dispersion). Cette fonction suit une courbe normale ayant une forme de cloche. Notez que :</p>
<ul>
<li>68,2 % de la masse de la distribution normale est comprise dans l’intervalle <span class="math inline">\([\mu- \sigma≤x≤ \mu+ \sigma]\)</span></li>
<li>95,4 % dans l’intervalle <span class="math inline">\([\mu- 2\sigma≤x≤ \mu+ 2\sigma]\)</span></li>
<li>99,7 % dans l’intervalle <span class="math inline">\([\mu- 3\sigma≤x≤ \mu+ 3\sigma]\)</span></li>
</ul>
<p>Autrement dit, dans le cas d’une distribution normale, il est très invraisemblable d’observer des données situées à plus de trois écarts types de la moyenne. Ces différentes égalités sont vraies <strong>quelles ques soient les valeurs de la moyenne et de l’écart-type</strong>.
Notez ici que lorsque <span class="math inline">\(\mu = 0\)</span> et <span class="math inline">\(\sigma = 1\)</span>, nous obtenons la loi normale générale (ou centrée réduite) (section @ref(sect02552)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig260-1.png" alt="Distribution gaussienne" width="70%" />
<p class="caption">
(#fig:fig260)Distribution gaussienne
</p>
</div>
</div>
<div id="distribution-gaussienne-asymétrique" class="section level4">
<h4><span class="header-section-number">2.4.3.9</span> Distribution gaussienne asymétrique</h4>
<p>La distribution normale asymétrique (<em>skew-normal</em>) est une extension de la distribution gaussienne permettant de lever la contrainte de symétrie de la simple distribution gaussienne. Son espace d’échantillonnage est donc <span class="math inline">\(]-\infty; +\infty[\)</span>. Sa fonction de densité est la suivante :</p>

<p><span class="math display">\[\begin{equation} f(x;\xi;\omega;\alpha) = \frac{2}{\omega \sqrt{2 \pi}} e^{-\frac{(x-\xi)^{2}}{2 \omega^{2}}} \int_{-\infty}^{\alpha\left(\frac{x-\xi}{\omega}\right)} \frac{1}{\sqrt{2 \pi}} e^{-\frac{t^{2}}{2}} d t
(\#eq:skewgaussien)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(\xi\)</span> (xi) le paramètre de localisation, <span class="math inline">\(\omega\)</span> (omega) le paramètre de dispersion (ou d’échelle) et <span class="math inline">\(\alpha\)</span> (alpha) le paramètre de forme (contrôlant le degré de symétrie). Si <span class="math inline">\(\alpha = 0\)</span>, alors la distribution normale asymétrique est une distribution normale ordinaire. Ce type de distribution est très utile lorsque nous souhaitons modéliser une variable pour laquelle nous savons que des valeurs plus extrêmes s’observeront d’un côté ou de l’autre de la distribution. Les revenus totaux annuels des personnes ou des ménages sont de très bons exemples puisqu’ils sont distribués généralement avec une asymétrie positive : bien qu’une moyenne existe, il y a généralement plus de personnes ou de ménages avec des revenus très faibles que de personnes ou de ménages avec des revenus très élevés.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig261-1.png" alt="Distribution gaussienne asymétrique" width="70%" />
<p class="caption">
(#fig:fig261)Distribution gaussienne asymétrique
</p>
</div>
</div>
<div id="distribution-log-normale" class="section level4">
<h4><span class="header-section-number">2.4.3.10</span> Distribution log-normale</h4>
<p>Au même titre que la distribution normale asymétrique, la distribution log-normale est une version asymétrique de la distribution normale. Son espace d’échantillonnage est <span class="math inline">\(]0; +\infty[\)</span>. Cela signifie que cette distribution ne peut décrire que des données continues et positives. Sa fonction de densité est la suivante :

<span class="math display">\[\begin{equation} f(x ; \mu ; \sigma)=\frac{1}{x \sigma \sqrt{2 \pi}} e^{-\left(\frac{(\ln x-\mu)^{2}}{2 \sigma^{2}}\right)}
(\#eq:loggaussien)
\end{equation}\]</span>
</p>
<p>À la différence la distribution <em>skew-normal</em>, la distribution log-normale ne peut avoir qu’une asymétrie positive (étirée vers la droite). Elle est cependant intéressante puisqu’elle ne compte que deux paramètres (<span class="math inline">\(\mu\)</span> et <span class="math inline">\(\sigma\)</span>), ce qui la rend plus facile à ajuster. À nouveau, une distribution log-normale peut être utilisée pour décrire les revenus totaux annuels des individus ou des ménages ou les revenus d’emploi. Elle est aussi utilisée en économie sur les marchés financiers pour représenter les cours des actions et des biens (ces derniers ne pouvant pas être inférieurs à 0).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig262-1.png" alt="Distribution log-gaussienne" width="70%" />
<p class="caption">
(#fig:fig262)Distribution log-gaussienne
</p>
</div>
<p>Plus spécifiquement, la distribution log-normale est une transformation de la distribution normale. Comme son nom l’indique, elle permet de décrire le logarithme d’une variable aléatoire suivant une distribution normale.</p>
</div>
<div id="sect024311" class="section level4">
<h4><span class="header-section-number">2.4.3.11</span> Distribution de Student</h4>
<p>La distribution de Student joue un rôle important en statistique. Elle est par exemple utilisée lors du test <em>t</em> pour calculer le degré de significativité du test. Comme la distribution gaussienne, la distribution de Student a une forme de cloche, est centrée sur sa moyenne et définie sur <span class="math inline">\(]-\infty; +\infty[\)</span>. Elle se distingue de la distribution normale principalement par le rôle que joue son troisième paramètre, <span class="math inline">\(\nu\)</span> : le nombre de degrés de liberté, contrôlant le poids des queues de la distribution. Une petite valeur de <span class="math inline">\(\nu\)</span> signifie que la distribution a des « queues plus lourdes » (<em>heavy tails</em> en anglais). Entendez par-là que les valeurs extrêmes ont une plus grande probabilité d’occurrence :</p>

<p><span class="math display">\[\begin{equation} p(x ; \nu ; \hat{\mu} ; \hat{\sigma})=\frac{\Gamma\left(\frac{\nu+1}{2}\right)}{\Gamma\left(\frac{\nu}{2}\right) \sqrt{\pi \nu} \hat{\sigma}}\left(1+\frac{1}{\nu}\left(\frac{x-\hat{\mu}}{\hat{\sigma}}\right)^{2}\right)^{-\frac{\nu+1}{2}}
(\#eq:student)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(\mu\)</span> le paramètre de localisation, <span class="math inline">\(\sigma\)</span> le paramètre de dispersion (qui n’est cependant pas un écart-type comme pour la distribution normale) et <span class="math inline">\(\nu\)</span> le nombre de degrés de liberté. Plus <span class="math inline">\(\nu\)</span> est grand, plus la distribution de Student tend vers une distribution normale. Ici, la lettre grecque <span class="math inline">\(\Gamma\)</span> représente la fonction mathématique gamma (à ne pas confondre avec la distribution Gamma). Un exemple d’application en études urbaines est l’exposition au bruit environnemental de cyclistes. Cette distribution s’approcherait certainement d’une distribution normale, mais les cyclistes croisent régulièrement des secteurs peu bruyants (parcs, rues résidentielles, etc.) et des secteurs très bruyants (artères majeures, zones industrielles, etc.), plus souvent que ce que prévoit une distribution normale, justifiant le choix d’une distribution de Student.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig263-1.png" alt="Distribution de Student" width="70%" />
<p class="caption">
(#fig:fig263)Distribution de Student
</p>
</div>
</div>
<div id="distribution-de-cauchy" class="section level4">
<h4><span class="header-section-number">2.4.3.12</span> Distribution de Cauchy</h4>
<p>La distribution de Cauchy est également une distribution symétrique définie sur l’intervalle <span class="math inline">\(]-\infty; +\infty[\)</span>. Elle a comme particularité d’être plus aplatie que la distribution de Student (d’avoir des queues potentiellement plus lourdes). Elle est notamment utilisée pour modéliser des phénomènes extrêmes comme les précipitations maximales annuelles, les niveaux d’inondations maximaux annuels ou les seuils critiques de perte pour les portefeuilles financiers. Il est également intéressant de noter que le quotient de deux variables indépendantes normalement distribuées suit une distribution de Cauchy. Sa fonction de densité est la suivante :</p>

<p><span class="math display">\[\begin{equation} \frac{1}{\pi \gamma}\left[\frac{\gamma^{2}}{\left(x-x_{0}\right)^{2}+\gamma^{2}}\right]
(\#eq:cauchy)
\end{equation}\]</span>
</p>
<p>Elle dépend donc de deux paramètres : <span class="math inline">\(x_0\)</span>, le paramètre de localisation indiquant le pic de la distribution et <span class="math inline">\(\gamma\)</span>, un paramètre de dispersion.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig264-1.png" alt="Distribution de Cauchy" width="70%" />
<p class="caption">
(#fig:fig264)Distribution de Cauchy
</p>
</div>
</div>
<div id="distribution-du-khi-deux" class="section level4">
<h4><span class="header-section-number">2.4.3.13</span> Distribution du khi-deux</h4>
<p>La distribution du khi-deux est utilisée dans de nombreux tests statistiques. Par exemple, le test du khi-deux de Pearson est utilisé pour comparer les écarts au carré entre des fréquences attendues et observées de deux variables qualitatives.
La distribution du khi-deux décrit plus généralement la somme des carrés d’un nombre <em>k</em> de variables indépendantes normalement distribuées. Il est assez rare de modéliser un phénomène à l’aide d’une distribution du khi-deux, mais son omniprésence dans les tests statistiques justifie qu’elle soit mentionnée ici. Cette distribution est définie sur l’intervalle <span class="math inline">\([0; +\infty[\)</span> et a pour fonction de densité :</p>

<p><span class="math display">\[\begin{equation} f(x;k) = \frac{1}{2^{k / 2} \Gamma(k / 2)} x^{k / 2-1} e^{-x / 2}
(\#eq:chi2)
\end{equation}\]</span>
</p>
<p>La distribution du khi-deux n’a qu’un paramètre <em>k</em>, représentant donc le nombre de variables mises au carré et dont nous faisons la somme pour obtenir la distribution du khi-deux.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig265-1.png" alt="Distribution du khi-deux" width="70%" />
<p class="caption">
(#fig:fig265)Distribution du khi-deux
</p>
</div>
</div>
<div id="distribution-exponentielle" class="section level4">
<h4><span class="header-section-number">2.4.3.14</span> Distribution exponentielle</h4>
<p>La distribution exponentielle est une version continue de la distribution géométrique. Pour cette dernière, nous nous intéressons au nombre de tentatives nécessaires pour obtenir un résultat positif, soit une dimension discrète. Pour la distribution exponentielle, cette dimension discrète est remplacée par une dimension continue. L’exemple le plus intuitif est sûrement le cas du temps. Dans ce cas, la distribution exponentielle sert à modéliser le temps d’attente nécessaire pour qu’un évènement se produise. Il peut aussi s’agir d’une force que nous appliquons jusqu’à ce qu’un matériau cède. Cette distribution est donc définie sur l’intervalle [0; +<span class="math inline">\(\infty\)</span>[ et a pour fonction de densité :</p>

<p><span class="math display">\[\begin{equation} f(x;\lambda) = \lambda e^{-\lambda x}
(\#eq:exponentiel)
\end{equation}\]</span>
</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig266-1.png" alt="Distribution exponentielle" width="70%" />
<p class="caption">
(#fig:fig266)Distribution exponentielle
</p>
</div>
<p>La distribution exponentielle est conceptuellement proche de la distribution de Poisson. La distribution de Poisson régit le nombre des événements qui surviennent au cours d’un laps de temps donné. La distribution exponentielle peur servir à modéliser le temps qui s’écoule entre deux événements.</p>
</div>
<div id="sect024315" class="section level4">
<h4><span class="header-section-number">2.4.3.15</span> Distribution Gamma</h4>
<p>La distribution Gamma peut être vue comme la généralisation d’un grand nombre de distributions. Ainsi, la distribution exponentielle et du khi-deux peuvent être vues comme des cas particuliers de la distribution Gamma. Cette distribution est définie sur l’intervalle ]0; +<span class="math inline">\(\infty\)</span>[ (notez que le 0 est exclu) et sa fonction de densité est la suivante :</p>

<p><span class="math display">\[\begin{equation} f(x ; \alpha; \beta)=\frac{\beta^{\alpha} x^{\alpha-1} e^{-\beta x}}{\Gamma(\alpha)}
(\#eq:gamma)
\end{equation}\]</span>
</p>
<p>Elle comprend donc deux paramètres : <span class="math inline">\(\alpha\)</span> et <span class="math inline">\(\beta\)</span>. Le premier est le paramètre de forme et le second un paramètre d’échelle (à l’inverse d’un paramètre de dispersion, plus sa valeur est petite, plus la distribution est dispersée). Notez que cette distribution ne dispose pas d’un paramètre de localisation. Du fait de sa flexibilité, cette distribution est largement utilisée, que ce soit dans la modélisation des temps d’attente avant un évènement, de la taille des réclamations d’assurance, des quantités de précipitations, etc.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig267-1.png" alt="Distribution Gamma" width="70%" />
<p class="caption">
(#fig:fig267)Distribution Gamma
</p>
</div>
</div>
<div id="sect024316" class="section level4">
<h4><span class="header-section-number">2.4.3.16</span> Distribution bêta</h4>
<p>La distribution bêta est définie sur l’intervalle [0; 1], elle est donc énormément utilisée pour modéliser des variables étant des proportions ou des probabilités.</p>
<p>La distribution bêta a été élaborée pour modéliser la superposition d’un très grand nombre de petits effets fortuits qui ne sont pas indépendants et notamment pour étudier l’effet de la réalisation d’un événement aléatoire sur la probabilité des tirages subséquents. Elle a aussi une utilité pratique en statistique, car elle peut être combinée avec d’autres distributions (distribution beta-binomiale, beta-negative-binomiale, etc.). Un autre usage plus rare mais intéressant est la modélisation de la fraction du temps représentée par une tâche dans le temps nécessaire à la réalisation de deux tâches de façon séquentielle. Cela est dû au fait que la distribution d’une distribution gamma <em>g1</em> divisée par la somme de <em>g1</em> et d’une autre distribution gamma <em>g2</em> suit une distribution beta. Un exemple concret est, par exemple, la fraction du temps effectué à pied dans un déplacement multimodal. La distribution de beta a la fonction de densité suivante :</p>

<p><span class="math display">\[\begin{equation} f(x;\alpha;\beta) = \frac{1}{\mathrm{B}(\alpha, \beta)} x^{\alpha-1}(1-x)^{\beta-1}
(\#eq:beta)
\end{equation}\]</span>
</p>
<p>Elle a donc deux paramètres <span class="math inline">\(\alpha\)</span> et <span class="math inline">\(\beta\)</span> contrôlant tous les deux la forme de la distribution. Cette caractéristique lui permet d’avoir une très grande flexibilité et même d’adopter des formes bimodales. <span class="math inline">\(B\)</span> correspond à la fonction mathématique Beta : ne pas la confondre avec la distribution Beta et le paramètre Beta (<span class="math inline">\(\beta\)</span>) de cette même distribution.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig268-1.png" alt="Distribution Beta" width="70%" />
<p class="caption">
(#fig:fig268)Distribution Beta
</p>
</div>
</div>
<div id="distribution-de-weibull" class="section level4">
<h4><span class="header-section-number">2.4.3.17</span> Distribution de Weibull</h4>
<p>La distribution de Weibull est directement liée à la distribution exponentielle, cette dernière étant en fait un cas particulier de distribution Weibull. Elle sert donc souvent à modéliser une quantité <em>x</em> (souvent le temps) à accumuler pour qu’un évènement se produise. La distribution de Weibull est définie sur l’intervalle [0; +<span class="math inline">\(\infty\)</span>[ et a la fonction de densité suivante :</p>

<p><span class="math display">\[\begin{equation} f(x;\lambda) = \frac{k}{\lambda} (\frac{x}{\lambda})^{k-1} e^{-(\frac{x}{\lambda})^k}
(\#eq:weibull)
\end{equation}\]</span>
</p>
<p><span class="math inline">\(\lambda\)</span> est le paramètre de dispersion (analogue à celui d’une distribution exponentielle classique) et <em>k</em> le paramètre de forme. Pour bien comprendre le rôle de <em>k</em>, prenons un exemple : la propagation d’un champignon d’un arbre à son voisin. Si <span class="math inline">\(k&lt;1\)</span>, le risque instantané que l’évènement modélisé se produise diminue avec le temps (en d’autres termes, plus le temps passe, plus petite devient la probabilité d’être contaminé). Si <span class="math inline">\(k=1\)</span>, alors le risque instantané que l’évènement se produise reste identique dans le temps (la loi de Weibull se résume alors à une loi exponentielle). Si <span class="math inline">\(k &gt; 1\)</span>, alors le risque instantané que l’évènement se produise augmente avec le temps (la probabilité pour un arbre d’être contaminé s’il ne l’a pas déjà été — pas seulement le risque cumulé — augmente en fonction du temps). La distribution de Weibull est très utilisée en analyse de survie, en météorologie, en ingénierie des matériaux et dans la théorie des valeurs extrêmes.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig269-1.png" alt="Distribution de Weibull" width="70%" />
<p class="caption">
(#fig:fig269)Distribution de Weibull
</p>
</div>
</div>
<div id="distribution-pareto" class="section level4">
<h4><span class="header-section-number">2.4.3.18</span> Distribution Pareto</h4>
<p>Cette distribution a été élaborée par Vilfredo Pareto pour donner une forme mathématique à ce qui porte aujourd’hui le nom de principe de Pareto et que nous exprimons souvent de manière imagée — dans une société donnée, 20 % des individus possèdent 80 % de la richesse —, mais qui est plus justement exprimée en écrivant que, de manière générale, dans toute société, la plus grande partie du capital est détenue par une petite fraction de la population. Elle est définie sur l’intervalle <span class="math inline">\([x_m; +\infty[\)</span> avec la fonction de densité suivante :</p>

<p><span class="math display">\[\begin{equation} f(x;x_m;k) = (\frac{x_m}{x})^k
(\#eq:pareto)
\end{equation}\]</span>
</p>
<p>Elle comprend donc deux paramètres, <span class="math inline">\(x_m\)</span> étant un paramètre de localisation (décalant la distribution vers la droite ou vers la gauche) et <span class="math inline">\(k\)</span> un paramètre de forme. Plus <span class="math inline">\(k\)</span> augmente, plus la probabilité prédite par la distribution décroît rapidement.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig270-1.png" alt="Distribution de Pareto" width="70%" />
<p class="caption">
(#fig:fig270)Distribution de Pareto
</p>
</div>
<p>Au-delà de la question de la répartition de la richesse, la distribution de Pareto peut également être utilisée pour décrire la répartition de la taille des villes <span class="citation">(Reed <a href="#ref-William_pareto_ville" role="doc-biblioref">2002</a>)</span>, <a href="https://medium.com/@worstonlinedater/tinder-experiments-ii-guys-unless-you-are-really-hot-you-are-probably-better-off-not-wasting-your-2ddf370a6e9a" target="_blank">la popularité des hommes sur Tinder</a> ou la taille des fichiers échangés sur Internet <span class="citation">(Reed et Jorgensen <a href="#ref-William_pareto" role="doc-biblioref">2004</a>)</span>. Pour ces trois exemples, nous avons les situations suivantes : de nombreuses petites villes, profils peu attractifs, petits fichiers échangés et à l’inverse très peu de grandes villes, profils très attractifs, gros fichiers échangés.</p>
<p>La loi de Pareto est liée à la loi exponentielle. Si une variable aléatoire suit une loi de Pareto, le logarithme du quotient de cette variable et de son paramètre de localisation est une variable aléatoire qui suit une loi exponentielle.</p>
</div>
<div id="cas-particuliers" class="section level4">
<h4><span class="header-section-number">2.4.3.19</span> Cas particuliers</h4>
<p>Sachez également qu’il existe des distributions « plus exotiques » que nous n’abordons pas ici, mais auxquelles vous pourriez être confrontés un jour :</p>
<ul>
<li><p>Les distributions sphériques, servant à décrire des données dont le 0 est équivalent à la valeur maximale. Par exemple, des angles puisque 0 et 360 degrés sont identiques.</p></li>
<li><p>Les distributions composées (<em>mixture distributions</em>), permettant de modéliser des phénomènes issus de la superposition de plusieurs distributions. Par exemple, la distribution de la taille de l’ensemble des êtres humains est en réalité une superposition de deux distributions gaussiennes, une pour chaque sexe, puisque ces deux distributions n’ont pas la même moyenne ni le même écart-type.</p></li>
<li><p>Les distributions multivariées permettant de décrire des phénomènes multidimensionnels. Par exemple, la réussite des élèves en français et en mathématique pourrait être modélisée par une distribution gaussienne bivariée plutôt que deux distributions distinctes. Ce choix serait pertinent si nous présumons que ces deux variables sont corrélées plutôt qu’indépendantes.</p></li>
<li><p>Les distributions censurées décrivant des variables pour lesquelles les données sont issues d’un tirage « censuré ». En d’autres termes, la variable étudiée varie sur une certaine étendue, mais du fait du processus de tirage (collecte des données), les valeurs au-delà de certaines limites sont censurées. Un bon exemple est la mesure de la pollution sonore avec un capteur incapable de détecter des niveaux sonores en dessous de 55 décibels. Il arrive parfois en ville que les niveaux sonores descendent plus bas que ce seuil, mais les données collectées ne le montrent pas. Dans ce contexte, il est important d’utiliser des versions censurées des distributions présentées précédemment. Les observations au-delà de la limite sont conservées dans l’analyse, mais nous ne disposons que d’une information partielle à leur égard (elles sont au-delà de la limite).</p></li>
<li><p>Les distributions tronquées, souvent confondues avec les distributions censurées, décrivent des situations où des données au-delà d’une certaine limite sont impossibles à collecter et retirées simplement de l’analyse.</p></li>
</ul>
</div>
</div>
<div id="conclusion-sur-les-distributions" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Conclusion sur les distributions</h3>
<p>Voilà qui conclut cette exploration des principales distributions à connaître. L’idée n’est bien sûr pas de toutes les retenir par cœur (et encore moins les formules mathématiques), mais plutôt de se rappeler dans quels contextes elles peuvent être utiles. Vous aurez certainement besoin de le relire cette section avant d’aborder le chapitre @ref(chap08) portant sur les modèles linéaires généralisés (GLM).
Wikipédia dispose d’informations très détaillées sur chaque distribution si vous avez besoin d’informations complémentaires. Pour un tour d’horizon plus exhaustif des distributions, vous pouvez aussi faire un tour sur les projets <a href="https://sites.google.com/site/probonto/screenshots" target="_blank">ProbOnto</a> et <a href="https://blog.wolfram.com/2013/02/01/the-ultimate-univariate-probability-distribution-explorer/" target="_blank"><em>the ultimate probability distribution explorer</em></a>.</p>
</div>
</div>
<div id="sect025" class="section level2">
<h2><span class="header-section-number">2.5</span> Statistiques descriptives sur des variables quantitatives</h2>
<div id="sect0251" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Paramètres de tendance centrale</h3>
<p>Trois mesures de tendance centrale permettent de résumer rapidement une variable quantitative :</p>
<ul>
<li>la <strong>moyenne arithmétique</strong> est simplement la somme des données d’une variable divisée par le nombre d’observations (<em>n</em>), soit <span class="math inline">\(\frac{\sum_{i=1}^n x_i}{n}\)</span> notée <span class="math inline">\(\mu\)</span> (prononcé <em>mu</em>) pour des données pour une population et <span class="math inline">\(\bar{x}\)</span> (prononcé <em>x barre</em>) pour un échantillon.</li>
<li>la <strong>médiane</strong> est la valeur qui coupe la distribution d’une variable d’une population ou d’un échantillon en deux parties égales. Autrement dit, 50 % des valeurs des observations lui sont supérieures et 50 % lui sont inférieures.</li>
<li>le <strong>mode</strong> est la valeur la plus fréquente parmi un ensemble d’observations pour une variable. Il s’applique ainsi à des variables discrètes (avec un nombre fini de valeurs discrètes dans un intervalle donné) et non à des variables continues (avec un nombre infini de valeurs réelles dans un intervalle donné). Prenons deux variables : l’une discrète relative au nombre d’accidents par intersection (avec <span class="math inline">\(X \in \left[0,20\right]\)</span>) et l’autre continue relative à la distance de dépassement (en mètres) d’un personne à vélo par un personne conduisant un véhicule motorisé (avec <span class="math inline">\(X \in \left[0,5\right]\)</span>). Pour la première, le mode – la valeur la plus fréquente – est certainement 0. Pour la seconde, identifier le mode n’est pas pertinent puisqu’il peut y avoir un nombre infini de valeurs entre 0 et 5 mètres.</li>
</ul>
<p><strong>Il convient de ne pas confondre moyenne et médiane!</strong> Dans le tableau @ref(tab:tableRevMoyMed), nous avons reporté les valeurs moyennes et médianes des revenus des ménages pour les municipalités de l’île de Montréal en 2015. Par exemple, les 8685 ménages résidant à Wesmount disposaient en moyenne d’un revenu de 295 099 $; la moitié de ces 8685 ménages avaient un revenu inférieur à 100 153 $ et l’autre moitié un revenu supérieur à cette valeur (médiane). Cela démontre clairement que la moyenne peut être grandement affectée par des valeurs extrêmes (faibles ou fortes). Autrement dit, plus l’écart entre les valeurs de la moyenne et la médiane est important, plus les données de la variable sont inégalement réparties. À Westmount, soit la municipalité la plus nantie de l’île de Montréal, les valeurs extrêmes sont des ménages avec des revenus très élevés tirant fortement la moyenne vers le haut. À l’inverse, le faible écart entre les valeurs moyenne et médiane dans la municipalité de Montréal-Est (58 594 $ versus 50 318 $) souligne que les revenus des ménages sont plus également répartis. Cela explique que pour comparer les revenus totaux ou d’emploi entre différents groupes (selon le sexe, le groupe d’âge, le niveau d’éducation, la municipalité ou région métropolitaine, etc.), nous privilégions habituellement l’utilisation des revenus médians.</p>
<table>
<caption>
(#tab:tableRevMoyMed)Revenus moyens et médians des ménages en dollars, municipalités de l’île de Montréal, 2015
</caption>
<thead>
<tr>
<th style="text-align:left;">
Municipalité
</th>
<th style="text-align:right;">
Nombre de ménages
</th>
<th style="text-align:right;">
Revenu moyen
</th>
<th style="text-align:right;">
Revenu médian
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Baie-D’Urfé
</td>
<td style="text-align:right;">
1 330
</td>
<td style="text-align:right;">
171 390
</td>
<td style="text-align:right;">
118 784
</td>
</tr>
<tr>
<td style="text-align:left;">
Beaconsfield
</td>
<td style="text-align:right;">
6 660
</td>
<td style="text-align:right;">
187 173
</td>
<td style="text-align:right;">
123 392
</td>
</tr>
<tr>
<td style="text-align:left;">
Côte-Saint-Luc
</td>
<td style="text-align:right;">
13 490
</td>
<td style="text-align:right;">
94 570
</td>
<td style="text-align:right;">
58 935
</td>
</tr>
<tr>
<td style="text-align:left;">
Dollard-Des Ormeaux
</td>
<td style="text-align:right;">
17 210
</td>
<td style="text-align:right;">
102 104
</td>
<td style="text-align:right;">
78 981
</td>
</tr>
<tr>
<td style="text-align:left;">
Dorval
</td>
<td style="text-align:right;">
8 390
</td>
<td style="text-align:right;">
89 952
</td>
<td style="text-align:right;">
64 689
</td>
</tr>
<tr>
<td style="text-align:left;">
Hampstead
</td>
<td style="text-align:right;">
2 470
</td>
<td style="text-align:right;">
250 497
</td>
<td style="text-align:right;">
122 496
</td>
</tr>
<tr>
<td style="text-align:left;">
Kirkland
</td>
<td style="text-align:right;">
6 685
</td>
<td style="text-align:right;">
144 676
</td>
<td style="text-align:right;">
115 381
</td>
</tr>
<tr>
<td style="text-align:left;">
Montréal
</td>
<td style="text-align:right;">
779 805
</td>
<td style="text-align:right;">
69 047
</td>
<td style="text-align:right;">
50 227
</td>
</tr>
<tr>
<td style="text-align:left;">
Montréal-Est
</td>
<td style="text-align:right;">
1 730
</td>
<td style="text-align:right;">
58 594
</td>
<td style="text-align:right;">
50 318
</td>
</tr>
<tr>
<td style="text-align:left;">
Montréal-Ouest
</td>
<td style="text-align:right;">
1 850
</td>
<td style="text-align:right;">
159 374
</td>
<td style="text-align:right;">
115 029
</td>
</tr>
<tr>
<td style="text-align:left;">
Mont-Royal
</td>
<td style="text-align:right;">
7 370
</td>
<td style="text-align:right;">
205 309
</td>
<td style="text-align:right;">
109 540
</td>
</tr>
<tr>
<td style="text-align:left;">
Pointe-Claire
</td>
<td style="text-align:right;">
12 380
</td>
<td style="text-align:right;">
100 294
</td>
<td style="text-align:right;">
80 242
</td>
</tr>
<tr>
<td style="text-align:left;">
Sainte-Anne-de-Bellevue
</td>
<td style="text-align:right;">
1 960
</td>
<td style="text-align:right;">
102 969
</td>
<td style="text-align:right;">
67 200
</td>
</tr>
<tr>
<td style="text-align:left;">
Senneville
</td>
<td style="text-align:right;">
345
</td>
<td style="text-align:right;">
203 790
</td>
<td style="text-align:right;">
116 224
</td>
</tr>
<tr>
<td style="text-align:left;">
Westmount
</td>
<td style="text-align:right;">
8 685
</td>
<td style="text-align:right;">
295 099
</td>
<td style="text-align:right;">
100 153
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect0252" class="section level3">
<h3><span class="header-section-number">2.5.2</span> Paramètres de position</h3>
<p>Les paramètres de position permettent de diviser une distribution en <em>n</em> parties égales.</p>
<ul>
<li>Les <strong>quartiles</strong> qui divisent une distribution en quatre parties (25 %) :
<ul>
<li>Q1 (25 %), soit le quartile inférieur ou premier quartile;</li>
<li>Q2 (50 %), soit la médiane;</li>
<li>Q3 (75 %), soit le quartile supérieur ou troisième quartile.</li>
</ul></li>
<li>Les <strong>quintiles</strong> qui divisent une distribution en cinq parties égales (20 %).</li>
<li>Les <strong>déciles</strong> (de D1 à D9) qui divisent une distribution en dix parties égales (10 %).</li>
<li>Les <strong>centiles</strong> (de C1 à C99) qui divisent une distribution en cent parties égales (1 %).</li>
</ul>
<p>En cartographie, les quartiles et les quintiles sont souvent utilisés pour discrétiser une variable quantitative (continue ou discrète) en quatre ou cinq classes et plus rarement, en dix classes (déciles). Avec les quartiles, les bornes des classes qui comprennent chacune 25 % des unités spatiales sont définies comme suit : [Min à Q1], [Q1 à Q2], [Q2 à Q3] et [Q3 à Max]. La méthode de discrétisation selon les quartiles ou quintiles permet de repérer, en un coup d’œil, à quelle tranche de 25 % ou de 20 % des données appartient chacune des unités spatiales. Cette méthode de discrétisation est aussi utile pour comparer plusieurs cartes et vérifier si deux phénomènes sont ou non colocalisés <span class="citation">(Pumain et Béguin <a href="#ref-pumain1994" role="doc-biblioref">1994</a>)</span>. En guise d’exemple, les pourcentages de personnes à faible revenu et de locataires par secteur de recensement ont clairement des distributions spatiales très semblables dans la région métropolitaine de Montréal en 2016 (figure @ref(fig:figunivarie2)).</p>
<div class="figure" style="text-align: center">
<img src="images/univariee/figure2.jpg" alt="Exemples de cartographie avec une discrétisation selon les quantiles" width="85%" />
<p class="caption">
(#fig:figunivarie2)Exemples de cartographie avec une discrétisation selon les quantiles
</p>
</div>
<p>Une lecture attentive des valeurs des centiles permet de repérer la présence de valeurs extrêmes, voire aberrantes, dans un jeu de données. Il n’est donc pas rare de les voir reportées dans un tableau de statistiques descriptives d’un article scientifique, et ce, afin de décrire succinctement les variables à l’étude. Par exemple, dans une étude récente comparant les niveaux d’exposition au bruit des cyclistes dans trois villes <span class="citation">(Apparicio et Gelb <a href="#ref-2020_1" role="doc-biblioref">2020</a>)</span>, les auteurs reportent à la fois les valeurs moyennes et celles de plusieurs centiles. Globalement, la lecture des valeurs moyennes permet de constater que, sur la base des données collectées, les cyclistes sont plus exposés au bruit à Paris qu’à Montréal et Copenhague (73,4 dB(A) contre 70,7 et 68,4, tableau @ref(tab:tableCentiles)). Compte tenu de l’échelle logarithmique du bruit, la différence de 5 dB(A) entre les valeurs moyennes du bruit de Copenhague et de Paris peut être considérée comme une multiplication de l’énergie sonore par plus de 3. Pour Paris, l’analyse des quartiles montre que durant 25 % du temps des trajets à vélo (plus de 63 heures de collecte), les participantes et participants ont été exposés à des niveaux de bruit soit inférieurs à 69,1 dB(A) (premier quartile), soit supérieurs à 74 dB(A) (troisième quartile). Quant à l’analyse des centiles, elle permet de constater que durant 5 % et 10 % du temps, les participantes et participants étaient exposés à des niveaux de bruit très élevés, dépassant 75 dB(A) (C90 = 76 et C90 = 77,2).</p>
<table>
<caption>
(#tab:tableCentiles)Stastistiques descriptives de l’exposition au bruit des cyclistes par minute dans trois villes (dB(A), Laeq 1min)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Statistiques
</th>
<th style="text-align:right;">
Copenhague
</th>
<th style="text-align:right;">
Montréal
</th>
<th style="text-align:right;">
Paris
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
6 212,0
</td>
<td style="text-align:right;">
4 723,0
</td>
<td style="text-align:right;">
3 793,0
</td>
</tr>
<tr>
<td style="text-align:left;">
Moyenne de bruit
</td>
<td style="text-align:right;">
68,4
</td>
<td style="text-align:right;">
70,7
</td>
<td style="text-align:right;">
73,4
</td>
</tr>
<tr>
<td style="text-align:left;">
Centiles
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
57,5
</td>
<td style="text-align:right;">
59,2
</td>
<td style="text-align:right;">
62,3
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
59,1
</td>
<td style="text-align:right;">
61,1
</td>
<td style="text-align:right;">
65,0
</td>
</tr>
<tr>
<td style="text-align:left;">
10
</td>
<td style="text-align:right;">
60,3
</td>
<td style="text-align:right;">
62,3
</td>
<td style="text-align:right;">
66,5
</td>
</tr>
<tr>
<td style="text-align:left;">
25 (premier quartile)
</td>
<td style="text-align:right;">
62,7
</td>
<td style="text-align:right;">
64,5
</td>
<td style="text-align:right;">
69,1
</td>
</tr>
<tr>
<td style="text-align:left;">
50 (médiane)
</td>
<td style="text-align:right;">
66,0
</td>
<td style="text-align:right;">
67,7
</td>
<td style="text-align:right;">
71,6
</td>
</tr>
<tr>
<td style="text-align:left;">
75 (troisième quartile)
</td>
<td style="text-align:right;">
69,2
</td>
<td style="text-align:right;">
71,0
</td>
<td style="text-align:right;">
74,0
</td>
</tr>
<tr>
<td style="text-align:left;">
90
</td>
<td style="text-align:right;">
71,9
</td>
<td style="text-align:right;">
73,7
</td>
<td style="text-align:right;">
76,0
</td>
</tr>
<tr>
<td style="text-align:left;">
95
</td>
<td style="text-align:right;">
73,3
</td>
<td style="text-align:right;">
75,2
</td>
<td style="text-align:right;">
77,2
</td>
</tr>
<tr>
<td style="text-align:left;">
99
</td>
<td style="text-align:right;">
76,5
</td>
<td style="text-align:right;">
78,9
</td>
<td style="text-align:right;">
81,0
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect0253" class="section level3">
<h3><span class="header-section-number">2.5.3</span> Paramètres de dispersion</h3>
<p>Cinq principales mesures de dispersion permettent d’évaluer la variabilité des valeurs d’une variable quantitative : l’étendue, l’écart interquartile, la variance, l’écart-type et le coefficient de variation. Notez d’emblée que cette dernière mesure ne s’applique pas à des variables d’intervalle (section @ref(sect02122)).</p>
<ul>
<li><p><strong>L’étendue</strong> est la différence entre les valeurs minimale et maximale d’une variable, soit l’intervalle des valeurs dans lequel elle a été mesurée. Il convient d’analyser avec prudence cette mesure puisqu’elle inclut dans son calcul des valeurs potentiellement extrêmes, voire aberrantes (faibles ou fortes).</p></li>
<li><p><strong>L’intervalle ou écart interquartile</strong> est la différence entre les troisième et premier quartiles (Q3 − Q1). Il représente ainsi une mesure de la dispersion des valeurs de 50 % des observations centrales de la distribution. Plus la valeur de l’écart interquartile est élevée, plus la dispersion des 50 % des observations centrales est forte. Contrairement à l’étendue, cette mesure élimine l’influence des valeurs extrêmes puisqu’elle ne tient pas compte des 25 % des observations les plus faibles [Min à Q1] et des 25 % des observations les plus fortes [Q3 à Max]. Graphiquement, l’intervalle interquartile est représenté à l’aide d’une boîte à moustaches (<em>boxplot</em> en anglais) : plus l’intervalle interquartile est grand, plus la boîte est allongée (figure @ref(fig:figunivarie3))</p></li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/univariee/figure3.jpg" alt="Graphique en violon, boîte à moustaches et intervalle interquartile" width="30%" />
<p class="caption">
(#fig:figunivarie3)Graphique en violon, boîte à moustaches et intervalle interquartile
</p>
</div>
<ul>
<li><strong>La variance</strong> est la somme des déviations à la moyenne au carré (numérateur) divisée par le nombre d’observations pour une population (<span class="math inline">\(\sigma^2\)</span>) ou divisée par le nombre d’observations moins une (<span class="math inline">\(s^2\)</span>) pour un échantillon (équation @ref(eq:variance)). Puisque les déviations à la moyenne sont mises au carré, la valeur de la variance (tout comme celle de l’écart-type) est toujours positive. Plus sa valeur est élevée, plus les observations sont dispersées autour de la moyenne. La variance représente ainsi l’écart au carré moyen des observations à la moyenne.</li>
</ul>

<p><span class="math display">\[\begin{equation}  
\sigma^2=\frac{\sum_{i=1}^n (x_{i}-\mu)^2}{n} \text{ ou } s^2=\frac{\sum_{i=1}^n (x_{i}-\bar{x})^2}{n-1}
(\#eq:variance)
\end{equation}\]</span>
</p>
<ul>
<li><strong>L’écart-type</strong> est la racine carrée de la variance (équation @ref(eq:ecartype)). Rappelez-vous que la variance est calculée à partir des déviations à la moyenne mises au carré. Étant donné que l’écart-type est la racine carrée de la variance, il est donc évalué dans la même unité que la variable, contrairement à la variance. Bien entendu, comme pour la variance, plus la valeur de l’écart-type est élevée, plus la distribution des observations autour de la moyenne est dispersée.</li>
</ul>

<p><span class="math display">\[\begin{equation}  
\sigma=\sqrt{\sigma^2}=\sqrt{\frac{\sum_{i=1}^n (x_{i}-\mu)^2}{n}} \text{ ou } s=\sqrt{s^2}=\sqrt{\frac{\sum_{i=1}^n (x_{i}-\bar{x})^2}{n-1}}
(\#eq:ecartype)
\end{equation}\]</span>
</p>
<div class="bloc_notes">
<p>Les formules des variances et des écarts-types pour une population et un échantillon sont très similaires : seul le dénominateur change avec <span class="math inline">\(n\)</span> <em>versus</em> <span class="math inline">\(n-1\)</span> observations. Par conséquent, plus le nombre d’observations de votre jeu de données est important, plus l’écart entre ces deux mesures de dispersion pour une population et un échantillon est minime.</p>
<p>Comme dans la plupart des logiciels de statistique, les fonctions de base <code>var</code> et <code>sd</code> de R calculent la variance et l’écart-type pour un échantillon (<span class="math inline">\(n-1\)</span> au dénominateur). Si vous souhaitez les calculer pour une population, adaptez la syntaxe ci-dessous dans laquelle <code>df$var1</code> représente la variable intitulée <code>var1</code> présente dans un <em>DataFrame</em> nommé <code>df</code>.</p>
<p><code>var.p &lt;- mean((df$var1 - mean(df$var1))^2)</code></p>
<p><code>sd.p &lt;- sqrt(mean((df$var1 - mean(df$var1))^2))</code></p>
</div>
<ul>
<li><strong>Le coefficient de variation (CV)</strong> est le rapport entre l’écart-type et la moyenne, représentant ainsi une standardisation de l’écart-type ou, en d’autres termes, une mesure de dispersion relative (équation @ref(eq:cv)). L’écart-type étant exprimé dans l’unité de mesure de la variable, il ne peut pas être utilisé pour comparer les dispersions de variables exprimées des unités de mesure différentes (par exemple, en pourcentage, en kilomètres, en dollars, etc.). Pour y remédier, nous utilisons le coefficient de variation : une variable est plus dispersée qu’une autre si la valeur de son CV est plus élevée. Certaines personnes préfèrent multiplier la valeur du CV par 100 : l’écart-type est alors exprimé en pourcentage de la moyenne.</li>
</ul>

<p><span class="math display">\[\begin{equation}  
CV=\frac{\sigma}{\mu} \text{ ou } CV=\frac{s^2}{\bar{x}}
(\#eq:cv)
\end{equation}\]</span>
</p>
<p>Illustrons comment calculer les cinq mesures de dispersion précédemment décrites à partir de valeurs fictives pour huit observations (colonne intitulée <span class="math inline">\(x_i\)</span> au tableau @ref(tab:datavar)). Les différentes statistiques reportées dans ce tableau sont calculées comme suit :</p>
<ul>
<li><p>La <strong>moyenne</strong> est la somme divisée par le nombre d’observations, soit <span class="math inline">\(\mbox{248/8}=\mbox{31}\)</span>.</p></li>
<li><p>L’<strong>étendue</strong> est la différence entre les valeurs maximale et minimale, soit <span class="math inline">\(\mbox{40}-\mbox{22}=\mbox{30}\)</span>.</p></li>
<li><p>Les quartiles coupent la distribution en quatre parties égales. Avec huit observations triées par ordre croissant, <strong>le premier quartile</strong> est égal à la valeur de la deuxième observation (soit 25), la <strong>médiane</strong> à celle de la quatrième (30), le <strong>troisième quartile</strong> à celle de la sixième (35).</p></li>
<li><p><strong>L’écart interquartile</strong> est la différence entre Q3 et Q1, soit <span class="math inline">\(\mbox{35}-\mbox{25}=\mbox{10}\)</span>.</p></li>
<li><p>La seconde colonne du tableau est l’écart à la moyenne (<span class="math inline">\(x_i-\bar{x}\)</span>), soit <span class="math inline">\(\mbox{22} - \mbox{31} = -\mbox{9}\)</span> pour l’observation <em>1</em>; la somme de ces écarts est toujours égale à 0. La troisième colonne est cette déviation mise au carré (<span class="math inline">\((x_i-\bar{x})^2\)</span>), soit <span class="math inline">\(-\mbox{9}^2 = \mbox{81}\)</span>, toujours pour l’observation <em>1</em>. La somme de ces déviations à la moyenne au carré (268) représente le numérateur de la variance (équation @ref(eq:variance)). En divisant cette somme par le nombre d’observations, nous obtenons la <strong>variance pour une population</strong> (<span class="math inline">\(\mbox{268}/\mbox{8}=\mbox{33,5}\)</span>) tandis que la <strong>variance d’un échantillon</strong> est égale à <span class="math inline">\(\mbox{268}/(\mbox{8}-\mbox{1})=\mbox{38,29}\)</span>.</p></li>
<li><p>L’écart-type est la racine carrée de la variance (équation @ref(eq:ecartype)), soit <span class="math inline">\(\sigma=\sqrt{\mbox{33,5}}=\mbox{5,79}\)</span> et <span class="math inline">\(s=\sqrt{\mbox{38,29}}=\mbox{6,19}\)</span>.</p></li>
<li><p>Finalement, les valeurs des coefficients de variation (équation @ref(eq:cv)) sont de <span class="math inline">\(\mbox{5,79}/\mbox{31}=\mbox{0,19}\)</span> pour une population et <span class="math inline">\(\mbox{6,19}/\mbox{31}=\mbox{0,20}\)</span> pour un échantillon.</p></li>
</ul>
<table>
<caption>
(#tab:datavar)Calcul des mesures de dispersion sur des données fictives
</caption>
<thead>
<tr>
<th style="text-align:left;">
Observation
</th>
<th style="text-align:right;">
<span class="math inline">\(x_i\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(x_i-\bar{x}\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\((x_i-\bar{x})^2\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
22,00
</td>
<td style="text-align:center;">
-9
</td>
<td style="text-align:right;">
81,0
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
25,00
</td>
<td style="text-align:center;">
-6
</td>
<td style="text-align:right;">
36,0
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
27,00
</td>
<td style="text-align:center;">
-4
</td>
<td style="text-align:right;">
16,0
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
30,00
</td>
<td style="text-align:center;">
-1
</td>
<td style="text-align:right;">
1,0
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
32,00
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:right;">
1,0
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
35,00
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:right;">
16,0
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:right;">
37,00
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:right;">
36,0
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:right;">
40,00
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:right;">
81,0
</td>
</tr>
<tr>
<td style="text-align:left;">
<strong>Statistique</strong>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
8,00
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Somme
</td>
<td style="text-align:right;">
248,00
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:right;">
268,0
</td>
</tr>
<tr>
<td style="text-align:left;">
Moyenne (<span class="math inline">\(\bar{x}\)</span> ou <span class="math inline">\(\mu\)</span>)
</td>
<td style="text-align:right;">
31,00
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:right;">
33,5
</td>
</tr>
<tr>
<td style="text-align:left;">
Étendue
</td>
<td style="text-align:right;">
18,00
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Premier quartile
</td>
<td style="text-align:right;">
25,00
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Troisième quartile
</td>
<td style="text-align:right;">
35,00
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Intervalle interquartile
</td>
<td style="text-align:right;">
10,00
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (population, <span class="math inline">\(\sigma^2\)</span>)
</td>
<td style="text-align:right;">
33,50
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Écart-type (population, <span class="math inline">\(\sigma\)</span>)
</td>
<td style="text-align:right;">
5,79
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (échantillon, <span class="math inline">\(s^2\)</span>)
</td>
<td style="text-align:right;">
38,29
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Écart-type (échantillon, <span class="math inline">\(s\)</span>)
</td>
<td style="text-align:right;">
6,19
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Coefficient de variation (<span class="math inline">\(\sigma / \mu\)</span>)
</td>
<td style="text-align:right;">
0,19
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Coefficient de variation (<span class="math inline">\(s / \bar{x}\)</span>)
</td>
<td style="text-align:right;">
0,20
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
<p>Le tableau @ref(tab:datavar2) vise à démontrer, à partir de trois variables, comment certaines mesures de dispersion sont sensibles à l’unité de mesure et/ou aux valeurs extrêmes.</p>
<p>Concernant <strong>l’unité de mesure</strong>, nous avons créé deux variables <em>A</em> et <em>B</em>, où <em>B</em> étant simplement <em>A</em> multipliée par 10. Pour <em>A</em>, les valeurs de la moyenne, de l’étendue et de l’intervalle interquartile sont respectivement 31, 18 et 10. Sans surprise, celles de <em>B</em> sont multipliées par 10 (310, 180, 100). La variance étant la moyenne des déviations à la moyenne au carré, elle est égale à 33,50 pour <em>A</em> et donc à <span class="math inline">\(\mbox{33,50}\times10^2=\mbox{3350}\)</span> pour <em>B</em>; l’écart-type de <em>B</em> est égal à celui de <em>A</em> multiplié par 10. Cela démontre que l’étendue, l’intervalle interquartile, la variance et l’écart-type sont des mesures de dispersion dépendantes de l’unité de mesure. Par contre, étant donné que le coefficient de variation (CV) est le rapport de l’écart-type avec la moyenne, il a la même valeur pour <em>A</em> et <em>B</em>, ce qui démontre que le CV est bien une mesure de dispersion relative permettant de comparer des variables exprimées dans des unités de mesure différentes.</p>
<p>Concernant <strong>la sensibilité aux valeurs extrêmes</strong>, nous avons créé la variable <em>C</em> pour laquelle seule la huitième observation a une valeur différente (40 pour <em>A</em> et 105 pour <em>B</em>). Cette valeur de 105 pourrait être soit une valeur extrême positive mesurée, soit une valeur aberrante (par exemple, si l’unité de mesure était un pourcentage variant de 0 à 100 %). Cette valeur a un impact important sur la moyenne (31 contre 39,12) et l’étendue (18 contre 83) et corollairement sur la variance (33,50 contre 641,86), l’écart-type (5,79 contre 25,33) et le coefficient de variation (0,19 contre 0,65). Par contre, comme l’intervalle interquartile est calculé sur 50 % des observations centrales (<span class="math inline">\(\mbox{Q3}-\mbox{Q1}\)</span>), il n’est pas affecté par cette valeur extrême.</p>
<table>
<caption>
(#tab:datavar2)Illustration de la sensibilité des mesures de dispersion à l’unité de mesure et aux valeurs extrêmes
</caption>
<thead>
<tr>
<th style="text-align:left;">
Observation
</th>
<th style="text-align:right;">
A
</th>
<th style="text-align:right;">
B
</th>
<th style="text-align:right;">
C
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
22,00
</td>
<td style="text-align:right;">
220,00
</td>
<td style="text-align:right;">
22,00
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
25,00
</td>
<td style="text-align:right;">
250,00
</td>
<td style="text-align:right;">
25,00
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
27,00
</td>
<td style="text-align:right;">
270,00
</td>
<td style="text-align:right;">
27,00
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
30,00
</td>
<td style="text-align:right;">
300,00
</td>
<td style="text-align:right;">
30,00
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
32,00
</td>
<td style="text-align:right;">
320,00
</td>
<td style="text-align:right;">
32,00
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
35,00
</td>
<td style="text-align:right;">
350,00
</td>
<td style="text-align:right;">
35,00
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:right;">
37,00
</td>
<td style="text-align:right;">
370,00
</td>
<td style="text-align:right;">
37,00
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:right;">
40,00
</td>
<td style="text-align:right;">
400,00
</td>
<td style="text-align:right;">
105,00
</td>
</tr>
<tr>
<td style="text-align:left;">
<strong>Statistique</strong>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Moyenne (<span class="math inline">\(\mu\)</span>)
</td>
<td style="text-align:right;">
31,00
</td>
<td style="text-align:right;">
310,00
</td>
<td style="text-align:right;">
39,12
</td>
</tr>
<tr>
<td style="text-align:left;">
Étendue
</td>
<td style="text-align:right;">
18,00
</td>
<td style="text-align:right;">
180,00
</td>
<td style="text-align:right;">
83,00
</td>
</tr>
<tr>
<td style="text-align:left;">
Intervalle interquartile
</td>
<td style="text-align:right;">
10,00
</td>
<td style="text-align:right;">
100,00
</td>
<td style="text-align:right;">
10,00
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (population, <span class="math inline">\(\sigma^2\)</span>)
</td>
<td style="text-align:right;">
33,50
</td>
<td style="text-align:right;">
3 350,00
</td>
<td style="text-align:right;">
641,86
</td>
</tr>
<tr>
<td style="text-align:left;">
Écart-type (population, <span class="math inline">\(\sigma\)</span>)
</td>
<td style="text-align:right;">
5,79
</td>
<td style="text-align:right;">
57,88
</td>
<td style="text-align:right;">
25,33
</td>
</tr>
<tr>
<td style="text-align:left;">
Coefficient de variation (<span class="math inline">\(\sigma / \mu\)</span>)
</td>
<td style="text-align:right;">
0,19
</td>
<td style="text-align:right;">
0,19
</td>
<td style="text-align:right;">
0,65
</td>
</tr>
</tbody>
</table>
<table>
<caption>
(#tab:resume)Résumé de la sensibilité de la moyenne et des mesures de dispersion
</caption>
<thead>
<tr>
<th style="text-align:left;">
Statistique
</th>
<th style="text-align:center;">
Unité de mesure
</th>
<th style="text-align:center;">
Valeurs extrêmes
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Moyenne
</td>
<td style="text-align:center;">
X
</td>
<td style="text-align:center;">
X
</td>
</tr>
<tr>
<td style="text-align:left;">
Étendue
</td>
<td style="text-align:center;">
X
</td>
<td style="text-align:center;">
X
</td>
</tr>
<tr>
<td style="text-align:left;">
Intervalle interquartile
</td>
<td style="text-align:center;">
X
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance
</td>
<td style="text-align:center;">
X
</td>
<td style="text-align:center;">
X
</td>
</tr>
<tr>
<td style="text-align:left;">
Écart-type
</td>
<td style="text-align:center;">
X
</td>
<td style="text-align:center;">
X
</td>
</tr>
<tr>
<td style="text-align:left;">
Coefficient de variation
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
X
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect0254" class="section level3">
<h3><span class="header-section-number">2.5.4</span> Paramètres de forme</h3>
<div id="vérification-de-la-normalité-dune-variable-quantitative" class="section level4">
<h4><span class="header-section-number">2.5.4.1</span> Vérification de la normalité d’une variable quantitative</h4>
<div class="bloc_objectif">
<p>De nombreuses méthodes statistiques qui sont abordées dans les chapitres suivants – entre autres, la corrélation de Pearson, les test <em>t</em> et l’analyse de variance, les régressions simple et multiple – requièrent que la variable quantitative suive une <strong>distribution normale</strong> (nommée aussi <strong>distribution gaussienne</strong>).</p>
<p>Dans cette sous-section, nous décrivons trois démarches pour vérifier si la distribution d’une variable est normale : les coefficients d’asymétrie et d’aplatissement (<em>skewness</em> et <em>kurtosis</em> en anglais), les graphiques (histogramme avec courbe normale et diagramme quantile-quantile), les tests de normalité (tests de Shapiro-Wilk, de Kolmogorov-Smirnov, de Lilliefors, d’Anderson-Darling et de Jarque-Bera).</p>
<p><strong>Il est vivement recommandé de réaliser les trois démarches!</strong></p>
</div>
<p>Une distribution est normale quand elle est symétrique et mésokurtique (figure @ref(fig:figFormeDistr)).</p>
<div class="figure" style="text-align: center">
<img src="images/univariee/FormeDistribution.jpg" alt="Formes d'une distribution et coefficients d'asymétrie et d'aplatissement" width="70%" />
<p class="caption">
(#fig:figFormeDistr)Formes d’une distribution et coefficients d’asymétrie et d’aplatissement
</p>
</div>
<div id="vérification-de-la-normalité-avec-les-coefficients-dasymétrie-et-daplatissement" class="section level5">
<h5><span class="header-section-number">2.5.4.1.1</span> Vérification de la normalité avec les coefficients d’asymétrie et d’aplatissement</h5>
<p><strong>Une distribution est dite symétrique</strong> quand la moyenne arithmétique est au centre de la distribution, c’est-à-dire que les observations sont bien réparties de part et d’autre de la moyenne qui est alors égale à la médiane et au mode (nous utilisons uniquement le mode pour une variable discrète et non pour une variable continue). Pour évaluer l’asymétrie, nous utilisons habituellement le coefficient d’asymétrie (<em>skewness</em> en anglais).</p>
<p>Sachez toutefois qu’il existe trois façons (formules) pour le calculer <span class="citation">(Joanes et Gill <a href="#ref-joanes1998comparing" role="doc-biblioref">1998</a>)</span> : <span class="math inline">\(g_1\)</span> est la formule classique (équation @ref(eq:SkewType1)), disponible dans R avec la fonction <code>skewness</code> du <em>package</em> <code>moments</code>), <span class="math inline">\(G_1\)</span> est une version ajustée (équation @ref(eq:SkewType2)), utilisée dans les logiciels SAS et SPSS notamment) et <span class="math inline">\(b_1\)</span> est une autre version ajustée (équation @ref(eq:SkewType3)), utilisée par les logiciels MINITAB et BMDP). Nous verrons qu’avec les <em>packages</em> <code>DescTools</code> ou <code>e1071</code>, il est possible de calculer ces trois méthodes. Aussi, pour des grands échantillons (<span class="math inline">\(n&gt;100\)</span>), il y a très peu de différences entre les résultats produits par ces trois formules <span class="citation">(Joanes et Gill <a href="#ref-joanes1998comparing" role="doc-biblioref">1998</a>)</span>. Quelle que soit la formule utilisée, le coefficient d’asymétrie s’interprète comme suit (figure @ref(fig:asymetrie)) :</p>
<ul>
<li>Quand la valeur du <em>skewness</em> est négative, la <strong>distribution est asymétrique négative</strong>. La distribution est alors tirée à gauche par des valeurs extrêmes faibles, mais peu nombreuses. Nous employons souvent l’expression <em>la queue de distribution</em> est étirée vers la gauche. La moyenne est alors inférieure à la médiane.</li>
<li>Quand la valeur du <em>skewness</em> est égale à 0, <strong>la distribution est symétrique</strong> (la médiane est égale à la moyenne). Pour une variable discrète, les valeurs du mode, de la moyenne et de la médiane sont égales.</li>
<li>Quand la valeur du <em>skewness</em> est positive, la <strong>distribution est symétrique positive</strong>. La distribution est alors tirée à droite par des valeurs extrêmes fortes, mais peu nombreuses. La queue de distribution est alors étirée vers la droite et la moyenne est supérieure à la médiane. En sciences sociales, les variables de revenu (totaux ou d’emploi, des individus ou des ménages) ont souvent des distributions asymétriques positives : la moyenne est affectée par quelques observations avec des valeurs de revenu très élevées et est ainsi supérieure à la médiane. En études urbaines, la densité de la population pour des unités géographiques d’une métropole donnée (secteur de recensement par exemple) a aussi souvent une distribution asymétrique positive : quelques secteurs de recensement au centre de la métropole sont caractérisés par des valeurs de densité très élevées qui tirent la distribution vers la droite.</li>
</ul>

<p><span class="math display">\[\begin{equation}  
g_1=\frac{ \frac{1}{n} \sum_{i=1}^n(x_i-\bar{x})^3} { \left[\frac{1}{n}\sum_{i=1}^n(x_i-\bar{x})^2\right] ^\frac{3}{2}}
(\#eq:SkewType1)
\end{equation}\]</span>
</p>

<p><span class="math display">\[\begin{equation}  
G_1= \frac{\sqrt{n(n-1)}}{n-2} g_1
(\#eq:SkewType2)
\end{equation}\]</span>
</p>

<p><span class="math display">\[\begin{equation}  
b_1= \left( \frac{n-1}{n} \right) ^\frac{3}{2} g_1
(\#eq:SkewType3)
\end{equation}\]</span>
</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/asymetrie-1.png" alt="Asymétrie d'une distribution" width="100%" />
<p class="caption">
(#fig:asymetrie)Asymétrie d’une distribution
</p>
</div>
<p><strong>Pour évaluer l’aplatissement d’une distribution</strong>, nous utilisons le coefficient d’aplatissement (<em>kurtosis</em> en anglais). Là encore, il existe trois formules pour le calculer (équation @ref(eq:KurtType1), @ref(eq:KurtType2), @ref(eq:KurtType3)) qui renvoient des valeurs très semblables pour de grands échantillons <span class="citation">(Joanes et Gill <a href="#ref-joanes1998comparing" role="doc-biblioref">1998</a>)</span>. Cette mesure s’interprète comme suit (figure @ref(fig:asymetrie)) :</p>
<ul>
<li>Quand la valeur du <em>kurtosis</em> est négative, la <strong>distribution est platikurtique</strong>. La distribution est dite plate, c’est-à-dire que la valeur de l’écart-type est importante (comparativement à une distribution normale), signalant une grande dispersion des valeurs de part et d’autre la moyenne.</li>
<li>Quand la valeur du <em>kurtosis</em> est égale à 0, <strong>la distribution est mésokurtique</strong>, ce qui est typique d’une distribution normale.</li>
<li>Quand la valeur du <em>kurtosis</em> est positive, la <strong>distribution est leptokurtique</strong>, signalant que l’écart-type (la dispersion des valeurs) est plutôt faible. Autrement dit, la dispersion des valeurs autour de la moyenne est faible.</li>
</ul>

<p><span class="math display">\[\begin{equation}  
g_2=\frac{\frac{1}{n}\sum_{i=1}^n(x_i-\bar{x})^4} {\left( \frac{1}{n}\sum_{i=1}^n(x_i-\bar{x})^2\right)^2}-3
(\#eq:KurtType1)
\end{equation}\]</span>
</p>

<p><span class="math display">\[\begin{equation}  
G_2 = \frac{n-1}{(n-2)(n-3)} \{(n+1) g_2 + 6\}
(\#eq:KurtType2)
\end{equation}\]</span>
</p>

<p><span class="math display">\[\begin{equation}  
b_2 = (g_2 + 3) (1 - 1/n)^2 - 3
(\#eq:KurtType3)
\end{equation}\]</span>
</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kurtosis-1.png" alt="Applatissement d'une distribution" width="100%" />
<p class="caption">
(#fig:kurtosis)Applatissement d’une distribution
</p>
</div>
<div class="bloc_attention">
<p>Regardez attentivement les équations @ref(eq:KurtType1), @ref(eq:KurtType2), @ref(eq:KurtType3); vous remarquez que pour <span class="math inline">\(g_2\)</span> et <span class="math inline">\(b_2\)</span>, il y a une soustraction de 3 et une addition 6 pour <span class="math inline">\(G_2\)</span>. Nous parlons alors de <em>kurtosis</em> normalisé (<em>excess kurtosis</em> en anglais). Pour une distribution normale, il prend la valeur de 0, comparativement à la valeur de 3 pour un <em>kurtosis</em> non normalisé. Par conséquent, avant de calculer le <em>kurtosis</em>, il convient de s’assurer que la fonction que vous utilisez implémente une méthode de calcul normalisée (donnant une valeur de 0 pour une distribution normale). Par exemple, la fonction <code>Kurt</code> du <em>package</em> <code>DescTools</code> calcule les trois formules normalisées tandis que la fonction <code>kurtosis</code> du <em>package</em> <code>moments</code> renvoie un <em>kurtosis</em> non normalisé.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1"></a><span class="kw">library</span>(DescTools)</span>
<span id="cb232-2"><a href="#cb232-2"></a><span class="kw">library</span>(moments)</span>
<span id="cb232-3"><a href="#cb232-3"></a><span class="co"># Générer une variable normalement distribuée avec 1000 observations</span></span>
<span id="cb232-4"><a href="#cb232-4"></a>Normale &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1500</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb232-5"><a href="#cb232-5"></a><span class="kw">round</span>(DescTools<span class="op">::</span><span class="kw">Kurt</span>(Normale),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] -0.031</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1"></a><span class="kw">round</span>(moments<span class="op">::</span><span class="kw">kurtosis</span>(Normale),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 2.973</code></pre>
</div>
</div>
<div id="vérification-de-la-normalité-avec-des-graphiques" class="section level5">
<h5><span class="header-section-number">2.5.4.1.2</span> Vérification de la normalité avec des graphiques</h5>
<p>Les graphiques sont un excellent moyen de vérifier visuellement si une distribution est normale ou pas. Bien entendu, les histogrammes, que nous avons déjà largement utilisés, sont un incontournable. À titre de rappel, ils permettent de représenter la forme de la distribution des données (figure @ref(fig:CourbeNormale)). Un autre type de graphique intéressant est le <strong>diagramme quantile-quantile</strong> (<em>Q-Q plot</em> en anglais), qui permet de comparer la distribution d’une variable avec une distribution gaussienne (normale). Trois éléments composent ce graphique comme qu’illustré à la figure @ref(fig:qqplot) :</p>
<ul>
<li>les points, représentant les observations de la variable;</li>
<li>la distribution gaussienne (normale), représentée par une ligne;</li>
<li>l’intervalle de confiance à 95 % de la distribution normale (en marron sur la figure).</li>
</ul>
<p>Quand la variable est normalement distribuée, les points sont situés le long de la ligne. Plus les points localisés en dehors de l’intervalle de confiance (bande marron) sont nombreux, plus la variable est alors anormalement distribuée.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/CourbeNormale-1.png" alt="Histogrammes et courbe normale" width="90%" />
<p class="caption">
(#fig:CourbeNormale)Histogrammes et courbe normale
</p>
</div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/qqplot-1.png" alt="Diagrammes quantile-quantile" width="90%" />
<p class="caption">
(#fig:qqplot)Diagrammes quantile-quantile
</p>
</div>
</div>
<div id="sect025413" class="section level5">
<h5><span class="header-section-number">2.5.4.1.3</span> Vérification de la normalité avec des tests de normalité</h5>
<p>Cinq principaux tests d’hypothèse permettent de vérifier la normalité d’une variable : les tests de <strong>Kolmogorov-Smirnov</strong> (KS), de <strong>Lilliefors</strong> (LF), de <strong>Shapiro-Wilk</strong> (SW), d’<strong>Anderson-Darling</strong> et de <strong>Jarque-Bera</strong> (JB). Sachez toutefois qu’il y en a d’autres non discutés ici (tests de d’Agostino–Pearson, de Cramer–von Mises, de Ryan-Joiner, de Shapiro–Francia, etc.). Pour les formules et une description détaillée de ces tests, vous pouvez consulter Razali et al. <span class="citation">(<a href="#ref-razali2011power" role="doc-biblioref">2011</a>)</span> ou Yap et Sim <span class="citation">(<a href="#ref-yap2011comparisons" role="doc-biblioref">2011</a>)</span>. <strong>Quel test choisir?</strong> Plusieurs auteur(e)s ont comparé ces différents tests à partir de plusieurs échantillons, et ce, en faisant varier la forme de la distribution et le nombre d’observations <span class="citation">(Razali, Wah et others <a href="#ref-razali2011power" role="doc-biblioref">2011</a>; Yap et Sim <a href="#ref-yap2011comparisons" role="doc-biblioref">2011</a>)</span>. Selon Razali et al. <span class="citation">(<a href="#ref-razali2011power" role="doc-biblioref">2011</a>)</span>, le meilleur test semble être celui de Shapiro-Wilk, puis ceux d’Anderson-Darling, de Lilliefors et de Kolmogorov-Smirnov. Yap et Sim <span class="citation">(<a href="#ref-yap2011comparisons" role="doc-biblioref">2011</a>)</span> concluent aussi que le Shapiro-Wilk semble être le plus performant.</p>
<p>Quoi qu’il en soit, ces cinq tests postulent que la variable suit une distribution gaussienne (hypothèse nulle, H<sub>0</sub>).</p>
<p>Cela signifie que si la valeur de <em>p</em> associée à la valeur de chacun des tests est inférieure ou égale au seuil alpha choisi (habituellement <span class="math inline">\(\alpha=\mbox{0,05}\)</span>), la distribution est anormale. À l’inverse, si <span class="math inline">\(p&gt;\mbox{0,05}\)</span>, la distribution est normale.</p>
<table>
<caption>
(#tab:testnormalites)Différents tests d’hypothèse pour la normalité
</caption>
<thead>
<tr>
<th>
Test
</th>
<th>
Propriétés et interprétation
</th>
<th>
Fonction R
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Kolmogorov-Smirnov
</td>
<td>
Plus sa valeur est proche de zéro, plus la distribution est normale. L’avantage de ce test est qu’il peut être utilisé pour vérifier si une variable suit la distribution de n’importe quelle loi (autre que la loi normale).
</td>
<td>
<code>ks.test</code> du <em>package</em> <code>stats</code>
</td>
</tr>
<tr>
<td>
Lilliefors
</td>
<td>
Ce test est une adaptation du test de Kolmogorov-Smirnov. Plus sa valeur est proche de zéro, plus la distribution est normale.
</td>
<td>
<code>lillie.test</code> du <em>package</em> <code>nortest</code>
</td>
</tr>
<tr>
<td>
Shapiro-Wilk
</td>
<td>
Si la valeur de la statistique de Shapiro-Wilk est proche de 1, alors la distribution est normale; anormale quand elle est inférieure à 1.
</td>
<td>
<code>shapiro.test</code> du <em>package</em> <code>stats</code>
</td>
</tr>
<tr>
<td>
Anderson-Darling
</td>
<td>
Ce test est une modification du test de Cramer-von Mises (CVM). Il peut être aussi utilisé pour tester d’autres distributions (uniforme, log-normale, exponentielle, Weibull, distribution de pareto généralisée, logistique, etc.).
</td>
<td>
<code>ad.test</code> du <em>package</em> <code>stats</code>
</td>
</tr>
<tr>
<td>
Jarque-Bera
</td>
<td>
Basé sur un test du type multiplicateur de Lagrange, ce test utilise dans son calcul les valeurs du <em>Skewness</em> et du <em>Kurtosis</em>. Plus sa valeur s’approche de 0, plus la distribution est normale. Ce test est surtout utilisé pour vérifier si les résidus d’un modèle de régression linéaire sont normalement distribués; nous y reviendrons dans le chapitre sur la régression multiple. Il s’écrit <span class="math inline">\(JB=\frac{1}{6} \left({g_1}^2+\frac{{g_1}^2}{4} \right)\)</span> avec <span class="math inline">\(g_1\)</span> et <span class="math inline">\(g_2\)</span> qui sont respectivement les valeurs du <em>skewness</em> et du <em>kurtosis</em> de la variable (voir les équations @ref(eq:SkewType1) et @ref(eq:KurtType1)).
</td>
<td>
<code>JarqueBeraTest</code> du <em>package</em> <code>DescTools</code>
</td>
</tr>
</tbody>
</table>
<p>Dans le tableau @ref(tab:calcultestnormalites) sont reportées les valeurs des différents tests pour les cinq types de distribution générés à la figure @ref(fig:CourbeNormale). Sans surprise, pour l’ensemble des tests, la valeur de <em>p</em> est inférieure à 0,05 pour la distribution normale.</p>
<table>
<caption>
(#tab:calcultestnormalites)Tests de normalité pour différentes distributions
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Normale
</th>
<th style="text-align:right;">
Asymétrie négative
</th>
<th style="text-align:right;">
Asymétrie positive
</th>
<th style="text-align:right;">
Leptokurtique
</th>
<th style="text-align:right;">
Platikurtique
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Skewness
</td>
<td style="text-align:right;">
0,016
</td>
<td style="text-align:right;">
1,403
</td>
<td style="text-align:right;">
-1,022
</td>
<td style="text-align:right;">
-0,311
</td>
<td style="text-align:right;">
0,017
</td>
</tr>
<tr>
<td style="text-align:left;">
Kurtosis
</td>
<td style="text-align:right;">
-0,260
</td>
<td style="text-align:right;">
4,045
</td>
<td style="text-align:right;">
0,840
</td>
<td style="text-align:right;">
1,960
</td>
<td style="text-align:right;">
-1,066
</td>
</tr>
<tr>
<td style="text-align:left;">
Kolmogorov-Smirnov (KS)
</td>
<td style="text-align:right;">
0,030
</td>
<td style="text-align:right;">
0,082
</td>
<td style="text-align:right;">
0,088
</td>
<td style="text-align:right;">
0,086
</td>
<td style="text-align:right;">
0,059
</td>
</tr>
<tr>
<td style="text-align:left;">
Lilliefors (LF)
</td>
<td style="text-align:right;">
0,030
</td>
<td style="text-align:right;">
0,082
</td>
<td style="text-align:right;">
0,088
</td>
<td style="text-align:right;">
0,086
</td>
<td style="text-align:right;">
0,059
</td>
</tr>
<tr>
<td style="text-align:left;">
Shapiro-Wilk (SW)
</td>
<td style="text-align:right;">
0,998
</td>
<td style="text-align:right;">
0,911
</td>
<td style="text-align:right;">
0,925
</td>
<td style="text-align:right;">
0,965
</td>
<td style="text-align:right;">
0,966
</td>
</tr>
<tr>
<td style="text-align:left;">
Anderson-Darling (AD)
</td>
<td style="text-align:right;">
0,397
</td>
<td style="text-align:right;">
7,697
</td>
<td style="text-align:right;">
9,264
</td>
<td style="text-align:right;">
5,661
</td>
<td style="text-align:right;">
3,456
</td>
</tr>
<tr>
<td style="text-align:left;">
Jarque-Bera (JB)
</td>
<td style="text-align:right;">
1,262
</td>
<td style="text-align:right;">
488,133
</td>
<td style="text-align:right;">
113,128
</td>
<td style="text-align:right;">
203,183
</td>
<td style="text-align:right;">
17,094
</td>
</tr>
<tr>
<td style="text-align:left;">
KS (valeur p)
</td>
<td style="text-align:right;">
0,774
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
0,001
</td>
<td style="text-align:right;">
0,001
</td>
<td style="text-align:right;">
0,063
</td>
</tr>
<tr>
<td style="text-align:left;">
LF (valeur p)
</td>
<td style="text-align:right;">
0,358
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
</tr>
<tr>
<td style="text-align:left;">
SW (valeur p)
</td>
<td style="text-align:right;">
0,751
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
</tr>
<tr>
<td style="text-align:left;">
AD (valeur p)
</td>
<td style="text-align:right;">
0,366
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
</tr>
<tr>
<td style="text-align:left;">
JB (valeur p)
</td>
<td style="text-align:right;">
0,532
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
</tr>
</tbody>
</table>
<div class="bloc_attention">
<p>La plupart des auteurs s’entendent sur le fait que ces tests sont très restrictifs : plus la taille de votre échantillon est importante, plus les tests risquent de vous signaler que vos distributions sont anormales (à la lecture des valeurs de <em>p</em>).</p>
<p>Certains conseillent même de ne pas les utiliser quand <span class="math inline">\(n&gt;200\)</span> et de vous fier uniquement aux graphiques (histogramme et diagramme Q-Q)!</p>
</div>
<div class="bloc_astuce">
<p>Bref, vérifier la normalité d’une variable n’est pas une tâche si simple. De nouveau, nous vous conseillons vivement de :</p>
<ul>
<li>Construire les graphiques pour analyser visuellement la forme de la distribution (histogramme avec courbe normale et diagramme Q-Q).</li>
<li>Calculer le <em>skewness</em> et le <em>kurtosis</em>.</li>
<li>Calculer plusieurs tests (minimalement Shapiro-Wilk et Kolmogorov-Smirnov).</li>
<li>Accorder une importance particulière aux graphiques lorsque vous traitez de grands échantillons (<span class="math inline">\(n&gt;200\)</span>).</li>
</ul>
</div>
</div>
</div>
<div id="sect02adjdistrib" class="section level4">
<h4><span class="header-section-number">2.5.4.2</span> Tests pour d’autres formes de distribution</h4>
<p>Comme nous l’avons vu, la distribution normale n’est que l’une des multiples distributions existantes. Dans de nombreuses situations, elle ne sera pas adaptée pour décrire vos variables. La démarche à adopter pour trouver une distribution adaptée est la suivante :</p>
<ol style="list-style-type: decimal">
<li>Définissez la nature de votre variable : identifier si elle est discrète ou continue et l’intervalle dans lequel elle est définie. Une variable dont les valeurs sont positives ou négatives ne peut pas être décrite avec une distribution Gamma par exemple (à moins de la décaler).</li>
<li>Explorez votre variable : affichez son histogramme et son graphique de densité pour avoir une vue générale de sa morphologie.</li>
<li>Présélectionnez un ensemble de distributions candidates en tenant compte des observations précédentes. Vous pouvez également vous reporter à la littérature existante sur votre sujet d’étude pour inclure d’autres distributions. Soyez flexible! Une variable strictement positive pourrait tout de même avoir une forme normale. De même, une variable décrivant des comptages suffisamment grands pourrait être mieux décrite par une distribution normale qu’une distribution de Poisson.</li>
<li>Tentez d’ajuster chacune des distributions retenues à vos données et comparez les qualités d’ajustements pour retenir la plus adaptée.</li>
</ol>
<p>Pour ajuster une distribution à un jeu de données, il faut trouver les valeurs des paramètres de cette distribution qui lui permettent d’adopter une forme la plus proche possible des données. Nous appelons cette opération <strong>ajuster un modèle</strong>, puisque la distribution théorique est utilisée pour modéliser les données. L’ajustement des paramètres est un problème d’optimisation que plusieurs algorithmes sont capables de résoudre (<em>gradient descent</em>, <em>Newton-Raphson method</em>, <em>Fisher scoring</em>, etc.). Dans R, le <em>package</em> <code>fitdistrplus</code> permet d’ajuster pratiquement n’importe quelle distribution à des données en offrant plusieurs stratégies d’optimisation grâce à la fonction <code>fitdist</code>. Il suffit de disposer d’une fonction représentant la distribution de densité ou de masse de la distribution en question, généralement noté <code>dnomdeladistribution</code> (<code>dnorm</code>, <code>dgamma</code>, <code>dpoisson</code>, etc.) dans R. Notez que certains <em>packages</em> comme <code>VGAM</code> ou <code>gamlss.dist</code> ajoutent un grand nombre de fonctions de densité et de masse à celles déjà disponibles de base dans R.</p>
<p>Pour comparer l’ajustement de plusieurs distributions théoriques à des données, trois approches doivent être combinées :</p>
<ul>
<li>Observer graphiquement l’ajustement de la courbe théorique à l’histogramme des données. Cela permet d’éliminer au premier coup d’œil les distributions qui ne correspondent pas.</li>
<li>Comparer les <em>loglikelihood</em>. Le <em>loglikelihood</em> est un score d’ajustement des distributions aux données. Pour faire simple, plus le <em>loglikelihood</em> est grand, plus la distribution théorique est proche des données. Référez-vous à l’encadré suivant pour une description plus en profondeur du <em>loglikelihood</em>.</li>
<li>Utiliser le test de Kolmogorov-Smirnov pour déterminer si une distribution particulière est mieux ajustée pour les données.</li>
</ul>
<div class="bloc_aller_loin">
<p><strong>Qu’est-ce-que le <em>loglikelihood</em></strong>?</p>
<p>Le <em>loglikelihood</em> est une mesure de l’ajustement d’un modèle à des données. Il est utilisé à peu près partout en statistique. Comprendre sa signification est donc un exercice important pour développer une meilleure intuition du fonctionnement général de nombreuses méthodes. Si les concepts de fonction de densité et de fonction de masse vous semblent encore flous, reportez-vous à la section @ref(sect024) sur les distributions dans un premier temps.</p>
<p>Admettons que nous disposons d’une variable continue <em>v</em> que nous tentons de modéliser avec une distribution <em>d</em> (il peut s’agir de n’importe quelle distribution). <em>d</em> a une fonction de densité avec laquelle il est possible de calculer, pour chacune des valeurs de <em>v</em>, la probabilité d’être observée selon le modèle <em>d</em>.</p>
<p>Prenons un exemple concret dans R. Admettons que nous avons une variable comprenant 10 valeurs (oui, c’est un petit échantillon, mais c’est pour faire un exemple simple).</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1"></a>v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">7</span>)</span>
<span id="cb236-2"><a href="#cb236-2"></a>moyenne &lt;-<span class="st"> </span><span class="kw">mean</span>(v)</span>
<span id="cb236-3"><a href="#cb236-3"></a>ecart_type &lt;-<span class="st"> </span><span class="kw">sd</span>(v)</span></code></pre></div>
<p>En calculant la moyenne et l’écart-type de la variable, nous obtenons les paramètres d’une distribution normale que nous pouvons utiliser pour représenter les données observées. En utilisant la fonction <code>dnorm</code> (la fonction de densité de la distribution normale), nous pouvons calculer la probabilité d’observer chacune des valeurs de <em>v</em> selon cette distribution normale.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1"></a>probas &lt;-<span class="st"> </span><span class="kw">dnorm</span>(v, moyenne, ecart_type)</span>
<span id="cb237-2"><a href="#cb237-2"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">valeur =</span> v,</span>
<span id="cb237-3"><a href="#cb237-3"></a>                 <span class="dt">proba =</span> probas)</span>
<span id="cb237-4"><a href="#cb237-4"></a><span class="kw">print</span>(df)</span></code></pre></div>
<pre><code>##    valeur      proba
## 1       5 0.11203710
## 2       8 0.19624888
## 3       7 0.22228296
## 4       8 0.19624888
## 5      10 0.06009897
## 6       4 0.04985613
## 7       7 0.22228296
## 8       6 0.18439864
## 9       9 0.12689976
## 10      7 0.22228296</code></pre>
<p>Nous observons ainsi que les valeurs 7 et 8 sont très probables selon le modèle alors que les valeurs 4 et 10 sont très improbables.</p>
<p>Le <em>likelihood</em> est simplement le produit de toutes ces probabilités. Il s’agit donc de <strong>la probabilité conjointe</strong> d’avoir observé toutes les valeurs de <em>v</em> <strong>sous l’hypothèse</strong> que <em>d</em> est la distribution produisant ces valeurs. Si <em>d</em> décrit efficacement <em>v</em>, alors le <em>likelihood</em> est plus grand que si <em>d</em> ne décrit pas efficacement <em>v</em>. Il s’agit d’une forme de raisonnement par l’absurde : après avoir observé <em>v</em>, nous calculons la probabilité d’avoir observé <em>v</em> (<em>likelihood</em>) si notre modèle <em>d</em> était vrai. Si cette probabilité est très basse, alors c’est que notre modèle est mauvais puisqu’on a bien observé <em>v</em>.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1"></a>likelihood_norm &lt;-<span class="st"> </span><span class="kw">prod</span>(probas)</span>
<span id="cb239-2"><a href="#cb239-2"></a><span class="kw">print</span>(likelihood_norm)</span></code></pre></div>
<pre><code>## [1] 3.322759e-09</code></pre>
<p>Cependant, multiplier un grand nombre de valeurs inférieures à zéro tend à produire des chiffres infiniment petits et donc à complexifier grandement le calcul. Nous préférons donc utiliser le <em>loglikelihood</em> : l’idée étant transformer les probabilités obtenues avec la fonction <em>log</em> puis d’additionner leurs résultats, puisque <span class="math inline">\(log(xy) = log(x)+log(y)\)</span>.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1"></a>loglikelihood_norm &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">log</span>(probas))</span>
<span id="cb241-2"><a href="#cb241-2"></a><span class="kw">print</span>(loglikelihood_norm)</span></code></pre></div>
<pre><code>## [1] -19.52247</code></pre>
<p>Comparons ce <em>loglikelihood</em> à celui d’un second modèle dans lequel nous utilisons toujours la distribution normale, mais avec une moyenne différente (faussée en ajoutant +3) :</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1"></a>probas2 &lt;-<span class="st"> </span><span class="kw">dnorm</span>(v, moyenne<span class="op">+</span><span class="dv">3</span>, ecart_type)</span>
<span id="cb243-2"><a href="#cb243-2"></a>loglikelihood_norm2 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">log</span>(probas2))</span>
<span id="cb243-3"><a href="#cb243-3"></a><span class="kw">print</span>(loglikelihood_norm2)</span></code></pre></div>
<pre><code>## [1] -33.53631</code></pre>
<p>Ce second <em>loglikehood</em> est plus faible, indiquant clairement que le premier modèle est plus adapté aux données.</p>
</div>
<p>Passons à la pratique avec deux exemples.</p>
<div id="temps-de-retard-des-bus-de-la-ville-de-toronto" class="section level5">
<h5><span class="header-section-number">2.5.4.2.1</span> Temps de retard des bus de la ville de Toronto</h5>
<p>Analysons les temps de retard pris par les bus de la ville de Toronto lorsqu’un évènement perturbe la circulation. Ce jeu de données est disponible sur le <a href="https://open.toronto.ca/catalogue/?search=bus%20delay&amp;sort=score%20desc" target="_blank">site des données ouvertes de la Ville de Toronto</a>. Compte tenu de la grande quantité d’observations, nous avons fait le choix de nous concentrer sur les évènements ayant eu lieu durant le mois de janvier 2019. Puisque la variable étudiée est une durée exprimée en minutes, elle est strictement positive (supérieure à 0), car un bus avec zéro minute de retard est à l’heure! Nous considérons également qu’un bus ayant plus de 150 minutes de retard (2 heures 30) n’est tout simplement pas passé (personne ne risque d’attendre 2 heures 30 pour prendre son bus). Commençons par charger les données et observer leur distribution empirique.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb245-2"><a href="#cb245-2"></a><span class="co"># charger le jeu de données</span></span>
<span id="cb245-3"><a href="#cb245-3"></a>data_trt_bus &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/univariee/bus-delay-2019_janv.csv&#39;</span>, <span class="dt">sep =</span><span class="st">&#39;;&#39;</span>)</span>
<span id="cb245-4"><a href="#cb245-4"></a><span class="co"># retirer les observations aberrantes</span></span>
<span id="cb245-5"><a href="#cb245-5"></a>data_trt_bus &lt;-<span class="st"> </span><span class="kw">subset</span>(data_trt_bus, data_trt_bus<span class="op">$</span>Min.Delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span></span>
<span id="cb245-6"><a href="#cb245-6"></a><span class="st">                         </span>data_trt_bus<span class="op">$</span>Min.Delay <span class="op">&lt;</span><span class="st"> </span><span class="dv">150</span>)</span>
<span id="cb245-7"><a href="#cb245-7"></a><span class="co"># représenter la distribution empirique du jeu de données</span></span>
<span id="cb245-8"><a href="#cb245-8"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_trt_bus) <span class="op">+</span><span class="st"> </span></span>
<span id="cb245-9"><a href="#cb245-9"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Min.Delay, <span class="dt">y =</span> ..density..), <span class="dt">bins =</span> <span class="dv">40</span>)<span class="op">+</span></span>
<span id="cb245-10"><a href="#cb245-10"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Min.Delay), <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">bw =</span> <span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">0.8</span>)<span class="op">+</span></span>
<span id="cb245-11"><a href="#cb245-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;temps de retard (en minutes)&#39;</span>,</span>
<span id="cb245-12"><a href="#cb245-12"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figbustrt-1.png" alt="Distribution empirique des temps de retard des bus à Toronto en janvier 2019" width="65%" />
<p class="caption">
(#fig:figbustrt)Distribution empirique des temps de retard des bus à Toronto en janvier 2019
</p>
</div>
<p>Compte tenu de la forme de la distribution empirique et de sa nature, quatre distributions sont envisageables :</p>
<ul>
<li>La distribution Gamma, strictement positive et asymétrique, est aussi une généralisation de la distribution exponentielle utilisée pour modéliser des temps d’attente. Pour des raisons similaires, nous pouvons aussi retenir la distribution de Weibull et la distribution log-normale. Nous écartons ici la distribution normale asymétrique puisque le jeu de données n’a clairement pas une forme normale au départ.</li>
<li>La distribution de Pareto, strictement positive et permettant de représenter ici le fait que la plupart des retards durent moins de 10 minutes, mais que quelques retards sont également beaucoup plus longs.</li>
</ul>
<p>Commençons par ajuster les quatre distributions avec la fonction <code>fitdist</code> du <em>package</em> <code>fitdistrplus</code> et représentons-les graphiquement pour éliminer les moins bons candidats. Nous utilisons également le <em>package</em> <code>actuar</code> pour la fonction de densité de Pareto (<code>dpareto</code>).</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1"></a><span class="kw">library</span>(fitdistrplus)</span>
<span id="cb246-2"><a href="#cb246-2"></a><span class="kw">library</span>(actuar)</span>
<span id="cb246-3"><a href="#cb246-3"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb246-4"><a href="#cb246-4"></a><span class="co"># ajustement des modèles</span></span>
<span id="cb246-5"><a href="#cb246-5"></a>model_gamma &lt;-<span class="st"> </span><span class="kw">fitdist</span>(data_trt_bus<span class="op">$</span>Min.Delay, <span class="dt">distr =</span> <span class="st">&quot;gamma&quot;</span>)</span>
<span id="cb246-6"><a href="#cb246-6"></a>model_weibull &lt;-<span class="st"> </span><span class="kw">fitdist</span>(data_trt_bus<span class="op">$</span>Min.Delay, <span class="dt">distr =</span> <span class="st">&quot;weibull&quot;</span>)</span>
<span id="cb246-7"><a href="#cb246-7"></a>model_lognorm &lt;-<span class="st"> </span><span class="kw">fitdist</span>(data_trt_bus<span class="op">$</span>Min.Delay, <span class="dt">distr =</span> <span class="st">&quot;lnorm&quot;</span>)</span>
<span id="cb246-8"><a href="#cb246-8"></a>model_pareto &lt;-<span class="st"> </span><span class="kw">fitdist</span>(data_trt_bus<span class="op">$</span>Min.Delay, <span class="dt">distr =</span> <span class="st">&quot;pareto&quot;</span>, </span>
<span id="cb246-9"><a href="#cb246-9"></a>                        <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">scale =</span> <span class="dv">1</span>),</span>
<span id="cb246-10"><a href="#cb246-10"></a>                        <span class="dt">method =</span> <span class="st">&quot;mse&quot;</span>) <span class="co"># différentes méthodes d&#39;optimisations</span></span>
<span id="cb246-11"><a href="#cb246-11"></a><span class="co"># réalisation des graphiques</span></span>
<span id="cb246-12"><a href="#cb246-12"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data_trt_bus) <span class="op">+</span><span class="st"> </span></span>
<span id="cb246-13"><a href="#cb246-13"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Min.Delay, <span class="dt">y =</span> ..density..), <span class="dt">bins =</span> <span class="dv">40</span>)<span class="op">+</span></span>
<span id="cb246-14"><a href="#cb246-14"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dgamma, <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="fl">0.8</span>, </span>
<span id="cb246-15"><a href="#cb246-15"></a>                <span class="dt">args =</span> <span class="kw">as.list</span>(model_gamma<span class="op">$</span>estimate))<span class="op">+</span></span>
<span id="cb246-16"><a href="#cb246-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;temps de retard (en minutes)&#39;</span>,</span>
<span id="cb246-17"><a href="#cb246-17"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb246-18"><a href="#cb246-18"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Modèle Gamma&quot;</span>)</span>
<span id="cb246-19"><a href="#cb246-19"></a>plot2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data_trt_bus) <span class="op">+</span><span class="st"> </span></span>
<span id="cb246-20"><a href="#cb246-20"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Min.Delay, <span class="dt">y =</span> ..density..), <span class="dt">bins =</span> <span class="dv">40</span>)<span class="op">+</span></span>
<span id="cb246-21"><a href="#cb246-21"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dweibull, <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="fl">0.8</span>, </span>
<span id="cb246-22"><a href="#cb246-22"></a>                <span class="dt">args =</span> <span class="kw">as.list</span>(model_weibull<span class="op">$</span>estimate))<span class="op">+</span></span>
<span id="cb246-23"><a href="#cb246-23"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;temps de retard (en minutes)&#39;</span>,</span>
<span id="cb246-24"><a href="#cb246-24"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb246-25"><a href="#cb246-25"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Modèle Weibull&quot;</span>)</span>
<span id="cb246-26"><a href="#cb246-26"></a>plot3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data_trt_bus) <span class="op">+</span><span class="st"> </span></span>
<span id="cb246-27"><a href="#cb246-27"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Min.Delay, <span class="dt">y =</span> ..density..), <span class="dt">bins =</span> <span class="dv">40</span>)<span class="op">+</span></span>
<span id="cb246-28"><a href="#cb246-28"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dlnorm, <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="fl">0.8</span>, </span>
<span id="cb246-29"><a href="#cb246-29"></a>                <span class="dt">args =</span> <span class="kw">as.list</span>(model_lognorm<span class="op">$</span>estimate))<span class="op">+</span></span>
<span id="cb246-30"><a href="#cb246-30"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;temps de retard (en minutes)&#39;</span>,</span>
<span id="cb246-31"><a href="#cb246-31"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb246-32"><a href="#cb246-32"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Modèle log-normal&quot;</span>)</span>
<span id="cb246-33"><a href="#cb246-33"></a>plot4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data_trt_bus) <span class="op">+</span><span class="st"> </span></span>
<span id="cb246-34"><a href="#cb246-34"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Min.Delay, <span class="dt">y =</span> ..density..), <span class="dt">bins =</span> <span class="dv">40</span>)<span class="op">+</span></span>
<span id="cb246-35"><a href="#cb246-35"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dpareto, <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="fl">0.8</span>, </span>
<span id="cb246-36"><a href="#cb246-36"></a>                <span class="dt">args =</span> <span class="kw">as.list</span>(model_pareto<span class="op">$</span>estimate))<span class="op">+</span></span>
<span id="cb246-37"><a href="#cb246-37"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;temps de retard (en minutes)&#39;</span>,</span>
<span id="cb246-38"><a href="#cb246-38"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb246-39"><a href="#cb246-39"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Modèle Pareto&quot;</span>)</span>
<span id="cb246-40"><a href="#cb246-40"></a><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> <span class="kw">list</span>(plot1, plot2, plot3, plot4),</span>
<span id="cb246-41"><a href="#cb246-41"></a>          <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figbustrt2-1.png" alt="Comparaison des distributions ajustées aux données de retard des bus" width="65%" />
<p class="caption">
(#fig:figbustrt2)Comparaison des distributions ajustées aux données de retard des bus
</p>
</div>
<p>Visuellement, nous constatons que la distribution de Pareto est un mauvais choix. Pour les trois autres distributions, la comparaison des valeurs de <em>loglikelihood</em> s’impose (tableau @ref(tab:tabledistribs)).</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">model =</span> <span class="kw">c</span>(<span class="st">&quot;Gamma&quot;</span>,<span class="st">&quot;Weibull&quot;</span>,</span>
<span id="cb247-2"><a href="#cb247-2"></a>                           <span class="st">&quot;log-normal&quot;</span>), </span>
<span id="cb247-3"><a href="#cb247-3"></a>                 <span class="dt">loglikelihood =</span> <span class="kw">c</span>(model_gamma<span class="op">$</span>loglik, </span>
<span id="cb247-4"><a href="#cb247-4"></a>                 model_weibull<span class="op">$</span>loglik,</span>
<span id="cb247-5"><a href="#cb247-5"></a>                 model_lognorm<span class="op">$</span>loglik))</span>
<span id="cb247-6"><a href="#cb247-6"></a><span class="kw">show_table</span>(df, </span>
<span id="cb247-7"><a href="#cb247-7"></a>      <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Distribution&quot;</span>,<span class="st">&quot;LogLikelihood&quot;</span>),</span>
<span id="cb247-8"><a href="#cb247-8"></a>      <span class="dt">caption =</span> <span class="st">&#39;Comparaison des LogLikelihood des trois distributions&#39;</span>,</span>
<span id="cb247-9"><a href="#cb247-9"></a>      <span class="dt">align=</span> <span class="kw">c</span>(<span class="st">&quot;l&quot;</span>, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb247-10"><a href="#cb247-10"></a>          )</span></code></pre></div>
<table>
<caption>
(#tab:tabledistribs)Comparaison des LogLikelihood des trois distributions
</caption>
<thead>
<tr>
<th style="text-align:left;">
Distribution
</th>
<th style="text-align:right;">
LogLikelihood
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Gamma
</td>
<td style="text-align:right;">
-23 062,56
</td>
</tr>
<tr>
<td style="text-align:left;">
Weibull
</td>
<td style="text-align:right;">
-23 195,54
</td>
</tr>
<tr>
<td style="text-align:left;">
log-normal
</td>
<td style="text-align:right;">
-23 375,74
</td>
</tr>
</tbody>
</table>
<p>Le plus grand <em>logLikelihood</em> est obtenu par la distribution de Gamma qui s’ajuste donc le mieux à nos données. Pour finir, nous pouvons tester formellement, avec le test de Kolmogorov-Smirnov, si les données proviennent bien de cette distribution de Gamma.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1"></a>params &lt;-<span class="st"> </span><span class="kw">as.list</span>(model_gamma<span class="op">$</span>estimate)</span>
<span id="cb248-2"><a href="#cb248-2"></a><span class="kw">ks.test</span>(data_trt_bus<span class="op">$</span>Min.Delay,</span>
<span id="cb248-3"><a href="#cb248-3"></a>        <span class="dt">y =</span> pgamma, <span class="dt">shape =</span> params<span class="op">$</span>shape, <span class="dt">rate =</span> params<span class="op">$</span>rate)</span></code></pre></div>
<pre><code>## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  data_trt_bus$Min.Delay
## D = 0.099912, p-value &lt; 2.2e-16
## alternative hypothesis: two-sided</code></pre>
<p>Comme la valeur de <em>p</em> est inférieure à 0,05, nous ne pouvons pas accepter l’hypothèse que notre jeu de données suit effectivement un loi de Gamma. Considérant le nombre d’observations et le fait que de nombreux temps d’attente sont identiques (ce à quoi le test est très sensible), ce résultat n’est pas surprenant. La distribution de Gamma reste cependant la distribution qui représente le mieux nos données. Nous pouvons estimer grâce, à cette distribution, la probabilité qu’un bus ait un retard de plus de 10 minutes de la façon suivante :</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1"></a><span class="kw">pgamma</span>(<span class="dv">10</span>, <span class="dt">shape =</span> params<span class="op">$</span>shape, <span class="dt">rate =</span> params<span class="op">$</span>rate, <span class="dt">lower.tail =</span> F)</span></code></pre></div>
<pre><code>## [1] 0.5409424</code></pre>
<p>ce qui correspond à 54 % de chance.</p>
<p>Pour moins de 10 minutes :</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1"></a><span class="kw">pgamma</span>(<span class="dv">10</span>, <span class="dt">shape =</span> params<span class="op">$</span>shape, <span class="dt">rate =</span> params<span class="op">$</span>rate, <span class="dt">lower.tail =</span> T)</span></code></pre></div>
<pre><code>## [1] 0.4590576</code></pre>
<p>soit 46 %.</p>
<p>Un dernier exemple avec la probabilité qu’un retard dépasse 45 minutes :</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1"></a><span class="kw">pgamma</span>(<span class="dv">45</span>, <span class="dt">shape =</span> params<span class="op">$</span>shape, <span class="dt">rate =</span> params<span class="op">$</span>rate, <span class="dt">lower.tail =</span> F)</span></code></pre></div>
<pre><code>## [1] 0.01348194</code></pre>
<p>Soit seulement 1,3 %.</p>
<p>Par conséquent, si un matin à Toronto votre bus a plus de 45 minutes de retard, bravo, vous êtes tombé sur une des très rares occasions où un tel retard se produit!</p>
</div>
<div id="accidents-de-vélo-à-montréal" class="section level5">
<h5><span class="header-section-number">2.5.4.2.2</span> Accidents de vélo à Montréal</h5>
<p>Le second jeu de données représente le nombre d’accidents de la route impliquant un vélo sur les intersections dans les quartiers centraux de Montréal (@ref(fig:figaccmtl)). Le jeu de données complet est disponible sur le site des <a href="http://donnees.ville.montreal.qc.ca/dataset/collisions-routieres" target="_blank">données ouvertes</a> de la Ville de Montréal. Puisque ces données correspondent à des comptages, la première distribution à envisager est la distribution de Poisson. Cependant, puisque nous aurons également un grand nombre d’intersections sans accident, il serait judicieux de tester la distribution de Poisson avec excès de zéro.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb256-2"><a href="#cb256-2"></a><span class="co"># charger le jeu de données</span></span>
<span id="cb256-3"><a href="#cb256-3"></a>data_accidents &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/univariee/accidents_mtl.csv&#39;</span>, <span class="dt">sep =</span><span class="st">&#39;,&#39;</span>)</span>
<span id="cb256-4"><a href="#cb256-4"></a>counts &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">table</span>(data_accidents<span class="op">$</span>nb_accident))</span>
<span id="cb256-5"><a href="#cb256-5"></a><span class="kw">names</span>(counts) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;nb_accident&quot;</span>,<span class="st">&#39;frequence&#39;</span>)</span>
<span id="cb256-6"><a href="#cb256-6"></a>counts<span class="op">$</span>nb_accident &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(counts<span class="op">$</span>nb_accident))</span>
<span id="cb256-7"><a href="#cb256-7"></a>counts<span class="op">$</span>prop &lt;-<span class="st"> </span>counts<span class="op">$</span>frequence <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(counts<span class="op">$</span>frequence)</span>
<span id="cb256-8"><a href="#cb256-8"></a><span class="co"># représenter la distribution empirique du jeu de donnée</span></span>
<span id="cb256-9"><a href="#cb256-9"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> counts) <span class="op">+</span><span class="st"> </span></span>
<span id="cb256-10"><a href="#cb256-10"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>nb_accident, <span class="dt">weight =</span> frequence), <span class="dt">width =</span> <span class="fl">0.5</span>)<span class="op">+</span></span>
<span id="cb256-11"><a href="#cb256-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;nombre d&#39;accidents&quot;</span>,</span>
<span id="cb256-12"><a href="#cb256-12"></a>      <span class="dt">y =</span> <span class="st">&#39;fréquence&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figaccmtl-1.png" alt="Distribution empirique du nombre d'accidents par intersection impliquant un ou une cycliste à Montréal en 2017 dans les quartiers centraux" width="65%" />
<p class="caption">
(#fig:figaccmtl)Distribution empirique du nombre d’accidents par intersection impliquant un ou une cycliste à Montréal en 2017 dans les quartiers centraux
</p>
</div>
<p>Nous avons effectivement de nombreux zéros, alors essayons d’ajuster nos deux distributions à ce jeu de données. Dans la figure @ref(fig:figaccmtldist), les barres grises représentent la distribution empirique du jeu de données et les barres rouges, les distributions théoriques ajustées. Nous utilisons ici le <em>package</em> <code>gamlss.dist</code> pour avoir la fonction de masse d’une distribution de Poisson avec excès de zéros.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1"></a><span class="kw">library</span>(gamlss.dist)</span>
<span id="cb257-2"><a href="#cb257-2"></a><span class="co">#ajuster le modèle de poisson</span></span>
<span id="cb257-3"><a href="#cb257-3"></a>model_poisson &lt;-<span class="st"> </span><span class="kw">fitdist</span>(data_accidents<span class="op">$</span>nb_accident, <span class="dt">distr =</span> <span class="st">&quot;pois&quot;</span>)</span>
<span id="cb257-4"><a href="#cb257-4"></a><span class="co">#ajuster le modèle de poisson avec excès de zéros</span></span>
<span id="cb257-5"><a href="#cb257-5"></a>model_poissonzi &lt;-<span class="st"> </span><span class="kw">fitdist</span>(data_accidents<span class="op">$</span>nb_accident, <span class="st">&quot;ZIP&quot;</span>,</span>
<span id="cb257-6"><a href="#cb257-6"></a>    <span class="dt">start =</span> <span class="kw">list</span>(<span class="dt">mu =</span> <span class="dv">4</span>, <span class="dt">sigma =</span> <span class="fl">0.15</span>), <span class="co"># valeurs pour faciliter la convergence</span></span>
<span id="cb257-7"><a href="#cb257-7"></a>    <span class="dt">optim.method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>, <span class="co"># méthode d&#39;optimisation recommandée dans la documentation</span></span>
<span id="cb257-8"><a href="#cb257-8"></a>    <span class="dt">lower =</span> <span class="kw">c</span>(<span class="fl">0.00001</span>, <span class="fl">0.00001</span>), <span class="co"># valeurs minimales des deux paramètres</span></span>
<span id="cb257-9"><a href="#cb257-9"></a>    <span class="dt">upper =</span> <span class="kw">c</span>(<span class="ot">Inf</span>, <span class="dv">1</span>)<span class="co"># valeurs maximales des deux paramètres</span></span>
<span id="cb257-10"><a href="#cb257-10"></a>    )</span>
<span id="cb257-11"><a href="#cb257-11"></a>dfpoisson &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>),</span>
<span id="cb257-12"><a href="#cb257-12"></a>                        <span class="dt">y=</span><span class="kw">dpois</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>, model_poisson<span class="op">$</span>estimate)</span>
<span id="cb257-13"><a href="#cb257-13"></a>                        )</span>
<span id="cb257-14"><a href="#cb257-14"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb257-15"><a href="#cb257-15"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>nb_accident, <span class="dt">weight =</span> prop), <span class="dt">width =</span> <span class="fl">0.6</span>, <span class="dt">data =</span> counts)<span class="op">+</span></span>
<span id="cb257-16"><a href="#cb257-16"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">weight =</span> y), <span class="dt">width =</span> <span class="fl">0.15</span>, <span class="dt">data =</span> dfpoisson, <span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb257-17"><a href="#cb257-17"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="dv">7</span>), <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">7</span>))<span class="op">+</span></span>
<span id="cb257-18"><a href="#cb257-18"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Modèle de Poisson&quot;</span>,</span>
<span id="cb257-19"><a href="#cb257-19"></a>       <span class="dt">x =</span> <span class="st">&quot;nombre d&#39;accidents&quot;</span>,</span>
<span id="cb257-20"><a href="#cb257-20"></a>       <span class="dt">y =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb257-21"><a href="#cb257-21"></a>dfpoissonzi &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>),</span>
<span id="cb257-22"><a href="#cb257-22"></a>                        <span class="dt">y=</span><span class="kw">dZIP</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>, model_poissonzi<span class="op">$</span>estimate[[<span class="dv">1</span>]],</span>
<span id="cb257-23"><a href="#cb257-23"></a>                               model_poissonzi<span class="op">$</span>estimate[[<span class="dv">2</span>]])</span>
<span id="cb257-24"><a href="#cb257-24"></a>                        )</span>
<span id="cb257-25"><a href="#cb257-25"></a>plot2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb257-26"><a href="#cb257-26"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>nb_accident, <span class="dt">weight =</span> prop), <span class="dt">width =</span> <span class="fl">0.6</span>, <span class="dt">data =</span> counts)<span class="op">+</span></span>
<span id="cb257-27"><a href="#cb257-27"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">weight =</span> y), <span class="dt">width =</span> <span class="fl">0.15</span>, <span class="dt">data =</span> dfpoissonzi, <span class="dt">fill =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb257-28"><a href="#cb257-28"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="dv">7</span>), <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">7</span>))<span class="op">+</span></span>
<span id="cb257-29"><a href="#cb257-29"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Modèle de Poisson avec excès de zéro&quot;</span>,</span>
<span id="cb257-30"><a href="#cb257-30"></a>       <span class="dt">x =</span> <span class="st">&quot;nombre d&#39;accident&quot;</span>,</span>
<span id="cb257-31"><a href="#cb257-31"></a>       <span class="dt">y =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb257-32"><a href="#cb257-32"></a><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> <span class="kw">list</span>(plot1,plot2), <span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figaccmtldist-1.png" alt="Ajustement des distributions de Poisson et Poisson avec excès de zéros" width="65%" />
<p class="caption">
(#fig:figaccmtldist)Ajustement des distributions de Poisson et Poisson avec excès de zéros
</p>
</div>
<p>Visuellement, comme nous pouvons l’observer à la figure @ref(fig:figaccmtldist), le modèle avec excès de zéro semble s’imposer. Nous pouvons vérifier cette impression avec la comparaison des <em>loglikelihood</em>.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1"></a><span class="kw">print</span>(model_poisson<span class="op">$</span>loglik)</span></code></pre></div>
<pre><code>## [1] -989.83</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1"></a><span class="kw">print</span>(model_poissonzi<span class="op">$</span>loglik)</span></code></pre></div>
<pre><code>## [1] -931.8778</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1"></a><span class="co">#afficher les paramètres ajustés</span></span>
<span id="cb262-2"><a href="#cb262-2"></a>model_poisson<span class="op">$</span>estimate</span></code></pre></div>
<pre><code>##    lambda 
## 0.1991963</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1"></a>model_poissonzi<span class="op">$</span>estimate</span></code></pre></div>
<pre><code>##        mu     sigma 
## 0.6690301 0.7022605</code></pre>
<p>Nous avons donc la confirmation que le modèle de Poisson avec excès de zéros est mieux ajusté. Nous apprenons donc que 70 % (sigma = 0,70) des intersections sont en fait exclues du phénomène étudié (probablement parce que très peu de cyclistes les utilisent ou parce qu’elles sont très peu accidentogènes) et que pour les autres, le taux d’accidents par année en 2017 était de 0,67 (<em>mu</em> = 0,669, <em>mu</em> signifiant <span class="math inline">\(\lambda\)</span> pour le <em>package</em> <code>gamlss</code>). À nouveau, nous pouvons effectuer un test formel avec le fonction <code>ks.test</code>.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1"></a>params &lt;-<span class="st"> </span><span class="kw">as.list</span>(model_poissonzi<span class="op">$</span>estimate)</span>
<span id="cb266-2"><a href="#cb266-2"></a><span class="kw">ks.test</span>(data_accidents<span class="op">$</span>nb_accident,</span>
<span id="cb266-3"><a href="#cb266-3"></a>        <span class="dt">y =</span> pZIP, <span class="dt">mu =</span> params<span class="op">$</span>mu, <span class="dt">sigma =</span> params<span class="op">$</span>sigma)</span></code></pre></div>
<pre><code>## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  data_accidents$nb_accident
## D = 0.85476, p-value &lt; 2.2e-16
## alternative hypothesis: two-sided</code></pre>
<p>Encore une fois, nous devons rejeter l’hypothèse selon laquelle le test suit une distribution de Poisson avec excès de zéros. Ces deux exemples montrent à quel point ce test est restrictif.</p>
</div>
</div>
</div>
<div id="sect0255" class="section level3">
<h3><span class="header-section-number">2.5.5</span> Transformation des variables</h3>
<div id="sect02551" class="section level4">
<h4><span class="header-section-number">2.5.5.1</span> Transformations visant à atteindre la normalité</h4>
<p>Comme énoncé au début de cette section, plusieurs méthodes statistiques nécessitent que la variable quantitative soit normalement distribuée. C’est notamment le cas de l’analyse de variance et des tests <em>t</em> (abordés dans les chapitres suivants) qui fournissent des résultats plus robustes lorsque la variable est normalement distribuée. Plusieurs transformations sont possibles, les plus courantes étant la racine carrée, le logarithme et l’inverse de la variable. Selon plusieurs auteur(e)s (notamment, les statisticiennes Barbara G. Tabacknick et Linda S. Fidell <span class="citation">(<a href="#ref-tabachnick2007" role="doc-biblioref">2007</a>, 5:89)</span>), en fonction du type (positive ou négative) et du degré d’asymétrie, les transformations suivantes sont possibles afin d’améliorer la normalité de la variable :</p>
<ul>
<li>Asymétrie positive modérée : la racine carrée de la variable <em>X</em> avec la fonction <code>sqrt(df$x)</code>.</li>
<li>Asymétrie positive importante : le logarithme de la variable avec <code>log10(df$x)</code>.</li>
<li>Asymétrie positive sévère : l’inverse de la variable avec <code>1/(df$x)</code>.</li>
</ul>
<div class="bloc_astuce">
<p>Pour une valeur égale ou inférieure à 0, nous ne pouvons pas calculer une racine carrée ou un logarithme. Par conséquent, il convient de décaler simplement la distribution vers la droite afin de s’assurer qu’il n’y ait plus de valeurs négatives ou égales à 0 :</p>
<ul>
<li><code>sqrt(df$x - min(df$x+1))</code>pour une asymétrie positive avec des valeurs négatives ou égales à 0</li>
<li><code>log(df$x - min(df$x+1))</code>pour une asymétrie positive avec des valeurs négatives ou égales à 0</li>
</ul>
<p>Par exemple, si la valeur minimale de la variable est égale à -10, la valeur minimale de variable décalée sera ainsi de 11.</p>
<ul>
<li>Asymétrie négative modérée : <code>sqrt(max(df$x+1) - df$x)</code></li>
<li>Asymétrie négative importante : <code>log(max(df$x+1) - df$x)</code></li>
<li>Asymétrie négative sévère : <code>1/(max(df$x+1) - df$x)</code></li>
</ul>
</div>
<div class="bloc_attention">
<p><strong>Transformation des variables pour atteindre la normalité : ce n’est pas toujours la panacée!</strong></p>
<p>La transformation des données fait et fera encore longtemps débat à la fois parmi les statisticien(ne)s, et les personnes utilisatrices débutantes ou avancées des méthodes quantitatives. Field et al. <span class="citation">(<a href="#ref-field2012discovering" role="doc-biblioref">2012</a>, 193)</span> résument le tout avec humour : « to transform or not transform, that is the question ».</p>
<p><strong>Avantages de la transformation</strong></p>
<ul>
<li>L’obtention de <em>résultats plus robustes</em>.</li>
<li>Dans une régression linéaire multiple, la transformation de la variable dépendante peut <em>remédier au non-respect des hypothèses de base liées à la régression</em> (linéarité et homoscédasticité des erreurs, absence de valeurs aberrantes, etc.).</li>
</ul>
<p><strong>Inconvénients de la transformation</strong></p>
<ul>
<li><p><em>Une variable transformée est plus difficile à interpréter</em> puisque cela change l’unité de mesure de la variable. Prenons un exemple concret : vous souhaitez comparer les moyennes de revenu de deux groupes <em>A</em> et <em>B</em>. Vous obtenez une différence de 15 000 $, soit une valeur facile à interpréter. Par contre, si la variable a été préalablement transformée en logarithme, il est possible que vous obteniez une différence de 9, ce qui est beaucoup moins parlant. Aussi, en transformant la variable en <em>log</em>, vous ne comparez plus les moyennes arithmétiques des deux groupes, mais plutôt leurs moyennes géométriques <span class="citation">(Field, Miles et Field <a href="#ref-field2012discovering" role="doc-biblioref">2012</a>, 193)</span>.</p></li>
<li><p><em>Pourquoi perdre la forme initiale de la distribution du phénomène à expliquer?</em> Il est possible, pour de nombreuses méthodes de choisir la distribution que nous souhaitons utiliser, il n’est donc pas nécessaire de toujours se limiter à la distribution normale. Par exemple, dans les modèles de régression généralisés (GLM), nous pourrions indiquer que la variable indépendante suit une distribution de Student plutôt que de vouloir à tout prix la rendre normale. De même, certains tests non paramétriques permettent d’analyser des variables ne suivant pas une distribution normale.</p></li>
</ul>
<p><strong>Démarche à suivre avant et après la transformation</strong></p>
<ul>
<li><p><em>La transformation est-elle nécessaire?</em> Ne transformez jamais une variable sans avoir analysé rigoureusement sa forme (histogramme avec courbe normale, <em>skewness</em> et <em>kurtosis</em>, tests de normalité).</p></li>
<li><p><em>D’autres options à la transformation d’une variable dépendante (VD) sont-elles envisageables?</em> Identifiez la forme de la distribution de la VD et utilisez au besoin un modèle GLM adapté à cette distribution. Autrement dit, ne transformez pas automatiquement votre VD simplement pour l’introduire dans une régression linéaire multiple.</p></li>
<li><p><em>La transformation a-t-elle un apport significatif?</em> Premièrement, vérifiez si la transformation utilisée (logarithme, racine carrée, inverse, etc.) améliore la normalité de la variable. Ce n’est pas toujours le cas, parfois c’est pire! Prenez soin de comparer les histogrammes, les valeurs de <em>skewness</em>, de <em>kurtosis</em> et des différents tests de normalité avant et après la transformation. Deuxièmement, comparez les résultats de vos analyses statistiques sans et avec transformation, et ce, dans une démarche coût-avantage. Vos résultats sont-ils bien plus robustes? Par exemple, un R<sup>2</sup> qui passe de 0,597 à 0,602 (avant et après la transformation des variables) avec des associations significatives similaires, mais qui sont plus difficiles à interpréter (du fait des transformations), n’est pas forcément un gain significatif. La modélisation en sciences sociales ne vise pas à prédire la trajectoire d’un satellite ou l’atterrissage d’un engin sur Mars! La précision à la quatrième décimale n’est pas une condition! Par conséquent, un modèle un peu moins robuste, mais plus facile à interpréter est parfois préférable.</p></li>
</ul>
</div>
</div>
<div id="sect02552" class="section level4">
<h4><span class="header-section-number">2.5.5.2</span> Autres types de transformations</h4>
<p>Les trois transformations les plus couramment utilisées sont :</p>
<ul>
<li><strong>La côte <span class="math inline">\(z\)</span></strong> (<em>z score</em> en anglais) qui consiste à soustraire à chaque valeur sa moyenne (soit un centrage), puis à la diviser par son écart-type (soit une réduction) (équation @ref(eq:scorez)). Par conséquent, nous parlons aussi de variable centrée réduite qui a comme propriétés intéressantes une moyenne égale à 0 et un écart-type égal à 1 (la variance est aussi égale à 1 puisque 1<sup>2</sup> = 1). Nous verrons que cette transformation est largement utilisée dans les méthodes de classification (chapitre @ref(chap13)) et les méthodes factorielles (chapitre @ref(chap12)).</li>
</ul>

<p><span class="math display">\[\begin{equation}  
z= \frac{x_i-\mu}{\sigma}
(\#eq:scorez)
\end{equation}\]</span>
</p>
<ul>
<li><p><strong>La transformation en rang</strong> qui consiste simplement à trier une variable en ordre croissant, puis à affecter le rang de chaque observation de 1 à <span class="math inline">\(n\)</span>. Cette transformation est très utilisée quand la variable est très anormalement distribuée, notamment pour calculer le coefficient de corrélation de Spearman (section @ref(sect0433)) et certains tests non paramétriques (sections @ref(sect0612) et @ref(sect0622)).</p></li>
<li><p><strong>La transformation sur une échelle de 0 à 1</strong> (ou de 0 à 100) qui consiste à soustraite à chaque observation la valeur minimale et à diviser le tout par l’étendue (équation @ref(eq:t01)).</p></li>
</ul>

<p><span class="math display">\[\begin{equation}  
X_{\in\lbrack0-1\rbrack}= \frac{x_i-max}{max-min} \text{ ou } X_{\in\lbrack0-100\rbrack}= \frac{x_i-min}{max-min}\times100
(\#eq:t01)
\end{equation}\]</span>
</p>
<table>
<caption>
(#tab:AutresTransformation)Illustration des trois transformations
</caption>
<thead>
<tr>
<th style="text-align:left;">
Observation
</th>
<th style="text-align:right;">
<span class="math inline">\(x_i\)</span>
</th>
<th style="text-align:right;">
Côte <span class="math inline">\(z\)</span>
</th>
<th style="text-align:center;">
Rang
</th>
<th style="text-align:right;">
0 à 1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
22,00
</td>
<td style="text-align:right;">
-1,45
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:right;">
0,00
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
27,00
</td>
<td style="text-align:right;">
-0,65
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:right;">
0,28
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
25,00
</td>
<td style="text-align:right;">
-0,97
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:right;">
0,17
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
30,00
</td>
<td style="text-align:right;">
-0,16
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:right;">
0,44
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
37,00
</td>
<td style="text-align:right;">
0,97
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:right;">
0,83
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
32,00
</td>
<td style="text-align:right;">
0,16
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:right;">
0,56
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:right;">
35,00
</td>
<td style="text-align:right;">
0,65
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:right;">
0,72
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:right;">
40,00
</td>
<td style="text-align:right;">
1,45
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:right;">
1,00
</td>
</tr>
<tr>
<td style="text-align:left;">
Moyenne
</td>
<td style="text-align:right;">
31,00
</td>
<td style="text-align:right;">
0,00
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Écart-type
</td>
<td style="text-align:right;">
6,19
</td>
<td style="text-align:right;">
1,00
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
<p>Pour un <em>DataFrame</em>, nommé <em>df</em>, comprenant une variable <em>X</em>, la syntaxe ci-dessous illustre comment obtenir quatre transformations (côte <span class="math inline">\(z\)</span>, rang, 0 à 1 et 0 à 100).</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">X =</span> <span class="kw">c</span>(<span class="dv">22</span>,<span class="dv">27</span>,<span class="dv">25</span>,<span class="dv">30</span>,<span class="dv">37</span>,<span class="dv">32</span>,<span class="dv">35</span>,<span class="dv">40</span>))</span>
<span id="cb268-2"><a href="#cb268-2"></a></span>
<span id="cb268-3"><a href="#cb268-3"></a><span class="co"># Transformation centrée réduite : côte Z</span></span>
<span id="cb268-4"><a href="#cb268-4"></a>df2<span class="op">$</span>zX &lt;-<span class="st"> </span>(df2<span class="op">$</span>X<span class="op">-</span><span class="kw">mean</span>(df2<span class="op">$</span>X))<span class="op">/</span><span class="kw">sd</span>(df2<span class="op">$</span>X)</span>
<span id="cb268-5"><a href="#cb268-5"></a><span class="co"># ou encore avec la fonction scale</span></span>
<span id="cb268-6"><a href="#cb268-6"></a>df2<span class="op">$</span>zX &lt;-<span class="st">  </span><span class="kw">scale</span>(df2<span class="op">$</span>X, <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</span>
<span id="cb268-7"><a href="#cb268-7"></a></span>
<span id="cb268-8"><a href="#cb268-8"></a><span class="co"># Transformation en rang avec la fonction rank</span></span>
<span id="cb268-9"><a href="#cb268-9"></a>df2<span class="op">$</span>rX &lt;-<span class="st"> </span><span class="kw">rank</span>(df2<span class="op">$</span>X)</span>
<span id="cb268-10"><a href="#cb268-10"></a></span>
<span id="cb268-11"><a href="#cb268-11"></a><span class="co"># Transformation de 0 à 1 ou de 0 à 100</span></span>
<span id="cb268-12"><a href="#cb268-12"></a>df2<span class="op">$</span>X01 &lt;-<span class="st"> </span>(df2<span class="op">$</span>X<span class="op">-</span><span class="kw">min</span>(df2<span class="op">$</span>X))<span class="op">/</span>(<span class="kw">max</span>(df2<span class="op">$</span>X)<span class="op">-</span><span class="kw">min</span>(df2<span class="op">$</span>X))</span>
<span id="cb268-13"><a href="#cb268-13"></a>df2<span class="op">$</span>X0100 &lt;-<span class="st"> </span>(df2<span class="op">$</span>X<span class="op">-</span><span class="kw">min</span>(df2<span class="op">$</span>X))<span class="op">/</span>(<span class="kw">max</span>(df2<span class="op">$</span>X)<span class="op">-</span><span class="kw">min</span>(df2<span class="op">$</span>X))<span class="op">*</span><span class="dv">100</span></span></code></pre></div>
<div class="bloc_aller_loin">
<p>Ces trois transformations sont parfois utilisées pour générer un indice composite à partir de plusieurs variables ou encore dans une analyse de sensibilité avec les indices de Sobol <span class="citation">(<a href="#ref-Sobol1993" role="doc-biblioref">1993</a>)</span>.</p>
</div>
</div>
</div>
<div id="sect0256" class="section level3">
<h3><span class="header-section-number">2.5.6</span> Mise en œuvre dans R</h3>
<p>Il existe une multitude de <em>packages</em> dédiés au calcul des statistiques descriptives univariées. Par parcimonie, nous en utiliserons uniquement trois : <code>DescTools</code>, <code>nortest</code> et <code>stats</code>. Libre à vous de faire vos recherches sur Internet pour utiliser d’autres <em>packages</em> au besoin. Les principales fonctions que nous utilisons ici sont :</p>
<ul>
<li><code>summary</code> : pour obtenir un résumé sommaire des statistiques descriptives (minimum, Q1, Q2, Q3, maximum)</li>
<li><code>mean</code> : moyenne</li>
<li><code>min</code> : minimum</li>
<li><code>max</code> : maximum</li>
<li><code>range</code> : minimum et maximum</li>
<li><code>quantile</code> : quartiles</li>
<li><code>quantile((x, probs = seq(.0, 1, by = .2))</code> : quintiles</li>
<li><code>quantile((x, probs = seq(.0, 1, by = .1))</code> : déciles</li>
<li><code>var</code> : variance</li>
<li><code>sd</code> : écart-type</li>
<li><code>Skew</code> du <em>package</em> <code>DescTools</code> : coefficient d’asymétrie</li>
<li><code>Kurt</code> du <em>package</em> <code>DescTools</code> : coefficient d’aplatissement</li>
<li><code>ks.test(x, "pnorm", mean=mean(x), sd=sd(x))</code> du <em>package</em> <code>nortest</code> : test de Kolmogorov-Smirnov</li>
<li><code>shapiro.test</code> du <em>package</em> <code>DescTools</code> : test de Shapiro-Wilk</li>
<li><code>lillie.test</code> du <em>package</em> <code>DescTools</code> : du package <code>nortest</code> : test de Lilliefors</li>
<li><code>ad.test</code> du <em>package</em> <code>DescTools</code> : test d’Anderson-Darling</li>
<li><code>JarqueBeraTest</code> du <em>package</em> <code>DescTools</code> : test de Jarque-Bera</li>
</ul>
<div id="sect02561" class="section level4">
<h4><span class="header-section-number">2.5.6.1</span> Application à une seule variable</h4>
<p>Admettons que vous voulez obtenir des statistiques pour une seule variable présente dans un <em>DataFrame</em> (<code>dataMTL$PctFRev</code>) :</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1"></a><span class="kw">library</span>(DescTools)</span>
<span id="cb269-2"><a href="#cb269-2"></a><span class="kw">library</span>(stats)</span>
<span id="cb269-3"><a href="#cb269-3"></a><span class="kw">library</span>(nortest)</span>
<span id="cb269-4"><a href="#cb269-4"></a></span>
<span id="cb269-5"><a href="#cb269-5"></a><span class="co"># Importation du fichier csv dans un DataFrame</span></span>
<span id="cb269-6"><a href="#cb269-6"></a>dataMTL &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/univariee/DataSR2016.csv&quot;</span>)</span>
<span id="cb269-7"><a href="#cb269-7"></a><span class="co"># Tableau sommaire pour la variable PctFRev</span></span>
<span id="cb269-8"><a href="#cb269-8"></a><span class="kw">summary</span>(dataMTL<span class="op">$</span>PctFRev)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.846  11.242  15.471  16.822  20.229  68.927</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1"></a><span class="co"># PARAMÈTRES DE TENDANCE CENTRALE</span></span>
<span id="cb271-2"><a href="#cb271-2"></a><span class="kw">mean</span>(dataMTL<span class="op">$</span>PctFRev)   <span class="co"># Moyenne</span></span></code></pre></div>
<pre><code>## [1] 16.82247</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1"></a><span class="kw">median</span>(dataMTL<span class="op">$</span>PctFRev)   <span class="co"># Médiane</span></span></code></pre></div>
<pre><code>## [1] 15.471</code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1"></a><span class="co"># PARAMÈTRES DE POSITION</span></span>
<span id="cb275-2"><a href="#cb275-2"></a><span class="co"># Quartiles</span></span>
<span id="cb275-3"><a href="#cb275-3"></a><span class="kw">quantile</span>(dataMTL<span class="op">$</span>PctFRev)</span></code></pre></div>
<pre><code>##      0%     25%     50%     75%    100% 
##  1.8460 11.2420 15.4710 20.2285 68.9270</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1"></a><span class="co"># Quintiles</span></span>
<span id="cb277-2"><a href="#cb277-2"></a><span class="kw">quantile</span>(dataMTL<span class="op">$</span>PctFRev, <span class="dt">probs =</span> <span class="kw">seq</span>(.<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.2</span>))</span></code></pre></div>
<pre><code>##     0%    20%    40%    60%    80%   100% 
##  1.846 10.294 13.626 16.918 21.756 68.927</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1"></a><span class="co"># Déciles</span></span>
<span id="cb279-2"><a href="#cb279-2"></a><span class="kw">quantile</span>(dataMTL<span class="op">$</span>PctFRev, <span class="dt">probs =</span> <span class="kw">seq</span>(.<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.1</span>))</span></code></pre></div>
<pre><code>##     0%    10%    20%    30%    40%    50%    60%    70%    80%    90%   100% 
##  1.846  8.402 10.294 12.172 13.626 15.471 16.918 18.868 21.756 26.854 68.927</code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1"></a><span class="co"># Percentiles personnalisés avec apply</span></span>
<span id="cb281-2"><a href="#cb281-2"></a><span class="kw">quantile</span>(dataMTL<span class="op">$</span>PctFRev, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.01</span>,.<span class="dv">05</span>,<span class="fl">0.10</span>,.<span class="dv">25</span>,.<span class="dv">50</span>,.<span class="dv">75</span>,.<span class="dv">90</span>,.<span class="dv">95</span>,.<span class="dv">99</span>))</span></code></pre></div>
<pre><code>##      1%      5%     10%     25%     50%     75%     90%     95%     99% 
##  5.2290  7.1470  8.4020 11.2420 15.4710 20.2285 26.8540 31.7530 45.6010</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1"></a><span class="co"># PARAMÈTRES DE DISPERSION</span></span>
<span id="cb283-2"><a href="#cb283-2"></a><span class="kw">range</span>(dataMTL<span class="op">$</span>PctFRev)  <span class="co"># Min et Max</span></span></code></pre></div>
<pre><code>## [1]  1.846 68.927</code></pre>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1"></a><span class="co"># Étendue</span></span>
<span id="cb285-2"><a href="#cb285-2"></a><span class="kw">max</span>(dataMTL<span class="op">$</span>PctFRev)<span class="op">-</span><span class="kw">min</span>(dataMTL<span class="op">$</span>PctFRev)</span></code></pre></div>
<pre><code>## [1] 67.081</code></pre>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1"></a><span class="co"># Écart interquartile</span></span>
<span id="cb287-2"><a href="#cb287-2"></a><span class="kw">quantile</span>(dataMTL<span class="op">$</span>PctFRev)[<span class="dv">4</span>]<span class="op">-</span><span class="kw">quantile</span>(dataMTL<span class="op">$</span>PctFRev)[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>##    75% 
## 8.9865</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1"></a><span class="kw">var</span>(dataMTL<span class="op">$</span>PctFRev) <span class="co"># Variance</span></span></code></pre></div>
<pre><code>## [1] 66.62482</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1"></a><span class="kw">sd</span>(dataMTL<span class="op">$</span>PctFRev)  <span class="co"># Écart-type</span></span></code></pre></div>
<pre><code>## [1] 8.162403</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1"></a><span class="kw">sd</span>(dataMTL<span class="op">$</span>PctFRev) <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(dataMTL<span class="op">$</span>PctFRev) <span class="co"># CV</span></span></code></pre></div>
<pre><code>## [1] 0.4852083</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1"></a><span class="co"># PARAMÈTRES DE FORME</span></span>
<span id="cb295-2"><a href="#cb295-2"></a><span class="kw">Skew</span>(dataMTL<span class="op">$</span>PctFRev)    <span class="co"># Skewness</span></span></code></pre></div>
<pre><code>## [1] 1.67367</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1"></a><span class="kw">Kurt</span>(dataMTL<span class="op">$</span>PctFRev)    <span class="co"># Kurtosis</span></span></code></pre></div>
<pre><code>## [1] 4.858815</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1"></a><span class="co"># TESTS D&#39;HYPOTHÈSE SUR LA NORMALITÉ</span></span>
<span id="cb299-2"><a href="#cb299-2"></a><span class="co"># K-Smirnov</span></span>
<span id="cb299-3"><a href="#cb299-3"></a><span class="kw">ks.test</span>(dataMTL<span class="op">$</span>PctFRev, <span class="st">&quot;pnorm&quot;</span>, <span class="dt">mean=</span><span class="kw">mean</span>(dataMTL<span class="op">$</span>PctFRev), <span class="dt">sd=</span><span class="kw">sd</span>(dataMTL<span class="op">$</span>PctFRev))</span></code></pre></div>
<pre><code>## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  dataMTL$PctFRev
## D = 0.10487, p-value = 1.646e-09
## alternative hypothesis: two-sided</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1"></a><span class="kw">shapiro.test</span>(dataMTL<span class="op">$</span>PctFRev) </span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  dataMTL$PctFRev
## W = 0.88748, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1"></a><span class="kw">lillie.test</span>(dataMTL<span class="op">$</span>PctFRev) </span></code></pre></div>
<pre><code>## 
##  Lilliefors (Kolmogorov-Smirnov) normality test
## 
## data:  dataMTL$PctFRev
## D = 0.10487, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1"></a><span class="kw">ad.test</span>(dataMTL<span class="op">$</span>PctFRev) </span></code></pre></div>
<pre><code>## 
##  Anderson-Darling normality test
## 
## data:  dataMTL$PctFRev
## A = 21.072, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1"></a><span class="kw">JarqueBeraTest</span>(dataMTL<span class="op">$</span>PctFRev) </span></code></pre></div>
<pre><code>## 
##  Robust Jarque Bera Test
## 
## data:  dataMTL$PctFRev
## X-squared = 2173.1, df = 2, p-value &lt; 2.2e-16</code></pre>
<p>Pour construire un histogramme avec la courbe normale, consultez la section @ref(sect03213) ou la syntaxe ci-dessous.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1"></a>moyenne &lt;-<span class="st"> </span><span class="kw">mean</span>(dataMTL<span class="op">$</span>PctFRev)</span>
<span id="cb309-2"><a href="#cb309-2"></a>ecart_type &lt;-<span class="st"> </span><span class="kw">sd</span>(dataMTL<span class="op">$</span>PctFRev)</span>
<span id="cb309-3"><a href="#cb309-3"></a></span>
<span id="cb309-4"><a href="#cb309-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dataMTL) <span class="op">+</span></span>
<span id="cb309-5"><a href="#cb309-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> PctFRev, <span class="dt">y =</span> ..density..),</span>
<span id="cb309-6"><a href="#cb309-6"></a>                 <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>) <span class="op">+</span></span>
<span id="cb309-7"><a href="#cb309-7"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;personnes à faible revenu (%)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;densité&quot;</span>)<span class="op">+</span></span>
<span id="cb309-8"><a href="#cb309-8"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> moyenne, <span class="dt">sd =</span> ecart_type), </span>
<span id="cb309-9"><a href="#cb309-9"></a>                <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/GcourbeNormale-1.png" alt="Histogramme avec courbe normale" width="65%" />
<p class="caption">
(#fig:GcourbeNormale)Histogramme avec courbe normale
</p>
</div>
</div>
<div id="sect02562" class="section level4">
<h4><span class="header-section-number">2.5.6.2</span> Application à plusieurs variables</h4>
<p>Pour obtenir des sorties de statistiques descriptives pour plusieurs variables, nous vous conseillons :</p>
<ul>
<li>de créer un vecteur avec les noms des variables (<em>VarsSelect</em> dans la syntaxe ci-dessous);</li>
<li>d’utiliser ensuite les fonctions <code>sapply</code> et <code>apply.</code></li>
</ul>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1"></a><span class="co"># Noms des variables du DataFrame</span></span>
<span id="cb310-2"><a href="#cb310-2"></a><span class="kw">names</span>(dataMTL)</span></code></pre></div>
<pre><code>##  [1] &quot;CTNAME&quot;                &quot;PopTotal&quot;              &quot;HabKm2&quot;               
##  [4] &quot;PctFRev&quot;               &quot;TxChomage&quot;             &quot;PctImmigrant&quot;         
##  [7] &quot;PctImgRecent&quot;          &quot;PctMenage1pers&quot;        &quot;PctFamilleMono&quot;       
## [10] &quot;PctLangueMaternelleFR&quot; &quot;PctLangueMaternelleAN&quot; &quot;PctLangueMaternelleAU&quot;</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1"></a><span class="co"># Vecteur pour trois variables</span></span>
<span id="cb312-2"><a href="#cb312-2"></a>VarsSelect &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;HabKm2&quot;</span>, <span class="st">&quot;TxChomage&quot;</span>, <span class="st">&quot;PctFRev&quot;</span> )</span>
<span id="cb312-3"><a href="#cb312-3"></a></span>
<span id="cb312-4"><a href="#cb312-4"></a><span class="co"># Tableau sommaire pour les 3 variables</span></span>
<span id="cb312-5"><a href="#cb312-5"></a><span class="kw">summary</span>(dataMTL[VarsSelect])</span></code></pre></div>
<pre><code>##      HabKm2        TxChomage         PctFRev      
##  Min.   :   18   Min.   : 1.942   Min.   : 1.846  
##  1st Qu.: 1980   1st Qu.: 5.482   1st Qu.:11.242  
##  Median : 3773   Median : 7.130   Median :15.471  
##  Mean   : 5513   Mean   : 7.743   Mean   :16.822  
##  3rd Qu.: 7916   3rd Qu.: 9.391   3rd Qu.:20.229  
##  Max.   :50282   Max.   :26.882   Max.   :68.927</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1"></a><span class="co"># PARAMÈTRES DE TENDANCE CENTRALE</span></span>
<span id="cb314-2"><a href="#cb314-2"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], mean)   <span class="co"># Moyenne</span></span></code></pre></div>
<pre><code>##      HabKm2   TxChomage     PctFRev 
## 5512.830705    7.743329   16.822470</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], median) <span class="co"># Médiane</span></span></code></pre></div>
<pre><code>##    HabKm2 TxChomage   PctFRev 
##  3773.000     7.130    15.471</code></pre>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1"></a><span class="co"># PARAMÈTRES DE POSITION</span></span>
<span id="cb318-2"><a href="#cb318-2"></a><span class="co"># Quartiles</span></span>
<span id="cb318-3"><a href="#cb318-3"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], quantile)</span></code></pre></div>
<pre><code>##       HabKm2 TxChomage PctFRev
## 0%      18.0    1.9420  1.8460
## 25%   1980.5    5.4825 11.2420
## 50%   3773.0    7.1300 15.4710
## 75%   7915.5    9.3910 20.2285
## 100% 50282.0   26.8820 68.9270</code></pre>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1"></a><span class="co"># Quintiles</span></span>
<span id="cb320-2"><a href="#cb320-2"></a><span class="kw">apply</span>(dataMTL[VarsSelect], <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">quantile</span>(x, <span class="dt">probs =</span> <span class="kw">seq</span>(.<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.2</span>)))</span></code></pre></div>
<pre><code>##      HabKm2 TxChomage PctFRev
## 0%       18     1.942   1.846
## 20%    1525     5.116  10.294
## 40%    2953     6.422  13.626
## 60%    4971     7.973  16.918
## 80%    9509    10.000  21.756
## 100%  50282    26.882  68.927</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1"></a><span class="co"># Déciles</span></span>
<span id="cb322-2"><a href="#cb322-2"></a><span class="kw">apply</span>(dataMTL[VarsSelect], <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">quantile</span>(x, <span class="dt">probs =</span> <span class="kw">seq</span>(.<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.1</span>)))</span></code></pre></div>
<pre><code>##      HabKm2 TxChomage PctFRev
## 0%       18     1.942   1.846
## 10%     455     4.369   8.402
## 20%    1525     5.116  10.294
## 30%    2298     5.780  12.172
## 40%    2953     6.422  13.626
## 50%    3773     7.130  15.471
## 60%    4971     7.973  16.918
## 70%    6918     8.909  18.868
## 80%    9509    10.000  21.756
## 90%   13055    11.749  26.854
## 100%  50282    26.882  68.927</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1"></a><span class="co"># Percentiles personnalisés avec apply</span></span>
<span id="cb324-2"><a href="#cb324-2"></a><span class="kw">apply</span>(dataMTL[VarsSelect], <span class="dv">2</span>, </span>
<span id="cb324-3"><a href="#cb324-3"></a>      <span class="cf">function</span>(x) <span class="kw">quantile</span>(x, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.01</span>,.<span class="dv">05</span>,<span class="fl">0.10</span>,.<span class="dv">25</span>,.<span class="dv">50</span>,.<span class="dv">75</span>,.<span class="dv">90</span>,.<span class="dv">95</span>,.<span class="dv">99</span>)))</span></code></pre></div>
<pre><code>##      HabKm2 TxChomage PctFRev
## 1%     58.5    2.9665  5.2290
## 5%    178.0    3.8980  7.1470
## 10%   455.0    4.3690  8.4020
## 25%  1980.5    5.4825 11.2420
## 50%  3773.0    7.1300 15.4710
## 75%  7915.5    9.3910 20.2285
## 90% 13055.0   11.7490 26.8540
## 95% 15355.0   13.8400 31.7530
## 99% 18578.5   17.1920 45.6010</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1"></a><span class="co"># PARAMÈTRES DE DISPERSION</span></span>
<span id="cb326-2"><a href="#cb326-2"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], range)  <span class="co"># Min et Max</span></span></code></pre></div>
<pre><code>##      HabKm2 TxChomage PctFRev
## [1,]     18     1.942   1.846
## [2,]  50282    26.882  68.927</code></pre>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1"></a><span class="co"># Étendue</span></span>
<span id="cb328-2"><a href="#cb328-2"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], max) <span class="op">-</span><span class="st"> </span><span class="kw">sapply</span>(dataMTL[VarsSelect], min)</span></code></pre></div>
<pre><code>##    HabKm2 TxChomage   PctFRev 
## 50264.000    24.940    67.081</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1"></a><span class="co"># Écart interquartile</span></span>
<span id="cb330-2"><a href="#cb330-2"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], quantile)[<span class="dv">4</span>,] <span class="op">-</span><span class="st"> </span><span class="kw">sapply</span>(dataMTL[VarsSelect], quantile)[<span class="dv">2</span>,]</span></code></pre></div>
<pre><code>##    HabKm2 TxChomage   PctFRev 
## 5935.0000    3.9085    8.9865</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], var)    <span class="co"># Variance</span></span></code></pre></div>
<pre><code>##       HabKm2    TxChomage      PctFRev 
## 2.633462e+07 9.880932e+00 6.662482e+01</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], sd)     <span class="co"># Écart-type</span></span></code></pre></div>
<pre><code>##      HabKm2   TxChomage     PctFRev 
## 5131.726785    3.143395    8.162403</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1"></a><span class="co"># Coefficient de variation</span></span>
<span id="cb336-2"><a href="#cb336-2"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], sd) <span class="op">/</span><span class="st"> </span><span class="kw">sapply</span>(dataMTL[VarsSelect], mean)</span></code></pre></div>
<pre><code>##    HabKm2 TxChomage   PctFRev 
## 0.9308696 0.4059488 0.4852083</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1"></a><span class="co"># PARAMÈTRES DE FORME</span></span>
<span id="cb338-2"><a href="#cb338-2"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], Skew)    <span class="co"># Skewness</span></span></code></pre></div>
<pre><code>##    HabKm2 TxChomage   PctFRev 
##  1.967468  1.280216  1.673670</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], Kurt)    <span class="co"># Kurtosis</span></span></code></pre></div>
<pre><code>##    HabKm2 TxChomage   PctFRev 
##  8.546403  2.892443  4.858815</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1"></a><span class="co"># TESTS D&#39;HYPOTHÈSE POUR LA NORMALITÉ</span></span>
<span id="cb342-2"><a href="#cb342-2"></a><span class="co"># K-Smirnov</span></span>
<span id="cb342-3"><a href="#cb342-3"></a><span class="kw">apply</span>(dataMTL[VarsSelect], <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">ks.test</span>(x, <span class="st">&quot;pnorm&quot;</span>, <span class="dt">mean=</span><span class="kw">mean</span>(x), <span class="dt">sd=</span><span class="kw">sd</span>(x)))</span></code></pre></div>
<pre><code>## $HabKm2
## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  x
## D = 0.14899, p-value &lt; 2.2e-16
## alternative hypothesis: two-sided
## 
## 
## $TxChomage
## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  x
## D = 0.080183, p-value = 9.778e-06
## alternative hypothesis: two-sided
## 
## 
## $PctFRev
## 
##  One-sample Kolmogorov-Smirnov test
## 
## data:  x
## D = 0.10487, p-value = 1.646e-09
## alternative hypothesis: two-sided</code></pre>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], shapiro.test)       <span class="co"># Shapiro-Wilk</span></span></code></pre></div>
<pre><code>##           HabKm2                        TxChomage                    
## statistic 0.8385086                     0.9235146                    
## p.value   5.648795e-30                  1.451222e-21                 
## method    &quot;Shapiro-Wilk normality test&quot; &quot;Shapiro-Wilk normality test&quot;
## data.name &quot;X[[i]]&quot;                      &quot;X[[i]]&quot;                     
##           PctFRev                      
## statistic 0.8874803                    
## p.value   1.00278e-25                  
## method    &quot;Shapiro-Wilk normality test&quot;
## data.name &quot;X[[i]]&quot;</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], lillie.test)       <span class="co"># Lilliefors</span></span></code></pre></div>
<pre><code>##           HabKm2                                          
## statistic 0.148988                                        
## p.value   5.689619e-58                                    
## method    &quot;Lilliefors (Kolmogorov-Smirnov) normality test&quot;
## data.name &quot;X[[i]]&quot;                                        
##           TxChomage                                       
## statistic 0.0801829                                       
## p.value   7.758887e-16                                    
## method    &quot;Lilliefors (Kolmogorov-Smirnov) normality test&quot;
## data.name &quot;X[[i]]&quot;                                        
##           PctFRev                                         
## statistic 0.1048704                                       
## p.value   7.43257e-28                                     
## method    &quot;Lilliefors (Kolmogorov-Smirnov) normality test&quot;
## data.name &quot;X[[i]]&quot;</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], ad.test)           <span class="co"># Anderson-Darling</span></span></code></pre></div>
<pre><code>##           HabKm2                            TxChomage                        
## statistic 36.40276                          14.9237                          
## p.value   3.7e-24                           3.7e-24                          
## method    &quot;Anderson-Darling normality test&quot; &quot;Anderson-Darling normality test&quot;
## data.name &quot;X[[i]]&quot;                          &quot;X[[i]]&quot;                         
##           PctFRev                          
## statistic 21.07194                         
## p.value   3.7e-24                          
## method    &quot;Anderson-Darling normality test&quot;
## data.name &quot;X[[i]]&quot;</code></pre>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], JarqueBeraTest)    <span class="co"># Jarque-Bera</span></span></code></pre></div>
<pre><code>##           HabKm2                    TxChomage                
## statistic 4270.113                  639.2741                 
## parameter 2                         2                        
## p.value   0                         0                        
## method    &quot;Robust Jarque Bera Test&quot; &quot;Robust Jarque Bera Test&quot;
## data.name &quot;X[[i]]&quot;                  &quot;X[[i]]&quot;                 
##           PctFRev                  
## statistic 2173.082                 
## parameter 2                        
## p.value   0                        
## method    &quot;Robust Jarque Bera Test&quot;
## data.name &quot;X[[i]]&quot;</code></pre>
</div>
<div id="sect02563" class="section level4">
<h4><span class="header-section-number">2.5.6.3</span> Transformation d’une variable dans R</h4>
<p>La syntaxe ci-dessous illustre trois exemples de transformation (logarithme, racine carrée et inverse de la variable). Rappelez-vous qu’il faut comparer les valeurs de <em>skewness</em> et de <em>kurtosis</em> et des tests de Shapiro-Wilk avant et après les transformations pour identifier celle qui est la plus efficace.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb352-2"><a href="#cb352-2"></a></span>
<span id="cb352-3"><a href="#cb352-3"></a><span class="co"># Importation du fichier csv dans un DataFrame</span></span>
<span id="cb352-4"><a href="#cb352-4"></a>dataMTL &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/univariee/DataSR2016.csv&quot;</span>)</span>
<span id="cb352-5"><a href="#cb352-5"></a></span>
<span id="cb352-6"><a href="#cb352-6"></a><span class="co"># Noms des variables du DataFrame</span></span>
<span id="cb352-7"><a href="#cb352-7"></a><span class="kw">names</span>(dataMTL)</span></code></pre></div>
<pre><code>##  [1] &quot;CTNAME&quot;                &quot;PopTotal&quot;              &quot;HabKm2&quot;               
##  [4] &quot;PctFRev&quot;               &quot;TxChomage&quot;             &quot;PctImmigrant&quot;         
##  [7] &quot;PctImgRecent&quot;          &quot;PctMenage1pers&quot;        &quot;PctFamilleMono&quot;       
## [10] &quot;PctLangueMaternelleFR&quot; &quot;PctLangueMaternelleAN&quot; &quot;PctLangueMaternelleAU&quot;</code></pre>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1"></a><span class="co"># Transformations</span></span>
<span id="cb354-2"><a href="#cb354-2"></a>dataMTL<span class="op">$</span>HabKm2_log &lt;-<span class="st">  </span><span class="kw">log10</span>(dataMTL<span class="op">$</span>HabKm2)</span>
<span id="cb354-3"><a href="#cb354-3"></a>dataMTL<span class="op">$</span>HabKm2_sqrt &lt;-<span class="st">  </span><span class="kw">sqrt</span>(dataMTL<span class="op">$</span>HabKm2)</span>
<span id="cb354-4"><a href="#cb354-4"></a>dataMTL<span class="op">$</span>HabKm2_inv &lt;-<span class="st">  </span><span class="dv">1</span><span class="op">/</span>dataMTL<span class="op">$</span>HabKm2</span>
<span id="cb354-5"><a href="#cb354-5"></a></span>
<span id="cb354-6"><a href="#cb354-6"></a><span class="co"># Vecteur pour la variable et les trois transformations</span></span>
<span id="cb354-7"><a href="#cb354-7"></a>VarsSelect &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;HabKm2&quot;</span>, <span class="st">&quot;HabKm2_log&quot;</span>, <span class="st">&quot;HabKm2_sqrt&quot;</span>, <span class="st">&quot;HabKm2_inv&quot;</span>)</span>
<span id="cb354-8"><a href="#cb354-8"></a></span>
<span id="cb354-9"><a href="#cb354-9"></a><span class="co"># paramètres de forme</span></span>
<span id="cb354-10"><a href="#cb354-10"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], Skew)    <span class="co"># Skewness</span></span></code></pre></div>
<pre><code>##      HabKm2  HabKm2_log HabKm2_sqrt  HabKm2_inv 
##   1.9674683  -1.2071326   0.4179037   8.2536901</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], Kurt)    <span class="co"># Kurtosis</span></span></code></pre></div>
<pre><code>##      HabKm2  HabKm2_log HabKm2_sqrt  HabKm2_inv 
##  8.54640302  1.55670769  0.04563433 82.85604898</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1"></a><span class="co"># TESTS D&#39;HYPOTHÈSE SUR LA NORMALITÉ</span></span>
<span id="cb358-2"><a href="#cb358-2"></a><span class="kw">sapply</span>(dataMTL[VarsSelect], shapiro.test) </span></code></pre></div>
<pre><code>##           HabKm2                        HabKm2_log                   
## statistic 0.8385086                     0.9113234                    
## p.value   5.648795e-30                  4.11156e-23                  
## method    &quot;Shapiro-Wilk normality test&quot; &quot;Shapiro-Wilk normality test&quot;
## data.name &quot;X[[i]]&quot;                      &quot;X[[i]]&quot;                     
##           HabKm2_sqrt                   HabKm2_inv                   
## statistic 0.9771699                     0.2530266                    
## p.value   4.638049e-11                  8.324983e-52                 
## method    &quot;Shapiro-Wilk normality test&quot; &quot;Shapiro-Wilk normality test&quot;
## data.name &quot;X[[i]]&quot;                      &quot;X[[i]]&quot;</code></pre>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1"></a><span class="co"># Histogrammes avec courbe normale</span></span>
<span id="cb360-2"><a href="#cb360-2"></a>Graph1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dataMTL) <span class="op">+</span></span>
<span id="cb360-3"><a href="#cb360-3"></a><span class="st">          </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> HabKm2, <span class="dt">y =</span> ..density..),</span>
<span id="cb360-4"><a href="#cb360-4"></a>                 <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>) <span class="op">+</span></span>
<span id="cb360-5"><a href="#cb360-5"></a><span class="st">          </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="kw">expression</span>(<span class="st">&quot;Habitants au km&quot;</span><span class="op">^</span><span class="dv">2</span>), </span>
<span id="cb360-6"><a href="#cb360-6"></a>               <span class="dt">y =</span> <span class="st">&quot;densité&quot;</span>)<span class="op">+</span></span>
<span id="cb360-7"><a href="#cb360-7"></a><span class="st">          </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, </span>
<span id="cb360-8"><a href="#cb360-8"></a>                        <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dataMTL<span class="op">$</span>HabKm2), </span>
<span id="cb360-9"><a href="#cb360-9"></a>                                    <span class="dt">sd =</span> <span class="kw">sd</span>(dataMTL<span class="op">$</span>HabKm2)), </span>
<span id="cb360-10"><a href="#cb360-10"></a>                        <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>)</span>
<span id="cb360-11"><a href="#cb360-11"></a></span>
<span id="cb360-12"><a href="#cb360-12"></a>Graph2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dataMTL) <span class="op">+</span></span>
<span id="cb360-13"><a href="#cb360-13"></a><span class="st">          </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> HabKm2_log, <span class="dt">y =</span> ..density..),</span>
<span id="cb360-14"><a href="#cb360-14"></a>                         <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>) <span class="op">+</span></span>
<span id="cb360-15"><a href="#cb360-15"></a><span class="st">          </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="kw">expression</span>(<span class="st">&quot;Logarithme d&#39;habitants au km&quot;</span><span class="op">^</span><span class="dv">2</span>),</span>
<span id="cb360-16"><a href="#cb360-16"></a>               <span class="dt">y =</span> <span class="st">&quot;densité&quot;</span>)<span class="op">+</span></span>
<span id="cb360-17"><a href="#cb360-17"></a><span class="st">          </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, </span>
<span id="cb360-18"><a href="#cb360-18"></a>                        <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dataMTL<span class="op">$</span>HabKm2_log), </span>
<span id="cb360-19"><a href="#cb360-19"></a>                                    <span class="dt">sd =</span> <span class="kw">sd</span>(dataMTL<span class="op">$</span>HabKm2_log)), </span>
<span id="cb360-20"><a href="#cb360-20"></a>                        <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>)</span>
<span id="cb360-21"><a href="#cb360-21"></a></span>
<span id="cb360-22"><a href="#cb360-22"></a>Graph3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dataMTL) <span class="op">+</span></span>
<span id="cb360-23"><a href="#cb360-23"></a><span class="st">          </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> HabKm2_sqrt, <span class="dt">y =</span> ..density..),</span>
<span id="cb360-24"><a href="#cb360-24"></a>                         <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>) <span class="op">+</span></span>
<span id="cb360-25"><a href="#cb360-25"></a><span class="st">          </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="kw">expression</span>(<span class="st">&quot;Racine carrée d&#39;habitants au km&quot;</span><span class="op">^</span><span class="dv">2</span>),</span>
<span id="cb360-26"><a href="#cb360-26"></a>               <span class="dt">y =</span> <span class="st">&quot;densité&quot;</span>)<span class="op">+</span></span>
<span id="cb360-27"><a href="#cb360-27"></a><span class="st">          </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, </span>
<span id="cb360-28"><a href="#cb360-28"></a>                        <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dataMTL<span class="op">$</span>HabKm2_sqrt), </span>
<span id="cb360-29"><a href="#cb360-29"></a>                                    <span class="dt">sd =</span> <span class="kw">sd</span>(dataMTL<span class="op">$</span>HabKm2_sqrt)), </span>
<span id="cb360-30"><a href="#cb360-30"></a>                        <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>)</span>
<span id="cb360-31"><a href="#cb360-31"></a></span>
<span id="cb360-32"><a href="#cb360-32"></a>Graph4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dataMTL) <span class="op">+</span></span>
<span id="cb360-33"><a href="#cb360-33"></a><span class="st">          </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> HabKm2_inv, <span class="dt">y =</span> ..density..),</span>
<span id="cb360-34"><a href="#cb360-34"></a>                         <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>) <span class="op">+</span></span>
<span id="cb360-35"><a href="#cb360-35"></a><span class="st">          </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="kw">expression</span>(<span class="st">&quot;Inverse d&#39;habitants au km&quot;</span><span class="op">^</span><span class="dv">2</span>),</span>
<span id="cb360-36"><a href="#cb360-36"></a>               <span class="dt">y =</span> <span class="st">&quot;densité&quot;</span>)<span class="op">+</span></span>
<span id="cb360-37"><a href="#cb360-37"></a><span class="st">          </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, </span>
<span id="cb360-38"><a href="#cb360-38"></a>                        <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dataMTL<span class="op">$</span>HabKm2_inv), </span>
<span id="cb360-39"><a href="#cb360-39"></a>                                    <span class="dt">sd =</span> <span class="kw">sd</span>(dataMTL<span class="op">$</span>HabKm2_inv)), </span>
<span id="cb360-40"><a href="#cb360-40"></a>                        <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>)</span>
<span id="cb360-41"><a href="#cb360-41"></a></span>
<span id="cb360-42"><a href="#cb360-42"></a><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> <span class="kw">list</span>(Graph1, Graph2, Graph3, Graph4), <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/GTranf-1.png" alt="Histogramme des transformations" width="75%" />
<p class="caption">
(#fig:GTranf)Histogramme des transformations
</p>
</div>
<p>La variable <em>HabKm2</em> est asymétrique positive et leptokurtique. Les valeurs des statistiques de forme et du test de Shapiro-Wilk ainsi que les histogrammes semblent démontrer que la transformation la plus efficace est la racine carrée. Si la variable originale est asymétrique positive, sa transformation logarithme est par contre asymétrique négative. Cela démontre que la transformation logarithmique n’est pas toujours la panacée.</p>
</div>
</div>
</div>
<div id="sect026" class="section level2">
<h2><span class="header-section-number">2.6</span> Statistiques descriptives sur des variables qualitatives et semi-qualitatives</h2>
<div id="sect0261" class="section level3">
<h3><span class="header-section-number">2.6.1</span> Fréquences</h3>
<p>En guise de rappel, les variables nominales, ordinales et semi-quantitatives comprennent plusieurs modalités pour lesquelles plusieurs types de fréquences sont généralement calculées. Pour illustrer le tout, nous avons extrait du recensement de 2016 de Statistique Canada les effectifs des modalités de la variable sur le principal mode de transport utilisé pour les déplacements domicile-travail, et ce, pour la subdivision de recensement (MRC) de l’île de Montréal (tableau @ref(tab:Frequences)). Les différents types de fréquences sont les suivantes :</p>
<ul>
<li><p>Les fréquences absolues simples (<strong>FAS</strong>) ou fréquences observées représentent le nombre d’observations pour chacune des modalités. Par exemple, sur 857 540 personnes réalisant des trajets domicile-travail (ligne totale), seulement 30 645 optent pour le vélo, alors que 427 530 conduisent un véhicule motorisé (automobile, camion ou fourgonnette) comme principal mode de transport.</p></li>
<li><p>Les fréquences relatives simples (<strong>FRS</strong>) sont les proportions de chaque modalité sur le total (<span class="math inline">\(\mbox{30 645}/\mbox{857 540}=\mbox{0,036}\)</span>); leur somme est égale à 1. Elles peuvent bien entendu être exprimées en pourcentage (<span class="math inline">\(\mbox{30 645}/\mbox{857 540} \times \mbox{100}=\mbox{3,57}\)</span>); leur somme est alors égale à 100 %. Par exemple, 3,7 % de ces personnes utilisent le vélo comme mode de transport principal.</p></li>
<li><p>Les fréquences absolues cumulées (<strong>FAC</strong>) représentent la fréquence observée (FAS) de la modalité à laquelle sont additionnées celles qui la précèdent. La valeur de la FAC pour la dernière est donc égale au total.</p></li>
<li><p>À partir des fréquences absolues cumulées (FAC), il est alors possible de calculer les fréquences relatives cumulées (<strong>FRC</strong>) en proportion (<span class="math inline">\(\mbox{453 930}/\mbox{857 540} = \mbox{0,529}\)</span>) et en pourcentage (<span class="math inline">\(\mbox{453 930} / \mbox{857 540} \times \mbox{100}= \mbox{52,93}\)</span>). Par exemple, plus de la moitié des personnes utilisent l’automobile comme mode de transport principal (passagerère ou conductrice).</p></li>
</ul>
<table>
<caption>
(#tab:Frequences)Différents types de fréquences sur une variable qualitative ou semi-qualitative
</caption>
<thead>
<tr>
<th style="text-align:left;">
Mode de transport
</th>
<th style="text-align:right;">
FAS
</th>
<th style="text-align:right;">
FRS
</th>
<th style="text-align:right;">
FRS (%)
</th>
<th style="text-align:right;">
FAC
</th>
<th style="text-align:right;">
FRC
</th>
<th style="text-align:right;">
FRC (%)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Véhicule motorisé (conducteur(trice))
</td>
<td style="text-align:right;">
427 530
</td>
<td style="text-align:right;">
0,499
</td>
<td style="text-align:right;">
49,86
</td>
<td style="text-align:right;">
427 530
</td>
<td style="text-align:right;">
0,499
</td>
<td style="text-align:right;">
49,86
</td>
</tr>
<tr>
<td style="text-align:left;">
Véhicule motorisé (passager(ère))
</td>
<td style="text-align:right;">
26 400
</td>
<td style="text-align:right;">
0,031
</td>
<td style="text-align:right;">
3,08
</td>
<td style="text-align:right;">
453 930
</td>
<td style="text-align:right;">
0,529
</td>
<td style="text-align:right;">
52,93
</td>
</tr>
<tr>
<td style="text-align:left;">
Transport en commun
</td>
<td style="text-align:right;">
295 860
</td>
<td style="text-align:right;">
0,345
</td>
<td style="text-align:right;">
34,50
</td>
<td style="text-align:right;">
749 790
</td>
<td style="text-align:right;">
0,874
</td>
<td style="text-align:right;">
87,43
</td>
</tr>
<tr>
<td style="text-align:left;">
À pied
</td>
<td style="text-align:right;">
69 410
</td>
<td style="text-align:right;">
0,081
</td>
<td style="text-align:right;">
8,09
</td>
<td style="text-align:right;">
819 200
</td>
<td style="text-align:right;">
0,955
</td>
<td style="text-align:right;">
95,53
</td>
</tr>
<tr>
<td style="text-align:left;">
Bicyclette
</td>
<td style="text-align:right;">
30 645
</td>
<td style="text-align:right;">
0,036
</td>
<td style="text-align:right;">
3,57
</td>
<td style="text-align:right;">
849 845
</td>
<td style="text-align:right;">
0,991
</td>
<td style="text-align:right;">
99,10
</td>
</tr>
<tr>
<td style="text-align:left;">
Autre moyen
</td>
<td style="text-align:right;">
7 695
</td>
<td style="text-align:right;">
0,009
</td>
<td style="text-align:right;">
0,90
</td>
<td style="text-align:right;">
857 540
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
100,00
</td>
</tr>
<tr>
<td style="text-align:left;">
Total
</td>
<td style="text-align:right;">
857 540
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
100,00
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
<div class="bloc_attention">
<p><strong>Les fréquences cumulées : peu pertinentes pour les variables nominales</strong></p>
<p>Le calcul et l’analyse des fréquences cumulées (absolues et relatives) sont très souvent inutiles pour les variables nominales.</p>
<p>Par exemple, au tableau @ref(tab:Frequences), la fréquence cumulée relative (en %) est de 87,43 % pour la troisième ligne. Cela signifie que 87,43 % des navetteur(ve)s se déplacent en véhicule motorisé (conducteur(trice) ou passager(ère)) ou en transport en commun. Par contre, si la troisième modalité avait été <em>à pied</em>, le pourcentage aurait été de 61,02 (<span class="math inline">\(\mbox{52,93}+\mbox{8,09}\)</span>). Si vous souhaitez calculer les fréquences cumulées sur une variable nominale, assurez-vous que l’ordre des modalités vous convient et de le modifier au besoin. Sinon, abstenez-vous de les calculer!</p>
<p><strong>Les fréquences cumulées : très utiles pour l’analyse des variables ordinales ou semi-quantitatives</strong></p>
<p>Pour des modalités hiérarchisées (variable ordinale ou semi-quantitative), l’analyse des fréquences cumulées (absolues et relatives) est par contre très intéressante. Par exemple, au tableau @ref(tab:Frequences2), elle permet de constater rapidement que sur l’île de Montréal, plus du quart de la population à moins de 25 ans (27,91 %) et 83,33 %, moins de 65 ans.</p>
</div>
<table>
<caption>
(#tab:Frequences2)Différents types de fréquences sur une variable semi-qualitative
</caption>
<thead>
<tr>
<th style="text-align:left;">
Groupes d’âge
</th>
<th style="text-align:right;">
FAS
</th>
<th style="text-align:right;">
FRS
</th>
<th style="text-align:right;">
FRS (%)
</th>
<th style="text-align:right;">
FAC
</th>
<th style="text-align:right;">
FRC
</th>
<th style="text-align:right;">
FRC (%)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0 à 14 ans
</td>
<td style="text-align:right;">
304 470
</td>
<td style="text-align:right;">
0,157
</td>
<td style="text-align:right;">
15,68
</td>
<td style="text-align:right;">
304 470
</td>
<td style="text-align:right;">
0,157
</td>
<td style="text-align:right;">
15,68
</td>
</tr>
<tr>
<td style="text-align:left;">
15 à 24 ans
</td>
<td style="text-align:right;">
237 555
</td>
<td style="text-align:right;">
0,122
</td>
<td style="text-align:right;">
12,23
</td>
<td style="text-align:right;">
542 025
</td>
<td style="text-align:right;">
0,279
</td>
<td style="text-align:right;">
27,91
</td>
</tr>
<tr>
<td style="text-align:left;">
25 à 44 ans
</td>
<td style="text-align:right;">
582 150
</td>
<td style="text-align:right;">
0,300
</td>
<td style="text-align:right;">
29,98
</td>
<td style="text-align:right;">
1 124 175
</td>
<td style="text-align:right;">
0,579
</td>
<td style="text-align:right;">
57,89
</td>
</tr>
<tr>
<td style="text-align:left;">
45 à 64 ans
</td>
<td style="text-align:right;">
494 205
</td>
<td style="text-align:right;">
0,254
</td>
<td style="text-align:right;">
25,45
</td>
<td style="text-align:right;">
1 618 380
</td>
<td style="text-align:right;">
0,833
</td>
<td style="text-align:right;">
83,33
</td>
</tr>
<tr>
<td style="text-align:left;">
65 à 84 ans
</td>
<td style="text-align:right;">
271 560
</td>
<td style="text-align:right;">
0,140
</td>
<td style="text-align:right;">
13,98
</td>
<td style="text-align:right;">
1 889 940
</td>
<td style="text-align:right;">
0,973
</td>
<td style="text-align:right;">
97,32
</td>
</tr>
<tr>
<td style="text-align:left;">
85 ans et plus
</td>
<td style="text-align:right;">
52 100
</td>
<td style="text-align:right;">
0,027
</td>
<td style="text-align:right;">
2,68
</td>
<td style="text-align:right;">
1 942 040
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
100,00
</td>
</tr>
<tr>
<td style="text-align:left;">
Total
</td>
<td style="text-align:right;">
1 942 040
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
100,00
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
<p>Différents graphiques peuvent être construits pour illustrer la répartition des observations : les graphiques en barre (verticale et horizontale) avec les fréquences absolues et les diagrammes circulaires ou en anneau pour les fréquences relatives (figure @ref(fig:GraphiquesFreq1)). Ces graphiques seront présentés plus en détail dans le chapitre suivant.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/GraphiquesFreq1-1.png" alt="Différents graphiques pour représenter les fréquences absolues et relatives" width="75%" />
<p class="caption">
(#fig:GraphiquesFreq1)Différents graphiques pour représenter les fréquences absolues et relatives
</p>
</div>
</div>
<div id="sect0262" class="section level3">
<h3><span class="header-section-number">2.6.2</span> Mise en œuvre dans R</h3>
<p>La syntaxe ci-dessous permet de calculer les différentes fréquences présentées au tableau @ref(tab:Frequences2). Notez que pour les fréquences cumulées, nous utilisons la fonction <code>cumsum</code>.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1"></a><span class="co"># Vecteur pour les noms des modalités</span></span>
<span id="cb361-2"><a href="#cb361-2"></a>Modalite &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;0 à 14 ans&quot;</span>,</span>
<span id="cb361-3"><a href="#cb361-3"></a>             <span class="st">&quot;15 à 24 ans&quot;</span>,</span>
<span id="cb361-4"><a href="#cb361-4"></a>             <span class="st">&quot;25 à 44 ans&quot;</span>,</span>
<span id="cb361-5"><a href="#cb361-5"></a>             <span class="st">&quot;45 à 64 ans&quot;</span>,</span>
<span id="cb361-6"><a href="#cb361-6"></a>             <span class="st">&quot;65 à 84 ans&quot;</span>,</span>
<span id="cb361-7"><a href="#cb361-7"></a>             <span class="st">&quot;85 ans et plus&quot;</span>)</span>
<span id="cb361-8"><a href="#cb361-8"></a><span class="co"># Vecteur pour les fréquences absolues simples (FAS)</span></span>
<span id="cb361-9"><a href="#cb361-9"></a>Navetteurs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">304470</span>,<span class="dv">237555</span>,<span class="dv">582150</span>,<span class="dv">494205</span>,<span class="dv">271560</span>,<span class="dv">52100</span>)</span>
<span id="cb361-10"><a href="#cb361-10"></a><span class="co"># Somme des FAS</span></span>
<span id="cb361-11"><a href="#cb361-11"></a>sumFAS &lt;-<span class="st">  </span><span class="kw">sum</span>(Navetteurs)</span>
<span id="cb361-12"><a href="#cb361-12"></a><span class="co"># Construction du DataFrame avec les deux vecteurs</span></span>
<span id="cb361-13"><a href="#cb361-13"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb361-14"><a href="#cb361-14"></a>  <span class="dt">GroupeAge =</span> Modalite, </span>
<span id="cb361-15"><a href="#cb361-15"></a>  <span class="dt">FAS =</span> Navetteurs,</span>
<span id="cb361-16"><a href="#cb361-16"></a>  <span class="dt">FRS =</span> Navetteurs <span class="op">/</span><span class="st"> </span>sumFAS, </span>
<span id="cb361-17"><a href="#cb361-17"></a>  <span class="dt">FRSpct =</span> Navetteurs <span class="op">/</span><span class="st"> </span>sumFAS <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb361-18"><a href="#cb361-18"></a>  <span class="dt">FAC =</span> <span class="kw">cumsum</span>(Navetteurs),</span>
<span id="cb361-19"><a href="#cb361-19"></a>  <span class="dt">FRC =</span> <span class="kw">cumsum</span>(Navetteurs) <span class="op">/</span><span class="st"> </span>sumFAS,</span>
<span id="cb361-20"><a href="#cb361-20"></a>  <span class="dt">FRCpct =</span> <span class="kw">cumsum</span>(Navetteurs) <span class="op">/</span><span class="st"> </span>sumFAS <span class="op">*</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb361-21"><a href="#cb361-21"></a>  )</span>
<span id="cb361-22"><a href="#cb361-22"></a>df</span></code></pre></div>
<pre><code>##        GroupeAge    FAS        FRS    FRSpct     FAC       FRC    FRCpct
## 1     0 à 14 ans 304470 0.15677844 15.677844  304470 0.1567784  15.67784
## 2    15 à 24 ans 237555 0.12232240 12.232240  542025 0.2791008  27.91008
## 3    25 à 44 ans 582150 0.29976211 29.976211 1124175 0.5788629  57.88629
## 4    45 à 64 ans 494205 0.25447725 25.447725 1618380 0.8333402  83.33402
## 5    65 à 84 ans 271560 0.13983234 13.983234 1889940 0.9731725  97.31725
## 6 85 ans et plus  52100 0.02682746  2.682746 1942040 1.0000000 100.00000</code></pre>
</div>
</div>
<div id="sect027" class="section level2">
<h2><span class="header-section-number">2.7</span> Statistiques descriptives pondérées : pour aller plus loin</h2>
<p>Dans la section @ref(sect025), les différentes statistiques descriptives sur des variables quantitatives – paramètres de tendance centrale, de position, de dispersion et de forme – ont été largement abordées. Il est possible de calculer ces différentes statistiques en tenant compte d’une pondération. La statistique descriptive pondérée la plus connue est certainement la moyenne arithmétique pondérée. Son calcul est très simple. Pour chaque observation, deux valeurs sont disponibles :</p>
<ul>
<li><span class="math inline">\(x_i\)</span>, soit la valeur de la variable <span class="math inline">\(X\)</span> pour l’observation <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(w_i\)</span>, soit la valeur de la pondération pour <span class="math inline">\(i\)</span>.</li>
</ul>
<p>Prenez soin de comparer les deux équations ci-dessous (à gauche, la moyenne arithmétique; à droite, la moyenne arithmétique pondérée). Vous constaterez rapidement qu’il suffit simplement de multiplier chaque observation par sa pondération (numérateur) et de diviser ce produit par la somme des pondérations (dénominateur; et non par <span class="math inline">\(n\)</span>, soit le nombre d’observations comme pour la moyenne arithmétique non pondérée).</p>

<p><span class="math display">\[\begin{equation}  
\bar{x}=\frac{\sum_{i=1}^n x_i}{n} \text { versus } \bar{m}=\frac{\sum_{i=1}^n  w_ix_i}{\sum_{i=1}^nw_i}
(\#eq:moypond)
\end{equation}\]</span>
</p>
<table>
<caption>
(#tab:MoyPondCalcul)Calcul de la moyenne pondérée
</caption>
<thead>
<tr>
<th style="text-align:left;">
Observation
</th>
<th style="text-align:right;">
<span class="math inline">\(x_i\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(w_i\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(x_i \times w_i\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
4 000
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
225
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
18 000
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
275
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
13 750
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
60 000
</td>
</tr>
<tr>
<td style="text-align:left;">
Somme
</td>
<td style="text-align:right;">
1 000
</td>
<td style="text-align:right;">
350
</td>
<td style="text-align:right;">
95 750
</td>
</tr>
<tr>
<td style="text-align:left;">
Moyenne
</td>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Moyenne pondérée
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
274
</td>
</tr>
</tbody>
</table>
<div class="bloc_notes">
<p><strong>Calcul d’autres statistiques descriptives pondérées</strong></p>
<p>Nous ne reportons pas ici les formules des versions pondérées de toutes les statistiques descriptives. Retenez toutefois le principe suivant permettant de les calculer à partir de l’exemple du tableau @ref(tab:MoyPondCalcul). Pour la variable <em>X</em>, dupliquons respectivement 20, 80, 50, 200 fois les observations 1 à 4. Si nous calculons la moyenne arithmétique sur ces valeurs dupliquées, alors cette valeur est identique à celle de la moyenne arithmétique pondérée. Le même principe reposant sur la duplication des valeurs s’applique à l’ensemble des statistiques descriptives.</p>
</div>
<p>Dans un article récent, Alvarenga et al. <span class="citation">(<a href="#ref-de2018accessibilite" role="doc-biblioref">2018</a>)</span> évaluent l’accessibilité aux aires de jeux dans les parcs de la Communauté métropolitaine de Montréal (CMM). Pour les 881 secteurs de recensement de la CMM, ils ont calculé la distance à pied à l’aire de jeux la plus proche à travers le réseau de rues. Ce résultat, cartographié à la figure @ref(fig:FigParcCMM), permet d’avancer le constat suivant : « la quasi-totalité des secteurs de recensement de l’agglomération de Montréal présente des distances de l’aire de jeux la plus proche inférieures à 500 m, alors que les secteurs situés à plus d’un kilomètre d’une aire de jeux sont très majoritairement localisés dans les couronnes
nord et sud de la CMM » <span class="citation">(De Alvarenga, Apparicio et Séguin <a href="#ref-de2018accessibilite" role="doc-biblioref">2018</a>, 238)</span>.</p>
<p>Pour chaque secteur de recensement, Alvarenga et al. <span class="citation">(<a href="#ref-de2018accessibilite" role="doc-biblioref">2018</a>)</span> disposent des données suivantes :</p>
<ul>
<li><span class="math inline">\(x_i\)</span>, soit la distance à l’aire de jeux la plus proche pour le secteur de recensement <em>i</em>;</li>
<li><span class="math inline">\(w_i\)</span>, la pondération, soit le nombre d’enfants de moins de dix ans.</li>
</ul>
<p>Il est alors possible de calculer les statistiques descriptives de la proximité à l’aire de jeux la plus proche en tenant compte du nombre d’enfants résidant dans chaque secteur de recensement (tableau @ref(tab:MoyPondParc)). Cet exercice permet de conclure que : « […] globalement, les enfants ont une bonne accessibilité aux aires de jeux sur le territoire de la CMM. […] Les enfants sont en moyenne à un peu plus de 500 m de l’aire de jeux la plus proche (moyenne = 559; médiane = 512). Toutefois, les valeurs percentiles extrêmes signalent que respectivement 10 % et 5 % des enfants résident à près de 800 m et à plus de 1000 m de l’aire de jeux la plus proche » <span class="citation">(<a href="#ref-de2018accessibilite" role="doc-biblioref">2018</a>, 236)</span>.</p>
<div class="figure" style="text-align: center">
<img src="images/bivariee/BivarieeFigureParc.jpg" alt="Accessibilité aux aires de jeux par secteur de recensement, Communauté métropolitaine de Montréal, 2016" width="85%" />
<p class="caption">
(#fig:FigParcCMM)Accessibilité aux aires de jeux par secteur de recensement, Communauté métropolitaine de Montréal, 2016
</p>
</div>
<table>
<caption>
(#tab:MoyPondParc)Statistiques de l’aire de jeux la plus proche, par secteur de recensement, pondérées par la population de moins de 10 ans
</caption>
<thead>
<tr>
<th style="text-align:center;">
N
</th>
<th style="text-align:center;">
Moyenne
</th>
<th style="text-align:center;">
P5
</th>
<th style="text-align:center;">
P10
</th>
<th style="text-align:center;">
Q1
</th>
<th style="text-align:center;">
Médiane
</th>
<th style="text-align:center;">
Q3
</th>
<th style="text-align:center;">
P90
</th>
<th style="text-align:center;">
P95
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
881
</td>
<td style="text-align:center;">
559
</td>
<td style="text-align:center;">
282
</td>
<td style="text-align:center;">
327
</td>
<td style="text-align:center;">
408
</td>
<td style="text-align:center;">
512
</td>
<td style="text-align:center;">
640
</td>
<td style="text-align:center;">
799
</td>
<td style="text-align:center;">
1 006
</td>
</tr>
</tbody>
</table>
<p>De nombreux <em>packages</em> sont disponibles pour calculer des statistiques pondérées, dont notamment <code>Weighted.Desc.Stat</code> et <code>Hmisc</code> utilisés dans la syntaxe ci-dessous.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1"></a><span class="kw">library</span>(foreign)</span>
<span id="cb363-2"><a href="#cb363-2"></a><span class="kw">library</span>(Hmisc)</span>
<span id="cb363-3"><a href="#cb363-3"></a><span class="kw">library</span>(Weighted.Desc.Stat)</span>
<span id="cb363-4"><a href="#cb363-4"></a></span>
<span id="cb363-5"><a href="#cb363-5"></a>df &lt;-<span class="st"> </span><span class="kw">read.dbf</span>(<span class="st">&quot;data/bivariee/SR_AireJeux_PopMoins10.dbf&quot;</span>)</span>
<span id="cb363-6"><a href="#cb363-6"></a></span>
<span id="cb363-7"><a href="#cb363-7"></a><span class="kw">head</span>(df, <span class="dt">n =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##     SRNOM PopMoins10 AireJeux
## 1 0659.06        380 600.1921
## 2 0410.02        390 324.4396
## 3 0863.01        325 524.3323
## 4 0734.05        875 574.6682
## 5 0073.00        100 352.9505</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1"></a><span class="co"># xi (variable) et wi (pondération)</span></span>
<span id="cb365-2"><a href="#cb365-2"></a>x &lt;-<span class="st"> </span>df<span class="op">$</span>AireJeux</span>
<span id="cb365-3"><a href="#cb365-3"></a>w &lt;-<span class="st"> </span>df<span class="op">$</span>PopMoins10</span>
<span id="cb365-4"><a href="#cb365-4"></a></span>
<span id="cb365-5"><a href="#cb365-5"></a><span class="co"># Calcul des paramètres de position</span></span>
<span id="cb365-6"><a href="#cb365-6"></a><span class="co"># Moyenne</span></span>
<span id="cb365-7"><a href="#cb365-7"></a>Hmisc<span class="op">::</span><span class="kw">wtd.mean</span>(x, w)</span></code></pre></div>
<pre><code>## [1] 559.8026</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1"></a>Weighted.Desc.Stat<span class="op">::</span><span class="kw">w.mean</span>(x, w)</span></code></pre></div>
<pre><code>## [1] 559.8026</code></pre>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1"></a><span class="co"># Quartiles et percentile</span></span>
<span id="cb369-2"><a href="#cb369-2"></a>Hmisc<span class="op">::</span><span class="kw">wtd.quantile</span>(x, <span class="dt">weights=</span>w, <span class="dt">probs=</span><span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.10</span>, <span class="fl">.25</span>, <span class="fl">.50</span>, <span class="fl">.75</span>, <span class="fl">.90</span>, <span class="fl">.95</span>))</span></code></pre></div>
<pre><code>##        5%       10%       25%       50%       75%       90%       95% 
##  281.3623  327.3056  406.0759  511.5880  639.4813  798.6559 1011.5493</code></pre>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1"></a><span class="co"># Paramètres de dispersion avec le package Weighted.Desc.Stat</span></span>
<span id="cb371-2"><a href="#cb371-2"></a><span class="co"># Variance, écart-type et coefficient de variation</span></span>
<span id="cb371-3"><a href="#cb371-3"></a><span class="kw">w.var</span>(x,w)</span></code></pre></div>
<pre><code>## [1] 82818.18</code></pre>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1"></a><span class="kw">w.sd</span>(x,w)</span></code></pre></div>
<pre><code>## [1] 287.7815</code></pre>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1"></a><span class="kw">w.cv</span>(x,w)</span></code></pre></div>
<pre><code>## [1] 0.5140767</code></pre>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1"></a><span class="co"># Paramètres de forme avec le package Weighted.Desc.Stat</span></span>
<span id="cb377-2"><a href="#cb377-2"></a><span class="co"># Skewness et kurtosis </span></span>
<span id="cb377-3"><a href="#cb377-3"></a><span class="kw">w.skewness</span>(x, w)</span></code></pre></div>
<pre><code>## [1] 4.735351</code></pre>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1"></a><span class="kw">w.kurtosis</span>(x, w)</span></code></pre></div>
<pre><code>## [1] 41.17146</code></pre>
<div style="page-break-after: always;"></div>
</div>
<div id="sect028" class="section level2">
<h2><span class="header-section-number">2.8</span> Quiz de révision du chapitre</h2>
<div id="Chapitre2_univariees" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_Chapitre2_univariees;
  window.onload = function() {
    quizz_Chapitre2_univariees = new Quiz('Chapitre2_univariees', ['4','1','1','2','1',['1', '2', '5'],['1', '2', '4'],['1', '2', '3', '4'],['1', '2', '3'],'1']);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le mode de transport (auto, vélo, marche, transport en commun) est :
</div>
<div>
Relisez au besoin la section @ref(sect0212).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>une variable ordinale</label>
</td>
<td>
<input type="radio" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>une variable continue</label>
</td>
<td>
<input type="radio" name="q1" value="2"/>
</td>
</tr>
<tr>
<td>
<label>une variable discrète</label>
</td>
<td>
<input type="radio" name="q1" value="3"/>
</td>
</tr>
<tr>
<td>
<label>une variable nominale</label>
</td>
<td>
<input type="radio" name="q1" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Laquelle de ces deux options est la bonne?
</div>
<div>
Relisez au besoin le début de la section @ref(sect012).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Variables qualitatives (nominales ou ordinales); variables quantitatives (continues et discrètes)</label>
</td>
<td>
<input type="radio" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Variables qualitatives (nominales ou discrètes); variables quantitatives (ordinales et discrètes)</label>
</td>
<td>
<input type="radio" name="q2" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Des données collectées sur le terrain avec un GPS sont des données primaires spatiales.
</div>
<div>
Relisez au besoin la section @ref(sect022).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q3" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
L’erreur écologique consiste à :
</div>
<div>
Relisez au besoin la section @ref(sect0224).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>attribuer des résultats à partir de données individuelles à des territoires</label>
</td>
<td>
<input type="radio" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>attribuer des constats obtenus à partir de données agrégées pour un territoire aux individus</label>
</td>
<td>
<input type="radio" name="q4" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Laquelle de ces deux options est la bonne?
</div>
<div>
Relisez au besoin la section @ref(sect024).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Fonctions de masse pour les distributions discrètes, fonctions de densité pour les distributions continues</label>
</td>
<td>
<input type="radio" name="q5" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Fonctions de masse pour les distributions continues, fonctions de densité pour les distributions discrètes</label>
</td>
<td>
<input type="radio" name="q5" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels sont les trois paramètres de tendance centrale?
</div>
<div>
Relisez au besoin la section @ref(sect0251).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Moyenne</label>
</td>
<td>
<input type="checkbox" name="q6" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Médiane</label>
</td>
<td>
<input type="checkbox" name="q6" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Variance</label>
</td>
<td>
<input type="checkbox" name="q6" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Intervalle interquartile</label>
</td>
<td>
<input type="checkbox" name="q6" value="4"/>
</td>
</tr>
<tr>
<td>
<label>Mode</label>
</td>
<td>
<input type="checkbox" name="q6" value="5"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels sont les paramètres position?
</div>
<div>
Relisez au besoin la section @ref(sect0252).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Quartiles</label>
</td>
<td>
<input type="checkbox" name="q7" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Déciles</label>
</td>
<td>
<input type="checkbox" name="q7" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Variance</label>
</td>
<td>
<input type="checkbox" name="q7" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Centiles</label>
</td>
<td>
<input type="checkbox" name="q7" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels sont les paramètres de dispersion?
</div>
<div>
Relisez au besoin la section @ref(sect0253).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Étendue</label>
</td>
<td>
<input type="checkbox" name="q8" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Intervalle interquartile</label>
</td>
<td>
<input type="checkbox" name="q8" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Variance</label>
</td>
<td>
<input type="checkbox" name="q8" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Écart-type</label>
</td>
<td>
<input type="checkbox" name="q8" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Comment vérifie-t-on qu’une variable est normalement distribuée?
</div>
<div>
Relisez au besoin la section @ref(sect0254).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Coefficients d’asymétrie et d’aplatissement (skewness et kurtosis)</label>
</td>
<td>
<input type="checkbox" name="q9" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Graphiques : histogramme avec courbe normale et diagramme quantile-quantile</label>
</td>
<td>
<input type="checkbox" name="q9" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Tests de normalité (comme celui de Shapiro-Wilk)</label>
</td>
<td>
<input type="checkbox" name="q9" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Examen des valeurs minimale et maximale</label>
</td>
<td>
<input type="checkbox" name="q9" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le centrage et la réduction d’une variable consistent à :
</div>
<div>
Relisez au besoin la section @ref(sect02552).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>soustraire à chaque valeur sa moyenne (soit un centrage), puis à la diviser par son écart-type.</label>
</td>
<td>
<input type="radio" name="q10" value="1"/>
</td>
</tr>
<tr>
<td>
<label>simplement à trier une variable en ordre croissant, puis à affecter le rang de chaque observation de 1 à n</label>
</td>
<td>
<input type="radio" name="q10" value="2"/>
</td>
</tr>
<tr>
<td>
<label>soustraite à chaque observation la valeur minimale et à diviser le tout par l’étendue.</label>
</td>
<td>
<input type="radio" name="q10" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<button type="button" onclick="showResults(quizz_Chapitre2_univariees);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:02-univarie.Rmd-->
</div>
</div>
<div id="chap03" class="section level1">
<h1><span class="header-section-number">3</span> La magie des graphiques</h1>
<div class="bloc_attention">
<p>Ce chapitre n’a pas encore fait l’objet d’une révision linguistique. Il comprend certainement plusieurs coquilles… Une version révisée sera mise à jour prochainement.</p>
</div>
<p>Dans ce chapitre, nous allons découvrir les incroyables capacités graphiques de R. Pour ce faire, nous couvrirons en profondeur les fonctionnalités du <em>package</em> <code>ggplot2</code> du <code>tidyverse</code>. Selon nous, il s’agit de loin du meilleur <em>package</em> pour réaliser des graphiques.</p>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons les <em>packages</em> suivants :</p>
<ul>
<li>Pour créer des graphiques :
<ul>
<li><code>ggplot2</code>, le seul, l’unique!</li>
<li><code>ggpubr</code> pour combiner des graphiques.</li>
<li><code>ggthemes</code> pour utiliser des thèmes complémentaires pour les graphiques.</li>
</ul></li>
<li>Pour les couleurs :
<ul>
<li><code>RColorBrewer</code> pour accéder à des palettes de couleurs.</li>
</ul></li>
<li>Pour les graphiques spéciaux :
<ul>
<li><code>chorddiag</code> pour construire des graphiques d’accord.</li>
<li><code>fmsb</code> pour construire des graphiques en radar.</li>
<li><code>treemap</code> pour construire une carte proportionnelle.</li>
<li><code>wordcloud2</code> et <code>textrank</code> pour construire un nuage de mots.</li>
</ul></li>
<li>Pour les cartes :
<ul>
<li><code>classInt</code> pour calculer les intervalles des classes.</li>
<li><code>ggsn</code> pour afficher une échelle.</li>
<li><code>tmap</code> pour la cartographie.</li>
</ul></li>
<li>Autres <em>packages</em> :
<ul>
<li><code>dplyr</code> et <code>reshape2</code> pour manipuler des données.</li>
<li><code>pdftools</code> pour extraire les textes des fichiers pdf.</li>
<li><code>udpipe</code> pour obtenir des dictionnaires linguistiques.</li>
<li><code>sf</code> pour manipuler des <em>simple feature collections</em>.</li>
</ul></li>
</ul>
</div>
<div class="bloc_notes">
<p><strong>Qu’est-ce que la visualisation de données?</strong></p>
<p>La représentation visuelle de données consiste à transposer des informations en une représentation graphique facilitant la lecture de ces dernières. Il s’agit autant d’un ensemble de méthodes, d’un art que d’un moyen de communication. Voici deux exemples marquants avant de détailler ce propos.</p>
<p>Cette première illustration permet de visualiser le volume de plastique que représente la consommation d’eau en bouteille : 480 milliards de bouteilles vendues en 10 ans! Ce chiffre astronomique est inimaginable. En revanche, une <a href="https://graphics.reuters.com/ENVIRONMENT-PLASTIC/0100B275155/index.html" target="_blank">montagne de plastique</a> de 2400 mètres surplombant Manhattan marque davantage les esprits.</p>
<p>Ce <a href="https://www.maplecroft.com/insights/analysis/84-of-worlds-fastest-growing-cities-face-extreme-climate-change-risks/" target="_blank">second graphique</a> représente quatre informations pour 234 villes à travers le monde :</p>
<ul>
<li>la croissance démographique (axe des abscisses),</li>
<li>la vulnérabilité au changement climatique (axe des ordonnées),</li>
<li>la taille des villes (taille des cercles),</li>
<li>le continent sur lequel est localisée chaque ville (couleur des cercles).</li>
</ul>
<p>Le graphique est à la fois très accrocheur et esthétique. En un coup d’œil, nous constatons que les villes avec une forte croissance démographique sont aussi les plus vénérables (lecture des deux axes) et qu’elles sont surtout localisées en Afrique et secondairement en Asie (en rouge et orange), quelle que soit leur taille (taille du cercle). À l’inverse, les villes européennes et américaines (en bleu) sont beaucoup moins vulnérables aux changements climatiques et avec une croissance démographique plus faible, qu’elles soient des petites, moyennes ou grandes villes.</p>
<p>Souvent négligée, la visualisation de données est perçue comme une tâche triviale : il s’agit simplement de représenter une donnée sous forme d’un graphique, car c’est l’option la plus pratique ou qui prend le moins d’espace. Pourtant, les avantages de la visualisation des données sont nombreux. Par exemple, la visualisation de données intègre aujourd’hui des supports dynamiques comme des animations, des figures interactives ou des applications web. R offre d’ailleurs des possibilités très intéressantes en la matière avec des <em>packages</em> comme <code>shiny</code>, <code>plotly</code> ou <code>leaflet</code>. Toutefois, nous ne couvrirons pas ici ces méthodes plus récentes en visualisation des données qui devraient faire l’objet d’un autre livre.</p>
<p><strong>Les principaux avantages de la visualisation des données</strong> :</p>
<ul>
<li><strong>Analyse exploratoire des données</strong> (<em>exploratory data analysis - EDA</em> en anglais). Visualiser des données est crucial pour détecter des problèmes en tout genre (données manquantes, valeurs extrêmes ou aberrantes, non-respect de conditions d’application de tests statistiques, etc.), mais aussi pour repérer de nouvelles associations entre les variables.</li>
<li><strong>Communication de vos résultats</strong>. La raison d’être d’un graphique est de délivrer un message clair relatif à un résultat obtenu suite à une analyse rigoureuse de vos données. Si votre graphique n’apporte aucune information claire, il vaut mieux ne pas le présenter, le diffuser. Les représentations ne sont pas neutres. Les couleurs et les formes ont des significations particulières en fonction de la culture et du contexte. Posez-vous donc toujours la question : à quel public est destiné le message? Évitez de surcharger vos visualisations de données, sinon l’essence du message sera perdue.</li>
<li><strong>Aide à la décision</strong>. Une illustration (graphique ou carte) peut être un outil facilitant la prise de décisions.</li>
</ul>
</div>
<div id="sect031" class="section level2">
<h2><span class="header-section-number">3.1</span> Philosophie du ggplot2</h2>
<p>Le <em>package</em> <code>ggplot2</code> fait partie du <code>tidyverse</code> et dispose d’une logique de fonctionnement particulière. Cette dernière se nomme <em>The Grammar of Graphics</em> (les deux G sont d’ailleurs à l’origine du nom <code>ggplot2</code>), proposée par Hadley Wickham (le créateur du <code>tidyverse</code>!) dans un article intitulé <em>A layered grammar of graphics</em> <span class="citation">(Wickham <a href="#ref-wickham2010layered" role="doc-biblioref">2010</a>)</span>. Nous proposons de synthétiser ici les concepts et principes centraux qui sous-tendent la production de graphiques avec <code>ggplot2</code>.</p>
<div id="sect0311" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Grammaire</h3>
<p>Hadley Wickham propose une grammaire pour unifier la création de graphiques. L’idée est donc de dépasser les simples dénominations comme un nuage de points, un diagramme en boîte, un graphique en ligne, etc., pour comprendre ce qui relie tous ces graphiques. Ces éléments communs et centraux sont les géométries, les échelles et systèmes de coordonnées, et les annotations (figure @ref(fig:fig30)) :</p>
<div class="figure" style="text-align: center">
<img src="images/magie_graphiques/composantes.png" alt="Trois composantes d'un graphique, adapté de @wickham2010layered" width="70%" />
<p class="caption">
(#fig:fig30)Trois composantes d’un graphique, adapté de <span class="citation">Wickham (<a href="#ref-wickham2010layered" role="doc-biblioref">2010</a>)</span>
</p>
</div>
<ul>
<li>Les <strong>géométries</strong> sont les formes utilisées pour représenter les données. Il peut s’agir de points, lignes, cercles, rectangles, arcs de cercle, etc.</li>
<li>Les <strong>échelles et systèmes de coordonnées</strong> permettent de contrôler la localisation des éléments dans un graphique en convertissant les données depuis leur échelle originale (dollars, kilomètres, pourcentages, etc.) vers l’échelle du graphique (pixels).</li>
<li>Les <strong>annotations</strong> recoupent l’ensemble des informations complémentaires ajoutées au graphique comme son titre et sous-titre, la source des données, la mention sur les droits d’auteurs, etc.</li>
</ul>
<p>En plus de ces trois éléments, il est bien sûr nécessaire de disposer de <strong>données</strong>. Ces dernières sont assignées à des dimensions du graphique pour être représentées (notamment les axes <em>X</em> et <em>Y</em> et la couleur). Cette étape est appelée <strong>aesthetics mapping</strong> dans <code>ggplot2</code>.</p>
<p>Lorsque nous combinons des données, leur assignation a des dimensions, un type de géométries, des échelles et un système de coordonnées, nous obtenons un <strong>calque</strong> (<em>layer</em> en anglais). Un graphique peut comprendre plusieurs calques comme nous le verrons dans les prochaines sections.</p>
<p>Prenons un premier exemple très simple et construisons un nuage de points à partir du jeu de données <em>iris</em> fourni de base dans R. Nous allons représenter la relation qui existe entre la longueur et la largeur des sépales de ces fleurs. Pour commencer, nous devons charger le <em>package</em> <code>ggplot2</code> et instancier un graphique avec la fonction <code>ggplot</code>.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb381-2"><a href="#cb381-2"></a><span class="kw">data</span>(iris)</span>
<span id="cb381-3"><a href="#cb381-3"></a><span class="kw">names</span>(iris)</span></code></pre></div>
<pre><code>## [1] &quot;Sepal.Length&quot; &quot;Sepal.Width&quot;  &quot;Petal.Length&quot; &quot;Petal.Width&quot;  &quot;Species&quot;</code></pre>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1"></a><span class="kw">ggplot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig31-1.png" alt="Base d'un graphique" width="65%" />
<p class="caption">
(#fig:fig31)Base d’un graphique
</p>
</div>
<p>Pour le moment, le graphique est vide (figure @ref(fig:fig31)). La seconde étape consiste à lui ajouter des données (au travers du paramètre <code>data</code>) et à définir les dimensions à associer aux données (avec le paramètre <code>mapping</code> et la fonction <code>aes()</code>). Dans notre cas, nous voulons utiliser les coordonnées <em>X</em> pour représenter la largeur des sépales, et les coordonnées <em>Y</em> pour représenter la longueur des sépales. Enfin, nous souhaitons représenter les observations par des points, nous utiliserons donc la géométrie <code>geom_point</code>.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1"></a><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb384-2"><a href="#cb384-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig32-1.png" alt="Ajout des dimensions au graphique" width="65%" />
<p class="caption">
(#fig:fig32)Ajout des dimensions au graphique
</p>
</div>
<p>Ce graphique ne comprend qu’un seul calque avec une géométrie de type point (figure @ref(fig:fig32)). Chaque calque est ajouté avec l’opérateur <code>+</code> qui permet de superposer des calques, le dernier apparaissant au-dessus des autres. Les arguments <code>mapping</code> et <code>data</code> sont définis ici dans la fonction <code>ggplot</code> et sont donc appliqués à tous les calques qui composeraient le graphique. Il est aussi possible de définir <code>mapping</code> et <code>data</code> au sein des fonctions des géométries :</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb385-2"><a href="#cb385-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig33-1.png" alt="Autre spécification des arguments mapping et data" width="65%" />
<p class="caption">
(#fig:fig33)Autre spécification des arguments mapping et data
</p>
</div>
<p>La troisième étape consiste à ajouter au graphique des annotations. Pour notre cas, il faudrait ajouter un titre, un sous-titre et des intitulés plus clairs pour les axes <em>X</em> et <em>Y</em>, ce qu’il est possible de faire avec la fonction <code>labs</code> (figure @ref(fig:fig34)).</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb386-2"><a href="#cb386-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb386-3"><a href="#cb386-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb386-4"><a href="#cb386-4"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb386-5"><a href="#cb386-5"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig34-1.png" alt="Ajout de titres" width="65%" />
<p class="caption">
(#fig:fig34)Ajout de titres
</p>
</div>
</div>
<div id="sect0312" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Types de géométries</h3>
<p>Le <em>package</em> <code>ggplot2</code> permet d’utiliser un très grand nombre de géométries différentes. Dans le tableau @ref(tab:tablegeometries), nous avons reporté les principales géométries disponibles afin que vous puissiez vous faire une idée du bestiaire existant. Il ne s’agit que d’un extrait des principales fonctions. Sachez qu’il existe aussi des <em>packages</em> proposant des géométries supplémentaires pour compléter <code>ggplot2</code>.</p>
<table>
<caption>
(#tab:tablegeometries)Principales géométries proposées par <code>ggplot2</code>
</caption>
<thead>
<tr>
<th style="text-align:left;">
Géométrie
</th>
<th style="text-align:left;">
Fonction
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
point
</td>
<td style="text-align:left;">
<code>geom_point</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
ligne
</td>
<td style="text-align:left;">
<code>geom_line</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
chemin
</td>
<td style="text-align:left;">
<code>geom_path</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
boîte à moustaches
</td>
<td style="text-align:left;">
<code>geom_boxplot</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
diagramme violon
</td>
<td style="text-align:left;">
<code>geom_violin</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
histogramme
</td>
<td style="text-align:left;">
<code>geom_histogram</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
barre
</td>
<td style="text-align:left;">
<code>geom_bar</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
densité
</td>
<td style="text-align:left;">
<code>geom_density</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
texte
</td>
<td style="text-align:left;">
<code>geom_label</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
barre d’erreur
</td>
<td style="text-align:left;">
<code>geom_errorbar</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
surface
</td>
<td style="text-align:left;">
<code>geom_ribbon</code>
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect0313" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Habillage</h3>
<p>Dans le premier exemple, nous avons montré comment rajouter le titre, le sous-titre et les titres des axes sur un graphique. Il est aussi possible d’ajouter du texte sous le graphique (généralement la source des données avec l’argument <code>caption</code>) et des annotations textuelles (<code>annotate</code>). Pour ces dernières, il convient de spécifier leur localisation (coordonnées <code>x</code> et <code>y</code>) et le texte à intégrer (<code>label</code>); elles sont ensuite ajoutées au graphique avec l’opérateur <code>+</code>. Ajoutons deux annotations pour identifier deux fleurs spécifiques.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb387-2"><a href="#cb387-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb387-3"><a href="#cb387-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb387-4"><a href="#cb387-4"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb387-5"><a href="#cb387-5"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb387-6"><a href="#cb387-6"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span></span>
<span id="cb387-7"><a href="#cb387-7"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">6.7</span>, <span class="dt">y =</span> <span class="fl">2.5</span>, <span class="co"># position de la note</span></span>
<span id="cb387-8"><a href="#cb387-8"></a>           <span class="dt">label =</span> <span class="st">&quot;une virginica&quot;</span>,  <span class="co"># texte de la note</span></span>
<span id="cb387-9"><a href="#cb387-9"></a>           <span class="dt">hjust =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">vjust =</span> <span class="st">&quot;top&quot;</span>, <span class="co"># ajustement</span></span>
<span id="cb387-10"><a href="#cb387-10"></a>           <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb387-11"><a href="#cb387-11"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">5.7</span>, <span class="dt">y =</span> <span class="fl">4.4</span>, <span class="co"># position de la note</span></span>
<span id="cb387-12"><a href="#cb387-12"></a>           <span class="dt">label =</span> <span class="st">&quot;une setosa&quot;</span>,  <span class="co"># texte de la note</span></span>
<span id="cb387-13"><a href="#cb387-13"></a>           <span class="dt">hjust =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">vjust =</span> <span class="st">&quot;top&quot;</span>, <span class="co"># ajustement</span></span>
<span id="cb387-14"><a href="#cb387-14"></a>           <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">fontface =</span> <span class="st">&quot;italic&quot;</span>) </span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig35-1.png" alt="Ajouter des annotations textuelles" width="65%" />
<p class="caption">
(#fig:fig35)Ajouter des annotations textuelles
</p>
</div>
<p>Comme vous pouvez le constater, de nombreux paramètres permettent de contrôler le style des annotations. Pour avoir la liste des arguments disponibles, n’hésitez pas à afficher l’aide de la fonction : <code>help(annotate)</code>.</p>
<p>En plus des annotations de type texte, il est possible d’ajouter des annotations de type géométrique. Nous pourrions ainsi délimiter une boîte encadrant les fleurs de l’espère setosa.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1"></a>setosas &lt;-<span class="st"> </span><span class="kw">subset</span>(iris, iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>)</span>
<span id="cb388-2"><a href="#cb388-2"></a>sepal.length_extent &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">min</span>(setosas<span class="op">$</span>Sepal.Length),<span class="kw">max</span>(setosas<span class="op">$</span>Sepal.Length))</span>
<span id="cb388-3"><a href="#cb388-3"></a>sepal.width_extent &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">min</span>(setosas<span class="op">$</span>Sepal.Width),<span class="kw">max</span>(setosas<span class="op">$</span>Sepal.Width))</span>
<span id="cb388-4"><a href="#cb388-4"></a></span>
<span id="cb388-5"><a href="#cb388-5"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb388-6"><a href="#cb388-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb388-7"><a href="#cb388-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb388-8"><a href="#cb388-8"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb388-9"><a href="#cb388-9"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb388-10"><a href="#cb388-10"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span></span>
<span id="cb388-11"><a href="#cb388-11"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">6.7</span>, <span class="dt">y =</span> <span class="fl">2.5</span>, <span class="co"># position de la note</span></span>
<span id="cb388-12"><a href="#cb388-12"></a>           <span class="dt">label =</span> <span class="st">&quot;une virginica&quot;</span>,  <span class="co"># texte de la note</span></span>
<span id="cb388-13"><a href="#cb388-13"></a>           <span class="dt">hjust =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">vjust =</span> <span class="st">&quot;top&quot;</span>, <span class="co"># ajustement</span></span>
<span id="cb388-14"><a href="#cb388-14"></a>           <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb388-15"><a href="#cb388-15"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">5.7</span>, <span class="dt">y =</span> <span class="fl">4.4</span>, <span class="co"># position de la note</span></span>
<span id="cb388-16"><a href="#cb388-16"></a>           <span class="dt">label =</span> <span class="st">&quot;une setosa&quot;</span>,  <span class="co"># texte de la note</span></span>
<span id="cb388-17"><a href="#cb388-17"></a>           <span class="dt">hjust =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">vjust =</span> <span class="st">&quot;top&quot;</span>, <span class="co"># ajustement</span></span>
<span id="cb388-18"><a href="#cb388-18"></a>           <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="op">+</span></span>
<span id="cb388-19"><a href="#cb388-19"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;rect&quot;</span>, </span>
<span id="cb388-20"><a href="#cb388-20"></a>           <span class="dt">ymin =</span> sepal.width_extent[[<span class="dv">1</span>]],</span>
<span id="cb388-21"><a href="#cb388-21"></a>           <span class="dt">ymax =</span> sepal.width_extent[[<span class="dv">2</span>]],</span>
<span id="cb388-22"><a href="#cb388-22"></a>           <span class="dt">xmin =</span> sepal.length_extent[[<span class="dv">1</span>]],</span>
<span id="cb388-23"><a href="#cb388-23"></a>           <span class="dt">xmax =</span> sepal.length_extent[[<span class="dv">2</span>]],</span>
<span id="cb388-24"><a href="#cb388-24"></a>           <span class="dt">fill =</span> <span class="kw">rgb</span>(<span class="fl">0.7</span>,<span class="fl">0.7</span>,<span class="fl">0.7</span>,.<span class="dv">5</span>), <span class="co"># remplissage transparent à 50%</span></span>
<span id="cb388-25"><a href="#cb388-25"></a>           <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="co"># contour de couleur verte</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig36-1.png" alt="Ajouter des annotations géométriques" width="65%" />
<p class="caption">
(#fig:fig36)Ajouter des annotations géométriques
</p>
</div>
<p>Vous noterez que comme le dernier calque ajouté au graphique est le rectangle, il recouvre tous les calques existant, y compris les précédentes annotations. Pour corriger cela, il suffit de changer l’ordre des calques.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb389-2"><a href="#cb389-2"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;rect&quot;</span>, </span>
<span id="cb389-3"><a href="#cb389-3"></a>           <span class="dt">ymin =</span> sepal.width_extent[[<span class="dv">1</span>]],</span>
<span id="cb389-4"><a href="#cb389-4"></a>           <span class="dt">ymax =</span> sepal.width_extent[[<span class="dv">2</span>]],</span>
<span id="cb389-5"><a href="#cb389-5"></a>           <span class="dt">xmin =</span> sepal.length_extent[[<span class="dv">1</span>]],</span>
<span id="cb389-6"><a href="#cb389-6"></a>           <span class="dt">xmax =</span> sepal.length_extent[[<span class="dv">2</span>]],</span>
<span id="cb389-7"><a href="#cb389-7"></a>           <span class="dt">fill =</span> <span class="kw">rgb</span>(<span class="fl">0.7</span>,<span class="fl">0.7</span>,<span class="fl">0.7</span>,.<span class="dv">5</span>), <span class="co"># remplissage transparent à 50%</span></span>
<span id="cb389-8"><a href="#cb389-8"></a>           <span class="dt">color =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># contour de couleur verte</span></span>
<span id="cb389-9"><a href="#cb389-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb389-10"><a href="#cb389-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb389-11"><a href="#cb389-11"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb389-12"><a href="#cb389-12"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb389-13"><a href="#cb389-13"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span></span>
<span id="cb389-14"><a href="#cb389-14"></a></span>
<span id="cb389-15"><a href="#cb389-15"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">6.7</span>, <span class="dt">y =</span> <span class="fl">2.5</span>, <span class="co"># position de la note</span></span>
<span id="cb389-16"><a href="#cb389-16"></a>           <span class="dt">label =</span> <span class="st">&quot;une virginica&quot;</span>,  <span class="co"># texte de la note</span></span>
<span id="cb389-17"><a href="#cb389-17"></a>           <span class="dt">hjust =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">vjust =</span> <span class="st">&quot;top&quot;</span>, <span class="co"># ajustement</span></span>
<span id="cb389-18"><a href="#cb389-18"></a>           <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb389-19"><a href="#cb389-19"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">5.7</span>, <span class="dt">y =</span> <span class="fl">4.4</span>, <span class="co"># position de la note</span></span>
<span id="cb389-20"><a href="#cb389-20"></a>           <span class="dt">label =</span> <span class="st">&quot;une setosa&quot;</span>,  <span class="co"># texte de la note</span></span>
<span id="cb389-21"><a href="#cb389-21"></a>           <span class="dt">hjust =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">vjust =</span> <span class="st">&quot;top&quot;</span>, <span class="co"># ajustement</span></span>
<span id="cb389-22"><a href="#cb389-22"></a>           <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">fontface =</span> <span class="st">&quot;italic&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig37-1.png" alt="Gérer l'ordre des annotations" width="65%" />
<p class="caption">
(#fig:fig37)Gérer l’ordre des annotations
</p>
</div>
</div>
<div id="utilisation-des-thèmes" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Utilisation des thèmes</h3>
<p>De nombreux autres éléments peuvent être modifiés dans un graphique comme les paramètres des polices, l’arrière-plan, la grille de repères, etc. Il peut être fastidieux de paramétrer tous ces éléments. Une alternative intéressante est d’utiliser des thèmes déjà préconstruits. Le <em>package</em> <code>ggplot2</code> propose une dizaine de thèmes, constatons leur impact sur le graphique précédent.</p>
<ul>
<li>Le thème classique</li>
</ul>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb390-2"><a href="#cb390-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb390-3"><a href="#cb390-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb390-4"><a href="#cb390-4"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb390-5"><a href="#cb390-5"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb390-6"><a href="#cb390-6"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb390-7"><a href="#cb390-7"></a><span class="st">  </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig38-1.png" alt="Thème classique" width="65%" />
<p class="caption">
(#fig:fig38)Thème classique
</p>
</div>
<ul>
<li>Le thème gris (figure @ref(fig:fig39))</li>
</ul>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb391-2"><a href="#cb391-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb391-3"><a href="#cb391-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb391-4"><a href="#cb391-4"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb391-5"><a href="#cb391-5"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb391-6"><a href="#cb391-6"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb391-7"><a href="#cb391-7"></a><span class="st">  </span><span class="kw">theme_gray</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig39-1.png" alt="Thème gris" width="65%" />
<p class="caption">
(#fig:fig39)Thème gris
</p>
</div>
<ul>
<li>Le thème noir et blanc (figure @ref(fig:fig310))</li>
</ul>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb392-2"><a href="#cb392-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb392-3"><a href="#cb392-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb392-4"><a href="#cb392-4"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb392-5"><a href="#cb392-5"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb392-6"><a href="#cb392-6"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb392-7"><a href="#cb392-7"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig310-1.png" alt="Thème noir et blanc" width="65%" />
<p class="caption">
(#fig:fig310)Thème noir et blanc
</p>
</div>
<ul>
<li>Le thème minimal (figure @ref(fig:fig311))</li>
</ul>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb393-2"><a href="#cb393-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb393-3"><a href="#cb393-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb393-4"><a href="#cb393-4"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb393-5"><a href="#cb393-5"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb393-6"><a href="#cb393-6"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb393-7"><a href="#cb393-7"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig311-1.png" alt="Thème minimal" width="65%" />
<p class="caption">
(#fig:fig311)Thème minimal
</p>
</div>
<p>Il est aussi possible d’utiliser le <em>package</em> <code>ggthemes</code> qui apporte des thèmes complémentaires intéressants dont :</p>
<ul>
<li>Le thème <code>tufte</code> (à l’ancienne…) (figure @ref(fig:fig312))</li>
</ul>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1"></a><span class="kw">library</span>(ggthemes)</span>
<span id="cb394-2"><a href="#cb394-2"></a></span>
<span id="cb394-3"><a href="#cb394-3"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb394-4"><a href="#cb394-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb394-5"><a href="#cb394-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb394-6"><a href="#cb394-6"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb394-7"><a href="#cb394-7"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb394-8"><a href="#cb394-8"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb394-9"><a href="#cb394-9"></a><span class="st">  </span><span class="kw">theme_tufte</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig312-1.png" alt="Thème tufte" width="65%" />
<p class="caption">
(#fig:fig312)Thème tufte
</p>
</div>
<ul>
<li>Le thème <code>economist</code> (inspiré de la revue du même nom) (figure @ref(fig:fig313))</li>
</ul>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb395-2"><a href="#cb395-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb395-3"><a href="#cb395-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb395-4"><a href="#cb395-4"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb395-5"><a href="#cb395-5"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb395-6"><a href="#cb395-6"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb395-7"><a href="#cb395-7"></a><span class="st">  </span><span class="kw">theme_economist</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig313-1.png" alt="Thème economist" width="65%" />
<p class="caption">
(#fig:fig313)Thème economist
</p>
</div>
<ul>
<li>Le thème <code>solarized</code> (plus original) (figure @ref(fig:fig314))</li>
</ul>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb396-2"><a href="#cb396-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb396-3"><a href="#cb396-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb396-4"><a href="#cb396-4"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb396-5"><a href="#cb396-5"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb396-6"><a href="#cb396-6"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb396-7"><a href="#cb396-7"></a><span class="st">  </span><span class="kw">theme_solarized</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig314-1.png" alt="Thème solarized" width="65%" />
<p class="caption">
(#fig:fig314)Thème solarized
</p>
</div>
<p>Il en existe bien d’autres et vous pouvez composer vos propres thèmes. N’hésitez pas à explorer la documentation de <code>ggplot2</code> et <code>ggthemes</code> pour en apprendre plus!</p>
</div>
<div id="sect0314" class="section level3">
<h3><span class="header-section-number">3.1.5</span> Composer une figure avec plusieurs graphiques</h3>
<p>Il est très fréquent de vouloir combiner plusieurs graphiques dans une même figure. Deux cas se distinguent :</p>
<ol style="list-style-type: decimal">
<li><p>Les données pour les différents graphiques proviennent du même <em>DataFrame</em> et peuvent être distinguées selon une variable catégorielle. L’objectif est alors de dupliquer le même graphique, mais pour des sous-groupes de données. Dans ce cas, nous recommandons d’utiliser la fonction <code>facet_wrap</code> de <code>ggplot2</code>.</p></li>
<li><p>Les graphiques sont complètement indépendants. Dans ce cas, nous recommandons d’utiliser la fonction <code>ggarrange</code> du <em>package</em> <code>ggpubr</code>.</p></li>
</ol>
<div id="sect03141" class="section level4">
<h4><span class="header-section-number">3.1.5.1</span> <code>ggplot2</code> et ses facettes</h4>
<p>Nous pourrions souhaiter réaliser une figure composite avec le jeu de données Iris et séparer notre nuage de points en trois graphiques distincts selon les espèces des iris (figure @ref(fig:fig315)). Pour cela, il faut au préalable convertir la variable espèce en facteur.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1"></a>iris<span class="op">$</span>Species_fac &lt;-<span class="st"> </span><span class="kw">as.factor</span>(iris<span class="op">$</span>Species)</span>
<span id="cb397-2"><a href="#cb397-2"></a></span>
<span id="cb397-3"><a href="#cb397-3"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb397-4"><a href="#cb397-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb397-5"><a href="#cb397-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb397-6"><a href="#cb397-6"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb397-7"><a href="#cb397-7"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb397-8"><a href="#cb397-8"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span></span>
<span id="cb397-9"><a href="#cb397-9"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(Species_fac), <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig315-1.png" alt="Graphique à facettes" width="65%" />
<p class="caption">
(#fig:fig315)Graphique à facettes
</p>
</div>
<p>Notez que le nom de la variable (ici <code>Species_fac</code>) doit être spécifié au sein d’une sous-fonction <code>vars</code> : <code>vars(Species_fac)</code>. Nous aurions aussi pu réaliser le graphique sur une seule ligne en spécifiant <code>ncol = 3</code> (figure @ref(fig:fig316)).</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb398-2"><a href="#cb398-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb398-3"><a href="#cb398-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Morphologie des sépales des iris&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;n = 150&quot;</span>,</span>
<span id="cb398-4"><a href="#cb398-4"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur des sépales&quot;</span>, </span>
<span id="cb398-5"><a href="#cb398-5"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur des sépales&quot;</span>,</span>
<span id="cb398-6"><a href="#cb398-6"></a>       <span class="dt">caption =</span> <span class="st">&quot;Source : jeu de données Iris&quot;</span>) <span class="op">+</span></span>
<span id="cb398-7"><a href="#cb398-7"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(Species_fac), <span class="dt">ncol=</span><span class="dv">3</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig316-1.png" alt="Graphique à facette en une ligne" width="65%" />
<p class="caption">
(#fig:fig316)Graphique à facette en une ligne
</p>
</div>
</div>
<div id="sect03142" class="section level4">
<h4><span class="header-section-number">3.1.5.2</span> Arranger des graphiques</h4>
<p>La solution avec les facettes est très pratique, mais également très limitée puisqu’elle ne permet pas de créer une figure avec des graphiques combinant plusieurs types de géométries. <code>ggarrange</code> du <em>package</em> <code>ggpubr</code> permet tout simplement de combiner des graphiques déjà existant. Créons deux nuages de points comparant plusieurs variables en fonction de l’espèce des iris, puis combinons-les (figure @ref(fig:fig317)). Nous allons également attribuer aux points une couleur en fonction de l’espèce des fleurs, afin de mieux les distinguer en associant la variable <code>Species</code> au paramètre <code>color</code>.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb399-2"><a href="#cb399-2"></a></span>
<span id="cb399-3"><a href="#cb399-3"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb399-4"><a href="#cb399-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width, <span class="dt">color =</span> Species)) <span class="op">+</span></span>
<span id="cb399-5"><a href="#cb399-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Caractéristiques des sépales&quot;</span>,</span>
<span id="cb399-6"><a href="#cb399-6"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur&quot;</span>, </span>
<span id="cb399-7"><a href="#cb399-7"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur&quot;</span>,</span>
<span id="cb399-8"><a href="#cb399-8"></a>       <span class="dt">color =</span> <span class="st">&quot;Espèce&quot;</span>)</span>
<span id="cb399-9"><a href="#cb399-9"></a></span>
<span id="cb399-10"><a href="#cb399-10"></a>plot2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> iris) <span class="op">+</span></span>
<span id="cb399-11"><a href="#cb399-11"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width, <span class="dt">color =</span> Species)) <span class="op">+</span></span>
<span id="cb399-12"><a href="#cb399-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Caractéristiques des pétales&quot;</span>,</span>
<span id="cb399-13"><a href="#cb399-13"></a>       <span class="dt">x =</span> <span class="st">&quot;Longueur&quot;</span>, </span>
<span id="cb399-14"><a href="#cb399-14"></a>       <span class="dt">y =</span> <span class="st">&quot;Largeur&quot;</span>,</span>
<span id="cb399-15"><a href="#cb399-15"></a>       <span class="dt">color =</span> <span class="st">&quot;Espèce&quot;</span>)</span>
<span id="cb399-16"><a href="#cb399-16"></a></span>
<span id="cb399-17"><a href="#cb399-17"></a>liste_plots &lt;-<span class="st"> </span><span class="kw">list</span>(plot1, plot2)</span>
<span id="cb399-18"><a href="#cb399-18"></a>comp_plot &lt;-<span class="st"> </span><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> liste_plots, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb399-19"><a href="#cb399-19"></a>          <span class="dt">common.legend =</span> <span class="ot">TRUE</span>, <span class="dt">legend =</span> <span class="st">&quot;bottom&quot;</span>) <span class="co">#gérer la légende</span></span>
<span id="cb399-20"><a href="#cb399-20"></a></span>
<span id="cb399-21"><a href="#cb399-21"></a><span class="kw">annotate_figure</span>(comp_plot,</span>
<span id="cb399-22"><a href="#cb399-22"></a>                <span class="dt">top =</span> <span class="kw">text_grob</span>(<span class="st">&quot;Morphologie des sépales et pétales des iris&quot;</span>,</span>
<span id="cb399-23"><a href="#cb399-23"></a>                                <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">just =</span> <span class="st">&quot;center&quot;</span>),</span>
<span id="cb399-24"><a href="#cb399-24"></a>                <span class="dt">bottom =</span> <span class="kw">text_grob</span>(<span class="st">&quot;Source : jeu de données Iris&quot;</span>,</span>
<span id="cb399-25"><a href="#cb399-25"></a>                                <span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="dt">size =</span> <span class="dv">8</span>, <span class="dt">just =</span> <span class="st">&quot;left&quot;</span>)</span>
<span id="cb399-26"><a href="#cb399-26"></a>                )</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig317-1.png" alt="Figure avec plusieurs graphiques avec ggarrange" width="65%" />
<p class="caption">
(#fig:fig317)Figure avec plusieurs graphiques avec ggarrange
</p>
</div>
<p>Vous constaterez que quatre étapes sont nécessaires :</p>
<ol style="list-style-type: decimal">
<li>Créer les graphiques et les enregistrer dans des objets (ici <em>plot1</em> et <em>plot2</em>).</li>
<li>Encapsuler ces objets dans une liste (ici <em>liste_plots</em>).</li>
<li>Composer la figure finale avec la fonction <code>ggarrange</code>.</li>
<li>Ajouter les annotations à la figure composite.</li>
</ol>
<p>L’argument <code>common.legend</code> permet d’indiquer à la fonction <code>ggarrange</code> de regrouper les légendes des deux graphiques. Dans notre cas, les deux graphiques ont les mêmes légendes, il est donc judicieux de les regrouper. L’argument <code>legend</code> contrôle la position de la légende, et peut prendre les valeurs : <em>top</em>, <em>bottom</em>, <em>left</em>, <em>right</em> ou <em>none</em> (absence de légende). La fonction <code>annotate_figure</code> permet d’ajouter des éléments de texte au-dessus, au-dessous et sur les cotés de la figure composite.</p>
</div>
</div>
<div id="sect0315" class="section level3">
<h3><span class="header-section-number">3.1.6</span> Couleur</h3>
<p>Dans un graphique, la couleur peut être utilisée à la fois pour représenter une variable quantitative (dégradé de couleur ou mise en classes), ou une variable qualitative (couleur par catégorie). Dans <code>ggplot2</code>, il est possible d’attribuer une couleur au contour des géométries avec l’argument <code>color</code> et au remplissage avec l’argument <code>fill</code>. Il est possible de spécifier une couleur de trois façons dans R :</p>
<ul>
<li>En utilisant le nom de la couleur dans une chaîne de caractère : <code>"chartreuse4"</code>. R dispose 657 noms de couleurs prédéfinis. Pour tous les afficher, utilisez la fonction <code>colors()</code> qui permet de les visualiser (figure @ref(fig:figcolors)).</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/magie_graphiques/all_colors.png" alt="Couleurs de base" width="85%" />
<p class="caption">
(#fig:figcolors)Couleurs de base
</p>
</div>
<ul>
<li><p>En indiquant le code hexadécimal de la couleur. Il s’agit d’une suite de six lettres et de chiffres précédée par un dièse : <code>"#99ff33"</code>.</p></li>
<li><p>En utilisant une notation RGB (rouge, vert, bleu, transparence). Cette notation doit contenir quatre nombres entre 0 et 1 (0% et 100%), le premier indiquant la quantité de rouge, le second de vert, le troisième de bleu, et le quatrième la transparence. Ces quatre nombres sont donnés comme argument à la fonction <code>rgb</code> : <code>rgb(0.6, 1, 0.2, 0)</code>.</p></li>
</ul>
<p>Le choix des couleurs est un problème plus complexe que la manière de les spécifier. Il existe d’ailleurs tout un pan de la sémiologie graphique dédié à la question du choix et de l’association des couleurs. Une première ressource intéressante est <a href="https://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3" target="_blank">ColorBrewer</a>. Il s’agit d’une sélection de palettes de couleurs particulièrement efficaces et dont certaines sont même adaptées pour les personnes daltoniennes (figure @ref(fig:figcolorBrewer)). Il est possible d’accéder directement aux palettes dans R grâce au <em>package</em> <code>RColorBrewer</code> et la fonction <code>brewer.pal</code> :</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb400-2"><a href="#cb400-2"></a></span>
<span id="cb400-3"><a href="#cb400-3"></a><span class="kw">display.brewer.all</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figcolorBrewer-1.png" alt="Palette de couleurs de ColorBrewer" width="85%" />
<p class="caption">
(#fig:figcolorBrewer)Palette de couleurs de ColorBrewer
</p>
</div>
<p>Une autre ressource pertinente est le site web <a href="https://coolors.co/palettes/trending" target="_blank">coolors.co</a> qui propose de nombreuses palettes à portée de clic.</p>
</div>
</div>
<div id="sect032" class="section level2">
<h2><span class="header-section-number">3.2</span> Principaux graphiques</h2>
<div class="bloc_objectif">
<p>Puisque vous êtes désormais initié(e) aux bases de la grammaire des graphiques implémentées par <code>ggplot2</code>, vous apprendrez dans les sous-sections suivantes à construire les principaux graphiques que vous utiliserez régulièrement ou que vous présenterez dans un article scientifique.</p>
</div>
<div id="sect0321" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Histogramme</h3>
<p>L’histogramme permet de décrire graphiquement la forme de la distribution d’une variable. Pour le réaliser, nous utilisons la fonction <code>geom_histogram</code>. Le paramètre le plus important est le nombre de barres (<code>bins</code>) qui composent l’histogramme. Plus ce nombre est grand, plus l’histogramme est précis et, à l’inverse, plus il est petit, plus l’histogramme est simplifié. En revanche, il faut éviter d’utiliser un nombre de barres trop élevé comparativement au nombre d’observations disponibles dans le jeu de données, sinon l’histogramme risque d’avoir plein de trous.</p>
<div id="sect03211" class="section level4">
<h4><span class="header-section-number">3.2.1.1</span> Histogrammes simples</h4>
<p>Générons quatre variables ayant respectivement une distribution gaussienne, Student, Gamma et Beta, puis réalisons un histogramme pour chacune de ces variables et combinons-les avec la fonction <code>ggarrange</code> (figure @ref(fig:fig318)).</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1"></a>distribs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb401-2"><a href="#cb401-2"></a>  <span class="dt">gaussien =</span> <span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="fl">1.5</span>),</span>
<span id="cb401-3"><a href="#cb401-3"></a>  <span class="dt">gamma =</span> <span class="kw">rgamma</span>(<span class="dv">1000</span>, <span class="dt">shape =</span> <span class="dv">2</span>, <span class="dt">rate =</span> <span class="dv">12</span>),</span>
<span id="cb401-4"><a href="#cb401-4"></a>  <span class="dt">beta =</span> <span class="kw">rbeta</span>(<span class="dv">1000</span>,<span class="dt">shape1 =</span> <span class="dv">5</span>, <span class="dt">shape2 =</span> <span class="dv">1</span>, <span class="dt">ncp =</span> <span class="dv">2</span>),</span>
<span id="cb401-5"><a href="#cb401-5"></a>  <span class="dt">student =</span> <span class="kw">rt</span>(<span class="dv">1000</span>,<span class="dt">ncp =</span> <span class="dv">20</span>, <span class="dt">df =</span> <span class="dv">5</span>)</span>
<span id="cb401-6"><a href="#cb401-6"></a>)</span>
<span id="cb401-7"><a href="#cb401-7"></a></span>
<span id="cb401-8"><a href="#cb401-8"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> distribs) <span class="op">+</span></span>
<span id="cb401-9"><a href="#cb401-9"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gaussien), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#e63946&quot;</span>)<span class="op">+</span></span>
<span id="cb401-10"><a href="#cb401-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;fréquences&quot;</span>)<span class="op">+</span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">130</span>))</span>
<span id="cb401-11"><a href="#cb401-11"></a></span>
<span id="cb401-12"><a href="#cb401-12"></a>plot2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> distribs) <span class="op">+</span></span>
<span id="cb401-13"><a href="#cb401-13"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gamma), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#f1faee&quot;</span>)<span class="op">+</span></span>
<span id="cb401-14"><a href="#cb401-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;fréquences&quot;</span>)<span class="op">+</span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">130</span>))</span>
<span id="cb401-15"><a href="#cb401-15"></a></span>
<span id="cb401-16"><a href="#cb401-16"></a>plot3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> distribs) <span class="op">+</span></span>
<span id="cb401-17"><a href="#cb401-17"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> beta), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>)<span class="op">+</span></span>
<span id="cb401-18"><a href="#cb401-18"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;fréquences&quot;</span>)<span class="op">+</span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">130</span>))</span>
<span id="cb401-19"><a href="#cb401-19"></a></span>
<span id="cb401-20"><a href="#cb401-20"></a>plot4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> distribs) <span class="op">+</span></span>
<span id="cb401-21"><a href="#cb401-21"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> student), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#1d3557&quot;</span>)<span class="op">+</span></span>
<span id="cb401-22"><a href="#cb401-22"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;fréquences&quot;</span>)<span class="op">+</span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">130</span>))</span>
<span id="cb401-23"><a href="#cb401-23"></a></span>
<span id="cb401-24"><a href="#cb401-24"></a>histogrammes &lt;-<span class="st"> </span><span class="kw">list</span>(plot1, plot2, plot3, plot4)</span>
<span id="cb401-25"><a href="#cb401-25"></a></span>
<span id="cb401-26"><a href="#cb401-26"></a><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> histogrammes, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 3 rows containing missing values (geom_bar).</code></pre>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig318-1.png" alt="Histogrammes" width="65%" />
<p class="caption">
(#fig:fig318)Histogrammes
</p>
</div>
<p>Notez que cette syntaxe est très lourde. Dans le cas présent, il serait plus judicieux d’utiliser la fonction <code>facet_wrap</code>. Pour cela, nous devons au préalable empiler nos données, ce qui signifie changer la forme du <em>DataFrame</em> actuel qui comprend quatre colonnes (gaussien, gamma, beta et student) et 1000 observations, pour qu’il n’ait plus que deux colonnes (la valeur originale et le nom de l’ancienne colonne) et 4000 observations. La figure @ref(fig:fig319) décrit graphiquement ce processus qui peut être effectué avec la fonction <code>melt</code> du <em>package</em> <code>reshape2</code>.</p>
<div class="figure" style="text-align: center">
<img src="images/magie_graphiques/melting.png" alt="Empiler les données d'un DataFrame" width="30%" />
<p class="caption">
(#fig:fig319)Empiler les données d’un DataFrame
</p>
</div>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1"></a><span class="kw">library</span>(reshape2)</span>
<span id="cb403-2"><a href="#cb403-2"></a></span>
<span id="cb403-3"><a href="#cb403-3"></a><span class="co">#faire fondre le jeu de données</span></span>
<span id="cb403-4"><a href="#cb403-4"></a>melted_distribs &lt;-<span class="st"> </span><span class="kw">melt</span>(distribs, <span class="dt">measure.vars =</span> <span class="kw">c</span>(<span class="st">&quot;gaussien&quot;</span>, <span class="st">&quot;gamma&quot;</span>,</span>
<span id="cb403-5"><a href="#cb403-5"></a>                                                   <span class="st">&quot;beta&quot;</span>,<span class="st">&quot;student&quot;</span>))</span>
<span id="cb403-6"><a href="#cb403-6"></a><span class="co">#renommer les colonnes du nouveau DataFrame</span></span>
<span id="cb403-7"><a href="#cb403-7"></a><span class="kw">names</span>(melted_distribs) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;distribution&quot;</span>, <span class="st">&quot;valeur&quot;</span>)</span>
<span id="cb403-8"><a href="#cb403-8"></a><span class="co">#convertir la variable catégorielle en facteur</span></span>
<span id="cb403-9"><a href="#cb403-9"></a>melted_distribs<span class="op">$</span>distribution &lt;-<span class="st"> </span><span class="kw">as.factor</span>(melted_distribs<span class="op">$</span>distribution)</span>
<span id="cb403-10"><a href="#cb403-10"></a></span>
<span id="cb403-11"><a href="#cb403-11"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> melted_distribs)<span class="op">+</span></span>
<span id="cb403-12"><a href="#cb403-12"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> valeur, <span class="dt">fill =</span> distribution), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>) <span class="op">+</span></span>
<span id="cb403-13"><a href="#cb403-13"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">130</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb403-14"><a href="#cb403-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;valeur&quot;</span>, </span>
<span id="cb403-15"><a href="#cb403-15"></a>       <span class="dt">y =</span> <span class="st">&quot;fréquences&quot;</span>)<span class="op">+</span></span>
<span id="cb403-16"><a href="#cb403-16"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#e63946&quot;</span>,<span class="st">&quot;#f1faee&quot;</span>,<span class="st">&quot;#a8dadc&quot;</span>,<span class="st">&quot;#1d3557&quot;</span>))<span class="op">+</span></span>
<span id="cb403-17"><a href="#cb403-17"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(distribution), <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="op">+</span></span>
<span id="cb403-18"><a href="#cb403-18"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig320-1.png" alt="Histogrammes en facettes" width="65%" />
<p class="caption">
(#fig:fig320)Histogrammes en facettes
</p>
</div>
</div>
<div id="sect03212" class="section level4">
<h4><span class="header-section-number">3.2.1.2</span> Histogrammes de densité</h4>
<p>Les histogrammes que nous venons de construire utilisent les fréquences des observations pour délimiter la hauteur des barres. Il est possible de changer ce comportement pour plutôt utiliser la densité. L’intérêt est notamment de se rapprocher encore de la définition d’une distribution puisqu’avec cette configuration la somme totale de la surface de l’histogramme est égale à 1. La hauteur de chaque barre représente alors la probabilité d’obtenir l’étendue de valeurs représentées par cette barre. Prenons pour exemple la variable avec la distribution normale que nous venons de voir.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> distribs) <span class="op">+</span></span>
<span id="cb404-2"><a href="#cb404-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gaussien, <span class="dt">y =</span> ..density..),</span>
<span id="cb404-3"><a href="#cb404-3"></a>                 <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#1d3557&quot;</span>)<span class="op">+</span></span>
<span id="cb404-4"><a href="#cb404-4"></a><span class="st">      </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;gaussien&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;densité&quot;</span>)</span>
<span id="cb404-5"><a href="#cb404-5"></a></span>
<span id="cb404-6"><a href="#cb404-6"></a>plot2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> distribs) <span class="op">+</span></span>
<span id="cb404-7"><a href="#cb404-7"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gaussien, <span class="dt">y =</span> ..count..),</span>
<span id="cb404-8"><a href="#cb404-8"></a>                 <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>)<span class="op">+</span></span>
<span id="cb404-9"><a href="#cb404-9"></a><span class="st">        </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;gaussien&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;fréquences&quot;</span>)</span>
<span id="cb404-10"><a href="#cb404-10"></a></span>
<span id="cb404-11"><a href="#cb404-11"></a><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> <span class="kw">list</span>(plot1, plot2), <span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig321-1.png" alt="Histogrammes de densité" width="65%" />
<p class="caption">
(#fig:fig321)Histogrammes de densité
</p>
</div>
<p>Le graphique de droite (fréquence) nous indique donc que plus de 100 observations ont une valeur d’environ 5 (entre 4,76 et 5,34, compte tenu de la largeur de la barre), ce qui se traduit par une probabilité de presque 30% d’obtenir cette valeur en tirant une observation au hasard dans le jeu de données.</p>
</div>
<div id="sect03213" class="section level4">
<h4><span class="header-section-number">3.2.1.3</span> Histogramme avec courbe de distribution</h4>
<p>Les histogrammes sont souvent utilisés pour vérifier graphiquement si une distribution empirique s’approche d’une courbe normale. Pour cela, nous rajoutons sur l’histogramme de la variable empirique la forme qu’aurait une distribution normale parfaite en utilisant la moyenne et l’écart type de la distribution empirique. Pour créer cette figure dans <code>ggplot2</code>, il suffit d’utiliser la fonction <code>stat_function</code> pour créer un nouveau calque. Il est aussi possible d’ajouter une ligne verticale (<code>geom_vline</code>) pour indiquer la moyenne de la distribution.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="#cb405-1"></a>moyenne &lt;-<span class="st"> </span><span class="kw">mean</span>(distribs<span class="op">$</span>gaussien)</span>
<span id="cb405-2"><a href="#cb405-2"></a>ecart_type &lt;-<span class="st"> </span><span class="kw">sd</span>(distribs<span class="op">$</span>gaussien)</span>
<span id="cb405-3"><a href="#cb405-3"></a></span>
<span id="cb405-4"><a href="#cb405-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> distribs) <span class="op">+</span></span>
<span id="cb405-5"><a href="#cb405-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gaussien, <span class="dt">y =</span> ..density..),</span>
<span id="cb405-6"><a href="#cb405-6"></a>                 <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>) <span class="op">+</span></span>
<span id="cb405-7"><a href="#cb405-7"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;gaussien&quot;</span>, </span>
<span id="cb405-8"><a href="#cb405-8"></a>       <span class="dt">y =</span> <span class="st">&quot;densité&quot;</span>)<span class="op">+</span></span>
<span id="cb405-9"><a href="#cb405-9"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> moyenne, <span class="dt">sd =</span> ecart_type), </span>
<span id="cb405-10"><a href="#cb405-10"></a>                <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></span>
<span id="cb405-11"><a href="#cb405-11"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> moyenne, <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb405-12"><a href="#cb405-12"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="kw">round</span>(moyenne,<span class="dv">2</span>)<span class="op">+</span><span class="fl">0.5</span>, <span class="dt">y =</span> <span class="fl">0.31</span>, <span class="dt">hjust =</span> <span class="st">&#39;left&#39;</span>,</span>
<span id="cb405-13"><a href="#cb405-13"></a>           <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&#39;moyenne : &#39;</span>,<span class="kw">round</span>(moyenne,<span class="dv">2</span>),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig322-1.png" alt="Histogramme et courbe normale" width="65%" />
<p class="caption">
(#fig:fig322)Histogramme et courbe normale
</p>
</div>
<p>Dans notre cas, nous savons que notre variable est normalement distribuée (car produite avec la fonction <code>rnorm</code>), et nous pouvons constater la grande proximité entre l’histogramme et la courbe normale.</p>
</div>
<div id="sect03214" class="section level4">
<h4><span class="header-section-number">3.2.1.4</span> Histogramme avec coloration des valeurs extrêmes</h4>
<p>Il peut être nécessaire d’attirer le regard sur certaines parties de l’histogramme, comme sur des valeurs extrêmes. Si nous reprenons notre distribution de Student, nous pouvons clairement distinguer un ensemble de valeurs fortes à droite de la distribution. Nous pourrions dans notre cas considérer que des valeurs au-delà de 50 constituent des cas extrêmes que nous souhaitons représenter dans une autre couleur. Pour cela, nous devons créer une variable catégorielle nous permettant de distinguer ces cas particuliers.</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1"></a>distribs<span class="op">$</span>cas_extreme &lt;-<span class="st"> </span><span class="kw">ifelse</span>(distribs<span class="op">$</span>student <span class="op">&gt;=</span><span class="dv">50</span>, <span class="st">&quot;extrême&quot;, &quot;</span>normale<span class="st">&quot;)</span></span>
<span id="cb406-2"><a href="#cb406-2"></a></span>
<span id="cb406-3"><a href="#cb406-3"></a><span class="st">ggplot(data = distribs) +</span></span>
<span id="cb406-4"><a href="#cb406-4"></a><span class="st">  geom_histogram(aes(x = student, y = ..count.., fill = cas_extreme),</span></span>
<span id="cb406-5"><a href="#cb406-5"></a><span class="st">                 bins = 30, color = &quot;</span><span class="co">#343a40&quot;)+</span></span>
<span id="cb406-6"><a href="#cb406-6"></a>  <span class="kw">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#a8dadc&quot;</span>,<span class="st">&quot;#e63946&quot;</span>))<span class="op">+</span></span>
<span id="cb406-7"><a href="#cb406-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Distribution de Student&#39;</span>,<span class="dt">x =</span> <span class="st">&quot;valeur&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;fréquence&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig323-1.png" alt="Histogramme coloré" width="65%" />
<p class="caption">
(#fig:fig323)Histogramme coloré
</p>
</div>
</div>
</div>
<div id="sect0322" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Graphique de densité</h3>
<p>L’histogramme est utilisé pour approximer graphiquement la distribution d’une variable. Sa principale limite est de représenter la variable de façon discontinue. Une alternative intéressante est d’utiliser une version lissée de l’histogramme, soit le graphique de densité. Cette opération de lissage est réalisée le plus souvent à partir de fonctions <em>kernel</em>. Reconstruisons notre figure avec les quatre distributions, mais en utilisant cette fois-ci des graphiques de densité.</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="#cb407-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> melted_distribs)<span class="op">+</span></span>
<span id="cb407-2"><a href="#cb407-2"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x =</span> valeur, <span class="dt">fill =</span> distribution), <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>) <span class="op">+</span></span>
<span id="cb407-3"><a href="#cb407-3"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#e63946&quot;</span>,<span class="st">&quot;#f1faee&quot;</span>,<span class="st">&quot;#a8dadc&quot;</span>,<span class="st">&quot;#1d3557&quot;</span>))<span class="op">+</span></span>
<span id="cb407-4"><a href="#cb407-4"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(distribution), <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="op">+</span></span>
<span id="cb407-5"><a href="#cb407-5"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig324-1.png" alt="Graphiques de densité en facette" width="65%" />
<p class="caption">
(#fig:fig324)Graphiques de densité en facette
</p>
</div>
<p>Les graphiques de densité sont souvent utilisés pour comparer la distribution d’une variable pour plusieurs sous-groupes d’une population. Si nous reprenons le jeu de données Iris, nous pouvons comparer les longueurs de sépales en fonction des espèces. Nous constatons ainsi que les setosas ont une nette tendance à avoir des sépales plus courts et qu’à l’inverse, les virginicas ont les sépales généralement les plus longs.</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> iris)<span class="op">+</span></span>
<span id="cb408-2"><a href="#cb408-2"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">fill =</span> Species), </span>
<span id="cb408-3"><a href="#cb408-3"></a>               <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span>)<span class="op">+</span></span>
<span id="cb408-4"><a href="#cb408-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Longueur de sépales&#39;</span>,</span>
<span id="cb408-5"><a href="#cb408-5"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb408-6"><a href="#cb408-6"></a>       <span class="dt">fill =</span> <span class="st">&#39;Espèce&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig325-1.png" alt="Graphiques de densité superposés" width="65%" />
<p class="caption">
(#fig:fig325)Graphiques de densité superposés
</p>
</div>
</div>
<div id="sect0323" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Nuage de points</h3>
<p>Un nuage de points est un outil très intéressant pour visualiser la relation existante entre deux variables. Prenons un exemple concret et analysons le volume de CO<sub>2</sub> produit annuellement par habitant en comparaison avec le niveau d’urbanisation dans l’ensemble des pays à travers le monde. Nous avons extrait ces données sur le site web de la <a href="https://donnees.banquemondiale.org/indicateur" target="_blank">Banque Mondiale</a>, puis nous les avons structurés dans un fichier <em>csv</em>.</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1"></a>data_co2 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/graphique/world_urb_co2.csv&quot;</span>, <span class="dt">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb409-2"><a href="#cb409-2"></a><span class="kw">names</span>(data_co2)</span></code></pre></div>
<pre><code>## [1] &quot;country_code&quot; &quot;year&quot;         &quot;Population&quot;   &quot;Urbanisation&quot; &quot;CO2_kt&quot;      
## [6] &quot;Country.Name&quot; &quot;CO2t_hab&quot;     &quot;region7&quot;      &quot;region23&quot;</code></pre>
<div id="sect03231" class="section level4">
<h4><span class="header-section-number">3.2.3.1</span> Nuage de points simple</h4>
<p>Commençons par un nuage de points simple avec l’ensemble des données.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2)<span class="op">+</span></span>
<span id="cb411-2"><a href="#cb411-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab))<span class="op">+</span></span>
<span id="cb411-3"><a href="#cb411-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Niveau d&#39;urbanisation (%)&quot;</span>,</span>
<span id="cb411-4"><a href="#cb411-4"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb411-5"><a href="#cb411-5"></a>       <span class="dt">title =</span> <span class="st">&#39;Relation entre urbanisation et production de CO2 par habitant&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig326-1.png" alt="Nuage de points simple" width="65%" />
<p class="caption">
(#fig:fig326)Nuage de points simple
</p>
</div>
<p>À la première lecture de ce graphique, nous observons immédiatement un ensemble de points étranges dont le volume de CO<sub>2</sub> par habitant annuel est au-dessus de 150 tonnes et dont le niveau d’urbanisation est proche de 50%. Isolons ces données pour observer de quoi il s’agit.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1"></a>cas_etrange &lt;-<span class="st"> </span><span class="kw">subset</span>(data_co2, data_co2<span class="op">$</span>CO2t_hab <span class="op">&gt;=</span><span class="st"> </span><span class="dv">150</span>)</span>
<span id="cb412-2"><a href="#cb412-2"></a><span class="kw">print</span>(cas_etrange<span class="op">$</span>Country.Name)</span></code></pre></div>
<pre><code>##  [1] &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot;
## [10] &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot;
## [19] &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot; &quot;Aruba&quot;</code></pre>
<p>Il s’agit d’une petite île néerlandaise des Caraïbes nommée Aruba disposant d’une faible population, mais avec des activités très polluantes (raffinerie et extraction d’or). Nous faisons ici le choix de retirer ces observations puisqu’elles sont assez peu représentatives de la tendance mondiale. Cette démarche si simple relève ainsi de l’analyse exploratoire des données! Sans ce graphique, nous n’aurions probablement jamais identifié ces cas problématiques.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1"></a>data_co2 &lt;-<span class="st"> </span><span class="kw">subset</span>(data_co2, data_co2<span class="op">$</span>CO2t_hab <span class="op">&lt;=</span><span class="st"> </span><span class="dv">150</span>)</span></code></pre></div>
<p>Reconstruisons le nuage de points maintenant que ces données aberrantes ont été retirées.</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1"></a>graphique &lt;-<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2)<span class="op">+</span></span>
<span id="cb415-2"><a href="#cb415-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab))<span class="op">+</span></span>
<span id="cb415-3"><a href="#cb415-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Niveau d&#39;urbanisation (%)&quot;</span>,</span>
<span id="cb415-4"><a href="#cb415-4"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb415-5"><a href="#cb415-5"></a>       <span class="dt">title =</span> <span class="st">&#39;Relation entre urbanisation et production de CO2 par habitant&#39;</span>)</span></code></pre></div>
<p>Voilà qui est mieux! Cependant, le grand nombre de points restant rend la lecture du graphique assez difficile puisqu’ils se superposent. Une première option à envisager, dans ce cas, est à la fois d’ajouter de la transparence aux points et de réduire leur taille :</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2)<span class="op">+</span></span>
<span id="cb416-2"><a href="#cb416-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab), <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.5</span>)<span class="op">+</span></span>
<span id="cb416-3"><a href="#cb416-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Niveau d&#39;urbanisation (%)&quot;</span>,</span>
<span id="cb416-4"><a href="#cb416-4"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb416-5"><a href="#cb416-5"></a>       <span class="dt">title =</span> <span class="st">&#39;Relation entre urbanisation et production de CO2 par habitant&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig328-1.png" alt="Nuage de points simple avec transparence" width="65%" />
<p class="caption">
(#fig:fig328)Nuage de points simple avec transparence
</p>
</div>
</div>
<div id="sect03232" class="section level4">
<h4><span class="header-section-number">3.2.3.2</span> Nuage de points avec densité</h4>
<p>Bien que la transparence nous aide un peu à distinguer les secteurs du graphique avec le plus de points, il serait plus efficace d’abandonner la géométrie des points pour la remplacer par une géométrie de densité en deux dimensions. Une première approche consiste à diviser l’espace du graphique en petits carrés et à compter le nombre de points tombant dans chaque carré (en somme, un histogramme en deux dimensions).</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2)<span class="op">+</span></span>
<span id="cb417-2"><a href="#cb417-2"></a><span class="st">  </span><span class="kw">geom_bin2d</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab), <span class="dt">bins =</span> <span class="dv">50</span>) <span class="op">+</span></span>
<span id="cb417-3"><a href="#cb417-3"></a><span class="st">  </span><span class="kw">scale_fill_continuous</span>(<span class="dt">type =</span> <span class="st">&quot;viridis&quot;</span>) <span class="op">+</span></span>
<span id="cb417-4"><a href="#cb417-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Niveau d&#39;urbanisation (%)&quot;</span>,</span>
<span id="cb417-5"><a href="#cb417-5"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb417-6"><a href="#cb417-6"></a>       <span class="dt">fill =</span> <span class="st">&quot;Effectif&quot;</span>,</span>
<span id="cb417-7"><a href="#cb417-7"></a>       <span class="dt">title =</span> <span class="st">&#39;Relation entre urbanisation et production de CO2 par habitant&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig329-1.png" alt="Nuage de points simple" width="65%" />
<p class="caption">
(#fig:fig329)Nuage de points simple
</p>
</div>
<p>Nous observons ainsi une forte concentration dans le bas du graphique, les pays avec des rejets annuels de CO<sub>2</sub> supérieurs à 15 tonnes par habitant sont relativement rares. Pour les personnes préférant les représentations plus élaborées, il est aussi possible de diviser l’espace du graphique avec des hexagones en utilisant le <em>package</em> <code>hexbin</code>.</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2)<span class="op">+</span></span>
<span id="cb418-2"><a href="#cb418-2"></a><span class="st">  </span><span class="kw">geom_hex</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab), <span class="dt">bins =</span> <span class="dv">50</span>) <span class="op">+</span></span>
<span id="cb418-3"><a href="#cb418-3"></a><span class="st">  </span><span class="kw">scale_fill_continuous</span>(<span class="dt">type =</span> <span class="st">&quot;viridis&quot;</span>) <span class="op">+</span></span>
<span id="cb418-4"><a href="#cb418-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Niveau d&#39;urbanisation (%)&quot;</span>,</span>
<span id="cb418-5"><a href="#cb418-5"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb418-6"><a href="#cb418-6"></a>       <span class="dt">fill =</span> <span class="st">&quot;Effectif&quot;</span>,</span>
<span id="cb418-7"><a href="#cb418-7"></a>       <span class="dt">title =</span> <span class="st">&#39;Relation entre urbanisation et production de CO2 par habitant&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig330-1.png" alt="Densité en deux dimensions par hexagones" width="65%" />
<p class="caption">
(#fig:fig330)Densité en deux dimensions par hexagones
</p>
</div>
<p>Enfin, il est aussi possible de réaliser une version lissée de ces graphiques avec une fonction <em>kernel</em> en deux dimensions (<code>stat_density_2d</code>) :</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2)<span class="op">+</span></span>
<span id="cb419-2"><a href="#cb419-2"></a><span class="st">  </span><span class="kw">stat_density_2d</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab, <span class="dt">fill =</span> ..density..), </span>
<span id="cb419-3"><a href="#cb419-3"></a>                  <span class="dt">geom =</span> <span class="st">&quot;raster&quot;</span>, <span class="dt">n =</span> <span class="dv">50</span>, <span class="dt">contour =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb419-4"><a href="#cb419-4"></a><span class="st">  </span><span class="kw">scale_fill_continuous</span>(<span class="dt">type =</span> <span class="st">&quot;viridis&quot;</span>) <span class="op">+</span></span>
<span id="cb419-5"><a href="#cb419-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Niveau d&#39;urbanisation (%)&quot;</span>,</span>
<span id="cb419-6"><a href="#cb419-6"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb419-7"><a href="#cb419-7"></a>       <span class="dt">fill =</span> <span class="st">&quot;densité&quot;</span>,</span>
<span id="cb419-8"><a href="#cb419-8"></a>       <span class="dt">title =</span> <span class="st">&#39;Relation entre urbanisation et production de CO2 par habitant&#39;</span>)<span class="op">+</span></span>
<span id="cb419-9"><a href="#cb419-9"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>,<span class="dv">25</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig331-1.png" alt="Densité en deux dimensions lissée" width="65%" />
<p class="caption">
(#fig:fig331)Densité en deux dimensions lissée
</p>
</div>
</div>
<div id="sect03233" class="section level4">
<h4><span class="header-section-number">3.2.3.3</span> Nuage de points et droite de régression</h4>
<p>Afin de faire ressortir une éventuelle relation entre les variables représentées sur les deux axes, il est possible d’afficher la droite de régression sur le graphique entre X et Y. Cette opération s’effectue avec la fonction <code>geom_smooth</code>.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1"></a>graphique &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2)<span class="op">+</span></span>
<span id="cb420-2"><a href="#cb420-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab), <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.5</span>)<span class="op">+</span></span>
<span id="cb420-3"><a href="#cb420-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab), <span class="dt">method =</span> lm, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb420-4"><a href="#cb420-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Niveau d&#39;urbanisation (%)&quot;</span>,</span>
<span id="cb420-5"><a href="#cb420-5"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb420-6"><a href="#cb420-6"></a>       <span class="dt">title =</span> <span class="st">&#39;Relation entre urbanisation et production de CO2 par habitant&#39;</span>)</span></code></pre></div>
<p>Notez que l’argument <code>method = lm</code> permet d’indiquer que nous souhaitons utiliser une régression linéaire (<em>linear model</em>) pour tracer la géométrie (une droite de régression). La droite semble bien indiquer une relation positive entre les deux variables : une augmentation de l’urbanisation serait associée avec une augmentation de la production annuelle de CO<sub>2</sub> par habitant. Nous pourrions également vérifier si une relation non linéaire serait plus adaptée au jeu de données. Dans notre cas, une relation quadratique pourrait produire un meilleur ajustement.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2)<span class="op">+</span></span>
<span id="cb421-2"><a href="#cb421-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab), <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.7</span>)<span class="op">+</span></span>
<span id="cb421-3"><a href="#cb421-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab), <span class="dt">method =</span> lm, </span>
<span id="cb421-4"><a href="#cb421-4"></a>              <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(x<span class="op">**</span><span class="dv">2</span>))<span class="op">+</span></span>
<span id="cb421-5"><a href="#cb421-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Niveau d&#39;urbanisation (%)&quot;</span>,</span>
<span id="cb421-6"><a href="#cb421-6"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb421-7"><a href="#cb421-7"></a>       <span class="dt">title =</span> <span class="st">&#39;Relation entre urbanisation et production de CO2 par habitant&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig333-1.png" alt="Nuage de points avec droite de régression quadratique" width="65%" />
<p class="caption">
(#fig:fig333)Nuage de points avec droite de régression quadratique
</p>
</div>
<p>La régression quadratique (avec <em>x</em> au carré) nous indique ainsi que l’impact du niveau d’urbanisation est plus important à mesure que le niveau d’urbanisation augmente. Vous pouvez également constater que la courbe ne prédit pas de valeurs négatives comparativement à la droite précédente. Il est également possible d’ajuster une courbe sans choisir au préalable sa forme (dans le cas précédent <span class="math inline">\(x^2\)</span>) en utilisant une méthode d’ajustement local appelée <em>loess</em>.</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1"></a>graphique &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2)<span class="op">+</span></span>
<span id="cb422-2"><a href="#cb422-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab), <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.5</span>)<span class="op">+</span></span>
<span id="cb422-3"><a href="#cb422-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Urbanisation, <span class="dt">y =</span> CO2t_hab), <span class="dt">method =</span> loess, </span>
<span id="cb422-4"><a href="#cb422-4"></a>              <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb422-5"><a href="#cb422-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Niveau d&#39;urbanisation (%)&quot;</span>,</span>
<span id="cb422-6"><a href="#cb422-6"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb422-7"><a href="#cb422-7"></a>       <span class="dt">title =</span> <span class="st">&#39;Relation entre urbanisation et production de CO2 par habitant&#39;</span>)</span></code></pre></div>
<p>La relation non linéaire révèle davantage d’informations : l’augmentation de l’urbanisation est associée à une augmentation de l’émission de CO<sub>2</sub> par habitant uniquement jusqu’à 75% d’urbanisation; au-delà de ce seuil, la relation ne tient plus. Ces résultats semblent cohérents avec l’évolution classique de l’économie d’un pays passant progressivement d’une économie agricole, à une économie industrialisée et finalement une économie de services.</p>
</div>
</div>
<div id="sect0324" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Graphique en ligne</h3>
<p>Un graphique en ligne permet de représenter l’évolution d’une variable, généralement dans le temps. Dans le jeu de données précédent, nous disposons des émissions de CO<sub>2</sub> par habitant de nombreux pays sur plusieurs années. Nous pouvons ainsi représenter l’évolution des émissions pour chaque pays avec un graphique en ligne. Pour éviter de le surcharger, cet exercice est réalisé uniquement sur les pays de l’Europe de l’Ouest.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1"></a><span class="co"># conversion de la variable year textuelle en variable numérique</span></span>
<span id="cb423-2"><a href="#cb423-2"></a>data_co2<span class="op">$</span>an &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(data_co2<span class="op">$</span>year)</span>
<span id="cb423-3"><a href="#cb423-3"></a><span class="co"># extraction des données d&#39;Europe de l&#39;Ouest</span></span>
<span id="cb423-4"><a href="#cb423-4"></a>data_europe &lt;-<span class="st"> </span><span class="kw">subset</span>(data_co2, data_co2<span class="op">$</span>region23 <span class="op">==</span><span class="st"> &quot;Western Europe&quot;</span>)</span>
<span id="cb423-5"><a href="#cb423-5"></a><span class="co"># choix des valeurs pour l&#39;axe des x</span></span>
<span id="cb423-6"><a href="#cb423-6"></a>x_ticks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1960</span>,<span class="dv">2020</span>,<span class="dv">10</span>)</span>
<span id="cb423-7"><a href="#cb423-7"></a></span>
<span id="cb423-8"><a href="#cb423-8"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_europe)<span class="op">+</span></span>
<span id="cb423-9"><a href="#cb423-9"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> an, <span class="dt">y =</span> CO2t_hab, <span class="dt">color =</span> Country.Name))<span class="op">+</span></span>
<span id="cb423-10"><a href="#cb423-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Années&quot;</span>,</span>
<span id="cb423-11"><a href="#cb423-11"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb423-12"><a href="#cb423-12"></a>       <span class="dt">color =</span> <span class="st">&quot;Pays&quot;</span>,</span>
<span id="cb423-13"><a href="#cb423-13"></a>       <span class="dt">title =</span> <span class="st">&#39;Évolution de la production de CO2 par habitant&#39;</span>) <span class="op">+</span></span>
<span id="cb423-14"><a href="#cb423-14"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> x_ticks, <span class="dt">labels =</span> x_ticks)<span class="op">+</span></span>
<span id="cb423-15"><a href="#cb423-15"></a><span class="st">  </span><span class="kw">theme_tufte</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig335-1.png" alt="Graphique en ligne" width="65%" />
<p class="caption">
(#fig:fig335)Graphique en ligne
</p>
</div>
<p>Nous remarquons notamment qu’aucune donnée avant 2005 n’est disponible pour le Liechtenstein.</p>
<div id="sect03241" class="section level4">
<h4><span class="header-section-number">3.2.4.1</span> Barre d’erreur et en bande</h4>
<p>Sur un graphique, il est souvent pertinent de représenter l’incertitude que nous avons sur nos données. Cela peut être fait à l’aide de barres d’erreur ou à l’aide de polygones délimitant les marges d’incertitude. En guise d’exemple, admettons que les données précédentes sont fiables à plus ou moins 10%. En d’autres termes, la valeur d’émission de CO<sub>2</sub> annuelle serait relativement incertaine et pourrait se situer dans un intervalle de 10% autour de la valeur fournie par la Banque Mondiale. Nous obtenons ainsi une borne inférieure (valeur donnée - 10%) et une borne supérieure (valeur donnée + 10%). Nous pouvons facilement calculer ces bornes et les faire apparaître dans notre graphique précédent.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="#cb424-1"></a>data_europe<span class="op">$</span>borne_basse &lt;-<span class="st"> </span>data_europe<span class="op">$</span>CO2t_hab <span class="op">-</span><span class="st"> </span><span class="fl">0.1</span> <span class="op">*</span><span class="st"> </span>data_europe<span class="op">$</span>CO2t_hab</span>
<span id="cb424-2"><a href="#cb424-2"></a>data_europe<span class="op">$</span>borne_haute &lt;-<span class="st"> </span>data_europe<span class="op">$</span>CO2t_hab <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span> <span class="op">*</span><span class="st"> </span>data_europe<span class="op">$</span>CO2t_hab</span>
<span id="cb424-3"><a href="#cb424-3"></a></span>
<span id="cb424-4"><a href="#cb424-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_europe)<span class="op">+</span></span>
<span id="cb424-5"><a href="#cb424-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> an, <span class="dt">y =</span> CO2t_hab, <span class="dt">color =</span> Country.Name), <span class="dt">size =</span> <span class="fl">0.7</span>)<span class="op">+</span></span>
<span id="cb424-6"><a href="#cb424-6"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> an, <span class="dt">ymin =</span> borne_basse, <span class="dt">ymax =</span> borne_haute, <span class="dt">color =</span> Country.Name))<span class="op">+</span></span>
<span id="cb424-7"><a href="#cb424-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Années&quot;</span>,</span>
<span id="cb424-8"><a href="#cb424-8"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb424-9"><a href="#cb424-9"></a>       <span class="dt">color =</span> <span class="st">&quot;Pays&quot;</span>,</span>
<span id="cb424-10"><a href="#cb424-10"></a>       <span class="dt">title =</span> <span class="st">&#39;Évolution de la production de CO2 par habitant&#39;</span>) <span class="op">+</span></span>
<span id="cb424-11"><a href="#cb424-11"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> x_ticks, <span class="dt">labels =</span> x_ticks)<span class="op">+</span></span>
<span id="cb424-12"><a href="#cb424-12"></a><span class="st">  </span><span class="kw">theme_tufte</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig336-1.png" alt="Graphique en ligne avec barres d'erreur" width="65%" />
<p class="caption">
(#fig:fig336)Graphique en ligne avec barres d’erreur
</p>
</div>
<p>Ces barres d’erreurs indiquent notamment qu’il n’y a finalement aucun écart significatif entre la Belgique, les Pays-Bas et l’Allemagne à partir des années 1990. Une autre option de représentation est d’utiliser des polygones avec la fonction <code>geom_ribbon</code>.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_europe)<span class="op">+</span></span>
<span id="cb425-2"><a href="#cb425-2"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> an, <span class="dt">y =</span> CO2t_hab, <span class="dt">color =</span> Country.Name), <span class="dt">size =</span> <span class="fl">0.7</span>)<span class="op">+</span></span>
<span id="cb425-3"><a href="#cb425-3"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> an, <span class="dt">ymin =</span> borne_basse, <span class="dt">ymax =</span> borne_haute,</span>
<span id="cb425-4"><a href="#cb425-4"></a>                  <span class="dt">fill =</span> Country.Name), <span class="dt">alpha =</span> <span class="fl">0.4</span>)<span class="op">+</span></span>
<span id="cb425-5"><a href="#cb425-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Années&quot;</span>,</span>
<span id="cb425-6"><a href="#cb425-6"></a>       <span class="dt">y =</span> <span class="st">&#39;Tonnes de CO2 annuelle / habitant&#39;</span>,</span>
<span id="cb425-7"><a href="#cb425-7"></a>       <span class="dt">color =</span> <span class="st">&quot;Pays&quot;</span>,</span>
<span id="cb425-8"><a href="#cb425-8"></a>       <span class="dt">title =</span> <span class="st">&#39;Évolution de la production de CO2 par habitant&#39;</span>) <span class="op">+</span></span>
<span id="cb425-9"><a href="#cb425-9"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> x_ticks, <span class="dt">labels =</span> x_ticks)<span class="op">+</span></span>
<span id="cb425-10"><a href="#cb425-10"></a><span class="st">  </span><span class="kw">theme_tufte</span>()<span class="op">+</span></span>
<span id="cb425-11"><a href="#cb425-11"></a><span class="st">  </span><span class="kw">guides</span>( <span class="dt">fill =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig337-1.png" alt="Graphique en ligne avec marge d'erreur" width="65%" />
<p class="caption">
(#fig:fig337)Graphique en ligne avec marge d’erreur
</p>
</div>
<p>Le message du graphique est le même. Notez que nous avons utilisé ici la fonction <code>guides</code> pour retirer de la légende les couleurs associées au remplissage des marges d’erreur. Ces couleurs sont les mêmes que celles des lignes et il n’est pas utile de dédoubler la légende. De nombreuses méthodes statistiques produisent des résultats accompagnés d’une mesure de l’incertitude associée à ces résultats. Représenter cette incertitude est crucial pour que le lecteur puisse délimiter la portée des conclusions de vos analyses.</p>
</div>
</div>
<div id="sect0325" class="section level3">
<h3><span class="header-section-number">3.2.5</span> Boîtes à moustaches</h3>
<p>Les boîtes à moustaches (<em>box plot</em> en anglais) sont des graphiques permettant de comparer les moyennes et les intervalles interquartiles d’une variable continue selon plusieurs groupes d’une population. Si nous reprenons notre exemple précédent, nous pourrions comparer, en fonction de la région du monde, la moyenne de production annuelle de CO<sub>2</sub> par habitant. Pour cela, il suffit d’utiliser la fonction <code>geom_boxplot</code>.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1"></a><span class="co">#retirer les observations n&#39;étant pas associées à une région</span></span>
<span id="cb426-2"><a href="#cb426-2"></a>data_co2_comp &lt;-<span class="st"> </span><span class="kw">subset</span>(data_co2, <span class="kw">is.na</span>(data_co2<span class="op">$</span>region7) <span class="op">==</span><span class="st"> </span>F)</span>
<span id="cb426-3"><a href="#cb426-3"></a></span>
<span id="cb426-4"><a href="#cb426-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2_comp)<span class="op">+</span></span>
<span id="cb426-5"><a href="#cb426-5"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> region7, <span class="dt">x =</span> CO2t_hab))<span class="op">+</span></span>
<span id="cb426-6"><a href="#cb426-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Tonnes de CO2 par an et habitant&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Région&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig338-1.png" alt="Boîtes à moustaches" width="65%" />
<p class="caption">
(#fig:fig338)Boîtes à moustaches
</p>
</div>
<p>La barre centrale d’une boîte représente la moyenne. Les extrémités de la boîte représentent le premier et le troisième quartile. Plus une boîte est allongée, plus les situations sont diversifiées pour les observations appartenant au groupe représenté par la boîte. Au contraire, une boîte étroite indique un groupe homogène. Notez qu’en inversant les variables dans les axes <em>X</em> et <em>Y</em>, nous obtiendrions des boîtes à moustaches verticales. Cependant, les noms des régions étant assez longs, cela nécessiterait d’avoir un graphique très large. Améliorons quelque peu le rendu de ce graphique en ajoutant des titres.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2_comp)<span class="op">+</span></span>
<span id="cb427-2"><a href="#cb427-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> region7, <span class="dt">x =</span> CO2t_hab))<span class="op">+</span></span>
<span id="cb427-3"><a href="#cb427-3"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))<span class="op">+</span></span>
<span id="cb427-4"><a href="#cb427-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Tonnes de CO2 par an et habitant&quot;</span>,</span>
<span id="cb427-5"><a href="#cb427-5"></a>       <span class="dt">y =</span> <span class="st">&#39;Région&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig339-1.png" alt="Boîtes à moustaches améliorées" width="65%" />
<p class="caption">
(#fig:fig339)Boîtes à moustaches améliorées
</p>
</div>
<p>Les points noirs sur le graphique représentent des valeurs extrêmes, soit des observations situées à plus de 1,5 intervalle interquartile d’une extrémité de la boîte. Pour mieux rendre compte de la densité d’observations le long de chaque boîte à moustaches, il est possible de les représenter directement avec la fonction <code>geom_jitter</code>.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig340-1.png" alt="Boîtes à moustaches avec observations" width="65%" />
<p class="caption">
(#fig:fig340)Boîtes à moustaches avec observations
</p>
</div>
<p>Notez que pour éviter que les valeurs extrêmes identifiées par la fonction <code>geom_boxplot</code> se superposent avec les points représentant les observations, nous les avons supprimées avec l’argument <code>outlier.shape = NA</code>.</p>
</div>
<div id="sect0326" class="section level3">
<h3><span class="header-section-number">3.2.6</span> Graphique en violon</h3>
<p>Les boîtes à moustaches donnent des informations pertinentes sur le centre et la dispersion d’une variable en fonction de sous groupes de la population. Cependant, une grande partie de l’information reste masquée par la représentation sous forme de boîte. Une alternative est de remplacer la simple boîte par la distribution de la variable étudiée. Nous obtenons ainsi des graphiques en violon (<code>geom_violin</code>). Considérant les très grands écarts entre les régions que nous avons observés avec les boîtes à moustaches, il est préférable de tracer les graphiques en violon en excluant les régions Afrique Sub-Saharienne et Asie du Sud.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1"></a><span class="co"># retirons les observations de régions que nous ne souhaitons par garder</span></span>
<span id="cb428-2"><a href="#cb428-2"></a>data_co2_comp &lt;-<span class="st"> </span><span class="kw">subset</span>(data_co2, (<span class="op">!</span><span class="st"> </span>data_co2<span class="op">$</span>region7 <span class="op">%in%</span><span class="st"> </span></span>
<span id="cb428-3"><a href="#cb428-3"></a><span class="st">                                     </span><span class="kw">c</span>(<span class="st">&quot;Sub-Saharan Africa&quot;</span>, <span class="st">&quot;South Asia&quot;</span>)) </span>
<span id="cb428-4"><a href="#cb428-4"></a>                        <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(data_co2<span class="op">$</span>region7)<span class="op">==</span><span class="ot">FALSE</span>)</span>
<span id="cb428-5"><a href="#cb428-5"></a></span>
<span id="cb428-6"><a href="#cb428-6"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2_comp)<span class="op">+</span></span>
<span id="cb428-7"><a href="#cb428-7"></a><span class="st">  </span><span class="kw">geom_violin</span>(<span class="kw">aes</span>(<span class="dt">y =</span> region7,<span class="dt">x =</span> CO2t_hab))<span class="op">+</span></span>
<span id="cb428-8"><a href="#cb428-8"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))<span class="op">+</span></span>
<span id="cb428-9"><a href="#cb428-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Tonnes de CO2 annuelle / habitant&quot;</span>,</span>
<span id="cb428-10"><a href="#cb428-10"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>)<span class="op">+</span></span>
<span id="cb428-11"><a href="#cb428-11"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">12</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>, <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig341-1.png" alt="Graphiques en violon" width="65%" />
<p class="caption">
(#fig:fig341)Graphiques en violon
</p>
</div>
<p>Ces distributions permettent notamment de souligner que deux groupes distincts se retrouvent en Amérique du Nord. L’un dont les émissions annuelles de CO<sub>2</sub> par habitant sont inférieures à 12 tonnes (ligne bleue) et un autre groupe pour lequel elles sont supérieures. En explorant les données, nous constatons que les Bermudes appartiennent au groupe Amérique du Nord, mais ont des niveaux d’émission inférieurs à ceux du Canada et des États-Unis, ce qui explique cette distribution bimodale. Cette information était masquée avec les boîtes à moustaches. Finalement, il est aussi possible de superposer graphique en violon et boîte à moustaches pour bénéficier des avantages des deux.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_co2_comp)<span class="op">+</span></span>
<span id="cb429-2"><a href="#cb429-2"></a><span class="st">  </span><span class="kw">geom_violin</span>(<span class="kw">aes</span>(<span class="dt">y =</span> region7,<span class="dt">x =</span> CO2t_hab))<span class="op">+</span></span>
<span id="cb429-3"><a href="#cb429-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> region7,<span class="dt">x =</span> CO2t_hab), <span class="dt">width =</span> <span class="fl">0.15</span>)<span class="op">+</span></span>
<span id="cb429-4"><a href="#cb429-4"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))<span class="op">+</span></span>
<span id="cb429-5"><a href="#cb429-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Tonnes de CO2 annuelle / habitant&quot;</span>,</span>
<span id="cb429-6"><a href="#cb429-6"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig342-1.png" alt="Graphiques en violon et boîtes à moustaches" width="65%" />
<p class="caption">
(#fig:fig342)Graphiques en violon et boîtes à moustaches
</p>
</div>
</div>
<div id="sect0327" class="section level3">
<h3><span class="header-section-number">3.2.7</span> Graphique en barre</h3>
<p>Les graphiques en barre permettent de représenter des quantités (hauteur des barres) réparties dans des catégories (une barre par catégorie). Nous proposons ici un exemple avec des données de déplacements issues de l’<em>enquête origine destination de Communauté urbaine de 2017</em> au niveau des grands secteurs. La figure @ref(fig:fig342) tirée du <a href="https://www.transports.gouv.qc.ca/fr/ministere/Planification-transports/enquetes-origine-destination/quebec/2017/Documents/EOD17_faits_saillants_VF.pdf">rapport</a> intitulé <em>La mobilité des personnes dans la région de Québec-Lévis (Volet Enquête-ménages. Faits saillants)</em> délimite ces grands secteurs.</p>
<div class="figure" style="text-align: center">
<img src="images/magie_graphiques/carte_secteurs.jpg" alt="Grands secteurs de Québec" width="60%" />
<p class="caption">
(#fig:fig343)Grands secteurs de Québec
</p>
</div>
<p>Nous représentons pour chaque secteur le nombre déplacements moyen entrant et sortant un jour de semaine en heures de pointe. Les données sont présentées sous forme d’une matrice carrée (avec autant de lignes que de colonnes). L’intersection de la ligne A et de la colonne C indique le nombre de personnes partant du secteur A pour se rendre dans le secteur C. À l’inverse, l’intersection de la ligne C et de la colonne A indique le nombre de personnes partant du secteur C pour se rendre dans le secteur A. En sommant les valeurs de chaque ligne, nous obtienons le nombre total de départs par secteur tandis que le nombre d’arrivées est la somme de chaque colonne. Ces opérations peuvent simplement être effectuées avec les fonctions <code>rowSums</code> et <code>colSums</code>.</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1"></a><span class="co"># Chargement des donneées</span></span>
<span id="cb430-2"><a href="#cb430-2"></a>matriceOD &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/graphique/Quebec_2017_OD_MJ.csv&#39;</span>,</span>
<span id="cb430-3"><a href="#cb430-3"></a>                 <span class="dt">header =</span> <span class="ot">FALSE</span>, <span class="dt">sep =</span> <span class="st">&#39;;&#39;</span>) <span class="co"># fichier csv sans entête</span></span>
<span id="cb430-4"><a href="#cb430-4"></a></span>
<span id="cb430-5"><a href="#cb430-5"></a><span class="co"># Calcul des sommes en lignes et en colonnes</span></span>
<span id="cb430-6"><a href="#cb430-6"></a>tot_depart &lt;-<span class="st"> </span><span class="kw">rowSums</span>(matriceOD)</span>
<span id="cb430-7"><a href="#cb430-7"></a>tot_arrivee &lt;-<span class="st"> </span><span class="kw">colSums</span>(matriceOD)</span>
<span id="cb430-8"><a href="#cb430-8"></a></span>
<span id="cb430-9"><a href="#cb430-9"></a><span class="co"># Création d&#39;un DataFrame avec les valeurs et les noms des secteurs</span></span>
<span id="cb430-10"><a href="#cb430-10"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">depart =</span> tot_depart,</span>
<span id="cb430-11"><a href="#cb430-11"></a>                 <span class="dt">arrivee =</span> tot_arrivee, </span>
<span id="cb430-12"><a href="#cb430-12"></a>                 <span class="dt">secteur =</span> <span class="kw">c</span>(<span class="st">&#39;Arr. de Beauport (Québec)&#39;</span>,</span>
<span id="cb430-13"><a href="#cb430-13"></a>                            <span class="st">&#39;Arr. de Charlesbourg (Québec)&#39;</span>,</span>
<span id="cb430-14"><a href="#cb430-14"></a>                            <span class="st">&#39;Arr. des Rivières (Québec)&#39;</span>,</span>
<span id="cb430-15"><a href="#cb430-15"></a>                            <span class="st">&#39;Arr. de la Cité-Limoilou (Québec)&#39;</span>,</span>
<span id="cb430-16"><a href="#cb430-16"></a>                            <span class="st">&#39;Arr. de la Haute-St-Charles (Québec)&#39;</span>,</span>
<span id="cb430-17"><a href="#cb430-17"></a>                            <span class="st">&#39;Arr. de Sainte-Foy-Sillery-Cap-Rouge (Québec)&#39;</span>,</span>
<span id="cb430-18"><a href="#cb430-18"></a>                            <span class="st">&#39;Arr.de Desjardins (Lévis)&#39;</span>,</span>
<span id="cb430-19"><a href="#cb430-19"></a>                            <span class="st">&#39;Arr. des Chutes–de-la-Chaudière-Est (Lévis)&#39;</span>,</span>
<span id="cb430-20"><a href="#cb430-20"></a>                            <span class="st">&#39;Arr. Les Chutes de la Chaudière-Ouest (Lévis)&#39;</span>,</span>
<span id="cb430-21"><a href="#cb430-21"></a>                            <span class="st">&#39;Ceinture Nord&#39;</span>,</span>
<span id="cb430-22"><a href="#cb430-22"></a>                            <span class="st">&#39;Ceinture Sud&#39;</span>,</span>
<span id="cb430-23"><a href="#cb430-23"></a>                            <span class="st">&#39;Hors Territoire&#39;</span>),</span>
<span id="cb430-24"><a href="#cb430-24"></a>                 <span class="dt">code =</span> <span class="kw">c</span>(<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>,<span class="st">&#39;E&#39;</span>,<span class="st">&#39;F&#39;</span>,<span class="st">&#39;G&#39;</span>,<span class="st">&#39;H&#39;</span>,<span class="st">&#39;I&#39;</span>,<span class="st">&#39;J&#39;</span>,<span class="st">&#39;K&#39;</span>,<span class="st">&#39;X&#39;</span>))</span>
<span id="cb430-25"><a href="#cb430-25"></a></span>
<span id="cb430-26"><a href="#cb430-26"></a><span class="co"># Création des deux graphiques en barre</span></span>
<span id="cb430-27"><a href="#cb430-27"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb430-28"><a href="#cb430-28"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> code, <span class="dt">weight =</span> depart))<span class="op">+</span></span>
<span id="cb430-29"><a href="#cb430-29"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&#39;Départs&#39;</span>,</span>
<span id="cb430-30"><a href="#cb430-30"></a>       <span class="dt">x =</span> <span class="st">&#39;total&#39;</span>,</span>
<span id="cb430-31"><a href="#cb430-31"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb430-32"><a href="#cb430-32"></a></span>
<span id="cb430-33"><a href="#cb430-33"></a>plot2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb430-34"><a href="#cb430-34"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> code, <span class="dt">weight =</span> arrivee))<span class="op">+</span></span>
<span id="cb430-35"><a href="#cb430-35"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&#39;Arrivées&#39;</span>,</span>
<span id="cb430-36"><a href="#cb430-36"></a>       <span class="dt">x =</span> <span class="st">&#39;total&#39;</span>,</span>
<span id="cb430-37"><a href="#cb430-37"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb430-38"><a href="#cb430-38"></a></span>
<span id="cb430-39"><a href="#cb430-39"></a><span class="co"># Stocker les graphiques dans une liste et composer une figure</span></span>
<span id="cb430-40"><a href="#cb430-40"></a>list_plot &lt;-<span class="st"> </span><span class="kw">list</span>(plot1, plot2)</span>
<span id="cb430-41"><a href="#cb430-41"></a>tot_plot &lt;-<span class="st"> </span><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> list_plot, <span class="dt">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb430-42"><a href="#cb430-42"></a></span>
<span id="cb430-43"><a href="#cb430-43"></a><span class="co"># Création d&#39;une légende pour associer le code de chaque secteur </span></span>
<span id="cb430-44"><a href="#cb430-44"></a><span class="co"># à son nom. Pour cela nous concaténons en premier les lettres et les noms.</span></span>
<span id="cb430-45"><a href="#cb430-45"></a><span class="co"># Nous fusionons ensuite le tout en les séparant par le symbole \n représentant </span></span>
<span id="cb430-46"><a href="#cb430-46"></a><span class="co"># un saut de ligne.</span></span>
<span id="cb430-47"><a href="#cb430-47"></a>nom_secteurs &lt;-<span class="st"> </span><span class="kw">paste</span>(df<span class="op">$</span>code, df<span class="op">$</span>secteur, <span class="dt">sep=</span> <span class="st">&#39; : &#39;</span>)</span>
<span id="cb430-48"><a href="#cb430-48"></a>string_names &lt;-<span class="st"> </span><span class="kw">paste</span>(nom_secteurs, <span class="dt">collapse =</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb430-49"><a href="#cb430-49"></a></span>
<span id="cb430-50"><a href="#cb430-50"></a>titre &lt;-<span class="st"> &quot;Déplacements journaliers moyens en heures de pointe&quot;</span></span>
<span id="cb430-51"><a href="#cb430-51"></a><span class="co"># Production finale de la figure</span></span>
<span id="cb430-52"><a href="#cb430-52"></a><span class="kw">annotate_figure</span>(tot_plot,</span>
<span id="cb430-53"><a href="#cb430-53"></a>                <span class="dt">top =</span> <span class="kw">text_grob</span>(titre, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="dv">11</span>, <span class="dt">just =</span> <span class="st">&quot;left&quot;</span>),</span>
<span id="cb430-54"><a href="#cb430-54"></a>                <span class="dt">right =</span> <span class="kw">text_grob</span>(string_names, <span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="dt">size =</span> <span class="dv">8</span>,</span>
<span id="cb430-55"><a href="#cb430-55"></a>                                  <span class="dt">just =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">x =</span> <span class="fl">0.05</span>) <span class="co"># position du texte</span></span>
<span id="cb430-56"><a href="#cb430-56"></a>                )</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig344-1.png" alt="Graphiques en barre simples" width="75%" />
<p class="caption">
(#fig:fig344)Graphiques en barre simples
</p>
</div>
<p>Plutôt que de représenter les arrivées et les départs dans deux graphiques séparés, il est possible de les empiler dans un même graphique en barre. Nous devons au préalable « faire fondre nos données » avec la fonction <code>melt</code>.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1"></a><span class="co"># Faire fondre le jeu de données (empiler les colonnes depart et arrivee)</span></span>
<span id="cb431-2"><a href="#cb431-2"></a>melted_df &lt;-<span class="st"> </span><span class="kw">melt</span>(df, <span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">&#39;code&#39;</span>), <span class="dt">measure.vars =</span> <span class="kw">c</span>(<span class="st">&#39;depart&#39;</span>,<span class="st">&#39;arrivee&#39;</span>))</span>
<span id="cb431-3"><a href="#cb431-3"></a><span class="kw">names</span>(melted_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;code&#39;</span>,<span class="st">&#39;deplacement&#39;</span>,<span class="st">&#39;effectif&#39;</span>)</span>
<span id="cb431-4"><a href="#cb431-4"></a><span class="co"># Ajouter les accents dans la colonne déplacement</span></span>
<span id="cb431-5"><a href="#cb431-5"></a>melted_df<span class="op">$</span>deplacement &lt;-<span class="st"> </span><span class="kw">ifelse</span>(melted_df<span class="op">$</span>deplacement <span class="op">==</span><span class="st"> &#39;depart&#39;</span>, <span class="st">&#39;départs&#39;</span>, <span class="st">&#39;arrivées&#39;</span>)</span>
<span id="cb431-6"><a href="#cb431-6"></a></span>
<span id="cb431-7"><a href="#cb431-7"></a><span class="co"># Comparaison du format original et du format &quot;fondu&quot;</span></span>
<span id="cb431-8"><a href="#cb431-8"></a><span class="kw">head</span>(df)</span></code></pre></div>
<pre><code>##    depart arrivee                                       secteur code
## V1  49241   34777                     Arr. de Beauport (Québec)    A
## V2  48909   36344                 Arr. de Charlesbourg (Québec)    B
## V3  48044   67198                    Arr. des Rivières (Québec)    C
## V4  63132  108138             Arr. de la Cité-Limoilou (Québec)    D
## V5  57367   30859          Arr. de la Haute-St-Charles (Québec)    E
## V6  86504  112379 Arr. de Sainte-Foy-Sillery-Cap-Rouge (Québec)    F</code></pre>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1"></a><span class="kw">head</span>(melted_df)</span></code></pre></div>
<pre><code>##   code deplacement effectif
## 1    A     départs    49241
## 2    B     départs    48909
## 3    C     départs    48044
## 4    D     départs    63132
## 5    E     départs    57367
## 6    F     départs    86504</code></pre>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="#cb435-1"></a><span class="co"># Réalisation du graphique</span></span>
<span id="cb435-2"><a href="#cb435-2"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> melted_df)<span class="op">+</span></span>
<span id="cb435-3"><a href="#cb435-3"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> code,<span class="dt">weight =</span> effectif, <span class="dt">fill =</span> deplacement),<span class="dt">color =</span> <span class="st">&#39;#e3e3e3&#39;</span>)<span class="op">+</span></span>
<span id="cb435-4"><a href="#cb435-4"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#e63946&quot;</span>,<span class="st">&quot;#1d3557&quot;</span>))<span class="op">+</span></span>
<span id="cb435-5"><a href="#cb435-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> titre,</span>
<span id="cb435-6"><a href="#cb435-6"></a>       <span class="dt">y =</span> <span class="st">&#39;Effectifs&#39;</span>,</span>
<span id="cb435-7"><a href="#cb435-7"></a>       <span class="dt">x =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb435-8"><a href="#cb435-8"></a>       <span class="dt">fill =</span> <span class="st">&#39;Déplacements&#39;</span>)</span>
<span id="cb435-9"><a href="#cb435-9"></a></span>
<span id="cb435-10"><a href="#cb435-10"></a><span class="kw">annotate_figure</span>(plot1,<span class="dt">right =</span> <span class="kw">text_grob</span>(string_names, <span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="dt">size =</span> <span class="dv">7</span>,</span>
<span id="cb435-11"><a href="#cb435-11"></a>                                  <span class="dt">just =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">x =</span> <span class="fl">0.05</span>)) <span class="co"># position du texte)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig345-1.png" alt="Graphique en barre empilées" width="65%" />
<p class="caption">
(#fig:fig345)Graphique en barre empilées
</p>
</div>
</div>
<div id="sect0328" class="section level3">
<h3><span class="header-section-number">3.2.8</span> Graphique circulaire</h3>
<p>Une alternative directe au graphique en barre est le graphique ou diagramme circulaire, appelé aussi graphique en pointes de tarte (pour les personnes à la dent sucrée) ou en camembert (pour celles amatrices de fromage). Il est suffissamment connu et utilisé pour qu’aucune présentation ne s’impose. Pour être exact, un graphique en pointes de tarte n’est rien d’autre qu’un graphique en barre dont le système de coordonnées a été modifié. Cela impose cependant de calculer à l’avance la position des étiquettes que nous souhaitons ajouter sur le graphique. Reprenons les données de production mondiale de CO<sub>2</sub> et calculons les productions totales par région géographique en 2015.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb436-2"><a href="#cb436-2"></a></span>
<span id="cb436-3"><a href="#cb436-3"></a><span class="co"># Extraire les données de 2018 pour lesquelles nous connaissons la région</span></span>
<span id="cb436-4"><a href="#cb436-4"></a>data_co2_<span class="dv">2015</span> &lt;-<span class="st"> </span><span class="kw">subset</span>(data_co2,data_co2<span class="op">$</span>year <span class="op">==</span><span class="st"> &quot;2015&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="st"> </span><span class="kw">is.na</span>(data_co2<span class="op">$</span>region7))</span>
<span id="cb436-5"><a href="#cb436-5"></a></span>
<span id="cb436-6"><a href="#cb436-6"></a><span class="co"># Effectuer la somme du CO2 par région</span></span>
<span id="cb436-7"><a href="#cb436-7"></a>co2_<span class="dv">2015</span> &lt;-<span class="st"> </span>data_co2_<span class="dv">2015</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb436-8"><a href="#cb436-8"></a><span class="st">  </span><span class="kw">group_by</span>(region7) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb436-9"><a href="#cb436-9"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_co2 =</span> <span class="kw">sum</span>(CO2_kt,<span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb436-10"><a href="#cb436-10"></a></span>
<span id="cb436-11"><a href="#cb436-11"></a><span class="co"># Attribuer un code à chaque région pour faciliter la lecture</span></span>
<span id="cb436-12"><a href="#cb436-12"></a>co2_<span class="dv">2015</span><span class="op">$</span>code &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;E&quot;</span>,<span class="st">&quot;F&quot;</span>,<span class="st">&quot;G&quot;</span>)</span>
<span id="cb436-13"><a href="#cb436-13"></a></span>
<span id="cb436-14"><a href="#cb436-14"></a><span class="co"># Modifier l&#39;ordre des données, calculer les proportions et la position des labels</span></span>
<span id="cb436-15"><a href="#cb436-15"></a>df &lt;-<span class="st"> </span>co2_<span class="dv">2015</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb436-16"><a href="#cb436-16"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(code)) <span class="op">%&gt;%</span></span>
<span id="cb436-17"><a href="#cb436-17"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> total_co2 <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(co2_<span class="dv">2015</span><span class="op">$</span>total_co2) <span class="op">*</span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb436-18"><a href="#cb436-18"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ypos =</span> <span class="kw">cumsum</span>(prop)<span class="op">-</span><span class="st"> </span><span class="fl">0.5</span><span class="op">*</span>prop )</span>
<span id="cb436-19"><a href="#cb436-19"></a></span>
<span id="cb436-20"><a href="#cb436-20"></a><span class="co"># Préparer la légende (pourcentages et vrais noms)</span></span>
<span id="cb436-21"><a href="#cb436-21"></a>nom_region &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">paste</span>(df<span class="op">$</span>code, <span class="st">&quot; : &quot;</span>, df<span class="op">$</span>region7, <span class="st">&quot;(&quot;</span>, <span class="kw">round</span>(df<span class="op">$</span>prop,<span class="dv">1</span>),<span class="st">&quot;%)&quot;</span>))</span>
<span id="cb436-22"><a href="#cb436-22"></a>string_region &lt;-<span class="st"> </span><span class="kw">paste</span>(nom_region, <span class="dt">collapse =</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb436-23"><a href="#cb436-23"></a></span>
<span id="cb436-24"><a href="#cb436-24"></a><span class="co"># Construire le graphique</span></span>
<span id="cb436-25"><a href="#cb436-25"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span>prop, <span class="dt">fill=</span>code)) <span class="op">+</span></span>
<span id="cb436-26"><a href="#cb436-26"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">width=</span><span class="dv">1</span>, <span class="dt">color=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb436-27"><a href="#cb436-27"></a><span class="st">  </span><span class="kw">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="dt">start=</span><span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb436-28"><a href="#cb436-28"></a><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb436-29"><a href="#cb436-29"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="op">+</span></span>
<span id="cb436-30"><a href="#cb436-30"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ypos, <span class="dt">label =</span> code), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb436-31"><a href="#cb436-31"></a><span class="st">  </span><span class="kw">scale_fill_grey</span>()<span class="op">+</span></span>
<span id="cb436-32"><a href="#cb436-32"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Proportion du CO2 émis en 2015&quot;</span>)</span>
<span id="cb436-33"><a href="#cb436-33"></a></span>
<span id="cb436-34"><a href="#cb436-34"></a><span class="co"># Ajouter la légende</span></span>
<span id="cb436-35"><a href="#cb436-35"></a><span class="kw">annotate_figure</span>(plot1,<span class="dt">right =</span> <span class="kw">text_grob</span>(string_region, <span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="dt">size =</span> <span class="dv">9</span>,</span>
<span id="cb436-36"><a href="#cb436-36"></a>                                  <span class="dt">just =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">x =</span> <span class="fl">0.05</span>)) <span class="co"># position du texte)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig346-1.png" alt="Graphique en pointes de tarte" width="65%" />
<p class="caption">
(#fig:fig346)Graphique en pointes de tarte
</p>
</div>
<p>Si à la place de la géométrie <code>geom_bar</code>, vous utilisez <code>geom_rect</code>, vous pouvez convertir votre graphique en pointes de tarte en graphique en anneau (ou en beigne, pour les personnes à la dent sucrée) :</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="#cb437-1"></a><span class="co"># Calculer la limite inférieure et supérieure du beigne</span></span>
<span id="cb437-2"><a href="#cb437-2"></a>df<span class="op">$</span>ymax &lt;-<span class="st"> </span><span class="kw">cumsum</span>(df<span class="op">$</span>prop)</span>
<span id="cb437-3"><a href="#cb437-3"></a>df<span class="op">$</span>ymin &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">head</span>(df<span class="op">$</span>ymax, <span class="dt">n=</span><span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb437-4"><a href="#cb437-4"></a></span>
<span id="cb437-5"><a href="#cb437-5"></a><span class="co"># Construire le graphique</span></span>
<span id="cb437-6"><a href="#cb437-6"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">ymax=</span>ymax, <span class="dt">ymin=</span>ymin, </span>
<span id="cb437-7"><a href="#cb437-7"></a>                        <span class="dt">xmax=</span><span class="dv">4</span>, <span class="dt">xmin=</span><span class="dv">3</span>,</span>
<span id="cb437-8"><a href="#cb437-8"></a>                        <span class="dt">y=</span>prop, <span class="dt">fill=</span>code)) <span class="op">+</span></span>
<span id="cb437-9"><a href="#cb437-9"></a><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">color=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb437-10"><a href="#cb437-10"></a><span class="st">  </span><span class="kw">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="dt">start=</span><span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb437-11"><a href="#cb437-11"></a><span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb437-12"><a href="#cb437-12"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="op">+</span></span>
<span id="cb437-13"><a href="#cb437-13"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="fl">3.5</span>,<span class="dt">y =</span> ypos, <span class="dt">label =</span> code), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb437-14"><a href="#cb437-14"></a><span class="st">  </span><span class="kw">scale_fill_grey</span>()<span class="op">+</span></span>
<span id="cb437-15"><a href="#cb437-15"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>))<span class="op">+</span></span>
<span id="cb437-16"><a href="#cb437-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Proportion du CO2 émis en 2015&quot;</span>)</span>
<span id="cb437-17"><a href="#cb437-17"></a></span>
<span id="cb437-18"><a href="#cb437-18"></a><span class="co"># Ajouter la légende</span></span>
<span id="cb437-19"><a href="#cb437-19"></a><span class="kw">annotate_figure</span>(plot1,<span class="dt">right =</span> <span class="kw">text_grob</span>(string_region, <span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="dt">size =</span> <span class="dv">8</span>,</span>
<span id="cb437-20"><a href="#cb437-20"></a>                                  <span class="dt">just =</span> <span class="st">&quot;left&quot;</span>, <span class="dt">x =</span> <span class="fl">0.05</span>)) <span class="co"># position du texte)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig347-1.png" alt="Graphique en anneau" width="65%" />
<p class="caption">
(#fig:fig347)Graphique en anneau
</p>
</div>
</div>
</div>
<div id="sect033" class="section level2">
<h2><span class="header-section-number">3.3</span> Graphiques spéciaux</h2>
<p>Dans cette dernière section, nous allons aborder des graphiques plus rarement utilisés. Ils sont toutefois très utiles dans certains contextes du fait de leur capacité à synthétiser des informations complexes.</p>
<div id="sect0331" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Graphique en radar</h3>
<p>Les graphiques en radar (ou en toile d’araignée) sont utilisés pour comparer une série de variables continues pour plusieurs observations ou groupes d’observations. Chaque variable est associée à un axe et chaque observation est représentée avec un polygone. Prenons l’exemple de données relatives aux logements par secteur de recensement dans la région métropolitaine de Montréal en 2016. Nous pourrions souhaiter comparer la moyenne des pourcentages des différents types de logements pour les régions des Laurentides, de la Montérégie, de Laval, de Longueuil et de Montréal. Malheureusement, <code>ggplot2</code> ne permet pas de dessiner des graphiques en radar satisfaisants, nous devrons donc utiliser le <em>package</em> <code>fmsb</code>.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1"></a><span class="kw">library</span>(fmsb)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;fmsb&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:DescTools&#39;:
## 
##     CronbachAlpha, VIF</code></pre>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="#cb441-1"></a>data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/bivariee/sr_rmr_mtl_2016.csv&#39;</span>, <span class="dt">header =</span> T, <span class="dt">encoding =</span> <span class="st">&#39;UTF-8&#39;</span>)</span>
<span id="cb441-2"><a href="#cb441-2"></a></span>
<span id="cb441-3"><a href="#cb441-3"></a><span class="co"># Agréger les données au niveau des régions en calculant la moyenne des pourcentages</span></span>
<span id="cb441-4"><a href="#cb441-4"></a>variables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MaisonIndi&quot;</span>,<span class="st">&quot;App5Plus&quot;</span>,<span class="st">&quot;MaisRangee&quot;</span>,<span class="st">&quot;AppDuplex&quot;</span>,<span class="st">&quot;Proprio&quot;</span>,<span class="st">&quot;Locataire&quot;</span>)</span>
<span id="cb441-5"><a href="#cb441-5"></a></span>
<span id="cb441-6"><a href="#cb441-6"></a>data_region &lt;-<span class="st"> </span>data[<span class="kw">c</span>(<span class="st">&quot;Region&quot;</span>,variables)] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb441-7"><a href="#cb441-7"></a><span class="st">  </span><span class="kw">group_by</span>(Region) <span class="op">%&gt;%</span></span>
<span id="cb441-8"><a href="#cb441-8"></a><span class="st">  </span><span class="kw">summarise_all</span>(<span class="dt">.funs =</span> <span class="kw">list</span>(mean))</span>
<span id="cb441-9"><a href="#cb441-9"></a></span>
<span id="cb441-10"><a href="#cb441-10"></a><span class="co"># Gérer le nom des colonnes pour ajuster les données aux besoins de </span></span>
<span id="cb441-11"><a href="#cb441-11"></a><span class="co"># la fonction radachart</span></span>
<span id="cb441-12"><a href="#cb441-12"></a>new_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Region&quot;</span>,<span class="kw">paste</span>(variables,<span class="st">&quot;_mean&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb441-13"><a href="#cb441-13"></a><span class="kw">names</span>(data_region) &lt;-<span class="st"> </span>new_names</span>
<span id="cb441-14"><a href="#cb441-14"></a>data_region &lt;-<span class="st"> </span><span class="kw">data.frame</span>(data_region)</span>
<span id="cb441-15"><a href="#cb441-15"></a><span class="kw">rownames</span>(data_region) &lt;-<span class="st"> </span>data_region<span class="op">$</span>Region</span>
<span id="cb441-16"><a href="#cb441-16"></a>data_region<span class="op">$</span>Region &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb441-17"><a href="#cb441-17"></a></span>
<span id="cb441-18"><a href="#cb441-18"></a><span class="co"># Ajouter deux lignes aux données avec les valeurs maximales et minimales </span></span>
<span id="cb441-19"><a href="#cb441-19"></a><span class="co"># de chaque colonne. Ces informations aideront la fonction radachart à</span></span>
<span id="cb441-20"><a href="#cb441-20"></a><span class="co"># dessiner chacun des axes du radar</span></span>
<span id="cb441-21"><a href="#cb441-21"></a>data_chart &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">apply</span>(data_region,<span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> max),</span>
<span id="cb441-22"><a href="#cb441-22"></a>                    <span class="kw">apply</span>(data_region,<span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> min),</span>
<span id="cb441-23"><a href="#cb441-23"></a>                    data_region</span>
<span id="cb441-24"><a href="#cb441-24"></a>                    )</span>
<span id="cb441-25"><a href="#cb441-25"></a></span>
<span id="cb441-26"><a href="#cb441-26"></a><span class="co"># Choisir les couleurs pour l&#39;intérieur des polygones (avec transparence)</span></span>
<span id="cb441-27"><a href="#cb441-27"></a>couleurs &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb441-28"><a href="#cb441-28"></a>  <span class="kw">rgb</span>(<span class="fl">0.94</span>, <span class="fl">0.28</span>, <span class="fl">0.44</span>, <span class="fl">0.25</span>),</span>
<span id="cb441-29"><a href="#cb441-29"></a>  <span class="kw">rgb</span>(<span class="fl">1.00</span>, <span class="fl">0.82</span>, <span class="fl">0.40</span>, <span class="fl">0.25</span>),</span>
<span id="cb441-30"><a href="#cb441-30"></a>  <span class="kw">rgb</span>(<span class="fl">0.02</span>, <span class="fl">0.84</span>, <span class="fl">0.63</span>, <span class="fl">0.25</span>),</span>
<span id="cb441-31"><a href="#cb441-31"></a>  <span class="kw">rgb</span>(<span class="fl">0.07</span>, <span class="fl">0.54</span>, <span class="fl">0.70</span>, <span class="fl">0.25</span>),</span>
<span id="cb441-32"><a href="#cb441-32"></a>  <span class="kw">rgb</span>(<span class="fl">0.03</span>, <span class="fl">0.23</span>, <span class="fl">0.30</span>, <span class="fl">0.25</span>)</span>
<span id="cb441-33"><a href="#cb441-33"></a>)</span>
<span id="cb441-34"><a href="#cb441-34"></a></span>
<span id="cb441-35"><a href="#cb441-35"></a><span class="co"># Choisir les couleurs pour l&#39;intérieur des polygones (sans transparence)</span></span>
<span id="cb441-36"><a href="#cb441-36"></a>couleurs_contour &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb441-37"><a href="#cb441-37"></a>  <span class="kw">rgb</span>(<span class="fl">0.94</span>, <span class="fl">0.28</span>, <span class="fl">0.44</span>),</span>
<span id="cb441-38"><a href="#cb441-38"></a>  <span class="kw">rgb</span>(<span class="fl">1.00</span>, <span class="fl">0.82</span>, <span class="fl">0.40</span>),</span>
<span id="cb441-39"><a href="#cb441-39"></a>  <span class="kw">rgb</span>(<span class="fl">0.02</span>, <span class="fl">0.84</span>, <span class="fl">0.63</span>),</span>
<span id="cb441-40"><a href="#cb441-40"></a>  <span class="kw">rgb</span>(<span class="fl">0.07</span>, <span class="fl">0.54</span>, <span class="fl">0.70</span>),</span>
<span id="cb441-41"><a href="#cb441-41"></a>  <span class="kw">rgb</span>(<span class="fl">0.03</span>, <span class="fl">0.23</span>, <span class="fl">0.30</span>)</span>
<span id="cb441-42"><a href="#cb441-42"></a>)</span>
<span id="cb441-43"><a href="#cb441-43"></a></span>
<span id="cb441-44"><a href="#cb441-44"></a><span class="co"># Dessiner du graphique</span></span>
<span id="cb441-45"><a href="#cb441-45"></a><span class="kw">radarchart</span>(data_chart,</span>
<span id="cb441-46"><a href="#cb441-46"></a>           <span class="dt">title =</span> <span class="st">&quot;Comparaison des types de logements dans la RMR&quot;</span>,</span>
<span id="cb441-47"><a href="#cb441-47"></a>           <span class="dt">pcol =</span> couleurs_contour, <span class="dt">pfcol =</span> couleurs,</span>
<span id="cb441-48"><a href="#cb441-48"></a>           <span class="dt">plwd =</span> <span class="dv">2</span>, <span class="dt">plty=</span><span class="dv">1</span>,</span>
<span id="cb441-49"><a href="#cb441-49"></a>           <span class="dt">cglcol=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">cglty=</span><span class="dv">1</span>, <span class="dt">axislabcol=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">cglwd=</span><span class="fl">0.8</span>,</span>
<span id="cb441-50"><a href="#cb441-50"></a>           <span class="dt">vlcex=</span><span class="fl">0.8</span>,</span>
<span id="cb441-51"><a href="#cb441-51"></a>           <span class="dt">vlabels =</span> <span class="kw">c</span>(<span class="st">&quot;maison individuelle&quot;</span>, <span class="st">&quot;immeuble d&#39;appartements&quot;</span>,</span>
<span id="cb441-52"><a href="#cb441-52"></a>                       <span class="st">&quot;maison </span><span class="ch">\n</span><span class="st">en rangée&quot;</span>, <span class="st">&quot;duplex&quot;</span>,</span>
<span id="cb441-53"><a href="#cb441-53"></a>                       <span class="st">&quot;propriétaire&quot;</span>, <span class="st">&quot;locataire&quot;</span>)</span>
<span id="cb441-54"><a href="#cb441-54"></a>           )</span>
<span id="cb441-55"><a href="#cb441-55"></a></span>
<span id="cb441-56"><a href="#cb441-56"></a><span class="co"># Ajouter une légende</span></span>
<span id="cb441-57"><a href="#cb441-57"></a><span class="kw">legend</span>(<span class="dt">x=</span><span class="fl">1.3</span>, <span class="dt">y=</span><span class="dv">1</span>, <span class="dt">legend =</span> <span class="kw">rownames</span>(data_chart[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),]), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb441-58"><a href="#cb441-58"></a>       <span class="dt">pch=</span><span class="dv">20</span> , <span class="dt">col=</span>couleurs , <span class="dt">text.col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">cex=</span><span class="fl">0.9</span>, <span class="dt">pt.cex=</span><span class="fl">1.5</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig348-1.png" alt="Graphique en anneau" width="65%" />
<p class="caption">
(#fig:fig348)Graphique en anneau
</p>
</div>
<p>À la lecture du graphique, nous constatons rapidement que l’île de Montréal a une situation très différente des trois autres régions. Laval se distingue également avec une part importante de logements dans des immeubles d’appartements. Ce type de graphique a pour objectif d’orienter le regard sur de potentielles différences dans un contexte multidimensionnel, mais il présente quelques inconvénients :</p>
<ul>
<li>Les échelles de chaque axe sont différentes. Il est donc essentiel de se rapporter aux valeurs exactes pour estimer si les écarts sont importants en termes absolus.</li>
<li>La superposition de plusieurs polygones peut rendre la lecture difficile. Une alternative envisageable est de réaliser un graphique par polygone, mais cela prend beaucoup de place dans un document.</li>
<li>L’utilisation de polygones donne parfois de fausses impressions d’écarts. Dans le précédent graphique, l’œil est attiré en bas à gauche par le polygone de Montréal très différent des autres. Cependant, les écarts sur l’axe <em>maison en rangée</em> sont relativement petit comparativement à l’axe <em>locataire</em> situé à l’opposé.</li>
</ul>
</div>
<div id="sect0332" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Diagramme d’accord</h3>
<p>Les diagrammes d’accord (<em>chord diagram</em> en anglais) sont utilisés pour représenter des échanges ou des connexions entre des entités. Il peut s’agir par exemple de marchandises importées / exportées entre pays, des messages envoyés entre personnes via un réseau social, de flux de population, etc. Reprenons nos données de l’<em>enquête origine destination de la région de Québec en 2017</em> pour illustrer le tout. Nous utiliserons le <em>package</em> <code>chorddiag</code>, très facile d’utilisation et produisant des graphiques interactifs, facilitant grandement la lecture de ce type de graphique. Cependant ce <em>package</em> ne fait pas partie du répertoire <em>CRAN</em>, nous devrons l’installer directement depuis <em>github</em> avec la fonction <code>devtools::install_github</code>.</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1"></a>devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&#39;mattflor/chorddiag&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1"></a><span class="kw">library</span>(chorddiag)</span>
<span id="cb443-2"><a href="#cb443-2"></a></span>
<span id="cb443-3"><a href="#cb443-3"></a><span class="co"># Chargement des données</span></span>
<span id="cb443-4"><a href="#cb443-4"></a>matriceOD &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/graphique/Quebec_2017_OD_MJ.csv&#39;</span>,</span>
<span id="cb443-5"><a href="#cb443-5"></a>                 <span class="dt">header =</span> <span class="ot">FALSE</span>, <span class="dt">sep =</span> <span class="st">&#39;;&#39;</span>) <span class="co"># fichier csv sans entête</span></span>
<span id="cb443-6"><a href="#cb443-6"></a></span>
<span id="cb443-7"><a href="#cb443-7"></a><span class="co"># Transformation du DataFrame en matrice</span></span>
<span id="cb443-8"><a href="#cb443-8"></a>matriceOD &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(matriceOD)</span>
<span id="cb443-9"><a href="#cb443-9"></a>codes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>,<span class="st">&#39;E&#39;</span>,<span class="st">&#39;F&#39;</span>,<span class="st">&#39;G&#39;</span>,<span class="st">&#39;H&#39;</span>,<span class="st">&#39;I&#39;</span>,<span class="st">&#39;J&#39;</span>,<span class="st">&#39;K&#39;</span>,<span class="st">&#39;X&#39;</span>)</span>
<span id="cb443-10"><a href="#cb443-10"></a>secteurs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Arr. de Beauport&#39;</span>,</span>
<span id="cb443-11"><a href="#cb443-11"></a>            <span class="st">&#39;Arr. de Charlesbourg&#39;</span>,</span>
<span id="cb443-12"><a href="#cb443-12"></a>            <span class="st">&#39;Arr. des Rivières&#39;</span>,</span>
<span id="cb443-13"><a href="#cb443-13"></a>            <span class="st">&#39;Arr. de la Cité-Limoilou&#39;</span>,</span>
<span id="cb443-14"><a href="#cb443-14"></a>            <span class="st">&#39;Arr. de la Haute-St-Charles&#39;</span>,</span>
<span id="cb443-15"><a href="#cb443-15"></a>            <span class="st">&#39;Arr. de Sainte-Foy-Sillery-Cap-Rouge&#39;</span>,</span>
<span id="cb443-16"><a href="#cb443-16"></a>            <span class="st">&#39;Arr.de Desjardins&#39;</span>,</span>
<span id="cb443-17"><a href="#cb443-17"></a>            <span class="st">&#39;Arr. des Chutes–de-la-Chaudière-Est&#39;</span>,</span>
<span id="cb443-18"><a href="#cb443-18"></a>            <span class="st">&#39;Arr. Les Chutes de la-Chaudière-Ouest&#39;</span>,</span>
<span id="cb443-19"><a href="#cb443-19"></a>            <span class="st">&#39;Ceinture Nord&#39;</span>,</span>
<span id="cb443-20"><a href="#cb443-20"></a>            <span class="st">&#39;Ceinture Sud&#39;</span>,</span>
<span id="cb443-21"><a href="#cb443-21"></a>            <span class="st">&#39;Hors Territoire&#39;</span>)</span>
<span id="cb443-22"><a href="#cb443-22"></a></span>
<span id="cb443-23"><a href="#cb443-23"></a><span class="co"># Ajout de noms aux colonnes et aux lignes de la matrice</span></span>
<span id="cb443-24"><a href="#cb443-24"></a><span class="kw">rownames</span>(matriceOD) &lt;-<span class="st"> </span>secteurs</span>
<span id="cb443-25"><a href="#cb443-25"></a><span class="kw">colnames</span>(matriceOD) &lt;-<span class="st"> </span>secteurs</span>
<span id="cb443-26"><a href="#cb443-26"></a></span>
<span id="cb443-27"><a href="#cb443-27"></a><span class="co"># Nous supprimons les trois secteurs Ceinture Nord, Sud et Hors territoire </span></span>
<span id="cb443-28"><a href="#cb443-28"></a><span class="co"># qui comprennent de toute façon peu de déplacements</span></span>
<span id="cb443-29"><a href="#cb443-29"></a>mat &lt;-<span class="st"> </span>matriceOD[<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>]</span>
<span id="cb443-30"><a href="#cb443-30"></a></span>
<span id="cb443-31"><a href="#cb443-31"></a><span class="co"># Choix aléatoire de couleurs pour les lignes</span></span>
<span id="cb443-32"><a href="#cb443-32"></a><span class="co"># col &lt;- sample(colors(),nrow(mat),replace = F)</span></span>
<span id="cb443-33"><a href="#cb443-33"></a></span>
<span id="cb443-34"><a href="#cb443-34"></a><span class="co"># Choix de couleurs </span></span>
<span id="cb443-35"><a href="#cb443-35"></a>col &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#a491d3&quot;</span>, <span class="st">&quot;#818aa3&quot;</span>, <span class="st">&quot;#C5DCA0&quot;</span>, <span class="st">&quot;#F5F2B8&quot;</span>,</span>
<span id="cb443-36"><a href="#cb443-36"></a>         <span class="st">&quot;#F9DAD0&quot;</span>, <span class="st">&quot;#F45B69&quot;</span>, <span class="st">&quot;#22181C&quot;</span>, <span class="st">&quot;#5A0001&quot;</span>)</span>
<span id="cb443-37"><a href="#cb443-37"></a></span>
<span id="cb443-38"><a href="#cb443-38"></a><span class="co"># Réalisation du graphique : sortie HTLM</span></span>
<span id="cb443-39"><a href="#cb443-39"></a><span class="cf">if</span>(knitr<span class="op">::</span><span class="kw">is_html_output</span>()){</span>
<span id="cb443-40"><a href="#cb443-40"></a>  <span class="kw">chorddiag</span>(mat, <span class="dt">groupColors =</span> col, <span class="dt">showTicks =</span> F,</span>
<span id="cb443-41"><a href="#cb443-41"></a>        <span class="dt">type =</span> <span class="st">&#39;bipartite&#39;</span>, <span class="dt">chordedgeColor =</span> <span class="st">&#39;white&#39;</span>,</span>
<span id="cb443-42"><a href="#cb443-42"></a>        <span class="dt">groupnameFontsize =</span> <span class="dv">12</span>, <span class="dt">groupnamePadding =</span> <span class="dv">5</span>)</span>
<span id="cb443-43"><a href="#cb443-43"></a>}</span></code></pre></div>
<div class="figure" style="text-align: center">
<div id="htmlwidget-987628092cd39d9b4953" style="width:100%;height:480px;" class="chorddiag html-widget"></div>
<script type="application/json" data-for="htmlwidget-987628092cd39d9b4953">{"x":{"matrix":[[0,0,0,0,0,0,0,0,21163,3246,4710,12213,455,4864,481,133],[0,0,0,0,0,0,0,0,2645,20763,6293,10805,925,5543,309,126],[0,0,0,0,0,0,0,0,1376,1720,22274,8538,2547,8611,841,330],[0,0,0,0,0,0,0,0,2217,2696,6244,37369,703,11141,813,393],[0,0,0,0,0,0,0,0,1084,2451,10163,7996,22309,8672,774,413],[0,0,0,0,0,0,0,0,1178,1292,8178,15126,1198,52359,2002,1260],[0,0,0,0,0,0,0,0,169,189,978,2041,86,2534,21266,2877],[0,0,0,0,0,0,0,0,270,196,1556,2580,165,4942,5061,13245],[21163,2645,1376,2217,1084,1178,169,270,0,0,0,0,0,0,0,0],[3246,20763,1720,2696,2451,1292,189,196,0,0,0,0,0,0,0,0],[4710,6293,22274,6244,10163,8178,978,1556,0,0,0,0,0,0,0,0],[12213,10805,8538,37369,7996,15126,2041,2580,0,0,0,0,0,0,0,0],[455,925,2547,703,22309,1198,86,165,0,0,0,0,0,0,0,0],[4864,5543,8611,11141,8672,52359,2534,4942,0,0,0,0,0,0,0,0],[481,309,841,813,774,2002,21266,5061,0,0,0,0,0,0,0,0],[133,126,330,393,413,1260,2877,13245,0,0,0,0,0,0,0,0]],"options":{"type":"bipartite","width":null,"height":null,"margin":100,"showGroupnames":true,"groupNames":["Arr. de Beauport","Arr. de Charlesbourg","Arr. des Rivières","Arr. de la Cité-Limoilou","Arr. de la Haute-St-Charles","Arr. de Sainte-Foy-Sillery-Cap-Rouge","Arr.de Desjardins","Arr. des Chutes–de-la-Chaudière-Est","Arr. de Beauport","Arr. de Charlesbourg","Arr. des Rivières","Arr. de la Cité-Limoilou","Arr. de la Haute-St-Charles","Arr. de Sainte-Foy-Sillery-Cap-Rouge","Arr.de Desjardins","Arr. des Chutes–de-la-Chaudière-Est"],"groupColors":["#a491d3","#818aa3","#C5DCA0","#F5F2B8","#F9DAD0","#F45B69","#22181C","#5A0001"],"groupThickness":0.1,"groupPadding":0.0349065850398866,"groupnamePadding":[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],"groupnameFontsize":12,"groupedgeColor":null,"chordedgeColor":"white","categoryNames":null,"categorynamePadding":100,"categorynameFontsize":28,"showTicks":false,"tickInterval":1000,"ticklabelFontsize":10,"fadeLevel":0.1,"showTooltips":true,"showZeroTooltips":true,"tooltipNames":["Arr. de Beauport","Arr. de Charlesbourg","Arr. des Rivières","Arr. de la Cité-Limoilou","Arr. de la Haute-St-Charles","Arr. de Sainte-Foy-Sillery-Cap-Rouge","Arr.de Desjardins","Arr. des Chutes–de-la-Chaudière-Est","Arr. de Beauport","Arr. de Charlesbourg","Arr. des Rivières","Arr. de la Cité-Limoilou","Arr. de la Haute-St-Charles","Arr. de Sainte-Foy-Sillery-Cap-Rouge","Arr.de Desjardins","Arr. des Chutes–de-la-Chaudière-Est"],"tooltipFontsize":12,"tooltipUnit":"","tooltipGroupConnector":" &#x25B6; ","precision":"null","clickAction":null,"clickGroupAction":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:fig349)Diagramme d’accord
</p>
</div>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1"></a><span class="co"># Pour la sortie PDF</span></span>
<span id="cb444-2"><a href="#cb444-2"></a><span class="cf">if</span>(knitr<span class="op">::</span><span class="kw">is_latex_output</span>()){</span>
<span id="cb444-3"><a href="#cb444-3"></a>  knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&#39;images/magie_graphiques/chord_diagramme.png&#39;</span>, <span class="dt">dpi =</span> <span class="ot">NA</span>)</span>
<span id="cb444-4"><a href="#cb444-4"></a>}</span></code></pre></div>
<p>Le graphique permet de remarquer que la plupart des flux s’effectuent au sein d’un même secteur. La majorité des déplacements se font au sein du secteur Sainte-Foy (segment rouge central). Nous pouvons cependant constater que les secteurs des Rivières, la cité Limoilou et Haute-Saint-Charle attirent une plus grande quantité et diversité de flux. Si vous lisez ce livre dans un navigateur web (et pas au format <em>pdf</em>), le graphique est interactif! En plaçant votre souris sur un lien, vous verrez s’afficher le nombre de déplacements qu’il représente.</p>
</div>
<div id="sect0333" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Nuage de mots</h3>
<p>Un nuage de mots est un graphique utilisé en analyse de texte pour représenter les mots les plus importants d’un document. Mesurer l’importance des termes dans un document est une discipline à part entière (<em>Natural Language Processing</em>), nous proposons un simple exemple ici avec la méthode <em>TextRank</em> (basée sur la théorie des graphes) proposée par <span class="citation">Mihalcea et Tarau (<a href="#ref-mihalcea2004textrank" role="doc-biblioref">2004</a>)</span> et implémentée dans le <em>package</em> <code>textrank</code>. Nous aurons également besoin des <em>packages</em> <code>udpipe</code> (fournissant des dictionnaires linguistiques), <code>RColorBrewer</code> (pour sélectionner une palette de couleurs) et <code>wordcloud2</code> (pour générer le graphique). En guise d’exemple, nous avons choisi d’extraire les textes de deux Schémas d’Aménagement et de Développement (SAD), ceux des agglomérations de Québec et Montréal en vigueur en 2020. Il s’agit de deux documents de planification définissant les lignes directrices de l’organisation physique du territoire des municipalités régionales de comté (MRC) ou des agglomérations. Pour ces deux documents, nous nous concentrons sur le chapitre portant sur les grandes orientations d’aménagement et de développement, soit les pages 30 à 135 pour Québec et 30 à 97 pour Montréal. Pour extraire les textes des fichiers pdf, nous utilisons le <em>package</em> <code>pdftools</code>.</p>
<p>Nous devons donc réaliser les étapes suivantes pour produire le nuage de mots :</p>
<ol style="list-style-type: decimal">
<li>Extraire les sections qui nous intéressent des fichiers <em>pdf</em>.</li>
<li>Extraire le texte de ces sections.</li>
<li>Retirer les caractères représentant les sauts de lignes et les sauts de paragraphes (<code>\n</code> et <code>\r</code>).</li>
<li>Concaténer tout le texte en une seule longue chaîne de caractère.</li>
<li>Utiliser un dictionnaire pour déterminer la nature des mots du texte (noms, adjectifs, verbes, etc.).</li>
<li>Utiliser l’algorithme <em>TextRank</em> pour identifier les mots clefs.</li>
<li>Nettoyer les erreurs potentielles parmi les mots clefs.</li>
<li>Construire le nuage de mots.</li>
</ol>
<p>Notez que toutes ces étapes de nettoyage ne seraient pas nécessaires si nous utilisions un simple fichier texte comme point de départ. Cependant, il est plus courant de rencontrer des fichiers <em>pdf</em>, cet exercice est donc davantage révélateur de la difficulté réelle de la réalisation d’un nuage de mots.</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="#cb445-1"></a><span class="kw">library</span>(wordcloud2)</span>
<span id="cb445-2"><a href="#cb445-2"></a><span class="kw">library</span>(udpipe)</span>
<span id="cb445-3"><a href="#cb445-3"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb445-4"><a href="#cb445-4"></a><span class="kw">library</span>(pdftools)</span>
<span id="cb445-5"><a href="#cb445-5"></a><span class="kw">library</span>(textrank)</span>
<span id="cb445-6"><a href="#cb445-6"></a></span>
<span id="cb445-7"><a href="#cb445-7"></a><span class="co"># Étape 1 : extraire les sections pertinentes des fichiers pdf</span></span>
<span id="cb445-8"><a href="#cb445-8"></a>extrait_qc &lt;-<span class="st"> </span><span class="kw">pdf_subset</span>(<span class="st">&quot;data/graphique/SAD_quebec.pdf&quot;</span>, <span class="dt">pages =</span> <span class="kw">c</span>(<span class="dv">30</span><span class="op">:</span><span class="dv">135</span>),</span>
<span id="cb445-9"><a href="#cb445-9"></a>                         <span class="dt">output =</span> <span class="st">&quot;data/graphique/SAD_quebec_ext.pdf&quot;</span>)</span>
<span id="cb445-10"><a href="#cb445-10"></a>extrait_mtl &lt;-<span class="st"> </span><span class="kw">pdf_subset</span>(<span class="st">&quot;data/graphique/SAD_montreal.pdf&quot;</span>, <span class="dt">pages =</span> <span class="kw">c</span>(<span class="dv">30</span><span class="op">:</span><span class="dv">97</span>),</span>
<span id="cb445-11"><a href="#cb445-11"></a>                          <span class="dt">output =</span> <span class="st">&quot;data/graphique/SAD_montral_ext.pdf&quot;</span>)</span>
<span id="cb445-12"><a href="#cb445-12"></a></span>
<span id="cb445-13"><a href="#cb445-13"></a><span class="co"># Étape 2 : extraire le texte des fichiers pdf sous forme de vecteur de texte</span></span>
<span id="cb445-14"><a href="#cb445-14"></a>file_qc &lt;-<span class="st"> </span><span class="kw">pdf_text</span>(extrait_qc)</span>
<span id="cb445-15"><a href="#cb445-15"></a>file_mtl &lt;-<span class="st"> </span><span class="kw">pdf_text</span>(extrait_mtl)</span>
<span id="cb445-16"><a href="#cb445-16"></a></span>
<span id="cb445-17"><a href="#cb445-17"></a><span class="co"># Étape 3 : retirer les sauts de lignes et les paragraphes</span></span>
<span id="cb445-18"><a href="#cb445-18"></a>file_qc &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\r</span><span class="st">&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="dt">x =</span> file_qc)</span>
<span id="cb445-19"><a href="#cb445-19"></a>file_qc &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="dt">x =</span> file_qc)</span>
<span id="cb445-20"><a href="#cb445-20"></a></span>
<span id="cb445-21"><a href="#cb445-21"></a>file_mtl &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\r</span><span class="st">&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="dt">x =</span> file_mtl)</span>
<span id="cb445-22"><a href="#cb445-22"></a>file_mtl &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="dt">x =</span> file_mtl)</span>
<span id="cb445-23"><a href="#cb445-23"></a></span>
<span id="cb445-24"><a href="#cb445-24"></a><span class="co"># Étape 4 : créer une seule longue chaîne de caractères</span></span>
<span id="cb445-25"><a href="#cb445-25"></a><span class="co"># à partir des vecteurs de texte</span></span>
<span id="cb445-26"><a href="#cb445-26"></a>text_qc &lt;-<span class="st"> </span><span class="kw">paste</span>(file_qc, <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb445-27"><a href="#cb445-27"></a>text_mtl &lt;-<span class="st"> </span><span class="kw">paste</span>(file_mtl, <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb445-28"><a href="#cb445-28"></a></span>
<span id="cb445-29"><a href="#cb445-29"></a><span class="co"># charger le modèle linguistique français</span></span>
<span id="cb445-30"><a href="#cb445-30"></a>model &lt;-<span class="st"> </span><span class="kw">udpipe_load_model</span>(<span class="st">&#39;data/graphique/french-sequoia-ud-2.4-190531.udpipe&#39;</span>)</span>
<span id="cb445-31"><a href="#cb445-31"></a></span>
<span id="cb445-32"><a href="#cb445-32"></a><span class="co"># pour télécharger le modèle si ce n&#39;est pas encore fait : </span></span>
<span id="cb445-33"><a href="#cb445-33"></a><span class="co"># model &lt;- udpipe_download_model(&quot;french-sequoia&quot;)</span></span>
<span id="cb445-34"><a href="#cb445-34"></a><span class="co"># model &lt;- udpipe_load_model(model)</span></span>
<span id="cb445-35"><a href="#cb445-35"></a></span>
<span id="cb445-36"><a href="#cb445-36"></a><span class="co"># Étape 5 : analyse de la nature des mots du texte avec le dictionnaire fr</span></span>
<span id="cb445-37"><a href="#cb445-37"></a><span class="co"># Nous obtenons des DataFrames décrivant les mots des textes</span></span>
<span id="cb445-38"><a href="#cb445-38"></a>annote_qc &lt;-<span class="st"> </span><span class="kw">udpipe_annotate</span>(model, text_qc)</span>
<span id="cb445-39"><a href="#cb445-39"></a>df_qc &lt;-<span class="st"> </span><span class="kw">data.frame</span>(annote_qc)</span>
<span id="cb445-40"><a href="#cb445-40"></a></span>
<span id="cb445-41"><a href="#cb445-41"></a>annote_mtl &lt;-<span class="st"> </span><span class="kw">udpipe_annotate</span>(model, text_mtl)</span>
<span id="cb445-42"><a href="#cb445-42"></a>df_mtl &lt;-<span class="st"> </span><span class="kw">data.frame</span>(annote_mtl)</span>
<span id="cb445-43"><a href="#cb445-43"></a></span>
<span id="cb445-44"><a href="#cb445-44"></a><span class="co"># Étape 6 : utilisation de la méthode TextRank</span></span>
<span id="cb445-45"><a href="#cb445-45"></a>stats_qc &lt;-<span class="st"> </span><span class="kw">textrank_keywords</span>(df_qc<span class="op">$</span>lemma,</span>
<span id="cb445-46"><a href="#cb445-46"></a>                  <span class="dt">relevant =</span> df_qc<span class="op">$</span>upos <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;NOUN&quot;</span>, <span class="st">&quot;ADJ&quot;</span>), <span class="dt">ngram_max=</span><span class="dv">2</span>)</span>
<span id="cb445-47"><a href="#cb445-47"></a></span>
<span id="cb445-48"><a href="#cb445-48"></a>stats_mtl &lt;-<span class="st"> </span><span class="kw">textrank_keywords</span>(df_mtl<span class="op">$</span>lemma,</span>
<span id="cb445-49"><a href="#cb445-49"></a>                  <span class="dt">relevant =</span> df_mtl<span class="op">$</span>upos <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;NOUN&quot;</span>,<span class="st">&quot;ADJ&quot;</span>), <span class="dt">ngram_max=</span><span class="dv">2</span>)</span>
<span id="cb445-50"><a href="#cb445-50"></a></span>
<span id="cb445-51"><a href="#cb445-51"></a><span class="co"># Étape 7 : nettoyer les coquilles dans les mots clefs </span></span>
<span id="cb445-52"><a href="#cb445-52"></a><span class="co"># Note : nous faisons ici le choix de garder des mots clefs uniques (ngram == 1)</span></span>
<span id="cb445-53"><a href="#cb445-53"></a><span class="co"># Il serait aussi possible de garder des associations de plusieurs mots</span></span>
<span id="cb445-54"><a href="#cb445-54"></a>dfstats_qc &lt;-<span class="st"> </span><span class="kw">subset</span>(stats_qc<span class="op">$</span>keywords, stats_qc<span class="op">$</span>keywords<span class="op">$</span>ngram <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span></span>
<span id="cb445-55"><a href="#cb445-55"></a><span class="st">                       </span><span class="kw">nchar</span>(stats_qc<span class="op">$</span>keywords<span class="op">$</span>keyword)<span class="op">&gt;</span><span class="dv">2</span>)</span>
<span id="cb445-56"><a href="#cb445-56"></a>dfstats_qc<span class="op">$</span>keyword &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;d’&quot;</span>,<span class="st">&quot;&quot;</span>,dfstats_qc<span class="op">$</span>keyword,<span class="dt">fixed =</span> T)</span>
<span id="cb445-57"><a href="#cb445-57"></a>dfstats_qc<span class="op">$</span>keyword &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;l’&quot;</span>,<span class="st">&quot;&quot;</span>,dfstats_qc<span class="op">$</span>keyword,<span class="dt">fixed =</span> T)</span>
<span id="cb445-58"><a href="#cb445-58"></a></span>
<span id="cb445-59"><a href="#cb445-59"></a>dfstats_mtl &lt;-<span class="st"> </span><span class="kw">subset</span>(stats_mtl<span class="op">$</span>keywords, stats_mtl<span class="op">$</span>keywords<span class="op">$</span>ngram <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span></span>
<span id="cb445-60"><a href="#cb445-60"></a><span class="st">                        </span><span class="kw">nchar</span>(stats_mtl<span class="op">$</span>keywords<span class="op">$</span>keyword)<span class="op">&gt;</span><span class="dv">2</span>)</span>
<span id="cb445-61"><a href="#cb445-61"></a>dfstats_mtl<span class="op">$</span>keyword &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;d’&quot;</span>,<span class="st">&quot;&quot;</span>,dfstats_mtl<span class="op">$</span>keyword,<span class="dt">fixed =</span> T)</span>
<span id="cb445-62"><a href="#cb445-62"></a>dfstats_mtl<span class="op">$</span>keyword &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;l’&quot;</span>,<span class="st">&quot;&quot;</span>,dfstats_mtl<span class="op">$</span>keyword,<span class="dt">fixed =</span> T)</span>
<span id="cb445-63"><a href="#cb445-63"></a></span>
<span id="cb445-64"><a href="#cb445-64"></a><span class="co"># Étape 8 : réaliser les nuages de mots</span></span>
<span id="cb445-65"><a href="#cb445-65"></a>couleurs &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">brewer.pal</span>(<span class="dv">12</span>, <span class="st">&quot;Paired&quot;</span>)) <span class="co"># mise en désordre des couleurs</span></span>
<span id="cb445-66"><a href="#cb445-66"></a></span>
<span id="cb445-67"><a href="#cb445-67"></a><span class="kw">wordcloud2</span>(<span class="dt">data =</span> dfstats_mtl[<span class="kw">c</span>(<span class="st">&quot;keyword&quot;</span>, <span class="st">&quot;freq&quot;</span>)],</span>
<span id="cb445-68"><a href="#cb445-68"></a>           <span class="dt">color =</span> couleurs, <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">shuffle =</span> F)</span>
<span id="cb445-69"><a href="#cb445-69"></a></span>
<span id="cb445-70"><a href="#cb445-70"></a><span class="kw">wordcloud2</span>(<span class="dt">data =</span> dfstats_qc[<span class="kw">c</span>(<span class="st">&quot;keyword&quot;</span>, <span class="st">&quot;freq&quot;</span>)],</span>
<span id="cb445-71"><a href="#cb445-71"></a>           <span class="dt">color =</span> couleurs, <span class="dt">size =</span> <span class="fl">0.6</span>, <span class="dt">shuffle =</span> F)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/magie_graphiques/nuage_mtl.png" alt="Nuage de mots pour le SAD de Montréal" width="85%" />
<p class="caption">
(#fig:fig350)Nuage de mots pour le SAD de Montréal
</p>
</div>
<div class="figure" style="text-align: center">
<img src="images/magie_graphiques/nuage_qc.png" alt="Nuage de mots pour le SAD de Québec" width="85%" />
<p class="caption">
(#fig:fig351)Nuage de mots pour le SAD de Québec
</p>
</div>
<p>Notez qu’à chaque génération du nuage de mots, vous obtiendrez une disposition différente. N’hésitez pas à en essayer plusieurs jusqu’à trouver celle qui vous semble optimale.</p>
</div>
<div id="sect0334" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Carte proportionnelle</h3>
<p>Une carte proportionnelle ou carte à cases (<em>treemap</em> en anglais) est un graphique permettant de représenter une quantité partagée entre plusieurs observations structurées dans une hiérarchie de groupe. Le jeu de données portant sur les émissions de CO<sub>2</sub> se prête tout à fait à une représentation par <em>treemaps</em>. La variable de quantité est bien sûr les émissions de CO<sub>2</sub> par pays; ces pays sont regroupés dans un premier ensemble de régions (découpage en 23 régions), qui elles-mêmes sont regroupées dans des régions plus larges (découpage en sept régions). Pour construire un <em>treemap</em>, nous allons utiliser le <em>package</em> <code>treemap</code>.</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1"></a><span class="kw">library</span>(treemap)</span>
<span id="cb446-2"><a href="#cb446-2"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb446-3"><a href="#cb446-3"></a></span>
<span id="cb446-4"><a href="#cb446-4"></a><span class="co"># extraire les données de CO2 en 2015</span></span>
<span id="cb446-5"><a href="#cb446-5"></a>data_co2_<span class="dv">2015</span> &lt;-<span class="st"> </span><span class="kw">subset</span>(data_co2,data_co2<span class="op">$</span>year <span class="op">==</span><span class="st"> &quot;2015&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="st"> </span><span class="kw">is.na</span>(data_co2<span class="op">$</span>region7))</span>
<span id="cb446-6"><a href="#cb446-6"></a></span>
<span id="cb446-7"><a href="#cb446-7"></a><span class="co"># construire le treemap</span></span>
<span id="cb446-8"><a href="#cb446-8"></a></span>
<span id="cb446-9"><a href="#cb446-9"></a><span class="kw">treemap</span>(data_co2_<span class="dv">2015</span>, <span class="dt">index=</span><span class="kw">c</span>(<span class="st">&quot;region7&quot;</span>,<span class="st">&quot;region23&quot;</span>),</span>
<span id="cb446-10"><a href="#cb446-10"></a>    <span class="dt">vSize=</span><span class="st">&quot;CO2_kt&quot;</span>, <span class="dt">type=</span><span class="st">&quot;index&quot;</span>,</span>
<span id="cb446-11"><a href="#cb446-11"></a>    <span class="dt">title =</span> <span class="st">&quot;CO2 rejetés par pays en 2015&quot;</span>,</span>
<span id="cb446-12"><a href="#cb446-12"></a>    <span class="dt">fontsize.labels=</span><span class="kw">c</span>(<span class="dv">12</span>,<span class="dv">8</span>), <span class="co"># taille des étiquettes              </span></span>
<span id="cb446-13"><a href="#cb446-13"></a>    <span class="dt">fontcolor.labels=</span><span class="kw">c</span>(<span class="st">&quot;white&quot;</span>,<span class="st">&quot;black&quot;</span>), <span class="co"># couleur des étiquettes</span></span>
<span id="cb446-14"><a href="#cb446-14"></a>    <span class="dt">fontface.labels=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="co"># style des polices</span></span>
<span id="cb446-15"><a href="#cb446-15"></a>    <span class="dt">bg.labels=</span><span class="kw">c</span>(<span class="st">&quot;transparent&quot;</span>), <span class="co"># arrière-plan des étiquettes</span></span>
<span id="cb446-16"><a href="#cb446-16"></a>    <span class="dt">align.labels=</span><span class="kw">list</span>(</span>
<span id="cb446-17"><a href="#cb446-17"></a>        <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;center&quot;</span>), </span>
<span id="cb446-18"><a href="#cb446-18"></a>        <span class="kw">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb446-19"><a href="#cb446-19"></a>        ),  <span class="co"># localisation des étiquettes dans les boîtes</span></span>
<span id="cb446-20"><a href="#cb446-20"></a>    <span class="dt">overlap.labels=</span><span class="fl">0.5</span>, <span class="co"># tolérance de superposition</span></span>
<span id="cb446-21"><a href="#cb446-21"></a>    <span class="dt">inflate.labels=</span>F, <span class="co"># agrandir la taille des étiquettes ou non</span></span>
<span id="cb446-22"><a href="#cb446-22"></a>    <span class="dt">palette =</span> <span class="kw">brewer.pal</span>(<span class="dv">7</span>,<span class="st">&#39;Paired&#39;</span>)</span>
<span id="cb446-23"><a href="#cb446-23"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig352-1.png" alt="Treemap" width="90%" />
<p class="caption">
(#fig:fig352)Treemap
</p>
</div>
</div>
</div>
<div id="sect034" class="section level2">
<h2><span class="header-section-number">3.4</span> Cartes</h2>
<p>Toute comme un graphique, une carte est aussi une illustration visuelle, avec la généralisation des données géographiques, il peut être utile de savoir représenter ce type de données. Si R n’est pas un logiciel de cartographie, il est possible de réaliser des cartes assez facilement, directement avec <code>ggplot2</code>. Nous avons cependant une préférence pour le <em>package</em> <code>tmap</code> qui propose de nombreuses fonctionnalités. Pour tracer des cartes, <code>tmap</code> et <code>ggplot2</code> ont besoin d’utiliser un format de données comprenant la géométrie (polygones, lignes ou points), la localisation et le système de projection des entités spatiales étudiées. Le format de fichier le plus courant pour ce type de données est le <em>shapefile</em> (<em>.shp</em>), mais vous pourrez parfois croiser des fichiers <em>geojson</em> (<em>.js</em>), ou encore <em>geopackages</em> (<em>.gpkg</em>). Pour lire ces fichiers, il est possible d’utiliser la fonction <code>readOGR</code> du <em>package</em> <code>rgdal</code>, ou la fonction <em>st_read</em> du <em>package</em> <code>sf</code>. Notez ici que ces deux fonctions ne produisent pas des <em>DataFrame</em>, mais respectivement un <em>SpatialDataFrame</em> et un objet <code>sf</code> (<em>simple feature collection</em>). Sans rentrer dans les détails, sachez que deux <em>packages</em> permettent de manipuler des objets spatiaux dans R : le traditionnel <code>sp</code> (avec les <em>SpatialDataFrame</em>) et le plus récent <code>sf</code> (avec les <em>spatial feature collections</em>). Il est assez facile de convertir un objet de <code>sp</code> vers <code>sf</code> (et inversement) et cette opération est souvent nécessaire, car de nombreux <em>packages</em> dédiés à l’analyse spatiale utilisent l’un ou l’autre des formats. Dans le cas de <code>tmap</code>, des objets de <code>sp</code> et de <code>sf</code> peuvent être utilisés sans distinction. En revanche, pour cartographier directement avec <code>ggplot2</code>, il est plus facile d’utiliser un objet de type <code>sf</code>. Toutefois, nous vous recommandons fortement d’utiliser le <em>package</em> <code>sf</code>, puisque <code>sp</code> (et son format <em>SpatialDataFrame</em>) sont progressivement délaissés dans R.</p>
<p>Une carte thématique permet de représenter la répartition spatiale de variables qualitatives ou quantitatives. Nous les distinguons des cartes topographiques dont l’objectif est de représenter la localisation d’objets spécifiques (route, habitation, rivière, lac, etc.). Les premières sont relativement faciles à construire dans R car elles se limitent à quelques symboles relativement peu complexes. Pour les secondes, nous préférons généralement utiliser un logiciel comme <a href="https://qgis.org/en/site/" target="_blank">QGis</a>.</p>
<p>Créons une carte thématique à partir des données de densité de végétation sur l’île de Montréal avec les <em>packages</em> <code>ggplot2</code> puis <code>tmap</code>.</p>
<p>Avec <code>ggplot2</code>, nous aurons aussi besoin des <em>packages</em> <code>classInt</code> pour calculer les intervalles des classes et de <code>ggsn</code> pour afficher une échelle.</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="#cb447-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb447-2"><a href="#cb447-2"></a><span class="kw">library</span>(classInt)</span>
<span id="cb447-3"><a href="#cb447-3"></a><span class="kw">library</span>(ggsn)</span>
<span id="cb447-4"><a href="#cb447-4"></a></span>
<span id="cb447-5"><a href="#cb447-5"></a><span class="co"># chargement des données</span></span>
<span id="cb447-6"><a href="#cb447-6"></a>spatialdf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/bivariee/IlotsVeg2006.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `IlotsVeg2006&#39; from data source `D:\Articles et colloque\Livre en cours\AnalysesQuanti\Livre\livre_statistique_Phil_Jere\data\bivariee\IlotsVeg2006.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 10213 features and 12 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 267518.7 ymin: 5029292 xmax: 306663.7 ymax: 5062652
## Projected CRS: NAD83 / MTM zone 8</code></pre>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="#cb449-1"></a><span class="co"># création d&#39;une discrétisation en 7 classes égales</span></span>
<span id="cb449-2"><a href="#cb449-2"></a>values &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">max</span>(spatialdf<span class="op">$</span>ArbPct)<span class="op">+</span><span class="fl">0.01</span>,spatialdf<span class="op">$</span>ArbPct)</span>
<span id="cb449-3"><a href="#cb449-3"></a></span>
<span id="cb449-4"><a href="#cb449-4"></a>quant &lt;-<span class="st"> </span><span class="kw">classIntervals</span>(values, <span class="dt">n =</span> <span class="dv">7</span>,</span>
<span id="cb449-5"><a href="#cb449-5"></a>                        <span class="dt">style =</span> <span class="st">&quot;quantile&quot;</span>,</span>
<span id="cb449-6"><a href="#cb449-6"></a>                        <span class="dt">intervalClosure =</span> <span class="st">&#39;right&#39;</span>)</span>
<span id="cb449-7"><a href="#cb449-7"></a></span>
<span id="cb449-8"><a href="#cb449-8"></a>spatialdf<span class="op">$</span>class_col &lt;-<span class="st"> </span><span class="kw">cut</span>(spatialdf<span class="op">$</span>ArbPct, <span class="dt">breaks =</span> quant<span class="op">$</span>brks, <span class="dt">right =</span> F)</span>
<span id="cb449-9"><a href="#cb449-9"></a></span>
<span id="cb449-10"><a href="#cb449-10"></a><span class="co"># cartographie avec ggplot2</span></span>
<span id="cb449-11"><a href="#cb449-11"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> spatialdf) <span class="op">+</span><span class="st"> </span></span>
<span id="cb449-12"><a href="#cb449-12"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> class_col), <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb449-13"><a href="#cb449-13"></a><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Greens&quot;</span>)<span class="op">+</span></span>
<span id="cb449-14"><a href="#cb449-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Végétation dans les îlos de recensement&quot;</span>,</span>
<span id="cb449-15"><a href="#cb449-15"></a>       <span class="st">&#39;fill&#39;</span> =<span class="st"> &#39;Densité de la canopée (%)&#39;</span>)<span class="op">+</span></span>
<span id="cb449-16"><a href="#cb449-16"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line=</span><span class="kw">element_blank</span>(),<span class="dt">axis.text.x=</span><span class="kw">element_blank</span>(),</span>
<span id="cb449-17"><a href="#cb449-17"></a>        <span class="dt">axis.text.y=</span><span class="kw">element_blank</span>(),<span class="dt">axis.ticks=</span><span class="kw">element_blank</span>(),</span>
<span id="cb449-18"><a href="#cb449-18"></a>        <span class="dt">axis.title.x=</span><span class="kw">element_blank</span>(), <span class="dt">axis.title.y=</span><span class="kw">element_blank</span>(),</span>
<span id="cb449-19"><a href="#cb449-19"></a>        <span class="dt">panel.background=</span><span class="kw">element_blank</span>(),</span>
<span id="cb449-20"><a href="#cb449-20"></a>        <span class="dt">panel.border=</span><span class="kw">element_blank</span>(),<span class="dt">panel.grid.major=</span><span class="kw">element_blank</span>(),</span>
<span id="cb449-21"><a href="#cb449-21"></a>        <span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>(),<span class="dt">plot.background=</span><span class="kw">element_blank</span>(),</span>
<span id="cb449-22"><a href="#cb449-22"></a>        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>))<span class="op">+</span></span>
<span id="cb449-23"><a href="#cb449-23"></a><span class="st">  </span><span class="kw">scalebar</span>(spatialdf, <span class="dt">dist =</span> <span class="dv">5</span>, <span class="dt">st.size=</span><span class="dv">3</span>, <span class="dt">height=</span><span class="fl">0.01</span>, <span class="dt">model =</span> <span class="st">&#39;WGS84&#39;</span>, </span>
<span id="cb449-24"><a href="#cb449-24"></a>           <span class="dt">dist_unit =</span> <span class="st">&quot;km&quot;</span>, <span class="dt">transform =</span> F, <span class="dt">location =</span> <span class="st">&#39;bottomright&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig353-1.png" alt="Carte thématique avec ggplot2" width="85%" />
<p class="caption">
(#fig:fig353)Carte thématique avec ggplot2
</p>
</div>
<p>Il est possible d’arriver à un résultat similaire avec <strong>tmap</strong> avec moins de code!</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1"></a><span class="kw">library</span>(tmap)</span>
<span id="cb450-2"><a href="#cb450-2"></a></span>
<span id="cb450-3"><a href="#cb450-3"></a>colors &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">7</span>,<span class="st">&quot;Greens&quot;</span>)</span>
<span id="cb450-4"><a href="#cb450-4"></a></span>
<span id="cb450-5"><a href="#cb450-5"></a><span class="kw">tm_shape</span>(spatialdf) <span class="op">+</span></span>
<span id="cb450-6"><a href="#cb450-6"></a><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="st">&quot;ArbPct&quot;</span>, <span class="dt">palette =</span> colors, <span class="dt">border.alpha =</span> <span class="dv">0</span>,</span>
<span id="cb450-7"><a href="#cb450-7"></a>            <span class="dt">n =</span> <span class="dv">7</span>, <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb450-8"><a href="#cb450-8"></a>            <span class="dt">title =</span> <span class="st">&#39;Densité de la canopée (%)&#39;</span>)<span class="op">+</span></span>
<span id="cb450-9"><a href="#cb450-9"></a><span class="st">  </span><span class="kw">tm_scale_bar</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb450-10"><a href="#cb450-10"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">title =</span> <span class="st">&quot;Végétation dans les îlos de recensement&quot;</span>,</span>
<span id="cb450-11"><a href="#cb450-11"></a>            <span class="dt">attr.outside =</span> <span class="ot">TRUE</span>, <span class="dt">frame =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig354-1.png" alt="Carte thématique avec tmap" width="85%" />
<p class="caption">
(#fig:fig354)Carte thématique avec tmap
</p>
</div>
<p>Les graphiques créés par <strong>tmap</strong> ne peuvent malheureusement pas être combinés avec la fonction <code>ggarrange</code>, mais <strong>tmap</strong> dispose de sa propre fonction <code>tmap_arrange</code> si vous souhaitez combiner plusieurs cartes.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="#cb451-1"></a><span class="kw">library</span>(tmap)</span>
<span id="cb451-2"><a href="#cb451-2"></a></span>
<span id="cb451-3"><a href="#cb451-3"></a>colors &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">7</span>,<span class="st">&quot;Greens&quot;</span>)</span>
<span id="cb451-4"><a href="#cb451-4"></a></span>
<span id="cb451-5"><a href="#cb451-5"></a>colors2 &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">7</span>,<span class="st">&quot;Reds&quot;</span>)</span>
<span id="cb451-6"><a href="#cb451-6"></a></span>
<span id="cb451-7"><a href="#cb451-7"></a>carte1 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(spatialdf) <span class="op">+</span></span>
<span id="cb451-8"><a href="#cb451-8"></a><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="st">&quot;ArbPct&quot;</span>, <span class="dt">palette =</span> colors, <span class="dt">border.alpha =</span> <span class="dv">0</span>,</span>
<span id="cb451-9"><a href="#cb451-9"></a>            <span class="dt">n =</span> <span class="dv">7</span>, <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb451-10"><a href="#cb451-10"></a>            <span class="dt">title =</span> <span class="st">&#39;Densité de la canopée (%)&#39;</span>) <span class="op">+</span></span>
<span id="cb451-11"><a href="#cb451-11"></a><span class="st">  </span><span class="kw">tm_scale_bar</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb451-12"><a href="#cb451-12"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">attr.outside =</span> <span class="ot">TRUE</span>, <span class="dt">frame =</span> <span class="ot">FALSE</span>)</span>
<span id="cb451-13"><a href="#cb451-13"></a></span>
<span id="cb451-14"><a href="#cb451-14"></a>carte2 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(spatialdf) <span class="op">+</span></span>
<span id="cb451-15"><a href="#cb451-15"></a><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="st">&quot;LogDens&quot;</span>, <span class="dt">palette =</span> colors2, <span class="dt">border.alpha =</span> <span class="dv">0</span>,</span>
<span id="cb451-16"><a href="#cb451-16"></a>            <span class="dt">n =</span> <span class="dv">7</span>, <span class="dt">style =</span> <span class="st">&#39;quantile&#39;</span>,</span>
<span id="cb451-17"><a href="#cb451-17"></a>            <span class="dt">title =</span> <span class="st">&#39;Densité de logement&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb451-18"><a href="#cb451-18"></a><span class="st">  </span><span class="kw">tm_scale_bar</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb451-19"><a href="#cb451-19"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">attr.outside =</span> <span class="ot">TRUE</span>, <span class="dt">frame =</span> <span class="ot">FALSE</span>)</span>
<span id="cb451-20"><a href="#cb451-20"></a></span>
<span id="cb451-21"><a href="#cb451-21"></a><span class="kw">tmap_arrange</span>(carte1, carte2, <span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig355-1.png" alt="Combiner des cartes avec tmap" width="85%" />
<p class="caption">
(#fig:fig355)Combiner des cartes avec tmap
</p>
</div>
</div>
<div id="sect035" class="section level2">
<h2><span class="header-section-number">3.5</span> Exporter des graphiques</h2>
<p>Tous les graphiques que nous avons construits dans ce chapitre peuvent être exportés assez facilement. Dans RStudio, vous pouvez directement cliquer sur le bouton <em>export</em> (figure @ref(fig:fig356)) pour enregistrer votre figure au format image (raster) ou au format PDF (vecteur). Notez qu’avec la seconde option, vous pourrez retoucher votre graphique avec un logiciel externe comme <em>Inkscape</em> ou <em>Illustrator</em>.</p>
<div class="figure" style="text-align: center">
<img src="images/magie_graphiques/export.JPG" alt="Exporter un graphique dans RStudio" width="40%" />
<p class="caption">
(#fig:fig356)Exporter un graphique dans RStudio
</p>
</div>
<p>Lorsque vous créez un graphique avec <code>ggplot2</code>, il est aussi possible de l’exporter avec la fonction <code>ggsave</code>. Cette fonctionnalité est très pratique lorsque vous souhaitez automatiser la production de graphiques et ne pas avoir à tous les exporter à la main.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1"></a><span class="kw">data</span>(iris)</span>
<span id="cb452-2"><a href="#cb452-2"></a></span>
<span id="cb452-3"><a href="#cb452-3"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb452-4"><a href="#cb452-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris)</span>
<span id="cb452-5"><a href="#cb452-5"></a></span>
<span id="cb452-6"><a href="#cb452-6"></a><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&#39;graphique.pdf&#39;</span>,</span>
<span id="cb452-7"><a href="#cb452-7"></a>       <span class="dt">path =</span> <span class="st">&#39;mon/dossier&#39;</span>,</span>
<span id="cb452-8"><a href="#cb452-8"></a>       <span class="dt">plot =</span> plot1,</span>
<span id="cb452-9"><a href="#cb452-9"></a>       <span class="dt">width =</span> <span class="dv">10</span>, <span class="dt">height =</span> <span class="dv">10</span>, <span class="dt">units =</span> <span class="st">&quot;cm&quot;</span>)</span></code></pre></div>
<p>Pour les graphiques n’étant pas réalisés avec <code>ggplot2</code>, l’alternative à la fonction <code>ggsave</code> est l’ensemble de fonctions <code>png</code>, <code>bmp</code>, <code>jpeg</code>, <code>tiff</code> et <code>pdf</code>, qui permettent d’exporter n’importe quel graphique dans ces différents formats. Le processus comprend trois étapes :</p>
<ol style="list-style-type: decimal">
<li>Ouvrir une connexion vers le fichier dans lequel le graphique sera exporté avec une des fonctions <code>png</code>, <code>bmp</code>, <code>jpeg</code>, <code>tiff</code> et <code>pdf</code>.</li>
<li>Réaliser son graphique comme si nous souhaitions l’afficher dans RSudio. Il n’apparaîtra cependant pas, car il sera écrit dans le fichier en question à la place.</li>
<li>Fermer la connexion au fichier avec la fonction <code>dev.off</code> pour définitivement enregistrer le graphique.</li>
</ol>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="#cb453-1"></a><span class="kw">data</span>(iris)</span>
<span id="cb453-2"><a href="#cb453-2"></a></span>
<span id="cb453-3"><a href="#cb453-3"></a><span class="co"># 1. Ouvrir la connexion</span></span>
<span id="cb453-4"><a href="#cb453-4"></a><span class="kw">png</span>(<span class="dt">filename =</span> <span class="st">&#39;mon/dossier/graphique.png&#39;</span>)</span>
<span id="cb453-5"><a href="#cb453-5"></a></span>
<span id="cb453-6"><a href="#cb453-6"></a><span class="co"># 2. Afficher le graphique</span></span>
<span id="cb453-7"><a href="#cb453-7"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb453-8"><a href="#cb453-8"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">y =</span> Sepal.Width), <span class="dt">data =</span> iris)</span>
<span id="cb453-9"><a href="#cb453-9"></a></span>
<span id="cb453-10"><a href="#cb453-10"></a><span class="co"># 3. fermer la connexion</span></span>
<span id="cb453-11"><a href="#cb453-11"></a><span class="kw">dev.off</span>()</span></code></pre></div>
</div>
<div id="sect036" class="section level2">
<h2><span class="header-section-number">3.6</span> Conclusion sur les graphiques</h2>
<p>Vous avez pu constater que les capacités de représentation graphique de R sont vastes et pourtant nous n’avons fait qu’observer la partie émergée de l’iceberg dans ce chapitre. Il est également possible de réaliser de la visualisation en 3D dans R (<strong>plot3D</strong>, <strong>rgl</strong>), d’animer des graphiques pour en faire des <em>GIF</em> ou des vidéos (<strong>gganimate</strong>), de rendre des graphiques interactifs, ou même de construire des plateformes de visualisation de données disponibles en ligne (<strong>shiny</strong>). Vous continuerez à découvrir de nouvelles formes de représentations au fur et à mesure de votre pratique, en apprenant de nouvelles méthodes nécessitant des visualisations spécifiques.</p>
<p>Voici également deux références très utiles qui nous ont notamment aidés à construire ce chapitre :</p>
<ul>
<li><a href="https://www.r-graph-gallery.com/" target="_blank">The R Graph Gallery</a>, probablement <strong>LE</strong> site web proposant le plus de matériel sur la réalisation des graphiques dans R.</li>
<li><a href="https://www.data-to-viz.com/" target="_blank">Data to viz</a>, si vous ne savez pas quel graphique pourrait le mieux correspondre à vos données, Data to viz est là pour vous aider. Vous y trouverez un arbre de décision pour vous indiquer quel graphique utiliser dans quelle situation, ainsi que de nombreux conseils sur la visualisation de données.</li>
</ul>
<!--chapter:end:03-magiedesgraphiques.Rmd-->
</div>
</div>
<div id="part-analyses-bivariées" class="section level1 unnumbered">
<h1>(PART) Analyses bivariées</h1>
</div>
<div id="chap04" class="section level1">
<h1><span class="header-section-number">4</span> Relation linéaire entre deux variables quantitatives</h1>
<p>Dans le cadre de ce chapitre, nous présentons les trois principales méthodes permettant d’explorer la relation linéaire entre deux variables quantitatives, soit la covariance, la corrélation et la régression linéaire simple.</p>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons les <em>packages</em> suivants :</p>
<ul>
<li>Pour créer des graphiques :
<ul>
<li><code>ggplot2</code>, le seul, l’unique!</li>
<li><code>ggpubr</code> pour combiner des graphiques et réaliser des diagrammes quantiles-quantiles.</li>
</ul></li>
<li>Pour manipuler des données :
<ul>
<li><code>dplyr</code> notamment pour les fonctions <code>group_by</code>, <code>summarize</code> et les pipes %&gt;%.</li>
</ul></li>
<li>Pour les corrélations :
<ul>
<li><code>boot</code> pour réaliser des corrélations avec <em>bootstrap</em>.</li>
<li><code>correlation</code>, de l’ensemble de packages <code>easy_stats</code>, offrant une large panoplie de mesures de corrélation.</li>
<li><code>corrplot</code> pour créer des graphiques de matrices de corrélation.</li>
<li><code>Hmisc</code> pour calculer des corrélations de Pearson et Spearman.</li>
<li><code>ppcor</code> pour calculer des corrélations partielles.</li>
<li><code>psych</code> pour obtenir une matrice de corrélation (Pearson, Spearman et Kendall), les intervalles de confiance et les valeurs de <em>p</em>.</li>
<li><code>stargazer</code> pour créer de beaux tableaux d’une matrice de corrélation en HTML, en LaTeX ou en ASCII.</li>
</ul></li>
<li>Autres <em>packages</em> :
<ul>
<li><code>foreign</code> pour importer des fichiers externes.</li>
<li><code>MASS</code> pour générer des échantillons normalement distribués.</li>
<li><code>stargazer</code> pour imprimer des tableaux.</li>
</ul></li>
</ul>
</div>
<div class="bloc_objectif">
<p><strong>Deux variables continues varient-elles dans le même sens ou bien en sens contraire?</strong> Répondre à cette question est une démarche exploratoire classique en sciences sociales puisque les données socioéconomiques sont souvent associées linéairement. En d’autres termes, lorsque l’une des deux variables tant à augmenter, l’autre augmente également ou diminue systématiquement.</p>
<p>En études urbaines, nous pourrions vouloir vérifier si certaines variables socioéconomiques sont associées positivement ou négativement à des variables environnementales jugées positives (comme la couverture végétale ou des mesures d’accessibilité spatiale aux parcs) ou négatives (pollutions atmosphériques et sonores).</p>
<p>Par exemple, au niveau des secteurs de recensement d’une ville canadienne, nous pourrions vouloir vérifier si le revenu médian des ménages et le coût moyen du loyer varient dans le même sens que la couverture végétale; ou encore s’ils varient en sens inverse des niveaux moyens de dioxyde d’azote ou de bruit routier.</p>
<p>Pour évaluer la linéarité entre deux variables continues, deux statistiques descriptives sont utilisées : la <strong>covariance</strong>covariance (section @ref(sect042)) et la <strong>corrélation</strong>corrélation (section @ref(sect043)).</p>
</div>
<div id="sect041" class="section level2">
<h2><span class="header-section-number">4.1</span> Bref retour sur le postulat de la relation linéaire</h2>
<p>Vérifier le postulat de la linéarité consiste à évaluer si deux variables quantitatives varient dans le même sens ou bien en sens contraire. Toutefois, la relation entre deux variables quantitatives n’est pas forcément linéaire. En guise d’illustration, la figure @ref(fig:fig2) permet de distinguer quatre types de relations :</p>
<ul>
<li><p>Le cas <strong>a</strong> illustre une relation linéaire positive entre les deux variables puisqu’elles vont dans le même sens. Autrement dit, quand les valeurs de <em>X</em> augmentent, celles de <em>Y</em> augmentent aussi. En guise d’exemple, pour les secteurs de recensement d’une métropole donnée, il est fort probable que le coût moyen du loyer soit associé positivement avec le revenu médian des ménages. Graphiquement parlant, il est clair qu’une droite dans ce nuage de points résumerait efficacement la relation entre ces deux variables.</p></li>
<li><p>Le cas <strong>b</strong> illustre une relation linéaire négative entre les deux variables puisqu’elles vont en sens inverse. Autrement dit, quand les valeurs de <em>X</em> augmentent, celles de <em>Y</em> diminuent, et inversement. En guise d’exemple, pour les secteurs de recensement d’une métropole donnée, il est fort probable que le revenu médian des ménages soit associé négativement avec le taux de chômage. De nouveau, une droite résumerait efficacement cette relation.</p></li>
<li><p>Pour le cas <strong>c</strong>, il y a une relation entre les deux variables, mais qui n’est pas linéaire. Le nuage de points entre les deux variables prend d’ailleurs une forme parabolique qui traduit une relation curvilinéaire. Concrètement, nous observons une relation positive jusqu’à un certain seuil, puis une relation négative.</p></li>
<li><p>Pour le cas <strong>d</strong>, la relation entre les deux variables est aussi curvilinéaire; d’abord négative, puis positive.</p></li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/bivariee/figure2.jpg" alt="Relations linéaires et curvilinéaires entre deux variables continues" width="85%" />
<p class="caption">
(#fig:fig2)Relations linéaires et curvilinéaires entre deux variables continues
</p>
</div>
<p>Prenons un exemple concret pour illuster le cas <strong>c</strong>. Dans une étude portant sur l’équité environnementale et la végétation à Montréal, Pham <em>et al.</em> <span class="citation">(<a href="#ref-PhamApparicioSeguin2012" role="doc-biblioref">2012</a>)</span> ont montré qu’il existe une relation curvilinéaire entre l’âge médian des bâtiments résidentiels (axe des abscisses) et les couvertures végétales (axes des ordonnées) :</p>
<ul>
<li>La couverture de la végétation totale et celle des arbres augmentent quand l’âge médian des bâtiments croît jusqu’à atteindre un pic autour de 60 ans (autour de 1950). Nous pouvons supposer que les secteurs récemment construits, surtout ceux dans les banlieues, présentent des niveaux de végétation plus faibles. Au fur et à mesure que le quartier vieillit, les arbres plantés lors du développement résidentiel deviennent matures — canopée plus importante –, d’où l’augmentation des valeurs de la couverture végétale totale et de celle des arbres.</li>
<li>Par contre, dans les secteurs développés avant les années 1950, la densité du bâti est plus forte, laissant ainsi moins de place pour la végétation, ce qui explique une diminution des variables relatives à la couverture végétale (figure @ref(fig:fig3)).</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/bivariee/figure3.jpg" alt="Exemples de relations curvilinéaires" width="65%" />
<p class="caption">
(#fig:fig3)Exemples de relations curvilinéaires
</p>
</div>
<p>Dans les sous-sections suivantes, nous décrivons deux statistiques descriptives et exploratoires – la covariance (section @ref(sect042)) et la corrélation (section @ref(sect043)) – utilisées pour évaluer la <strong>relation linéaire</strong> entre deux variables continues (cas <strong>a</strong> et <strong>b</strong> à la figure @ref(fig:fig2)). Ces deux mesures permettent de mesurer le degré d’association entre deux variables, sans que l’une soit la variable dépendante (variable à expliquer) et l’autre, la variable indépendante (variable explicative). Puis, nous décrivons la régression linéaire simple (section @ref(sect044)) qui permet justement de prédire une variable dépendante (<em>Y</em>) à partir d’une variable indépendante (<em>X</em>).</p>
</div>
<div id="sect042" class="section level2">
<h2><span class="header-section-number">4.2</span> Covariance</h2>
<div id="sect0421" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Formulation</h3>
<p>La covariancecovariance (équation @ref(eq:cov)), écrite <span class="math inline">\(cov(x,y)\)</span>, est égale à la moyenne du produit des écarts des valeurs des deux variables par rapport à leurs moyennes respectives :</p>

<p><span class="math display">\[\begin{equation}
cov(x,y) = \frac{\sum_{i=1}^n (x_{i}-\bar{x})(y_{i}-\bar{y})}{n-1} = \frac{covariation}{n-1}
(\#eq:cov)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(n\)</span> étant le nombre d’observations; <span class="math inline">\(\bar{x}\)</span> et <span class="math inline">\(\bar{y}\)</span> (prononcez x et y barre) étant les moyennes respectives des variables <em>X</em> et <em>Y</em>.</p>
</div>
<div id="sect0422" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Interprétation</h3>
<p>Le numérateur de l’équation @ref(eq:cov) représente la covariationcovariance, soit la somme du produit des déviations des valeurs <span class="math inline">\(x_{i}\)</span> et <span class="math inline">\(y_{i}\)</span> par rapport à leurs moyennes respectives (<span class="math inline">\(\bar{x}\)</span> et <span class="math inline">\(\bar{y}\)</span>). La covariance est donc la covariation divisée par le nombre d’observations, soit la moyenne de la covariation. Sa valeur peut être positive ou négative :</p>
<ul>
<li>Positive quand les deux variables varient dans le même sens, c’est-à-dire lorsque les valeurs de la variable <em>X</em> s’éloignent de la moyenne, les valeurs de <em>Y</em> s’éloignent aussi dans le même sens; et elle est négative pour une situation inverse.</li>
<li>Quand la covariance est égale à 0, il n’y a pas de relation entre les variables <em>X</em> et <em>Y</em>. Plus sa valeur absolue est élevée, plus la relation entre les deux variables <em>X</em> et <em>Y</em> est importante.</li>
</ul>
<p>Ainsi, la covariance correspond à un centrage des variables, c’est-à-dire à soustraire à chaque valeur de la variable sa moyenne correspondante. L’inconvénient majeur de l’utilisation de la covariance est qu’elle est tributaire des unités de mesure des deux variables. Par exemple, si nous calculons la covariance entre le pourcentage de personnes à faible revenu et la densité de population (habitants au km<sup>2</sup>) au niveau des secteurs de recensement de la région métropolitaine de Montréal, nous obtenons une valeur de covariance de 33 625. En revanche, si la densité de population est exprimée en milliers d’habitants au km<sup>2</sup>, la valeur de la covariance sera de 33,625, alors que la relation linéaire entre les deux variables reste la même comme illustré à la figure @ref(fig:fig4). Pour remédier à ce problème, nous privilégions l’utilisation du coefficient de corrélation.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig4-1.png" alt="Covariance et unités de mesure" width="75%" />
<p class="caption">
(#fig:fig4)Covariance et unités de mesure
</p>
</div>
</div>
</div>
<div id="sect043" class="section level2">
<h2><span class="header-section-number">4.3</span> Corrélation</h2>
<div id="sect0431" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Formulation</h3>
<p>Le coefficient de corrélation de Pearson (<span class="math inline">\(r\)</span>) est égal à la covariance (numérateur) divisée par le produit des écarts-types des deux variables <em>X</em> et <em>Y</em> (dénominateur). Il représente une standardisation de la covariance. Autrement dit, le coefficient de corrélation repose sur un centrage (moyenne = 0) et une réduction (variance = 1) des deux variables, c’est-à-dire qu’il faut soustraire de chaque valeur sa moyenne correspondante et la diviser par son écart-type. Il correspond ainsi à la moyenne du produit des deux variables centrées réduites. Il s’écrit alors :</p>

<p><span class="math display">\[\begin{equation}
r_{xy} = \frac{\sum_{i=1}^n (x_{i}-\bar{x})(y_{i}-\bar{y})}{(n-1)\sqrt{\sum_{i=1}^n(x_i - \bar{x})^2(y_i - \bar{y})^2}}=\sum_{i=1}^n\frac{Zx_iZy_i}{n-1}
(\#eq:cor)
\end{equation}\]</span>
</p>
<p>La syntaxe ci-dessous démontre que le coefficient de corrélation de Pearson est bien égal à la moyenne du produit de deux variables centrées réduites.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1"></a><span class="kw">library</span>(<span class="st">&quot;MASS&quot;</span>)</span>
<span id="cb454-2"><a href="#cb454-2"></a>N &lt;-<span class="st"> </span><span class="dv">1000</span>     <span class="co"># nombre d&#39;observations</span></span>
<span id="cb454-3"><a href="#cb454-3"></a>moy_x &lt;-<span class="st"> </span><span class="dv">50</span>   <span class="co"># moyenne de x</span></span>
<span id="cb454-4"><a href="#cb454-4"></a>moy_y &lt;-<span class="st"> </span><span class="dv">40</span>   <span class="co"># moyenne de y</span></span>
<span id="cb454-5"><a href="#cb454-5"></a>sd_x &lt;-<span class="st"> </span><span class="dv">10</span>    <span class="co"># écart-type de x</span></span>
<span id="cb454-6"><a href="#cb454-6"></a>sd_y &lt;-<span class="st"> </span><span class="dv">8</span>     <span class="co"># écart-type de y</span></span>
<span id="cb454-7"><a href="#cb454-7"></a>rxy &lt;-<span class="st"> </span><span class="fl">.80</span> <span class="co"># corrélation entre X et Y</span></span>
<span id="cb454-8"><a href="#cb454-8"></a><span class="co">## création de deux variables fictives normalement distribuées et corrélées entre elles</span></span>
<span id="cb454-9"><a href="#cb454-9"></a><span class="co"># Création d&#39;une matrice de covariance</span></span>
<span id="cb454-10"><a href="#cb454-10"></a>cov &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(sd_x<span class="op">^</span><span class="dv">2</span>,  rxy<span class="op">*</span>sd_x<span class="op">*</span>sd_y, rxy<span class="op">*</span>sd_x<span class="op">*</span>sd_y, sd_y<span class="op">^</span><span class="dv">2</span>), <span class="dt">nrow=</span><span class="dv">2</span>)</span>
<span id="cb454-11"><a href="#cb454-11"></a><span class="co"># Création du tableau de données avec deux variables</span></span>
<span id="cb454-12"><a href="#cb454-12"></a>df1 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">mvrnorm</span>(N, <span class="kw">c</span>(moy_x, moy_y), cov))</span>
<span id="cb454-13"><a href="#cb454-13"></a><span class="co"># Centrage et réduction des deux variables</span></span>
<span id="cb454-14"><a href="#cb454-14"></a>df1<span class="op">$</span>zV1 &lt;-<span class="st"> </span><span class="kw">scale</span>(df1<span class="op">$</span>V1, <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</span>
<span id="cb454-15"><a href="#cb454-15"></a>df1<span class="op">$</span>zV2 &lt;-<span class="st"> </span><span class="kw">scale</span>(df1<span class="op">$</span>V2, <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</span>
<span id="cb454-16"><a href="#cb454-16"></a><span class="co"># Corrélation de Pearson</span></span>
<span id="cb454-17"><a href="#cb454-17"></a>cor1 &lt;-<span class="st"> </span><span class="kw">cor</span>(df1<span class="op">$</span>V1, df1<span class="op">$</span>V2)</span>
<span id="cb454-18"><a href="#cb454-18"></a>cor2 &lt;-<span class="st"> </span><span class="kw">sum</span>(df1<span class="op">$</span>zV1<span class="op">*</span>df1<span class="op">$</span>zV2) <span class="op">/</span><span class="st"> </span>(<span class="kw">nrow</span>(df1)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb454-19"><a href="#cb454-19"></a><span class="kw">cat</span>(<span class="st">&quot;Corrélation de Pearson = &quot;</span>,<span class="kw">round</span>(cor1,<span class="dv">5</span>),</span>
<span id="cb454-20"><a href="#cb454-20"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Moyenne du produit des variables centrées-réduites =&quot;</span>, <span class="kw">round</span>(cor2,<span class="dv">5</span>))</span></code></pre></div>
<pre><code>## Corrélation de Pearson =  0.79797 
## Moyenne du produit des variables centrées-réduites = 0.79797</code></pre>
</div>
<div id="sect0432" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Interprétation</h3>
<p>Le coefficient de corrélation <span class="math inline">\(r\)</span> varie de −1 à 1 avec :</p>
<ul>
<li>0 quand il n’y a pas de relation linéaire entre les variables <em>X</em> et <em>Y</em>;</li>
<li>−1 quand il y a relation linéaire négative parfaite;</li>
<li>1 quand il y a une relation linéaire positive parfaite (figure @ref(fig:fig5)).</li>
</ul>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig5-1.png" alt="Relations entre deux variables continues et coefficients de corrélation de Pearson" width="75%" />
<p class="caption">
(#fig:fig5)Relations entre deux variables continues et coefficients de corrélation de Pearson
</p>
</div>
<p>Concrètement, le signe du coefficient de corrélation indique si la relation est positive ou négative et la valeur absolue du coefficient indique le degré d’association entre les deux variables. Reste à savoir comment déterminer qu’une valeur de corrélation est faible, moyenne ou forte. En sciences sociales, nous utilisons habituellement les intervalles de valeurs reportés au tableau @ref(tab:tableIntervallesCorrelation). Toutefois, ces seuils sont tout à fait arbitraires. En effet, dépendamment de la discipline de recherche (sciences sociales, sciences de la santé, sciences physiques, etc.) et des variables à l’étude, l’interprétation d’une valeur de corrélation peut varier. Par exemple, en sciences sociales, une valeur de corrélation de 0,2 est considérée comme très faible alors qu’en sciences de la santé, elle pourrait être considérée comme intéressante. À l’opposé, une valeur de 0,9 en sciences physiques pourrait être considérée comme faible. Il convient alors d’utiliser ces intervalles avec précaution.</p>
<table>
<caption>
(#tab:tableIntervallesCorrelation)Intervalles pour l’interprétation du coefficient de corrélation habituellement utilisés en sciences sociales
</caption>
<thead>
<tr>
<th style="text-align:left;">
Corrélation
</th>
<th style="text-align:left;">
Négative
</th>
<th style="text-align:left;">
Positive
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Faible
</td>
<td style="text-align:left;">
de -0,3 à 0,0
</td>
<td style="text-align:left;">
de 0,0 à 0,3
</td>
</tr>
<tr>
<td style="text-align:left;">
Moyenne
</td>
<td style="text-align:left;">
de -0,5 à -0,3
</td>
<td style="text-align:left;">
de 0,3 à 0,5
</td>
</tr>
<tr>
<td style="text-align:left;">
Forte
</td>
<td style="text-align:left;">
de -1,0 à -0,5
</td>
<td style="text-align:left;">
de 0,5 à 1,0
</td>
</tr>
</tbody>
</table>
<p>Le coefficient de corrélation mis au carré représente le coefficient de détermination et indique la proportion de la variance de la variable <em>Y</em> expliquée par la variable <em>X</em> et inversement. Par exemple, un coefficient de corrélation de −0,70 signale que 49 % de la variance de la variable de <em>Y</em> est expliquée par <em>X</em> (figure @ref(fig:fig6)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig6-1.png" alt="Coefficient de corrélation et proportion de la variance expliquée" width="75%" />
<p class="caption">
(#fig:fig6)Coefficient de corrélation et proportion de la variance expliquée
</p>
</div>
<p><strong>Condition d’application.</strong> L’utilisation du coefficient de corrélation de Pearson nécessite que les deux variables continues soient normalement distribuées et qu’elles ne comprennent pas de valeurs aberrantes ou extrêmes. D’ailleurs, plus le nombre d’observations est réduit, plus la présence de valeurs extrêmes a une répercussion importante sur le résultat du coefficient de corrélation de Pearson. En guise d’exemple, dans le nuage de points à gauche de la figure @ref(fig:fig7), il est possible d’identifier des valeurs extrêmes qui se démarquent nettement dans le jeu de données : six observations avec une densité de population supérieure à 20 000 habitants au km<sup>2</sup> et deux observations avec un pourcentage de 65 ans et plus supérieur à 55 %. Si l’on supprime ces observations (ce qui est défendable dans ce contexte) – soit moins d’un pour cent des observations du jeu de données initial –, la valeur du coefficient de corrélation passe de −0,158 à −0,194, signalant une augmentation du degré d’association entre les deux variables.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig7-1.png" alt="Illustation de l’effet des valeurs extrêmes sur le coefficient de Pearson" width="75%" />
<p class="caption">
(#fig:fig7)Illustation de l’effet des valeurs extrêmes sur le coefficient de Pearson
</p>
</div>
</div>
<div id="sect0433" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Corrélations pour des variables anormalement distribuées (coefficient de Spearman, tau de Kendall)</h3>
<p>Lorsque les variables sont fortement anormalement distribuées, le coefficient de corrélation de Pearson est peu adapté pour analyser leurs relations linéaires. Il est alors conseillé d’utiliser deux statistiques non-paramétriques : principalement, le coefficient de corrélation de Spearman (<em>rho</em>) et secondairement, le tau (<span class="math inline">\(\tau\)</span>) de Kendall, qui varient aussi tous deux de −1 à 1.
Calculé sur les rangs des deux variables, le <strong>coefficient de Spearman</strong> est le rapport entre la covariance des deux variables de rangs sur les écarts-types des variables de rangs. En d’autres termes, il représente simplement le coefficient de Pearson calculé sur les rangs des deux variables :</p>

<p><span class="math display">\[\begin{equation}
r_{xy} = \frac{cov(rg_{x},rg_{y})}{\sigma_{rg_{x}}\sigma_{rg_{y}}}
(\#eq:spearman)
\end{equation}\]</span>
</p>
<p>La syntaxe ci-dessous démontre clairement que le coefficient de Spearman est bien le coefficient de Pearson calculé sur les rangs (@ref(sect0431)).</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1"></a>df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/bivariee/sr_rmr_mtl_2016.csv&quot;</span>)</span>
<span id="cb456-2"><a href="#cb456-2"></a><span class="co"># Transformation des deux variables en rangs</span></span>
<span id="cb456-3"><a href="#cb456-3"></a>df<span class="op">$</span>HabKm2_rang &lt;-<span class="st"> </span><span class="kw">rank</span>(df<span class="op">$</span>HabKm2)</span>
<span id="cb456-4"><a href="#cb456-4"></a>df<span class="op">$</span>A65plus_rang &lt;-<span class="st"> </span><span class="kw">rank</span>(df<span class="op">$</span>A65plus)</span>
<span id="cb456-5"><a href="#cb456-5"></a><span class="co"># Coefficient de Spearman avec la fonction cor et la méthode spearman</span></span>
<span id="cb456-6"><a href="#cb456-6"></a><span class="kw">cat</span>(<span class="st">&quot;Coefficient de Spearman = &quot;</span>, </span>
<span id="cb456-7"><a href="#cb456-7"></a>    <span class="kw">round</span>(<span class="kw">cor</span>(df<span class="op">$</span>HabKm2, df<span class="op">$</span>A65plus, <span class="dt">method =</span> <span class="st">&quot;spearman&quot;</span>),<span class="dv">5</span>))</span></code></pre></div>
<pre><code>## Coefficient de Spearman =  -0.11953</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1"></a><span class="co"># Coefficient de Pearson sur les variables transformées en rangs</span></span>
<span id="cb458-2"><a href="#cb458-2"></a><span class="kw">cat</span>(<span class="st">&quot;Coefficient de Pearson calculé sur les variables transformées en rangs = &quot;</span>, </span>
<span id="cb458-3"><a href="#cb458-3"></a>    <span class="kw">round</span>(<span class="kw">cor</span>(df<span class="op">$</span>HabKm2_rang, df<span class="op">$</span>A65plus_rang, <span class="dt">method =</span> <span class="st">&quot;pearson&quot;</span>),<span class="dv">5</span>))</span></code></pre></div>
<pre><code>## Coefficient de Pearson calculé sur les variables transformées en rangs =  -0.11953</code></pre>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1"></a><span class="co"># Vérification avec l&#39;équation</span></span>
<span id="cb460-2"><a href="#cb460-2"></a><span class="kw">cat</span>(<span class="st">&quot;Covariance divisée par le produit des écarts-types sur les rangs :&quot;</span>,</span>
<span id="cb460-3"><a href="#cb460-3"></a>    <span class="kw">round</span>(<span class="kw">cov</span>(df<span class="op">$</span>HabKm2_rang, df<span class="op">$</span>A65plus_rang) <span class="op">/</span><span class="st"> </span>(<span class="kw">sd</span>(df<span class="op">$</span>HabKm2_rang)<span class="op">*</span><span class="kw">sd</span>(df<span class="op">$</span>A65plus_rang)),<span class="dv">5</span>))</span></code></pre></div>
<pre><code>## Covariance divisée par le produit des écarts-types sur les rangs : -0.11953</code></pre>
<p>Le <strong>tau de Kendall</strong> est une autre mesure non paramétrique calculée comme suit :</p>

<p><span class="math display">\[\begin{equation}
\tau = \frac{n_{c}-n_{d}}{\frac{1}{2}n(n-1)}
(\#eq:tau)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(n_{c}\)</span> et <span class="math inline">\(n_{d}\)</span> qui sont respectivement les nombres de paires d’observations <strong>c</strong>oncordantes et <strong>d</strong>iscordantes; et le dénominateur étant le nombre total de paires d’observations. Des paires sont dites concordantes quand les valeurs des deux observations vont dans le même sens pour les deux variables (<span class="math inline">\(x_{i}&gt;x_{j}\)</span> et <span class="math inline">\(y_{i}&gt;y_{j}\)</span> ou <span class="math inline">\(x_{i}&lt;x_{j}\)</span> et <span class="math inline">\(y_{i}&lt;y_{j}\)</span>), et discordantes quand elles vont en sens contraire (<span class="math inline">\(x_{i}&gt;x_{j}\)</span> et <span class="math inline">\(y_{i}&lt;y_{j}\)</span> ou <span class="math inline">\(x_{i}&lt;x_{j}\)</span> et <span class="math inline">\(y_{i}&gt;y_{j}\)</span>). Contrairement au calcul du coefficient de Spearman, celui du tau Kendall peut être chronophage : plus le nombre d’observations est élevé, plus les temps de calcul et la mémoire utilisée sont importants. En effet, avec <em>n</em>=1000, le nombre de paires d’observations (<span class="math inline">\({\mbox{0,5}\times n(n-1)}\)</span>) est de 499 500, contre près de 50 millions avec <em>n</em>=10 000 (49 995 000).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig8-1.png" alt="Comparaison des coefficients de Pearson, Spearman et Kendall sur deux variables anormalement distribuées" width="75%" />
<p class="caption">
(#fig:fig8)Comparaison des coefficients de Pearson, Spearman et Kendall sur deux variables anormalement distribuées
</p>
</div>
<p>À la lecture des deux histogrammes à la figure @ref(fig:fig8), il est clair que les variables <em>densité de population</em> et <em>pourcentage de personnes ayant 65 ou plus</em> sont très anormalement distribuées. Dans ce contexte, l’utilisation du coefficient de Pearson peut nous amener à mésestimer la relation existant entre les deux variables. Notez que les coefficients de Spearman et de Kendall sont tous les deux plus faibles.</p>
</div>
<div id="sect0434" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Corrélations robustes (<em>Biweight midcorrelation</em>, <em>Percentage bend correlation</em> et la corrélation <em>pi</em> de Shepherd)</h3>
<p>Dans l’exemple donné à la figure @ref(fig:fig7), nous avions identifié des valeurs extrêmes et les avons retirées du jeu de données. Cette pratique peut tout à fait se justifier quand les données sont erronées (un capteur de pollution renvoyant une valeur négative, un questionnaire rempli par un mauvais plaisantin, etc.), mais parfois les cas extrêmes font partie du phénomène à analyser. Dans ce contexte, les identifier et les retirer peut paraître arbitraire. Une solution plus élégante est d’utiliser des méthodes dites <strong>robustes</strong>, c’est à dire moins sensibles aux valeurs extrêmes. Pour les corrélations, la <em>Biweight midcorrelation</em> <span class="citation">(Wilcox <a href="#ref-wilcox1994percentage" role="doc-biblioref">1994</a>)</span> est au coefficient de Pearson ce que la médiane est à la moyenne. Il est donc pertinent de l’utiliser pour des jeux de données présentant potentiellement des valeurs extrêmes. Elle est calculée comme suit :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;u_{i} = \frac{x_{i} - med(x)}{9 \times (med(|x_{i} - med(x)|))} \text{ et } v_{i} = \frac{y_{i} - med(y)}{9 \times (med(|y_{i} - med(y)|))}\\
&amp;w_{i}^{(x)} = (1 - u_{i}^2)^2 I(1 - |u_{i}|) \text{ et } w_{i}^{(y)} = (1 - v_{i}^2)^2 I(1 - |v_{i}|)\\
&amp;I(x) = 
\begin{cases}
1, \text{si } x = 1\\
0, \text{sinon}
\end{cases}\\
&amp;\tilde{x}_{i} = \frac{(x_{i} - med(x))w_{i}^{(x)}}{\sqrt{(\sum_{j=1}^m)[(x_{j} - med(x))w_{j}^{(x)}]^2}} \text{ et } \tilde{y}_{i} = \frac{(y_{i} - med(y))w_{i}^{(y)}}{\sqrt{(\sum_{j=1}^m)[(y_{j} - med(y))w_{j}^{(y)}]^2}}\\
&amp;bicor(x,y) = \sum_{i=1}^m \tilde{x_i}\tilde{y_i}
\end{aligned}
(\#eq:bicor)
\end{equation}\]</span>
</p>
<p>Comme le souligne l’équation @ref(eq:bicor), la <em>Biweight midcorrelation</em> est basée sur les écarts à la médiane, plutôt que sur les écarts à la moyenne.</p>
<p>Assez proche de la <em>Biweight midcorrelation</em>, la <em>Percentage bend correlation</em> se base également sur la médiane des variables <em>X</em> et <em>Y</em>. Le principe général est de donner un poids plus faible dans le calcul de cette corrélation à un certain pourcentage des observations (20 % sont généralement recommandés) dont la valeur est éloignée de la médiane. Pour une description complète de la méthode, vous pouvez lire l’article de <span class="citation">Wilcox (<a href="#ref-wilcox1994percentage" role="doc-biblioref">1994</a>)</span>.</p>
<p>Enfin, une autre option est l’utilisation de la corrélation <span class="math inline">\(pi\)</span> de Sherphred <span class="citation">(Schwarzkopf, Haas et Rees <a href="#ref-Schwarzkopf2012" role="doc-biblioref">2012</a>)</span>. Il s’agit simplement d’une méthode en deux étapes. Premièrement, les valeurs extrêmes sont identifiées à l’aide d’une approche par <em>bootstrap</em> utilisant la distance de Mahalanobis (calculant les écarts multivariés entre les observations). Deuxièmement, le coefficient de <em>Spearman</em> est calculé sur les observations restantes.</p>
<p>Appliquons ces corrélations aux données précédentes. Notez que ce simple code d’une dizaine de lignes permet d’explorer rapidement la corrélation entre deux variables selon six mesures de corrélation.</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="#cb462-1"></a><span class="kw">library</span>(<span class="st">&quot;correlation&quot;</span>)</span>
<span id="cb462-2"><a href="#cb462-2"></a>df1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/bivariee/sr_rmr_mtl_2016.csv&quot;</span>)</span>
<span id="cb462-3"><a href="#cb462-3"></a>methods &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Pearson&quot;</span>,<span class="st">&quot;Spearman&quot;</span>,<span class="st">&quot;Biweight&quot;</span>,<span class="st">&quot;Percentage&quot;</span>,<span class="st">&quot;Shepherd&quot;</span>)</span>
<span id="cb462-4"><a href="#cb462-4"></a>rs &lt;-<span class="st"> </span><span class="kw">lapply</span>(methods,<span class="cf">function</span>(m){</span>
<span id="cb462-5"><a href="#cb462-5"></a>  test &lt;-<span class="st"> </span>correlation<span class="op">::</span><span class="kw">cor_test</span>(<span class="dt">data =</span> df1, <span class="dt">x=</span><span class="st">&quot;Hab1000Km2&quot;</span>,<span class="dt">y=</span><span class="st">&quot;A65plus&quot;</span>,<span class="dt">method =</span> m, <span class="dt">ci=</span><span class="fl">0.95</span>)</span>
<span id="cb462-6"><a href="#cb462-6"></a>  <span class="kw">return</span>(<span class="kw">c</span>(test<span class="op">$</span>r,test<span class="op">$</span>CI_low, test<span class="op">$</span>CI_high))</span>
<span id="cb462-7"><a href="#cb462-7"></a>  })</span>
<span id="cb462-8"><a href="#cb462-8"></a>dfCorr &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">do.call</span>(rbind,rs))</span>
<span id="cb462-9"><a href="#cb462-9"></a><span class="kw">names</span>(dfCorr) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;r&quot;</span>,<span class="st">&quot;IC_2.5&quot;</span>,<span class="st">&quot;IC_97.5&quot;</span>)</span>
<span id="cb462-10"><a href="#cb462-10"></a>dfCorr<span class="op">$</span>method &lt;-<span class="st"> </span>methods</span>
<span id="cb462-11"><a href="#cb462-11"></a></span>
<span id="cb462-12"><a href="#cb462-12"></a><span class="co"># Impression du tableau avec le package stargazer</span></span>
<span id="cb462-13"><a href="#cb462-13"></a><span class="kw">library</span>(stargazer)</span>
<span id="cb462-14"><a href="#cb462-14"></a><span class="kw">stargazer</span>(dfCorr, <span class="dt">type=</span><span class="st">&quot;text&quot;</span>, <span class="dt">summary=</span><span class="ot">FALSE</span>, <span class="dt">rownames=</span><span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="ot">FALSE</span>, <span class="dt">digits =</span> <span class="dv">3</span>,</span>
<span id="cb462-15"><a href="#cb462-15"></a>          <span class="dt">title=</span><span class="st">&quot;Comparaison de différentes corrélations pour les deux variables&quot;</span>)</span></code></pre></div>
<table>
<caption>
(#tab:robcorr)Comparaison de différentes corrélations pour les deux variables
</caption>
<thead>
<tr>
<th style="text-align:right;">
r
</th>
<th style="text-align:right;">
IC 2,5 %
</th>
<th style="text-align:right;">
IC 97,5 %
</th>
<th style="text-align:left;">
Méthode
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
-0,158
</td>
<td style="text-align:right;">
-0,219
</td>
<td style="text-align:right;">
-0,095
</td>
<td style="text-align:left;">
Pearson
</td>
</tr>
<tr>
<td style="text-align:right;">
-0,120
</td>
<td style="text-align:right;">
-0,184
</td>
<td style="text-align:right;">
-0,055
</td>
<td style="text-align:left;">
Spearman
</td>
</tr>
<tr>
<td style="text-align:right;">
-0,137
</td>
<td style="text-align:right;">
-0,199
</td>
<td style="text-align:right;">
-0,074
</td>
<td style="text-align:left;">
Biweight
</td>
</tr>
<tr>
<td style="text-align:right;">
-0,174
</td>
<td style="text-align:right;">
-0,235
</td>
<td style="text-align:right;">
-0,111
</td>
<td style="text-align:left;">
Percentage
</td>
</tr>
<tr>
<td style="text-align:right;">
-0,119
</td>
<td style="text-align:right;">
-0,185
</td>
<td style="text-align:right;">
-0,052
</td>
<td style="text-align:left;">
Shepherd
</td>
</tr>
</tbody>
</table>
<p>Il est intéressant de mentionner que ces trois corrélations sont rarement utilisées malgré leur pertinence dans de nombreux cas d’application. Nous faisons face ici à un cercle vicieux dans la recherche : les méthodes les plus connues sont les plus utilisées, car elles sont plus facilement acceptées par la communauté scientifique. Des méthodes plus élaborées nécessitent davantage de justification et de discussion, ce qui peut conduire à de multiples sessions de corrections/resoumissions pour qu’un article soit accepté, malgré le fait qu’elles puissent être plus adaptées au jeu de données à l’étude.</p>
</div>
<div id="sect0435" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Significativité des coefficients de corrélation</h3>
<p>Quelle que soit la méthode utilisée, il convient de vérifier si le coefficient de corrélation est ou non statistiquement différent de 0. En effet, nous travaillons la plupart du temps avec des données d’échantillonnage, et très rarement avec des populations complètes. En collectant un nouvel échantillon, aurions-nous obtenu des résultats différents? Le calcul de ce degré de significativité permet de quantifier le niveau de certitude quant à l’existence d’une corrélation entre les deux variables, positive ou négative. Cet objectif est réalisé en calculant la valeur de <em>t</em> et le nombre de degrés de liberté : <span class="math inline">\(t=\sqrt{\frac{n-2}{1-r^2}}\)</span> et <span class="math inline">\(dl = n-2\)</span> avec <span class="math inline">\(r\)</span> et <span class="math inline">\(n\)</span> étant respectivement le coefficient de corrélation et le nombre d’observations. De manière classique, nous utiliserons la table des valeurs critiques de la distribution de <span class="math inline">\(t\)</span> : si la valeur de <span class="math inline">\(t\)</span> est supérieure à la valeur critique (avec <em>p</em> = 0,05 et le nombre de degrés de liberté), alors le coefficient est significatif à 5 %. En d’autres termes, si la vraie corrélation entre les deux variables (calculable uniquement à partir des populations complètes) était 0, alors la probabilité de collecter notre échantillon serait inférieure à 5 %. Dans ce contexte, nous peuvons raisonnablement rejeter l’hypothèse nulle (corrélation de 0).</p>
<p>La courte syntaxe ci-dessous illustre comment calculer la valeur de <span class="math inline">\(t\)</span>, le nombre de degrés de liberté et la valeur de <em>p</em> pour une corrélation donnée.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1"></a>df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/bivariee/sr_rmr_mtl_2016.csv&quot;</span>)</span>
<span id="cb463-2"><a href="#cb463-2"></a>r &lt;-<span class="st"> </span><span class="kw">cor</span>(df<span class="op">$</span>A65plus, df<span class="op">$</span>LogTailInc)     <span class="co"># Corrélation</span></span>
<span id="cb463-3"><a href="#cb463-3"></a>n &lt;-<span class="st"> </span><span class="kw">nrow</span>(df)                           <span class="co"># Nombre d&#39;observations</span></span>
<span id="cb463-4"><a href="#cb463-4"></a>dl &lt;-<span class="st"> </span><span class="kw">nrow</span>(df)<span class="op">-</span><span class="dv">2</span>                        <span class="co"># degrés de liberté</span></span>
<span id="cb463-5"><a href="#cb463-5"></a>t &lt;-<span class="st">  </span>r<span class="op">*</span><span class="kw">sqrt</span>((n<span class="dv">-2</span>)<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>r<span class="op">^</span><span class="dv">2</span>))             <span class="co"># Valeur de T</span></span>
<span id="cb463-6"><a href="#cb463-6"></a>p &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">pt</span>(<span class="kw">abs</span>(t),dl))                <span class="co"># Valeur de p</span></span>
<span id="cb463-7"><a href="#cb463-7"></a><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Corrélation =&quot;</span>, <span class="kw">round</span>(r, <span class="dv">4</span>),       </span>
<span id="cb463-8"><a href="#cb463-8"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Valeur de t =&quot;</span>, <span class="kw">round</span>(t, <span class="dv">4</span>),</span>
<span id="cb463-9"><a href="#cb463-9"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Degrés de liberté =&quot;</span>, dl,</span>
<span id="cb463-10"><a href="#cb463-10"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">p=&quot;</span>, <span class="kw">round</span>(p, <span class="dv">4</span>))        </span></code></pre></div>
<pre><code>## 
## Corrélation = -0.0693 
## Valeur de t = -2.1413 
## Degrés de liberté = 949 
## p= 0.0325</code></pre>
<p>Plus simplement, la fonction <code>cor.test</code> permet d’obtenir en une seule ligne de code le coefficient de corrélation, l’intervalle de confiance à 95 % et les valeurs de <em>t</em> et de <em>p</em>, comme illustré dans la syntaxe ci-dessous. Si l’intervalle de confiance est à cheval sur 0, c’est-à-dire que la borne inférieure est négative et la borne supérieure positive, alors le coefficient de corrélation n’est pas significatif au seuil choisi (95 % habituellement). Dans l’exemple ci-dessous, la relation linéaire entre les deux variables est significativement négative avec une corrélation de Pearson de −0,158 (<em>p</em> = 0,000) et un intervalle de confiance à 95 % de −0,219 à −0,095.</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1"></a><span class="co"># Intervalle de confiance à 95 %</span></span>
<span id="cb465-2"><a href="#cb465-2"></a><span class="kw">cor.test</span>(df<span class="op">$</span>HabKm2, df<span class="op">$</span>A65plus, <span class="dt">conf.level =</span> <span class="fl">.95</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  df$HabKm2 and df$A65plus
## t = -4.9318, df = 949, p-value = 9.616e-07
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  -0.2194457 -0.0954687
## sample estimates:
##        cor 
## -0.1580801</code></pre>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1"></a><span class="co"># Vous pouvez accéder à chaque sortie de la fonction cor.test comme suit :</span></span>
<span id="cb467-2"><a href="#cb467-2"></a>p &lt;-<span class="st"> </span><span class="kw">cor.test</span>(df<span class="op">$</span>HabKm2, df<span class="op">$</span>A65plus)</span>
<span id="cb467-3"><a href="#cb467-3"></a><span class="kw">cat</span>(<span class="st">&quot;Valeur de corrélation = &quot;</span>, <span class="kw">round</span>(p<span class="op">$</span>estimate,<span class="dv">3</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb467-4"><a href="#cb467-4"></a>    <span class="st">&quot;Intervalle à 95 % = [&quot;</span>, <span class="kw">round</span>(p<span class="op">$</span>conf.int[<span class="dv">1</span>],<span class="dv">3</span>), <span class="st">&quot; &quot;</span>, <span class="kw">round</span>(p<span class="op">$</span>conf.int[<span class="dv">2</span>],<span class="dv">3</span>), <span class="st">&quot;]&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb467-5"><a href="#cb467-5"></a>    <span class="st">&quot;Valeur de t = &quot;</span>, <span class="kw">round</span>(p<span class="op">$</span>statistic,<span class="dv">3</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb467-6"><a href="#cb467-6"></a>    <span class="st">&quot;Valeur de p = &quot;</span>, <span class="kw">round</span>(p<span class="op">$</span>p.value,<span class="dv">3</span>),<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## Valeur de corrélation = -0.158
## Intervalle à 95 % = [-0.219 -0.095]
## Valeur de t = -4.932
## Valeur de p = 0</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="#cb469-1"></a><span class="co"># Corrélation de Spearman</span></span>
<span id="cb469-2"><a href="#cb469-2"></a><span class="kw">cor.test</span>(df<span class="op">$</span>HabKm2, df<span class="op">$</span>A65plus, <span class="dt">method =</span> <span class="st">&quot;spearman&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Spearman&#39;s rank correlation rho
## 
## data:  df$HabKm2 and df$A65plus
## S = 160482182, p-value = 0.0002202
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##        rho 
## -0.1195333</code></pre>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1"></a><span class="co"># Corrélation de Kendall</span></span>
<span id="cb471-2"><a href="#cb471-2"></a><span class="kw">cor.test</span>(df<span class="op">$</span>HabKm2, df<span class="op">$</span>A65plus, <span class="dt">method=</span><span class="st">&quot;kendall&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Kendall&#39;s rank correlation tau
## 
## data:  df$HabKm2 and df$A65plus
## z = -3.7655, p-value = 0.0001662
## alternative hypothesis: true tau is not equal to 0
## sample estimates:
##         tau 
## -0.08157061</code></pre>
<p>On pourra aussi modifier l’intervalle de confiance, par exemple à 90 % ou 99 %. L’intervalle de confiance et le seuil de significativité doivent être définis avant l’étude. Leur choix doit s’appuyer sur les standards de la littérature du domaine étudié, du niveau de preuve attendu et de la quantité de données.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="#cb473-1"></a><span class="co"># Intervalle à 90 %</span></span>
<span id="cb473-2"><a href="#cb473-2"></a><span class="kw">cor.test</span>(df<span class="op">$</span>HabKm2, df<span class="op">$</span>A65plus, <span class="dt">method =</span><span class="st">&quot;pearson&quot;</span>, <span class="dt">conf.level =</span> <span class="fl">.90</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  df$HabKm2 and df$A65plus
## t = -4.9318, df = 949, p-value = 9.616e-07
## alternative hypothesis: true correlation is not equal to 0
## 90 percent confidence interval:
##  -0.2096826 -0.1055995
## sample estimates:
##        cor 
## -0.1580801</code></pre>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1"></a><span class="co"># Intervalle à 99 %</span></span>
<span id="cb475-2"><a href="#cb475-2"></a><span class="kw">cor.test</span>(df<span class="op">$</span>HabKm2, df<span class="op">$</span>A65plus, <span class="dt">method =</span><span class="st">&quot;pearson&quot;</span>, <span class="dt">conf.level =</span> <span class="fl">.99</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  df$HabKm2 and df$A65plus
## t = -4.9318, df = 949, p-value = 9.616e-07
## alternative hypothesis: true correlation is not equal to 0
## 99 percent confidence interval:
##  -0.23839910 -0.07561336
## sample estimates:
##        cor 
## -0.1580801</code></pre>
<p><strong>Corrélation et <em>bootstrap</em>.</strong> Il est possible d’estimer la corrélation en mobilisant la notion de <em>bootstrap</em>, soit des méthodes d’inférence statistique basées sur des réplications des données initiales par rééchantillonnage. Concrètement, la méthode du <em>bootstrap</em> permet une mesure de la corrélation avec un intervalle de confiance à partir de <em>r</em> réplications, comme illustré à partir de la syntaxe ci-dessous.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="#cb477-1"></a><span class="kw">library</span>(<span class="st">&quot;boot&quot;</span>)</span>
<span id="cb477-2"><a href="#cb477-2"></a>df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/bivariee/sr_rmr_mtl_2016.csv&quot;</span>)</span>
<span id="cb477-3"><a href="#cb477-3"></a><span class="co"># Fonction pour la corrélation</span></span>
<span id="cb477-4"><a href="#cb477-4"></a>correlation &lt;-<span class="st"> </span><span class="cf">function</span>(df, i, X, Y, <span class="dt">cor.type=</span><span class="st">&quot;pearson&quot;</span>){</span>
<span id="cb477-5"><a href="#cb477-5"></a>  <span class="co"># Paramètres de la fonction :</span></span>
<span id="cb477-6"><a href="#cb477-6"></a>  <span class="co"># data : DataFrame</span></span>
<span id="cb477-7"><a href="#cb477-7"></a>  <span class="co"># X et Y : noms des variables X et Y</span></span>
<span id="cb477-8"><a href="#cb477-8"></a>  <span class="co"># cor.type : type de corrélation : c(&quot;pearson&quot;,&quot;spearman&quot;,&quot;kendall&quot;)</span></span>
<span id="cb477-9"><a href="#cb477-9"></a>  <span class="co"># i : indice qui sera utilisé par les réplications (à ne pas modifier)</span></span>
<span id="cb477-10"><a href="#cb477-10"></a>  <span class="kw">cor</span>(df[[X]][i], df[[Y]][i], <span class="dt">method=</span>cor.type)</span>
<span id="cb477-11"><a href="#cb477-11"></a>}</span>
<span id="cb477-12"><a href="#cb477-12"></a><span class="co"># Calcul du Bootstrap avec 5000 réplications</span></span>
<span id="cb477-13"><a href="#cb477-13"></a>corBootstraped &lt;-<span class="st"> </span><span class="kw">boot</span>(<span class="dt">data=</span>df, <span class="co"># nom du tableau</span></span>
<span id="cb477-14"><a href="#cb477-14"></a>                     <span class="dt">statistic =</span> correlation, <span class="co"># appel de la fonction à répliquer </span></span>
<span id="cb477-15"><a href="#cb477-15"></a>                     <span class="dt">R=</span><span class="dv">5000</span>, <span class="co"># nombre de réplications</span></span>
<span id="cb477-16"><a href="#cb477-16"></a>                     <span class="dt">X =</span> <span class="st">&quot;A65plus&quot;</span>,</span>
<span id="cb477-17"><a href="#cb477-17"></a>                     <span class="dt">Y =</span><span class="st">&quot;HabKm2&quot;</span>, </span>
<span id="cb477-18"><a href="#cb477-18"></a>                     <span class="dt">cor.type=</span><span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb477-19"><a href="#cb477-19"></a><span class="co"># Histogramme pour les valeurs de corrélation issues du Bootstrap</span></span>
<span id="cb477-20"><a href="#cb477-20"></a><span class="kw">plot</span>(corBootstraped)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fig9-1.png" alt="Histogramme pour les valeurs de corrélation issues du Bootstrap" width="75%" />
<p class="caption">
(#fig:fig9)Histogramme pour les valeurs de corrélation issues du Bootstrap
</p>
</div>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="#cb478-1"></a><span class="co"># Corrélation &quot;bootstrapée&quot;</span></span>
<span id="cb478-2"><a href="#cb478-2"></a>corBootstraped</span></code></pre></div>
<pre><code>## 
## ORDINARY NONPARAMETRIC BOOTSTRAP
## 
## 
## Call:
## boot(data = df, statistic = correlation, R = 5000, X = &quot;A65plus&quot;, 
##     Y = &quot;HabKm2&quot;, cor.type = &quot;pearson&quot;)
## 
## 
## Bootstrap Statistics :
##       original       bias    std. error
## t1* -0.1580801 -0.002070507  0.03997151</code></pre>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1"></a><span class="co"># Intervalle de confiance du bootstrap à 95 %</span></span>
<span id="cb480-2"><a href="#cb480-2"></a><span class="kw">boot.ci</span>(<span class="dt">boot.out =</span> corBootstraped, <span class="dt">conf =</span> <span class="fl">0.95</span>, <span class="dt">type =</span> <span class="st">&quot;all&quot;</span>)</span></code></pre></div>
<pre><code>## BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
## Based on 5000 bootstrap replicates
## 
## CALL : 
## boot.ci(boot.out = corBootstraped, conf = 0.95, type = &quot;all&quot;)
## 
## Intervals : 
## Level      Normal              Basic         
## 95%   (-0.2344, -0.0777 )   (-0.2402, -0.0859 )  
## 
## Level     Percentile            BCa          
## 95%   (-0.2302, -0.0759 )   (-0.2164, -0.0455 )  
## Calculations and Intervals on Original Scale</code></pre>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1"></a><span class="co"># Comparaison de l&#39;intervalle classique basé sur la valeur de T</span></span>
<span id="cb482-2"><a href="#cb482-2"></a>p &lt;-<span class="st"> </span><span class="kw">cor.test</span>(df<span class="op">$</span>HabKm2, df<span class="op">$</span>A65plus)</span>
<span id="cb482-3"><a href="#cb482-3"></a><span class="kw">cat</span>(<span class="kw">round</span>(p<span class="op">$</span>estimate,<span class="dv">5</span>), <span class="st">&quot; [&quot;</span>, <span class="kw">round</span>(p<span class="op">$</span>conf.int[<span class="dv">1</span>],<span class="dv">4</span>), <span class="st">&quot; &quot;</span>,<span class="kw">round</span>(p<span class="op">$</span>conf.int[<span class="dv">2</span>],<span class="dv">4</span>), <span class="st">&quot;]&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## -0.15808 [-0.2194 -0.0955]</code></pre>
<p>Le <em>bootstrap</em> renvoie un coefficient de corrélation de Pearson de −0,158. Les intervalles de confiance obtenus à partir des différentes méthodes d’estimation (normale, basique, pourcentage et BCa) ne sont pas à cheval sur 0, indiquant que le coefficient est significatif à 5 %.</p>
</div>
<div id="sect0436" class="section level3">
<h3><span class="header-section-number">4.3.6</span> Corrélation partielle</h3>
<div class="bloc_objectif">
<p><strong>Quelle est la relation entre deux variables continues une fois prise en compte une autre variable dite de contrôle?</strong> En études urbaines, nous pourrions vouloir vérifier si deux variables sont ou non associées après avoir contrôlé la densité de population ou encore la distance au centre-ville.</p>
<p>La corrélation partielle permet d’évaluer la relation linéaire entre deux variables quantitatives continues, après avoir contrôlées une ou plusieurs autres variables quantitatives (dites variables de contrôle).</p>
</div>
<p>Le coefficient de corrélation partielle peut être calculé pour plusieurs mesures de corrélation (notamment, Pearson, Spearman et Kendall). Variant aussi de −1 à 1, il est calculé comme suit :</p>

<p><span class="math display">\[\begin{equation}
r_{ABC} = \frac{r_{AB}-r_{AC}r_{BC}}{\sqrt{(1-r_{AC}^2)(1-r_{BC}^2)}}
(\#eq:corpartielle)
\end{equation}\]</span>
</p>
<p>avec <em>A</em> et <em>B</em> étant les deux variables pour lesquelles nous souhaitons évaluer la relation linéaire, une fois contrôlée la variable <em>C</em>; <span class="math inline">\(r\)</span> étant le coefficient de corrélation (Pearson, Spearman ou Kendall) entre deux variables.</p>
<p>Dans l’exemple ci-dessous, nous voulons estimer la relation linéaire entre le pourcentage de personnes à faible revenu et la couverture végétale au niveau des îlots de l’île de Montréal, une fois contrôlée la densité de population. En effet, plus cette dernière est forte, plus la couverture végétale est faible (<span class="math inline">\(r\)</span> de Pearson = −0,563). La valeur du <span class="math inline">\(r\)</span> de Pearson s’élève à −0,513 entre le pourcentage de personnes à faible revenu dans la population totale de l’îlot et la couverture végétale. Une fois la densité de population contrôlée, elle chute à −0,316. Pour calculer la corrélation partielle, nous pouvons utiliser la fonction <code>pcor.test</code> du package <code>ppcor</code>.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1"></a><span class="kw">library</span>(<span class="st">&quot;foreign&quot;</span>)</span>
<span id="cb484-2"><a href="#cb484-2"></a><span class="kw">library</span>(<span class="st">&quot;ppcor&quot;</span>)</span>
<span id="cb484-3"><a href="#cb484-3"></a>dfveg &lt;-<span class="st"> </span><span class="kw">read.dbf</span>(<span class="st">&quot;data/bivariee/IlotsVeg2006.dbf&quot;</span>)</span>
<span id="cb484-4"><a href="#cb484-4"></a><span class="co"># Corrélation entre les trois variables</span></span>
<span id="cb484-5"><a href="#cb484-5"></a><span class="kw">round</span>(<span class="kw">cor</span>(dfveg[, <span class="kw">c</span>(<span class="st">&quot;VegPct&quot;</span>, <span class="st">&quot;Pct_FR&quot;</span>,<span class="st">&quot;LogDens&quot;</span>)], <span class="dt">method=</span><span class="st">&quot;p&quot;</span>), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##         VegPct Pct_FR LogDens
## VegPct   1.000 -0.513  -0.563
## Pct_FR  -0.513  1.000   0.513
## LogDens -0.563  0.513   1.000</code></pre>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1"></a><span class="co"># Corrélation partielle avec la fonction pcor.test entre :</span></span>
<span id="cb486-2"><a href="#cb486-2"></a><span class="co"># la couverture végétale de l&#39;îlot (%) et</span></span>
<span id="cb486-3"><a href="#cb486-3"></a><span class="co"># le pourcentage de personnes à faible revenu</span></span>
<span id="cb486-4"><a href="#cb486-4"></a><span class="co"># une fois contrôlée la densité de population</span></span>
<span id="cb486-5"><a href="#cb486-5"></a><span class="kw">pcor.test</span>(dfveg<span class="op">$</span>Pct_FR, dfveg<span class="op">$</span>VegPct, dfveg<span class="op">$</span>LogDens, <span class="dt">method=</span><span class="st">&quot;p&quot;</span>)</span></code></pre></div>
<pre><code>##     estimate       p.value statistic     n gp  Method
## 1 -0.3155194 8.093159e-235 -33.59772 10213  1 pearson</code></pre>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1"></a><span class="co"># Calcul de la corrélation partielle avec la formule</span></span>
<span id="cb488-2"><a href="#cb488-2"></a>corAB &lt;-<span class="st"> </span><span class="kw">cor</span>(dfveg<span class="op">$</span>VegPct, dfveg<span class="op">$</span>Pct_FR, <span class="dt">method =</span> <span class="st">&quot;p&quot;</span>)</span>
<span id="cb488-3"><a href="#cb488-3"></a>corAC &lt;-<span class="st"> </span><span class="kw">cor</span>(dfveg<span class="op">$</span>VegPct, dfveg<span class="op">$</span>LogDens, <span class="dt">method =</span> <span class="st">&quot;p&quot;</span>)</span>
<span id="cb488-4"><a href="#cb488-4"></a>corBC &lt;-<span class="st"> </span><span class="kw">cor</span>(dfveg<span class="op">$</span>Pct_FR, dfveg<span class="op">$</span>LogDens, <span class="dt">method =</span> <span class="st">&quot;p&quot;</span>)</span>
<span id="cb488-5"><a href="#cb488-5"></a>CorP  &lt;-<span class="st"> </span>(corAB <span class="op">-</span><span class="st"> </span>(corAC<span class="op">*</span>corBC)) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>((<span class="dv">1</span><span class="op">-</span>corAC<span class="op">^</span><span class="dv">2</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>corBC<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb488-6"><a href="#cb488-6"></a><span class="kw">cat</span>(<span class="st">&quot;Corr. partielle avec ppcor  = &quot;</span>, </span>
<span id="cb488-7"><a href="#cb488-7"></a>    <span class="kw">round</span>(<span class="kw">pcor.test</span>(dfveg<span class="op">$</span>Pct_FR,  dfveg<span class="op">$</span>VegPct, dfveg<span class="op">$</span>LogDens, <span class="dt">method=</span><span class="st">&quot;p&quot;</span>)<span class="op">$</span>estimate,<span class="dv">5</span>),</span>
<span id="cb488-8"><a href="#cb488-8"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Corr. partielle (formule)  = &quot;</span>, <span class="kw">round</span>(CorP, <span class="dv">5</span>))</span></code></pre></div>
<pre><code>## Corr. partielle avec ppcor  =  -0.31552 
## Corr. partielle (formule)  =  -0.31552</code></pre>
</div>
<div id="sect0437" class="section level3">
<h3><span class="header-section-number">4.3.7</span> Mise en œuvre dans R</h3>
<p>Comme vous l’aurez compris, il est possible d’arriver au même résultat par différents moyens. Pour calculer les corrélations, nous avons utilisé jusqu’à présent les fonctions de base <code>cor</code> et <code>cor.test</code>. Il est aussi possible de recourir à des fonctions d’autres <em>packages</em>, dont notamment :</p>
<ul>
<li><code>Hmisc</code>, dont la fonction <code>rcorr</code> permet de calculer des corrélations de Pearson et de Spearman (mais non celle de Kendall) avec les valeurs de <em>p</em>.</li>
<li><code>psych</code>, dont la fonction <code>corr.test</code> permet d’obtenir une matrice de corrélation (Pearson, Spearman et Kendall), les intervalles de confiance et les valeurs de <em>p</em>.</li>
<li><code>stargazer</code> pour créer de beaux tableaux d’une matrice de corrélation en <em>HTML</em>, en <em>LaTeX</em> ou en ASCII.</li>
<li><code>apaTables</code> pour créer un tableau avec une matrice de corrélation dans un fichier Word.</li>
<li><code>correlation</code> pour aller plus loin et explorer les corrélations bayésiennes, robustes, non linéaires ou multiniveaux.</li>
</ul>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1"></a>df1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/bivariee/sr_rmr_mtl_2016.csv&quot;</span>)</span>
<span id="cb490-2"><a href="#cb490-2"></a><span class="kw">library</span>(<span class="st">&quot;Hmisc&quot;</span>)</span>
<span id="cb490-3"><a href="#cb490-3"></a><span class="kw">library</span>(<span class="st">&quot;stargazer&quot;</span>)</span>
<span id="cb490-4"><a href="#cb490-4"></a><span class="kw">library</span>(<span class="st">&quot;apaTables&quot;</span>)</span>
<span id="cb490-5"><a href="#cb490-5"></a><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb490-6"><a href="#cb490-6"></a><span class="co"># Corrélations de Pearson et Spearman et valeurs de p </span></span>
<span id="cb490-7"><a href="#cb490-7"></a><span class="co"># avec la fonction rcorr de Hmisc pour deux variables</span></span>
<span id="cb490-8"><a href="#cb490-8"></a>Hmisc<span class="op">::</span><span class="kw">rcorr</span>(df1<span class="op">$</span>RevMedMen, df1<span class="op">$</span>Locataire, <span class="dt">type=</span><span class="st">&quot;pearson&quot;</span>)</span></code></pre></div>
<pre><code>##       x     y
## x  1.00 -0.78
## y -0.78  1.00
## 
## n= 951 
## 
## 
## P
##   x  y 
## x     0
## y  0</code></pre>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="#cb492-1"></a>Hmisc<span class="op">::</span><span class="kw">rcorr</span>(df1<span class="op">$</span>RevMedMen, df1<span class="op">$</span>Locataire, <span class="dt">type=</span><span class="st">&quot;spearman&quot;</span>)</span></code></pre></div>
<pre><code>##       x     y
## x  1.00 -0.91
## y -0.91  1.00
## 
## n= 951 
## 
## 
## P
##   x  y 
## x     0
## y  0</code></pre>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="#cb494-1"></a><span class="co"># Matrice de corrélation avec la fonction rcorr de Hmisc pour plus de variables</span></span>
<span id="cb494-2"><a href="#cb494-2"></a><span class="co"># Nous créons au préalable un vecteur avec les noms des variables à sélectionner</span></span>
<span id="cb494-3"><a href="#cb494-3"></a>Vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;RevMedMen&quot;</span>,<span class="st">&quot;Locataire&quot;</span>, <span class="st">&quot;LogTailInc&quot;</span>,<span class="st">&quot;A65plus&quot;</span>,<span class="st">&quot;ImgRec&quot;</span>, <span class="st">&quot;HabKm2&quot;</span>, <span class="st">&quot;FaibleRev&quot;</span>)</span>
<span id="cb494-4"><a href="#cb494-4"></a>Hmisc<span class="op">::</span><span class="kw">rcorr</span>(df1[, Vars] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.matrix</span>())</span></code></pre></div>
<pre><code>##            RevMedMen Locataire LogTailInc A65plus ImgRec HabKm2 FaibleRev
## RevMedMen       1.00     -0.78      -0.46   -0.07  -0.46  -0.49     -0.74
## Locataire      -0.78      1.00       0.56    0.00   0.64   0.71      0.88
## LogTailInc     -0.46      0.56       1.00   -0.07   0.82   0.48      0.62
## A65plus        -0.07      0.00      -0.07    1.00  -0.06  -0.16     -0.01
## ImgRec         -0.46      0.64       0.82   -0.06   1.00   0.56      0.68
## HabKm2         -0.49      0.71       0.48   -0.16   0.56   1.00      0.64
## FaibleRev      -0.74      0.88       0.62   -0.01   0.68   0.64      1.00
## 
## n= 951 
## 
## 
## P
##            RevMedMen Locataire LogTailInc A65plus ImgRec HabKm2 FaibleRev
## RevMedMen            0.0000    0.0000     0.0441  0.0000 0.0000 0.0000   
## Locataire  0.0000              0.0000     0.9594  0.0000 0.0000 0.0000   
## LogTailInc 0.0000    0.0000               0.0325  0.0000 0.0000 0.0000   
## A65plus    0.0441    0.9594    0.0325             0.0682 0.0000 0.6796   
## ImgRec     0.0000    0.0000    0.0000     0.0682         0.0000 0.0000   
## HabKm2     0.0000    0.0000    0.0000     0.0000  0.0000        0.0000   
## FaibleRev  0.0000    0.0000    0.0000     0.6796  0.0000 0.0000</code></pre>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="#cb496-1"></a><span class="co"># # Avec la fonction corr.test du package psych pour avoir la matrice de corrélation</span></span>
<span id="cb496-2"><a href="#cb496-2"></a><span class="co"># # (Pearson, Spearman et Kendall), les intervalles de confiance et les valeurs de p</span></span>
<span id="cb496-3"><a href="#cb496-3"></a><span class="co"># print(psych::corr.test(df[, Vars], </span></span>
<span id="cb496-4"><a href="#cb496-4"></a><span class="co">#              method = &quot;kendall&quot;, </span></span>
<span id="cb496-5"><a href="#cb496-5"></a><span class="co">#              ci=TRUE, alpha = 0.05), short=FALSE) </span></span>
<span id="cb496-6"><a href="#cb496-6"></a><span class="co"># Création d&#39;un tableau pour une matrice de corrélation</span></span>
<span id="cb496-7"><a href="#cb496-7"></a><span class="co"># changer le paramètre type pour &#39;html&#39; or &#39;latex&#39; si souhaité</span></span>
<span id="cb496-8"><a href="#cb496-8"></a>p &lt;-<span class="st"> </span><span class="kw">cor</span>(df1[, Vars], <span class="dt">method=</span><span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb496-9"><a href="#cb496-9"></a><span class="kw">stargazer</span>(p, <span class="dt">title=</span><span class="st">&quot;Correlation Matrix&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;text&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Correlation Matrix
## =========================================================================
##            RevMedMen Locataire LogTailInc A65plus ImgRec HabKm2 FaibleRev
## -------------------------------------------------------------------------
## RevMedMen      1      -0.785     -0.461   -0.065  -0.458 -0.489  -0.743  
## Locataire   -0.785       1       0.562    -0.002  0.645  0.708    0.879  
## LogTailInc  -0.461     0.562       1      -0.069  0.816  0.475    0.622  
## A65plus     -0.065    -0.002     -0.069      1    -0.059 -0.158  -0.013  
## ImgRec      -0.458     0.645     0.816    -0.059    1    0.561    0.678  
## HabKm2      -0.489     0.708     0.475    -0.158  0.561    1      0.642  
## FaibleRev   -0.743     0.879     0.622    -0.013  0.678  0.642      1    
## -------------------------------------------------------------------------</code></pre>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="#cb498-1"></a><span class="co"># Créer un tableau avec la matrice de corrélation </span></span>
<span id="cb498-2"><a href="#cb498-2"></a><span class="co"># dans un fichier Word (.doc)</span></span>
<span id="cb498-3"><a href="#cb498-3"></a>apaTables<span class="op">::</span><span class="kw">apa.cor.table</span>(df1[, <span class="kw">c</span>(<span class="st">&quot;RevMedMen&quot;</span>,<span class="st">&quot;Locataire&quot;</span>,<span class="st">&quot;LogTailInc&quot;</span>)], </span>
<span id="cb498-4"><a href="#cb498-4"></a>                         <span class="dt">filename =</span> <span class="st">&quot;data/bivariee/TitiLaMatrice.doc&quot;</span>,</span>
<span id="cb498-5"><a href="#cb498-5"></a>                         <span class="dt">show.conf.interval =</span> <span class="ot">TRUE</span>,</span>
<span id="cb498-6"><a href="#cb498-6"></a>                         <span class="dt">landscape =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 
## 
## Means, standard deviations, and correlations with confidence intervals
##  
## 
##   Variable      M        SD       1            2         
##   1. RevMedMen  66065.50 26635.27                        
##                                                          
##   2. Locataire  45.05    26.33    -.78**                 
##                                   [-.81, -.76]           
##                                                          
##   3. LogTailInc 5.54     4.82     -.46**       .56**     
##                                   [-.51, -.41] [.52, .60]
##                                                          
## 
## Note. M and SD are used to represent mean and standard deviation, respectively.
## Values in square brackets indicate the 95% confidence interval.
## The confidence interval is a plausible range of population correlations 
## that could have caused the sample correlation (Cumming, 2014).
##  * indicates p &lt; .05. ** indicates p &lt; .01.
## </code></pre>
<div class="bloc_astuce">
<p><strong>Une image vaut mille mots, surtout pour une matrice de corrélation!</strong> Le package <code>corrplot</code> vous permet justement de construire de belles figures avec une matrice de corrélation (figures @ref(fig:figcorrplot1) et @ref(fig:figcorrplot2)). L’intérêt de ce type de figure est de repérer rapidement des associations intéressantes lorsque nous calculons les corrélations entre un grand nombre de variables.</p>
</div>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="#cb500-1"></a><span class="kw">library</span>(<span class="st">&quot;corrplot&quot;</span>)</span>
<span id="cb500-2"><a href="#cb500-2"></a><span class="kw">library</span>(<span class="st">&quot;ggpubr&quot;</span>)</span>
<span id="cb500-3"><a href="#cb500-3"></a>df1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/bivariee/sr_rmr_mtl_2016.csv&quot;</span>)</span>
<span id="cb500-4"><a href="#cb500-4"></a>Vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;RevMedMen&quot;</span>,<span class="st">&quot;Locataire&quot;</span>, <span class="st">&quot;LogTailInc&quot;</span>,<span class="st">&quot;A65plus&quot;</span>,<span class="st">&quot;ImgRec&quot;</span>, <span class="st">&quot;HabKm2&quot;</span>, <span class="st">&quot;FaibleRev&quot;</span>)</span>
<span id="cb500-5"><a href="#cb500-5"></a>p &lt;-<span class="st"> </span><span class="kw">cor</span>(df1[, Vars], <span class="dt">method=</span><span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb500-6"><a href="#cb500-6"></a>couleurs &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;#053061&quot;</span>, <span class="st">&quot;#2166AC&quot;</span>,<span class="st">&quot;#4393C3&quot;</span>, <span class="st">&quot;#92C5DE&quot;</span>,</span>
<span id="cb500-7"><a href="#cb500-7"></a>                               <span class="st">&quot;#D1E5F0&quot;</span>, <span class="st">&quot;#FFFFFF&quot;</span>, <span class="st">&quot;#FDDBC7&quot;</span>, <span class="st">&quot;#F4A582&quot;</span>,</span>
<span id="cb500-8"><a href="#cb500-8"></a>                               <span class="st">&quot;#D6604D&quot;</span>, <span class="st">&quot;#B2182B&quot;</span>, <span class="st">&quot;#67001F&quot;</span>))</span>
<span id="cb500-9"><a href="#cb500-9"></a>corrplot<span class="op">::</span><span class="kw">corrplot</span>(p, <span class="dt">addrect =</span> <span class="dv">3</span>, <span class="dt">method=</span><span class="st">&quot;number&quot;</span>,</span>
<span id="cb500-10"><a href="#cb500-10"></a>                   <span class="dt">diag=</span><span class="ot">FALSE</span>, <span class="dt">col=</span><span class="kw">couleurs</span>(<span class="dv">100</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figcorrplot1-1.png" alt="Matrice de corrélation avec corrplot (chiffres)" width="60%" />
<p class="caption">
(#fig:figcorrplot1)Matrice de corrélation avec corrplot (chiffres)
</p>
</div>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="#cb501-1"></a>fig2 &lt;-<span class="st"> </span><span class="kw">corrplot.mixed</span>(p, <span class="dt">lower=</span><span class="st">&quot;number&quot;</span>, <span class="dt">lower.col =</span> <span class="st">&quot;black&quot;</span>, </span>
<span id="cb501-2"><a href="#cb501-2"></a>                      <span class="dt">upper =</span> <span class="st">&quot;ellipse&quot;</span>, <span class="dt">upper.col=</span><span class="kw">couleurs</span>(<span class="dv">100</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figcorrplot2-1.png" alt="Matrice de corrélation avec corrplot (chiffres et ellipses)" width="60%" />
<p class="caption">
(#fig:figcorrplot2)Matrice de corrélation avec corrplot (chiffres et ellipses)
</p>
</div>
</div>
<div id="sect0438" class="section level3">
<h3><span class="header-section-number">4.3.8</span> Comment rapporter des valeurs de corrélations?</h3>
<p>Bien qu’il n’y ait pas qu’une seule manière de reporter des corrélations, voici quelques lignes directrices pour vous guider :</p>
<ul>
<li>Signaler si la corrélation est faible, modérée ou forte.</li>
<li>Indiquer si la corrélation est positive ou négative. Toutefois, ce n’est pas une obligation, car nous pouvons rapidement le constater avec le signe du coefficient.</li>
<li>Mettre le <em>r</em> et le <em>p</em> en italique et en minuscules.</li>
<li>Deux décimales uniquement pour le <span class="math inline">\(r\)</span> (sauf si une plus grande précision se justifie dans le domaine d’étude).</li>
<li>Trois décimales pour la valeur de <em>p</em>. Si elle est inférieure à 0,001, écrire plutôt <em>p</em> &lt; 0,001.</li>
<li>Indiquer éventuellement le nombre de degrés de liberté, soit <span class="math inline">\(r(dl)=...\)</span></li>
</ul>
<p>Voici des exemples :</p>
<ul>
<li>La corrélation entre les variables <em>revenu médian des ménages</em> et <em>pourcentage de locataires</em> est fortement négative (<em>r</em> = −0,78, <em>p</em> &lt; 0,001).</li>
<li>La corrélation entre les variables <em>revenu médian des ménages</em> et <em>pourcentage de locataires</em> est forte (<em>r</em>(949) = −0,78, <em>p</em> &lt; 0,001).</li>
<li>La corrélation entre les variables <em>densité de population</em> et <em>revenu médian des ménages</em> est modérée (<em>r</em> = −0,49, <em>p</em> &lt; 0,001).</li>
<li>La corrélation entre les variables <em>densité de population</em> et <em>pourcentage de 65 ans et plus</em> n’est pas significative (<em>r</em> = −0,08, <em>p</em> = 0,07).</li>
</ul>
<p>Pour un texte en anglais, référez-vous à : <a href="https://www.socscistatistics.com/tutorials/correlation/default.aspx" target="_blank">https://www.socscistatistics.com/tutorials/correlation/default.aspx</a>.</p>
</div>
</div>
<div id="sect044" class="section level2">
<h2><span class="header-section-number">4.4</span> Régression linéaire simple</h2>
<div class="bloc_objectif">
<p><strong>Comment expliquer et prédire une variable continue en fonction d’une autre variable?</strong> Répondre à cette question relève de la statistique inférentielle. Il s’agit en effet d’établir une équation simple du type <span class="math inline">\(Y = a + bX\)</span> pour expliquer et prédire les valeurs d’une variable dépendante (<em>Y</em>) à partir d’une variable indépendante (<em>X</em>). L’équation de la régression est construite grâce à un jeu de données (un échantillon). À partir de cette équation, il est possible de prédire la valeur attendue de <em>Y</em> pour n’importe quelle valeur de <em>X</em>. Nous appelons cette équation un modèle, car elle cherche à représenter la réalité de façon simplifiée.</p>
<p>La régression linéaire simple relève ainsi de la statistique inférentielle et se distingue ainsi de la <strong>covariance</strong> (section @ref(sect042)) et de la <strong>corrélation</strong> (section @ref(sect043)) qui relèvent quant à eux de la statistique bivariée descriptive et exploratoire.</p>
<p>Par exemple, la régression linéaire simple pourrait être utilisée pour expliquer les notes d’un groupe d’étudiants et d’étudiantes à un examen (variable dépendante <em>Y</em>) en fonction du nombre d’heures consacrées à la révision des notes de cours (variable indépendante <em>X</em>). Une fois l’équation de régression déterminée et si le modèle est efficace, nous pourrons prédire les notes des personnes inscrites au cours la session suivante en fonction du temps qu’ils ou qu’elles prévoient passer à étudier, et ce, avant l’examen.</p>
<p>Formulons un exemple d’application de la régression linéaire simple en études urbaines. Dans le cadre d’une étude sur les îlots de chaleur urbains, la température de surface (variable dépendante) pourrait être expliquée par la proportion de la superficie de l’îlot couverte par de la végétation (variable indépendante). Nous supposons alors que plus cette proportion est importante, plus la température est faible et inversement, soit une relation linéaire négative. Si le modèle est efficace, nous pourrions prédire la température moyenne des îlots d’une autre municipalité pour laquelle nous ne disposons pas d’une carte de température, et repérer ainsi les îlots de chaleur potentiels. Bien entendu, il est peu probable que nous arrivions à prédire efficacement la température moyenne des îlots avec uniquement la couverture végétale comme variable explicative. En effet, bien d’autres caractéristiques de la forme urbaine peuvent influencer ce phénomène comme la densité du bâti, la couleur des toits, les occupations du sol présentes, l’effet des canyons urbains, etc. Il faudrait alors inclure non pas une, mais plusieurs variables explicatives (indépendantes).</p>
<p>Ainsi, nous distinguons la <strong>régression linéaire simple</strong> (une seule variable indépendante) de la <strong>régression linéaire multiple</strong> (plusieurs variables indépendantes); cette dernière est largement abordée au chapitre @ref(chap07).</p>
</div>
<p>Dans cette section, nous décrivons succinctement la régression linéaire simple. Concrètement, nous voyons comment déterminer la droite de régression, interpréter ses différents paramètres du modèle et évaluer la qualité d’ajustement du modèle. Nous n’abordons ni les hypothèses liées au modèle de régression linéaire des moindres carrés ordinaires (MCO) ni les conditions d’application. Ces éléments sont expliqués au chapitre @ref(chap07), consacré à la régression linéaire multiple.</p>
<div style="page-break-after: always;"></div>
<div class="bloc_attention">
<p><strong>Corrélation, régression simple et causalité : attention aux raccourcis!</strong></p>
<p>Si une variable <em>X</em> explique et prédit efficacement une variable <em>Y</em>, cela ne veut pas dire pour autant qu’<em>X</em> cause <em>Y</em>. Autrement dit, la corrélation, soit le degré d’association entre deux variables, ne signifie pas qu’il existe un lien de causalité entre elles.</p>
<p>Premièrement, la variable explicative (<em>X</em>, indépendante) doit absolument précéder la variable à expliquer (<em>Y</em>, dépendante). Par exemple, l’âge (<em>X</em>) peut influencer le sentiment de sécurité (<em>Y</em>). Mais, le sentiment de sécurité ne peut en aucun cas influencer l’âge. Par conséquent, l’âge ne peut conceptuellement pas être la variable dépendante dans cette relation.</p>
<p>Deuxièmement, bien qu’une variable puisse expliquer efficacement une autre variable, elle peut être un <strong>facteur confondant</strong>. Prenons deux exemples bien connus :</p>
<ul>
<li>Avoir les doigts jaunes est associé au cancer du poumon. Bien entendu, les doigts jaunes ne causent pas le cancer : c’est un facteur confondant puisque fumer augmente les risques du cancer du poumon et jaunit aussi les doigts.</li>
<li>Dans un article intitulé <em>Chocolate Consumption, Cognitive Function, and Nobel Laureates</em>, Messerli <span class="citation">(<a href="#ref-Messerli" role="doc-biblioref">2012</a>)</span> a trouvé une corrélation positive entre la consommation de chocolat par habitant et le nombre de prix Nobel pour dix millions d’habitants pour 23 pays. Ce résultat a d’ailleurs été rapporté par de nombreux médias, sans pour autant que Messerli <span class="citation">(<a href="#ref-Messerli" role="doc-biblioref">2012</a>)</span> et les journalistes concluent à un lien de causalité entre les deux variables :
<ul>
<li>Radio Canada (<a href="https://ici.radio-canada.ca/nouvelle/582457/chocolat-consommateurs-nobels" class="uri">https://ici.radio-canada.ca/nouvelle/582457/chocolat-consommateurs-nobels</a>)</li>
<li>La Presse (<a href="https://www.lapresse.ca/vivre/sante/nutrition/201210/11/01-4582347-etude-plus-un-pays-mange-de-chocolat-plus-il-a-de-prix-nobel.php" class="uri">https://www.lapresse.ca/vivre/sante/nutrition/201210/11/01-4582347-etude-plus-un-pays-mange-de-chocolat-plus-il-a-de-prix-nobel.php</a>)</li>
<li>Le Point (<a href="https://www.lepoint.fr/insolite/le-chocolat-dope-aussi-l-obtention-de-prix-nobel-12-10-2012-1516159_48.php" class="uri">https://www.lepoint.fr/insolite/le-chocolat-dope-aussi-l-obtention-de-prix-nobel-12-10-2012-1516159_48.php</a>).</li>
</ul></li>
</ul>
<p>Les chercheurs et les chercheures savent bien que la consommation de chocolat ne permet pas d’obtenir des résultats intéressants et de les publier dans des revues prestigieuses; c’est plutôt le café ! Plus sérieusement, il est probable que les pays les plus riches investissent davantage dans la recherche et obtiennent ainsi plus de prix Nobel. Dans les pays les plus riches, il est aussi probable que l’on consomme plus de chocolat, considéré comme un produit de luxe dans les pays les plus pauvres.</p>
<p>Pour approfondir le sujet sur la confusion entre corrélation, régression simple et causalité, vous pouvez visionner cette courte vidéo ludique de vulgarisation (<a href="https://www.youtube.com/embed/A-_naeATJ6o" class="uri">https://www.youtube.com/embed/A-_naeATJ6o</a>).</p>
<p>L’association entre deux variables peut aussi être simplement le fruit du hasard. Si nous explorons de très grandes quantités de données (avec un nombre impressionnant d’observations et de variables), soit une démarche relevant du forage ou de la fouille de données (<em>data mining</em> en anglais), le hasard fera que nous risquons d’obtenir des corrélations surprenantes entre certaines variables. Prenons un exemple concret : admettons que nous ayons collecté 100 variables et que nous calculons les corrélations entre chaque paire de variables. Nous obtenons une matrice de corrélation de 100 x 100, à laquelle nous pouvons enlever la diagonale et une moitié de la matrice, ce qui nous laisse un total de 4950 corrélations différentes. Admettons que nous choisissions un seuil de significativité de 5 %, nous devons alors nous attendre à ce que le hasard produise des résultats significatifs dans 5 % des cas. Sur 4950 corrélations, cela signifie qu’environ 247 corrélations seront significatives, et ce, indépendamment de la nature des données. Nous pouvons aisément illustrer ce fait avec la syntaxe suivante :</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="#cb502-1"></a><span class="kw">library</span>(<span class="st">&quot;Hmisc&quot;</span>)</span>
<span id="cb502-2"><a href="#cb502-2"></a>nbVars &lt;-<span class="st"> </span><span class="dv">100</span> <span class="co"># nous utilisons 100 variables générées aléatoirement pour l&#39;expérience</span></span>
<span id="cb502-3"><a href="#cb502-3"></a>nbExperiment &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co"># nous reproduirons 1000 fois l&#39;expérience avec les 100 variables</span></span>
<span id="cb502-4"><a href="#cb502-4"></a><span class="co"># Le nombre de variables significatives par expérience est enregistré dans Results</span></span>
<span id="cb502-5"><a href="#cb502-5"></a>Results &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb502-6"><a href="#cb502-6"></a><span class="co"># itérons pour chaque expérimentation (1000 fois)</span></span>
<span id="cb502-7"><a href="#cb502-7"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nbExperiment){</span>
<span id="cb502-8"><a href="#cb502-8"></a>  Datas &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb502-9"><a href="#cb502-9"></a>  <span class="co"># générons 100 variables aléatoires normalement distribuées</span></span>
<span id="cb502-10"><a href="#cb502-10"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nbVars){</span>
<span id="cb502-11"><a href="#cb502-11"></a>    Datas[[j]] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">150</span>)</span>
<span id="cb502-12"><a href="#cb502-12"></a>  }</span>
<span id="cb502-13"><a href="#cb502-13"></a>  DF &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;cbind&quot;</span>,Datas)</span>
<span id="cb502-14"><a href="#cb502-14"></a>  <span class="co"># calculons la matrice de corrélation pour les 100 variables</span></span>
<span id="cb502-15"><a href="#cb502-15"></a>  cor_mat &lt;-<span class="st"> </span><span class="kw">rcorr</span>(DF)</span>
<span id="cb502-16"><a href="#cb502-16"></a>  <span class="co"># comptons combien de fois les corrélations étaient significatives</span></span>
<span id="cb502-17"><a href="#cb502-17"></a>  Sign &lt;-<span class="st"> </span><span class="kw">table</span>(cor_mat<span class="op">$</span>P<span class="op">&lt;</span><span class="fl">0.05</span>)</span>
<span id="cb502-18"><a href="#cb502-18"></a>  NbPairs &lt;-<span class="st"> </span>Sign[[<span class="st">&quot;TRUE&quot;</span>]]<span class="op">/</span><span class="dv">2</span></span>
<span id="cb502-19"><a href="#cb502-19"></a>  <span class="co"># ajoutons les résultats dans Results</span></span>
<span id="cb502-20"><a href="#cb502-20"></a>  Results &lt;-<span class="st"> </span><span class="kw">c</span>(Results,NbPairs)</span>
<span id="cb502-21"><a href="#cb502-21"></a>}</span>
<span id="cb502-22"><a href="#cb502-22"></a><span class="co"># transformons Results en un DataFrame</span></span>
<span id="cb502-23"><a href="#cb502-23"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Values =</span> Results)</span>
<span id="cb502-24"><a href="#cb502-24"></a><span class="co"># affichons le résultat</span></span>
<span id="cb502-25"><a href="#cb502-25"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> Values)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb502-26"><a href="#cb502-26"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span>..density..), </span>
<span id="cb502-27"><a href="#cb502-27"></a>                 <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, </span>
<span id="cb502-28"><a href="#cb502-28"></a>                 <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb502-29"><a href="#cb502-29"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(df<span class="op">$</span>Values), </span>
<span id="cb502-30"><a href="#cb502-30"></a>                <span class="dt">sd =</span> <span class="kw">sd</span>(df<span class="op">$</span>Values)),<span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)<span class="op">+</span></span>
<span id="cb502-31"><a href="#cb502-31"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">mean</span>(df<span class="op">$</span>Values),<span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="fl">1.2</span>)<span class="op">+</span></span>
<span id="cb502-32"><a href="#cb502-32"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x=</span><span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">0.028</span>, </span>
<span id="cb502-33"><a href="#cb502-33"></a>           <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;Nombre moyen de corrélations significatives</span><span class="ch">\n</span></span>
<span id="cb502-34"><a href="#cb502-34"></a><span class="st">                         sur 1000 réplications : &quot;</span>,</span>
<span id="cb502-35"><a href="#cb502-35"></a>                         <span class="kw">round</span>(<span class="kw">mean</span>(df<span class="op">$</span>Values),<span class="dv">0</span>), <span class="dt">sep=</span><span class="st">&quot;&quot;</span>), <span class="dt">hjust=</span><span class="st">&quot;left&quot;</span>)<span class="op">+</span></span>
<span id="cb502-36"><a href="#cb502-36"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Nombre de corrélations significatives&quot;</span>)<span class="op">+</span></span>
<span id="cb502-37"><a href="#cb502-37"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;densité&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/bivariee/replication_hist.PNG" alt="Corrélations significatives obtenues aléatoirement" width="80%"  />
<p class="caption">
(#fig:replicationhist)Corrélations significatives obtenues aléatoirement
</p>
</div>
</div>
<div id="sect0441" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Principe de base de la régression linéaire simple</h3>
<p>La régression linéaire simple vise à déterminer une droite (une fonction linéaire) qui résume le mieux la relation linéaire entre une variable dépendante (<em>Y</em>) et une variable indépendante (<em>X</em>) :

<span class="math display">\[\begin{equation}
\widehat{y_i} = \beta_{0} + \beta_{1}x_{i}
(\#eq:regsimple)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(\widehat{y_i}\)</span> et <span class="math inline">\(x_{i}\)</span> qui sont respectivement la valeur prédite de la variable dépendante et la valeur de la variable indépendante pour l’observation <span class="math inline">\(i\)</span>. <span class="math inline">\(\beta_{0}\)</span> est la constante (<em>intercept</em> en anglais) et représente la valeur prédite de la variable <em>Y</em> quand <em>X</em> est égale à 0. <span class="math inline">\(\beta_{1}\)</span> est le coefficient de régression pour la variable <em>X</em>, soit la pente de la droite. Ce coefficient nous informe sur la relation entre les deux variables : s’il est positif, la relation est positive; s’il est négatif, la relation est négative; s’il est proche de 0, la relation est nulle (la droite est alors horizontale). Plus la valeur absolue de <span class="math inline">\(\beta_{1}\)</span> est élevée, plus la pente est forte et plus la variable <em>Y</em> varie à chaque changement d’une unité de la variable <em>X</em>.</p>
<p>Considérons un exemple fictif de dix municipalités d’une région métropolitaine pour lesquelles nous disposons de deux variables : le pourcentage de personnes occupées se rendant au travail principalement à vélo et la distance entre chaque municipalité et le centre-ville de la région métropolitaine (tableau @ref(tab:regfictives)).</p>
<table class="kable_wrapper">
<caption>
(#tab:regfictives)Données fictives sur l’utilisation du vélo par municipalité
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
Municipalité
</th>
<th style="text-align:center;">
Vélo
</th>
<th style="text-align:right;">
KMCV
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:center;">
12,5
</td>
<td style="text-align:right;">
14,135
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:center;">
13,5
</td>
<td style="text-align:right;">
10,065
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:center;">
15,8
</td>
<td style="text-align:right;">
7,762
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:center;">
15,9
</td>
<td style="text-align:right;">
11,239
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:center;">
17,6
</td>
<td style="text-align:right;">
7,706
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
Municipalité
</th>
<th style="text-align:center;">
Vélo
</th>
<th style="text-align:right;">
KMCV
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:center;">
18,5
</td>
<td style="text-align:right;">
7,195
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:center;">
21,2
</td>
<td style="text-align:right;">
7,953
</td>
</tr>
<tr>
<td style="text-align:left;">
H
</td>
<td style="text-align:center;">
23,0
</td>
<td style="text-align:right;">
4,293
</td>
</tr>
<tr>
<td style="text-align:left;">
I
</td>
<td style="text-align:center;">
25,3
</td>
<td style="text-align:right;">
5,225
</td>
</tr>
<tr>
<td style="text-align:left;">
J
</td>
<td style="text-align:center;">
30,2
</td>
<td style="text-align:right;">
2,152
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p>D’emblée, à la lecture du nuage de points (figure @ref(fig:figreg)), nous décelons une forte relation linéaire négative entre les deux variables : plus la distance entre la municipalité et le centre-ville de la région métropolitaine augmente, plus le pourcentage de cyclistes est faible, ce qui est confirmé par le coefficient de corrélation (<em>r</em> = −0,90). La droite de régression (en rouge à la figure @ref(fig:figreg)) qui résume le mieux la relation entre <code>Vélo</code> (variable dépendante) et <code>KmCV</code> (variable indépendante) s’écrit alors : <strong>Vélo = 30,603 − 1,448 x KmCV</strong>.</p>
<p>La valeur du coefficient de régression (<span class="math inline">\(\beta_{1}\)</span>) est de −1,448. Le signe de ce coefficient décrit une relation négative entre les deux variables. Ainsi, à chaque ajout d’une unité de la distance entre la municipalité et le centre-ville (exprimée en kilomètres), le pourcentage de cyclistes diminue de 1,448. Retenez que l’unité de mesure de la variable dépendante est très importante pour bien interpréter le coefficient de régression. En effet, si la distance au centre-ville n’était pas exprimée en kilomètres, mais plutôt en mètres, <span class="math inline">\(\beta_1\)</span> serait égal à −0,001448. Dans la même optique, l’ajout de 10 km de distance entre une municipalité et le centre-ville fait diminuer le pourcentage de cyclistes de −14,48 points de pourcentage.</p>
<p>Avec, cette équation de régression, il est possible de prédire le pourcentage de cyclistes pour n’importe quelle municipalité de la région métropolitaine. Par exemple, pour des distances de 5, 10 ou 20 kilomètres, les pourcentages de cyclistes seraient de :</p>
<ul>
<li><span class="math inline">\(\widehat{y_i} = \mbox{30,603} + (\mbox{-1,448} \times \mbox{5 km) = 23,363}\)</span></li>
<li><span class="math inline">\(\widehat{y_i} = \mbox{30,603} + (\mbox{-1,448} \times \mbox{10 km) = 8,883}\)</span></li>
<li><span class="math inline">\(\widehat{y_i} = \mbox{30,603} + (\mbox{-1,448} \times \mbox{20 km) = 1,643}\)</span></li>
</ul>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figreg-1.png" alt="Relation linéaire entre l'utilisation du vélo et la distance au centre-ville" width="65%" />
<p class="caption">
(#fig:figreg)Relation linéaire entre l’utilisation du vélo et la distance au centre-ville
</p>
</div>
</div>
<div id="sect0442" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Formulation de la droite de régression des moindres carrés ordinaires</h3>
<p>Reste à savoir comment sont estimés les différents paramètres de l’équation, soit <span class="math inline">\(\beta_0\)</span> et <span class="math inline">\(\beta_1\)</span>. À la figure @ref(fig:figreg2), les points noirs représentent les valeurs observées (<span class="math inline">\(y_i\)</span>) et les points bleus, les valeurs prédites (<span class="math inline">\(\widehat{y_i}\)</span>) par l’équation du modèle. Les traits noirs verticaux représentent, pour chaque observation <span class="math inline">\(i\)</span>, l’écart entre la valeur observée et la valeur prédite, dénommé résidu (<span class="math inline">\(\epsilon_i\)</span>, prononcez epsilon de <em>i</em> ou plus simplement le résidu pour <em>i</em> ou le terme d’erreur de <em>i</em>). Si un point est au-dessus de la droite de régression, la valeur observée est alors supérieure à la valeur prédite (<span class="math inline">\(y_i &gt; \widehat{y_i}\)</span>) et inversement, si le point est au-dessous de la droite (<span class="math inline">\(y_i &lt; \widehat{y_i}\)</span>). Plus cet écart (<span class="math inline">\(\epsilon_i\)</span>) est important, plus l’observation s’éloigne de la prédiction du modèle et, par extension, moins bon est le modèle. Au tableau @ref(tab:regfictives2), vous constaterez que la somme des résidus est égale à zéro. La méthode des moindres carrés ordinaires (MCO) vise à minimiser les écarts au carré entre les valeurs observées (<span class="math inline">\(y_i\)</span>) et prédites (<span class="math inline">\(\beta_0+\beta_1 x_i\)</span>, soit <span class="math inline">\(\widehat{y_i}\)</span>) :</p>

<p><span class="math display">\[\begin{equation}
min\sum_{i=1}^n{(y_i-(\beta_0+\beta_1 x_i))^2}
(\#eq:mco)
\end{equation}\]</span>
</p>
<p>Pour minimiser ces écarts, le coefficient de régression <span class="math inline">\(\beta_1\)</span> représente le rapport entre la covariance entre <em>X</em> et <em>Y</em> et la variance de <em>Y</em> (équation @ref(eq:b1)), tandis que la constante <span class="math inline">\(\beta_0\)</span> est la moyenne de la variable <em>Y</em> moins le produit de la moyenne de <em>X</em> et de son coefficient de régression (équation @ref(eq:b0)).</p>

<p><span class="math display">\[\begin{equation}
\beta_1 = \frac{\sum_{i=1}^n (x_{i}-\bar{x})(y_{i}-\bar{y})}{\sum_{i=1}^n (x_i-\bar{x})^2} = \frac{cov(X,Y)}{var(X)}
(\#eq:b1)
\end{equation}\]</span>
</p>

<p><span class="math display">\[\begin{equation}
\beta_0 = \widehat{Y}-\beta_1 \widehat{X}
(\#eq:b0)
\end{equation}\]</span>
</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figreg2-1.png" alt="Droite de régression, valeurs observées, prédites et résidus" width="65%" />
<p class="caption">
(#fig:figreg2)Droite de régression, valeurs observées, prédites et résidus
</p>
</div>
<table>
<caption>
(#tab:regfictives2)Valeurs observées, prédites et résidus
</caption>
<thead>
<tr>
<th style="text-align:left;">
Municipalité
</th>
<th style="text-align:center;">
Vélo
</th>
<th style="text-align:right;">
KmCV
</th>
<th style="text-align:right;">
Valeur prédite
</th>
<th style="text-align:right;">
Résidu
</th>
<th style="text-align:right;">
Résidu au carré
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:center;">
12,5
</td>
<td style="text-align:right;">
14,135
</td>
<td style="text-align:right;">
10,138
</td>
<td style="text-align:right;">
2,362
</td>
<td style="text-align:right;">
5,579
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:center;">
13,5
</td>
<td style="text-align:right;">
10,065
</td>
<td style="text-align:right;">
16,031
</td>
<td style="text-align:right;">
-2,531
</td>
<td style="text-align:right;">
6,406
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:center;">
15,8
</td>
<td style="text-align:right;">
7,762
</td>
<td style="text-align:right;">
19,365
</td>
<td style="text-align:right;">
-3,565
</td>
<td style="text-align:right;">
12,709
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:center;">
15,9
</td>
<td style="text-align:right;">
11,239
</td>
<td style="text-align:right;">
14,331
</td>
<td style="text-align:right;">
1,569
</td>
<td style="text-align:right;">
2,462
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:center;">
17,6
</td>
<td style="text-align:right;">
7,706
</td>
<td style="text-align:right;">
19,446
</td>
<td style="text-align:right;">
-1,846
</td>
<td style="text-align:right;">
3,408
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:center;">
18,5
</td>
<td style="text-align:right;">
7,195
</td>
<td style="text-align:right;">
20,186
</td>
<td style="text-align:right;">
-1,686
</td>
<td style="text-align:right;">
2,843
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:center;">
21,2
</td>
<td style="text-align:right;">
7,953
</td>
<td style="text-align:right;">
19,089
</td>
<td style="text-align:right;">
2,111
</td>
<td style="text-align:right;">
4,456
</td>
</tr>
<tr>
<td style="text-align:left;">
H
</td>
<td style="text-align:center;">
23,0
</td>
<td style="text-align:right;">
4,293
</td>
<td style="text-align:right;">
24,388
</td>
<td style="text-align:right;">
-1,388
</td>
<td style="text-align:right;">
1,927
</td>
</tr>
<tr>
<td style="text-align:left;">
I
</td>
<td style="text-align:center;">
25,3
</td>
<td style="text-align:right;">
5,225
</td>
<td style="text-align:right;">
23,038
</td>
<td style="text-align:right;">
2,262
</td>
<td style="text-align:right;">
5,117
</td>
</tr>
<tr>
<td style="text-align:left;">
J
</td>
<td style="text-align:center;">
30,2
</td>
<td style="text-align:right;">
2,152
</td>
<td style="text-align:right;">
27,488
</td>
<td style="text-align:right;">
2,712
</td>
<td style="text-align:right;">
7,355
</td>
</tr>
<tr>
<td style="text-align:left;">
Somme
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
52,262
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect0443" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Mesure de la qualité d’ajustement du modèle</h3>
<p>Les trois mesures les plus courantes pour évaluer la qualité d’ajustement d’un modèle de régression linéaire simple sont l’erreur quadratique moyenne (<em>root-mean-square error</em> en anglais, <em>RMSE</em>), le coefficient de détermination (<em>R<sup>2</sup></em>) et la statistique <em>F</em> de Fisher. Pour mieux appréhender le calcul de ces trois mesures, rappelons que l’équation de régression s’écrit :</p>

<p><span class="math display">\[\begin{equation}
y_i = \beta_0 + \beta_1 x_1+ \epsilon_i \Rightarrow Y= \beta_0 + \beta_1 X + \epsilon
(\#eq:reg2)
\end{equation}\]</span>
</p>
<p>Elle comprend ainsi une partie de <em>Y</em> qui est expliquée par le modèle et une autre partie non expliquée, soit <span class="math inline">\(\epsilon\)</span>, appelée habituellement le terme d’erreur. Ce terme d’erreur pourrait représenter d’autres variables explicatives qui n’ont pas été prises en compte pour prédire la variable indépendante ou une forme de variation aléatoire inexplicable présente lors de la mesure.</p>

<p><span class="math display">\[\begin{equation}
Y  = \underbrace{\beta_0 + \beta_1 X}_{\mbox{partie expliquée par le modèle}}+ \underbrace{\epsilon}_{\mbox{partie non expliquée}}
(\#eq:reg3)
\end{equation}\]</span>
</p>
<p>Par exemple, pour la municipalité <em>A</em> au tableau @ref(tab:regfictives2), nous avons : <span class="math inline">\(y_A = \widehat{y}_A - \epsilon_A \Rightarrow \mbox{12,5} = \mbox{10,138}+\mbox{2,362}\)</span>. Souvenez-vous que la variance d’une variable est la somme des écarts à la moyenne, divisée par le nombre d’observations. Par extension, il est alors possible de décomposer la variance de <em>Y</em> comme suit :</p>

<p><span class="math display">\[\begin{equation}
\underbrace{\sum_{i=1}^n (y_{i}-\bar{y})^2}_{\mbox{variance de Y}} = \underbrace{\sum_{i=1}^n (\widehat{y}_i-\bar{y})^2}_{\mbox{var. expliquée}} + \underbrace{\sum_{i=1}^n (y_{i}-\widehat{y})^2}_{\mbox{var. non expliquée}} \Rightarrow 
SCT = SCE + SCR
(\#eq:reg4)
\end{equation}\]</span>
</p>
<p>avec :</p>
<ul>
<li><em>SCT</em> est la somme des écarts au carré des valeurs observées à la moyenne (<em>total sum of squares</em> en anglais)</li>
<li><em>SCE</em> est la somme des écarts au carré des valeurs prédites à la moyenne (<em>regression sum of squares</em> en anglais)</li>
<li><em>SCR</em> est la somme des carrés des résidus (<em>sum of squared errors</em> en anglais).</li>
</ul>
<p>Autrement dit, la variance totale est égale à la variance expliquée plus la variance non expliquée. Au tableau @ref(tab:computeR), vous pouvez repérer les valeurs de <em>SCT</em>, <em>SCE</em> et <em>SCR</em> et constater que 279,30 = 227,04 + 52,26 et 27,93 = 22,70 + 5,23.</p>
<table>
<caption>
(#tab:computeR)Calcul du coefficient de détermination
</caption>
<thead>
<tr>
<th style="text-align:left;">
Municipalité
</th>
<th style="text-align:right;">
<span class="math inline">\(y_i\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\widehat{y}_i\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\epsilon_i\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\((y_i-\bar{y})^2\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\((\widehat{y}_i-y_i)^2\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\(\epsilon_i^2\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
12,50
</td>
<td style="text-align:right;">
10,14
</td>
<td style="text-align:right;">
2,36
</td>
<td style="text-align:right;">
46,92
</td>
<td style="text-align:right;">
84,86
</td>
<td style="text-align:right;">
5,58
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
13,50
</td>
<td style="text-align:right;">
16,03
</td>
<td style="text-align:right;">
-2,53
</td>
<td style="text-align:right;">
34,22
</td>
<td style="text-align:right;">
11,02
</td>
<td style="text-align:right;">
6,41
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
15,80
</td>
<td style="text-align:right;">
19,37
</td>
<td style="text-align:right;">
-3,57
</td>
<td style="text-align:right;">
12,60
</td>
<td style="text-align:right;">
0,00
</td>
<td style="text-align:right;">
12,71
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
15,90
</td>
<td style="text-align:right;">
14,33
</td>
<td style="text-align:right;">
1,57
</td>
<td style="text-align:right;">
11,90
</td>
<td style="text-align:right;">
25,19
</td>
<td style="text-align:right;">
2,46
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:right;">
17,60
</td>
<td style="text-align:right;">
19,45
</td>
<td style="text-align:right;">
-1,85
</td>
<td style="text-align:right;">
3,06
</td>
<td style="text-align:right;">
0,01
</td>
<td style="text-align:right;">
3,41
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:right;">
18,50
</td>
<td style="text-align:right;">
20,19
</td>
<td style="text-align:right;">
-1,69
</td>
<td style="text-align:right;">
0,72
</td>
<td style="text-align:right;">
0,70
</td>
<td style="text-align:right;">
2,84
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:right;">
21,20
</td>
<td style="text-align:right;">
19,09
</td>
<td style="text-align:right;">
2,11
</td>
<td style="text-align:right;">
3,42
</td>
<td style="text-align:right;">
0,07
</td>
<td style="text-align:right;">
4,46
</td>
</tr>
<tr>
<td style="text-align:left;">
H
</td>
<td style="text-align:right;">
23,00
</td>
<td style="text-align:right;">
24,39
</td>
<td style="text-align:right;">
-1,39
</td>
<td style="text-align:right;">
13,32
</td>
<td style="text-align:right;">
25,38
</td>
<td style="text-align:right;">
1,93
</td>
</tr>
<tr>
<td style="text-align:left;">
I
</td>
<td style="text-align:right;">
25,30
</td>
<td style="text-align:right;">
23,04
</td>
<td style="text-align:right;">
2,26
</td>
<td style="text-align:right;">
35,40
</td>
<td style="text-align:right;">
13,60
</td>
<td style="text-align:right;">
5,12
</td>
</tr>
<tr>
<td style="text-align:left;">
J
</td>
<td style="text-align:right;">
30,20
</td>
<td style="text-align:right;">
27,49
</td>
<td style="text-align:right;">
2,71
</td>
<td style="text-align:right;">
117,72
</td>
<td style="text-align:right;">
66,22
</td>
<td style="text-align:right;">
7,36
</td>
</tr>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:right;">
10,00
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Somme
</td>
<td style="text-align:right;">
193,50
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,00
</td>
<td style="text-align:right;">
279,30
</td>
<td style="text-align:right;">
227,04
</td>
<td style="text-align:right;">
52,26
</td>
</tr>
<tr>
<td style="text-align:left;">
Moyenne
</td>
<td style="text-align:right;">
19,35
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,00
</td>
<td style="text-align:right;">
27,93
</td>
<td style="text-align:right;">
22,70
</td>
<td style="text-align:right;">
5,23
</td>
</tr>
</tbody>
</table>
<p><strong>Calcul de l’erreur quadratique moyenne</strong></p>
<p>La somme des résidus au carré (<em>SCR</em>) divisée par le nombre d’observations représente donc le carré moyen des erreurs (en anglais, <em>mean square error - MSE</em>), soit la variance résiduelle du modèle (52,26 / 10 = 5,23). Plus sa valeur est faible, plus le modèle est efficace pour prédire la variable indépendante. L’erreur quadratique moyenne (en anglais, <em>root-mean-square error - RMSE</em>) est simplement la racine carrée de la somme des résidus au carré divisée par le nombre d’observations (<span class="math inline">\(n\)</span>) :</p>

<p><span class="math display">\[\begin{equation}
RMSE = \sqrt{\frac{\sum_{i=1}^n (y_{i}-\widehat{y})^2}{n}}
(\#eq:reg5)
\end{equation}\]</span>
</p>
<p>Elle représente ainsi une <strong>mesure absolue des erreurs</strong> qui est exprimée dans l’unité de mesure de la variable dépendante. Dans le cas présent, nous avons : <span class="math inline">\(\sqrt{5,23}=2,29\)</span>. Cela signifie qu’en moyenne, l’écart absolu (ou erreur absolue) entre les valeurs observées et prédites est de 2,29 points de pourcentage. De nouveau, une plus faible valeur de <strong>RMSE</strong> indique un meilleur ajustement du modèle. Mais surtout, le RMSE permet d’évaluer avec quelle précision le modèle prédit la variable dépendante. Il est donc particulièrement important si l’objectif principal du modèle est de prédire des valeurs sur un échantillon d’observations pour lequel la variable dépendante est inconnue.</p>
<p><strong>Calcul du coefficient de détermination</strong></p>
<p>Nous avons largement démontré que la variance totale est égale à la variance expliquée plus la variance non expliquée. La qualité du modèle peut donc être évaluée avec le coefficient de détermination (<em>R<sup>2</sup></em>), soit le rapport entre les variances expliquée et totale :</p>

<p><span class="math display">\[\begin{equation}
R^2 = \frac{SCE}{SCT} \mbox{ avec } R^2 \in \left[0,1\right]
(\#eq:reg6)
\end{equation}\]</span>
</p>
<p>Comparativement au RMSE qui est une mesure absolue, le coefficient de détermination est une <strong>mesure relative</strong> qui varie de 0 à 1. Il exprime la proportion de la variance de <em>Y</em> qui est expliquée par la variable <em>X</em>; autrement dit, plus sa valeur est élevée, plus <em>X</em> influence/est capable de prédire <em>Y</em>. Dans le cas présent, nous avons : R<sup>2</sup> = 227,04 / 279,3 = 0,8129, ce qui signale que 81,3 % de la variance du pourcentage de cyclistes est expliquée par la distance entre la municipalité et le centre-ville de la région métropolitaine. Tel que signalé dans la section @ref(sect0432), la racine carrée du coefficient de détermination (<em>R<sup>2</sup></em>) est égale au coefficient de corrélation (<span class="math inline">\(r\)</span>) entre les deux variables.</p>
<p><strong>Calcul de la statistique <em>F</em> de Fisher</strong></p>
<p>La statistique <em>F</em> de Fisher permet de vérifier la significativité globale du modèle.</p>

<p><span class="math display">\[\begin{equation}
F = (n-2)\frac{R^2}{1-R^2} = (n-2)\frac{SCE}{SCR}
(\#eq:reg7)
\end{equation}\]</span>
</p>
<p>L’hypothèse nulle (<em>H<sub>0</sub></em> avec <span class="math inline">\(\beta_1=0\)</span>) est rejetée si la valeur calculée de <em>F</em> est supérieure à la valeur critique de la table <em>F</em> avec <em>1, n-2</em> degrés de liberté et un seuil <span class="math inline">\(\alpha\)</span> (<em>p</em> = 0,05 habituellement) (voir la table des valeurs critiques de <em>F</em>, section @ref(annexe2)). Notez que nous utilisons rarement la table <em>F</em> puisqu’avec la fonction <code>pf(f obtenu, 1, n-2, lower.tail = FALSE)</code>, nous obtenons obtient directement la valeur de <em>p</em> associée à la valeur de <em>F</em>. Concrètement, si le test <em>F</em> est significatif (avec <em>p</em> &lt; 0,05), plus la valeur de <em>F</em> est élevée, plus le modèle est efficace (et plus le <em>R<sup>2</sup></em> sera également élevé).</p>
<p>Notez que la fonction <code>summary</code> renvoie les résultats du modèle, dont notamment le test <em>F</em> de Fisher.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="#cb503-1"></a><span class="co"># utiliser la fonction summary</span></span>
<span id="cb503-2"><a href="#cb503-2"></a><span class="kw">summary</span>(modele)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Velo ~ KmCV, data = data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.5652 -1.8062  0.0906  2.2241  2.7125 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  30.6032     2.0729  14.763 4.36e-07 ***
## KmCV         -1.4478     0.2456  -5.895 0.000364 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.556 on 8 degrees of freedom
## Multiple R-squared:  0.8129, Adjusted R-squared:  0.7895 
## F-statistic: 34.75 on 1 and 8 DF,  p-value: 0.0003637</code></pre>
<p>Dans le cas présent, <span class="math inline">\(F = (10 - 2)\frac{\mbox{0,8129}}{\mbox{1-0,8129}} = (10-2)\frac{\mbox{227,04}}{\mbox{52,26}} = \mbox{34,75}\)</span> avec une valeur de <span class="math inline">\(\mbox{p &lt; 0,001}\)</span>. Par conséquent, le modèle est significatif.</p>
</div>
<div id="sect0444" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Mise en œuvre dans R</h3>
<p>Comment calculer une régression linéaire simple dans R. Rien de plus simple avec la fonction <code>lm(formula = y ~ x, data= DataFrame)</code>.</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1"></a>df1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/bivariee/Reg.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb505-2"><a href="#cb505-2"></a><span class="co">## Création d&#39;un objet pour le modèle</span></span>
<span id="cb505-3"><a href="#cb505-3"></a>monmodele &lt;-<span class="st"> </span><span class="kw">lm</span>(Velo <span class="op">~</span><span class="st"> </span>KmCV, df1)</span>
<span id="cb505-4"><a href="#cb505-4"></a><span class="co">## Résultats du modèle avec la fonction summary</span></span>
<span id="cb505-5"><a href="#cb505-5"></a><span class="kw">summary</span>(monmodele)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Velo ~ KmCV, data = df1)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.5652 -1.8062  0.0906  2.2241  2.7125 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  30.6032     2.0729  14.763 4.36e-07 ***
## KmCV         -1.4478     0.2456  -5.895 0.000364 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.556 on 8 degrees of freedom
## Multiple R-squared:  0.8129, Adjusted R-squared:  0.7895 
## F-statistic: 34.75 on 1 and 8 DF,  p-value: 0.0003637</code></pre>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="#cb507-1"></a><span class="co">## Calcul du MSE et du RMSE</span></span>
<span id="cb507-2"><a href="#cb507-2"></a>MSE &lt;-<span class="st"> </span><span class="kw">mean</span>(monmodele<span class="op">$</span>residuals<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb507-3"><a href="#cb507-3"></a>RMSE &lt;-<span class="st"> </span><span class="kw">sqrt</span>(MSE)</span>
<span id="cb507-4"><a href="#cb507-4"></a><span class="kw">cat</span>(<span class="st">&quot;MSE=&quot;</span>, <span class="kw">round</span>(MSE, <span class="dv">2</span>), <span class="st">&quot;; RMSE=&quot;</span>, <span class="kw">round</span>(RMSE,<span class="dv">2</span>), <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## MSE=5.23; RMSE=2.29</code></pre>
</div>
<div id="sect0445" class="section level3">
<h3><span class="header-section-number">4.4.5</span> Comment rapporter une régression linéaire simple</h3>
<p>Nous avons calculé une régression linéaire simple pour prédire le pourcentage d’actifs occupés utilisant le vélo pour se rendre au travail en fonction de la distance entre la municipalité et le centre-ville de la région métropolitaine (en kilomètres). Le modèle obtient un <em>F</em> de Fisher significatif (<em>F</em>(1,8) = 34,75, <em>p</em> &lt; 0,001) et un <em>R<sup>2</sup></em> de 0,813. Le pourcentage de cyclistes peut être prédit par l’équation suivante : 30,603 - 1,448 x (distance au centre-ville en km).</p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="sect045" class="section level2">
<h2><span class="header-section-number">4.5</span> Quiz de révision du chapitre</h2>
<div id="Chapitre4_QuantiQuanti" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_Chapitre4_QuantiQuanti;
  window.onload = function() {
    quizz_Chapitre4_QuantiQuanti = new Quiz('Chapitre4_QuantiQuanti', ['1','3','1','4','3','1','1','2','3','2']);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
D’après le nuage de points, les variables X et Y partagent une relation :
</div>
<img src="images/quiz/Quiz_Chap04_Question_01.jpg" alt="" style="width: 50%;display: block;margin-left: auto;margin-right: auto;margin-bottom: 0.5em;margin-top: 0.5em;"/>
<div>
relisez au besoin la section @ref(sect041).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>linéaire positive</label>
</td>
<td>
<input type="radio" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>linéaire négative</label>
</td>
<td>
<input type="radio" name="q1" value="2"/>
</td>
</tr>
<tr>
<td>
<label>curvilinéaire</label>
</td>
<td>
<input type="radio" name="q1" value="3"/>
</td>
</tr>
<tr>
<td>
<label>absence de relation</label>
</td>
<td>
<input type="radio" name="q1" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
D’après le nuage de points, les deux variables partagent une relation :
</div>
<img src="images/quiz/Quiz_Chap04_Question_02.jpg" alt="" style="width: 50%;display: block;margin-left: auto;margin-right: auto;margin-bottom: 0.5em;margin-top: 0.5em;"/>
<div>
Relisez au besoin la section @ref(sect041).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>linéaire positive</label>
</td>
<td>
<input type="radio" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>linéaire négative</label>
</td>
<td>
<input type="radio" name="q2" value="2"/>
</td>
</tr>
<tr>
<td>
<label>curvilinéaire</label>
</td>
<td>
<input type="radio" name="q2" value="3"/>
</td>
</tr>
<tr>
<td>
<label>absence de relation</label>
</td>
<td>
<input type="radio" name="q2" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
La valeur de la covariance peut être positive ou négative. Plus sa valeur absolue est élevée :
</div>
<img src="images/quiz/Quiz_Chap04_Question_03.jpg" alt="" style="width: 50%;display: block;margin-left: auto;margin-right: auto;margin-bottom: 0.5em;margin-top: 0.5em;"/>
<div>
Relisez au besoin la section @ref(sect0422).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>plus la relation linéaire entre les deux variables est importante</label>
</td>
<td>
<input type="radio" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>plus la relation linéaire entre les deux variables est faible</label>
</td>
<td>
<input type="radio" name="q3" value="2"/>
</td>
</tr>
<tr>
<td>
<label>curvilinéaire</label>
</td>
<td>
<input type="radio" name="q3" value="3"/>
</td>
</tr>
<tr>
<td>
<label>absence de relation</label>
</td>
<td>
<input type="radio" name="q3" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Les coefficients de corrélation (Pearson, Speaman, etc.) varient de à :
</div>
<div>
Relisez au besoin la section @ref(sect0433).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>0 à 1</label>
</td>
<td>
<input type="radio" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>moins l’infini à plus l’infini</label>
</td>
<td>
<input type="radio" name="q4" value="2"/>
</td>
</tr>
<tr>
<td>
<label>0 à 100</label>
</td>
<td>
<input type="radio" name="q4" value="3"/>
</td>
</tr>
<tr>
<td>
<label>-1 à 1</label>
</td>
<td>
<input type="radio" name="q4" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Cette statistique est tributaire des unités de mesure des deux variables. Cet inconvénient s’applique à :
</div>
<div>
Relisez au besoin la section @ref(sect0422).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>la corrélation de Pearson</label>
</td>
<td>
<input type="radio" name="q5" value="1"/>
</td>
</tr>
<tr>
<td>
<label>la corrélation de Spearman</label>
</td>
<td>
<input type="radio" name="q5" value="2"/>
</td>
</tr>
<tr>
<td>
<label>la covariance</label>
</td>
<td>
<input type="radio" name="q5" value="3"/>
</td>
</tr>
<tr>
<td>
<label>la corrélation de Kendall</label>
</td>
<td>
<input type="radio" name="q5" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
À la lecture du nuage de points, la corrélation de Pearson entre les deux variables est proche de :
</div>
<img src="images/quiz/Quiz_Chap04_Question_06.jpg" alt="" style="width: 50%;display: block;margin-left: auto;margin-right: auto;margin-bottom: 0.5em;margin-top: 0.5em;"/>
<div>
Relisez au besoin la section @ref(sect041).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>0</label>
</td>
<td>
<input type="radio" name="q6" value="1"/>
</td>
</tr>
<tr>
<td>
<label>-1</label>
</td>
<td>
<input type="radio" name="q6" value="2"/>
</td>
</tr>
<tr>
<td>
<label>1</label>
</td>
<td>
<input type="radio" name="q6" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le coefficient de Spearman est le coefficient de Pearson calculé sur des variables transformées en :
</div>
<div>
Relisez au besoin la section @ref(sect0433).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>rangs</label>
</td>
<td>
<input type="radio" name="q7" value="1"/>
</td>
</tr>
<tr>
<td>
<label>scores Z (variables centrées réduites)</label>
</td>
<td>
<input type="radio" name="q7" value="2"/>
</td>
</tr>
<tr>
<td>
<label>sur une échelle 0 à 100</label>
</td>
<td>
<input type="radio" name="q7" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Dans une régression linéaire, le résidu pour une observation est :
</div>
<div>
Relisez au besoin la section @ref(sect0442).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>la différence entre la variance de Y et la variance expliquée</label>
</td>
<td>
<input type="radio" name="q8" value="1"/>
</td>
</tr>
<tr>
<td>
<label>la différence entre la valeur observée et la valeur prédite</label>
</td>
<td>
<input type="radio" name="q8" value="2"/>
</td>
</tr>
<tr>
<td>
<label>le carré de la différence entre la valeur observée et la valeur prédite</label>
</td>
<td>
<input type="radio" name="q8" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le coefficient de détermination (R2) varie de :
</div>
<div>
Relisez au besoin la section @ref(sect0443).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>-1 à 1</label>
</td>
<td>
<input type="radio" name="q9" value="1"/>
</td>
</tr>
<tr>
<td>
<label>-100 à 100</label>
</td>
<td>
<input type="radio" name="q9" value="2"/>
</td>
</tr>
<tr>
<td>
<label>0 à 1</label>
</td>
<td>
<input type="radio" name="q9" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un facteur confondant est une sorte de fondant au chocolat?
</div>
<div>
Relire le deuxième encadré à la section @ref(sect044).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q10" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q10" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<button type="button" onclick="showResults(quizz_Chapitre4_QuantiQuanti);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:04-bivarieeQuantiQuanti.Rmd-->
</div>
</div>
<div id="chap05" class="section level1">
<h1><span class="header-section-number">5</span> Relation entre deux variables qualitatives</h1>
<p>Dans le cadre de ce chapitre, nous présentons les deux principales méthodes permettant d’explorer les associations entre deux variables qualitatives : la construction d’un tableau de contingence et le test du khi-deux (<span class="math inline">\(\chi^2\)</span>, appelé aussi khi carré).</p>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons les <em>packages</em> suivants :</p>
<ul>
<li><code>gmodels</code> pour construire des tableaux de contingence.</li>
<li><code>vcd</code> pour construire un graphique pour un tableau de contingence.</li>
<li><code>DescTools</code> pour calculer le khi-deux de Mantel-Haenszel.</li>
<li><code>stargazer</code> pour imprimer des tableaux.</li>
</ul>
</div>
<div class="bloc_objectif">
<p><strong>Deux variables qualitatives sont-elles associées entre elles?</strong> Plus spécifiquement, certaines modalités d’une variable qualitative sont-elles associées significativement à certaines modalités d’une autre variable qualitative?</p>
<p>Prenons l’exemple de deux variables qualitatives : l’une intitulée <em>groupe d’âge</em> comprenant trois modalités (15 à 29 ans, 30 à 44 ans, 45 à 64 ans); l’autre intitulée <em>mode de transport habituel pour se rendre au travail</em> comprenant quatre modalités (véhicule motorisé, transport en commun, vélo, marche).</p>
<p>Comparativement aux deux autres groupes, nous pourrions supposer que les jeunes se déplacent proportionnellement plus en modes de transport actif (vélo et marche) et en transport en commun. À l’inverse, il est possible que les 45 à 64 ans se déplacent majoritairement en véhicules motorisés.</p>
<p>Pour vérifier l’existence d’associations significatives entre les modalités de deux variables qualitatives, il est possible de construire un <strong>tableau de contingence</strong>tableau de contingence (section @ref(sect051)), puis de réaliser le <strong>test du khi-deux</strong> (section @ref(sect052)).</p>
</div>
<div id="sect051" class="section level2">
<h2><span class="header-section-number">5.1</span> Construction de tableau de contingence</h2>
<p>Les données du tableau de contingence suivant décrivent 279 projets d’habitation à loyer modique (HLM) dans l’ancienne ville de Montréal, croisant les modalités de la période de construction (en colonne) et de la taille (en ligne) des projets HLM <span class="citation">(Apparicio <a href="#ref-TheseApparicio" role="doc-biblioref">2002</a>)</span>. Les différents éléments du tableau sont décrits ci-dessous.</p>
<ul>
<li><p><strong>Les fréquences observées</strong> (<em>Count</em> au tableau ci-dessous), nommées communément <span class="math inline">\(f_{ij}\)</span>, correspondent aux observations appartenant à la fois à la <em>i<sup>e</sup></em> modalité de la variable en ligne et à la <em>j<sup>e</sup></em> modalité de la variable en colonne. À titre d’exemple, nous comptons 14 projets HLM construits entre 1985 et 1989 comprenant moins de 25 logements.</p></li>
<li><p><strong>Les marges</strong> du tableau sont les totaux pour chaque modalité en ligne (<span class="math inline">\(n_{i.}\)</span>) et en colonne (<span class="math inline">\(n_{j.}\)</span>). En guise d’exemple, sur les 279 projets HLM, 53 comprennent de 25 à 49 logements et 56 ont été construites entre 1968 et 1974. Bien entendu, la somme des marges en ligne (<span class="math inline">\(n_{i.}\)</span>) est égale au nombre total d’observations (<span class="math inline">\(n_{ij}\)</span>), tout comme la somme de marges en colonne (<span class="math inline">\(n_{.j}\)</span>).</p></li>
<li><p><strong>Trois pourcentages</strong> sont disponibles (total, en ligne, en colonne; <em>Total Percent</em>, <em>Row Percent</em> et <em>Column Percent</em> au tableau ci-dessous). Ils sont respectivement la fréquence observée divisée par le nombre d’observations (<span class="math inline">\(f_{ij}/n_{ij}\times100\)</span>), par la marge en ligne (<span class="math inline">\(f_{ij}/n_{i.} \times 100\)</span>) et en colonne (<span class="math inline">\(f_{ij}/n_{.j}\times100\)</span>). En guise d’exemple, 5 % des 279 projets HLM ont été construites entre 1985 et 1989 et comprennent moins de 25 logements (pourcentage total, soit 14 / 279 × 100). Aussi, plus de la moitié des habitations de moins de 25 logements ont été construits entre 1990 et 1994 (pourcentage en ligne, 41 / 80× 100). Finalement, près de 36 % des logements construits avant 1975 ont 100 logements et plus (20 / 56 × 100).</p></li>
<li><p><strong>Les fréquences théoriques</strong> (<em>Expected Values</em> au tableau ci-dessous), représentent les valeurs que l’on devrait observer théoriquement s’il y avait indépendance entre les modalités des deux variables; autrement dit, si la répartition des deux modalités des deux variables était dû au hasard. Pour le croisement de deux modalités, la fréquence théorique est égale au produit des marges divisé par le nombre total d’observations (<span class="math inline">\(ft_{ij} = (n_{i.}n_{.j})/n_{ij}\)</span>). Par exemple, la fréquence théorique pour le croisement des modalités <em>moins de 25 logements</em> et <em>avant 1975</em> est égale à : (80 × 56) / 279 = 16,06. Nous observons ici que la valeur théorique (16,06) est bien supérieure à la valeur réelle (6). Nous avons donc moins de projets HLM de moins de 25 logements avant 1975 à quoi nous pourrions nous attendre du hasard.</p></li>
<li><p><strong>La déviation</strong> (<em>Residual</em> au tableau ci-dessous) est la différence entre la fréquence observée et la fréquence théorique (<span class="math inline">\(f_{ij}-ft_{ij}\)</span>). Plus la déviation est grande, plus nous nous écartons d’une situation d’indépendance entre les deux modalités <em>i</em> et <em>j</em>. La somme des déviations sur une ligne ou sur une colonne est nulle. Si la déviation <em>ij</em> est nulle, la fréquence théorique est égale à la fréquence observée, ce qui signifie qu’il y a indépendance entre les modalités <em>i</em> et <em>j</em>. Une déviation positive traduit, quant à elle, une attraction entre les modalités <em>i</em> et <em>j</em> ou, autrement dit, une surreprésentation du phénomène <em>ij</em>; tandis qu’une déviation négative renvoie à une répulsion entre les modalités <em>i</em> et <em>j</em>, soit une sous-représentation du phénomène <em>ij</em>. Dans le cas précédent, nous observions six habitations de moins de 25 logements construits avant 1975 et une fréquence théorique de 16,06. La déviation est donc -10,06, soit une sous-représentation du phénomène.</p></li>
<li><p><strong>La contribution au khi-deux</strong> (<em>Chi-square contribution</em> au tableau ci-dessous) est égale à la déviation au carré divisée par la fréquence théorique : <span class="math inline">\(\chi_{ij}^2 = (f_{ij}-ft_{ij})^2/ft_{ij}\)</span>. Plus sa valeur est forte, plus il y a association entre les deux modalités. La somme des contributions au khi-deux représente le khi-deux total pour l’ensemble du tableau de contingence (ici à 63,54), que nous aborderons dans la section suivante.</p></li>
</ul>
<pre><code>## 
##    Cell Contents
## |-------------------------|
## |                   Count |
## |         Expected Values |
## | Chi-square contribution |
## |             Row Percent |
## |          Column Percent |
## |           Total Percent |
## |                Residual |
## |-------------------------|
## 
## Total Observations in Table:  279 
## 
##                | TabKhi2$Periode 
## TabKhi2$Taille | Av. 1975  |  1975-79  |  1980-84  |  1985-89  |  1990-94  | Row Total | 
## ---------------|-----------|-----------|-----------|-----------|-----------|-----------|
##      &lt; 25 log. |        6  |       11  |        8  |       14  |       41  |       80  | 
##                |    16.06  |    13.76  |    13.76  |    13.48  |    22.94  |           | 
##                |     6.30  |     0.55  |     2.41  |     0.02  |    14.22  |           | 
##                |     7.50% |    13.75% |    10.00% |    17.50% |    51.25% |    28.67% | 
##                |    10.71% |    22.92% |    16.67% |    29.79% |    51.25% |           | 
##                |     2.15% |     3.94% |     2.87% |     5.02% |    14.70% |           | 
##                |   -10.06  |    -2.76  |    -5.76  |     0.52  |    18.06  |           | 
## ---------------|-----------|-----------|-----------|-----------|-----------|-----------|
##          25-49 |       10  |        5  |        8  |        8  |       22  |       53  | 
##                |    10.64  |     9.12  |     9.12  |     8.93  |    15.20  |           | 
##                |     0.04  |     1.86  |     0.14  |     0.10  |     3.05  |           | 
##                |    18.87% |     9.43% |    15.09% |    15.09% |    41.51% |    19.00% | 
##                |    17.86% |    10.42% |    16.67% |    17.02% |    27.50% |           | 
##                |     3.58% |     1.79% |     2.87% |     2.87% |     7.89% |           | 
##                |    -0.64  |    -4.12  |    -1.12  |    -0.93  |     6.80  |           | 
## ---------------|-----------|-----------|-----------|-----------|-----------|-----------|
##          50-99 |       20  |       21  |       22  |       21  |       15  |       99  | 
##                |    19.87  |    17.03  |    17.03  |    16.68  |    28.39  |           | 
##                |     0.00  |     0.92  |     1.45  |     1.12  |     6.31  |           | 
##                |    20.20% |    21.21% |    22.22% |    21.21% |    15.15% |    35.48% | 
##                |    35.71% |    43.75% |    45.83% |    44.68% |    18.75% |           | 
##                |     7.17% |     7.53% |     7.89% |     7.53% |     5.38% |           | 
##                |     0.13  |     3.97  |     4.97  |     4.32  |   -13.39  |           | 
## ---------------|-----------|-----------|-----------|-----------|-----------|-----------|
##       100 et + |       20  |       11  |       10  |        4  |        2  |       47  | 
##                |     9.43  |     8.09  |     8.09  |     7.92  |    13.48  |           | 
##                |    11.83  |     1.05  |     0.45  |     1.94  |     9.77  |           | 
##                |    42.55% |    23.40% |    21.28% |     8.51% |     4.26% |    16.85% | 
##                |    35.71% |    22.92% |    20.83% |     8.51% |     2.50% |           | 
##                |     7.17% |     3.94% |     3.58% |     1.43% |     0.72% |           | 
##                |    10.57  |     2.91  |     1.91  |    -3.92  |   -11.48  |           | 
## ---------------|-----------|-----------|-----------|-----------|-----------|-----------|
##   Column Total |       56  |       48  |       48  |       47  |       80  |      279  | 
##                |    20.07% |    17.20% |    17.20% |    16.85% |    28.67% |           | 
## ---------------|-----------|-----------|-----------|-----------|-----------|-----------|
## 
##  
## Statistics for All Table Factors
## 
## 
## Pearson&#39;s Chi-squared test 
## ------------------------------------------------------------
## Chi^2 =  63.54291     d.f. =  12     p =  5.063109e-09 
## 
## 
##  
##        Minimum expected frequency: 7.917563</code></pre>
</div>
<div id="sect052" class="section level2">
<h2><span class="header-section-number">5.2</span> Test du khi-deux</h2>
<p>Avec le test du khi-deux, nous postulons qu’il y a indépendance entre les modalités des deux variables qualitatives, soit l’hypothèse nulle (<em>H<sub>0</sub></em>). Puis, nous calculons le nombre de degrés de liberté : <span class="math inline">\(DL = (n-1)(l-1)\)</span>, avec <span class="math inline">\(l\)</span> et <span class="math inline">\(n\)</span> étant respectivement les nombres de modalités en ligne et en colonne. Pour notre tableau de contingence, nous avons 12 degrés de liberté : <span class="math inline">\((4-1)(5-1)=12\)</span>.</p>
<p>À partir du nombre de degrés de liberté et d’un seuil critique de significativité (prenons 5 % ici), nous pouvons trouver la valeur critique de khi-deux dans la table des valeurs critiques du khi-deux, soit 21,03 (voir section @ref(annexe1)). Puisque la valeur du khi-deux calculée dans le tableau de contingence (63,54) est bien supérieure à celle obtenue dans le tableau des valeurs critiques (21,03), nous pouvons rejeter l’hypothèse d’indépendance au seuil de 5 %. Autrement dit, si les deux variables n’étaient pas associées, nous aurions eu moins de 5 % de chances de collecter des données avec ce niveau d’association, ce qui nous permet de rejeter l’hypothèse nulle (absence d’association). Notez que le test reste significatif avec des seuils de 1 % (<em>p</em> = 0,01) et 0,1 % (<em>p</em> = 0,001) puisque les valeurs critiques sont de 26,22 et de 32,91.</p>
<p>Bien entendu, une fois que nous connaissons le nombre de degrés de liberté, nous pouvons directement calculer les valeurs critiques pour différents seuils de signification et éviter ainsi de recourir à la table du du khi-deux. Dans la même veine, nous pouvons aussi calculer la valeur de <em>p</em> d’un tableau de contingence en spécifiant le nombre de degrés de liberté et la valeur du khi-deux obtenue.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="#cb510-1"></a><span class="kw">cat</span>(<span class="st">&quot;Valeurs critiques du khi-deux avec le nombre de degrés de liberté&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb510-2"><a href="#cb510-2"></a>    <span class="kw">round</span>(<span class="kw">qchisq</span>(<span class="dt">p=</span><span class="fl">0.95</span>,  <span class="dt">df=</span><span class="dv">12</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>),<span class="dv">3</span>), <span class="st">&quot;avec p=0,05&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb510-3"><a href="#cb510-3"></a>    <span class="kw">round</span>(<span class="kw">qchisq</span>(<span class="dt">p=</span><span class="fl">0.99</span>,  <span class="dt">df=</span><span class="dv">12</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>),<span class="dv">3</span>), <span class="st">&quot;avec p=0,01&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb510-4"><a href="#cb510-4"></a>    <span class="kw">round</span>(<span class="kw">qchisq</span>(<span class="dt">p=</span><span class="fl">0.999</span>, <span class="dt">df=</span><span class="dv">12</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>),<span class="dv">3</span>), <span class="st">&quot;avec p=0,0001&quot;</span>)</span></code></pre></div>
<pre><code>## Valeurs critiques du khi-deux avec le nombre de degrés de liberté 
##  5.226 avec p=0,05 
##  3.571 avec p=0,01 
##  2.214 avec p=0,0001</code></pre>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="#cb512-1"></a><span class="kw">cat</span>(<span class="st">&quot;Valeur de p du khi-deux obtenu (63.54291) avec 12 degrés de liberté :&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb512-2"><a href="#cb512-2"></a>    <span class="kw">pchisq</span>(<span class="dt">q=</span><span class="fl">63.54291</span>, <span class="dt">df=</span><span class="dv">12</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>))</span></code></pre></div>
<pre><code>## Valeur de p du khi-deux obtenu (63.54291) avec 12 degrés de liberté : 
##  5.063101e-09</code></pre>
<div style="page-break-after: always;"></div>
<div class="bloc_aller_loin">
<p>Outre le khi-deux, d’autres mesures d’association permettent de mesurer le degré d’association entre deux variables qualitatives. Les plus courantes sont reportées dans le tableau suivant. À des fins de comparaison, le khi-deux décrit précédemment est aussi reporté sur la première ligne du tableau.</p>
<table>
<caption>(#tab:EncadreAsso)Autres mesures d’association entre deux variables qualitatives</caption>
<thead>
<tr class="header">
<th align="left">Statistique</th>
<th align="left">Formule</th>
<th align="left">Propriété et interprétation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Khi-deux</td>
<td align="left"><span class="math inline">\(\chi^2 = \sum \frac{(f_{ij}-ft_{ij})^2}{ft_{ij}}\)</span></td>
<td align="left">Mesure classique du khi-deux calculée à partir des différences entre les fréquences observées et attendues. Valeur de <em>p</em> disponible</td>
</tr>
<tr class="even">
<td align="left">Ratio de vraisemblance du khi-deux</td>
<td align="left"><span class="math inline">\(G^2 = 2 \sum f_{ij} \ln{(\frac{f_{ij}}{ft_{ij}})}\)</span></td>
<td align="left">Calculé à partir du ratio entre les fréquences observées et attendues. Valeur de <em>p</em> disponible</td>
</tr>
<tr class="odd">
<td align="left">khi-deux de Mantel-Haenszel</td>
<td align="left"><span class="math inline">\(Q_{MH}=(N-1)r^2\)</span></td>
<td align="left">avec <em>r</em> étant le coefficient de corrélation entre les deux variables qualitatives; par exemple, entre les valeurs des modalités de 1 à 5 de la variable <em>période de construction</em> et celles de 1 à 4 de la variable <em>taille du projet</em> HLM. Ce coefficient est très utile quand les deux variables qualitatives ne sont pas nominales, mais <strong>ordinales</strong>. Valeur de <em>p</em> disponible.</td>
</tr>
<tr class="even">
<td align="left">Corrélation polychorique</td>
<td align="left">Obtenue itérativement par maximum de vraisemblance</td>
<td align="left">Dans le même esprit que le khi-deux de Mantel-Haenszel, la corrélation polychorique s’applique à deux variables <strong>ordinales</strong>. Plus spécifiquement, elle formule le postulat que deux variables théoriques normalement distribuées ont été mesurées de façon approximative avec deux échelles ordinales. Par exemple, en psychologie, le sentiment de bien-être et le sentiment de sécurité peuvent être conceptualisés comme deux variables continues normalement distribuées. Cependant, les mesurer directement est très difficile, nous avons donc recours à des échelles de Likert allant de 1 à 10. Pour cet exemple, il est pertinent d’utiliser la corrélation polychorique. Comme pour une corrélation de Pearson, la corrélation polychorique varie de -1 à 1, une valeur négative indiquant une relation inverse entre les deux variables théoriques et inversement. Une valeur de <em>p</em> peut être obtenue.</td>
</tr>
<tr class="odd">
<td align="left">Coefficient Phi</td>
<td align="left"><span class="math inline">\(\phi=\sqrt{\frac{\chi^2}{n}}\)</span></td>
<td align="left">Simplement le khi-deux divisé par le nombre d’observations. Si les deux variables qualitatives comprennent deux modalités chacune alors <span class="math inline">\(\phi\)</span> varie de -1 à 1; sinon, de 0 à <span class="math inline">\(min(\sqrt{c-1}, \sqrt{l-1})\)</span> avec <em>c</em> et <em>l</em> étant le nombre de modalités en colonne et en ligne. Par conséquent, ce coefficient est surtout utile pour les tableaux comprenant deux modalités pour chacune des variables. Pas de valeur de <em>p</em> disponible.</td>
</tr>
<tr class="even">
<td align="left">V de Cramer</td>
<td align="left"><span class="math inline">\(V=\sqrt{\frac{\chi^2/n}{min(c-1,l-1)}}\)</span></td>
<td align="left">Il représente un ajustement du coefficient Phi et varie de 0 à 1. Plus sa valeur est forte, plus les deux variables sont associées. À la lecture des deux formules, vous constaterez que, pour un tableau de 2x2, la valeur du V de Carmer sera égale à celle du Coefficient Phi. Pas de valeur de <em>p</em> disponible.</td>
</tr>
</tbody>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div id="sect053" class="section level2">
<h2><span class="header-section-number">5.3</span> Mise en œuvre dans R</h2>
<p>Pour calculer le khi-deux entre deux variables qualitatives, nous utilisons la fonction de base :</p>
<p><code>chisq.test(x = ..., y = ...)</code> qui renvoie le nombre de degrés de liberté, les valeurs du khi-deux et de <em>p</em>.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="#cb514-1"></a><span class="co"># Importation du csv</span></span>
<span id="cb514-2"><a href="#cb514-2"></a>dataHLM &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/bivariee/hlm.csv&quot;</span>)</span>
<span id="cb514-3"><a href="#cb514-3"></a><span class="co"># Calcul du khi-deux avec la fonction de base chisq.test</span></span>
<span id="cb514-4"><a href="#cb514-4"></a><span class="kw">chisq.test</span>(<span class="dt">x =</span> dataHLM<span class="op">$</span>Taille, <span class="dt">y =</span> dataHLM<span class="op">$</span>Periode)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  dataHLM$Taille and dataHLM$Periode
## X-squared = 63.543, df = 12, p-value = 5.063e-09</code></pre>
<p>Pour la construction du tableau de contingence, deux options sont possibles dépendamment de la structure de votre tableau de données. Premier cas de figure : votre tableau comprend une ligne par observation avec les différentes modalités dans deux colonnes (ici <em>Periode</em> et <em>Taille</em>). Dans la syntaxe ci-dessous, pour chacune des deux variables qualitatives, nous créons un facteur afin de spécifier un intitulé à chaque modalité (<code>factor(levels =c(....), labels = c(..)</code>). Puis, nous utilisons la fonction <code>CrossTable</code> du <em>package</em> <code>gmodels</code>. Pour obtenir les fréquences théoriques, les contributions locales au khi-deux et les déviations, nous spécifions les options suivantes : <code>expected=TRUE, chisq=TRUE, resid=TRUE</code>.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="#cb516-1"></a><span class="kw">library</span>(<span class="st">&quot;gmodels&quot;</span>)</span>
<span id="cb516-2"><a href="#cb516-2"></a><span class="co"># Premiers enregistrements du tableau</span></span>
<span id="cb516-3"><a href="#cb516-3"></a><span class="kw">head</span>(dataHLM)</span></code></pre></div>
<pre><code>##   Periode Taille
## 1       5      1
## 2       5      1
## 3       5      2
## 4       5      1
## 5       5      1
## 6       5      2</code></pre>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="#cb518-1"></a><span class="co"># La variable Periode comprend 5 modalités (de 1 à 5)</span></span>
<span id="cb518-2"><a href="#cb518-2"></a><span class="kw">table</span>(dataHLM<span class="op">$</span>Periode)</span></code></pre></div>
<pre><code>## 
##  1  2  3  4  5 
## 56 48 48 47 80</code></pre>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="#cb520-1"></a><span class="co"># La variable Taille comprend 4 modalités (de 1 à 4)</span></span>
<span id="cb520-2"><a href="#cb520-2"></a><span class="kw">table</span>(dataHLM<span class="op">$</span>Taille)</span></code></pre></div>
<pre><code>## 
##  1  2  3  4 
## 80 53 99 47</code></pre>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="#cb522-1"></a><span class="co"># Création d&#39;un facteur pour les cinq modalités de la période de construction</span></span>
<span id="cb522-2"><a href="#cb522-2"></a>dataHLM<span class="op">$</span>Periode &lt;-<span class="st"> </span><span class="kw">factor</span>(dataHLM<span class="op">$</span>Periode, </span>
<span id="cb522-3"><a href="#cb522-3"></a>                          <span class="dt">levels =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>), </span>
<span id="cb522-4"><a href="#cb522-4"></a>                          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;&lt;1975&quot;</span>, </span>
<span id="cb522-5"><a href="#cb522-5"></a>                                     <span class="st">&quot;1975-1979&quot;</span>, </span>
<span id="cb522-6"><a href="#cb522-6"></a>                                     <span class="st">&quot;1980-1984&quot;</span>, </span>
<span id="cb522-7"><a href="#cb522-7"></a>                                     <span class="st">&quot;1985-1989&quot;</span>, </span>
<span id="cb522-8"><a href="#cb522-8"></a>                                     <span class="st">&quot;1990-1994&quot;</span>))</span>
<span id="cb522-9"><a href="#cb522-9"></a><span class="co"># Création d&#39;un facteur pour les quatre modalités de la taille des habitations</span></span>
<span id="cb522-10"><a href="#cb522-10"></a>dataHLM<span class="op">$</span>Taille &lt;-<span class="st"> </span><span class="kw">factor</span>(dataHLM<span class="op">$</span>Taille, </span>
<span id="cb522-11"><a href="#cb522-11"></a>                         <span class="dt">levels =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), </span>
<span id="cb522-12"><a href="#cb522-12"></a>                         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;&lt;25 log.&quot;</span>, </span>
<span id="cb522-13"><a href="#cb522-13"></a>                                    <span class="st">&quot;25-49&quot;</span>, </span>
<span id="cb522-14"><a href="#cb522-14"></a>                                    <span class="st">&quot;50-99&quot;</span>, </span>
<span id="cb522-15"><a href="#cb522-15"></a>                                    <span class="st">&quot;100 et +&quot;</span>))</span>
<span id="cb522-16"><a href="#cb522-16"></a><span class="co"># Pour construire un tableau de contingence, nous utilisons </span></span>
<span id="cb522-17"><a href="#cb522-17"></a><span class="co"># la fonction CrossTable du package gmodels. </span></span>
<span id="cb522-18"><a href="#cb522-18"></a><span class="co"># Les deux lignes ci-dessous sont mises en commentaire pour ne pas répéter le tableau.</span></span>
<span id="cb522-19"><a href="#cb522-19"></a><span class="co"># CrossTable(x=dataHLM$Taille, y=dataHLM$Periode, digits = 2,</span></span>
<span id="cb522-20"><a href="#cb522-20"></a><span class="co">#           expected=TRUE, chisq = TRUE, resid = TRUE, format=&quot;SPSS&quot;)</span></span></code></pre></div>
<p>Deuxième cas de figure : vous disposez déjà d’un tableau de contingence, soit les fréquences observées (<span class="math inline">\(f_{ij}\)</span>). Nous n’utilisons donc pas la fonction <code>CrossTable</code>, mais directement la fonction <code>chisq.test</code>.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="#cb523-1"></a><span class="co"># Importation des données</span></span>
<span id="cb523-2"><a href="#cb523-2"></a>df1 &lt;-<span class="st">  </span><span class="kw">read.csv</span>(<span class="st">&quot;data/bivariee/data_transport.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb523-3"><a href="#cb523-3"></a>df1 <span class="co"># Visualisation du tableau</span></span></code></pre></div>
<pre><code>##                                     ModeTransport  Homme  Femme
## 1 Automobile, camion ou fourgonnette - conducteur 689400 561830
## 2   Automobile, camion ou fourgonnette - passager  21315  40010
## 3                             Transport en commun 181435 238330
## 4                                          A pied  43715  54360
## 5                                      Bicyclette  24295  13765
## 6                                     Autre moyen   8395   6970</code></pre>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="#cb525-1"></a>Matrice &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df1[, <span class="kw">c</span>(<span class="st">&quot;Homme&quot;</span>,<span class="st">&quot;Femme&quot;</span>)])</span>
<span id="cb525-2"><a href="#cb525-2"></a><span class="kw">dimnames</span>(Matrice) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">unique</span>(df1<span class="op">$</span>ModeTransport), <span class="dt">Sexe=</span><span class="kw">c</span>(<span class="st">&quot;Homme&quot;</span>,<span class="st">&quot;Femme&quot;</span>))</span>
<span id="cb525-3"><a href="#cb525-3"></a><span class="co"># Notez que vous pouvez saisir vos données directement si vous avez peu d&#39;observations</span></span>
<span id="cb525-4"><a href="#cb525-4"></a>Femme &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">689400</span>, <span class="dv">21315</span>, <span class="dv">181435</span>, <span class="dv">43715</span>, <span class="dv">24295</span>, <span class="dv">8395</span>) <span class="co"># Vecteur de valeurs pour les femmes</span></span>
<span id="cb525-5"><a href="#cb525-5"></a>Homme &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">561830</span>, <span class="dv">40010</span>, <span class="dv">238330</span>, <span class="dv">54360</span>, <span class="dv">13765</span>, <span class="dv">6970</span>) <span class="co"># Vecteur de valeurs pour les hommes</span></span>
<span id="cb525-6"><a href="#cb525-6"></a>Matrice &lt;-<span class="st"> </span><span class="kw">as.table</span>(<span class="kw">cbind</span>(Femme, Homme)) <span class="co"># Création du tableau</span></span>
<span id="cb525-7"><a href="#cb525-7"></a><span class="co"># Nom des deux variables et de leurs modalités respectives</span></span>
<span id="cb525-8"><a href="#cb525-8"></a><span class="kw">dimnames</span>(Matrice) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Transport=</span><span class="kw">c</span>(<span class="st">&quot;Automobile (conducteur)&quot;</span>,</span>
<span id="cb525-9"><a href="#cb525-9"></a>                                      <span class="st">&quot;Automobile (passager)&quot;</span>,</span>
<span id="cb525-10"><a href="#cb525-10"></a>                                      <span class="st">&quot;Transport en commun&quot;</span>,                            </span>
<span id="cb525-11"><a href="#cb525-11"></a>                                      <span class="st">&quot;À pied&quot;</span>,</span>
<span id="cb525-12"><a href="#cb525-12"></a>                                      <span class="st">&quot;Bicyclette&quot;</span>,</span>
<span id="cb525-13"><a href="#cb525-13"></a>                                      <span class="st">&quot;Autre moyen&quot;</span>),</span>
<span id="cb525-14"><a href="#cb525-14"></a>                          <span class="dt">Sexe=</span><span class="kw">c</span>(<span class="st">&quot;Homme&quot;</span>,<span class="st">&quot;Femme&quot;</span>))</span>
<span id="cb525-15"><a href="#cb525-15"></a><span class="co"># Test du khi-deux</span></span>
<span id="cb525-16"><a href="#cb525-16"></a>test &lt;-<span class="st"> </span><span class="kw">chisq.test</span>(Matrice)</span>
<span id="cb525-17"><a href="#cb525-17"></a><span class="kw">print</span>(test)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  Matrice
## X-squared = 29134, df = 5, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="#cb527-1"></a><span class="co"># Fréquences observées (Fij)</span></span>
<span id="cb527-2"><a href="#cb527-2"></a>test<span class="op">$</span>observed</span></code></pre></div>
<pre><code>##                          Sexe
## Transport                  Homme  Femme
##   Automobile (conducteur) 689400 561830
##   Automobile (passager)    21315  40010
##   Transport en commun     181435 238330
##   À pied                   43715  54360
##   Bicyclette               24295  13765
##   Autre moyen               8395   6970</code></pre>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="#cb529-1"></a><span class="co"># Fréquences théoriques (FTij)</span></span>
<span id="cb529-2"><a href="#cb529-2"></a><span class="kw">round</span>(test<span class="op">$</span>expected,<span class="dv">0</span>)</span></code></pre></div>
<pre><code>##                          Sexe
## Transport                  Homme  Femme
##   Automobile (conducteur) 643313 607917
##   Automobile (passager)    31530  29795
##   Transport en commun     215820 203945
##   À pied                   50425  47650
##   Bicyclette               19568  18492
##   Autre moyen               7900   7465</code></pre>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="#cb531-1"></a><span class="co"># Déviations (Fij - FTij)</span></span>
<span id="cb531-2"><a href="#cb531-2"></a><span class="kw">round</span>(test<span class="op">$</span>observed<span class="op">-</span>test<span class="op">$</span>expected,<span class="dv">0</span>)</span></code></pre></div>
<pre><code>##                          Sexe
## Transport                  Homme  Femme
##   Automobile (conducteur)  46087 -46087
##   Automobile (passager)   -10215  10215
##   Transport en commun     -34385  34385
##   À pied                   -6710   6710
##   Bicyclette                4727  -4727
##   Autre moyen                495   -495</code></pre>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="#cb533-1"></a><span class="co"># Contributions au khi-deux</span></span>
<span id="cb533-2"><a href="#cb533-2"></a><span class="kw">round</span>((test<span class="op">$</span>observed<span class="op">-</span>test<span class="op">$</span>expected)<span class="op">^</span><span class="dv">2</span><span class="op">/</span>test<span class="op">$</span>expected,<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##                          Sexe
## Transport                   Homme   Femme
##   Automobile (conducteur) 3301.74 3493.98
##   Automobile (passager)   3309.37 3502.05
##   Transport en commun     5478.22 5797.18
##   À pied                   892.81  944.80
##   Bicyclette              1141.71 1208.19
##   Autre moyen               31.04   32.85</code></pre>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="#cb535-1"></a><span class="co"># Marges en ligne et en colonne</span></span>
<span id="cb535-2"><a href="#cb535-2"></a><span class="kw">colSums</span>(Matrice)</span></code></pre></div>
<pre><code>##  Homme  Femme 
## 968555 915265</code></pre>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="#cb537-1"></a><span class="kw">rowSums</span>(Matrice)</span></code></pre></div>
<pre><code>## Automobile (conducteur)   Automobile (passager)     Transport en commun 
##                 1251230                   61325                  419765 
##                  À pied              Bicyclette             Autre moyen 
##                   98075                   38060                   15365</code></pre>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="#cb539-1"></a><span class="co"># Grand total</span></span>
<span id="cb539-2"><a href="#cb539-2"></a><span class="kw">sum</span>(Matrice)</span></code></pre></div>
<pre><code>## [1] 1883820</code></pre>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="#cb541-1"></a><span class="co"># Pourcentages</span></span>
<span id="cb541-2"><a href="#cb541-2"></a><span class="kw">round</span>(Matrice<span class="op">/</span><span class="kw">sum</span>(Matrice)<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##                          Sexe
## Transport                 Homme Femme
##   Automobile (conducteur) 36.60 29.82
##   Automobile (passager)    1.13  2.12
##   Transport en commun      9.63 12.65
##   À pied                   2.32  2.89
##   Bicyclette               1.29  0.73
##   Autre moyen              0.45  0.37</code></pre>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="#cb543-1"></a><span class="co"># Pourcentages en ligne</span></span>
<span id="cb543-2"><a href="#cb543-2"></a><span class="kw">round</span>(Matrice<span class="op">/</span><span class="kw">rowSums</span>(Matrice)<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##                          Sexe
## Transport                 Homme Femme
##   Automobile (conducteur) 55.10 44.90
##   Automobile (passager)   34.76 65.24
##   Transport en commun     43.22 56.78
##   À pied                  44.57 55.43
##   Bicyclette              63.83 36.17
##   Autre moyen             54.64 45.36</code></pre>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="#cb545-1"></a><span class="co"># Pourcentages en colonne</span></span>
<span id="cb545-2"><a href="#cb545-2"></a><span class="kw">round</span>(Matrice<span class="op">/</span><span class="kw">colSums</span>(Matrice)<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##                          Sexe
## Transport                 Homme Femme
##   Automobile (conducteur) 71.18 58.01
##   Automobile (passager)    2.33  4.37
##   Transport en commun     18.73 24.61
##   À pied                   4.78  5.94
##   Bicyclette               2.51  1.42
##   Autre moyen              0.92  0.76</code></pre>
<p>Pour obtenir les autres mesures d’association (tableau @ref(tab:TableMesuresAssociations)), nous pourrons utiliser la syntaxe suivante :</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="#cb547-1"></a>df1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/bivariee/hlm.csv&quot;</span>)</span>
<span id="cb547-2"><a href="#cb547-2"></a><span class="co"># Fonction pour calculer les autres mesures d&#39;association</span></span>
<span id="cb547-3"><a href="#cb547-3"></a>AutresMesuresKhi2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y){</span>
<span id="cb547-4"><a href="#cb547-4"></a>  testChi2 &lt;-<span class="st"> </span><span class="kw">chisq.test</span>(x, y) <span class="co"># Calcul du khi-deux</span></span>
<span id="cb547-5"><a href="#cb547-5"></a>  n  &lt;-<span class="st"> </span><span class="kw">sum</span>(testChi2<span class="op">$</span>observed)  <span class="co"># Nombre d&#39;observations</span></span>
<span id="cb547-6"><a href="#cb547-6"></a>  nc &lt;-<span class="st"> </span><span class="kw">ncol</span>(testChi2<span class="op">$</span>observed) <span class="co"># Nombre de colonnes</span></span>
<span id="cb547-7"><a href="#cb547-7"></a>  l &lt;-<span class="st"> </span><span class="kw">nrow</span>(testChi2<span class="op">$</span>observed) <span class="co"># Nombre de lignes</span></span>
<span id="cb547-8"><a href="#cb547-8"></a>  dl &lt;-<span class="st"> </span>(nc<span class="dv">-1</span>)<span class="op">*</span>(l<span class="dv">-1</span>)            <span class="co"># Nombre de degrés de libertés</span></span>
<span id="cb547-9"><a href="#cb547-9"></a>  chi2 &lt;-<span class="st"> </span>testChi2<span class="op">$</span>statistic   <span class="co"># Valeur du khi-deux</span></span>
<span id="cb547-10"><a href="#cb547-10"></a>  Pchi2 &lt;-<span class="st"> </span>testChi2<span class="op">$</span>p.value    <span class="co"># P pour le khi-deux</span></span>
<span id="cb547-11"><a href="#cb547-11"></a>  </span>
<span id="cb547-12"><a href="#cb547-12"></a>  <span class="co">#Ratio de vraisemblance du khi-deux</span></span>
<span id="cb547-13"><a href="#cb547-13"></a>  G &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span><span class="kw">sum</span>(testChi2<span class="op">$</span>observed<span class="op">*</span><span class="kw">log</span>(testChi2<span class="op">$</span>observed<span class="op">/</span>testChi2<span class="op">$</span>expected)) <span class="co"># G2</span></span>
<span id="cb547-14"><a href="#cb547-14"></a>  PG &lt;-<span class="st"> </span><span class="kw">pchisq</span>(G, <span class="dt">df=</span>dl, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) <span class="co"># P pour le G22</span></span>
<span id="cb547-15"><a href="#cb547-15"></a>  </span>
<span id="cb547-16"><a href="#cb547-16"></a>  <span class="co"># khi-deux de Mantel-Haenszel avec le package DescTools</span></span>
<span id="cb547-17"><a href="#cb547-17"></a>  MHTest &lt;-<span class="st"> </span>DescTools<span class="op">::</span><span class="kw">MHChisqTest</span>(testChi2<span class="op">$</span>observed)</span>
<span id="cb547-18"><a href="#cb547-18"></a>  MH &lt;-<span class="st"> </span>MHTest<span class="op">$</span>statistic</span>
<span id="cb547-19"><a href="#cb547-19"></a>  PMH &lt;-<span class="st"> </span>MHTest<span class="op">$</span>p.value</span>
<span id="cb547-20"><a href="#cb547-20"></a>  </span>
<span id="cb547-21"><a href="#cb547-21"></a>  <span class="co"># Coefficient de correlation polychorique</span></span>
<span id="cb547-22"><a href="#cb547-22"></a>  df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="st">&quot;x&quot;</span> =<span class="st"> </span><span class="kw">as.factor</span>(x),</span>
<span id="cb547-23"><a href="#cb547-23"></a>                 <span class="st">&quot;y&quot;</span> =<span class="st"> </span><span class="kw">as.factor</span>(y))</span>
<span id="cb547-24"><a href="#cb547-24"></a>  polychoricCorr &lt;-<span class="st"> </span>correlation<span class="op">::</span><span class="kw">cor_test</span>(df1,<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>,<span class="dt">method =</span> <span class="st">&quot;polychoric&quot;</span>)</span>
<span id="cb547-25"><a href="#cb547-25"></a>  polyR &lt;-<span class="st"> </span>polychoricCorr<span class="op">$</span>rho</span>
<span id="cb547-26"><a href="#cb547-26"></a>  polyP &lt;-<span class="st"> </span>polychoricCorr<span class="op">$</span>p</span>
<span id="cb547-27"><a href="#cb547-27"></a></span>
<span id="cb547-28"><a href="#cb547-28"></a>  <span class="co"># Coefficient Phi et V de Cramer</span></span>
<span id="cb547-29"><a href="#cb547-29"></a>  phi &lt;-<span class="st"> </span><span class="kw">sqrt</span>(chi2<span class="op">/</span>n)</span>
<span id="cb547-30"><a href="#cb547-30"></a>  vc &lt;-<span class="st"> </span><span class="kw">sqrt</span>(chi2<span class="op">/</span>(n<span class="op">*</span><span class="kw">min</span>(nc<span class="dv">-1</span>,l<span class="dv">-1</span>)))</span>
<span id="cb547-31"><a href="#cb547-31"></a>  </span>
<span id="cb547-32"><a href="#cb547-32"></a>  <span class="co"># Tableau pour les résultats</span></span>
<span id="cb547-33"><a href="#cb547-33"></a>  dfsortie &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb547-34"><a href="#cb547-34"></a>        <span class="dt">Statistique =</span> <span class="kw">c</span>(<span class="st">&quot;Khi-deux&quot;</span>, </span>
<span id="cb547-35"><a href="#cb547-35"></a>                        <span class="st">&quot;Ratio de vraisemblance du  khi-deux&quot;</span>, </span>
<span id="cb547-36"><a href="#cb547-36"></a>                        <span class="st">&quot;Khi-deux de Mantel-Haenszel&quot;</span>,</span>
<span id="cb547-37"><a href="#cb547-37"></a>                        <span class="st">&quot;Corrélation Polychorique&quot;</span>,</span>
<span id="cb547-38"><a href="#cb547-38"></a>                        <span class="st">&quot;Coefficient de Phi&quot;</span>,</span>
<span id="cb547-39"><a href="#cb547-39"></a>                        <span class="st">&quot;V de Cramer&quot;</span>), </span>
<span id="cb547-40"><a href="#cb547-40"></a>        <span class="dt">Valeur =</span> <span class="kw">round</span>(<span class="kw">c</span>(chi2, G, MH, polyR, phi, vc),<span class="dv">3</span>), </span>
<span id="cb547-41"><a href="#cb547-41"></a>        <span class="dt">P =</span> <span class="kw">round</span>(<span class="kw">c</span>(Pchi2, PG, PMH, polyP , <span class="ot">NA</span>, <span class="ot">NA</span>),<span class="dv">10</span>))</span>
<span id="cb547-42"><a href="#cb547-42"></a>  <span class="kw">return</span>(dfsortie)</span>
<span id="cb547-43"><a href="#cb547-43"></a>}</span>
<span id="cb547-44"><a href="#cb547-44"></a></span>
<span id="cb547-45"><a href="#cb547-45"></a>dfkhi2 &lt;-<span class="st"> </span><span class="kw">AutresMesuresKhi2</span>(df1<span class="op">$</span>Periode, df1<span class="op">$</span>Taille)</span>
<span id="cb547-46"><a href="#cb547-46"></a></span>
<span id="cb547-47"><a href="#cb547-47"></a><span class="co"># Impression du tableau avec le package stargazer</span></span>
<span id="cb547-48"><a href="#cb547-48"></a><span class="kw">library</span>(stargazer)</span>
<span id="cb547-49"><a href="#cb547-49"></a><span class="kw">stargazer</span>(dfkhi2, <span class="dt">type=</span><span class="st">&quot;text&quot;</span>, <span class="dt">summary=</span><span class="ot">FALSE</span>, <span class="dt">rownames=</span><span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="ot">FALSE</span>, <span class="dt">digits =</span> <span class="dv">3</span>,</span>
<span id="cb547-50"><a href="#cb547-50"></a>          <span class="dt">title=</span><span class="st">&quot;Mesures d&#39;association entre les deux variables qualitatives&quot;</span>)</span></code></pre></div>
<table>
<caption>
(#tab:TableMesuresAssociations)Mesures d’association entre deux variables qualitatives
</caption>
<thead>
<tr>
<th style="text-align:left;">
Statistique
</th>
<th style="text-align:right;">
Valeur
</th>
<th style="text-align:right;">
P
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Khi-deux
</td>
<td style="text-align:right;">
63,543
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Ratio de vraisemblance du khi-deux
</td>
<td style="text-align:right;">
67,286
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Khi-deux de Mantel-Haenszel
</td>
<td style="text-align:right;">
48,486
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Corrélation Polychorique
</td>
<td style="text-align:right;">
-0,479
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Coefficient de Phi
</td>
<td style="text-align:right;">
0,477
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
V de Cramer
</td>
<td style="text-align:right;">
0,276
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect054" class="section level2">
<h2><span class="header-section-number">5.4</span> Interprétation d’un tableau de contingence</h2>
<p>Nous vous proposons une démarche très simple pour vérifier l’association entre deux variables qualitatives avec les deux étapes suivantes :</p>
<ul>
<li><p>Nous posons l’hypothèse nulle (<em>H<sub>0</sub></em>), soit l’indépendance entre les deux variables.</p></li>
<li><p>Si la valeur du khi-deux total du tableau de contingence est inférieure à la valeur critique du khi-deux avec <em>p</em> = 0,05 et le nombre de degrés de liberté de la table <em>T</em>, alors il y a bien indépendance. La valeur de <em>p</em> est alors supérieure à 0,05. <strong>L’analyse s’arrête donc là!</strong> Autrement dit, il n’est pas nécessaire d’analyser le contenu de votre tableau de contingence puisqu’il n’y pas d’association significative entre les modalités des deux variables. Vous pouvez simplement signaler que selon les résultats du test du khi-deux, il n’y a pas d’association significative entre les deux variables (<span class="math inline">\(\chi\)</span> = … avec <em>p</em>= …).</p></li>
<li><p>S’il y a dépendance (<span class="math inline">\(khi_{observé}^2 &gt; khi_{critique}^2\)</span>), trouvez les cellules <em>ij</em> où les contributions au khi-deux sont les plus fortes, c’est-à-dire où les associations entre les modalités <em>i</em> de la variable en ligne et les modalités <em>j</em> de la variable en colonne sont les plus marquées. Pour ces cellules, le phénomène <em>ij</em> est surreprésenté si la déviation est positive ou sous-représenté si la déviation est négative. Commentez ces associations et utilisez les pourcentages en ligne ou en colonne pour appuyer vos propos.</p></li>
</ul>
<div class="bloc_astuce">
<p>Pour repérer rapidement les cellules où les contributions au khi-deux sont les plus fortes, vous pouvez construire un graphique avec la fonction <code>mosaic</code> du <em>package</em> <code>vcd</code>. À la figure @ref(fig:figVDC), la taille des rectangles représente les effectifs entre les deux modalités tandis que les associations sont représentées comme suit :
en gris lorsqu’elles ne sont pas significatives, en rouge pour des déviations significatives et négatives et en bleu pour des déviations significatives et positives.</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="#cb548-1"></a><span class="kw">library</span>(vcd)</span>
<span id="cb548-2"><a href="#cb548-2"></a><span class="kw">mosaic</span>(<span class="op">~</span><span class="st"> </span>Taille<span class="op">+</span>Periode, </span>
<span id="cb548-3"><a href="#cb548-3"></a>         <span class="dt">data=</span>dataHLM,<span class="dt">shade=</span><span class="ot">TRUE</span>, <span class="dt">legend=</span><span class="ot">TRUE</span>,</span>
<span id="cb548-4"><a href="#cb548-4"></a>         <span class="dt">labeling=</span> <span class="kw">labeling_border</span>(<span class="dt">rot_labels =</span> <span class="kw">c</span>(<span class="dv">45</span>, <span class="dv">90</span>),</span>
<span id="cb548-5"><a href="#cb548-5"></a>         <span class="dt">just_labels =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;center&quot;</span>)))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figVDC-1.png" alt="Figure avec la fonction mosaic du package vcd" width="672" />
<p class="caption">
(#fig:figVDC)Figure avec la fonction mosaic du package vcd
</p>
</div>
</div>
<p><strong>Exemple d’interprétation.</strong> « Les résultats du test du khi-deux signalent qu’il existe des associations entre les modalités de la taille et de la période de construction des projets d’habitation (<span class="math inline">\(\chi\)</span> = 63,5, <em>p</em> &lt; 0,001). Les fortes contributions au khi-deux et le signe positif ou négatif des déviations correspondantes permettent de repérer cinq associations majeures entre les modalités de taille et de période de construction des projets HLM : <strong>1)</strong> la répulsion entre les projets d’habitation de moins de 25 logements et la période de construction 1964-1974; <strong>2)</strong> l’attraction entre les projets d’habitation de 100 logements et plus et la période de construction de 1969-1974; <strong>3)</strong> l’attraction entre les projets d’habitation de moins de 25 logements et la période de construction de 1990-1994; <strong>4)</strong> la répulsion entre les projets d’habitation de 50 à 99 logements et la période de construction 1990-1994; <strong>5)</strong> la répulsion entre les projets d’habitation de 100 logements et plus et la période de construction 1990-1994.
On observe donc une tendance bien marquée dans l’évolution du type de construction entre 1970 et 1994 : entre 1969 et 1974, on a construit de grandes habitations dépassant souvent 100 logements; du milieu des années 1970 à la fin des années 1980, on privilégie la construction d’habitations de taille plus modeste, entre 50 et 100 logements; tandis qu’au début des années 1990, on opte plutôt pour des habitations de taille réduite (moins de 50 logements). Quelques chiffres à l’appui : sur les 56 habitations réalisées entre 1969 et 1974, 20 ont plus de 100 logements, 20 comprennent entre 50 et 99 logements et seules 10 ont moins de 25 logements. Près de la moitié des habitations construites entre 1975 et 1989 regroupent 50 à 99 logements (43,8 % pour la période 1975-1979, 45,8 % pour 1980-1984 et 44,7 % pour 1985-1989). Par contre, 51 % des habitations érigés à partir de 1990 disposent de moins de 25 logements » (<span class="citation">Apparicio (<a href="#ref-TheseApparicio" role="doc-biblioref">2002</a>)</span>, p. 117-118). Notez que cette évolution décroissante est aussi soutenue par le coefficient négatif de la corrélation polychorique.</p>
<p>Vous pouvez aussi construire un graphique pour appuyer vos constats, soit avec les pourcentages en ligne ou en colonne (figure @ref(fig:fighlm) tirée de <span class="citation">Apparicio (<a href="#ref-TheseApparicio" role="doc-biblioref">2002</a>)</span>).</p>
<div class="figure" style="text-align: center">
<img src="images/bivariee/figurehlm.PNG" alt="Taille des projets d'habitation à loyer modique selon la période de construction" width="80%" />
<p class="caption">
(#fig:fighlm)Taille des projets d’habitation à loyer modique selon la période de construction
</p>
</div>
<p><strong>Comment rapporter succinctement les résultats d’un test du khi-deux?</strong></p>
<p>Le test du khi-deux a été réalisé pour examiner la relation entre la taille et la période de construction des habitations HLM. Cette relation est significative : <span class="math inline">\(\chi^2\)</span>(12, N = 279) = 63,5, <em>p</em> &lt; 0,001. Plus les projets ont été construits récemment, plus ils sont de taille réduite.</p>
<p>Pour un texte en anglais, consultez <a href="https://www.socscistatistics.com/tutorials/chisquare/default.aspx" target="_blank">https://www.socscistatistics.com/tutorials/chisquare/default.aspx</a>.</p>
<div style="page-break-after: always;"></div>
</div>
<div id="sect055" class="section level2">
<h2><span class="header-section-number">5.5</span> Quiz de révision du chapitre</h2>
<div id="Chapitre5_QualiQuali" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_Chapitre5_QualiQuali;
  window.onload = function() {
    quizz_Chapitre5_QualiQuali = new Quiz('Chapitre5_QualiQuali', ['4',['1', '2', '3', '4', '6'],'1','1']);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour analyser la relation entre deux variables qualitatives, vous utilisez :
</div>
<div>
Relisez au besoin l’introduction du chapitre @ref(chap05).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>la covariance</label>
</td>
<td>
<input type="radio" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>la régression linéaire simple</label>
</td>
<td>
<input type="radio" name="q1" value="2"/>
</td>
</tr>
<tr>
<td>
<label>le coefficient de corrélation de Pearson</label>
</td>
<td>
<input type="radio" name="q1" value="3"/>
</td>
</tr>
<tr>
<td>
<label>un tableau de continence et un test du khi2</label>
</td>
<td>
<input type="radio" name="q1" value="4"/>
</td>
</tr>
<tr>
<td>
<label>le coefficient de corrélation de Spearman</label>
</td>
<td>
<input type="radio" name="q1" value="5"/>
</td>
</tr>
<tr>
<td>
<label>un compteur Geiger</label>
</td>
<td>
<input type="radio" name="q1" value="6"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Dans un tableau de contingence, quels sont les éléments disponibles?
</div>
<div>
Relisez au besoin la section @ref(sect051).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Fréquences théoriques</label>
</td>
<td>
<input type="checkbox" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Fréquences observées</label>
</td>
<td>
<input type="checkbox" name="q2" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Trois pourcentages (total, en lignes et en colonnes)</label>
</td>
<td>
<input type="checkbox" name="q2" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Déviations</label>
</td>
<td>
<input type="checkbox" name="q2" value="4"/>
</td>
</tr>
<tr>
<td>
<label>Variance</label>
</td>
<td>
<input type="checkbox" name="q2" value="5"/>
</td>
</tr>
<tr>
<td>
<label>Contributions au khi-deux</label>
</td>
<td>
<input type="checkbox" name="q2" value="6"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
La corrélation polychorique est particulièrement bien adaptée pour mesurer l’association entre deux variables qualitatives :
</div>
<div>
Relisez au besoin l’encadré à la section @ref(sect052).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>ordinales</label>
</td>
<td>
<input type="radio" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>nominales</label>
</td>
<td>
<input type="radio" name="q3" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
S’il y a indépendance entre les deux variables qualitatives (khi-deux observé inférieur au khi-deux critique), il n’est pas nécessaire d’analyser en détail le tableau de contingence.
</div>
<div>
Relisez au besoin la section @ref(sect054).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q4" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<button type="button" onclick="showResults(quizz_Chapitre5_QualiQuali);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:05-bivarieeQualiQuali.Rmd-->
</div>
</div>
<div id="chap06" class="section level1">
<h1><span class="header-section-number">6</span> Relation entre une variable qualitative et une variable quantitative</h1>
<p>Dans le cadre de ce chapitre, nous présentons les principales méthodes permettant d’explorer les associations entre une variable quantitative et une variable qualitative avec deux modalités (tests de Student, de Welch et de Wilcoxon) ou avec plus de deux modalités (ANOVA et test de Kruskal-Wallis).</p>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons les <em>packages</em> suivants :</p>
<ul>
<li>Pour créer des graphiques :
<ul>
<li><code>ggplot2</code>, le seul, l’unique!</li>
<li><code>ggpubr</code> pour combiner des graphiques.</li>
</ul></li>
<li>Pour manipuler des données :
<ul>
<li><code>dplyr</code>, avec les fonctions <code>group_by</code>, <code>summarize</code> et les pipes <code>%&gt;%</code>.</li>
</ul></li>
<li>Pour les test <em>t</em> :
<ul>
<li><code>sjstats</code> pour réaliser des test <em>t</em> pondérés.</li>
<li><code>effectsize</code> pour calculer les tailles d’effet de tests <em>t</em>.</li>
</ul></li>
<li>Pour la section sur les ANOVA :
<ul>
<li>**<code>car</code> pour les ANOVA classiques.</li>
<li><code>lmtest</code> pour le test de Breusch-Pagan d’homogénéité des variances.</li>
<li><code>rstatix</code> intégrant de nombreux tests classiques (comme le test de Shapiro) avec <code>tidyverse</code>.</li>
</ul></li>
<li>Autre <em>package</em> :
<ul>
<li><code>foreign</code> pour importer des fichiers externes.</li>
</ul></li>
</ul>
</div>
<div id="sect061" class="section level2">
<h2><span class="header-section-number">6.1</span> Relation entre une variable quantitative et une variable qualitative à deux modalités</h2>
<div class="bloc_objectif">
<p><strong>Les moyennes de deux groupes de population sont-elles significativement différentes?</strong> Nous souhaitons ici comparer deux groupes de population en fonction d’une variable continue.
Par exemple, pour deux échantillons respectivement d’hommes et de femmes travaillant dans le même secteur d’activité, nous pourrions souhaiter vérifier si les moyennes des salaires des hommes et des femmes sont différentes et ainsi vérifier la présence ou l’absence d’une iniquité systématique. En études urbaines, dans le cadre d’une étude sur un espace public, nous pourrions vouloir vérifier si la différence des moyennes du sentiment de sécurité des femmes et des hommes est significative (c’est-à-dire différente de 0).</p>
<p><strong>Pour un même groupe, la moyenne de la différence d’un phénomène donné mesuré à deux moments est-elle ou non égale à zéro?</strong> Autrement dit, nous cherchons à comparer un même groupe d’individus avant et après une expérimentation ou dans deux contextes différents. Prenons un exemple d’application en études urbaines. Dans le cadre d’une étude sur la perception des risques associés à la pratique du vélo en ville, 50 personnes utilisant habituellement l’automobile pour se rendre au travail sont recrutées. L’expérimentation pourrait consister à leur donner une formation sur la pratique du vélo en ville et à les accompagner quelques jours durant leurs déplacements domicile-travail. Nous évaluerons la différence de leurs perceptions des risques associés à la pratique du vélo sur une échelle de 0 à 100 avant et après l’expérimentation. Nous pourrions supposer que la moyenne des différences est significativement négative, ce qui indiquerait que la perception du risque a diminué après l’expérimentation; autrement dit, la perception du risque serait plus faible en fin de période.</p>
</div>
<div id="sect0611" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Test <em>t</em> et ses différentes variantes</h3>
<p>Le <strong>t de Student</strong>, appelé aussi <strong>test <em>t</em></strong> (<em>t-test</em> en anglais), est un test paramétrique permettant de comparer les moyennes de deux groupes (échantillons), qui peuvent être indépendantes ou non :</p>
<ul>
<li><p><strong>Échantillons indépendants (dits non appariés)</strong> : les observations de deux groupes qui n’ont aucun lien entre eux. Par exemple, nous souhaitons vérifier si les moyennes du sentiment de sécurité des hommes et des femmes, ou encore si, les moyennes des loyers entre deux villes sont statistiquement différentes. Ainsi, les tailles des deux échantillons peuvent être différentes (<span class="math inline">\(n_a \neq n_b\)</span>).</p></li>
<li><p><strong>Échantillons dépendants (dits appariés)</strong> : les individus des deux groupes sont les mêmes et sont donc associés par paires. Autrement dit, nous avons deux séries de valeurs de taille identique <span class="math inline">\(n_a = n_b\)</span> et <span class="math inline">\(n_{ai}\)</span> est le même individu que <span class="math inline">\(n_{bi}\)</span>. Ce type d’analyse est souvent utilisée en études cliniques : pour <span class="math inline">\(n\)</span> individus, nous disposons d’une mesure quantitative de leur état de santé pour deux séries (l’une avant le traitement, l’autre une fois le traitement terminé). Cela permet de comparer les mêmes individus avant et après un traitement; nous parlons alors d’étude, d’expérience ou d’analyse pré-post. Concrètement, nous cherchons à savoir si la moyenne des différences des observations avant et après est significativement différente de 0. Si c’est le cas, nous pouvons conclure que l’expérimentation a eu un impact sur le phénomène mesuré (variable continue). Ce type d’analyse pré-post peut aussi être utilisé pour évaluer l’impact du réaménagement d’un espace public (rue commerciale, place publique, parc, etc.). Par exemple, nous pourrions questionner le même échantillon de commerçant(e)s ou personnes l’utilisant avant et après le réaménagement d’une artère commerciale.</p></li>
</ul>
<p><strong>Condition d’application</strong>. Pour utiliser les tests de Student et de Welch, la variable continue doit être normalement distribuée. Si elle est fortement anormale, nous utiliserons le test non paramétrique de Wilcoxon (section @ref(sect0612)). Il existe trois principaux tests pour comparer les moyennes de deux groupes :</p>
<ul>
<li>Test de Student (test <em>t</em>) avec échantillons indépendants et variances similaires (méthode <em>pooled</em>). Les variances de deux groupes sont semblables quand leur ratio varie de 0,5 à 2, soit <span class="math inline">\(\mbox{0,5}&lt; (S^2_{X_A}/S^2_{X_B})&lt;\mbox{2}\)</span>.</li>
<li>Test de Welch (appelé aussi Satterthwaite) avec échantillons indépendants quand les variances des deux groupes sont dissemblables.</li>
<li>Test de Student (test <em>t</em>) avec échantillons dépendants.</li>
</ul>
<p>Il s’agit de vérifier si les moyennes des deux groupes sont statistiquement différentes avec les étapes suivantes :</p>
<ul>
<li>Nous posons l’hypothèse nulle (<em>H<sub>0</sub></em>), soit que les moyennes des deux groupes <em>A</em> et <em>B</em> ne sont pas différentes (<span class="math inline">\(\bar{X}_{A}=\bar{X}_{B}\)</span>) ou, autrement dit, la différence des deux moyennes est nulle (<span class="math inline">\(\bar{X}_{A}-\bar{X}_{B}=0\)</span>). L’hypothèse alternative (<em>H<sub>1</sub></em>) est donc <span class="math inline">\(\bar{X}_{A}\ne\bar{X}_{B}\)</span>.</li>
<li>Nous calculons la valeur de <em>t</em> et le nombre de degrés de liberté. La valeur de <em>t</em> est négative quand la moyenne du groupe A est inférieure au groupe B et inversement.</li>
<li>Nous comparons la valeur absolue de <em>t</em> (<span class="math inline">\(\mbox{|t|}\)</span>) avec celle issue de la table des valeurs critiques de T (voir section @ref(annexe2)) avec le bon nombre de degrés de liberté et en choisissant un degré de signification (habituellement, <em>p</em> = 0,05). Si <span class="math inline">\(\mbox{|t|}\)</span> est supérieure à la valeur <em>t</em> critique, alors les moyennes sont statistiquement différentes au degré de signification retenu.</li>
<li>Si les moyennes sont statistiquement différentes, nous pouvons calculer la taille de l’effet.</li>
</ul>
<p><strong>Cas 1. Test de Student pour des échantillons indépendants avec des variances similaires (méthode <em>pooled</em>).</strong> La valeur de <em>t</em> est le ratio entre la différence des moyennes des deux groupes (numérateur) et l’erreur type groupée des deux échantillons (dénominateur) :</p>

<p><span class="math display">\[\begin{equation}
t = \frac{\bar{X}_{A}-\bar{X}_{B}}{\sqrt{\frac{S^2_p}{n_A}+\frac{S^2_p}{n_B}}}\mbox{ avec } S^2_p = \frac{(n_A-1)S^2_{X_A}+(n_B-1)S^2_{X_B}}{n_A+n_B-2}
(\#eq:cas1pooled)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(n_A\)</span>,<span class="math inline">\(n_B\)</span>, <span class="math inline">\(S^2_{X_A}\)</span> et <span class="math inline">\(S^2_{X_B}\)</span> étant respectivement les nombres d’observations et les variances pour les groupes <em>A</em> et <em>B</em>, <span class="math inline">\(S^2_p\)</span> étant la variance groupée des deux échantillons et <span class="math inline">\(n_A+n_B-2\)</span> étant le nombre de degrés de liberté.</p>
<p><strong>Cas 2. Test de Welch pour des échantillons indépendants (avec variances dissemblables).</strong> Le test de Welch est très similaire au test de Student; seul le calcul de la valeur de <em>t</em> est différent, pour tenir compte des variances respectives des groupes :</p>

<p><span class="math display">\[\begin{equation}
t = \frac{\bar{X}_{A}-\bar{X}_{B}}{\sqrt{\frac{S^2_{X_A}}{n_A}+\frac{S^2_{X_B}}{n_B}}} \mbox{ et } dl = \frac{ \left( \frac{S^2_{X_A}}{n_A}+\frac{S^2_{X_B}}{n_B} \right)^2} {\frac{S^4_{X_A}}{n^2_A(n_A-1)}+\frac{S^4_{X_B}}{n^2_B(n_B-1)}}
(\#eq:cas2welch)
\end{equation}\]</span>
</p>
<p>Dans la syntaxe ci-dessous, nous avons écrit une fonction dénommée <code>test_independants</code> permettant de calculer les deux tests pour des échantillons indépendants. Dans cette fonction, vous pouvez repérer comment sont calculés les moyennes, les nombres d’observations et les variances pour les deux groupes, le nombre de degrés de liberté et les valeurs de <em>t</em> et de <em>p</em> pour les deux tests. Puis, nous avons créé aléatoirement deux jeux de données relativement à la vitesse de déplacement de cyclistes utilisant un vélo personnel ou un vélo en libre-service (généralement plus lourd) :</p>
<ul>
<li><p>Au cas 1, 60 cyclistes utilisant un vélo personnel roulant en moyenne à 18 km/h (écart-type de 1,5) et 50 autres utilisant un système de vélopartage avec une vitesse moyenne de 15 km/h (écart-type de 1,5).</p></li>
<li><p>Au cas 2, 60 cyclistes utilisant un vélo personnel roulant en moyenne à 16 km/h (écart-type de 3) et 50 autres utilisant un système de vélopartage avec une vitesse moyenne de 15 km/h (écart-type de 1,5). Ce faible écart des moyennes, combiné à une plus forte variance réduit la significativité de la différence entre les deux groupes.</p></li>
</ul>
<p>D’emblée, l’analyse visuelle des boîtes à moustaches (figure @ref(fig:figttest1)) signale qu’au cas 1, contrairement au cas 2, les groupes sont plus homogènes (boîtes plus compactes) et les moyennes semblent différentes (les boîtes sont centrées différemment sur l’axe des ordonnées). Cela est confirmé par les résultats des tests.</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="#cb549-1"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb549-2"><a href="#cb549-2"></a><span class="kw">library</span>(<span class="st">&quot;ggpubr&quot;</span>)</span>
<span id="cb549-3"><a href="#cb549-3"></a><span class="co"># fonction ------------------</span></span>
<span id="cb549-4"><a href="#cb549-4"></a>tstudent_independants &lt;-<span class="st"> </span><span class="cf">function</span>(A, B){</span>
<span id="cb549-5"><a href="#cb549-5"></a>    x_a &lt;-<span class="st"> </span><span class="kw">mean</span>(A)           <span class="co"># Moyenne du groupe A</span></span>
<span id="cb549-6"><a href="#cb549-6"></a>    x_b &lt;-<span class="st"> </span><span class="kw">mean</span>(B)           <span class="co"># Moyenne du groupe B</span></span>
<span id="cb549-7"><a href="#cb549-7"></a>    var_a &lt;-<span class="st"> </span><span class="kw">var</span>(A)          <span class="co"># Variance du groupe A</span></span>
<span id="cb549-8"><a href="#cb549-8"></a>    var_b &lt;-<span class="st"> </span><span class="kw">var</span>(B)          <span class="co"># Variance du groupe B</span></span>
<span id="cb549-9"><a href="#cb549-9"></a>    sd_a &lt;-<span class="st"> </span><span class="kw">sqrt</span>(var_a)      <span class="co"># Écart-type du groupe A</span></span>
<span id="cb549-10"><a href="#cb549-10"></a>    sd_b &lt;-<span class="st"> </span><span class="kw">sqrt</span>(var_b)      <span class="co"># Écart-type du groupe B</span></span>
<span id="cb549-11"><a href="#cb549-11"></a>    ratio_v &lt;-<span class="st"> </span>var_a <span class="op">/</span><span class="st"> </span>var_b <span class="co"># ratio des variances</span></span>
<span id="cb549-12"><a href="#cb549-12"></a>    n_a &lt;-<span class="st"> </span><span class="kw">length</span>(A)         <span class="co"># nombre d&#39;observation du groupe A</span></span>
<span id="cb549-13"><a href="#cb549-13"></a>    n_b &lt;-<span class="st"> </span><span class="kw">length</span>(B)         <span class="co"># nombre d&#39;observation du groupe B</span></span>
<span id="cb549-14"><a href="#cb549-14"></a>    </span>
<span id="cb549-15"><a href="#cb549-15"></a>    <span class="co"># T-test (variances égales)</span></span>
<span id="cb549-16"><a href="#cb549-16"></a>    dl_test &lt;-<span class="st"> </span>n_a<span class="op">+</span>n_b<span class="dv">-2</span>       <span class="co"># degrés de liberté</span></span>
<span id="cb549-17"><a href="#cb549-17"></a>    PooledVar &lt;-<span class="st"> </span>(((n_a<span class="dv">-1</span>)<span class="op">*</span>var_a)<span class="op">+</span>((n_b<span class="dv">-1</span>)<span class="op">*</span>var_b))<span class="op">/</span>dl_test</span>
<span id="cb549-18"><a href="#cb549-18"></a>    t_test &lt;-<span class="st"> </span>(x_a<span class="op">-</span>x_b) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(((PooledVar<span class="op">/</span>n_a)<span class="op">+</span>(PooledVar<span class="op">/</span>n_b)))</span>
<span id="cb549-19"><a href="#cb549-19"></a>    p_test &lt;-<span class="st">  </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>(<span class="kw">pt</span>(<span class="kw">abs</span>(t_test), dl_test)))     </span>
<span id="cb549-20"><a href="#cb549-20"></a>    <span class="co"># Test Welch-Sattherwaite (variances inégales)</span></span>
<span id="cb549-21"><a href="#cb549-21"></a>    t_welch &lt;-<span class="st"> </span>(x_a<span class="op">-</span>x_b) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>( (var_a<span class="op">/</span>n_a) <span class="op">+</span><span class="st"> </span>(var_b<span class="op">/</span>n_b))</span>
<span id="cb549-22"><a href="#cb549-22"></a>    dl_num =<span class="st"> </span>((var_a<span class="op">/</span>n_a) <span class="op">+</span><span class="st"> </span>(var_b<span class="op">/</span>n_b))<span class="op">^</span><span class="dv">2</span></span>
<span id="cb549-23"><a href="#cb549-23"></a>    dl_dem =<span class="st"> </span>((var_a<span class="op">/</span>n_a)<span class="op">^</span><span class="dv">2</span><span class="op">/</span>(n_a<span class="dv">-1</span>))  <span class="op">+</span><span class="st"> </span>((var_b<span class="op">/</span>n_b)<span class="op">^</span><span class="dv">2</span><span class="op">/</span>(n_b<span class="dv">-1</span>))</span>
<span id="cb549-24"><a href="#cb549-24"></a>    dl_welch =<span class="st"> </span>dl_num <span class="op">/</span><span class="st"> </span>dl_dem <span class="co"># degrés de liberté</span></span>
<span id="cb549-25"><a href="#cb549-25"></a>    p_welch &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>(<span class="kw">pt</span>(<span class="kw">abs</span>(t_welch), dl_welch)))     </span>
<span id="cb549-26"><a href="#cb549-26"></a>    </span>
<span id="cb549-27"><a href="#cb549-27"></a>    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> groupe A (n = &quot;</span>, n_a,<span class="st">&quot;), moy = &quot;</span>, <span class="kw">round</span>(x_a,<span class="dv">1</span>),<span class="st">&quot;, </span></span>
<span id="cb549-28"><a href="#cb549-28"></a><span class="st">           variance = &quot;</span>, <span class="kw">round</span>(var_a,<span class="dv">1</span>),<span class="st">&quot;, écart-type = &quot;</span>, <span class="kw">round</span>(sd_a,<span class="dv">1</span>),</span>
<span id="cb549-29"><a href="#cb549-29"></a>        <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> groupe B (n = &quot;</span>, n_b,<span class="st">&quot;), moy = &quot;</span>, <span class="kw">round</span>(x_b,<span class="dv">1</span>),<span class="st">&quot;, </span></span>
<span id="cb549-30"><a href="#cb549-30"></a><span class="st">          variance = &quot;</span>, <span class="kw">round</span>(var_b,<span class="dv">1</span>),<span class="st">&quot;, écart-type = &quot;</span>, <span class="kw">round</span>(sd_b,<span class="dv">1</span>),</span>
<span id="cb549-31"><a href="#cb549-31"></a>        <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> ratio variance = &quot;</span>,<span class="kw">round</span>(ratio_v,<span class="dv">2</span>),</span>
<span id="cb549-32"><a href="#cb549-32"></a>        <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> t-test (variances égales): t(dl = &quot;</span>, dl_test, <span class="st">&quot;) = &quot;</span>,<span class="kw">round</span>(t_test,<span class="dv">4</span>),</span>
<span id="cb549-33"><a href="#cb549-33"></a>         <span class="st">&quot;, p = &quot;</span>, <span class="kw">round</span>(p_test,<span class="dv">6</span>),</span>
<span id="cb549-34"><a href="#cb549-34"></a>         <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> t-Welch (variances inégales): t(dl = &quot;</span>, <span class="kw">round</span>(dl_welch,<span class="dv">3</span>), <span class="st">&quot;) = &quot;</span>,</span>
<span id="cb549-35"><a href="#cb549-35"></a>        <span class="kw">round</span>(t_welch,<span class="dv">4</span>), <span class="st">&quot;, p = &quot;</span>, <span class="kw">round</span>(p_welch,<span class="dv">6</span>),  <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)    </span>
<span id="cb549-36"><a href="#cb549-36"></a>  </span>
<span id="cb549-37"><a href="#cb549-37"></a>    <span class="cf">if</span> (ratio_v <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">&amp;&amp;</span><span class="st"> </span>ratio_v <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>)  {</span>
<span id="cb549-38"><a href="#cb549-38"></a>      <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Variances semblables. Utilisez le test de Student!&quot;</span>)</span>
<span id="cb549-39"><a href="#cb549-39"></a>      p &lt;-<span class="st"> </span>p_test</span>
<span id="cb549-40"><a href="#cb549-40"></a>    } <span class="cf">else</span> {</span>
<span id="cb549-41"><a href="#cb549-41"></a>      <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Variances dissemblables. Utilisez le test de Welch-Satterwaithe!&quot;</span>)</span>
<span id="cb549-42"><a href="#cb549-42"></a>      p &lt;-<span class="st"> </span>p_welch</span>
<span id="cb549-43"><a href="#cb549-43"></a>    }</span>
<span id="cb549-44"><a href="#cb549-44"></a>    </span>
<span id="cb549-45"><a href="#cb549-45"></a>    <span class="cf">if</span> (p <span class="op">&lt;=</span>.<span class="dv">05</span>){</span>
<span id="cb549-46"><a href="#cb549-46"></a>      <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Les moyennes des deux groupes sont significativement différentes.&quot;</span>)</span>
<span id="cb549-47"><a href="#cb549-47"></a>    } <span class="cf">else</span> {</span>
<span id="cb549-48"><a href="#cb549-48"></a>      <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Les moyennes des deux groupes ne sont pas significativement différentes.&quot;</span>)</span>
<span id="cb549-49"><a href="#cb549-49"></a>    }</span>
<span id="cb549-50"><a href="#cb549-50"></a>}</span>
<span id="cb549-51"><a href="#cb549-51"></a><span class="co"># CAS 1 : données fictives ------------------</span></span>
<span id="cb549-52"><a href="#cb549-52"></a><span class="co"># Création du groupe A : 60 observations avec une vitesse moyenne de 18 et un écart-type de 1,5</span></span>
<span id="cb549-53"><a href="#cb549-53"></a>Velo1A &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">60</span>,<span class="dv">18</span>,<span class="fl">1.5</span>)</span>
<span id="cb549-54"><a href="#cb549-54"></a><span class="co"># Création du groupe B : 50 observations avec une vitesse moyenne de 15 et un écart-type de 1,5</span></span>
<span id="cb549-55"><a href="#cb549-55"></a>Velo1B &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">50</span>,<span class="dv">15</span>,<span class="fl">1.5</span>)</span>
<span id="cb549-56"><a href="#cb549-56"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb549-57"><a href="#cb549-57"></a>  <span class="dt">vitesse =</span> <span class="kw">c</span>(Velo1A,Velo1B), </span>
<span id="cb549-58"><a href="#cb549-58"></a>  <span class="dt">type =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;Vélo personnel&quot;</span>,<span class="kw">length</span>(Velo1A)), <span class="kw">rep</span>(<span class="st">&quot;Vélopartage&quot;</span>,<span class="kw">length</span>(Velo1B)))</span>
<span id="cb549-59"><a href="#cb549-59"></a>)</span>
<span id="cb549-60"><a href="#cb549-60"></a>boxplot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>df1, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>type,<span class="dt">y=</span>vitesse, <span class="dt">colour=</span>type)) <span class="op">+</span></span>
<span id="cb549-61"><a href="#cb549-61"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">width=</span><span class="fl">0.2</span>)<span class="op">+</span></span>
<span id="cb549-62"><a href="#cb549-62"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Données fictives (cas 1)&quot;</span>)<span class="op">+</span></span>
<span id="cb549-63"><a href="#cb549-63"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Type de vélo&quot;</span>)<span class="op">+</span></span>
<span id="cb549-64"><a href="#cb549-64"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Vitesse de déplacement (km/h)&quot;</span>)<span class="op">+</span></span>
<span id="cb549-65"><a href="#cb549-65"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb549-66"><a href="#cb549-66"></a><span class="co"># CAS 2 : données fictives ------------------</span></span>
<span id="cb549-67"><a href="#cb549-67"></a><span class="co"># Création du groupe A : 60 observations avec une vitesse moyenne de 18 et un écart-type de 3</span></span>
<span id="cb549-68"><a href="#cb549-68"></a>Velo2A &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">60</span>,<span class="dv">16</span>,<span class="dv">3</span>)</span>
<span id="cb549-69"><a href="#cb549-69"></a><span class="co"># Création du groupe B : 50 observations avec une vitesse moyenne de 15 et un écart-type de 1,5</span></span>
<span id="cb549-70"><a href="#cb549-70"></a>Velo2B &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">50</span>,<span class="dv">15</span>,<span class="fl">1.5</span>)</span>
<span id="cb549-71"><a href="#cb549-71"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb549-72"><a href="#cb549-72"></a>  <span class="dt">vitesse =</span> <span class="kw">c</span>(Velo2A,Velo2B), </span>
<span id="cb549-73"><a href="#cb549-73"></a>  <span class="dt">type =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;Vélo personnel&quot;</span>,<span class="kw">length</span>(Velo2A)), <span class="kw">rep</span>(<span class="st">&quot;Vélopartage&quot;</span>,<span class="kw">length</span>(Velo2B)))</span>
<span id="cb549-74"><a href="#cb549-74"></a>)</span>
<span id="cb549-75"><a href="#cb549-75"></a>boxplot2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>df2, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>type,<span class="dt">y=</span>vitesse, <span class="dt">colour=</span>type)) <span class="op">+</span></span>
<span id="cb549-76"><a href="#cb549-76"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">width=</span><span class="fl">0.2</span>)<span class="op">+</span></span>
<span id="cb549-77"><a href="#cb549-77"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Données fictives (cas 2)&quot;</span>)<span class="op">+</span></span>
<span id="cb549-78"><a href="#cb549-78"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Type de vélo&quot;</span>)<span class="op">+</span></span>
<span id="cb549-79"><a href="#cb549-79"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Vitesse de déplacement (km/h)&quot;</span>)<span class="op">+</span></span>
<span id="cb549-80"><a href="#cb549-80"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb549-81"><a href="#cb549-81"></a><span class="kw">ggarrange</span>(boxplot1, boxplot2, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figttest1-1.png" alt="Boîtes à moustaches sur des échantillons fictifs non appariés" width="75%" />
<p class="caption">
(#fig:figttest1)Boîtes à moustaches sur des échantillons fictifs non appariés
</p>
</div>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="#cb550-1"></a><span class="co"># Appel de la fonction pour le cas 1</span></span>
<span id="cb550-2"><a href="#cb550-2"></a><span class="kw">tstudent_independants</span>(Velo1A, Velo1B)</span></code></pre></div>
<pre><code>## 
##  groupe A (n = 60), moy = 17.8, 
##            variance = 2.4, écart-type = 1.5
##  groupe B (n = 50), moy = 15.2, 
##           variance = 1.9, écart-type = 1.4
##  ratio variance = 1.21
##  t-test (variances égales): t(dl = 108) = 9.1562, p = 0
##  t-Welch (variances inégales): t(dl = 107.182) = 9.2376, p = 0
##  Variances semblables. Utilisez le test de Student!
##  Les moyennes des deux groupes sont significativement différentes.</code></pre>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="#cb552-1"></a><span class="co"># Appel de la fonction pour le cas 2</span></span>
<span id="cb552-2"><a href="#cb552-2"></a><span class="kw">tstudent_independants</span>(Velo2A, Velo2B)</span></code></pre></div>
<pre><code>## 
##  groupe A (n = 60), moy = 15.5, 
##            variance = 7.8, écart-type = 2.8
##  groupe B (n = 50), moy = 15.1, 
##           variance = 2.2, écart-type = 1.5
##  ratio variance = 3.59
##  t-test (variances égales): t(dl = 108) = 0.7554, p = 0.451676
##  t-Welch (variances inégales): t(dl = 92.593) = 0.7955, p = 0.428355
##  Variances dissemblables. Utilisez le test de Welch-Satterwaithe!
##  Les moyennes des deux groupes ne sont pas significativement différentes.</code></pre>
<div id="sect06111" class="section level4">
<h4><span class="header-section-number">6.1.1.1</span> Principe de base et formulation pour des échantillons dépendants (appariés)</h4>
<p>Nous disposons de plusieurs personnes pour lesquelles nous avons mesuré un phénomène (variable continue) à deux temps différents : généralement avant et après une expérimentation (analyse pré-post). Il s’agit de vérifier si la moyenne des différences des observations avant et après la période est différente de 0. Pour ce faire, nous réalisons les étapes suivantes :</p>
<ul>
<li>Nous posons l’hypothèse nulle (<em>H<sub>0</sub></em>), soit que la moyenne des différences entre les deux séries est égale à 0 (<span class="math inline">\(\bar{D} = 0\)</span> avec <span class="math inline">\(d = {x}_{t_1}- {x}_{t_2}\)</span>). L’hypothèse alternative (<em>H<sub>1</sub></em>) est donc <span class="math inline">\(\bar{D} \ne 0\)</span>. Notez que nous pouvons tester une autre valeur que 0.</li>
<li>Nous calculons la valeur de <em>t</em> et le nombre de degrés de liberté. La valeur de <em>t</em> est négative quand la moyenne des différences entre <span class="math inline">\({X}_{t_1}\)</span> et <span class="math inline">\({X}_{t_2}\)</span> est négative et inversement.</li>
<li>Nous comparons la valeur absolue de <em>t</em> (<span class="math inline">\(\mbox{|t|}\)</span>) avec celle issue de la table des valeurs critiques de T avec le nombre de degrés de liberté et en choisissant un degré de signification (habituellement, <em>p</em> = 0,05). Si <span class="math inline">\(\mbox{|t|}\)</span> est supérieure à la valeur <em>t</em> critique, alors les moyennes sont statistiquement différentes au degré de signification retenu.</li>
</ul>
<p>Pour le test de Student avec des échantillons appariés, la valeur de <em>t</em> se calcule comme suit :</p>

<p><span class="math display">\[\begin{equation}
t = \frac{\bar{D}-\mu_0}{\sigma_D / \sqrt{n}}
(\#eq:ttestapparie)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(\bar{D}\)</span> étant la moyenne des différences entre les observations appariées de la série A et de la série B, <span class="math inline">\(\sigma_D\)</span> l’écart des différences, <em>n</em> le nombre d’observations, et finalement <span class="math inline">\(\mu_0\)</span> la valeur de l’hypothèse nulle que nous voulons tester (habituellement 0). Bien entendu, il est possible de fixer une autre valeur pour <span class="math inline">\(\mu_0\)</span> : par exemple, avec <span class="math inline">\(\mu_0 = 10\)</span>, nous chercherions ainsi à vérifier si la moyenne des différences est significativement différente de 10. Le nombre de degrés de liberté est égal à <span class="math inline">\(n-1\)</span>.</p>
<p>Dans la syntaxe ci-dessous, nous avons écrit une fonction dénommée <code>tstudent_dependants</code> permettant de réaliser le test de Student pour des échantillons appariés. Dans cette fonction, vous pouvez repérer comment sont calculés la différence entre les observations pairées, la moyenne et l’écart-type de cette différence, puis le nombre de degrés de liberté, les valeurs de <em>t</em> et de <em>p</em> pour les deux tests.</p>
<p>Pour illustrer l’utilisation de la fonction, nous avons créé aléatoirement deux jeux de données. Imaginons que ces données décrivent 50 personnes utilisant habituellement l’automobile pour se rendre au travail. Pour ces personnes, nous avons généré des valeurs du risque perçu de l’utilisation du vélo (de 0 à 100), et ce, avant et après une période de 20 jours ouvrables durant lesquels elles devaient impérativement se rendre au travail à vélo.</p>
<ul>
<li>Au cas 1, les valeurs de risque ont une moyenne de 70 avant l’expérimentation et de 50 après l’expérimentation, avec des écarts-types de 5.</li>
<li>Au cas 2, les valeurs de risque ont une moyenne de 70 avant et de 66 après, avec des écarts-types de 5.</li>
</ul>
<p>D’emblée, l’analyse visuelle des boîtes à moustaches (figure @ref(fig:figttest2)) pairées montre que la perception du risque semble avoir nettement diminué après l’expérimentation pour le cas 1, mais pas pour le cas 2. Cela est confirmé par les résultats des tests.</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb554-2"><a href="#cb554-2"></a><span class="kw">library</span>(<span class="st">&quot;ggpubr&quot;</span>)</span>
<span id="cb554-3"><a href="#cb554-3"></a>tstudent_dependants &lt;-<span class="st"> </span><span class="cf">function</span>(A, B, <span class="dt">mu=</span><span class="dv">0</span>){</span>
<span id="cb554-4"><a href="#cb554-4"></a>  d &lt;-<span class="st"> </span>A<span class="op">-</span>B           <span class="co"># différences entre les observations pairées</span></span>
<span id="cb554-5"><a href="#cb554-5"></a>  moy &lt;-<span class="st"> </span><span class="kw">mean</span>(d)     <span class="co"># Moyenne des différences</span></span>
<span id="cb554-6"><a href="#cb554-6"></a>  e_t &lt;-<span class="st"> </span><span class="kw">sd</span>(d)       <span class="co"># Écart-type des différences</span></span>
<span id="cb554-7"><a href="#cb554-7"></a>  n   &lt;-<span class="st"> </span><span class="kw">length</span>(A)   <span class="co"># nombre d&#39;observations</span></span>
<span id="cb554-8"><a href="#cb554-8"></a>  dl  &lt;-<span class="st"> </span>n<span class="dv">-1</span>         <span class="co"># nombre de degrés de liberté (variances égales)</span></span>
<span id="cb554-9"><a href="#cb554-9"></a>  </span>
<span id="cb554-10"><a href="#cb554-10"></a>  t &lt;-<span class="st"> </span>(moy<span class="op">-</span><span class="st"> </span>mu) <span class="op">/</span><span class="st"> </span>(e_t<span class="op">/</span><span class="kw">sqrt</span>(n)) <span class="co"># valeur de t</span></span>
<span id="cb554-11"><a href="#cb554-11"></a>  p &lt;-<span class="st">  </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>(<span class="kw">pt</span>(<span class="kw">abs</span>(t), dl)))</span>
<span id="cb554-12"><a href="#cb554-12"></a>  </span>
<span id="cb554-13"><a href="#cb554-13"></a>  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> groupe A : moy = &quot;</span>, <span class="kw">round</span>(<span class="kw">mean</span>(A),<span class="dv">1</span>),<span class="st">&quot;, var = &quot;</span>, </span>
<span id="cb554-14"><a href="#cb554-14"></a>         <span class="kw">round</span>(<span class="kw">var</span>(A),<span class="dv">1</span>),<span class="st">&quot;, sd = &quot;</span>, <span class="kw">round</span>(<span class="kw">sqrt</span>(<span class="kw">var</span>(A)),<span class="dv">1</span>),</span>
<span id="cb554-15"><a href="#cb554-15"></a>      <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> groupe B : moy = &quot;</span>, <span class="kw">round</span>(<span class="kw">mean</span>(B),<span class="dv">1</span>),<span class="st">&quot;, var = &quot;</span>, </span>
<span id="cb554-16"><a href="#cb554-16"></a>         <span class="kw">round</span>(<span class="kw">var</span>(B),<span class="dv">1</span>),<span class="st">&quot;, sd = &quot;</span>, <span class="kw">round</span>(<span class="kw">sqrt</span>(<span class="kw">var</span>(B)),<span class="dv">1</span>),</span>
<span id="cb554-17"><a href="#cb554-17"></a>      <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Moyenne des différences = &quot;</span>, <span class="kw">round</span>(<span class="kw">mean</span>(moy),<span class="dv">1</span>),</span>
<span id="cb554-18"><a href="#cb554-18"></a>      <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Ecart-type des différences = &quot;</span>, <span class="kw">round</span>(<span class="kw">mean</span>(e_t),<span class="dv">1</span>),</span>
<span id="cb554-19"><a href="#cb554-19"></a>      <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> t(dl = &quot;</span>, dl, <span class="st">&quot;) = &quot;</span>,<span class="kw">round</span>(t,<span class="dv">2</span>),</span>
<span id="cb554-20"><a href="#cb554-20"></a>      <span class="st">&quot;, p = &quot;</span>, <span class="kw">round</span>(p,<span class="dv">3</span>),  <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb554-21"><a href="#cb554-21"></a>  </span>
<span id="cb554-22"><a href="#cb554-22"></a>  <span class="cf">if</span> (p <span class="op">&lt;=</span>.<span class="dv">05</span>){</span>
<span id="cb554-23"><a href="#cb554-23"></a>    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> La moyenne des différences entre les échantillons est significative&quot;</span>)</span>
<span id="cb554-24"><a href="#cb554-24"></a>  }</span>
<span id="cb554-25"><a href="#cb554-25"></a>  <span class="cf">else</span>{</span>
<span id="cb554-26"><a href="#cb554-26"></a>    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> La moyenne des différences entre les échantillons n&#39;est pas significative&quot;</span>)</span>
<span id="cb554-27"><a href="#cb554-27"></a>  }</span>
<span id="cb554-28"><a href="#cb554-28"></a>}</span>
<span id="cb554-29"><a href="#cb554-29"></a><span class="co"># CAS 1 : données fictives ------------------</span></span>
<span id="cb554-30"><a href="#cb554-30"></a>Avant1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">50</span>,<span class="dv">70</span>,<span class="dv">5</span>)</span>
<span id="cb554-31"><a href="#cb554-31"></a>Apres1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">50</span>,<span class="dv">50</span>,<span class="dv">5</span>)</span>
<span id="cb554-32"><a href="#cb554-32"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Avant=</span>Avant1, <span class="dt">Apres=</span>Apres1)</span>
<span id="cb554-33"><a href="#cb554-33"></a>boxplot1 &lt;-<span class="st"> </span><span class="kw">ggpaired</span>(df1, <span class="dt">cond1 =</span> <span class="st">&quot;Avant&quot;</span>, <span class="dt">cond2 =</span> <span class="st">&quot;Apres&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;condition&quot;</span>, </span>
<span id="cb554-34"><a href="#cb554-34"></a>                     <span class="dt">palette =</span> <span class="st">&quot;jco&quot;</span>, </span>
<span id="cb554-35"><a href="#cb554-35"></a>                     <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Sentiment de sécurité&quot;</span>, </span>
<span id="cb554-36"><a href="#cb554-36"></a>                     <span class="dt">title =</span> <span class="st">&quot;Données fictives (cas 1)&quot;</span>)</span>
<span id="cb554-37"><a href="#cb554-37"></a><span class="co"># CAS 2 : données fictives ------------------</span></span>
<span id="cb554-38"><a href="#cb554-38"></a>Avant2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">50</span>,<span class="dv">70</span>,<span class="dv">5</span>)</span>
<span id="cb554-39"><a href="#cb554-39"></a>Apres2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">50</span>,<span class="dv">66</span>,<span class="dv">5</span>)</span>
<span id="cb554-40"><a href="#cb554-40"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Avant=</span>Avant2, <span class="dt">Apres=</span>Apres2)</span>
<span id="cb554-41"><a href="#cb554-41"></a>boxplot2 &lt;-<span class="st"> </span><span class="kw">ggpaired</span>(df2, <span class="dt">cond1 =</span> <span class="st">&quot;Avant&quot;</span>, <span class="dt">cond2 =</span> <span class="st">&quot;Apres&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;condition&quot;</span>,</span>
<span id="cb554-42"><a href="#cb554-42"></a>                     <span class="dt">palette =</span> <span class="st">&quot;jco&quot;</span>, </span>
<span id="cb554-43"><a href="#cb554-43"></a>                     <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Sentiment de sécurité&quot;</span>, </span>
<span id="cb554-44"><a href="#cb554-44"></a>                     <span class="dt">title =</span> <span class="st">&quot;Données fictives (cas 2)&quot;</span>)</span>
<span id="cb554-45"><a href="#cb554-45"></a><span class="kw">ggarrange</span>(boxplot1, boxplot2, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figttest2-1.png" alt="Boites à moustaches sur des échantillons fictifs appariés" width="75%" />
<p class="caption">
(#fig:figttest2)Boites à moustaches sur des échantillons fictifs appariés
</p>
</div>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="#cb555-1"></a><span class="co"># Test t : appel de la fonction tstudent_dependants</span></span>
<span id="cb555-2"><a href="#cb555-2"></a><span class="kw">tstudent_dependants</span>(Avant1, Apres1, <span class="dt">mu=</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## 
##  groupe A : moy = 70.6, var = 22.6, sd = 4.8
##  groupe B : moy = 49.9, var = 32.2, sd = 5.7
##  Moyenne des différences = 20.7
##  Ecart-type des différences = 7.7
##  t(dl = 49) = 19.08, p = 0
##  La moyenne des différences entre les échantillons est significative</code></pre>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="#cb557-1"></a><span class="kw">tstudent_dependants</span>(Avant2, Apres2, <span class="dt">mu=</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## 
##  groupe A : moy = 70, var = 21.4, sd = 4.6
##  groupe B : moy = 65.5, var = 23, sd = 4.8
##  Moyenne des différences = 4.5
##  Ecart-type des différences = 6.9
##  t(dl = 49) = 4.6, p = 0
##  La moyenne des différences entre les échantillons est significative</code></pre>
</div>
<div id="sect06112" class="section level4">
<h4><span class="header-section-number">6.1.1.2</span> Mesure de la taille de l’effet</h4>
<p>La taille de l’effet permet d’évaluer la magnitude (force) de l’effet d’une variable (ici la variable qualitative à deux modalités) sur une autre (ici la variable continue). Dans le cas d’une comparaison de moyennes (avec des échantillons pairés ou non), pour mesurer la taille de l’effet, nous utilisons habituellement le <em>d</em> de Cohen ou encore le <em>g</em> de Hedges; le second étant un ajustement du premier. Notez que nous analysons la taille de l’effet uniquement si le test de Student ou de Welch s’est révélé significatif (p &lt; 0,05).</p>
<p><strong>Pourquoi utiliser le <em>d</em> de Cohen?</strong> Deux propriétés en font une mesure particulièrement intéressante. Premièrement, elle est facile à calculer puisque <em>d</em> est le ratio entre la différence de deux moyennes de groupes (A, B) et l’écart-type combiné des deux groupes. Deuxièmement, <em>d</em> représente ainsi une mesure standardisée de la taille de l’effet; elle permet ainsi l’évaluation de la taille de l’effet indépendamment de l’unité de mesure de la variable continue. Concrètement, cela signifie que, quelle que soit l’unité de mesure de la variable continue <em>X</em>, <em>d</em> est toujours exprimée en unité d’écart-type de <em>X</em>. Cette propriété facilite ainsi grandement les comparaisons entre des valeurs de <em>d</em> calculées sur différentes combinaisons de variables (au même titre que le coefficient de variation ou le coefficient de corrélation, par exemple). Pour des échantillons indépendants de tailles différentes, le <em>d</em> de Cohen s’écrit :</p>

<p><span class="math display">\[\begin{equation}
\frac{\bar{X}_{A}-\bar{X}_{B}}{\sqrt{\frac{(n_A-1)S^2_A+(n_B-1)S^2_B}{n_A+n_B-2}}}
(\#eq:dcohen)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(n_A\)</span>, <span class="math inline">\(n_B\)</span>, <span class="math inline">\(S^2_{X_A}\)</span> et <span class="math inline">\(S^2_{X_B}\)</span> étant respectivement les nombres d’observations et les variances pour les groupes <em>A</em> et <em>B</em>, <span class="math inline">\(S^2_p\)</span>.</p>
<p>Si les échantillons sont de tailles identiques (<span class="math inline">\(n_A=n_B\)</span>), alors <em>d</em> s’écrit :</p>

<p><span class="math display">\[\begin{equation}
d = \frac{\bar{X}_{A}-\bar{X}_{B}}{\sqrt{(S^2_A+\S^2_B)/2}} = \frac{\bar{X}_{A}-\bar{X}_{B}}{(\sigma_A+\sigma_B)/2}
(\#eq:dcohen2)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(\sigma_A\)</span> et <span class="math inline">\(\sigma_B\)</span> étant les écarts-types des deux groupes (rappel : l’écart-type est la racine carrée de la variance).</p>
<p>Le <em>g</em> de Hedge est simplement une correction de <em>d</em>, particulièrement importante quand les échantillons sont de taille réduite.</p>

<p><span class="math display">\[\begin{equation}
g = d- \left(1- \frac{3}{4(n_A+n_B)-9} \right)
(\#eq:ghedge)
\end{equation}\]</span>
</p>
<p>Moins utilisé en sciences sociales, mais surtout en études cliniques, le delta de Glass est simplement la différence des moyennes des deux groupes indépendants (numérateur) sur l’écart-type du deuxième groupe (démoninateur). Dans une étude clinique, nous avons habituellement un groupe qui subit un traitement (groupe de traitement) et un groupe qui reçoit un placebo (groupe de contrôle ou groupe témoin). L’effet de taille est ainsi évalué par rapport au groupe de contrôle :</p>

<p><span class="math display">\[\begin{equation}
\Delta = \frac{\bar{X}_{A}-\bar{X}_{B}}{\sigma_B}
(\#eq:dDelta)
\end{equation}\]</span>
</p>
<p>Finalement, pour des échantillons dépendants (pairés), le delta de Glass s’écrit : <span class="math inline">\(d = \bar{D}/{\sigma_D}\)</span> avec <span class="math inline">\(\bar{D}\)</span> et <span class="math inline">\(\sigma_D\)</span> étant la moyenne et l’écart-type des différences entre les observations.</p>
<p><strong>Comment interpréter le <em>d</em> de Cohen?</strong> Un effet est considéré comme faible avec <span class="math inline">\(\lvert d \rvert\)</span> à 0,2, modéré à 0,50 et fort à 0,80 <span class="citation">(Cohen <a href="#ref-cohen1992" role="doc-biblioref">1992</a>)</span>. Notez que ces seuils ne sont que des conventions pour vous guider à interpréter la mesure de Cohen. D’ailleurs, dans son livre intitulé <em>Statistical power analysis for the behavioral sciences</em>, il écrit : « all conventions are arbitrary. One can only demand of them that they not be unreasonable » <span class="citation">(Cohen <a href="#ref-cohen2013" role="doc-biblioref">2013</a>)</span>. Plus récemment, Sawilowsky <span class="citation">(<a href="#ref-sawilowsky2009" role="doc-biblioref">2009</a>)</span> a ajouté d’autres seuils à ceux proposés par Cohen (tableau @ref(tab:tableconvcohen)).</p>
<table>
<caption>
(#tab:tableconvcohen)Conventions pour l’interprétation du <em>d</em> de Cohen
</caption>
<thead>
<tr>
<th style="text-align:left;">
Sawilowsky
</th>
<th style="text-align:left;">
Cohen
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0,1 : Très faible
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
0,2 : Faible
</td>
<td style="text-align:left;">
0,2 : Faible
</td>
</tr>
<tr>
<td style="text-align:left;">
0,5 : Moyen
</td>
<td style="text-align:left;">
0,5 : Moyen
</td>
</tr>
<tr>
<td style="text-align:left;">
0,8 : Fort
</td>
<td style="text-align:left;">
0,8 : Fort
</td>
</tr>
<tr>
<td style="text-align:left;">
1,2 : Très fort
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
2,0 : Énorme
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect06113" class="section level4">
<h4><span class="header-section-number">6.1.1.3</span> Mise en œuvre dans R</h4>
<p>Nous avons écrit précédemment les fonctions <code>tstudent_independants</code> et <code>tstudent_dependants</code> uniquement pour décomposer les différentes étapes de calcul des tests de Student et de Welch. Heureusement, il existe des fonctions de base (<code>t.test</code> et <code>var.test</code>) qui permettent de réaliser l’un ou l’autre de ces deux tests avec une seule ligne de code.</p>
<p>La fonction <code>t.test</code> permet ainsi de calculer les tests de Student et de Welch :</p>
<ul>
<li><code>t.test(x ~ y, data=, mu = 0, paired = FALSE, var.equal = FALSE,  conf.level = 0.95)</code> ou <code>t.test(x =, y =, mu = 0, paired = FALSE, var.equal = FALSE,  conf.level = 0.95)</code>.</li>
<li>Le paramètre <code>paired</code> est utilisé pour spécifier si les échantillons sont dépendants (<code>paired=TRUE</code>) ou indépendants (<code>paired=FALSE</code>).</li>
<li>Le paramètre <code>var.equal</code> est utilisé pour spécifier si les variances sont égales pour le test de Student (<code>var.equal=TRUE</code>) ou dissemblables pour le test de Welch (<code>var.equal=FALSE</code>).</li>
<li><code>var.test(x, y)</code> ou <code>var.test(x ~ y, data=)</code> pour vérifier au préalable si les variances sont égales ou non et choisir ainsi un <em>t</em> de Student ou un <em>t</em> de Welch.</li>
</ul>
<p>Les fonctions <code>cohens_d</code> et <code>hedges_g</code> du <em>package</em> <code>effectsize</code> renvoient respectivement les mesures de <em>d</em> de Cohen et du <em>g</em> de Hedge :</p>
<ul>
<li><p><code>cohens_d(x ~ y, data = DataFrame, paired = FALSE, pooled_sd = TRUE)</code> ou <code>cohens_d(x, y, data = DataFrame, paired = FALSE, pooled_sd = TRUE)</code></p></li>
<li><p><code>hedges_g(x ~ y, data = DataFrame, paired = FALSE, pooled_sd = TRUE)</code> ou <code>hedges_g(x, y, data = DataFrame, paired = FALSE, pooled_sd = TRUE)</code></p></li>
<li><p><code>glass_delta(x ~ y, data = DataFrame, paired = FALSE, pooled_sd = TRUE)</code> ou <code>glass_delta(x, y, data = DataFrame, paired = FALSE, pooled_sd = TRUE)</code></p></li>
</ul>
<p>Notez que pour toutes ces fonctions, deux écritures sont possibles :</p>
<ul>
<li><code>x ~ y, data=</code> avec un <code>DataFrame</code> dans lequel <code>x</code> est une variable continue et <code>y</code> et un facteur binaire</li>
<li><code>x, y</code> qui sont tous deux des vecteurs numériques (variable continue).</li>
</ul>
<p><strong>Exemple de test pour des échantillons indépendants</strong></p>
<p>La figure @ref(fig:figlocataires) représente la cartographie du pourcentage de locataires par secteur de recensement (SR) pour la région métropolitaine de recensement de Montréal (RMR) en 2016, soit une variable continue. L’objectif est de vérifier si la moyenne de ce pourcentage des SR de l’agglomération de Montréal est significativement différente de celles de SR hors de l’agglomération.</p>
<div class="figure" style="text-align: center">
<img src="images/bivariee/FigureLocataires.jpg" alt="Pourcentage de locataires par secteur de recensement, région métropolitaine de recensement de Montréal, 2016" width="100%" />
<p class="caption">
(#fig:figlocataires)Pourcentage de locataires par secteur de recensement, région métropolitaine de recensement de Montréal, 2016
</p>
</div>
<p>Les résultats de la syntaxe ci-dessous signalent que le pourcentage de locataires par SR est bien supérieur dans l’agglomération (moyenne = 59,7 %; écart-type = 21,4 %) qu’en dehors de l’agglomération de Montréal (moyenne = 27,3 %; écart-type = 20,1 %). Cette différence de 32,5 points de pourcentage est d’ailleurs significative et très forte (<em>t</em> = -23,95; <em>p</em> &lt; 0,001, d de Cohen = 1,54).</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="#cb559-1"></a><span class="kw">library</span>(<span class="st">&quot;foreign&quot;</span>)</span>
<span id="cb559-2"><a href="#cb559-2"></a><span class="kw">library</span>(<span class="st">&quot;effectsize&quot;</span>)</span>
<span id="cb559-3"><a href="#cb559-3"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb559-4"><a href="#cb559-4"></a><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb559-5"><a href="#cb559-5"></a><span class="co"># Importation du fichier</span></span>
<span id="cb559-6"><a href="#cb559-6"></a>dfRMR &lt;-<span class="st"> </span><span class="kw">read.dbf</span>(<span class="st">&quot;data/bivariee/SRRMRMTL2016.dbf&quot;</span>)</span>
<span id="cb559-7"><a href="#cb559-7"></a><span class="co"># Définition d&#39;un facteur binaire                  </span></span>
<span id="cb559-8"><a href="#cb559-8"></a>dfRMR<span class="op">$</span>Montreal &lt;-<span class="st"> </span><span class="kw">factor</span>(dfRMR<span class="op">$</span>Montreal, </span>
<span id="cb559-9"><a href="#cb559-9"></a>                           <span class="dt">levels=</span>  <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb559-10"><a href="#cb559-10"></a>                           <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Hors de Montréal&quot;</span>,<span class="st">&quot;Montréal&quot;</span>))</span>
<span id="cb559-11"><a href="#cb559-11"></a><span class="co"># Comparaison des moyennes ------------------------</span></span>
<span id="cb559-12"><a href="#cb559-12"></a><span class="co">#Boite à moustaches (boxplot)</span></span>
<span id="cb559-13"><a href="#cb559-13"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dfRMR, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>Montreal,<span class="dt">y=</span>Locataire,<span class="dt">colour=</span>Montreal)) <span class="op">+</span></span>
<span id="cb559-14"><a href="#cb559-14"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">width=</span><span class="fl">0.2</span>)<span class="op">+</span></span>
<span id="cb559-15"><a href="#cb559-15"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>)<span class="op">+</span></span>
<span id="cb559-16"><a href="#cb559-16"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Zone&quot;</span>)<span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Pourcentage de locataires&quot;</span>)<span class="op">+</span></span>
<span id="cb559-17"><a href="#cb559-17"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Locataires par secteur de recensement&quot;</span>, </span>
<span id="cb559-18"><a href="#cb559-18"></a>          <span class="dt">subtitle=</span><span class="st">&quot;région métropolitaine de recensement de Montréal, 2016&quot;</span>)</span></code></pre></div>
<p><img src="MethodesQuantitScSocialesR_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1"></a><span class="co"># nombre d&#39;observations, moyennes et écarts-types pour les deux échantillons</span></span>
<span id="cb560-2"><a href="#cb560-2"></a><span class="kw">group_by</span>(dfRMR, Montreal) <span class="op">%&gt;%</span></span>
<span id="cb560-3"><a href="#cb560-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb560-4"><a href="#cb560-4"></a>    <span class="dt">n =</span> <span class="kw">n</span>(),</span>
<span id="cb560-5"><a href="#cb560-5"></a>    <span class="dt">moy =</span> <span class="kw">mean</span>(Locataire, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb560-6"><a href="#cb560-6"></a>    <span class="dt">ecarttype =</span> <span class="kw">sd</span>(Locataire, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb560-7"><a href="#cb560-7"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   Montreal             n   moy ecarttype
##   &lt;fct&gt;            &lt;int&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 Hors de Montréal   430  27.3      20.1
## 2 Montréal           521  59.7      21.4</code></pre>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1"></a><span class="co"># Nous vérifions si les variances sont égales avec la fonction var.test</span></span>
<span id="cb562-2"><a href="#cb562-2"></a><span class="co"># quand la valeur de P est inférieure à 0,05 alors les variances diffèrent</span></span>
<span id="cb562-3"><a href="#cb562-3"></a>v &lt;-<span class="st"> </span><span class="kw">var.test</span>(Locataire <span class="op">~</span><span class="st"> </span>Montreal, <span class="dt">alternative=</span><span class="st">&#39;two.sided&#39;</span>, <span class="dt">conf.level=</span>.<span class="dv">95</span>, <span class="dt">data=</span>dfRMR)</span>
<span id="cb562-4"><a href="#cb562-4"></a><span class="kw">print</span>(v)</span></code></pre></div>
<pre><code>## 
##  F test to compare two variances
## 
## data:  Locataire by Montreal
## F = 0.88156, num df = 429, denom df = 520, p-value = 0.1739
## alternative hypothesis: true ratio of variances is not equal to 1
## 95 percent confidence interval:
##  0.7361821 1.0573195
## sample estimates:
## ratio of variances 
##          0.8815563</code></pre>
<p>Le test indique que nous n’avons aucune raison de rejeter l’hypothèse nulle selon laquelle les variances sont égales. Pour l’île de Montréal, l’écart-type est de 21,4; il est de 20,1 hors de l’île, soit une différence négligeable.</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="#cb564-1"></a><span class="co"># Calcul du T de Student ou du T de Welch</span></span>
<span id="cb564-2"><a href="#cb564-2"></a>p &lt;-<span class="st"> </span>v<span class="op">$</span>p.value</span>
<span id="cb564-3"><a href="#cb564-3"></a><span class="cf">if</span>(p <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.05</span>){</span>
<span id="cb564-4"><a href="#cb564-4"></a>  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Les variances ne diffèrent pas!&quot;</span>,</span>
<span id="cb564-5"><a href="#cb564-5"></a>     <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Nous utilisons le test de Student avec l&#39;option var.equal=TRUE&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb564-6"><a href="#cb564-6"></a>    <span class="kw">t.test</span>(Locataire <span class="op">~</span><span class="st"> </span>Montreal,  <span class="co"># variable continue ~ facteur binaire </span></span>
<span id="cb564-7"><a href="#cb564-7"></a>           <span class="dt">data=</span>dfRMR,            <span class="co"># nom du DataFrame</span></span>
<span id="cb564-8"><a href="#cb564-8"></a>           <span class="dt">conf.level=</span>.<span class="dv">95</span>,        <span class="co"># intervalle de confiance pour la valeur de t</span></span>
<span id="cb564-9"><a href="#cb564-9"></a>           <span class="dt">paired =</span> <span class="ot">FALSE</span>,        <span class="co"># échantillons non pairés (indépendants)</span></span>
<span id="cb564-10"><a href="#cb564-10"></a>           <span class="dt">var.equal=</span><span class="ot">TRUE</span>)        <span class="co"># variances égales</span></span>
<span id="cb564-11"><a href="#cb564-11"></a>} <span class="cf">else</span> {</span>
<span id="cb564-12"><a href="#cb564-12"></a>  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Les variances diffèrent!&quot;</span>,</span>
<span id="cb564-13"><a href="#cb564-13"></a>      <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Nous utiliseons le test de Welch avec l&#39;option var.equal=FALSE&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb564-14"><a href="#cb564-14"></a>  <span class="kw">t.test</span>(Locataire <span class="op">~</span><span class="st"> </span>Montreal,   <span class="co"># variable continue ~ facteur binaire </span></span>
<span id="cb564-15"><a href="#cb564-15"></a>         <span class="dt">data=</span>dfRMR,             <span class="co"># nom du DataFrame</span></span>
<span id="cb564-16"><a href="#cb564-16"></a>         <span class="dt">conf.level=</span>.<span class="dv">95</span>,         <span class="co"># intervalle de confiance pour la valeur de t</span></span>
<span id="cb564-17"><a href="#cb564-17"></a>         <span class="dt">paired =</span> <span class="ot">FALSE</span>,         <span class="co"># échantillons non pairés (indépendants)</span></span>
<span id="cb564-18"><a href="#cb564-18"></a>         <span class="dt">var.equal=</span><span class="ot">FALSE</span>)        <span class="co"># variances différentes</span></span>
<span id="cb564-19"><a href="#cb564-19"></a>}</span></code></pre></div>
<pre><code>## 
##  Les variances ne diffèrent pas!
##  Nous utilisons le test de Student avec l&#39;option var.equal=TRUE</code></pre>
<pre><code>## 
##  Two Sample t-test
## 
## data:  Locataire by Montreal
## t = -23.95, df = 949, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -35.11182 -29.79341
## sample estimates:
## mean in group Hors de Montréal         mean in group Montréal 
##                       27.27340                       59.72601</code></pre>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="#cb567-1"></a><span class="co"># Effet de taille à analyser uniquement si le test est significatif</span></span>
<span id="cb567-2"><a href="#cb567-2"></a><span class="kw">cohens_d</span>(Locataire <span class="op">~</span><span class="st"> </span>Montreal, <span class="dt">data =</span> dfRMR, <span class="dt">paired =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Cohen&#39;s d |         95% CI
## --------------------------
## -1.56     | [-1.71, -1.41]
## 
## - Estimated using pooled SD.</code></pre>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="#cb569-1"></a><span class="kw">hedges_g</span>(Locataire <span class="op">~</span><span class="st"> </span>Montreal, <span class="dt">data =</span> dfRMR, <span class="dt">paired =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Hedges&#39; g |         95% CI
## --------------------------
## -1.56     | [-1.70, -1.41]
## 
## - Estimated using pooled SD.
## - Bias corrected using Hedges and Olkin&#39;s method.</code></pre>
<p>Notez que les valeurs du <em>d</em> de Cohen et du <em>g</em> de Hedge sont très semblables; rappelons que le second est une correction du premier pour des échantillons de taille réduite. Avec 951 observations, nous disposons d’un échantillon suffisamment grand pour que cette correction soit négligeable.</p>
<p><strong>Exemple de syntaxe pour un test de Student pour des échantillons dépendants</strong></p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="#cb571-1"></a><span class="kw">library</span>(<span class="st">&quot;ggpubr&quot;</span>)</span>
<span id="cb571-2"><a href="#cb571-2"></a><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb571-3"><a href="#cb571-3"></a>Pre &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">79</span>,<span class="dv">71</span>,<span class="dv">81</span>,<span class="dv">83</span>,<span class="dv">77</span>,<span class="dv">74</span>,<span class="dv">76</span>,<span class="dv">74</span>,<span class="dv">79</span>,<span class="dv">70</span>,<span class="dv">66</span>,<span class="dv">85</span>,<span class="dv">69</span>,<span class="dv">69</span>,<span class="dv">82</span>,</span>
<span id="cb571-4"><a href="#cb571-4"></a>         <span class="dv">69</span>,<span class="dv">81</span>,<span class="dv">70</span>,<span class="dv">83</span>,<span class="dv">68</span>,<span class="dv">77</span>,<span class="dv">76</span>,<span class="dv">77</span>,<span class="dv">70</span>,<span class="dv">68</span>,<span class="dv">80</span>,<span class="dv">65</span>,<span class="dv">65</span>,<span class="dv">75</span>,<span class="dv">84</span>)</span>
<span id="cb571-5"><a href="#cb571-5"></a>Post &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">56</span>,<span class="dv">47</span>,<span class="dv">40</span>,<span class="dv">45</span>,<span class="dv">49</span>,<span class="dv">51</span>,<span class="dv">54</span>,<span class="dv">47</span>,<span class="dv">44</span>,<span class="dv">54</span>,<span class="dv">42</span>,<span class="dv">56</span>,<span class="dv">45</span>,<span class="dv">45</span>,<span class="dv">48</span>,</span>
<span id="cb571-6"><a href="#cb571-6"></a>          <span class="dv">55</span>,<span class="dv">59</span>,<span class="dv">58</span>,<span class="dv">56</span>,<span class="dv">41</span>,<span class="dv">56</span>,<span class="dv">51</span>,<span class="dv">45</span>,<span class="dv">55</span>,<span class="dv">49</span>,<span class="dv">49</span>,<span class="dv">48</span>,<span class="dv">43</span>,<span class="dv">60</span>,<span class="dv">50</span>)</span>
<span id="cb571-7"><a href="#cb571-7"></a><span class="co"># Première façon de faire un tableau : avec deux colonnes Avant et Après</span></span>
<span id="cb571-8"><a href="#cb571-8"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Avant=</span>Pre, <span class="dt">Apres=</span>Post)</span>
<span id="cb571-9"><a href="#cb571-9"></a><span class="kw">head</span>(df1)</span></code></pre></div>
<pre><code>##   Avant Apres
## 1    79    56
## 2    71    47
## 3    81    40
## 4    83    45
## 5    77    49
## 6    74    51</code></pre>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="#cb573-1"></a><span class="kw">ggpaired</span>(df1, <span class="dt">cond1 =</span> <span class="st">&quot;Avant&quot;</span>, <span class="dt">cond2 =</span> <span class="st">&quot;Apres&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;condition&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;jco&quot;</span>,</span>
<span id="cb573-2"><a href="#cb573-2"></a>         <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Variable continue&quot;</span>)</span></code></pre></div>
<p><img src="MethodesQuantitScSocialesR_files/figure-html/unnamed-chunk-153-1.png" width="672" /></p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="#cb574-1"></a><span class="co"># Nombre d&#39;observations, moyennes et écart-types</span></span>
<span id="cb574-2"><a href="#cb574-2"></a><span class="kw">cat</span>(<span class="kw">nrow</span>(df1), <span class="st">&quot; observations&quot;</span>,</span>
<span id="cb574-3"><a href="#cb574-3"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">POST. moy = &quot;</span>, <span class="kw">round</span>(<span class="kw">mean</span>(df1<span class="op">$</span>Avant),<span class="dv">1</span>), <span class="st">&quot;, e.t. = &quot;</span>, <span class="kw">round</span>(<span class="kw">sd</span>(df1<span class="op">$</span>Avant),<span class="dv">1</span>),</span>
<span id="cb574-4"><a href="#cb574-4"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">PRE.  moy = &quot;</span>, <span class="kw">round</span>(<span class="kw">mean</span>(df1<span class="op">$</span>Apres),<span class="dv">1</span>), <span class="st">&quot;, e.t. = &quot;</span>, <span class="kw">round</span>(<span class="kw">sd</span>(df1<span class="op">$</span>Apres),<span class="dv">1</span>), <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## 30 observations
## POST. moy = 74.8, e.t. = 6.1
## PRE.  moy = 49.9, e.t. = 5.7</code></pre>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="#cb576-1"></a><span class="kw">t.test</span>(Pre, Post, <span class="dt">paired =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  Pre and Post
## t = 18.701, df = 29, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  22.11740 27.54926
## sample estimates:
## mean of the differences 
##                24.83333</code></pre>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="#cb578-1"></a><span class="co"># Deuxième façon de faire un tableau : avec une colonne pour la variable continue</span></span>
<span id="cb578-2"><a href="#cb578-2"></a><span class="co"># et une autre pour la variable qualitative</span></span>
<span id="cb578-3"><a href="#cb578-3"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(Pre)<span class="op">*</span><span class="dv">2</span></span>
<span id="cb578-4"><a href="#cb578-4"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb578-5"><a href="#cb578-5"></a>       <span class="dt">id=</span>(<span class="dv">1</span><span class="op">:</span>n),</span>
<span id="cb578-6"><a href="#cb578-6"></a>       <span class="dt">participant=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Pre)),</span>
<span id="cb578-7"><a href="#cb578-7"></a>       <span class="dt">risque=</span><span class="kw">c</span>(Pre,Post)</span>
<span id="cb578-8"><a href="#cb578-8"></a>       )</span>
<span id="cb578-9"><a href="#cb578-9"></a>df2<span class="op">$</span>periode &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df2<span class="op">$</span>id <span class="op">&lt;=</span><span class="st"> </span><span class="kw">length</span>(Pre), <span class="st">&quot;Pré&quot;</span>, <span class="st">&quot;Post&quot;</span>)</span>
<span id="cb578-10"><a href="#cb578-10"></a><span class="kw">head</span>(df2)</span></code></pre></div>
<pre><code>##   id participant risque periode
## 1  1           1     79     Pré
## 2  2           2     71     Pré
## 3  3           3     81     Pré
## 4  4           4     83     Pré
## 5  5           5     77     Pré
## 6  6           6     74     Pré</code></pre>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="#cb580-1"></a><span class="co"># nombre d&#39;observations, moyennes et écarts-types pour les deux échantillons</span></span>
<span id="cb580-2"><a href="#cb580-2"></a><span class="kw">group_by</span>(df2, periode) <span class="op">%&gt;%</span></span>
<span id="cb580-3"><a href="#cb580-3"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb580-4"><a href="#cb580-4"></a>    <span class="dt">n =</span> <span class="kw">n</span>(),</span>
<span id="cb580-5"><a href="#cb580-5"></a>    <span class="dt">moy =</span> <span class="kw">mean</span>(risque, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb580-6"><a href="#cb580-6"></a>    <span class="dt">et =</span> <span class="kw">sd</span>(risque, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb580-7"><a href="#cb580-7"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   periode     n   moy    et
##   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Post       30  49.9  5.67
## 2 Pré        30  74.8  6.10</code></pre>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="#cb582-1"></a><span class="kw">ggpaired</span>(<span class="dt">data=</span>df2, <span class="dt">x=</span> <span class="st">&quot;periode&quot;</span>, <span class="dt">y=</span><span class="st">&quot;risque&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;periode&quot;</span>,</span>
<span id="cb582-2"><a href="#cb582-2"></a>         <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Variable continue&quot;</span>)</span></code></pre></div>
<p><img src="MethodesQuantitScSocialesR_files/figure-html/unnamed-chunk-153-2.png" width="672" /></p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="#cb583-1"></a><span class="kw">t.test</span>(risque <span class="op">~</span><span class="st"> </span>periode, <span class="dt">data=</span>df2, <span class="dt">paired =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  risque by periode
## t = -18.701, df = 29, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -27.54926 -22.11740
## sample estimates:
## mean of the differences 
##               -24.83333</code></pre>
</div>
<div id="sect06114" class="section level4">
<h4><span class="header-section-number">6.1.1.4</span> Comparaison des moyennes pondérées</h4>
<div class="bloc_objectif">
<p>En études urbaines et en géographie, le recours aux données agrégées (non individuelles) est fréquent, par exemple au niveau des secteurs de recensement (comprenant généralement entre 2500 à 8000 habitants). Dans ce contexte, un secteur de recensement plus peuplé devrait avoir un poids plus important dans l’analyse. Il est possible d’utiliser les versions pondérées des tests présentés précédemment. Prenons deux exemples pour illustrer le tout :</p>
<ul>
<li><p>Pour chaque secteur de recensement des îles de Montréal et de Laval, nous avons calculé la distance au parc le plus proche à travers le réseau de rues avec un système d’information géographique (SIG). Nous souhaitons vérifier si les personnes âgées de moins de 15 ans résidant sur l’île de Montréal bénéficient en moyenne d’une meilleure accessibilité au parc.</p></li>
<li><p>Dans une étude sur la concentration de polluants atmosphériques dans l’environnement autour des écoles primaires montréalaises, Carrier <em>et al.</em> <span class="citation">(<a href="#ref-carrier2014" role="doc-biblioref">2014</a>)</span> souhaitaient vérifier si les élèves fréquentant les écoles les plus défavorisées sont plus exposé(e)s au dioxyde d’azote (NO<sub>2</sub>) dans leur milieu scolaire. Pour ce faire, ils ont réalisé un test <em>t</em> sur un tableau avec comme observations les écoles primaires et trois variables : la moyenne de NO<sub>2</sub> (variable continue), les quintiles extrêmes d’un indice de défavorisation (premier et dernier quintiles, variable qualitative) et le nombre d’élèves par école (variable pour la pondération).</p></li>
</ul>
<p>Pour réaliser un test <em>t</em> pondéré, nous pouvons utiliser la fonction <code>weighted_ttest</code> du package <code>sjstats</code>.</p>
</div>
<p>En guise d’exemple appliqué, dans la syntaxe ci-dessous, nous avons refait le même test <em>t</em> que précédemment (<code>Locataire ~ Montreal</code>) en pondérant chaque secteur de recensement par le nombre de logements qu’il comprend.</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="#cb585-1"></a><span class="kw">library</span>(<span class="st">&quot;sjstats&quot;</span>)</span>
<span id="cb585-2"><a href="#cb585-2"></a><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb585-3"><a href="#cb585-3"></a><span class="co"># Calcul des statistiques pondérées</span></span>
<span id="cb585-4"><a href="#cb585-4"></a><span class="kw">group_by</span>(dfRMR, Montreal) <span class="op">%&gt;%</span></span>
<span id="cb585-5"><a href="#cb585-5"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb585-6"><a href="#cb585-6"></a>    <span class="dt">n =</span> <span class="kw">sum</span>(Logement),</span>
<span id="cb585-7"><a href="#cb585-7"></a>    <span class="dt">MoyPond =</span> <span class="kw">weighted_mean</span>(Locataire, Logement),</span>
<span id="cb585-8"><a href="#cb585-8"></a>    <span class="dt">ecarttypePond =</span> <span class="kw">weighted_sd</span>(Locataire, Logement)</span>
<span id="cb585-9"><a href="#cb585-9"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   Montreal              n MoyPond ecarttypePond
##   &lt;fct&gt;             &lt;int&gt;   &lt;dbl&gt;         &lt;dbl&gt;
## 1 Hors de Montréal 856928    28.4          19.9
## 2 Montréal         870354    60.0          20.8</code></pre>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="#cb587-1"></a><span class="co"># Test t non pondéré</span></span>
<span id="cb587-2"><a href="#cb587-2"></a><span class="kw">t.test</span>(Locataire <span class="op">~</span><span class="st"> </span>Montreal, dfRMR, </span>
<span id="cb587-3"><a href="#cb587-3"></a>               <span class="dt">paired =</span> <span class="ot">FALSE</span>, <span class="dt">var.equal =</span> <span class="ot">TRUE</span>, <span class="dt">conf.level=</span>.<span class="dv">95</span>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  Locataire by Montreal
## t = -23.95, df = 949, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -35.11182 -29.79341
## sample estimates:
## mean in group Hors de Montréal         mean in group Montréal 
##                       27.27340                       59.72601</code></pre>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="#cb589-1"></a><span class="co"># Test t pondérée</span></span>
<span id="cb589-2"><a href="#cb589-2"></a><span class="kw">weighted_ttest</span>(Locataire <span class="op">~</span><span class="st"> </span>Montreal <span class="op">+</span><span class="st"> </span>Logement, dfRMR, </span>
<span id="cb589-3"><a href="#cb589-3"></a>               <span class="dt">paired =</span> <span class="ot">FALSE</span>, <span class="dt">ci.lvl=</span>.<span class="dv">95</span>)</span></code></pre></div>
<pre><code>## 
## Two-Sample t-test (two.sided)
## 
## # comparison of Locataire by Montreal
## # t=-23.91  df=928  p-value=0.000
## 
##   mean in group Hors de Montréal: 28.396
##   mean in group Montréal        : 60.003
##   difference of mean            : -31.608 [-34.202  -29.013]</code></pre>
</div>
<div id="sect06115" class="section level4">
<h4><span class="header-section-number">6.1.1.5</span> Comment rapporter un test de Student ou de Welch?</h4>
<p>Pour les différentes versions du test, il est important de rapporter les valeurs de <em>t</em> et de <em>p</em>, les moyennes et écarts-types des groupes. Voici quelques exemples.</p>
<p><strong>Test de Student ou de Welch pour échantillons indépendants</strong></p>
<ul>
<li>Dans la région métropolitaine de Montréal en 2005, le revenu total des femmes (moyenne = 29 117 dollars; écart-type = 258 022) est bien inférieur à celui des hommes (moyenne = 44 463; écart-type = 588 081). La différence entre les moyennes des deux sexes (-15 345) en faveur des hommes est d’ailleurs significative (<em>t</em> = -27,09; <em>p</em> &lt; 0,001).</li>
<li>Il y un effet significatif selon le sexe (<em>t</em> = -27,09; <em>p</em> &lt; 0,001), le revenu total des hommes (moyenne = 44 463; écart-type = 588 081) étant bien supérieur à celui des femmes (moyenne = 29 117; écart-type = 258 022).</li>
<li>50 personnes se rendent au travail à vélo (moyenne = 33,7; écart-type = 8,5) contre 60 en automobile (moyenne = 34; écart-type = 8,7). Il n’y a pas de différence significative entre les moyennes d’âge des deux groupes (<em>t</em>(108) = -0,79; <em>p</em> = 0,427).</li>
</ul>
<p><strong>Test de Student échantillons dépendants (pairés)</strong></p>
<ul>
<li>Nous constatons une diminution significative de la perception du risque après l’activité (moyenne = 49,9; écart-type = 5,7) comparativement à avant (moyenne = 74,8; écart-type = 6,1), avec une différence de -24,8 (<em>t</em>(29) = -18,7; <em>p</em> &lt; 0,001).</li>
<li>Les résultats du pré-test (moyenne = 49,9; écart-type = 5,7) et du post-test (moyenne = 74,8; écart-type = 6,1) montrent qu’il y une diminution significative de la perception du risque (<em>t</em>(29) = -18,7; <em>p</em> &lt; 0,001).</li>
</ul>
<p>Pour un texte en anglais, consultez
<a href="https://www.socscistatistics.com/tutorials/ttest/default.aspx" target="_blank">https://www.socscistatistics.com/tutorials/ttest/default.aspx</a>.</p>
</div>
</div>
<div id="sect0612" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Test non paramétrique de Wilcoxon</h3>
<div class="bloc_objectif">
<p>Si la variable continue est fortement anormalement distribuée, il est déconseillé d’utiliser les tests de Student et de Welch. Nous privilégions le test des rangs signés de Wilcoxon (<em>Wilcoxon rank-sum test</em> en anglais). Attention, il est aussi appelé test U de Mann-Whitney. Ce test permet alors de vérifier si les deux groupes présentent des médianes différentes.</p>
<p>Pour ce faire, nous utilisons la fonction <code>wilcox.test</code> dans laquelle le paramètre <code>paired</code> permet de spécifier si les échantillons sont indépendants ou non (<code>FALSE</code> ou <code>TRUE</code>).</p>
</div>
<p>Dans l’exemple suivant, nous analysons le pourcentage de locataires dans les secteurs de recensement de la région métropolitaine de Montréal. Plus spécifiquement, nous comparons ce pourcentage entre les secteurs présents sur l’île et les secteurs hors de l’île. Il s’agit donc d’un test avec des échantillons indépendants.</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="#cb591-1"></a><span class="kw">library</span>(<span class="st">&quot;foreign&quot;</span>)</span>
<span id="cb591-2"><a href="#cb591-2"></a><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb591-3"><a href="#cb591-3"></a><span class="co">###############################</span></span>
<span id="cb591-4"><a href="#cb591-4"></a><span class="co"># Échantillons indépendants</span></span>
<span id="cb591-5"><a href="#cb591-5"></a><span class="co">###############################</span></span>
<span id="cb591-6"><a href="#cb591-6"></a>dfRMR &lt;-<span class="st"> </span><span class="kw">read.dbf</span>(<span class="st">&quot;data/bivariee/SRRMRMTL2016.dbf&quot;</span>)</span>
<span id="cb591-7"><a href="#cb591-7"></a><span class="co"># Définition d&#39;un facteur binaire                  </span></span>
<span id="cb591-8"><a href="#cb591-8"></a>dfRMR<span class="op">$</span>Montreal &lt;-<span class="st"> </span><span class="kw">factor</span>(dfRMR<span class="op">$</span>Montreal, </span>
<span id="cb591-9"><a href="#cb591-9"></a>                           <span class="dt">levels=</span>  <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb591-10"><a href="#cb591-10"></a>                           <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Hors de Montréal&quot;</span>,<span class="st">&quot;Montréal&quot;</span>))</span>
<span id="cb591-11"><a href="#cb591-11"></a><span class="co"># Calcul du nombre d&#39;observations, des moyennes et </span></span>
<span id="cb591-12"><a href="#cb591-12"></a><span class="co"># des écarts-types des rangs pour les deux échantillons</span></span>
<span id="cb591-13"><a href="#cb591-13"></a><span class="kw">group_by</span>(dfRMR, Montreal) <span class="op">%&gt;%</span></span>
<span id="cb591-14"><a href="#cb591-14"></a><span class="st">  </span><span class="kw">summarise</span>(</span>
<span id="cb591-15"><a href="#cb591-15"></a>    <span class="dt">n =</span> <span class="kw">n</span>(),</span>
<span id="cb591-16"><a href="#cb591-16"></a>    <span class="dt">moy_rang =</span> <span class="kw">mean</span>(<span class="kw">rank</span>(Locataire), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb591-17"><a href="#cb591-17"></a>    <span class="dt">med_rang =</span> <span class="kw">median</span>(<span class="kw">rank</span>(Locataire), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb591-18"><a href="#cb591-18"></a>    <span class="dt">ecarttype_rang =</span> <span class="kw">sd</span>(<span class="kw">rank</span>(Locataire), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb591-19"><a href="#cb591-19"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   Montreal             n moy_rang med_rang ecarttype_rang
##   &lt;fct&gt;            &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;
## 1 Hors de Montréal   430     216.     216.           124.
## 2 Montréal           521     261      261            151.</code></pre>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="#cb593-1"></a><span class="co"># Test des rangs signés de Wilcoxon sur des échantillons indépendants</span></span>
<span id="cb593-2"><a href="#cb593-2"></a><span class="kw">wilcox.test</span>(Locataire <span class="op">~</span><span class="st"> </span>Montreal, dfRMR, <span class="dt">paired =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Wilcoxon rank sum test with continuity correction
## 
## data:  Locataire by Montreal
## W = 33716, p-value &lt; 2.2e-16
## alternative hypothesis: true location shift is not equal to 0</code></pre>
<p>Nous observons bien ici une différence significative entre le pourcentage de locataires des secteurs de recensement sur l’île (rang médian = 216) et ceux en dehors de l’île (rang médian = 261).</p>
<p>Pour le second exemple, nous générons deux jeux de données au hasard représentant une mesure d’une variable pré-traitement (<em>pre</em>) et post-traitement (<em>post</em>) pour un même échantillon.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="#cb595-1"></a><span class="co">###############################</span></span>
<span id="cb595-2"><a href="#cb595-2"></a><span class="co"># Échantillons dépendants</span></span>
<span id="cb595-3"><a href="#cb595-3"></a><span class="co">###############################</span></span>
<span id="cb595-4"><a href="#cb595-4"></a>pre &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">60</span><span class="op">:</span><span class="dv">80</span>, <span class="dv">50</span>, <span class="dt">replace=</span>T)</span>
<span id="cb595-5"><a href="#cb595-5"></a>post &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">30</span><span class="op">:</span><span class="dv">65</span>, <span class="dv">50</span>, <span class="dt">replace=</span>T)</span>
<span id="cb595-6"><a href="#cb595-6"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Avant=</span>pre, <span class="dt">Apres=</span>post)</span>
<span id="cb595-7"><a href="#cb595-7"></a><span class="co"># Nombre d&#39;observations, moyennes et écart-types</span></span>
<span id="cb595-8"><a href="#cb595-8"></a><span class="kw">cat</span>(<span class="kw">nrow</span>(df1), <span class="st">&quot; observations&quot;</span>,</span>
<span id="cb595-9"><a href="#cb595-9"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">POST. median = &quot;</span>, <span class="kw">round</span>(<span class="kw">median</span>(df1<span class="op">$</span>Avant),<span class="dv">1</span>), </span>
<span id="cb595-10"><a href="#cb595-10"></a>             <span class="st">&quot;, moy = &quot;</span>, <span class="kw">round</span>(<span class="kw">mean</span>(df1<span class="op">$</span>Avant),<span class="dv">1</span>),</span>
<span id="cb595-11"><a href="#cb595-11"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">PRE.  median = &quot;</span>, <span class="kw">round</span>(<span class="kw">median</span>(df1<span class="op">$</span>Apres),<span class="dv">1</span>), </span>
<span id="cb595-12"><a href="#cb595-12"></a>             <span class="st">&quot;, moy = &quot;</span>, <span class="kw">round</span>(<span class="kw">mean</span>(df1<span class="op">$</span>Apres),<span class="dv">1</span>), <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## 50 observations
## POST. median = 70, moy = 69.3
## PRE.  median = 49, moy = 47.2</code></pre>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="#cb597-1"></a><span class="kw">wilcox.test</span>(df1<span class="op">$</span>Avant, df1<span class="op">$</span>Apres, <span class="dt">paired =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Wilcoxon signed rank test with continuity correction
## 
## data:  df1$Avant and df1$Apres
## V = 1224, p-value = 1.21e-09
## alternative hypothesis: true location shift is not equal to 0</code></pre>
<p>À nouveau, nous obtenons une différence significative entre les deux variables.</p>
<p><strong>Comment rapporter un test de Wilcoxon?</strong></p>
<p>Lorsque nous rapportons les résultats d’un test de Wilcoxon, il est important de signaler la valeur du test (<em>W</em>), le degré de signification (valeur de <em>p</em>) et éventuellement la médiane des rangs ou de la variable originale pour les deux groupes. Voici quelques exemples :</p>
<ul>
<li>Les résultats du test des rangs signés de Wilcoxon signalent que les rangs de l’île de Montréal sont significativement plus élevés que ceux de l’île de Laval (<em>W</em> = 1223, <em>p</em> &lt; 0,001).</li>
<li>Les résultats du test de Wilcoxon signalent que les rangs post-tests sont significativement plus faibles que ceux du pré-test (<em>W</em> = 1273,5, <em>p</em> &lt; 0,001).</li>
<li>Les résultats du test de Wilcoxon signalent que la médiane des rangs pré-tests (médiane = 69) est significativement plus forte que celle du post-test (médiane = 50,5) (<em>W</em> = 1273,5, <em>p</em> &lt; 0,001).</li>
</ul>
</div>
</div>
<div id="sect062" class="section level2">
<h2><span class="header-section-number">6.2</span> Relation entre une variable quantitative et une variable qualitative à plus de deux modalités</h2>
<div class="bloc_objectif">
<p><strong>Existe-t-il une relation entre une variable continue et une variable qualitative comprenant plus de deux modalités?</strong> Pour répondre à cette question, nous avons recours à deux méthodes : l’analyse de variance – <strong>ANOVA</strong>, <em><strong>AN</strong>alysis <strong>O</strong>f <strong>VA</strong>riance</em> en anglais – et le test non paramétrique de Kruskal-Wallis. La première permet de vérifier si les moyennes de plusieurs groupes d’une population donnée sont ou non significativement différentes; la seconde, si leurs médianes sont différentes.</p>
</div>
<div id="sect0621" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Analyse de variance</h3>
<p>L’analyse de variance (ANOVA) est largement utilisée en psychologie, en médecine et en pharmacologie. Prenons un exemple classique en pharmacologie pour tester l’efficacité d’un médicament. Quatre groupes de population sont constitués :</p>
<ul>
<li>un premier groupe d’individus pour lequel nous administrons un placebo (un médicament sans substance active), soit le groupe de contrôle ou le groupe témoin;</li>
<li>un second groupe auquel nous administrons le médicament avec un faible dosage;</li>
<li>un troisième avec un dosage moyen;</li>
<li>un quatrième avec un dosage élevé.</li>
</ul>
<p>La variable continue permet d’évaluer l’évolution de l’état de santé des individus (par exemple, la variation du taux de globules rouges dans le sang avant et après le traitement). Si le traitement est efficace, nous nous attendons alors à ce que les moyennes des deuxième, troisième et quatrième groupes soient plus élevées que celle du groupe de contrôle. Les différences de moyennes entre les second, troisième et quatrième groupes permettent aussi de repérer le dosage le plus efficace. Si nous n’observons aucune différence significative entre les groupes, cela signifie que l’effet du médicament ne diffère pas de l’effet d’un placébo.</p>
<p>L’ANOVA est aussi très utilisée en études urbaines, principalement pour vérifier si un phénomène urbain varie selon plusieurs groupes d’une population donnée ou de régions géographiques. En guise d’exemple, le recours à l’ANOVA permet de répondre aux questions suivantes :</p>
<ul>
<li><p>Les moyennes des niveaux d’exposition à un polluant atmosphérique (variable continue) varient-elles significativement selon le mode de transport utilisé (automobile, vélo, transport en commun) pour des trajets similaires en heures de pointe?</p></li>
<li><p>Pour une métropole donnée, les moyennes des loyers (variable continue) sont-elles différentes entre les logements de la ville centre versus ceux localisés dans la première couronne et ceux de la seconde couronne?</p></li>
</ul>
<div id="sect06211" class="section level4">
<h4><span class="header-section-number">6.2.1.1</span> Calcul des trois variances pour l’ANOVA</h4>
<p>L’ANOVA repose sur le calcul de trois variances :</p>
<ul>
<li><p><strong>la variance totale</strong> (<em>VT</em>) de la variable dépendante continue, soit la somme des carrés des écarts à la moyenne de l’ensemble de la population (équation @ref(eq:anova1));</p></li>
<li><p>la <strong>variance intergroupe</strong> (<em>Var<sub>inter</sub></em>) ou variance expliquée (<em>VE</em>), soit la somme des carrés des écarts entre la moyenne de chaque groupe et la moyenne de l’ensemble du jeu de données multipliées par le nombre d’individus appartenant à chacun des groupes (équation @ref(eq:anova2));</p></li>
<li><p>la <strong>variance intragroupe</strong> (<em>Var<sub>intra</sub></em>) ou variance non expliquée (<em>VNE</em>), soit la somme des variances des groupes de la variable indépendante (équation @ref(eq:anova3)).</p></li>
</ul>

<p><span class="math display">\[\begin{equation}
VT=\sum_{i=1}^n (y_{i}-\overline{y})^2
(\#eq:anova1)
\end{equation}\]</span>
</p>

<p><span class="math display">\[\begin{equation}
Var_{inter} \mbox{ ou } VE=n_{g_1}\sum_{i\in{g_1}}(\overline{y_{g_1}}-\overline{y})^2 + n_{g_2}\sum_{i\in{g_2}}(\overline{y_{g_2}}-\overline{y})^2 + ... + n_{g_k}\sum_{i\in{g_n}}(\overline{y_{g_k}}-\overline{y})^2
(\#eq:anova2)
\end{equation}\]</span>
</p>

<p><span class="math display">\[\begin{equation}
Var_{intra} \mbox{ ou } VNE=\sum_{i\in{g_1}}(y_{i}-\overline{y_{g_1}})^2 + \sum_{i\in{g_2}}(y_{i}-\overline{y_{g_2}})^2 + ... + \sum_{i\in{g_n}}(y_{i}-\overline{y_{g_k}})^2 
(\#eq:anova3)
\end{equation}\]</span>
</p>
<p>où <span class="math inline">\(\overline{y}\)</span> est la moyenne de l’ensemble de la population; <span class="math inline">\(\overline{y_{g_1}}\)</span>, <span class="math inline">\(\overline{y_{g_2}}\)</span>, <span class="math inline">\(\overline{y_{g_k}}\)</span> sont respectivement les moyennes des groupes 1 à <em>k</em> (<em>k</em> étant le nombre de modalités de la variable qualitative) et <span class="math inline">\(n_{g_1}\)</span>,<span class="math inline">\(n_{g_2}\)</span> et <span class="math inline">\(n_{g_k}\)</span> sont les nombres d’observations dans les groupes 1 à <em>k</em>.</p>
<p>La variance totale (<em>VT</em>) est égale à la somme de la variance intergroupe (expliquée) et la variance intragroupe (non expliquée) (équation @ref(eq:anova5)). Le ratio entre la variance intergroupe (expliquée) et la variance totale est dénommé <em>Eta<sup>2</sup></em> (équation @ref(eq:anova6)). Il varie de 0 à 1 et exprime la proportion de la variance de la variable continue qui est expliquée par les différentes modalités de la variable qualitative.</p>

<p><span class="math display">\[\begin{equation}
VT = Var_{inter} + Var_{intra} \mbox{ ou } VT = VNE + VE
(\#eq:anova5)
\end{equation}\]</span>
</p>

<p><span class="math display">\[\begin{equation}
\eta^2= \frac{Var_{inter}}{VT} \mbox{ ou }  \eta^2= \frac{VE}{VT}
(\#eq:anova6)
\end{equation}\]</span>
</p>
<div class="bloc_astuce">
<p><strong>La décomposition de la variance totale</strong> – égale à la somme des variances intragroupe et intergroupe – est fondamentale en statistique. Nous verrons qu’elle est aussi utilisée pour évaluer la qualité d’une partition d’une population en plusieurs groupes dans le chapitre sur les méthodes de classification (chapitre @ref(chap13)). En ANOVA, nous retenons que :</p>
<ul>
<li>plus la variance intragroupe est faible, plus les différents groupes sont homogènes;</li>
<li>plus la variance intergroupe est forte, plus les moyennes des groupes sont différentes et donc plus les groupes sont dissemblables.</li>
</ul>
<p>Autrement dit, plus la variance intergroupe (<strong>dissimilarité</strong> des groupes) est maximisée et corollairement plus la variance intragroupe (<strong>homogénéité</strong> de chacun des groupes) est minimisée, plus les groupes sont clairement distincts et plus l’ANOVA est performante.</p>
</div>
<p>Examinons un premier jeu de données fictives sur la vitesse de déplacement de cyclistes (variable continue exprimée en km/h) et une variable qualitative comprenant trois groupes de cyclistes utilisant soit un vélo personnel (<em>n<sub>A</sub></em> = 5), soit en libre-service (<em>n<sub>B</sub></em> = 7), soit électrique (<em>n<sub>C</sub></em> = 6) (tableau @ref(tab:aovfictive1)). D’emblée, nous notons que les moyennes de vitesse des trois groupes sont différentes : 17,6 km/h pour les cyclistes avec leur vélo personnel, 12,3 km/h celles et ceux avec des vélos en libre-service et 23,1 km/h pour les cyclistes avec un vélo électrique. Pour chaque observation, la troisième colonne du tableau représente les écarts à la moyenne globale mis au carré, tandis que les colonnes suivantes représentent la déviation au carré de chaque observation à la moyenne de son groupe d’appartenance. Ainsi, pour la première observation, nous avons <span class="math inline">\((\mbox{16,900} - \mbox{17,339})^2 = \mbox{0,193}\)</span> et <span class="math inline">\((\mbox{16,900} - \mbox{17,580})^2~ = \mbox{0,462}\)</span>. Les valeurs des trois variances sont les suivantes :</p>
<ul>
<li>la <strong>variance totale</strong> (<em>VT</em>) est donc égale à la somme de la troisième colonne (<span class="math inline">\(\mbox{424,663}\)</span>).</li>
<li>la <strong>variance intergroupe</strong> (expliquée, <em>VE</em>), elle est égale à <span class="math inline">\(\mbox{5}\times(\mbox{17,580-17,339})^2+\mbox{7}\times(\mbox{12,257-17,339})^2+\mbox{6}\times(\mbox{23,067-17,339})^2 = \mbox{377,904}\)</span>.</li>
<li>la <strong>variance intragroupe</strong> (non expliquée, <em>VNE</em>) est égale à <span class="math inline">\(\mbox{11,228+21,537+13,993=46,758}\)</span>.</li>
</ul>
<p>Nous avons donc <span class="math inline">\(VT = Var_{inter} + Var_{intra}\)</span>, soit <span class="math inline">\(\mbox{424,663 = 377,904 + 46,758}\)</span> et <span class="math inline">\(\eta_2 = \mbox{377,904 / 424,663 = 0,89}\)</span>. Cela signale que 89 % de la variance de la vitesse des cyclistes est expliquée par le type de vélo utilisé.</p>
<table>
<caption>
(#tab:aovfictive1)Données fictives et calcul des trois variances (cas 1)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Type de vélo
</th>
<th style="text-align:center;">
km/h
</th>
<th style="text-align:right;">
<span class="math inline">\((y_{i}-\overline{y})^2\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\((y_{i}-\overline{y_{A}})^2\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\((y_{i}-\overline{y_{B}})^2\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\((y_{i}-\overline{y_{C}})^2\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A. personnel
</td>
<td style="text-align:center;">
16,900
</td>
<td style="text-align:right;">
0,193
</td>
<td style="text-align:right;">
0,462
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
A. personnel
</td>
<td style="text-align:center;">
20,400
</td>
<td style="text-align:right;">
9,370
</td>
<td style="text-align:right;">
7,952
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
A. personnel
</td>
<td style="text-align:center;">
16,100
</td>
<td style="text-align:right;">
1,535
</td>
<td style="text-align:right;">
2,190
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
A. personnel
</td>
<td style="text-align:center;">
17,700
</td>
<td style="text-align:right;">
0,130
</td>
<td style="text-align:right;">
0,014
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
A. personnel
</td>
<td style="text-align:center;">
16,800
</td>
<td style="text-align:right;">
0,290
</td>
<td style="text-align:right;">
0,608
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
13,400
</td>
<td style="text-align:right;">
15,515
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
1,306
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
11,300
</td>
<td style="text-align:right;">
36,468
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,916
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
14,000
</td>
<td style="text-align:right;">
11,148
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
3,038
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
12,400
</td>
<td style="text-align:right;">
24,393
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,020
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
13,700
</td>
<td style="text-align:right;">
13,242
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
2,082
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
8,500
</td>
<td style="text-align:right;">
78,126
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
14,116
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
12,500
</td>
<td style="text-align:right;">
23,415
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,059
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
22,900
</td>
<td style="text-align:right;">
30,926
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,028
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
26,000
</td>
<td style="text-align:right;">
75,015
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
8,604
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
23,600
</td>
<td style="text-align:right;">
39,202
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,284
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
21,000
</td>
<td style="text-align:right;">
13,404
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
4,271
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
22,300
</td>
<td style="text-align:right;">
24,613
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,588
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
22,600
</td>
<td style="text-align:right;">
27,679
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,218
</td>
</tr>
<tr>
<td style="text-align:left;">
grande moyenne
</td>
<td style="text-align:center;">
17,339
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
moyenne groupe A
</td>
<td style="text-align:center;">
17,580
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
moyenne groupe B
</td>
<td style="text-align:center;">
12,257
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
moyenne groupe C
</td>
<td style="text-align:center;">
23,067
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance totale
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
424,663
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance intragroupe
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
11,228
</td>
<td style="text-align:right;">
21,537
</td>
<td style="text-align:right;">
13,993
</td>
</tr>
</tbody>
</table>
<p>Examinons un deuxième jeu de données fictives pour lequel le type de vélo utilisé n’aurait que peu d’effet sur la vitesse des cyclistes (tableau @ref(tab:aovfictive2)). D’emblée, les moyennes des trois groupes semblent très similaires (19,3, 17,9 et 18,7). Les valeurs des trois variances sont les suivantes :</p>
<ul>
<li>la <strong>variance totale</strong> (<em>VT</em>) est égale à <span class="math inline">\(\mbox{121,756}\)</span>.</li>
<li>la <strong>variance intergroupe</strong> (expliquée, <em>VE</em>) est égale à <span class="math inline">\(\mbox{5}\times(\mbox{19,300-18,528})^2+\mbox{7}\times(\mbox{17,871-18,528})^2+\mbox{6}\times(\mbox{18,650-18,528})^2 = \mbox{6,087}\)</span>.</li>
<li>la <strong>variance intragroupe</strong> (non expliquée, <em>VNE</em>) est égale à <span class="math inline">\(\mbox{9,140+50,254+56,275 = 115,669}\)</span>.</li>
</ul>
<p>Nous avons donc <span class="math inline">\(VT = Var_{inter} + Var_{intra}\)</span>, soit <span class="math inline">\(\mbox{121,756 = 6,087 + 115,669}\)</span> et <span class="math inline">\(\eta_2 = \mbox{6,087 / 121,756 = 0,05}\)</span>. Cela signale que 5 % de la variance de la vitesse des cyclistes est uniquement expliquée par le type de vélo utilisé.</p>
<table>
<caption>
(#tab:aovfictive2)Données fictives et calcul des trois variances (cas 2)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Type de vélo
</th>
<th style="text-align:center;">
km/h
</th>
<th style="text-align:right;">
<span class="math inline">\((y_{i}-\overline{y})^2\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\((y_{i}-\overline{y_{A}})^2\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\((y_{i}-\overline{y_{B}})^2\)</span>
</th>
<th style="text-align:right;">
<span class="math inline">\((y_{i}-\overline{y_{C}})^2\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A. personnel
</td>
<td style="text-align:center;">
17,500
</td>
<td style="text-align:right;">
1,056
</td>
<td style="text-align:right;">
3,24
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
A. personnel
</td>
<td style="text-align:center;">
19,000
</td>
<td style="text-align:right;">
0,223
</td>
<td style="text-align:right;">
0,09
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
A. personnel
</td>
<td style="text-align:center;">
19,700
</td>
<td style="text-align:right;">
1,374
</td>
<td style="text-align:right;">
0,16
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
A. personnel
</td>
<td style="text-align:center;">
18,700
</td>
<td style="text-align:right;">
0,030
</td>
<td style="text-align:right;">
0,36
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
A. personnel
</td>
<td style="text-align:center;">
21,600
</td>
<td style="text-align:right;">
9,439
</td>
<td style="text-align:right;">
5,29
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
13,700
</td>
<td style="text-align:right;">
23,307
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
17,401
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
20,800
</td>
<td style="text-align:right;">
5,163
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
8,577
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
15,100
</td>
<td style="text-align:right;">
11,750
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
7,681
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
18,800
</td>
<td style="text-align:right;">
0,074
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,862
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
21,500
</td>
<td style="text-align:right;">
8,834
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
13,167
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
16,500
</td>
<td style="text-align:right;">
4,112
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
1,881
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
B. libre-service
</td>
<td style="text-align:center;">
18,700
</td>
<td style="text-align:right;">
0,030
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,687
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
16,600
</td>
<td style="text-align:right;">
3,716
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
4,203
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
16,300
</td>
<td style="text-align:right;">
4,963
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
5,523
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
15,600
</td>
<td style="text-align:right;">
8,572
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
9,303
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
20,000
</td>
<td style="text-align:right;">
2,167
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
1,822
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
24,600
</td>
<td style="text-align:right;">
36,872
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
35,402
</td>
</tr>
<tr>
<td style="text-align:left;">
C. électrique
</td>
<td style="text-align:center;">
18,800
</td>
<td style="text-align:right;">
0,074
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
0,022
</td>
</tr>
<tr>
<td style="text-align:left;">
grande moyenne
</td>
<td style="text-align:center;">
18,528
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
moyenne groupe A
</td>
<td style="text-align:center;">
19,300
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
moyenne groupe B
</td>
<td style="text-align:center;">
17,871
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
moyenne groupe C
</td>
<td style="text-align:center;">
18,650
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance totale
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
121,756
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance intragroupe
</td>
<td style="text-align:center;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
9,14
</td>
<td style="text-align:right;">
50,254
</td>
<td style="text-align:right;">
56,275
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect06212" class="section level4">
<h4><span class="header-section-number">6.2.1.2</span> Test de Fisher</h4>
<p>Pour vérifier si les moyennes sont statistiquement différentes (autrement dit, si leur différence est significativement différente de 0), nous avons recours au test <em>F</em> de Fisher. Pour ce faire, nous posons l’hypothèse nulle (<em>H<sub>0</sub></em>), soit que les moyennes des groupes sont égales; autrement dit que la variable qualitative n’a pas d’effet sur la variable continue (indépendance entre les deux variables). L’hypothèse alternative (<em>H<sub>1</sub></em>) est donc que les moyennes sont différentes. Pour nos deux jeux de données fictives ci-dessus comprenant trois groupes, <em>H<sub>0</sub></em> signifie que <span class="math inline">\(\overline{y_{A}}=\overline{y_{B}}=\overline{y_{C}}\)</span>. La statistique <em>F</em> se calcule comme suit :</p>

<p><span class="math display">\[\begin{equation}
F = \frac{\frac{Var{inter}}{k-1}}{\frac{Var{intra}}{n-k}}\mbox{ ou } F = \frac{\frac{VE}{k-1}}{\frac{VNE}{n-k}}
(\#eq:anovaF)
\end{equation}\]</span>
</p>
<p>où <span class="math inline">\(n\)</span> et <span class="math inline">\(k\)</span> sont respectivement les nombres d’observations et de modalités de la variable qualitative. L’hypothèse nulle (les moyennes sont égales) est rejetée si la valeur du <em>F</em> calculé est supérieure à la valeur critique de la table <em>F</em> avec les degrés de liberté <em>(k-1, n-k)</em> et un seuil
<span class="math inline">\(\alpha\)</span> (<em>p</em>=0,05 habituellement) (voir la table des valeurs critiques de <em>F</em>, section @ref(annexe2)). Notez que nous utilisons rarement la table <em>F</em> puisqu’avec la fonction <code>aov</code>, nous obtenons directement la valeur <em>F</em> et celle de <em>p</em> qui lui est associée. Concrètement, si le test <em>F</em> est significatif (avec <em>p</em> &lt; 0,05), plus la valeur de <em>F</em> est élevée, plus la différence entre les moyennes est élevée.</p>
<p>Appliquons rapidement la démarche du test <em>F</em> à nos deux jeux de données fictives qui comprennent 3 modalités pour la variable qualitative et 18 observations. Avec <span class="math inline">\(\alpha\)</span> = 0,05, 2 degrés de liberté (3-1) au numérateur et 15 au dénominateur (18-3), la valeur critique de F est de 3,68. Nous en concluons alors que :</p>
<ul>
<li>pour le cas A, le <em>F</em> calculé est égal à <span class="math inline">\(\mbox{(377,904 / 2) / (46,758 / 15) = 60,62}\)</span>. Il est supérieur à la valeur <em>F</em> critique; les moyennes sont donc statistiquement différentes au seuil 0,05. Autrement dit, nous aurions eu moins de 5 % de chance d’obtenir un échantillon produisant ces résultats si en réalité la différence entre les moyennes était de 0.</li>
<li>pour le cas B, le <em>F</em> calculé est égal à <span class="math inline">\(\mbox{(6,087 / 2) / (115,669 / 15) = 0,39}\)</span>. Il est inférieur à la valeur <em>F</em> critique; les moyennes ne sont donc pas statistiquement différentes au seuil de 0,05.</li>
</ul>
</div>
<div id="sect06213" class="section level4">
<h4><span class="header-section-number">6.2.1.3</span> Conditions d’application de l’ANOVA et solutions de rechange</h4>
<p>Trois conditions d’application doivent être vérifiées avant d’effectuer une analyse de variance sur un jeu de données :</p>
<ul>
<li><p><strong>Normalité des groupes.</strong> Le test de Fisher repose sur le postulat que les échantillons (groupes) sont normalement distribués. Pour le vérifier, nous avons recours au test de normalité de Shapiro–Wilk (section @ref(sect025413)). Rappelez-vous toutefois que ce test est très restrictif, surtout pour de grands échantillons.</p></li>
<li><p><strong>Homoscédasticité</strong>. La variance dans les échantillons doit être la même (homogénéité des variances). Pour vérifier cette condition, nous utilisons les tests de Levene, de Bartlett ou de Breusch-Pagan.</p></li>
<li><p><strong>Indépendance des observations (pseudo-réplication).</strong> Chaque individu doit appartenir à un et un seul groupe. En d’autres termes, les observations ne sont pas indépendantes si plusieurs mesures (variable continue) sont faites sur un même individu. Si c’est le cas, nous utiliserons alors une analyse de variance sur des mesures répétées (voir le bloc à la fin du chapitre).</p></li>
</ul>
<p><strong>Quelles sont les conséquences si les conditions d’application ne sont pas respectées?</strong> La non-vérification des conditions d’application cause deux problèmes distincts : elle affecte la puissance du test (sa capacité à détecter un effet, si celui-ci existe réellement) et le taux d’erreur de type 1 (la probabilité de trouver un résultat significatif alors qu’aucune relation n’existe réellement, soit un faux-positif) <span class="citation">(Glass, Peckham et Sanders <a href="#ref-glass1972consequences" role="doc-biblioref">1972</a>; Lix, Keselman et Keselman <a href="#ref-lix1996consequences" role="doc-biblioref">1996</a>)</span>.</p>
<ul>
<li>Si la distribution est asymétrique plutôt que centrée (comme pour une distribution normale), la puissance et le taux d’erreur de type 1 sont tous les deux peu affectés, car le test est non orienté (la différence de moyennes peut être négative ou positive).</li>
<li>Si la distribution est leptocurtique (pointue, avec des extrémités de la distribution plus importantes), le taux d’erreur de type 1 est peu affecté; en revanche, la puissance du test est réduite. L’inverse s’observe si la distribution est platicurtique (aplatie, c’est-à-dire avec des extrémités de la distribution plus réduites.</li>
<li>Si les groupes ont des variances différentes, le taux d’erreur de type 1 augmente légèrement.</li>
<li>Si les observations ne sont pas indépendantes, à la fois le taux d’erreur de type 1 et la puissance du test sont fortement affectés.</li>
<li>Si les échantillons sont petits, les effets présentés ci-dessus sont démultipliés.</li>
<li>Si plusieurs conditions ne sont pas respectées, les conséquences présentées ci-dessus s’additionnent, voire se combinent.</li>
</ul>
<p><strong>Que faire quand les conditions d’application relatives à la normalité ou à l’homoscédasticité ne sont vraiment pas respectées?</strong> Signalons d’emblée que le non-respect de ces conditions ne change rien à la décomposition de la variance (<em>VT = V<sub>intra</sub>+V<sub>inter</sub></em>). Cela signifie que vous pouvez toujours calculer <em>Eta<sup>2</sup></em>. Par contre, le test de Fisher ne peut pas être utilisé, car il est biaisé comme décrit précédemment. Quatre solutions sont envisageables :</p>
<ul>
<li><p>Lorsque les échantillons sont fortement anormalement distribués, certains auteurs vont simplement transformer leur variable en appliquant une fonction logarithme (le plus souvent) ou racine carrée, inverse ou exponentielle, et reporter le test de Fisher calculé sur cette transformation. Attention toutefois! Transformer une variable ne va pas systématiquement la rapprocher d’une distribution normale et complique l’interprétation finale des résultats. Par conséquent, avant de recalculer votre test <em>F</em>, il convient de réaliser un test de normalité de Shapiro–Wilk et un test d’homoscédasticité (Levene, Bartlett ou Breusch-Pagan) sur la variable continue transformée.</p></li>
<li><p>Détecter les observations qui contribuent le plus à l’anormalité et à l’hétéroscédasticité (valeurs aberrantes ou extrêmes). Supprimez-les et refaites votre ANOVA en vous assurant que les conditions sont désormais respectées. Notez que supprimer des observations peut être une pratique éthiquement questionnable en statistique. Si vos échantillons sont bien constitués et que la mesure collectée n’est pas erronée, pourquoi donc la supprimer? Si vous optez pour cette solution, prenez soin de comparer les résultats avant et après la suppression des observations. Si les conditions sont respectées après la suppression et que les résultats de l’ANOVA (<em>Eta<sup>2</sup></em> et test <em>F</em> de Fisher) sont très semblables, conservez donc les résultats de l’ANOVA initiale et signalez que vous avez procédé aux deux tests.</p></li>
<li><p>Lorsque les variances des groupes sont dissemblables, vous pouvez utiliser le test de Welch pour l’ANOVA au lieu du test <em>F</em> de Fisher.</p></li>
<li><p>Dernière solution, lorsque les deux conditions ne sont vraiment pas respectées, utilisez le test non paramétrique de Kruskal-Wallis. Par analogie au <em>t</em> de Student, il correspond au test des rangs signés de Wilcoxon. Ce test est décrit dans la section suivante.</p></li>
</ul>
<p>Vous l’aurez compris, dans de nombreux cas en statistique, les choix méthodologiques dépendent en partie de la subjectivité des chercheur(e)s. Il faut s’adapter au jeu de données et à la culture statistique en vigueur dans votre champ d’études. N’hésitez pas à réaliser plusieurs tests différents pour évaluer la robustesse de vos conclusions et fiez-vous en premier lieu à ceux pour lesquels votre jeu de données est le plus adapté.</p>
</div>
</div>
<div id="sect0622" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Test non paramétrique de Kruskal-Wallis</h3>
<p>Le test non paramétrique de Kruskal-Wallis est une solution de rechange à l’ANOVA classique lorsque le jeu de données présente de graves problèmes de normalité et d’hétéroscédasticité. Cette méthode représente une ANOVA appliquée à une variable continue transformée préalablement en rangs. Du fait de la transformation en rangs, nous ne vérifions plus si les moyennes sont différentes, mais bel et bien si les médianes de la variable continue sont différentes. Pour ce faire, nous utiliserons la fonction <code>kruskal.test</code>.</p>
</div>
<div id="sect0623" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Mise en œuvre dans R</h3>
<p>Dans une étude récente, Apparicio <em>et al.</em> <span class="citation">(<a href="#ref-apparicio2018exposure" role="doc-biblioref">2018</a><a href="#ref-apparicio2018exposure" role="doc-biblioref">b</a>)</span> ont comparé les expositions au bruit et à la pollution atmosphérique aux heures de pointe à Montréal en fonction du mode de transport utilisé. Pour ce faire, trois équipes de trois personnes ont été constituées : une personne à vélo, une autre en automobile et une dernière se déplaçant en transport en commun, équipées de capteurs de pollution, de sonomètres, de vêtements biométriques et d’une montre GPS. Chaque matin, à huit heures précises, les membres de chaque équipe ont réalisé un trajet d’un quartier périphérique de Montréal vers un pôle d’enseignement (université) ou d’emploi localisé au centre-ville. Le trajet inverse était réalisé le soir à 17 h. Au total, une centaine de trajets ont ainsi été réalisés. Des analyses de variance ont ainsi permis de comparer les trois modes (automobile, vélo et transport en commun) en fonction des temps de déplacement, des niveaux d’exposition au bruit, des niveaux d’exposition au dioxyde d’azote et de la dose totale inhalée de dioxyde d’azote. Nous vous proposons ici d’analyser une partie de ces données.</p>
<div id="sect06231" class="section level4">
<h4><span class="header-section-number">6.2.3.1</span> Première ANOVA : différences entre les temps de déplacement</h4>
<p>Comme première analyse de variance, nous vérifions si les moyennes des temps de déplacement sont différentes entre les trois modes de transport.</p>
<p>Dans un premier temps, nous calculons les moyennes des différents groupes. Nous pouvons alors constater que les moyennes sont très semblables : 37,7 minutes pour l’automobile versus 38,4 et 41,6 pour le vélo et le transport en commun. Aussi, les variances des trois groupes sont relativement similaires.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="#cb599-1"></a><span class="kw">library</span>(<span class="st">&quot;rstatix&quot;</span>)</span>
<span id="cb599-2"><a href="#cb599-2"></a><span class="co"># chargement des DataFrames</span></span>
<span id="cb599-3"><a href="#cb599-3"></a><span class="kw">load</span>(<span class="st">&quot;data/bivariee/dataPollution.RData&quot;</span>)</span>
<span id="cb599-4"><a href="#cb599-4"></a><span class="co"># Statistiques descriptives pour les groupes (moyenne et écart-type)</span></span>
<span id="cb599-5"><a href="#cb599-5"></a>df_TrajetsDuree <span class="op">%&gt;%</span><span class="st">                                 </span><span class="co"># Nom du DataFrame</span></span>
<span id="cb599-6"><a href="#cb599-6"></a><span class="st">    </span><span class="kw">group_by</span>(Mode) <span class="op">%&gt;%</span><span class="st">                                </span><span class="co"># Variable qualitative</span></span>
<span id="cb599-7"><a href="#cb599-7"></a><span class="st">    </span><span class="kw">get_summary_stats</span>(DureeMinute, <span class="dt">type =</span> <span class="st">&quot;mean_sd&quot;</span>)  <span class="co"># Variable continue </span></span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   Mode    variable        n  mean    sd
##   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 1. Auto DureeMinute    33  37.7  12.8
## 2 2. Velo DureeMinute    33  38.4  15.2
## 3 3. TC   DureeMinute    33  41.6  11.4</code></pre>
<p>Pour visualiser la distribution des données pour les trois groupes, vous pouvez créer des graphiques de densité et en violon (figure @ref(fig:figAnova1a)). La juxtaposition des trois distributions montre que les distributions des valeurs pour les trois groupes sont globalement similaires. Cela est corroboré par le fait que les boîtes du graphique en violon sont situées à la même hauteur. Autrement dit, à la lecture des deux graphiques, il ne semble pas y avoir de différences significatives entre les trois groupes en termes de temps de déplacement.</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="#cb601-1"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb601-2"><a href="#cb601-2"></a><span class="kw">library</span>(<span class="st">&quot;ggpubr&quot;</span>)</span>
<span id="cb601-3"><a href="#cb601-3"></a><span class="co"># Graphique de densité</span></span>
<span id="cb601-4"><a href="#cb601-4"></a>GraphDens &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df_TrajetsDuree, </span>
<span id="cb601-5"><a href="#cb601-5"></a>  <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>DureeMinute,<span class="dt">colour=</span>Mode,<span class="dt">fill=</span>Mode)) <span class="op">+</span></span>
<span id="cb601-6"><a href="#cb601-6"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha=</span><span class="fl">0.55</span>,<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">y=</span>..scaled..))<span class="op">+</span></span>
<span id="cb601-7"><a href="#cb601-7"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;a. Graphique de densité&quot;</span>,</span>
<span id="cb601-8"><a href="#cb601-8"></a>         <span class="dt">x =</span> <span class="st">&quot;Densité&quot;</span>,</span>
<span id="cb601-9"><a href="#cb601-9"></a>         <span class="dt">y =</span> <span class="st">&quot;Durée du trajet (en minutes)&quot;</span>)</span>
<span id="cb601-10"><a href="#cb601-10"></a><span class="co"># Graphique en violon</span></span>
<span id="cb601-11"><a href="#cb601-11"></a>GraphViolon &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_TrajetsDuree, <span class="kw">aes</span>(<span class="dt">x=</span>Mode, <span class="dt">y=</span>DureeMinute)) <span class="op">+</span></span>
<span id="cb601-12"><a href="#cb601-12"></a><span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb601-13"><a href="#cb601-13"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">width=</span><span class="fl">0.1</span>, <span class="kw">aes</span>(<span class="dt">x=</span>Mode, <span class="dt">y=</span>DureeMinute,<span class="dt">fill=</span>Mode))<span class="op">+</span></span>
<span id="cb601-14"><a href="#cb601-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;b. Graphique en violon&quot;</span>,</span>
<span id="cb601-15"><a href="#cb601-15"></a>       <span class="dt">x =</span> <span class="st">&quot;Mode de transport&quot;</span>,</span>
<span id="cb601-16"><a href="#cb601-16"></a>       <span class="dt">y =</span> <span class="st">&quot;Durée du trajet (en minutes)&quot;</span>)<span class="op">+</span></span>
<span id="cb601-17"><a href="#cb601-17"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb601-18"><a href="#cb601-18"></a><span class="kw">ggarrange</span>(GraphDens, GraphViolon)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figAnova1a-1.png" alt="Graphiques de densité et en violon" width="75%" />
<p class="caption">
(#fig:figAnova1a)Graphiques de densité et en violon
</p>
</div>
<p>Nous pouvons vérifier si les échantillons sont normalement distribués avec la fonction <code>shapiro_test</code> du package <code>rstatix</code>. À titre de rappel, l’hypothèse nulle (<em>H<sub>0</sub></em>) de ce test est que la distribution est normale. Par conséquent, quand la valeur de <em>p</em> associée à la statistique de Shapiro est supérieure à 0,05, alors nous ne pouvons rejeter l’hypothèse d’une distribution normale (autrement dit, la distribution est anormale). À la lecture des résultats ci-dessous, seul le groupe utilisant le transport en commun présente une distribution proche de la normalité (<em>p</em> = 0,0504). Ce test étant très restrictif, il est fortement conseillé de visualiser le diagramme quantile-quantile pour chaque groupe (graphique QQ plot) (figure @ref(fig:figQqplot)). Ces graphiques sont utilisés pour déterminer visuellement si une distribution empirique (observée sur des données), s’approche d’une distribution théorique (ici la loi normale). Si effectivement les deux distributions sont proches, les points du diagramme devraient tous tomber sur une ligne droite parfaite. Un intervalle de confiance (représenté ici en gris) peut être construit pour obtenir une interprétation plus nuancée. Dans notre cas, seules deux observations pour le vélo et deux autres pour l’automobile s’éloignent vraiment de la ligne droite. Nous pouvons considérer que ces trois distributions s’approchent d’une distribution normale.</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="#cb602-1"></a><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb602-2"><a href="#cb602-2"></a><span class="kw">library</span>(<span class="st">&quot;ggpubr&quot;</span>)</span>
<span id="cb602-3"><a href="#cb602-3"></a><span class="kw">library</span>(<span class="st">&quot;rstatix&quot;</span>)</span>
<span id="cb602-4"><a href="#cb602-4"></a><span class="co"># Condition 1 : normalité des échantillons</span></span>
<span id="cb602-5"><a href="#cb602-5"></a><span class="co"># Test pour la normalité des échantillons (groupes) : test de Shapiro</span></span>
<span id="cb602-6"><a href="#cb602-6"></a> df_TrajetsDuree <span class="op">%&gt;%</span><span class="st">          </span><span class="co"># Nom du DataFrame</span></span>
<span id="cb602-7"><a href="#cb602-7"></a><span class="st">   </span><span class="kw">group_by</span>(Mode) <span class="op">%&gt;%</span><span class="st">         </span><span class="co"># Variable qualitative</span></span>
<span id="cb602-8"><a href="#cb602-8"></a><span class="st">   </span><span class="kw">shapiro_test</span>(DureeMinute)  <span class="co"># Variable continue </span></span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   Mode    variable    statistic         p
##   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;
## 1 1. Auto DureeMinute     0.905 0.00729  
## 2 2. Velo DureeMinute     0.797 0.0000288
## 3 3. TC   DureeMinute     0.936 0.0504</code></pre>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="#cb604-1"></a><span class="co"># Graphiques qqplot pour les groupes</span></span>
<span id="cb604-2"><a href="#cb604-2"></a><span class="kw">ggqqplot</span>(df_TrajetsDuree, <span class="st">&quot;DureeMinute&quot;</span>, <span class="dt">facet.by =</span> <span class="st">&quot;Mode&quot;</span>, </span>
<span id="cb604-3"><a href="#cb604-3"></a>         <span class="dt">xlab=</span><span class="st">&quot;Théorique&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Échantillon&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figQqplot-1.png" alt="QQ Plot pour les groupes" width="75%" />
<p class="caption">
(#fig:figQqplot)QQ Plot pour les groupes
</p>
</div>
<p>Pour vérifier l’hypothèse d’homogénéité des variances, vous pouvez utiliser les tests de Levene, de Bartlett ou de Breusch-Pagan. Les valeurs de <em>p</em>, toutes supérieures à 0,05, signalent que la condition d’homogénéité des variances est respectée.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="#cb605-1"></a><span class="kw">library</span>(<span class="st">&quot;rstatix&quot;</span>)</span>
<span id="cb605-2"><a href="#cb605-2"></a><span class="kw">library</span>(<span class="st">&quot;lmtest&quot;</span>)</span>
<span id="cb605-3"><a href="#cb605-3"></a><span class="kw">library</span>(<span class="st">&quot;car&quot;</span>)</span>
<span id="cb605-4"><a href="#cb605-4"></a><span class="co"># Condition 2 : homogénéité des variances (homocédasticité)</span></span>
<span id="cb605-5"><a href="#cb605-5"></a><span class="kw">leveneTest</span>(DureeMinute <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_TrajetsDuree)</span></code></pre></div>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##       Df F value Pr(&gt;F)
## group  2  0.2418 0.7857
##       96</code></pre>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="#cb607-1"></a><span class="kw">bartlett.test</span>(DureeMinute <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_TrajetsDuree)</span></code></pre></div>
<pre><code>## 
##  Bartlett test of homogeneity of variances
## 
## data:  DureeMinute by Mode
## Bartlett&#39;s K-squared = 2.6718, df = 2, p-value = 0.2629</code></pre>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="#cb609-1"></a><span class="kw">bptest</span>(DureeMinute <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_TrajetsDuree)</span></code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  DureeMinute ~ Mode
## BP = 1.3322, df = 2, p-value = 0.5137</code></pre>
<p>Deux fonctions peuvent être utilisées pour calculer l’analyse de variance : la fonction de base <code>aov(variable continue ~ variable qualitative, data = votre DataFrame)</code> ou bien la fonction <code>anova_test(variable continue ~ variable qualitative, data = votre DataFrame)</code> du package <code>rstatix</code>. Comparativement à <code>aov</code>, l’avantage de la fonction <code>anova_test</code> est qu’elle calcule aussi le <em>Eta<sup>2</sup></em>.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="#cb611-1"></a><span class="kw">library</span>(<span class="st">&quot;rstatix&quot;</span>)</span>
<span id="cb611-2"><a href="#cb611-2"></a><span class="kw">library</span>(<span class="st">&quot;car&quot;</span>)</span>
<span id="cb611-3"><a href="#cb611-3"></a><span class="kw">library</span>(<span class="st">&quot;effectsize&quot;</span>)</span>
<span id="cb611-4"><a href="#cb611-4"></a><span class="co"># ANOVA avec la fonction aov</span></span>
<span id="cb611-5"><a href="#cb611-5"></a>aov1 &lt;-<span class="st"> </span><span class="kw">aov</span>(DureeMinute <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_TrajetsDuree)</span>
<span id="cb611-6"><a href="#cb611-6"></a><span class="kw">summary</span>(aov1)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value Pr(&gt;F)
## Mode         2    287   143.2    0.82  0.444
## Residuals   96  16781   174.8</code></pre>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="#cb613-1"></a><span class="co"># calcul de Eta2 avec la fonction eta_squared du package effectsize</span></span>
<span id="cb613-2"><a href="#cb613-2"></a>effectsize<span class="op">::</span><span class="kw">eta_squared</span>(aov1)</span></code></pre></div>
<pre><code>## Parameter | Eta2 |       90% CI
## -------------------------------
## Mode      | 0.02 | [0.00, 0.07]</code></pre>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="#cb615-1"></a><span class="co"># ANOVA avec la fonction anova_test du package rstatix</span></span>
<span id="cb615-2"><a href="#cb615-2"></a><span class="kw">anova_test</span>(DureeMinute <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_TrajetsDuree)</span></code></pre></div>
<pre><code>## ANOVA Table (type II tests)
## 
##   Effect DFn DFd    F     p p&lt;.05   ges
## 1   Mode   2  96 0.82 0.444       0.017</code></pre>
<p>La valeur de <em>p</em> associée à la statistique <em>F</em> (0,444) nous permet de conclure qu’il n’y a pas de différences significatives entre les moyennes des temps de déplacement des trois modes de transport.</p>
</div>
<div id="sect06232" class="section level4">
<h4><span class="header-section-number">6.2.3.2</span> Deuxième ANOVA : différences entre les niveaux d’exposition au bruit</h4>
<p>Dans ce second exercice, nous analysons les différences d’exposition au bruit. D’emblée, les statistiques descriptives révèlent que les moyennes sont dissemblables : 66,8 dB(A) pour l’automobile versus 68,8 et 74 pour le vélo et le transport en commun. Aussi, la variance du transport en commun est très différente des autres.</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="#cb617-1"></a><span class="kw">library</span>(<span class="st">&quot;rstatix&quot;</span>)</span>
<span id="cb617-2"><a href="#cb617-2"></a><span class="co"># chargement des DataFrames</span></span>
<span id="cb617-3"><a href="#cb617-3"></a><span class="kw">load</span>(<span class="st">&quot;data/bivariee/dataPollution.RData&quot;</span>)</span>
<span id="cb617-4"><a href="#cb617-4"></a><span class="co"># Statistiques descriptives pour les groupes (moyenne et écart-type)</span></span>
<span id="cb617-5"><a href="#cb617-5"></a> df_Bruit <span class="op">%&gt;%</span><span class="st">                                 </span><span class="co"># Nom du DataFrame</span></span>
<span id="cb617-6"><a href="#cb617-6"></a><span class="st">   </span><span class="kw">group_by</span>(Mode) <span class="op">%&gt;%</span><span class="st">                                </span><span class="co"># Variable qualitative</span></span>
<span id="cb617-7"><a href="#cb617-7"></a><span class="st">   </span><span class="kw">get_summary_stats</span>(laeq, <span class="dt">type =</span> <span class="st">&quot;mean_sd&quot;</span>)  <span class="co"># Variable continue </span></span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   Mode    variable     n  mean    sd
##   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 1. Auto laeq      1094  66.8  4.56
## 2 2. Velo laeq      1124  68.8  4.29
## 3 3. TC   laeq      1207  74.0  6.79</code></pre>
<p>À la lecture des graphiques de densité et en violon (figure @ref(fig:figAnova1b)), il semble clair que les niveaux d’exposition au bruit sont plus faibles pour les automobilistes et plus élevés pour les cyclistes et surtout les personnes en transport en commun. En outre, la distribution des valeurs d’exposition au bruit dans le transport en commun semble bimodale. Cela s’explique par le fait que les niveaux de bruit sont beaucoup plus élevés dans le métro que dans les autobus.</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="#cb619-1"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb619-2"><a href="#cb619-2"></a><span class="kw">library</span>(<span class="st">&quot;ggpubr&quot;</span>)</span>
<span id="cb619-3"><a href="#cb619-3"></a><span class="co"># Graphique en densité</span></span>
<span id="cb619-4"><a href="#cb619-4"></a>GraphDens &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df_Bruit, </span>
<span id="cb619-5"><a href="#cb619-5"></a>  <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>laeq,<span class="dt">colour=</span>Mode,<span class="dt">fill=</span>Mode)) <span class="op">+</span></span>
<span id="cb619-6"><a href="#cb619-6"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha=</span><span class="fl">0.55</span>,<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">y=</span>..scaled..))<span class="op">+</span></span>
<span id="cb619-7"><a href="#cb619-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;a. graphique de densité&quot;</span>,</span>
<span id="cb619-8"><a href="#cb619-8"></a>       <span class="dt">x=</span><span class="st">&quot;Exposition au bruit (dB(A))&quot;</span>)</span>
<span id="cb619-9"><a href="#cb619-9"></a><span class="co"># Graphique en violon</span></span>
<span id="cb619-10"><a href="#cb619-10"></a>GraphViolon &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_Bruit, <span class="kw">aes</span>(<span class="dt">x=</span>Mode, <span class="dt">y=</span>laeq)) <span class="op">+</span></span>
<span id="cb619-11"><a href="#cb619-11"></a><span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb619-12"><a href="#cb619-12"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">width=</span><span class="fl">0.1</span>, <span class="kw">aes</span>(<span class="dt">x=</span>Mode, <span class="dt">y=</span>laeq,<span class="dt">fill=</span>Mode))<span class="op">+</span></span>
<span id="cb619-13"><a href="#cb619-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;b. Graphique en violon&quot;</span>,</span>
<span id="cb619-14"><a href="#cb619-14"></a>       <span class="dt">x =</span> <span class="st">&quot;Mode de transport&quot;</span>,</span>
<span id="cb619-15"><a href="#cb619-15"></a>       <span class="dt">y=</span><span class="st">&quot;Exposition au bruit (dB(A))&quot;</span>)<span class="op">+</span></span>
<span id="cb619-16"><a href="#cb619-16"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb619-17"><a href="#cb619-17"></a><span class="kw">ggarrange</span>(GraphDens, GraphViolon)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figAnova1b-1.png" alt="Graphique de densité et en violon" width="75%" />
<p class="caption">
(#fig:figAnova1b)Graphique de densité et en violon
</p>
</div>
<p>Le test de Shapiro et les graphiques QQ plot (figure @ref(fig:figQqplot2)) révèlent que les distributions des trois groupes sont anormales. Ce résultat n’est pas surprenant si l’on tient compte de la nature logarithmique de l’échelle décibel.</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="#cb620-1"></a><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb620-2"><a href="#cb620-2"></a><span class="kw">library</span>(<span class="st">&quot;ggpubr&quot;</span>)</span>
<span id="cb620-3"><a href="#cb620-3"></a><span class="kw">library</span>(<span class="st">&quot;rstatix&quot;</span>)</span>
<span id="cb620-4"><a href="#cb620-4"></a><span class="co"># Condition 1 : normalité des échantillons</span></span>
<span id="cb620-5"><a href="#cb620-5"></a><span class="co"># Test pour la normalité des échantillons (groupes) : test de Shapiro</span></span>
<span id="cb620-6"><a href="#cb620-6"></a>df_Bruit <span class="op">%&gt;%</span><span class="st">          </span><span class="co"># Nom du DataFrame</span></span>
<span id="cb620-7"><a href="#cb620-7"></a><span class="st">  </span><span class="kw">group_by</span>(Mode) <span class="op">%&gt;%</span><span class="st">         </span><span class="co"># Variable qualitative</span></span>
<span id="cb620-8"><a href="#cb620-8"></a><span class="st">  </span><span class="kw">shapiro_test</span>(laeq)  <span class="co"># Variable continue </span></span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   Mode    variable statistic        p
##   &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;
## 1 1. Auto laeq         0.971 4.92e-14
## 2 2. Velo laeq         0.992 5.12e- 6
## 3 3. TC   laeq         0.966 3.34e-16</code></pre>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="#cb622-1"></a><span class="co"># Graphiques qqplot pour les groupes</span></span>
<span id="cb622-2"><a href="#cb622-2"></a><span class="kw">ggqqplot</span>(df_Bruit, <span class="st">&quot;laeq&quot;</span>, <span class="dt">facet.by =</span> <span class="st">&quot;Mode&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Théorique&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Échantillon&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figQqplot2-1.png" alt="QQ Plot pour les groupes" width="75%" />
<p class="caption">
(#fig:figQqplot2)QQ Plot pour les groupes
</p>
</div>
<p>En outre, selon les valeurs des tests de Levene, de Bartlett ou de Breusch-Pagan, les variances ne sont pas égales.</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="#cb623-1"></a><span class="kw">library</span>(<span class="st">&quot;rstatix&quot;</span>)</span>
<span id="cb623-2"><a href="#cb623-2"></a><span class="kw">library</span>(<span class="st">&quot;lmtest&quot;</span>)</span>
<span id="cb623-3"><a href="#cb623-3"></a><span class="kw">library</span>(<span class="st">&quot;car&quot;</span>)</span>
<span id="cb623-4"><a href="#cb623-4"></a><span class="co"># Condition 2 : homogénéité des variances (homocédasticité)</span></span>
<span id="cb623-5"><a href="#cb623-5"></a><span class="kw">leveneTest</span>(laeq <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_Bruit)</span></code></pre></div>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##         Df F value    Pr(&gt;F)    
## group    2   190.3 &lt; 2.2e-16 ***
##       3422                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="#cb625-1"></a><span class="kw">bartlett.test</span>(laeq <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_Bruit)</span></code></pre></div>
<pre><code>## 
##  Bartlett test of homogeneity of variances
## 
## data:  laeq by Mode
## Bartlett&#39;s K-squared = 306.64, df = 2, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="#cb627-1"></a><span class="kw">bptest</span>(laeq <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_Bruit)</span></code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  laeq ~ Mode
## BP = 279.85, df = 2, p-value &lt; 2.2e-16</code></pre>
<p>Étant donné que les deux conditions (normalité et homogénéité des variances) ne sont pas respectées, il est préférable d’utiliser un test non paramétrique de Kruskal-Wallis. Calculons toutefois préalablement l’ANOVA classique et l’ANOVA de Welch puisque les variances ne sont pas égales. Les valeurs de <em>p</em> des deux tests (Fisher et Welch) signalent que les moyennes d’exposition au bruit sont statistiquement différentes entre les trois modes de transport.</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="#cb629-1"></a><span class="kw">library</span>(<span class="st">&quot;rstatix&quot;</span>)</span>
<span id="cb629-2"><a href="#cb629-2"></a><span class="co"># ANOVA avec la fonction anova_test du package rstatix</span></span>
<span id="cb629-3"><a href="#cb629-3"></a><span class="kw">anova_test</span>(laeq <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_Bruit)</span></code></pre></div>
<pre><code>## ANOVA Table (type II tests)
## 
##   Effect DFn  DFd       F         p p&lt;.05   ges
## 1   Mode   2 3422 544.214 6.12e-206     * 0.241</code></pre>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="#cb631-1"></a><span class="co"># ANOVA avec le test de Welch puisque les variances ne sont pas égales</span></span>
<span id="cb631-2"><a href="#cb631-2"></a><span class="kw">welch_anova_test</span>(laeq <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_Bruit)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   .y.       n statistic   DFn   DFd         p method     
## * &lt;chr&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      
## 1 laeq   3425      446.     2 2248. 9.47e-164 Welch ANOVA</code></pre>
<p>Une fois démontré que les moyennes sont différentes, le test de Tukey est particulièrement intéressant puisqu’il nous permet de repérer les différences de moyennes significatives deux à deux, tout en ajustant les valeurs de <em>p</em> obtenues en fonction du nombre de comparaisons effectuées. Ci-dessous, nous constatons que toutes les paires sont statistiquement différentes et que la différence de moyennes entre les automobilistes et les cyclistes est de 1,9 dB(A) et surtout de 7,1 dB(A) entre les automobilistes et les personnes ayant pris le transport en commun.</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="#cb633-1"></a>aov2 &lt;-<span class="st"> </span><span class="kw">aov</span>(laeq <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_Bruit)</span>
<span id="cb633-2"><a href="#cb633-2"></a><span class="co"># Test de Tukey pour comparer les moyennes entre elles</span></span>
<span id="cb633-3"><a href="#cb633-3"></a><span class="kw">TukeyHSD</span>(aov2, <span class="dt">conf.level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = laeq ~ Mode, data = df_Bruit)
## 
## $Mode
##                     diff      lwr      upr p adj
## 2. Velo-1. Auto 1.941698 1.406343 2.477053     0
## 3. TC-1. Auto   7.113506 6.587309 7.639703     0
## 3. TC-2. Velo   5.171808 4.649307 5.694309     0</code></pre>
<p>Le calcul du test non paramétrique de Kruskal-Wallis avec la fonction <code>kruskal.test</code> démontre aussi que les médianes des groupes sont différentes (<em>p</em> &lt; 0,001). De manière comparable au test de Tukey, la fonction <code>pairwise.wilcox.test</code> permet aussi de repérer les différences significatives entre les paires de groupes. Pour conclure, tant l’ANOVA que le test non paramétrique de Kruskal-Wallis indiquent que les trois modes de transport sont significativement différents quant à l’exposition au bruit, avec des valeurs plus faibles pour les automobilistes comparativement aux cyclistes et aux personnes ayant pris le transport en commun.</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="#cb635-1"></a><span class="co"># Test de Kruskal-Wallis</span></span>
<span id="cb635-2"><a href="#cb635-2"></a><span class="kw">kruskal.test</span>(laeq <span class="op">~</span><span class="st"> </span>Mode, <span class="dt">data =</span> df_Bruit)</span></code></pre></div>
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  laeq by Mode
## Kruskal-Wallis chi-squared = 784.74, df = 2, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="#cb637-1"></a><span class="co"># Calcul de la moyenne des rangs pour les trois groupes</span></span>
<span id="cb637-2"><a href="#cb637-2"></a>df_Bruit<span class="op">$</span>laeqRank &lt;-<span class="st"> </span><span class="kw">rank</span>(df_Bruit<span class="op">$</span>laeq)</span>
<span id="cb637-3"><a href="#cb637-3"></a>df_Bruit <span class="op">%&gt;%</span></span>
<span id="cb637-4"><a href="#cb637-4"></a><span class="st">  </span><span class="kw">group_by</span>(Mode) <span class="op">%&gt;%</span></span>
<span id="cb637-5"><a href="#cb637-5"></a><span class="st">  </span><span class="kw">get_summary_stats</span>(laeqRank, <span class="dt">type =</span> <span class="st">&quot;mean&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   Mode    variable     n  mean
##   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1 1. Auto laeqRank  1094 1188.
## 2 2. Velo laeqRank  1124 1572.
## 3 3. TC   laeqRank  1207 2320.</code></pre>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="#cb639-1"></a><span class="co"># Comparaison des groupes avec la fonction pairwise.wilcox.test</span></span>
<span id="cb639-2"><a href="#cb639-2"></a><span class="kw">pairwise.wilcox.test</span>(df_Bruit<span class="op">$</span>laeq, df_Bruit<span class="op">$</span>Mode, <span class="dt">p.adjust.method =</span> <span class="st">&quot;BH&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Pairwise comparisons using Wilcoxon rank sum test with continuity correction 
## 
## data:  df_Bruit$laeq and df_Bruit$Mode 
## 
##         1. Auto 2. Velo
## 2. Velo &lt;2e-16  -      
## 3. TC   &lt;2e-16  &lt;2e-16 
## 
## P value adjustment method: BH</code></pre>
</div>
</div>
<div id="sect0624" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Comment rapporter les résultats d’une ANOVA et du test de Kruskal-Wallis</h3>
<p>Plusieurs éléments doivent être reportés pour détailler les résultats d’une ANOVA ou d’un test de Kruskal-Wallis : la valeur de <em>F</em>, de <em>W</em> (dans le cas d’une ANOVA de Welch) ou du χ2 (Kruskal-Wallis), les valeurs de <em>p</em>, les moyennes ou médianes respectives des groupes et éventuellement un tableau détaillant les écarts intergroupes obtenus avec les tests de Tukey ou Wilcoxon par paires.</p>
<ul>
<li><p>Les résultats de l’analyse de variance à un facteur démontrent que le mode de transport utilisé n’a pas d’effet significatif sur le temps de déplacement en heures de pointe à Montréal (<em>F</em>(2,96) = 0,82, <em>p</em> = 0,444). En effet, pour des trajets de dix kilomètres entre un quartier périphérique et le centre-ville, les cyclistes (Moy = 38,4, ET = 15,2) arrivent en moyenne moins d’une minute après les automobilistes (Moy = 37,7, ET = 12,8) et moins de quatre minutes comparativement aux personnes ayant pris le transport en commun (Moy = 41,6, ET = 11,4).</p></li>
<li><p>Les résultats de l’analyse de variance à un facteur démontrent que le mode de transport utilisé a un impact significatif sur le niveau d’exposition en heures de pointe à Montréal (<em>F</em>(2,96) = 544, <em>p</em> &lt; 0,001 et <em>Welch</em>(2,96) = 446, <em>p</em> &lt; 0,001). En effet, les personnes en transport en commun (Moy = 74,0, ET = 6,79) et les cyclistes (Moy = 68,8, ET = 4,3) ont des niveaux d’exposition au bruit significativement plus élevés que les automobilistes (Moy = 66,8, ET = 4,56).</p></li>
<li><p>Les résultats du test de Kruskal-Wallis démontrent qu’il existe des différences significatives d’exposition au bruit entre les trois modes de transport (χ2(2) = 784,74, <em>p</em> &lt; 0,001) avec des moyennes de rangs de 1094 pour l’automobile, de 1124 pour le vélo et de 1207 pour le transport en commun.</p></li>
</ul>
<div class="bloc_aller_loin">
<p>Nous avons vu que l’ANOVA permet de comparer les moyennes d’une variable continue à partir d’une variable qualitative comprenant plusieurs modalités (facteur) pour des observations indépendantes. Il y a donc une seule variable dépendante (continue) et une seule variable indépendante. Sachez qu’il existe de nombreuses extensions de l’ANOVA classique :</p>
<ul>
<li><p><strong>une ANOVA à deux facteurs</strong>, soit avec une variable dépendante continue et deux variables indépendantes qualitatives (<em>two-way ANOVA</em> en anglais). Nous évaluons ainsi les effets des deux variables (<em>a</em>, <em>b</em>) et de leur interaction (<em>ab</em>) sur une variable continue.</p></li>
<li><p><strong>une ANOVA multifacteur</strong> avec une variable dépendante continue et plus de deux variables indépendantes qualitatives. Par exemple, avec trois variables qualitatives pour expliquer la variable continue, nous incluons les effets de chaque variable qualitative (<em>a</em>, <em>b</em>, <em>c</em>), ainsi que de leurs interactions (<em>ab</em>, <em>ac</em>, <em>bc</em>, <em>abc</em>).</p></li>
<li><p><strong>L’analyse de covariance</strong> (<strong>ANCOVA</strong>, <em><strong>AN</strong>alysis of <strong>COVA</strong>riance</em> en anglais) comprend une variable dépendante continue, une variable indépendante qualitative (facteur) et plusieurs variables indépendantes continues dites covariables. L’objectif est alors de vérifier si les moyennes d’une variable dépendante sont différentes pour plusieurs groupes d’une population donnée, après avoir contrôlé l’effet d’une ou de plusieurs variables continues. Par exemple, pour une métropole donnée, nous pourrions vouloir comparer les moyennes de loyers entre la ville-centre et ceux des première et seconde couronnes (facteur), une fois contrôlée la taille de ces derniers (variable covariée continue). En effet, une partie de la variance des loyers s’explique certainement par la taille des logements.</p></li>
<li><p><strong>L’analyse de variance multivariée</strong> (<strong>MANOVA</strong>, <em><strong>M</strong>ultivariate <strong>AN</strong>alysis <strong>O</strong>f <strong>VA</strong>riance</em> en anglais) comprend deux variables dépendantes continues ou plus et une variable indépendante qualitative (facteur). Par exemple, nous souhaiterions comparer les moyennes d’exposition au bruit et à différents polluants (dioxyde d’azote, particules fines, ozone) (variables dépendantes continues) selon le mode de transport utilisé (automobile, vélo, transport en commun), soit le facteur.</p></li>
<li><p><strong>L’analyse de covariance multivariée</strong> (<strong>MANCOVA</strong>, <em><strong>M</strong>ultivariate <strong>AN</strong>alysis of <strong>COVA</strong>riance</em> en anglais), soit une analyse qui comprend deux variables dépendantes continues ou plus (comme la MANOVA) et une variable qualitative comme variable indépendante (facteur) et une covariable continue ou plus.</p></li>
</ul>
<p>Pour le test <em>t</em>, nous avons vu qu’il peut s’appliquer soit à deux échantillons indépendants (non appariés), soit à deux échantillons dépendants (appariés). Notez qu’il existe aussi des extensions de l’ANOVA pour des échantillons pairés. Nous parlons alors d’<strong>analyse de variance sur des mesures répétées</strong>. Par exemple, nous pourrions évaluer la perception du sentiment de sécurité relativement à la pratique du vélo d’hiver pour un échantillon de cyclistes ayant décidé de l’adopter récemment, et ce, à plusieurs moments : avant leur première saison, à la fin de leur premier hiver, à la fin de leur second hiver. Autre exemple, nous pourrions sélectionner un échantillon d’individus (100, par exemple) pour lesquels nous évaluerions leurs perceptions de l’environnement sonore dans différents lieux de la ville. Comme pour l’ANOVA classique (échantillons non appariés), il existe des extensions de l’ANOVA sur des mesures répétées permettant d’inclure plusieurs facteurs (groupes de population); nous mesurons alors une variable continue pour plusieurs groupes d’individus à différents moments ou pour des conditions différentes. Il est aussi possible de réaliser une ANOVA pour des mesures répétées avec une ou plusieurs covariables continues.</p>
<p>Bref, si l’ANOVA était un roman, elle serait certainement « un monde sans fin » de Ken Follett! Notez toutefois que la SUPERNOVA, la BOSSA-NOVA et le CASANOVA ne sont pas des variantes de l’ANOVA!</p>
</div>
</div>
</div>
<div id="sect063" class="section level2">
<h2><span class="header-section-number">6.3</span> Conclusion sur la troisième partie</h2>
<p>Dans le cadre de cette troisième partie du livre, nous avons abordé les principales méthodes exploratoires et confirmatoires bivariées permettant d’évaluer la relation entre deux variables. La figure @ref(fig:figPrincipalesAnalysesBivariees) propose un résumé de ces méthodes.</p>
<div class="figure" style="text-align: center">
<img src="images/bivariee/figure1.jpg" alt="Les principales méthodes bivariées" width="65%" />
<p class="caption">
(#fig:figPrincipalesAnalysesBivariees)Les principales méthodes bivariées
</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div id="sect064" class="section level2">
<h2><span class="header-section-number">6.4</span> Quiz de révision du chapitre</h2>
<div id="Chapitre6_QualiQuanti" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_Chapitre6_QualiQuanti;
  window.onload = function() {
    quizz_Chapitre6_QualiQuanti = new Quiz('Chapitre6_QualiQuanti', ['1','4','1','2','1','2',['1', '2', '3'],'1',['1', '2', '3'],['1', '2', '3', '4', '5']]);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Comment comparer les moyennes de deux groupes?
</div>
<div>
Relisez au besoin la section @ref(sect0611).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>t de Student (test t)</label>
</td>
<td>
<input type="radio" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Analyse de variance (ANOVA)</label>
</td>
<td>
<input type="radio" name="q1" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Covariance et corrélation</label>
</td>
<td>
<input type="radio" name="q1" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Test de Kruskal-Wallis</label>
</td>
<td>
<input type="radio" name="q1" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Comment comparer les médianes de plus de deux groupes?
</div>
<div>
Relisez au besoin la section @ref(sect0612).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>t de Student (test t)</label>
</td>
<td>
<input type="radio" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Analyse de variance (ANOVA)</label>
</td>
<td>
<input type="radio" name="q2" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Test de Kruskal-Wallis</label>
</td>
<td>
<input type="radio" name="q2" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Test de Wilcoxon</label>
</td>
<td>
<input type="radio" name="q2" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Les observations de deux groupes qui n’ont aucun lien entre eux; les tailles des deux échantillons peuvent être différentes. Cette affirmation s’applique à des
</div>
<div>
Relisez au besoin le début de la section @ref(sect0611).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>échantillons indépendants (dits non appariés)</label>
</td>
<td>
<input type="radio" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>échantillons dépendants (dits appariés)</label>
</td>
<td>
<input type="radio" name="q3" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Lorsque les variances des deux groupes sont dissemblables, quel test utilisez-vous?
</div>
<div>
Relisez au besoin la section @ref(sect0611).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Test de Student (test t)</label>
</td>
<td>
<input type="radio" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Test de Welch (appelé aussi Satterthwaite)</label>
</td>
<td>
<input type="radio" name="q4" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Analyse de variance (ANOVA)</label>
</td>
<td>
<input type="radio" name="q4" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Ces boîtes à moustaches s’appliquent à des :
</div>
<img src="images/quiz/Quiz_Chap06_Question_05.JPG" alt="" style="width: 50%;display: block;margin-left: auto;margin-right: auto;margin-bottom: 0.5em;margin-top: 0.5em;"/>
<div>
Relisez au besoin la section @ref(sect06111).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>échantillons dépendants (dits appariés)</label>
</td>
<td>
<input type="radio" name="q5" value="1"/>
</td>
</tr>
<tr>
<td>
<label>échantillons indépendants (dits non appariés)</label>
</td>
<td>
<input type="radio" name="q5" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Plus la variance intergroupe (dissimilarité des groupes) est maximisée et corollairement plus la variance intragroupe (homogénéité de chacun des groupes) est minimisée, plus les groupes sont clairement distincts et plus l’ANOVA est performante. Selon vous, à la lecture de ces graphiques, l’ANOVA risque-t-elle d’être très performante?
</div>
<img src="images/quiz/Quiz_Chap06_Question_06.JPG" alt="" style="width: 50%;display: block;margin-left: auto;margin-right: auto;margin-bottom: 0.5em;margin-top: 0.5em;"/>
<div>
Relisez au besoin la section @ref(sect06211).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Oui</label>
</td>
<td>
<input type="radio" name="q6" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Non</label>
</td>
<td>
<input type="radio" name="q6" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelles sont les trois conditions d’application de l’ANOVA?
</div>
<div>
Relisez au besoin la section @ref(sect06213).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Normalité des groupes</label>
</td>
<td>
<input type="checkbox" name="q7" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Homogénéité des variances des groupes (homoscédasticité)</label>
</td>
<td>
<input type="checkbox" name="q7" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Indépendance des observations (pseudo-réplication)</label>
</td>
<td>
<input type="checkbox" name="q7" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Il faut deux groupes</label>
</td>
<td>
<input type="checkbox" name="q7" value="4"/>
</td>
</tr>
<tr>
<td>
<label>Les groupes doivent être de taille égale</label>
</td>
<td>
<input type="checkbox" name="q7" value="5"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le test non paramétrique de Kruskal-Wallis permet de comparer les médianes de plus de deux groupes.
</div>
<div>
Relisez au besoin la section @ref(sect0622).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q8" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q8" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Sur quelle(s) variances est basée l’ANOVA?
</div>
<div>
Relire le deuxième encadré à la section @ref(sect06211).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>La variance totale</label>
</td>
<td>
<input type="checkbox" name="q9" value="1"/>
</td>
</tr>
<tr>
<td>
<label>La variance intragroupe</label>
</td>
<td>
<input type="checkbox" name="q9" value="2"/>
</td>
</tr>
<tr>
<td>
<label>La variance intergroupe</label>
</td>
<td>
<input type="checkbox" name="q9" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelles sont les variantes de l’ANOVA?
</div>
<div>
Relire le deuxième encadré à la section @ref(sect0624).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Une ANOVA à deux facteurs</label>
</td>
<td>
<input type="checkbox" name="q10" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Une ANOVA multifacteur</label>
</td>
<td>
<input type="checkbox" name="q10" value="2"/>
</td>
</tr>
<tr>
<td>
<label>L’analyse de covariance (ANCOVA)</label>
</td>
<td>
<input type="checkbox" name="q10" value="3"/>
</td>
</tr>
<tr>
<td>
<label>L’analyse de variance multivariée (MANOVA)</label>
</td>
<td>
<input type="checkbox" name="q10" value="4"/>
</td>
</tr>
<tr>
<td>
<label>L’analyse de covariance multivariée (MANCOVA)</label>
</td>
<td>
<input type="checkbox" name="q10" value="5"/>
</td>
</tr>
<tr>
<td>
<label>La SUPERNOVA</label>
</td>
<td>
<input type="checkbox" name="q10" value="6"/>
</td>
</tr>
<tr>
<td>
<label>La BOSSANOVA</label>
</td>
<td>
<input type="checkbox" name="q10" value="7"/>
</td>
</tr>
<tr>
<td>
<label>Le CASANOVA</label>
</td>
<td>
<input type="checkbox" name="q10" value="8"/>
</td>
</tr>
</table>
</div>
</div>
<button type="button" onclick="showResults(quizz_Chapitre6_QualiQuanti);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:06-bivarieeQualiQuanti.Rmd-->
</div>
</div>
<div id="part-modèles-de-régression" class="section level1 unnumbered">
<h1>(PART) Modèles de régression</h1>
</div>
<div id="chap07" class="section level1">
<h1><span class="header-section-number">7</span> Régression linéaire multiple</h1>
<p>Dans ce chapitre, nous présentons la méthode de régression certainement la plus utilisée en sciences sociales : la régression linéaire multiple. À titre de rappel, dans la section @ref(sect044), nous avons vu que la régression linéaire simple, basée sur la méthode des moindres carrés ordinaires (MCO), permet d’expliquer et de prédire une variable continue en fonction d’une autre variable. Toutefois, quel que soit le domaine d’étude, il est rare que le recours à une seule variable explicative (<em>X</em>) permette de prédire efficacement une variable continue (<em>Y</em>). La régression linéaire multiple est simplement une extension de la régression linéaire simple : elle permet ainsi de prédire et d’expliquer une variable dépendante (<em>Y</em>) en fonction de plusieurs variables indépendantes (explicatives).</p>
<p>Plus spécifiquement, nous abordons ici les principes et les hypothèses de la régression linéaire multiple, comment mesurer la qualité d’ajustement du modèle, introduire des variables explicatives particulières (variable qualitative dichotomique ou polytomique, variable d’interaction, etc.), interpréter les sorties d’un modèle de régression et finalement la mettre en oeuvre dans R.</p>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons les <em>packages</em> suivants :</p>
<ul>
<li>Pour créer des graphiques :
<ul>
<li><code>ggplot2</code>, le seul, l’unique!</li>
<li><code>ggpubr</code> pour combiner les graphiques</li>
</ul></li>
<li>Pour obtenir les coefficients standardisés :
<ul>
<li><code>QuantPsyc</code> avec la fonction <code>lm.beta</code> (section @ref(sect0742)).</li>
</ul></li>
<li>Pour les effets marginaux des variables indépendantes :
<ul>
<li><code>ggeffects</code> avec la fonction <code>ggpredict</code> (section @ref(sect0774)).</li>
</ul></li>
<li>Pour vérifier la normalité des résidus :
<ul>
<li><code>DescTools</code> avec les fonctions <code>Skewness</code> et <code>Kurtosis</code> et <code>JarqueBeraTest</code> (section @ref(sect0762)).</li>
</ul></li>
<li>Pour vérifier l’homoscédasticité des résidus :
<ul>
<li><code>lmtest</code> avec la fonction <code>bptest</code> pour le test de Breusch-Pagan (section @ref(sect07733)).</li>
</ul></li>
<li>Pour vérifier la multicolinéarité excessive :
<ul>
<li><code>car</code> avec la fonction <code>vif</code> (section @ref(sect07734)).</li>
</ul></li>
<li>Autre <em>package</em> :
<ul>
<li><code>foreign</code> pour importer des fichiers externes.</li>
</ul></li>
</ul>
</div>
<div id="sect071" class="section level2">
<h2><span class="header-section-number">7.1</span> Objectifs de la régression linéaire multiple et construction d’un modèle de régression</h2>
<p>Selon Barbara G. Tabachnich et Linda S. Fidell <span class="citation">(<a href="#ref-tabachnick2007" role="doc-biblioref">2007</a>)</span>, un modèle de régression permet de répondre à deux objectifs principaux relevant chacun d’une approche de modélisation particulière.</p>
<p>La première approche a pour objectif d’identifier les relations entre une variable dépendante (VD) et plusieurs variables indépendantes (VI). Il s’agit alors de déterminer si ces relations sont positives ou négatives, significatives ou non et d’évaluer leur ampleur. La construction du modèle de régression repose alors sur un cadre théorique et la formulation d’hypothèses, sur les relations entre chacune des VI et la VD.</p>
<p>La seconde approche est exploratoire et très utilisée en forage ou en fouille de données (<em>data mining</em> en anglais). Parmi un grand ensemble de variables disponibles dans un jeu de données, elle vise à identifier la ou les variables permettant de prédire le plus efficacement (précisément) une variable dépendante. Parfois, ce type de démarche ne repose ni sur un cadre théorique ni sur la formulation d’hypothèses entre les VI et la VD. Dans des cas extrêmes, on s’intéresse uniquement à la capacité de prédiction du modèle, et ce, sans analyser les associations entre les VI et la VD. L’objectif étant d’obtenir le modèle le plus efficace possible afin de prédire à l’avenir la valeur de la variable dépendante pour des observations pour lesquelles elle est inconnue. Pour ce faire, nous avons recours à des régressions séquentielles (<em>stepwise regressions</em>) dans lesquelles les variables peuvent être ajoutées une à une au modèle ou retirées de celui-ci; nous conserverons dans le modèle final uniquement celles qui ont un apport explicatif significatif. Signalons d’emblée que dans le reste du chapitre, comme du livre, nous ne nous étendons pas plus sur cette approche de modélisation, et ce, pour deux raisons. D’une part, cette approche met souvent en évidence des relations significatives entre des variables sans qu’il y ait une relation de causalité entre elles. D’autre part, en sciences sociales, un modèle de régression doit être basé sur un cadre théorique et conceptuel élaboré à la suite à d’une revue de littérature rigoureuse.</p>
<div class="bloc_attention">
<p><strong>Cadre conceptuel et élaboration d’un modèle de régression</strong></p>
<p>Pour bien construire un modèle de régression, il convient de définir un cadre conceptuel élaboré à la suite à une revue de littérature sur le sujet de recherche. Ce cadre conceptuel permet d’identifier les dimensions et les concepts clefs permettant d’expliquer le phénomène à l’étude. Par la suite, pour chacun de ces concepts ou les dimensions, il est alors possible 1) d’identifier les différentes variables indépendantes qui sont introduites dans le modèle et 2) de formuler une hypothèse pour chacune d’elles. Par exemple, pour telle ou telle variable explicative, on s’attendra à ce qu’elle fasse augmenter ou diminuer significativement la variable dépendante. De nouveau, la formulation de cette hypothèse doit s’appuyer sur une interprétation théorique de la relation entre la VI et la VD.</p>
<p>Prenons en guise d’exemple une étude récente portant sur la multiexposition des cyclistes au bruit et à la pollution atmosphérique <span class="citation">(Gelb et Apparicio <a href="#ref-2020_3" role="doc-biblioref">2020</a>)</span>. Dans cet article, les auteurs s’intéressent aux caractéristiques de l’environnement urbain qui contribuent à augmenter ou réduire l’exposition des cyclistes à la pollution de l’air et au bruit routier. Pour ce faire, une collecte de données primaires a été réalisée avec trois cyclistes dans les rues de Paris du 4 au 7 septembre 2017. Au total, 64 heures et 964 kilomètres ont ainsi été parcourus à vélo afin de maximiser la couverture de la ville de Paris et les types d’environnements urbains traversés.</p>
<p>Leur cadre conceptuel est schématisé à la figure @ref(fig:figcadreconcept). Les deux variables indépendantes (à expliquer) sont l’exposition au dioxyde d’azote (NO<sub>2</sub>) et l’exposition au bruit (mesurée en décibel dB(A)). Avant d’identifier les caractéristiques de l’environnement urbain affectant ces deux expositions, plusieurs facteurs, dits <strong>variables de contrôle</strong>, sont considérés. Par exemple, la concentration de NO<sub>2</sub> varie en fonction des conditions météorologiques (vent, température et humidité) et de la pollution d’arrière-plan (variant selon le moment de la journée, le jour de la semaine et la localisation géographique au sein de la ville). Ces dimensions ne sont pas le centre d’intérêt direct de l’étude. En effet, les auteurs s’intéressent aux impacts des caractéristiques locales de l’environnement urbain. Pour pouvoir les identifier sans biais, il est nécessaire de contrôler (filtrer) l’ensemble de ces autres facteurs.</p>
<p>Dans leur cadre conceptuel, les auteurs regroupent les caractéristiques locales de l’environnement urbain en trois grandes dimensions : les caractéristiques du segment (type de rues ou de voies cyclables empruntés, intersections traversées, pente et vitesse), celles de la forme urbaine (densité résidentielle, végétation, ouverture de la rue et occupations du sol) et celles du trafic (nombre et types de véhicules croisés, congestion et zones 30 km/h). Une fois ce cadre conceptuel construit, il reste alors à identifier les variables qui permettent d’opérationnaliser chacun de concepts retenus.</p>
<div class="figure" style="text-align: center">
<img src="images/lm/CadreTheorique.jpg" alt="Exemple de cadre conceptuel" width="100%" />
<p class="caption">
(#fig:figcadreconcept)Exemple de cadre conceptuel
</p>
</div>
<p><strong>Notion de variables de contrôle <em>versus</em> variables explicatives</strong></p>
<p>Dans un modèle de régression, nous distinguons habituellement trois types de variables : la variable dépendante (<em>Y</em>) que nous souhaitons prédire ou expliquer et les variables indépendantes (<em>X</em>) qui peuvent être soit des variables de contrôle (<em>covariates</em> en anglais), soit des variables explicatives. Les premières sont des facteurs qu’il faut prendre en compte (contrôler) avant d’évaluer nos variables d’intérêt (explicatives).</p>
<p>Dans l’exemple précédent, les chercheurs voulaient évaluer l’impact des caractéristiques de l’environnement urbain (variables explicatives) sur les expositions des cyclistes au dioxyde d’azote et au bruit, et ce, une fois contrôlés les effets de facteurs reconnus comme ayant un impact significatif sur la concentration de ces polluants (conditions météorologiques et la pollution d’arrière-plan). Autrement dit, si les variables de contrôle n’avaient pas été prises en compte, l’étude des variables d’intérêt serait biaisée par les effets de ces facteurs qui n’auraient pas été contrôlés. À titre d’exemple, il est possible que les zones de circulation limitées à 30 km/h soient concentrées dans les quartiers centraux et denses de Paris. Dans ces quartiers, la pollution d’arrière-plan a tendance à être supérieure. Si nous tenons pas compte de cette pollution d’arrière-plan, nous pourrions arriver à la conclusion que les zones de 30 km/h sont des milieux dans lesquels les cyclistes sont plus exposés à la pollution atmosphérique.</p>
<p><strong>Construction de modèles de régression imbriqués, incrémentiels</strong></p>
<p>En lien avec le cadre conceptuel du modèle, il est fréquent de construire plusieurs modèles emboîtés. Par exemple, à partir du cadre conceptuel (figure @ref(fig:figcadreconcept)), les auteurs auraient très bien pu construire quatre modèles :</p>
<ul>
<li>un premier avec uniquement les variables de contrôle (modèle A);</li>
<li>un second incluant les variables de contrôle et les variables explicatives de la dimension des caractéristiques du segment (modèle B);</li>
<li>un troisième reprenant les variables du modèle B dans lequel sont introduites les variables explicatives relatives à la forme urbaine (modèle C);</li>
<li>un dernier modèle dans lequel sont ajoutées les variables explicatives relatives aux conditions du trafic (modèle D).</li>
</ul>
<p>L’intérêt d’une telle approche est qu’elle permet d’évaluer successivement l’apport explicatif de chacune des dimensions du modèle; nous y reviendrons dans la section @ref(sect053).</p>
<p>Nous disons alors que deux modèles sont imbriqués lorsque le modèle avec le plus de variables comprend également <strong>toutes</strong> les variables du modèle avec le moins de variables.</p>
</div>
</div>
<div id="sect072" class="section level2">
<h2><span class="header-section-number">7.2</span> Principes de base de la régression linéaire multiple</h2>
<div id="sect0721" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Un peu d’équations…</h3>
<p>La régression linéaire multiple vise à déterminer une équation qui résume le mieux les relations linéaires entre une variable dépendante (<em>Y</em>) et un ensemble de variables indépendantes (<em>X</em>). L’équation de régression s’écrit alors :</p>

<p><span class="math display">\[\begin{equation} 
y_i = \beta_{0} + \beta_{1}x_{1i} + \beta_{2}x_{2i} +\ldots+ \beta_{k}x_{ki} + \epsilon_{i}
(\#eq:regmultiple1)
\end{equation}\]</span>
</p>
<p>avec :</p>
<ul>
<li><span class="math inline">\(y_i\)</span>, la valeur de la variable dépendante <em>Y</em> pour l’observation <em>i</em></li>
<li><span class="math inline">\(\beta_{0}\)</span>, la constante, soit la valeur prédite pour <em>Y</em> quand toutes les variables indépendantes sont égales à 0</li>
<li><span class="math inline">\(k\)</span> le nombre de variables indépendantes</li>
<li><span class="math inline">\(\beta_{1}\)</span> à <span class="math inline">\(\beta_{k}\)</span>, les coefficients de régression pour les variables indépendantes de 1 à <em>k</em> (<span class="math inline">\(X_{1}\)</span> à <span class="math inline">\(X_{k}\)</span>)</li>
<li><span class="math inline">\(\epsilon_{i}\)</span>, le résidu pour l’observation de <em>i</em>, soit la partie de la valeur de <span class="math inline">\(y_i\)</span> qui n’est pas expliquée par le modèle de régression.</li>
</ul>
<p>Notez qu’il existe plusieurs écritures simplifiées de cette équation. D’une part, il est possible de ne pas indiquer l’observation <em>i</em> et de remplacer les lettres grecques <em>bêta</em> et <em>epsilon</em> (<span class="math inline">\(\beta\)</span> et <span class="math inline">\(\epsilon\)</span>) par les lettres <em>b</em> et <em>e</em> :</p>

<p><span class="math display">\[\begin{equation}
Y = b_{0} + b_{1}X_{1} + b_{2}X_{2} +\ldots+ b_{k}X_{k} + e
(\#eq:regmultiple2)
\end{equation}\]</span>
</p>
<p>D’autre part, cette équation peut être présentée sous forme matricielle. Rappelez-vous que, pour chacune des <em>n</em> observations de l’échantillon, une équation est formulée :</p>

<p><span class="math display">\[\begin{equation}
\left\{\begin{array}{l}
y_{1}=\beta_{0}+\beta_{1} x_{1,1}+\ldots+\beta_{p} x_{1, k}+\varepsilon_{1} \\
y_{2}=\beta_{0}+\beta_{1} x_{2,1}+\ldots+\beta_{p} x_{2, k}+\varepsilon_{2} \\
\cdots \\
y_{n}=\beta_{0}+a_{1} x_{n, 1}+\ldots+\beta_{p} x_{n, k}+\varepsilon_{n}
\end{array}\right.
(\#eq:regmultiple3)
\end{equation}\]</span>
</p>
<p>Par conséquent, sous forme matricielle, l’équation s’écrit :</p>

<p><span class="math display">\[\begin{equation}
\left(\begin{array}{c}
y_{1} \\
\vdots \\
y_{n}
\end{array}\right)=\left(\begin{array}{cccc}
1 &amp; x_{1,1} &amp; \cdots &amp; x_{1, k} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
1 &amp; x_{n, 1} &amp; \cdots &amp; x_{n, k}
\end{array}\right)\left(\begin{array}{c}
\beta_{0} \\
\beta_{1} \\
\vdots \\
\beta_{k}
\end{array}\right)+\left(\begin{array}{c}
\varepsilon_{1} \\
\vdots \\
\varepsilon_{n}
\end{array}\right)
(\#eq:regmultiple4)
\end{equation}\]</span>
</p>
<p>ou tout simplement :</p>

<p><span class="math display">\[\begin{equation}
Y = X\beta + \epsilon
(\#eq:regmultiple5)
\end{equation}\]</span>
</p>
<p>avec :</p>
<ul>
<li><span class="math inline">\(Y\)</span>, un vecteur de dimension <span class="math inline">\(n \times 1\)</span> pour la variable dépendante, soit une colonne avec <em>n</em> observations</li>
<li><span class="math inline">\(X\)</span>, une matrice de dimension <span class="math inline">\(n \times (k + 1)\)</span> pour les <em>k</em> variables indépendantes, incluant une autre colonne (avec la valeur de 1 pour les <em>n</em> observations) pour la constante d’où <span class="math inline">\(k + 1\)</span></li>
<li><span class="math inline">\(\beta\)</span>, un vecteur de dimension <span class="math inline">\(k + 1\)</span>, soit les coefficients de régression pour les <em>k</em> variables et la constante</li>
<li><span class="math inline">\(\epsilon\)</span>, un vecteur de dimension <span class="math inline">\(n \times 1\)</span> pour les résidus.</li>
</ul>
<div class="bloc_attention">
<p>Vous aurez compris que, comme pour la régression linéaire simple (section @ref(sect044)), l’équation de la régression linéaire multiple comprend aussi une partie expliquée et une autre non expliquée (stochastique) par le modèle :</p>
<p><span class="math display">\[\begin{equation}
Y  = \underbrace{\beta_{0} + \beta_{1}X_{i} + \beta_{2}X_{i} +\ldots+ \beta_{k}X_{k}}_{\mbox{partie expliquée par le modèle}}+ \underbrace{\epsilon}_{\mbox{partie non expliquée (stochastique)}}
(\#eq:regmultiple6)
\end{equation}\]</span>
</p>
<p><span class="math display">\[\begin{equation}
Y  = \underbrace{X\beta}_{\mbox{partie expliquée par le modèle}}+ \underbrace{\epsilon}_{\mbox{partie non expliquée (stochastique)}}
(\#eq:regmultiple8)
\end{equation}\]</span>
</p>
</div>
</div>
<div id="sect0722" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Hypothèses de la régression linéaire multiple</h3>
<p>Un modèle est bien construit s’il respecte plusieurs hypothèses liées à la régression, dont les principales étant :</p>
<ul>
<li><strong>Hypothèse 1</strong>. <em>La variable dépendante doit être continue et non-bornée</em>. Quant aux variables indépendantes (VI), elles peuvent être quantitatives (discrètes ou continues) et qualitatives (nominale ou ordinale).</li>
<li><strong>Hypothèse 2</strong>. <em>La variance de chaque VI doit être supérieure à 0</em>. Autrement dit, toutes les observations ne peuvent avoir la même valeur.</li>
<li><strong>Hypothèse 3</strong>. <em>Indépendance des termes d’erreur</em>. Les résidus des observations (<span class="math inline">\(\epsilon_{1}, \epsilon_{2}, \ldots, \epsilon_{n}\)</span>) ne doivent pas être corrélés entre eux. Autrement dit, les observations doivent être indépendantes les unes des autres, ce qui n’est souvent pas le cas pour des mesures temporelles. Par exemple, l’application du cadre conceptuel sur la modélisation de l’exposition des cyclistes au bruit et à la pollution atmosphérique (figure @ref(fig:figcadreconcept)) est basée sur des données primaires collectées lors de trajets réalisés à vélo dans une ville donnée. Par conséquent, deux observations qui se suivent ont bien plus de chances de se ressembler – du point de vue des mesures de pollution et des caractéristiques de l’environnement urbain – que deux observations tirées au hasard dans le jeu de données. Ce problème d’autocorrélation temporelle doit être contrôlé, sinon, les coefficients de régression seront biaisés.</li>
<li><strong>Hypothèse 4</strong>. <em>Normalité des résidus</em> avec une moyenne centrée sur zéro.</li>
<li><strong>Hypothèse 5</strong>. <em>Absence de colinéarité parfaite entre les variables explicatives</em>. Par exemple, dans un modèle, nous ne pouvons pas introduire à la fois les pourcentages de locataires et de propriétaires, car pour chaque observation, la somme des deux donne 100nbsp;%. Nous avons donc une corrélation parfaite entre ces deux variables : le coefficient de corrélation de Pearson entre ces deux variables est égal à 1. Par conséquent, le modèle ne peut pas être estimé avec ces deux variables et l’une des deux est automatiquement ôtée.</li>
<li><strong>Hypothèse 6</strong>. <em>Homoscédasticité des erreurs (ou absence d’hétéroscédasticité)</em>. Les résidus doivent avoir une variance constante, c’est-à-dire qu’elle doit être la même pour chaque observation. Il y a homoscédasticité lorsqu’il y a une absence de corrélation entre les résidus et les valeurs prédites. Si cette condition n’est pas respectée, nous parlons alors d’hétéroscédasticité.</li>
<li><strong>Hypothèse 7</strong>. <em>Le modèle est bien spécifié</em>. Un modèle est mal spécifié (construit) quand « une ou plusieurs variables non pertinentes sont incluses dans le modèle » ou « qu’une ou plusieurs variables pertinentes sont exclues du modèle » <span class="citation">(Bressoux <a href="#ref-bressoux2010" role="doc-biblioref">2010</a>, 138‑139)</span>. Concrètement, l’inclusion d’une variable non pertinente ou l’omission d’une variable peut entraîner une mauvaise estimation des effets des variables explicatives du modèle.</li>
</ul>
<p>Pour connaître les conséquences de la violation de chacune de ces hypothèses, vous pourrez notamment consulter l’excellent ouvrage de Bressoux <span class="citation">(<a href="#ref-bressoux2010" role="doc-biblioref">2010</a>, 103‑110)</span>. Retenez ici que le non-respect de ces hypothèses produit des coefficients de régression biaisés.</p>
</div>
</div>
<div id="sect073" class="section level2">
<h2><span class="header-section-number">7.3</span> Évaluation de la qualité d’ajustement du modèle</h2>
<p>Pour illustrer la régression linéaire multiple, nous utilisons un jeu de données tiré d’un article portant sur la distribution spatiale de la végétation sur l’île de Montréal abordée sous l’angle de l’équité environnementale <span class="citation">(Apparicio, Séguin et al. <a href="#ref-apparicio2016spatial" role="doc-biblioref">2016</a>)</span>. Dans cette étude, les auteurs veulent vérifier si certains groupes de population (personnes à faible revenu, minorités visibles, personnes âgées et enfants de moins de 15 ans) ont ou non une accessibilité plus limitée à la végétation urbaine. En d’autres termes, cet article tente de répondre à la question suivante : une fois contrôlées les caractéristiques de la forme urbaine (densité de population et âge du bâti), est-ce que les quatre groupes de population résident dans des îlots urbains avec proportionnellement moins ou plus de végétation?</p>
<p>Dans le tableau @ref(tab:datareg), sont reportées les variables utilisées (calculées au niveau des îlots de l’île de Montréal) introduites dans le modèle de régression :</p>
<ul>
<li>le pourcentage de la superficie de l’îlot couverte par de la végétation, soit la variable indépendante (VI);</li>
<li>deux variables indépendantes de contrôle (VC) relatives à la forme urbaine;</li>
<li>les pourcentages des quatre groupes de population comme variables indépendantes explicatives (VE).</li>
</ul>
<p><strong>Notez que ce jeu de données est utilisé tout au long du chapitre.</strong> L’équation de départ du premier modèle de régression est donc :</p>
<p><code>VegPct ~ HABHA + AgeMedian + Pct_014 + Pct_65P + Pct_MV + Pct_FR</code></p>
<table>
<caption>
(#tab:datareg)Statistiques descriptives pour les variables du modèle
</caption>
<thead>
<tr>
<th style="text-align:left;">
Nom
</th>
<th style="text-align:left;">
Intitulé
</th>
<th style="text-align:center;">
Type
</th>
<th style="text-align:right;">
Moy.
</th>
<th style="text-align:right;">
E.-T.
</th>
<th style="text-align:right;">
Q1
</th>
<th style="text-align:right;">
Q2
</th>
<th style="text-align:right;">
Q3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
VegPct
</td>
<td style="text-align:left;">
Végétation (%)
</td>
<td style="text-align:center;">
VD
</td>
<td style="text-align:right;">
35,1
</td>
<td style="text-align:right;">
18,6
</td>
<td style="text-align:right;">
20,3
</td>
<td style="text-align:right;">
33,8
</td>
<td style="text-align:right;">
49,0
</td>
</tr>
<tr>
<td style="text-align:left;">
HABHA
</td>
<td style="text-align:left;">
Habitants au km2
</td>
<td style="text-align:center;">
VC
</td>
<td style="text-align:right;">
87,8
</td>
<td style="text-align:right;">
74,0
</td>
<td style="text-align:right;">
36,9
</td>
<td style="text-align:right;">
68,4
</td>
<td style="text-align:right;">
120,5
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian
</td>
<td style="text-align:left;">
Âge médian des bâtiments
</td>
<td style="text-align:center;">
VC
</td>
<td style="text-align:right;">
52,1
</td>
<td style="text-align:right;">
25,2
</td>
<td style="text-align:right;">
37,2
</td>
<td style="text-align:right;">
49,0
</td>
<td style="text-align:right;">
61,0
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:left;">
Moins de 15 ans (%)
</td>
<td style="text-align:center;">
VE
</td>
<td style="text-align:right;">
15,9
</td>
<td style="text-align:right;">
5,3
</td>
<td style="text-align:right;">
12,5
</td>
<td style="text-align:right;">
15,9
</td>
<td style="text-align:right;">
19,3
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:left;">
65 ans et plus (%)
</td>
<td style="text-align:center;">
VE
</td>
<td style="text-align:right;">
14,9
</td>
<td style="text-align:right;">
8,3
</td>
<td style="text-align:right;">
9,6
</td>
<td style="text-align:right;">
13,9
</td>
<td style="text-align:right;">
18,2
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:left;">
Minorités visibles (%)
</td>
<td style="text-align:center;">
VE
</td>
<td style="text-align:right;">
21,0
</td>
<td style="text-align:right;">
16,4
</td>
<td style="text-align:right;">
8,3
</td>
<td style="text-align:right;">
17,2
</td>
<td style="text-align:right;">
29,6
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:left;">
Personnes à faible revenu (%)
</td>
<td style="text-align:center;">
VE
</td>
<td style="text-align:right;">
23,6
</td>
<td style="text-align:right;">
16,0
</td>
<td style="text-align:right;">
11,1
</td>
<td style="text-align:right;">
21,3
</td>
<td style="text-align:right;">
33,7
</td>
</tr>
</tbody>
</table>
<div id="sect0731" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Mesures de la qualité d’un modèle</h3>
<p>Comme pour la régression linéaire simple (section @ref(sect044)), les trois mesures les plus couramment utilisées pour évaluer la qualité d’un modèle sont :</p>
<ul>
<li><p>Le <strong>coefficient de détermination</strong> (R<sup>2</sup>) qui indique la proportion de la variance de la variable dépendante expliquée par les variables indépendantes du modèle (équation @ref(eq:regmR2)). Il varie ainsi de 0 à 1.</p></li>
<li><p>La <strong>statistique de Fisher</strong> qui permet d’évaluer la significativité globale du modèle (équation @ref(eq:regmFFisher)). Dans le cas d’une régression linéaire multiple, l’hypothèse nulle du test <em>F</em> est que toutes les valeurs des coefficients de régression des variables indépendantes sont égales à 0; autrement dit, qu’aucune des variables indépendantes n’a d’effet sur la variable dépendante. Tel que décrit à la section @ref(sect0443), il est possible d’obtenir une valeur de <em>p</em> rattachée à la statistique <em>F</em> avec <em>k</em> degrés de liberté au dénominateur et <em>n-k-1</em> degrés de liberté au numérateur (<em>k</em> et <em>n</em> étant respectivement le nombre de variables indépendantes et le nombre d’observations). Lorsque la valeur de <em>p</em> est inférieure à 0,05, nous pourrons en conclure que le modèle est globalement significatif, c’est-à-dire qu’au moins un coefficient de régression est significativement différent de zéro. Notez qu’il est plutôt rare qu’un modèle de régression, comprenant plusieurs variables indépendantes, soit globalement non significatif (P &gt; 0,05), et ce, surtout s’il est basé sur un cadre conceptuel et théorique solide. Le test de la statistique de Fisher est donc facile à passer et ne constitue pas une preuve absolue de la pertinence du modèle.</p></li>
<li><p><strong>L’erreur quadratique moyenne (RMSE)</strong> qui indique l’erreur absolue moyenne du modèle exprimée dans l’unité de mesure de la variable dépendante, autrement dit l’écart absolu moyen entre les valeurs observées et prédites du modèle (équation @ref(eq:regmRMSE)). Une valeur élevée indique que le modèle se trompe largement en moyenne et inversement.</p></li>
</ul>
<div class="bloc_attention">
<p><strong>Rappel sur la décomposition de la variance et calcul du R<sup>2</sup>, de la statistique <em>F</em> et du RMSE</strong></p>
<p>Rappelez-vous que la variance totale (SCT) est égale à la somme de la variance expliquée (SCE) par le modèle et de la variance non expliquée (SCR) par le modèle.</p>
<p><span class="math display">\[\begin{equation}
\underbrace{\sum_{i=1}^n (y_{i}-\bar{y})^2}_{\mbox{variance de Y}} = \underbrace{\sum_{i=1}^n (\widehat{y}_i-\bar{y})^2}_{\mbox{var. expliquée}} + \underbrace{\sum_{i=1}^n (y_{i}-\widehat{y})^2}_{\mbox{var. non expliquée}} \Rightarrow 
SCT = SCE + SCR
(\#eq:regmVariances)
\end{equation}\]</span>
</p>
<p>avec :</p>
<ul>
<li><span class="math inline">\(y_{i}\)</span> est la valeur observée de la variable dépendante pour <em>i</em>;</li>
<li><span class="math inline">\(\bar{y}\)</span> est la valeur moyenne de la variable dépendante;</li>
<li><span class="math inline">\(\widehat{y}_i\)</span> est la valeur prédite de la variable dépendante pour <em>i</em>.</li>
</ul>
<p>À partir des trois variances (totale, expliquée et non expliquée), il est alors possible de calculer les trois mesures de la qualité d’ajustement du modèle.</p>
<p><span class="math display">\[\begin{equation}
R^2 = \frac{\sum_{i=1}^n (\widehat{y}_i-\bar{y})^2}{\sum_{i=1}^n (y_{i}-\bar{y})^2} = \frac{SCE}{SCT} \mbox{ avec } R^2 \in \left[0,1\right]
(\#eq:regmR2)
\end{equation}\]</span>
</p>
<p><span class="math display">\[\begin{equation} 
F = \frac{\frac{\sum_{i=1}^n (\widehat{y}_i-\bar{y})^2}{k}}{\frac{\sum_{i=1}^n (y_{i}-\widehat{y})^2}{n-k-1}} = \frac{\frac{SCE}{k}}{\frac{SCR}{n-k-1}} = \frac{\frac{R^2}{k}} {\frac{1-R^2}{n-k-1}} = \frac{(n-k-1)R^2}{k(1-R^2)}
(\#eq:regmFFisher)
\end{equation}\]</span>
</p>
<p><span class="math display">\[\begin{equation}
RMSE = \sqrt{\frac{\sum_{i=1}^n (y_{i}-\widehat{y})^2}{n}} = \sqrt{\frac{SCR}{n}}
(\#eq:regmRMSE)
\end{equation}\]</span>
</p>
</div>
<p>Globalement, plus un modèle de régression est efficace, plus les valeurs du R<sup>2</sup> et de la statistique <em>F</em> sont élevées et inversement, plus celle de RMSE est faible. En effet, remarquez qu’à l’équation @ref(eq:regmFFisher), la statistique <em>F</em> peut être obtenue à partir du R<sup>2</sup>; par conséquent, plus la valeur du R<sup>2</sup> est forte (proche de 1), plus celle de <em>F</em> est aussi élevée. Notez aussi que plus un modèle est performant, plus la partie expliquée par le modèle (SCE) est importante et plus celle non expliquée (SCR) est faible; ce qui signifie que plus le R<sup>2</sup> est proche de 1 (équation @ref(eq:regmR2)), plus le RMSE – calculé à partir du SCR – est faible (équation @ref(eq:regmRMSE)).</p>
<p>La syntaxe R ci-dessous illustre comment calculer les différentes variances (SCT, SCE et SCR) à partir des valeurs observées et prédites par le modèle, puis les valeurs du R<sup>2</sup>, de <em>F</em> et du RMSE. Nous verrons par la suite qu’il est possible d’obtenir directement ces valeurs à partir de la fonction <code>summary(VotreModele)</code>.</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="#cb641-1"></a><span class="co"># Chargement des données</span></span>
<span id="cb641-2"><a href="#cb641-2"></a><span class="kw">load</span>(<span class="st">&quot;data/lm/DataVegetation.RData&quot;</span>)</span>
<span id="cb641-3"><a href="#cb641-3"></a></span>
<span id="cb641-4"><a href="#cb641-4"></a><span class="co"># Construction du modèle de régression</span></span>
<span id="cb641-5"><a href="#cb641-5"></a>Modele1 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span>AgeMedian<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal)</span>
<span id="cb641-6"><a href="#cb641-6"></a></span>
<span id="cb641-7"><a href="#cb641-7"></a><span class="co"># Nombre d&#39;observations </span></span>
<span id="cb641-8"><a href="#cb641-8"></a>n &lt;-<span class="st"> </span><span class="kw">nrow</span>(DataFinal)</span>
<span id="cb641-9"><a href="#cb641-9"></a></span>
<span id="cb641-10"><a href="#cb641-10"></a><span class="co"># Nombre de variables indépendantes (coefficients moins la constante)</span></span>
<span id="cb641-11"><a href="#cb641-11"></a>k &lt;-<span class="st"> </span><span class="kw">length</span>(Modele1<span class="op">$</span>coefficients)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb641-12"><a href="#cb641-12"></a></span>
<span id="cb641-13"><a href="#cb641-13"></a><span class="co"># Vecteur pour les valeurs observées</span></span>
<span id="cb641-14"><a href="#cb641-14"></a>Yobs &lt;-<span class="st"> </span>DataFinal<span class="op">$</span>VegPct</span>
<span id="cb641-15"><a href="#cb641-15"></a></span>
<span id="cb641-16"><a href="#cb641-16"></a><span class="co"># Vecteur pour les valeurs prédites</span></span>
<span id="cb641-17"><a href="#cb641-17"></a>Ypredit &lt;-<span class="st"> </span>Modele1<span class="op">$</span>fitted.values</span>
<span id="cb641-18"><a href="#cb641-18"></a></span>
<span id="cb641-19"><a href="#cb641-19"></a><span class="co"># Variance totale</span></span>
<span id="cb641-20"><a href="#cb641-20"></a>SCT &lt;-<span class="st"> </span><span class="kw">sum</span>((Yobs<span class="op">-</span><span class="kw">mean</span>(Yobs))<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb641-21"><a href="#cb641-21"></a></span>
<span id="cb641-22"><a href="#cb641-22"></a><span class="co"># Variance expliquée</span></span>
<span id="cb641-23"><a href="#cb641-23"></a>SCE &lt;-<span class="st"> </span><span class="kw">sum</span>((Ypredit<span class="op">-</span><span class="kw">mean</span>(Yobs))<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb641-24"><a href="#cb641-24"></a></span>
<span id="cb641-25"><a href="#cb641-25"></a><span class="co"># Variance résidelle</span></span>
<span id="cb641-26"><a href="#cb641-26"></a>SCR &lt;-<span class="st"> </span><span class="kw">sum</span>((Yobs<span class="op">-</span>Ypredit)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb641-27"><a href="#cb641-27"></a></span>
<span id="cb641-28"><a href="#cb641-28"></a><span class="co">#  Calcul du coefficient de détermination (R2)</span></span>
<span id="cb641-29"><a href="#cb641-29"></a>R2 &lt;-<span class="st"> </span>SCE <span class="op">/</span><span class="st"> </span>SCT</span>
<span id="cb641-30"><a href="#cb641-30"></a></span>
<span id="cb641-31"><a href="#cb641-31"></a><span class="co">#  Calcul de la valeur de F</span></span>
<span id="cb641-32"><a href="#cb641-32"></a>valeurF &lt;-<span class="st"> </span>(R2 <span class="op">/</span><span class="st"> </span>k) <span class="op">/</span>((<span class="dv">1</span><span class="op">-</span>R2)<span class="op">/</span>(n<span class="op">-</span>k<span class="dv">-1</span>))</span>
<span id="cb641-33"><a href="#cb641-33"></a></span>
<span id="cb641-34"><a href="#cb641-34"></a><span class="kw">cat</span>(<span class="st">&quot;R2 =&quot;</span>, <span class="kw">round</span>(SCE <span class="op">/</span><span class="st"> </span>SCT,<span class="dv">4</span>),</span>
<span id="cb641-35"><a href="#cb641-35"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">F de Fisher = &quot;</span>, <span class="kw">round</span>(valeurF,<span class="dv">0</span>),</span>
<span id="cb641-36"><a href="#cb641-36"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">RMSE =&quot;</span>, <span class="kw">round</span>(<span class="kw">sqrt</span>(SCR<span class="op">/</span><span class="st"> </span>n),<span class="dv">4</span>)</span>
<span id="cb641-37"><a href="#cb641-37"></a>    )</span></code></pre></div>
<pre><code>## R2 = 0.4182 
## F de Fisher =  1223 
## RMSE = 14.1575</code></pre>
</div>
<div id="sect0732" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Comparaison des modèles incrémentiels</h3>
<p>Tel que signalé plus haut, il est fréquent de construire plusieurs modèles de régression imbriqués. Cette démarche est très utile pour évaluer l’apport de l’introduction d’un nouveau bloc de variables dans un modèle. De manière exploratoire, cela permet également de vérifier si l’introduction d’une variable indépendante supplémentaire dans un modèle a ou non un apport significatif et ainsi de décider de la conserver, ou non, dans le modèle final selon le principe de parcimonie.</p>
<div class="bloc_notes">
<p><strong>Le principe de parcimonie</strong></p>
<p>Le principe de parcimonie appliqué aux régressions correspond à l’idée qu’il est préférable de disposer d’un <strong>modèle plus simple</strong> que d’un <strong>modèle compliqué</strong> pour expliquer un phénomène si la qualité de leurs prédictions – qualité d’ajustement des deux modèles – est équivalente.</p>
<p>Une première justification de ce principe trouve son origine dans la philosophie des sciences avec le <strong>rasoir d’Ockham</strong>. Il s’agit d’un principe selon lequel il est préférable de privilégier des théories faisant appel à un plus petit nombre d’hypothèses. L’idée centrale étant d’éviter d’apporter des réponses à une question qui soulèveraient davantage de nouvelles questions. Dans le cas d’une régression, nous pourrions être tenté d’ajouter de nombreuses variables indépendantes pour améliorer la capacité de prédiction du modèle. Cette stratégie conduit généralement à observer des relations contraires à nos connaissances entre les variables du modèle, ce qui soulève de nouvelles questions de recherche (pas toujours judicieuses…). Dans notre quotidien, si une casserole tombe de son support, il est plus raisonnable d’imaginer que nous l’avions mal fixée que d’émettre l’hypothèse qu’un fantôme l’a volontairement fait tomber! Cette seconde hypothèse soulève d’autres questions (pas toujours judicieuses…) sur la nature d’un fantôme, son identité, la raison le poussant à agir, etc.</p>
<p>Une seconde justification de ce principe s’observe dans la pratique statistique : des modèles plus complexes ont souvent une plus faible capacité de généralisation. En effet, un modèle complexe et trop bien ajusté aux données observées est souvent incapable d’effectuer des prédictions justes pour de nouvelles données. Ce phénomène est appelé surajustement ou surinterprétation (<em>overfitting</em> en anglais).
Le surajustement résultant de modèles trop complexes entre en conflit direct avec l’enjeu principal de l’inférence en statistique : pouvoir généraliser des observations faites sur un échantillon au reste d’une population.</p>
<p>Notez que ce principe de parcimonie ne signifie pas que vous devez systématiquement retirer toutes les variables non significatives de votre analyse. En effet, il peut y avoir un intérêt théorique à démontrer l’absence de relation entre des variables. Il s’agit plutôt d’une ligne de conduite à garder à l’esprit lors de l’élaboration du cadre théorique et de l’interprétation des résultats.</p>
</div>
<p>Mathématiquement, plus nous ajoutons de variables supplémentaires dans un modèle, plus le R<sup>2</sup> augmente. On ne peut donc pas utiliser directement le R<sup>2</sup> pour comparer deux modèles de régression ne comprenant pas le même nombre de variables indépendantes. Nous privilégions alors l’utilisation du R<sup>2</sup> ajusté qui, comme illustré dans l’équation @ref(eq:R2ajuste), tient compte à la fois des nombres d’observations et des variables indépendantes utilisées pour construire le modèle.</p>

<p><span class="math display">\[\begin{equation} 
R^2_{\text {ajusté}}= 1 - \frac{(1-R^2)(n-1)}{n-k-1} \mbox{ avec } R^2_{\text {ajusté}} \in \left[0,1\right]
(\#eq:R2ajuste)
\end{equation}\]</span>
</p>
<p>Si le R<sup>2</sup> ajusté du second modèle est supérieur au premier modèle, cela signifie qu’il y a un gain de la variance expliquée entre le premier et le second modèle. Ce gain est-il pour autant significatif? Pour y répondre, il convient de comparer les valeurs des statistiques <em>F</em> des deux modèles. Pour ce faire, nous calculons le <em>F</em> incrémentiel et la valeur de <em>p</em> qui lui est associé avec comme degrés de liberté, le nombre de variables indépendantes ajoutées (<span class="math inline">\(k_2-k_1\)</span>) et <span class="math inline">\(n-k_2-1\)</span>. Si la valeur de <em>p</em> &lt; 0,05, nous pouvons conclure que le gain de variance expliquée par le second modèle est significatif comparativement au premier modèle (au seuil de 5nbsp;%).</p>

<p><span class="math display">\[\begin{equation}
F_{\text {incrémentiel}}= \frac{\frac{R^2_2-R^2_1}{k_2-k_1}} {\frac{1-R^2_2}{n-k_2-1}}
(\#eq:Fincrementiel)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(R^2_1\)</span> et <span class="math inline">\(R^2_2\)</span> étant les coefficients de détermination des modèles 1 et 2 et <span class="math inline">\(k_1\)</span> et <span class="math inline">\(k_2\)</span> étant les nombres de variables indépendantes qu’ils comprennent (<span class="math inline">\(k_2 &gt; k_1\)</span>).</p>
<p>Illustrons le tout avec deux modèles. Dans la syntaxe R ci-dessous, nous avons construit un premier modèle avec uniquement les variables de contrôle (<code>modele1</code>), soit deux variables indépendantes (<code>HABHA</code> et <code>AgeMedian</code>). Puis, dans un second modèle (<code>modele2</code>), nous ajoutons comme variables indépendantes les pourcentages des quatre groupes de population (<code>Pct_014</code>, <code>Pct_65P</code>, <code>Pct_MV</code>, <code>Pct_FR</code>). Repérez comment sont calculés les R<sup>2</sup> ajustés pour les modèles et le <em>F</em> incrémentiel.</p>
<p>Le R<sup>2</sup> ajusté passe de 0,269 à 0,418 des modèles 1 à 2 signalant que l’ajout des quatre variables indépendantes augmente considérablement la variance expliquée. Autrement dit, le second modèle est bien plus performant. Le <em>F</em> incrémentiel s’élève à 653,8 et est significatif (<em>p</em> &lt; 0,001). Notez que la syntaxe ci-dessous illustre comment calculer les valeurs du R<sup>2</sup> ajusté et du <em>F</em> incrémentiel à partir des équations @ref(eq:R2ajuste) et @ref(eq:Fincrementiel). Sachez toutefois qu’il est possible d’obtenir directement le R<sup>2</sup> ajusté avec la fonction <code>summary(VotreModele)</code> et le <em>F</em> incrémentiel avec la fonction <code>anova(modele1, modele2)</code>.</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="#cb643-1"></a>modele1 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span>AgeMedian, <span class="dt">data =</span> DataFinal)</span>
<span id="cb643-2"><a href="#cb643-2"></a>modele2 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span>AgeMedian<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal)</span>
<span id="cb643-3"><a href="#cb643-3"></a></span>
<span id="cb643-4"><a href="#cb643-4"></a><span class="co"># nombre d&#39;observations pour les deux modèles</span></span>
<span id="cb643-5"><a href="#cb643-5"></a>n1 &lt;-<span class="st"> </span><span class="kw">length</span>(modele1<span class="op">$</span>fitted.values)</span>
<span id="cb643-6"><a href="#cb643-6"></a>n2 &lt;-<span class="st"> </span><span class="kw">length</span>(modele2<span class="op">$</span>fitted.values)</span>
<span id="cb643-7"><a href="#cb643-7"></a></span>
<span id="cb643-8"><a href="#cb643-8"></a><span class="co"># nombre de variables indépendantes</span></span>
<span id="cb643-9"><a href="#cb643-9"></a>k1 &lt;-<span class="st"> </span><span class="kw">length</span>(modele1<span class="op">$</span>coefficients)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb643-10"><a href="#cb643-10"></a>k2 &lt;-<span class="st"> </span><span class="kw">length</span>(modele2<span class="op">$</span>coefficients)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb643-11"><a href="#cb643-11"></a></span>
<span id="cb643-12"><a href="#cb643-12"></a><span class="co"># coefficient de détermination</span></span>
<span id="cb643-13"><a href="#cb643-13"></a>R2m1 &lt;-<span class="st"> </span><span class="kw">summary</span>(modele1)<span class="op">$</span>r.squared</span>
<span id="cb643-14"><a href="#cb643-14"></a>R2m2 &lt;-<span class="st"> </span><span class="kw">summary</span>(modele2)<span class="op">$</span>r.squared</span>
<span id="cb643-15"><a href="#cb643-15"></a></span>
<span id="cb643-16"><a href="#cb643-16"></a><span class="co"># coefficient de détermination ajusté</span></span>
<span id="cb643-17"><a href="#cb643-17"></a>R2ajustm1 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">-</span>(((n1<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>R2m1)) <span class="op">/</span><span class="st"> </span>(n1<span class="op">-</span>k1<span class="dv">-1</span>))</span>
<span id="cb643-18"><a href="#cb643-18"></a>R2ajustm2 &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">-</span>(((n2<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>R2m2)) <span class="op">/</span><span class="st"> </span>(n2<span class="op">-</span>k2<span class="dv">-1</span>))</span>
<span id="cb643-19"><a href="#cb643-19"></a></span>
<span id="cb643-20"><a href="#cb643-20"></a><span class="co"># Statistique F</span></span>
<span id="cb643-21"><a href="#cb643-21"></a>Fm1 &lt;-<span class="st"> </span><span class="kw">summary</span>(modele1)<span class="op">$</span>fstatistic[<span class="dv">1</span>]</span>
<span id="cb643-22"><a href="#cb643-22"></a>Fm2 &lt;-<span class="st"> </span><span class="kw">summary</span>(modele2)<span class="op">$</span>fstatistic[<span class="dv">1</span>]</span>
<span id="cb643-23"><a href="#cb643-23"></a></span>
<span id="cb643-24"><a href="#cb643-24"></a><span class="co"># F incrémentiel</span></span>
<span id="cb643-25"><a href="#cb643-25"></a>Fincrementiel &lt;-<span class="st"> </span>((R2m2<span class="op">-</span>R2m1) <span class="op">/</span><span class="st"> </span>(k2 <span class="op">-</span><span class="st"> </span>k1)) <span class="op">/</span><span class="st"> </span>( (<span class="dv">1</span><span class="op">-</span>R2m2)<span class="op">/</span>(n2<span class="op">-</span>k2<span class="dv">-1</span>))</span>
<span id="cb643-26"><a href="#cb643-26"></a>pFinc &lt;-<span class="st"> </span><span class="kw">pf</span>(Fincrementiel, k2<span class="op">-</span>k1, n2<span class="op">-</span>k2<span class="dv">-1</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</span>
<span id="cb643-27"><a href="#cb643-27"></a></span>
<span id="cb643-28"><a href="#cb643-28"></a><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">R2 (modèle 1) =&quot;</span>, <span class="kw">round</span>(R2m1,<span class="dv">4</span>), </span>
<span id="cb643-29"><a href="#cb643-29"></a>    <span class="st">&quot;; R2 ajusté = &quot;</span>, <span class="kw">round</span>(R2ajustm1,<span class="dv">4</span>), </span>
<span id="cb643-30"><a href="#cb643-30"></a>    <span class="st">&quot;; F =&quot;</span>, <span class="kw">round</span>(Fm1, <span class="dv">1</span>),</span>
<span id="cb643-31"><a href="#cb643-31"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">R2 (modèle 2) =&quot;</span>, <span class="kw">round</span>(R2m2,<span class="dv">4</span>), </span>
<span id="cb643-32"><a href="#cb643-32"></a>    <span class="st">&quot;; R2 ajusté = &quot;</span>, <span class="kw">round</span>(R2ajustm2,<span class="dv">4</span>), </span>
<span id="cb643-33"><a href="#cb643-33"></a>    <span class="st">&quot;; F =&quot;</span>, <span class="kw">round</span>(Fm2, <span class="dv">1</span>),</span>
<span id="cb643-34"><a href="#cb643-34"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">F incrémentiel =&quot;</span>, <span class="kw">round</span>(Fincrementiel,<span class="dv">1</span>), </span>
<span id="cb643-35"><a href="#cb643-35"></a>    <span class="st">&quot;; p = &quot;</span>, <span class="kw">round</span>(pFinc,<span class="dv">3</span>)</span>
<span id="cb643-36"><a href="#cb643-36"></a>)</span></code></pre></div>
<pre><code>## 
## R2 (modèle 1) = 0.2691 ; R2 ajusté =  0.269 ; F = 1879.2 
## R2 (modèle 2) = 0.4182 ; R2 ajusté =  0.4179 ; F = 1222.5 
## F incrémentiel = 653.8 ; p =  0</code></pre>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="#cb645-1"></a><span class="co"># F incrémentiel avec la fonction anova</span></span>
<span id="cb645-2"><a href="#cb645-2"></a><span class="kw">anova</span>(modele1, modele2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: VegPct ~ HABHA + AgeMedian
## Model 2: VegPct ~ HABHA + AgeMedian + Pct_014 + Pct_65P + Pct_MV + Pct_FR
##   Res.Df     RSS Df Sum of Sq     F    Pr(&gt;F)    
## 1  10207 2570964                                 
## 2  10203 2046427  4    524537 653.8 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>
<div id="sect074" class="section level2">
<h2><span class="header-section-number">7.4</span> Différentes mesures pour les coefficients de régression</h2>
<p>La fonction <code>summary(nom du modèle)</code> permet d’obtenir les résultats du modèle de régression. D’emblée, signalons que le modèle est globalement significatif (<em>F</em>(6,10203) = 1123, <em>p</em> = 0,000) avec un R<sup>2</sup> de 0,4182 indiquant que les variables indépendantes du modèle expliquent 41,82nbsp;% de la variance du pourcentage de végétation dans les îlots de l’île de Montréal.</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="#cb647-1"></a>modelereg &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span>AgeMedian<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal)</span>
<span id="cb647-2"><a href="#cb647-2"></a><span class="kw">summary</span>(modelereg)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = VegPct ~ HABHA + AgeMedian + Pct_014 + Pct_65P + 
##     Pct_MV + Pct_FR, data = DataFinal)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -48.876  -9.757  -0.232   9.499 103.830 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 26.355774   0.882235  29.874   &lt;2e-16 ***
## HABHA       -0.070401   0.002202 -31.975   &lt;2e-16 ***
## AgeMedian    0.010790   0.006369   1.694   0.0902 .  
## Pct_014      1.084478   0.032179  33.702   &lt;2e-16 ***
## Pct_65P      0.400531   0.018835  21.265   &lt;2e-16 ***
## Pct_MV      -0.031112   0.010406  -2.990   0.0028 ** 
## Pct_FR      -0.348256   0.011640 -29.918   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 14.16 on 10203 degrees of freedom
## Multiple R-squared:  0.4182, Adjusted R-squared:  0.4179 
## F-statistic:  1223 on 6 and 10203 DF,  p-value: &lt; 2.2e-16</code></pre>
<div id="sect0741" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Coefficients de régression : évaluer l’effet des variables indépendantes</h3>
<p>Les différents résultats pour les coefficients sont reportés au tableau @ref(tab:dataregmodel2).</p>
<p><strong>La constante</strong> (<span class="math inline">\(\beta_0\)</span>) est la valeur attendue de la variable dépendante (<em>Y</em>) quand les valeurs de toutes les variables indépendantes sont égales à 0. Pour ce modèle, quand les variables indépendantes sont égales à 0, plus du quart de la superficie des îlots serait en moyenne couverte par de la végétation (<span class="math inline">\(\beta_0\)</span> = 26,36). Notez que la constante n’a pas toujours une interprétation pratique. Il est par exemple très invraisemblable de trouver un îlot avec de la population dans lequel il n’y aurait aucune personne à faible revenu, aucune personne ne déclarant appartenir à une minorité visible, aucun enfant de moins de 15 ans et aucune personne âgée 65 ans et plus. La constante a donc avant tout un rôle mathématique dans le modèle.</p>
<p><strong>Le coefficient de régression</strong> (<span class="math inline">\(\beta_1\)</span> à <span class="math inline">\(\beta_k\)</span>) indique le changement de la variable dépendante (<em>Y</em>) lorsque la variable indépendante augmente d’une unité, toutes choses étant égales par ailleurs. Il permet ainsi d’évaluer l’effet d’une augmentation d’une unité dans laquelle est mesurée la VI sur la VD.</p>
<div class="bloc_attention">
<p><strong>Que signifie l’expression <em>toutes choses étant égales par ailleurs</em> pour un coefficient de régression?</strong></p>
<p>Après l’apprentissage du grec, grâce aux nombreuses équations intégrées au livre, passons au latin! L’expression <em>toutes choses étant égales par ailleurs</em> vient du latin <em>ceteris paribus</em>, à ne pas confondre avec <em>c’est terrible Paris en bus</em> (petite blague formulée par un étudiant ayant suivi le cours <em>Méthodes quantitatives appliquées en études urbaines</em> à l’INRS il y a quelques années)! Certains auteurs emploient encore <em>ceteris paribus</em> : il est donc possible que vous la retrouviez dans un article scientifique…</p>
<p>Plus sérieusement, l’expression <em>toutes choses étant égales par ailleurs</em> signifie que l’on estime l’effet de la variable indépendante sur la variable dépendante, si toutes les autres variables indépendantes restent constantes ou autrement dit, une fois contrôlés tous les autres prédicteurs.</p>
</div>
<table>
<caption>
(#tab:dataregmodel2)Différentes mesures pour les coefficients
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coef.
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
coef. 2,5 %
</th>
<th style="text-align:right;">
coef. 97,5 %
</th>
<th style="text-align:right;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
26,356
</td>
<td style="text-align:right;">
0,882
</td>
<td style="text-align:right;">
29,870
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
24,626
</td>
<td style="text-align:right;">
28,085
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
HABHA
</td>
<td style="text-align:right;">
-0,070
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
-31,970
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-0,075
</td>
<td style="text-align:right;">
-0,066
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
0,006
</td>
<td style="text-align:right;">
1,690
</td>
<td style="text-align:right;">
0,090
</td>
<td style="text-align:right;">
-0,002
</td>
<td style="text-align:right;">
0,023
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
1,084
</td>
<td style="text-align:right;">
0,032
</td>
<td style="text-align:right;">
33,700
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,021
</td>
<td style="text-align:right;">
1,148
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,401
</td>
<td style="text-align:right;">
0,019
</td>
<td style="text-align:right;">
21,260
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,364
</td>
<td style="text-align:right;">
0,437
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,031
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-2,990
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
-0,052
</td>
<td style="text-align:right;">
-0,011
</td>
<td style="text-align:right;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,348
</td>
<td style="text-align:right;">
0,012
</td>
<td style="text-align:right;">
-29,920
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-0,371
</td>
<td style="text-align:right;">
-0,325
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table>
<p>À partir des coefficients du tableau @ref(tab:dataregmodel2), l’équation du modèle de régression s’écrit alors comme suit :</p>
<p><code>VegPct = 26,356 − 0,070 HABHA  + 0,011 AgeMedian + 1,084 Pct_014 + 0,401 Pct_65P −0,031 Pct_MV − 0,348 Pct_FR + e</code></p>
<p><strong>Comment interpréter un coefficient de régression pour une variable indépendante?</strong></p>
<p>Le signe du coefficient de régression indique si la variable indépendante est associée positivement ou négativement avec la variable dépendante. Par exemple, plus la densité de population est importante à travers les îlots de l’île de Montréal, plus la couverture végétale diminue.</p>
<p>Quant à la valeur absolue du coefficient, elle indique la taille de l’effet du prédicteur. Par exemple, 1,084 signifie que si toutes les autres variables indépendantes restent constantes, alors le pourcentage de végétation dans l’îlot augmente de 1,084 points de pourcentage pour chaque différence d’un point de pourcentage d’enfants de moins de 15 ans. Toutes choses étant égales par ailleurs, une augmentation de 10nbsp;% d’enfants dans un îlot entraîne alors une hausse de 10,8nbsp;% de la couverture végétale dans l’îlot.</p>
<p>L’analyse des coefficients montre ainsi qu’une fois contrôlées les deux caractéristiques relatives à la forme urbaine (densité de population et âge médian des bâtiments), plus les pourcentages d’enfants et de personnes âgées sont élevés, plus la couverture végétale de l’îlot est importante (B = 1,084 et 0,401), toutes choses étant égales par ailleurs. À l’inverse, de plus grands pourcentages de personnes à faible revenu et de minorités sont associés à une plus faible couverture végétale (B = −0,348 et −0,031).</p>
<p><strong>L’erreur type du coefficient de régression</strong></p>
<p>L’erreur type d’un coefficient permet d’évaluer son niveau de précision, soit le degré d’incertitude vis-à-vis du coefficient. Succinctement, elle correspond à l’écart-type de l’estimation (coefficient); elle est ainsi toujours positive. Plus la valeur de l’erreur type est faible, plus l’estimation du coefficient est précise. Notez toutefois qu’il n’est pas judicieux de comparer les erreurs types des coefficients pour des variables exprimées dans des unités de mesure différentes.</p>
<p>Comme nous le verrons plus loin, l’utilité principale de l’erreur type est qu’elle permet de calculer la valeur de <em>t</em> et l’intervalle de confiance du coefficient de régression.</p>
</div>
<div id="sect0742" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Coefficients de régression standardisés : repérer les variables les plus importantes du modèle</h3>
<p>Un coefficient de régression est exprimé dans les unités de mesure des variables indépendante (VI) et dépendante (VD) : une augmentation d’une unité de la VI a un effet de <span class="math inline">\(\beta\)</span> (valeur de coefficient) unité de mesure sur la VD, toutes choses étant égales par ailleurs. Prenons l’exemple d’un modèle fictif dans lequel une variable indépendante mesurée en mètres obtient un coefficient de régression de 0,000502. Si cette variable était exprimée en kilomètres et non en mètres, son coefficient serait alors de 0,502 (<span class="math inline">\(0,000502 \times 1000 = 0,502\)</span>). Cela explique que pour certaines variables, il est souvent préférable de modifier l’unité de mesure, particulièrement pour les variables de distance ou de revenu. Par exemple, dans un modèle de régression, nous introduisons habituellement une variable de revenu par tranche de mille dollars ou le loyer mensuel par tranche de cent dollars, puisque les coefficients du revenu ou de loyer exprimé en dollars risquent d’être extrêmement faibles. Concrètement, cela signifie que nous divisons la variable <em>revenu</em> par 1000 et celle du <em>loyer</em> par 100 avant de l’introduire dans le modèle.</p>
<p>Du fait de leur unités de mesure souvent différentes, vous aurez compris que nous ne pouvons pas comparer directement les coefficients de régression afin de repérer la ou les variables indépendantes (<em>X</em>) qui ont les effets (impacts) les plus importants sur la variable dépendante (<em>Y</em>). Pour remédier à ce problème, nous utilisons les <strong>coefficients de régression standardisés</strong>. Ces coefficients standardisés sont simplement les valeurs de coefficients de régression qui seraient obtenus si toutes les variables du modèle (VD et VI) étaient préalablement centrées réduites (soit avec une moyenne égale à 0 et un écart-type égal à 1; consultez la section @ref(sect02552) pour un rappel). Puisque toutes les variables du modèle sont exprimées en écarts-types, les coefficients standardisés permettent ainsi d’évaluer <strong>l’effet relatif</strong> des VI sur la VD. Cela permet ainsi de repérer la ou les variables les plus « importantes » du modèle.</p>
<p><strong>L’interprétation d’un coefficient de régression standardisé est donc la suivante : il indique le changement en termes d’unités d’écart-type de la variable dépendante (Y) à chaque ajout d’un écart-type de la variable indépendante, toutes choses étant égales par ailleurs</strong>.</p>
<p>Le coefficient de régression standardisé peut être aussi facilement calculé en utilisant les écarts-types des deux variables VI et VD :</p>

<p><span class="math display">\[\begin{equation}
\beta_{z}= \beta \frac{s_x}{s_y}
(\#eq:CoefStand)
\end{equation}\]</span>
</p>
<p>La syntaxe R ci-dessous illustre trois façons d’obtenir les coefficients standardisés :</p>
<ul>
<li>en centrant et réduisant préalablement les variables avec la fonction <code>scale</code> avant de construire le modèle avec la fonction <code>lm</code>;</li>
<li>en calculant les écarts-types de VD et de VI et en appliquant l’équation @ref(eq:CoefStand);</li>
<li>avec la fonction <code>lm.beta</code> du <em>package</em> <code>QuantPsyc</code>. Cette dernière méthode est moins « verbeuse » (deux lignes de code uniquement), mais nécessite de charger un <em>package</em> supplémentaire.</li>
</ul>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="#cb649-1"></a><span class="co"># Modèle de régression</span></span>
<span id="cb649-2"><a href="#cb649-2"></a>Modele1 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span>AgeMedian<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal)</span>
<span id="cb649-3"><a href="#cb649-3"></a></span>
<span id="cb649-4"><a href="#cb649-4"></a><span class="co">#  Méthode 1 : lm sur des variables centrées réduites</span></span>
<span id="cb649-5"><a href="#cb649-5"></a>ModeleZ &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">scale</span>(VegPct) <span class="op">~</span><span class="st"> </span><span class="kw">scale</span>(HABHA)<span class="op">+</span><span class="kw">scale</span>(AgeMedian)<span class="op">+</span></span>
<span id="cb649-6"><a href="#cb649-6"></a><span class="st">                           </span><span class="kw">scale</span>(Pct_<span class="dv">014</span>)<span class="op">+</span><span class="kw">scale</span>(Pct_65P)<span class="op">+</span></span>
<span id="cb649-7"><a href="#cb649-7"></a><span class="st">                           </span><span class="kw">scale</span>(Pct_MV)<span class="op">+</span><span class="kw">scale</span>(Pct_FR), <span class="dt">data =</span> DataFinal)</span>
<span id="cb649-8"><a href="#cb649-8"></a>coefs &lt;-<span class="st"> </span>ModeleZ<span class="op">$</span>coefficients</span>
<span id="cb649-9"><a href="#cb649-9"></a>coefs[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(coefs)]</span></code></pre></div>
<pre><code>##      (Intercept)     scale(HABHA) scale(AgeMedian)   scale(Pct_014) 
##     3.721649e-16    -2.806891e-01     1.467299e-02     3.093456e-01 
##   scale(Pct_65P)    scale(Pct_MV)    scale(Pct_FR) 
##     1.788453e-01    -2.755087e-02    -3.004544e-01</code></pre>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="#cb651-1"></a><span class="co">#  Méthode 2 : à partir de l&#39;équation</span></span>
<span id="cb651-2"><a href="#cb651-2"></a><span class="co"># Écart-type de la variable dépendante</span></span>
<span id="cb651-3"><a href="#cb651-3"></a>VDet &lt;-<span class="st"> </span><span class="kw">sd</span>(DataFinal<span class="op">$</span>VegPct)</span>
<span id="cb651-4"><a href="#cb651-4"></a><span class="kw">cat</span>(<span class="st">&quot;Écart-type de Y =&quot;</span>, <span class="kw">round</span>(VDet,<span class="dv">3</span>))</span></code></pre></div>
<pre><code>## Écart-type de Y = 18.562</code></pre>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="#cb653-1"></a><span class="co"># Écarts-types des variables indépendantes</span></span>
<span id="cb653-2"><a href="#cb653-2"></a>VI &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;HABHA&quot;</span>,<span class="st">&quot;AgeMedian&quot;</span>,<span class="st">&quot;Pct_014&quot;</span>,<span class="st">&quot;Pct_65P&quot;</span>,<span class="st">&quot;Pct_MV&quot;</span>,<span class="st">&quot;Pct_FR&quot;</span>)</span>
<span id="cb653-3"><a href="#cb653-3"></a>VIet &lt;-<span class="st"> </span><span class="kw">sapply</span>(DataFinal[VI], sd)</span>
<span id="cb653-4"><a href="#cb653-4"></a><span class="co"># Coefficients de régression du modèle sans la constante</span></span>
<span id="cb653-5"><a href="#cb653-5"></a>coefs &lt;-<span class="st"> </span>Modele1<span class="op">$</span>coefficients[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(VIet)<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb653-6"><a href="#cb653-6"></a><span class="co"># Coefficients de régression du modèle</span></span>
<span id="cb653-7"><a href="#cb653-7"></a>coefstand &lt;-<span class="st"> </span>coefs <span class="op">*</span><span class="st"> </span>(VIet <span class="op">/</span><span class="st"> </span>VDet)</span>
<span id="cb653-8"><a href="#cb653-8"></a>coefstand</span></code></pre></div>
<pre><code>##       HABHA   AgeMedian     Pct_014     Pct_65P      Pct_MV      Pct_FR 
## -0.28068906  0.01467299  0.30934560  0.17884535 -0.02755087 -0.30045437</code></pre>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="#cb655-1"></a><span class="co">#  Méthode 3 : avec la fonction lm.beta du package QuantPsyc</span></span>
<span id="cb655-2"><a href="#cb655-2"></a><span class="kw">library</span>(QuantPsyc)</span>
<span id="cb655-3"><a href="#cb655-3"></a><span class="kw">lm.beta</span>(<span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span>AgeMedian<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal))</span></code></pre></div>
<pre><code>##       HABHA   AgeMedian     Pct_014     Pct_65P      Pct_MV      Pct_FR 
## -0.28068906  0.01467299  0.30934560  0.17884535 -0.02755087 -0.30045437</code></pre>
<table>
<caption>
(#tab:CoefStand2)Calcul des coefficients standardisés
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable dépendante
</th>
<th style="text-align:right;">
Écart-type
</th>
<th style="text-align:right;">
Coef.
</th>
<th style="text-align:right;">
Coef. standardisé
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
HABHA
</td>
<td style="text-align:right;">
74,008
</td>
<td style="text-align:right;">
-0,070
</td>
<td style="text-align:right;">
-0,281
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian
</td>
<td style="text-align:right;">
25,241
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
0,015
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
5,295
</td>
<td style="text-align:right;">
1,084
</td>
<td style="text-align:right;">
0,309
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
8,289
</td>
<td style="text-align:right;">
0,401
</td>
<td style="text-align:right;">
0,179
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
16,438
</td>
<td style="text-align:right;">
-0,031
</td>
<td style="text-align:right;">
-0,028
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
16,015
</td>
<td style="text-align:right;">
-0,348
</td>
<td style="text-align:right;">
-0,300
</td>
</tr>
</tbody>
</table>
<p>Par exemple, pour la variable <code>Pct_014</code>, le coefficient de régression standardisé est égal à :</p>

<p><span class="math display">\[\begin{equation}
\beta_{z}= 1,084 \times \frac{5,295}{18,562}=0,309
(\#eq:CoefStand2)
\end{equation}\]</span>
</p>
<p>avec 1,084 étant le coefficient de régression de <code>Pct_014</code>, 5,295 et 18,562 étant respectivement les écarts-types de <code>Pct_014</code> (variable indépendante) et de <code>VegPct</code> (variable dépendante).</p>
<p>Au tableau @ref(tab:CoefStand2), nous constatons que la valeur absolue du coefficient de régression pour <code>HABHA</code> est inférieure à celle de <code>Pct_65P</code> (−0,070 <em>versus</em> 0,401), ce qui n’est pas le cas pour leur coefficient standardisé (−0,281 <em>versus</em> 0,179). Rappelez-vous aussi que nous ne pouvons pas directement comparer les effets de ces deux variables à partir des coefficients de régression puisqu’elles sont exprimées dans des unités de mesure différentes : <code>HABHA</code> est exprimée en habitants par hectare et <code>Pct_65P</code> en pourcentage. À la lecture des coefficients standardisés, nous pouvons en conclure que la variable <code>HABHA</code> a un effet relatif plus important que <code>Pct_65P</code> (−0,281 <em>versus</em> 0,179).</p>
</div>
<div id="sect0743" class="section level3">
<h3><span class="header-section-number">7.4.3</span> Significativité des coefficients de régression : valeurs de <em>t</em> et de <em>p</em></h3>
<p>Une fois les coefficients de régression obtenus, il convient de vérifier s’ils sont ou non significativement différents de 0. Si le coefficient de régression d’une variable indépendante est significativement différent de 0, nous concluons que la variable a un effet significatif sur la variable dépendante, toutes choses étant égales par ailleurs. Pour ce faire, il suffit de calculer la valeur de <em>t</em> qui est simplement le coefficient de régression divisé par son erreur type.</p>

<p><span class="math display">\[\begin{equation} 
t=\frac{\beta_k - 0}{s(\beta_k)}  
(\#eq:ValeurT)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(s(\beta_k)\)</span> étant l’erreur type du coefficient de régression. Notez que dans l’équation @ref(eq:ValeurT), nous indiquons habituellement <span class="math inline">\(-0\)</span>, pour signaler que l’on veut vérifier si le coefficient est différent de 0. En guise d’exemple, au tableau @ref(tab:dataregmodel2), la valeur de <em>t</em> de la variable <code>HABHA</code> est bien égale à :</p>
<p><span class="math inline">\(\mbox{−0,070401 / 0,002202 = −31,975}\)</span>.</p>
<div class="bloc_attention">
<p><strong>Démarche pour vérifier si un coefficient est significativement différent de 0 avec un seuil de confiance</strong></p>
<ol style="list-style-type: decimal">
<li>Poser l’hypothèse nulle (<em>H<sub>0</sub></em>) stipulant que le coefficient est égal à 0, soit <span class="math inline">\(H_0 : \beta_k = 0\)</span>. L’hypothèse alternative (<em>H<sub>1</sub></em>) est que le coefficient est différent de 0, soit <span class="math inline">\(H_1 : B_k \neq 0\)</span>.</li>
<li>Calculer la valeur de <em>t</em>, soit le coefficient de régression divisé par son erreur type (équation @ref(eq:ValeurT)).</li>
<li>Calculer le nombre de degrés de liberté, soit <span class="math inline">\(dl = n − k - 1\)</span>, <em>n</em> et <em>k</em> étant respectivement les nombres d’observations et de variables indépendantes.</li>
<li>Choisir un seuil de signification alpha (5 %, 1 % ou 0,1 %, soit <em>p</em> = 0,05, 0,01 ou 0,01).</li>
<li>Trouver la valeur critique de <em>t</em> dans la table T de Student (@ref(annexe3)) avec <em>p</em> et le nombre de degrés de liberté (<em>dl</em>).</li>
<li>Valider ou réfuter l’hypothèse nulle (<em>H<sub>0</sub></em>) :</li>
</ol>
<ul>
<li>si la valeur de <em>t</em> est inférieure à la valeur critique de <em>t</em> avec <em>dl</em> et le seuil choisi, nous confirmons <em>H<sub>0</sub></em> : le coefficient n’est pas significativement différent de 0.</li>
<li>si la valeur de <em>t</em> est supérieure à la valeur critique de <em>t</em> avec <em>dl</em> et le seuil choisi, nous réfutons l’hypothèse nulle, et choisissons l’hypothèse alternative (<em>H<sub>1</sub></em>) stipulant que le coefficient est significativement différent de 0.</li>
</ul>
<p><strong>Valeurs critiques de la valeur de <em>t</em> à retenir!</strong></p>
<p>Lorsque le nombre de degrés de liberté (<em>n − k - 1</em>) est très important (supérieur à 2500), et donc le nombre d’observations de votre jeu de données, nous retenons habituellement les valeurs critiques suivantes : <strong>1,65 (<em>p</em> = 0,10), 1,96 (<em>p</em> = 0,05)</strong>, <strong>2,58 (<em>p</em> = 0,01)</strong> et <strong>3,29 (<em>p</em>=0,001)</strong>. Concrètement, cela signifie que :</p>
<ul>
<li><p>une valeur de <em>t</em> supérieure à 1,96 ou inférieure à -1,96 nous informe que la relation entre la variable indépendante et la variable dépendante est significative positivement ou négativement au seuil de 5 %. Autrement dit, vous avez moins de 5 % de chances de vous tromper en affirmant que le coefficient de régression est bien significativement différent de 0.</p></li>
<li><p>une valeur de <em>t</em> supérieure à 2,58 ou inférieure à -2,58 nous informe que la relation entre la variable indépendante et la variable dépendante est significative positivement ou négativement au seuil de 5 %. Autrement dit, vous avez moins de 1 % de chances de vous tromper en affirmant que le coefficient de régression est bien significativement différent de 0.</p></li>
<li><p>une valeur de <em>t</em> supérieure à 3,29 ou inférieure à -3,29 nous informe que la relation entre la variable indépendante et la variable dépendante est significative positivement ou négativement au seuil de 5 %. Autrement dit, vous avez moins de 0,1 % de chances de vous tromper en affirmant que le coefficient de régression est bien significativement différent de 0.</p></li>
</ul>
<p>Concrètement, retenez et utilisez les seuils de <span class="math inline">\(\pm\mbox{1,96}\)</span>, <span class="math inline">\(\pm\mbox{2,58}\)</span> et <span class="math inline">\(\pm\mbox{3,29}\)</span> pour repérer les variables significatives positivement ou négativement aux seuils respectifs de 0,5, 0,1 et 0,001.</p>
<p><strong>Que signifient les seuils 0,10, 0,05 et 0,001?</strong></p>
<p>L’interprétation exacte des seuils de significativité des coefficients d’une régression est quelque peu alambiquée, mais mérite de s’y attarder. En effet, indiquer qu’un coefficient est significatif est souvent perçu comme un argument fort pour une théorie, il est donc nécessaire d’avoir du recul et de bien comprendre ce que l’on entend par <strong>significatif</strong>.</p>
<p>Si un coefficient est significatif au seuil de 5 % dans notre modèle, cela signifie que si, pour l’ensemble d’une population, la valeur du coefficient est de 0 en réalité, alors nous avions moins de 5 % de chances de collecter un échantillon (pour cette population) ayant produit un coefficient aussi fort que celui que nous observons dans notre propre échantillon. Par conséquent, il serait très invraisemblable que le coefficient soit 0 puisque nous avons effectivement collecté un tel échantillon. Il s’agit d’une forme d’argumentation par l’absurde propre à la statistique fréquentiste.</p>
<p>Notez que si 100 études étaient conduites sur le même sujet et dans les mêmes conditions, nous nous attendrions à ce que 5 d’entre elles trouvent un coefficient significatif, du fait de la variation des échantillons. Ce constat souligne le fait que la recherche est un effort collectif et qu’une seule étude n’est pas suffisante pour trancher sur un sujet. Les revues systématiques de la littérature sont donc des travaux particulièrement importants pour la construction du consensus scientifique.</p>
<p><strong>Ne pas confondre significativité et effet de la variable indépendante</strong></p>
<p>Attention, un coefficient significatif n’est pas toujours intéressant! Autrement dit, bien qu’il soit significatif à un seuil donné (par exemple, <em>p</em> = 0,05), cela ne veut pas dire pour autant qu’il ait un effet important sur la variable dépendante. Il faut donc analyser simultanément les valeurs de <em>p</em> et des coefficients de régression.
Afin de mieux saisir l’effet d’un coefficient significatif, il est intéressant de représenter graphiquement l’effet marginal d’une variable indépendante (VI) sur une variable dépendante (VD), une fois contrôlées les autres VI du modèle de régression (section @ref(sect0774)).</p>
</div>
<p>Prenons deux variables indépendantes du tableau @ref(tab:dataregmodel2) – <code>HABHA</code> et <code>AgeMedian</code> – et vérifions si leurs coefficients de régression respectifs (−0,070 et 0,011) sont significatifs. Appliquons la démarche décrite dans l’encadré ci-dessus :</p>
<ol style="list-style-type: decimal">
<li>Nous posons l’hypothèse nulle stipulant que la valeur de ces deux coefficients est égale à 0, soit <span class="math inline">\(H_0 : \beta_k = 0\)</span>.</li>
<li>La valeur de <em>t</em> est égale à <code>−0,070401 / 0,002202 = −31,97139</code> pour <code>HABHA</code> et à <code>0,010790 / 0,006369 = 1,694144</code> pour <code>AgeMedian</code>.</li>
<li>Le nombre de degrés de liberté est égal à <span class="math inline">\(\mbox{dl} = \mbox{n}-\mbox{k}-\mbox{1} = \mbox{10 210} − \mbox{6} - \mbox{1} = \mbox{10 203}\)</span>.</li>
<li>Nous choisissons respectivement les seuils <span class="math inline">\(\alpha\)</span> de 0,10, 0,05, 0,01 ou 0,001.</li>
<li>Avec 10210 degrés de liberté, les valeurs critiques de la table T de Student (section @ref(annexe3)) sont de 1,65 (<em>p</em> = 0,10), 1,96 (<em>p</em> = 0,05), 2,58 (<em>p</em> = 0,01), 3,29 (<em>p</em> = 0,001).</li>
<li>Il reste à valider ou réfuter l’hypothèse nulle (<em>H<sub>0</sub></em>) :</li>
</ol>
<ul>
<li><p>pour <code>HABHA</code>, la valeur absolue de <em>t</em> (−31,975) est supérieure à la valeur critique de 3,29. Son coefficient de régression est donc significativement différent de 0. Autrement dit, ce prédicteur a un effet significatif et négatif sur la variable dépendante.</p>
<ul>
<li>pour <code>AgeMedian</code>, la valeur absolue de <em>t</em> (1,694) est supérieure à 1,65 (<em>p</em> = 0,10), mais inférieure à 1,96 (<em>p</em> = 0,05), à 2,58 (<em>p</em> = 0,01), à 3,29 (<em>p</em> = 0,001). Par conséquent, ce coefficient est différent de 0 uniquement au seuil de <em>p</em> = 0,10 et non au seuil de <em>p</em> = 0,05. Cela signifie que bous avons un peu moins de 10 % de chances de se tromper en affirmant que cette variable a un effet significatif sur la variable dépendante.</li>
</ul></li>
</ul>
<div class="bloc_astuce">
<p><strong>Calculer et obtenir des valeurs de <em>p</em> dans R</strong></p>
<p>Il est très rare que d’utiliser directement la table <em>T</em> de Student pour obtenir un seuil de significativité.</p>
<p>D’une part, il est possible de calculer directement la valeur de <em>p</em> à partir de la valeur de <em>t</em> et du nombre de degrés de liberté avec la fonction <code>pt</code> avec les paramètres suivants :</p>
<p><code>pt(q= abs(valeur de T), df= nombre de degrés de liberté, lower.tail = F) *2</code></p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="#cb657-1"></a><span class="co"># Degrés de liberté</span></span>
<span id="cb657-2"><a href="#cb657-2"></a>dl &lt;-<span class="st"> </span><span class="kw">nrow</span>(DataFinal) <span class="op">-</span><span class="st"> </span>(<span class="kw">length</span>(Modele1<span class="op">$</span>coefficients) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb657-3"><a href="#cb657-3"></a></span>
<span id="cb657-4"><a href="#cb657-4"></a><span class="co"># Valeurs de T</span></span>
<span id="cb657-5"><a href="#cb657-5"></a>ValeurT &lt;-<span class="st"> </span><span class="kw">summary</span>(Modele1)<span class="op">$</span>coefficients[,<span class="dv">3</span>]</span>
<span id="cb657-6"><a href="#cb657-6"></a></span>
<span id="cb657-7"><a href="#cb657-7"></a><span class="co"># Calcul des valeurs de P</span></span>
<span id="cb657-8"><a href="#cb657-8"></a>ValeurP &lt;-<span class="st"> </span><span class="kw">pt</span>(<span class="dt">q=</span> <span class="kw">abs</span>(ValeurT), <span class="dt">df=</span> dl, <span class="dt">lower.tail =</span> F) <span class="op">*</span><span class="dv">2</span></span>
<span id="cb657-9"><a href="#cb657-9"></a></span>
<span id="cb657-10"><a href="#cb657-10"></a>df_tp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb657-11"><a href="#cb657-11"></a>                <span class="dt">ValeurT =</span> <span class="kw">round</span>(ValeurT,<span class="dv">3</span>), </span>
<span id="cb657-12"><a href="#cb657-12"></a>                <span class="dt">ValeurP =</span> <span class="kw">round</span>(ValeurP,<span class="dv">3</span>)</span>
<span id="cb657-13"><a href="#cb657-13"></a>)</span>
<span id="cb657-14"><a href="#cb657-14"></a><span class="kw">print</span>(df_tp)</span></code></pre></div>
<pre><code>##             ValeurT ValeurP
## (Intercept)  29.874   0.000
## HABHA       -31.975   0.000
## AgeMedian     1.694   0.090
## Pct_014      33.702   0.000
## Pct_65P      21.265   0.000
## Pct_MV       -2.990   0.003
## Pct_FR      -29.918   0.000</code></pre>
<p>D’autre part, la fonction <code>summary</code> renvoie d’emblée les valeurs de <em>t</em> et de <em>p</em>. Par convention, R, comme la plupart des logiciels d’analyses statistiques, utilise aussi des symboles pour indiquer le seuil de signification du coefficient (voir tableau @ref(tab:CoefStand2)) :</p>
<p>’***’ <em>p</em> &lt;= 0,001</p>
<p>’**’ <em>p</em> &lt;= 0,01</p>
<p>’*’ <em>p</em> &lt;= 0,05</p>
<p>‘.’ <em>p</em> &lt;= 0,10</p>
</div>
</div>
<div id="sect0744" class="section level3">
<h3><span class="header-section-number">7.4.4</span> Intervalle de confiance des coefficients</h3>
<p>Finalement, il est possible de calculer l’intervalle de confiance d’un coefficient à partir d’un niveau de signification (habituellement 0,95 ou encore 0,99). Pour ce faire, la fonction <code>confint(nom du modèle, level=.95)</code> est très utile. L’intérêt de ces intervalles de confiance pour les coefficients de régression est double :</p>
<ul>
<li>il permet de vérifier si le coefficient est ou non significatif au seuil retenu. Pour cela, la borne inférieure et la borne supérieure du coefficient doivent être toutes deux négatives ou positives. À l’inverse, un intervalle à cheval sur 0, soit avec une borne inférieure négative et une borne supérieure positive, n’est pas significatif.</li>
<li>il permet d’estimer la précision de l’estimation; plus l’intervalle du coefficient est réduit, plus l’estimation de l’effet de la variable indépendante est précise. Inversement, un intervalle large signale que le coefficient est incertain.</li>
</ul>
<p>Cela explique que de nombreux auteurs reportent les intervalles de confiance dans les articles scientifiques (habituellement à 95 %). Dans le modèle présenté ici, il est alors possible d’écrire : toutes choses étant égales par ailleurs, le pourcentage d’enfants de moins de 15 ans est positivement et significativement associé avec le pourcentage de la couverture végétale dans l’îlot (B = 1,084; IC 95 % = [1,021 - 1,148], <em>p</em> &lt; 0,001).</p>
<p>En guise d’exemple, à la lecture de la sortie R ci-dessous, l’estimation de l’effet de la variable indépendante <code>AgeMedian</code> sur la variable <code>VegPct</code> se situe dans l’intervalle -0,002 à 0,023 qui est à cheval sur 0. Contrairement aux autres variables, nous ne pouvons donc pas en conclure que cet effet est significatif avec <em>p</em> = 0,05.</p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="#cb659-1"></a><span class="co"># Intervalle de confiance à 95 % des coefficients</span></span>
<span id="cb659-2"><a href="#cb659-2"></a><span class="kw">round</span>(<span class="kw">confint</span>(Modele1, <span class="dt">level=</span>.<span class="dv">95</span>),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##              2.5 % 97.5 %
## (Intercept) 24.626 28.085
## HABHA       -0.075 -0.066
## AgeMedian   -0.002  0.023
## Pct_014      1.021  1.148
## Pct_65P      0.364  0.437
## Pct_MV      -0.052 -0.011
## Pct_FR      -0.371 -0.325</code></pre>
<div class="bloc_astuce">
<p><strong>Comment est calculé un intervalle de confiance?</strong></p>
<p>L’intervalle du coefficient est obtenu à partir de :</p>
<ol style="list-style-type: decimal">
<li>la valeur du coefficient (<span class="math inline">\(\beta_k\)</span>),</li>
<li>la valeur de son erreur type <span class="math inline">\(s(\beta_k)\)</span> et</li>
<li>la valeur critique de T (<span class="math inline">\(t_{\alpha/2}\)</span>) obtenue avec <span class="math inline">\(n-k-1\)</span> degrés de liberté et le niveau de significativité retenu (95 %, 99 % ou 99,9 %).</li>
</ol>
<p><span class="math display">\[\begin{equation}
IC_{\beta_k}=  \left[ \beta_k - t_{\alpha/2} \times s(\beta_k) ; \beta_k + t_{\alpha/2} \times s(\beta_k)  \right]
(\#eq:ICcoef)
\end{equation}\]</span>
</p>
<p>Autrement dit, lorsque vous disposez d’un nombre très important d’observations, les intervalles de confiance s’écrivent simplement avec les fameuses valeurs critiques de T de 1,96, 2,58, 3,29 :</p>
<p><span class="math display">\[\begin{equation}
\mbox{Intervalle à 95 \%\: } IC_{\beta_k}=  \left[ \beta_k - 1,96 \times s(\beta_k) ; \beta_k + 1,96 \times s(\beta_k)  \right]
(\#eq:IC95)
\end{equation}\]</span>
</p>
<p><span class="math display">\[\begin{equation}
\mbox{Intervalle à 99 \%\: } IC_{\beta_k}=  \left[ \beta_k - 2,58 \times s(\beta_k) ; \beta_k + 2,58 \times s(\beta_k)  \right]
(\#eq:IC99)
\end{equation}\]</span>
</p>
<p><span class="math display">\[\begin{equation}
\mbox{Intervalle à 99,9 \%\: } IC_{\beta_k}=  \left[ \beta_k - 3,29 \times s(\beta_k) ; \beta_k + 3,29 \times s(\beta_k)  \right]
(\#eq:IC999)
\end{equation}\]</span>
</p>
<p>La syntaxe R ci-dessous illustre comment calculer les intervalles de confiance à 95 % à partir de l’équation @ref(eq:ICcoef). Rappelez-vous toutefois qu’il est bien plus simple d’utiliser la fonction <code>confint</code>:</p>
<ul>
<li><code>round(confint(Modele1, level=.95),3)</code></li>
<li><code>round(confint(Modele1, level=.99),3)</code></li>
<li><code>round(confint(Modele1, level=.999),3)</code></li>
</ul>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="#cb661-1"></a><span class="co"># Coeffients de régression</span></span>
<span id="cb661-2"><a href="#cb661-2"></a>coefs &lt;-<span class="st"> </span>Modele1<span class="op">$</span>coefficients</span>
<span id="cb661-3"><a href="#cb661-3"></a></span>
<span id="cb661-4"><a href="#cb661-4"></a><span class="co"># Erreur type des coef.</span></span>
<span id="cb661-5"><a href="#cb661-5"></a>coefs_se &lt;-<span class="st"> </span><span class="kw">summary</span>(Modele1)<span class="op">$</span>coefficients[,<span class="dv">2</span>]</span>
<span id="cb661-6"><a href="#cb661-6"></a></span>
<span id="cb661-7"><a href="#cb661-7"></a><span class="co"># Nombre de degrés de liberté</span></span>
<span id="cb661-8"><a href="#cb661-8"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(Modele1<span class="op">$</span>fitted.values)</span>
<span id="cb661-9"><a href="#cb661-9"></a>k &lt;-<span class="st"> </span><span class="kw">length</span>(Modele1<span class="op">$</span>coefficients)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb661-10"><a href="#cb661-10"></a>dl &lt;-<span class="st"> </span>n<span class="op">-</span>k<span class="dv">-1</span></span>
<span id="cb661-11"><a href="#cb661-11"></a></span>
<span id="cb661-12"><a href="#cb661-12"></a><span class="co"># valeurs critiques de T</span></span>
<span id="cb661-13"><a href="#cb661-13"></a>t95 &lt;-<span class="st">  </span><span class="kw">qt</span>(<span class="dt">p=</span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="fl">0.05</span><span class="op">/</span><span class="dv">2</span>),  <span class="dt">df=</span>dl)</span>
<span id="cb661-14"><a href="#cb661-14"></a>t99 &lt;-<span class="st">  </span><span class="kw">qt</span>(<span class="dt">p=</span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="fl">0.01</span><span class="op">/</span><span class="dv">2</span>),  <span class="dt">df=</span>dl)</span>
<span id="cb661-15"><a href="#cb661-15"></a>t99<span class="fl">.9</span> &lt;-<span class="st">  </span><span class="kw">qt</span>(<span class="dt">p=</span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="fl">0.001</span><span class="op">/</span><span class="dv">2</span>),  <span class="dt">df=</span>dl)</span>
<span id="cb661-16"><a href="#cb661-16"></a><span class="kw">cat</span>(<span class="st">&quot;Valeurs critiques de T en fonction du niveau de confiance&quot;</span>,</span>
<span id="cb661-17"><a href="#cb661-17"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> et du nombre de degrés de liberté&quot;</span>,</span>
<span id="cb661-18"><a href="#cb661-18"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">95 % : &quot;</span>, t95,</span>
<span id="cb661-19"><a href="#cb661-19"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">99 % : &quot;</span>, t99,</span>
<span id="cb661-20"><a href="#cb661-20"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">99,9 % : &quot;</span>, t99<span class="fl">.9</span></span>
<span id="cb661-21"><a href="#cb661-21"></a>    )</span></code></pre></div>
<pre><code>## Valeurs critiques de T en fonction du niveau de confiance 
##  et du nombre de degrés de liberté 
## 95 % :  1.960197 
## 99 % :  2.576311 
## 99,9 % :  3.291481</code></pre>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb663-1"><a href="#cb663-1"></a><span class="co"># Intervalle de confiance à 95</span></span>
<span id="cb663-2"><a href="#cb663-2"></a></span>
<span id="cb663-3"><a href="#cb663-3"></a><span class="kw">data.frame</span>(</span>
<span id="cb663-4"><a href="#cb663-4"></a>  <span class="dt">IC2.5  =</span> <span class="kw">round</span>(coefs<span class="op">-</span>t95<span class="op">*</span>coefs_se,<span class="dv">3</span>),</span>
<span id="cb663-5"><a href="#cb663-5"></a>  <span class="dt">IC97.5 =</span> <span class="kw">round</span>(coefs<span class="op">+</span>t95<span class="op">*</span>coefs_se,<span class="dv">3</span>)</span>
<span id="cb663-6"><a href="#cb663-6"></a>  )</span></code></pre></div>
<pre><code>##              IC2.5 IC97.5
## (Intercept) 24.626 28.085
## HABHA       -0.075 -0.066
## AgeMedian   -0.002  0.023
## Pct_014      1.021  1.148
## Pct_65P      0.364  0.437
## Pct_MV      -0.052 -0.011
## Pct_FR      -0.371 -0.325</code></pre>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb665-1"><a href="#cb665-1"></a><span class="co"># Intervalle de confiance à 99</span></span>
<span id="cb665-2"><a href="#cb665-2"></a></span>
<span id="cb665-3"><a href="#cb665-3"></a><span class="kw">data.frame</span>(</span>
<span id="cb665-4"><a href="#cb665-4"></a>  <span class="dt">IC0.5 =</span> <span class="kw">round</span>(coefs<span class="op">-</span>t99<span class="op">*</span>coefs_se,<span class="dv">3</span>),</span>
<span id="cb665-5"><a href="#cb665-5"></a>  <span class="dt">IC99.5 =</span> <span class="kw">round</span>(coefs<span class="op">+</span>t99<span class="op">*</span>coefs_se,<span class="dv">3</span>)</span>
<span id="cb665-6"><a href="#cb665-6"></a>)</span></code></pre></div>
<pre><code>##              IC0.5 IC99.5
## (Intercept) 24.083 28.629
## HABHA       -0.076 -0.065
## AgeMedian   -0.006  0.027
## Pct_014      1.002  1.167
## Pct_65P      0.352  0.449
## Pct_MV      -0.058 -0.004
## Pct_FR      -0.378 -0.318</code></pre>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="#cb667-1"></a><span class="co"># Intervalle de confiance à 99.9</span></span>
<span id="cb667-2"><a href="#cb667-2"></a><span class="kw">data.frame</span>(</span>
<span id="cb667-3"><a href="#cb667-3"></a>  <span class="dt">IC0.05 =</span> <span class="kw">round</span>(coefs<span class="op">-</span>t99<span class="fl">.9</span><span class="op">*</span>coefs_se,<span class="dv">3</span>),</span>
<span id="cb667-4"><a href="#cb667-4"></a>  <span class="dt">IC99.95 =</span> <span class="kw">round</span>(coefs<span class="op">+</span>t99<span class="fl">.9</span><span class="op">*</span>coefs_se,<span class="dv">3</span>)</span>
<span id="cb667-5"><a href="#cb667-5"></a>  )</span></code></pre></div>
<pre><code>##             IC0.05 IC99.95
## (Intercept) 23.452  29.260
## HABHA       -0.078  -0.063
## AgeMedian   -0.010   0.032
## Pct_014      0.979   1.190
## Pct_65P      0.339   0.463
## Pct_MV      -0.065   0.003
## Pct_FR      -0.387  -0.310</code></pre>
</div>
</div>
</div>
<div id="sect075" class="section level2">
<h2><span class="header-section-number">7.5</span> Introduction de variables explicatives particulières</h2>
<div id="sect0751" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Exploration des relations non linéaires</h3>
<div id="sect07511" class="section level4">
<h4><span class="header-section-number">7.5.1.1</span> Variable indépendante avec une fonction polynomiale</h4>
<p>Dans la section @ref(sect041), nous avons vu que la relation entre deux variables continues n’est pas toujours linéaire; elle peut être aussi curvilinéaire. Pour explorer les relations curvilinéaires, nous introduisons la variable indépendante sous la forme polynomiale d’ordre 2 (voir le prochain encadré). L’équation de régression s’écrit alors :</p>

<p><span class="math display">\[\begin{equation}
Y = b_{0} + b_{1}X_{1} + b_{11}X_{1}^2 + b_{2}X_{2} +\ldots+ b_{k}X_{k} + e
(\#eq:regpolyordre2)
\end{equation}\]</span>
</p>
<p>Dans l’équation @ref(eq:regpolyordre2), la première variable indépendante est introduite dans le modèle de régression à la fois dans sa forme originelle et mise au carré : <span class="math inline">\(b_{1}X_{1} + b_{11}X_{1}^2\)</span>. Un coefficient différent est ajusté pour chacune de ces deux versions de la variable <span class="math inline">\(X_{1}\)</span>.</p>
<p>La démographie est probablement la discipline des sciences sociales qui a le plus recours aux régressions polynomiales. En effet, la variable <code>âge</code> est souvent introduite comme variable explicative dans sa forme originale et mise au carré. L’objectif est de vérifier si l’âge partage ou non une relation curvilinéaire avec un phénomène donné : par exemple, il pourrait y être associé positivement jusqu’à un certain seuil (45 ans par exemple), puis négativement à partir de ce seuil.</p>
<div class="bloc_aller_loin">
<p><strong>Régression polynomiale et nombre d’ordres</strong>.</p>
<p>Sachez qu’il est aussi possible de construire des régressions polynomiales avec plus deux ordres. Par exemple, une régression polynomiale d’ordre 3 comprend une variable dans sa forme originelle, puis mise au carré et au cube. Cela a l’inconvénient d’augmenter corollairement le nombre de coefficients. Nous verrons au chapitre @ref(chap11) qu’il existe une solution plus élégante et efficace : le recours aux modèles de régressions linéaires généralisés additifs avec des <em>splines</em>. Dans le cadre de cette section, nous nous limitons à des régressions polynomiales d’ordre 2.</p>
<p><span class="math display">\[\begin{equation}
\mbox{Ordre 2 : } Y = b_{0} + b_{1}X_{1} + b_{11}X_{}^2 + b_{2}X_{2} +\ldots+ b_{k}X_{k} + e
(\#eq:regpolyordre2b)
\end{equation}\]</span>
</p>
<p><span class="math display">\[\begin{equation}
\mbox{Ordre 3 : } Y = b_{0} + b_{1}X_{1} + b_{11}X_{}^2 + b_{111}X_{}^3 + b_{2}X_{2} +\ldots+ b_{k}X_{k} + e
(\#eq:regpolyordre3)
\end{equation}\]</span>
</p>
<p><span class="math display">\[\begin{equation}
\mbox{Ordre 4 : } Y = b_{0} + b_{1}X_{1} + b_{11}X_{}^2 + b_{111}X_{}^3 + b_{1111}X_{}^4 + b_{2}X_{2} +\ldots+ b_{k}X_{k} + e
(\#eq:regpolyordre4)
\end{equation}\]</span>
</p>
</div>
<p>Pour construire une régression polynomiale dans R, il est possible d’utiliser deux fonctions de R :</p>
<ul>
<li><code>I(VI^2)</code> avec <code>VI</code> qui est la variable indépendante sur laquelle est appliquée la mise au carré.</li>
<li><code>poly(VI,2)</code> qui utilise une forme polynomiale orthogonale pour éviter les problèmes de corrélation entre les deux termes, c’est-à-dire entre <strong>VI</strong> et <strong>VI<sup>2</sup></strong>.</li>
</ul>
<p>Ces deux méthodes produisent les mêmes résultats pour les autres variables dépendantes et pour la qualité d’ajustement du modèle (R<sup>2</sup>, F, etc.). Nous privilégions la seconde fonction pour éviter de détecter à tort des problèmes de multicolinéarité excessive.</p>
<p>Appliquons cette démarche à la variable <code>AgeMedian</code> (âge médian des bâtiments) afin de vérifier si elle partage ou non une relation curvilinéaire avec la couverture végétale de l’îlot. À la lecture des résultats pour les deux modèles, les constats suivants peuvent être avancés :</p>
<ul>
<li>Le R<sup>2</sup> ajusté passe de 0,4179 à 0,4378 du modèle 1 au modèle 2, ce qui signale un gain de variance expliquée.</li>
<li>Le <em>F</em> incrémentiel entre les deux modèles s’élève à 362,64 et est significatif (<em>p</em> &lt; 0,001). Nous pouvons donc en conclure que le second modèle est plus performant que le premier, ce qui signale que la forme curvilinéaire pour <code>AgeMedian</code> (modèle 2) est plus efficace que la forme linéaire (modèle 1).</li>
<li>Dans le premier modèle, le coefficient de régression pour <code>AgeMedian</code> n’est pas significatif. L’âge médian des bâtiments n’est donc pas associé linéairement avec la variable dépendante.</li>
<li>Dans le second modèle, la valeur du coefficient de <code>poly(AgeMedian, 2)1</code> est positive et celle de <code>poly(AgeMedian, 2)2</code> est négative et significative. Cela indique qu’il existe une relation linéaire en forme de U inversé. Si le premier coefficient avait été négatif et le second positif, nous aurions alors conclu que la forme curvilinéaire prend la forme d’un U.</li>
</ul>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="#cb669-1"></a><span class="co"># régression linéaire</span></span>
<span id="cb669-2"><a href="#cb669-2"></a>modele1 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span>AgeMedian<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal)</span>
<span id="cb669-3"><a href="#cb669-3"></a></span>
<span id="cb669-4"><a href="#cb669-4"></a><span class="co"># régression polynomiale</span></span>
<span id="cb669-5"><a href="#cb669-5"></a>modele2 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal)</span>
<span id="cb669-6"><a href="#cb669-6"></a></span>
<span id="cb669-7"><a href="#cb669-7"></a><span class="co"># affichage des résultats du modèle 1</span></span>
<span id="cb669-8"><a href="#cb669-8"></a><span class="kw">summary</span>(modele1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = VegPct ~ HABHA + AgeMedian + Pct_014 + Pct_65P + 
##     Pct_MV + Pct_FR, data = DataFinal)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -48.876  -9.757  -0.232   9.499 103.830 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 26.355774   0.882235  29.874   &lt;2e-16 ***
## HABHA       -0.070401   0.002202 -31.975   &lt;2e-16 ***
## AgeMedian    0.010790   0.006369   1.694   0.0902 .  
## Pct_014      1.084478   0.032179  33.702   &lt;2e-16 ***
## Pct_65P      0.400531   0.018835  21.265   &lt;2e-16 ***
## Pct_MV      -0.031112   0.010406  -2.990   0.0028 ** 
## Pct_FR      -0.348256   0.011640 -29.918   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 14.16 on 10203 degrees of freedom
## Multiple R-squared:  0.4182, Adjusted R-squared:  0.4179 
## F-statistic:  1223 on 6 and 10203 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="#cb671-1"></a><span class="co"># affichage des résultats du modèle 1</span></span>
<span id="cb671-2"><a href="#cb671-2"></a><span class="kw">summary</span>(modele2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = VegPct ~ HABHA + poly(AgeMedian, 2) + Pct_014 + 
##     Pct_65P + Pct_MV + Pct_FR, data = DataFinal)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -49.659  -9.361  -0.159   9.034 105.160 
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)          2.968e+01  7.535e-01  39.383  &lt; 2e-16 ***
## HABHA               -7.107e-02  2.164e-03 -32.839  &lt; 2e-16 ***
## poly(AgeMedian, 2)1  1.134e+01  1.598e+01   0.710  0.47788    
## poly(AgeMedian, 2)2 -2.721e+02  1.429e+01 -19.043  &lt; 2e-16 ***
## Pct_014              9.969e-01  3.196e-02  31.198  &lt; 2e-16 ***
## Pct_65P              3.219e-01  1.896e-02  16.972  &lt; 2e-16 ***
## Pct_MV              -2.888e-02  1.023e-02  -2.823  0.00476 ** 
## Pct_FR              -3.562e-01  1.145e-02 -31.116  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 13.92 on 10202 degrees of freedom
## Multiple R-squared:  0.4382, Adjusted R-squared:  0.4378 
## F-statistic:  1137 on 7 and 10202 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="#cb673-1"></a><span class="co"># test de Fisher pour comparer les modèles</span></span>
<span id="cb673-2"><a href="#cb673-2"></a><span class="kw">anova</span>(modele1, modele2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: VegPct ~ HABHA + AgeMedian + Pct_014 + Pct_65P + Pct_MV + Pct_FR
## Model 2: VegPct ~ HABHA + poly(AgeMedian, 2) + Pct_014 + Pct_65P + Pct_MV + 
##     Pct_FR
##   Res.Df     RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1  10203 2046427                                  
## 2  10202 1976182  1     70245 362.64 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong>Construction d’un graphique des effets marginaux</strong></p>
<p>Pour visualiser la relation linéaire et curvilinéaire, nous vous proposons de réaliser un graphique des effets marginaux à partir de la syntaxe ci-dessous.</p>
<p>Les graphiques des effets marginaux permettent de visualiser l’impact d’une variable indépendante sur la variable dépendante d’une régression. Nous nous basons pour cela sur les prédictions effectuées par le modèle. Admettons que nous nous intéressons à l’effet de la variable <em>X<sub>1</sub></em> sur la variable <em>Y</em>. Il est possible de créer de nouvelles données fictives pour lesquelles l’ensemble des autres variables <em>X</em> sont fixées à leur moyenne respective, et seule <em>X<sub>1</sub></em> est autorisée à varier. En utilisant l’équation de régression du modèle sur ces données fictives, nous pouvons observer l’évolution de la valeur prédite de <em>Y</em> quand <em>X<sub>1</sub></em> augmente ou diminue, et ce, toutes choses étant égales par ailleurs (puisque toutes les autres variables ont une valeur fixe). Cette approche est particulièrement intéressante pour décrire des effets non linéaires obtenus avec des polynomiales, mais aussi des interactions comme nous le verrons plus tard. Elle est également utilisée dans les modèles linéaires généralisés (GLM) et additifs (GAM) (chapitres @ref(chap08) et @ref(chap11)). Notez qu’il est aussi important de représenter, sur ce type de graphique, l’incertitude de la prédiction. Pour cela, il est possible de construire des intervalles de confiance à 95 % autour de la prédiction en utilisant l’erreur standard de la prédiction (renvoyée par la fonction <code>predict</code>).</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="#cb675-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb675-2"><a href="#cb675-2"></a><span class="co"># Statistique sur la variable AgeMedian qui varie de 0 à 226 ans</span></span>
<span id="cb675-3"><a href="#cb675-3"></a><span class="kw">summary</span>(DataFinal<span class="op">$</span>AgeMedian)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    0.00   37.25   49.00   52.11   61.00  226.00</code></pre>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="#cb677-1"></a><span class="co"># Création d&#39;un DataFrame temporaire</span></span>
<span id="cb677-2"><a href="#cb677-2"></a><span class="co"># remarquez que les autres variables indépendantes sont constantes :</span></span>
<span id="cb677-3"><a href="#cb677-3"></a><span class="co"># nous leur avons attribué leur moyenne correspondante</span></span>
<span id="cb677-4"><a href="#cb677-4"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb677-5"><a href="#cb677-5"></a>  <span class="dt">HABHA =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>HABHA),</span>
<span id="cb677-6"><a href="#cb677-6"></a>  <span class="dt">AgeMedian=</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">200</span>, <span class="dt">by =</span> <span class="dv">2</span>),</span>
<span id="cb677-7"><a href="#cb677-7"></a>  <span class="dt">AgeMedian2 =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">200</span>, <span class="dt">by =</span> <span class="dv">2</span>)<span class="op">**</span><span class="dv">2</span>,</span>
<span id="cb677-8"><a href="#cb677-8"></a>  <span class="dt">Pct_014=</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>Pct_<span class="dv">014</span>),</span>
<span id="cb677-9"><a href="#cb677-9"></a>  <span class="dt">Pct_65P=</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>Pct_65P),</span>
<span id="cb677-10"><a href="#cb677-10"></a>  <span class="dt">Pct_MV=</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>Pct_MV),</span>
<span id="cb677-11"><a href="#cb677-11"></a>  <span class="dt">Pct_FR=</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>Pct_FR)</span>
<span id="cb677-12"><a href="#cb677-12"></a>)</span>
<span id="cb677-13"><a href="#cb677-13"></a></span>
<span id="cb677-14"><a href="#cb677-14"></a><span class="co"># calcul de la valeur de t pour un intervalle à 95 %</span></span>
<span id="cb677-15"><a href="#cb677-15"></a>n &lt;-<span class="st"> </span><span class="kw">length</span>(modele1<span class="op">$</span>fitted.values) </span>
<span id="cb677-16"><a href="#cb677-16"></a>k &lt;-<span class="st"> </span><span class="kw">length</span>(modele1<span class="op">$</span>coefficients)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb677-17"><a href="#cb677-17"></a>t95 &lt;-<span class="st"> </span><span class="kw">qt</span>(<span class="dt">p=</span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="fl">0.05</span><span class="op">/</span><span class="dv">2</span>),  <span class="dt">df=</span>n<span class="op">-</span>k<span class="dv">-1</span>)</span>
<span id="cb677-18"><a href="#cb677-18"></a></span>
<span id="cb677-19"><a href="#cb677-19"></a><span class="co"># Calcul des valeurs prédites pour le 1er modèle</span></span>
<span id="cb677-20"><a href="#cb677-20"></a><span class="co"># avec l&#39;intervalle de confiance à 95 %</span></span>
<span id="cb677-21"><a href="#cb677-21"></a>predsM1 &lt;-<span class="st"> </span><span class="kw">predict</span>(modele1,<span class="dt">se =</span> T, <span class="dt">newdata =</span> df)</span>
<span id="cb677-22"><a href="#cb677-22"></a>df<span class="op">$</span>predM1 &lt;-<span class="st"> </span>predsM1<span class="op">$</span>fit</span>
<span id="cb677-23"><a href="#cb677-23"></a>df<span class="op">$</span>lowerM1 &lt;-<span class="st"> </span>predsM1<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span>t95<span class="op">*</span>predsM1<span class="op">$</span>se.fit</span>
<span id="cb677-24"><a href="#cb677-24"></a>df<span class="op">$</span>upperM1 &lt;-<span class="st"> </span>predsM1<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span>t95<span class="op">*</span>predsM1<span class="op">$</span>se.fit</span>
<span id="cb677-25"><a href="#cb677-25"></a></span>
<span id="cb677-26"><a href="#cb677-26"></a><span class="co"># Calcul des valeurs prédites pour le 2e modèle</span></span>
<span id="cb677-27"><a href="#cb677-27"></a><span class="co"># avec l&#39;intervalle de confiance à 95 %</span></span>
<span id="cb677-28"><a href="#cb677-28"></a>predsM2 &lt;-<span class="st"> </span><span class="kw">predict</span>(modele2,<span class="dt">se =</span> T, <span class="dt">newdata =</span> df)</span>
<span id="cb677-29"><a href="#cb677-29"></a>df<span class="op">$</span>predM2 &lt;-<span class="st"> </span>predsM2<span class="op">$</span>fit</span>
<span id="cb677-30"><a href="#cb677-30"></a>df<span class="op">$</span>lowerM2 &lt;-<span class="st"> </span>predsM2<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span>t95<span class="op">*</span>predsM2<span class="op">$</span>se.fit</span>
<span id="cb677-31"><a href="#cb677-31"></a>df<span class="op">$</span>upperM2 &lt;-<span class="st"> </span>predsM2<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span>t95<span class="op">*</span>predsM2<span class="op">$</span>se.fit</span>
<span id="cb677-32"><a href="#cb677-32"></a></span>
<span id="cb677-33"><a href="#cb677-33"></a><span class="co"># Graphique</span></span>
<span id="cb677-34"><a href="#cb677-34"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb677-35"><a href="#cb677-35"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> AgeMedian, <span class="dt">ymin =</span> lowerM1, <span class="dt">ymax =</span> upperM1), </span>
<span id="cb677-36"><a href="#cb677-36"></a>             <span class="dt">fill =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb677-37"><a href="#cb677-37"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> AgeMedian, <span class="dt">y =</span> predM1), <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">size =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb677-38"><a href="#cb677-38"></a><span class="st">  </span></span>
<span id="cb677-39"><a href="#cb677-39"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> AgeMedian, <span class="dt">ymin =</span> lowerM2, <span class="dt">ymax =</span> upperM2), </span>
<span id="cb677-40"><a href="#cb677-40"></a>              <span class="dt">fill =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb677-41"><a href="#cb677-41"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> AgeMedian, <span class="dt">y =</span> predM2), <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb677-42"><a href="#cb677-42"></a><span class="st">  </span></span>
<span id="cb677-43"><a href="#cb677-43"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Effet marginal de l&#39;âge médian des bâtiments sur la&quot;</span>,</span>
<span id="cb677-44"><a href="#cb677-44"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;couverture végétale des îlots de l&#39;île de Montréal&quot;</span>,</span>
<span id="cb677-45"><a href="#cb677-45"></a>       <span class="dt">caption =</span> <span class="st">&quot;bleu : relation linéaire; rouge : curvilinéaire&quot;</span>,</span>
<span id="cb677-46"><a href="#cb677-46"></a>       <span class="dt">x =</span> <span class="st">&quot;Âge médian des bâtiments&quot;</span>,</span>
<span id="cb677-47"><a href="#cb677-47"></a>       <span class="dt">y =</span> <span class="st">&quot;Couverture végétale (%)&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/calculRegPoly2-1.png" alt="Relations linéaire et curvilinéaire" width="75%" />
<p class="caption">
(#fig:calculRegPoly2)Relations linéaire et curvilinéaire
</p>
</div>
<p>La figure @ref(fig:calculRegPoly2) démontre bien que la relation linéaire n’est pas significative : la pente est extrêmement faible, ce qui signale que l’effet de l’âge médian est presque nul (B = 0,0108, <em>p</em> = 0,0902). En revanche, la relation curvilinéaire est plus intéressante : la couverture végétale croît quand l’âge médian des bâtiments dans l’îlot augmente de 0 à 60 ans environ, puis elle décroît.</p>
</div>
<div id="sect07512" class="section level4">
<h4><span class="header-section-number">7.5.1.2</span> Variable indépendante sous forme logarithmique</h4>
<p>Une autre manière d’explorer une relation non linéaire est d’intégrer la variable sous forme logarithmique <span class="citation">(Hanck et al. <a href="#ref-hanck2019introduction" role="doc-biblioref">2019</a>, 212‑218)</span>. L’interprétation du coefficient de régression est alors plus complexe : un 1 % d’augmentation de la variable <span class="math inline">\(X_k\)</span> entraîne un changement de <span class="math inline">\(\mbox{0,01} \times \beta_k\)</span> de la variable dépendante. Autrement dit, il n’est plus exprimé dans les unités de mesure originales des deux variables.</p>
<p>Au tableau @ref(tab:regmodeleLog), le coefficient de <code>-6,855</code> pour la variable <code>logHABHA</code> s’interprète alors comme suit : un changement de 1 % de la variable densité de population entraîne une diminution de <span class="math inline">\(\mbox{0,01} \times -\mbox{6,855 =} -\mbox{0,07}\)</span> de la couverture végétale dans l’île, toutes choses étant égales par ailleurs.</p>
<table>
<caption>
(#tab:regmodeleLog)Modèle avec une variable indépendante sous forme logarithmique
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coef.
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
coef. 2,5 %
</th>
<th style="text-align:right;">
coef. 97,5 %
</th>
<th style="text-align:right;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
52,831
</td>
<td style="text-align:right;">
1,001
</td>
<td style="text-align:right;">
52,780
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
50,868
</td>
<td style="text-align:right;">
54,793
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
logHABHA
</td>
<td style="text-align:right;">
-6,855
</td>
<td style="text-align:right;">
0,168
</td>
<td style="text-align:right;">
-40,730
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-7,185
</td>
<td style="text-align:right;">
-6,525
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 1
</td>
<td style="text-align:right;">
11,985
</td>
<td style="text-align:right;">
15,586
</td>
<td style="text-align:right;">
0,770
</td>
<td style="text-align:right;">
0,442
</td>
<td style="text-align:right;">
-18,568
</td>
<td style="text-align:right;">
42,537
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 2
</td>
<td style="text-align:right;">
-286,144
</td>
<td style="text-align:right;">
13,942
</td>
<td style="text-align:right;">
-20,520
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-313,473
</td>
<td style="text-align:right;">
-258,816
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
0,941
</td>
<td style="text-align:right;">
0,031
</td>
<td style="text-align:right;">
30,090
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,879
</td>
<td style="text-align:right;">
1,002
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,306
</td>
<td style="text-align:right;">
0,019
</td>
<td style="text-align:right;">
16,550
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,270
</td>
<td style="text-align:right;">
0,343
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,036
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-3,650
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-0,056
</td>
<td style="text-align:right;">
-0,017
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,344
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
-31,210
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-0,366
</td>
<td style="text-align:right;">
-0,323
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table>
<p>Puisque l’interprétation du coefficient de régression de <span class="math inline">\(log(\beta_k)\)</span> est plus complexe, il convient de s’assurer que son apport au modèle est justifié, et ce, de deux façons :</p>
<ul>
<li><strong>Comparez les mesures d’ajustement des deux modèles (surtout les R<sup>2</sup> ajustés)</strong>. Si le R<sup>2</sup> ajusté du modèle avec <span class="math inline">\(log(\beta_k)\)</span> est plus élevé que celui avec <span class="math inline">\(\beta_k\)</span>, alors la transformation logarithmique fait de votre variable indépendante un meilleur prédicteur, toutes choses étant égales par ailleurs.</li>
<li><strong>Construisez les graphiques des effets marginaux</strong> de votre variable afin de vérifier si la relation qu’elle partage avec votre VD est plutôt logarithmique que linéaire (figure @ref(fig:EffetMarginalVariableLogEtNon)). Notez que cette approche graphique peut aussi ne donner aucune indication lorsque vos données sont très dispersées ou que la relation est faible entre votre variable dépendante et indépendante.</li>
</ul>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="#cb678-1"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb678-2"><a href="#cb678-2"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb678-3"><a href="#cb678-3"></a><span class="kw">library</span>(ggeffects)</span>
<span id="cb678-4"><a href="#cb678-4"></a></span>
<span id="cb678-5"><a href="#cb678-5"></a><span class="co"># Modèles</span></span>
<span id="cb678-6"><a href="#cb678-6"></a>modele1a &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb678-7"><a href="#cb678-7"></a><span class="st">              </span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal)</span>
<span id="cb678-8"><a href="#cb678-8"></a></span>
<span id="cb678-9"><a href="#cb678-9"></a>modele1b &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb678-10"><a href="#cb678-10"></a><span class="st">              </span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal)</span>
<span id="cb678-11"><a href="#cb678-11"></a></span>
<span id="cb678-12"><a href="#cb678-12"></a></span>
<span id="cb678-13"><a href="#cb678-13"></a><span class="co"># Valeurs prédites</span></span>
<span id="cb678-14"><a href="#cb678-14"></a>fit1a &lt;-<span class="st"> </span><span class="kw">ggpredict</span>(modele1a, <span class="dt">terms =</span> <span class="st">&quot;HABHA&quot;</span>)</span>
<span id="cb678-15"><a href="#cb678-15"></a>fit1b &lt;-<span class="st"> </span><span class="kw">ggpredict</span>(modele1b, <span class="dt">terms =</span> <span class="st">&quot;HABHA&quot;</span>)</span>
<span id="cb678-16"><a href="#cb678-16"></a></span>
<span id="cb678-17"><a href="#cb678-17"></a></span>
<span id="cb678-18"><a href="#cb678-18"></a><span class="co"># Graphiques</span></span>
<span id="cb678-19"><a href="#cb678-19"></a>G1a &lt;-<span class="st"> </span><span class="kw">ggplot</span>(fit1a, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span></span>
<span id="cb678-20"><a href="#cb678-20"></a><span class="st">      </span><span class="kw">geom_point</span>(<span class="dt">data =</span> DataFinal, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x=</span>HABHA, <span class="dt">y =</span> VegPct),</span>
<span id="cb678-21"><a href="#cb678-21"></a>                 <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb678-22"><a href="#cb678-22"></a><span class="st">      </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">.3</span>, <span class="dt">fill =</span><span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb678-23"><a href="#cb678-23"></a><span class="st">      </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb678-24"><a href="#cb678-24"></a><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Variable non transformée&quot;</span>,</span>
<span id="cb678-25"><a href="#cb678-25"></a>           <span class="dt">y=</span><span class="st">&quot;VD: valeur prédite&quot;</span>,</span>
<span id="cb678-26"><a href="#cb678-26"></a>           <span class="dt">x =</span> <span class="st">&quot;Habitants km2&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb678-27"><a href="#cb678-27"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>,<span class="dv">100</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlim</span>(<span class="dv">0</span>,<span class="dv">600</span>)</span>
<span id="cb678-28"><a href="#cb678-28"></a></span>
<span id="cb678-29"><a href="#cb678-29"></a>G1b &lt;-<span class="st"> </span><span class="kw">ggplot</span>(fit1b, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span></span>
<span id="cb678-30"><a href="#cb678-30"></a><span class="st">      </span><span class="kw">geom_point</span>(<span class="dt">data =</span> DataFinal, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x=</span>HABHA, <span class="dt">y =</span> VegPct),</span>
<span id="cb678-31"><a href="#cb678-31"></a>                 <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb678-32"><a href="#cb678-32"></a><span class="st">      </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">.3</span>, <span class="dt">fill =</span><span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb678-33"><a href="#cb678-33"></a><span class="st">      </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb678-34"><a href="#cb678-34"></a><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Variable transformée (log)&quot;</span>,</span>
<span id="cb678-35"><a href="#cb678-35"></a>           <span class="dt">y=</span><span class="st">&quot;VD: valeur prédite&quot;</span>,</span>
<span id="cb678-36"><a href="#cb678-36"></a>           <span class="dt">x =</span> <span class="st">&quot;Habitants km2&quot;</span>)</span>
<span id="cb678-37"><a href="#cb678-37"></a></span>
<span id="cb678-38"><a href="#cb678-38"></a>G1aG1b &lt;-<span class="st"> </span><span class="kw">ggarrange</span>(G1a, G1b, <span class="dt">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb678-39"><a href="#cb678-39"></a>G1aG1b</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/EffetMarginalVariableLogEtNon-1.png" alt="Effet marginal de la densité de population" width="75%" />
<p class="caption">
(#fig:EffetMarginalVariableLogEtNon)Effet marginal de la densité de population
</p>
</div>
</div>
</div>
<div id="sect0752" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Variable indépendante qualitative dichotomique</h3>
<p>Il est très fréquent d’introduire une variable qualitative dichotomique comme variable explicative ou de contrôle dans un modèle. À titre de rappel, une variable dichotomique comprend deux modalités (section @ref(sect0212)).</p>
<p>Dans le modèle ci-dessous, nous voulons vérifier si un îlot situé sur le territoire de la ville de Montréal a proportionnellement moins de végétation qu’un îlot situé dans une autre municipalité de l’île de Montréal, toutes choses étant égales par ailleurs. Pour ce faire, nous créons une variable binaire dénommée <code>VilleMtl</code> qui prend la valeur de 1 pour les îlots de la ville de Montréal et 0 pour ceux d’une autre municipalité.</p>
<p>Nous obtenons ainsi un coefficient de régression pour <code>VilleMtl</code> de -7,699 (tableau @ref(tab:regmodeleDich2)). Cela signifie que si toutes les autres variables indépendantes du modèle étaient constantes, alors un îlot de la ville de Montréal aurait en moyenne une valeur de -7,7 % de moins de végétation comparativement à un îlot situé dans une autre municipalité.</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="#cb679-1"></a><span class="co"># Création d&#39;une variable muette pour Montréal (0 ou 1)</span></span>
<span id="cb679-2"><a href="#cb679-2"></a>DataFinal<span class="op">$</span>VilleMtl &lt;-<span class="st"> </span><span class="kw">ifelse</span>(DataFinal<span class="op">$</span>SDRNOM <span class="op">==</span><span class="st"> &quot;Montréal&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb679-3"><a href="#cb679-3"></a></span>
<span id="cb679-4"><a href="#cb679-4"></a><span class="co"># Modèle avec la variable dichtonomique</span></span>
<span id="cb679-5"><a href="#cb679-5"></a>modele3 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>VilleMtl<span class="op">+</span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb679-6"><a href="#cb679-6"></a><span class="st">              </span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal)</span></code></pre></div>
<table>
<caption>
(#tab:regmodeleDich2)Modèle avec une variable dichotomique
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coef.
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
coef. 2,5 %
</th>
<th style="text-align:right;">
coef. 97,5 %
</th>
<th style="text-align:right;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
57,676
</td>
<td style="text-align:right;">
1,009
</td>
<td style="text-align:right;">
57,140
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
55,697
</td>
<td style="text-align:right;">
59,654
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
VilleMtl
</td>
<td style="text-align:right;">
-7,699
</td>
<td style="text-align:right;">
0,377
</td>
<td style="text-align:right;">
-20,430
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-8,438
</td>
<td style="text-align:right;">
-6,960
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
log(HABHA)
</td>
<td style="text-align:right;">
-6,174
</td>
<td style="text-align:right;">
0,168
</td>
<td style="text-align:right;">
-36,680
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-6,504
</td>
<td style="text-align:right;">
-5,844
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 1
</td>
<td style="text-align:right;">
-14,871
</td>
<td style="text-align:right;">
15,334
</td>
<td style="text-align:right;">
-0,970
</td>
<td style="text-align:right;">
0,332
</td>
<td style="text-align:right;">
-44,929
</td>
<td style="text-align:right;">
15,186
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 2
</td>
<td style="text-align:right;">
-280,251
</td>
<td style="text-align:right;">
13,668
</td>
<td style="text-align:right;">
-20,500
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-307,044
</td>
<td style="text-align:right;">
-253,459
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
0,794
</td>
<td style="text-align:right;">
0,031
</td>
<td style="text-align:right;">
25,230
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,732
</td>
<td style="text-align:right;">
0,856
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,270
</td>
<td style="text-align:right;">
0,018
</td>
<td style="text-align:right;">
14,810
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,234
</td>
<td style="text-align:right;">
0,306
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,028
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-2,890
</td>
<td style="text-align:right;">
0,004
</td>
<td style="text-align:right;">
-0,047
</td>
<td style="text-align:right;">
-0,009
</td>
<td style="text-align:right;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,294
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
-26,550
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-0,316
</td>
<td style="text-align:right;">
-0,273
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table>
<div class="bloc_astuce">
<p><strong>Bien interpréter un coefficient d’une variable dichotomique</strong></p>
<p>Nous avons vu que le coefficient de régression (<span class="math inline">\(\beta_k\)</span>) indique le changement de la variable dépendante (<em>Y</em>), lorsque la variable indépendante augmente d’une unité, toutes choses étant égales par ailleurs.</p>
<p>Pour une variable dichotomique, le coefficient indique le changement de <em>Y</em> quand les observations appartiennent à la modalité qui a la valeur de 1 (ici la ville de Montréal), comparativement à celle qui a la valeur de 0 (autres municipalités de l’île de Montréal), toutes choses étant égales par ailleurs.</p>
<p>La modalité qui a la valeur de 0 est alors appelée <strong>modalité ou catégorie de référence</strong>.</p>
<p>Autrement dit, si la variable avait été codée : 0 pour la ville de Montréal et 1 pour les autres municipalités, alors le coefficient aurait été de 7,699.</p>
<p>Pour éviter d’oublier quelle est la modalité de référence (valeur de 0), nous verrons plus tard (dans la section mise en œuvre des modèles de régression dans R (section @ref(sect077)) qu’il peut être préférable de définir un facteur avec la fonction <code>as.factor</code> et d’indiquer la catégorie de référence avec la fonction <code>relevel(x, ref)</code>.</p>
</div>
<p>Comme pour une variable indépendante introduite avec une fonction polynomiale, il peut être très intéressant d’illustrer l’effet marginal de la variable dichotomique avec un graphique qui montre l’écart entre les moyennes des deux modalités, une fois contrôlées les autres variables indépendantes (figure @ref(fig:EffetMarginalDich)). Notez que dans ce graphique, les barres d’erreurs situées au sommet des rectangles représentent les intervalles à 95 % des prédictions du modèle.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/EffetMarginalDich-1.png" alt="Effet marginal d'une variable dichotomique" width="70%" />
<p class="caption">
(#fig:EffetMarginalDich)Effet marginal d’une variable dichotomique
</p>
</div>
</div>
<div id="sect0753" class="section level3">
<h3><span class="header-section-number">7.5.3</span> Variable indépendante qualitative polytomique</h3>
<p>Il est possible d’introduire une variable qualitative polytomique comme variable explicative ou de contrôle dans un modèle. À titre de rappel, une variable polytomique comprend plus de deux modalités, qu’elle soit nominale ou ordinale (section @ref(sect0212)).</p>
<p>En guise d’exemple, une variable qualitative pourrait être : différents groupes de population (groupes d’âge, minorités visibles, catégories socioprofessionnelles, etc.), différents territoires ou régions (ville centrale, première couronne, deuxième couronne, etc.), une variable continue transformée en quatre ou cinq catégories ordinales selon les quartiles ou les quintiles.</p>
<div id="sect07531" class="section level4">
<h4><span class="header-section-number">7.5.3.1</span> Comment construire un modèle de régression avec une variable explicative qualitative polytomique?</h4>
<p>Prenons l’exemple d’un modèle de régression comprenant deux variables indépendantes : l’une continue (<code>X1</code>), l’autre qualitative (<code>X2</code>) avec quatre modalités (A, B, C et D). L’introduction de la variable qualitative dans le modèle revient à :</p>
<ul>
<li>Transformer chaque modalité en variable muette (binaire). Nous avons ainsi quatre nouvelles variables binaires : <code>X2A</code>, <code>X2B</code>, <code>X2C</code> et <code>X2D</code>. Par exemple, pour <code>X2A</code>, les observations de la modalité <em>A</em> se verront affecter la valeur de 1 versus 0 pour les autres observations. La même démarche s’applique à <code>X2B</code>, <code>X2C</code> et <code>X2D</code> (voir tableau @ref(tab:transfVarQMuettes)).</li>
</ul>
<table>
<caption>
(#tab:transfVarQMuettes)Transformation d’une variable qualitative en variables muettes pour chaque modalité
</caption>
<thead>
<tr>
<th style="text-align:right;">
obs
</th>
<th style="text-align:right;">
Y
</th>
<th style="text-align:right;">
X1
</th>
<th style="text-align:center;">
X2
</th>
<th style="text-align:center;">
X2A
</th>
<th style="text-align:center;">
X2B
</th>
<th style="text-align:center;">
X2C
</th>
<th style="text-align:center;">
X2D
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
66,66
</td>
<td style="text-align:right;">
20,87
</td>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
53,89
</td>
<td style="text-align:right;">
17,54
</td>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
60,02
</td>
<td style="text-align:right;">
25,33
</td>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
46,12
</td>
<td style="text-align:right;">
26,94
</td>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
50,89
</td>
<td style="text-align:right;">
32,02
</td>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
51,11
</td>
<td style="text-align:right;">
18,43
</td>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
45,06
</td>
<td style="text-align:right;">
22,40
</td>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
74,76
</td>
<td style="text-align:right;">
22,04
</td>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
34,41
</td>
<td style="text-align:right;">
15,32
</td>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
51,75
</td>
<td style="text-align:right;">
21,76
</td>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
</tr>
</tbody>
</table>
<ul>
<li><p>Toutes les modalités transformées en variables muettes sont introduites dans le modèle comme variables indépendantes <strong>sauf celle servant de catégorie de référence</strong>. Pourquoi sauf une? Si nous mettions toutes les modalités en variable muette, alors chaque observation serait repérée par une valeur de 1, « il y aurait alors une parfaite multicolinéarité et aucune solution unique pour les coefficients de régression ne pourrait être trouvée » <span class="citation">(Bressoux <a href="#ref-bressoux2010" role="doc-biblioref">2010</a>, 128)</span>.</p></li>
<li><p>Par exemple, si nous choisissons la modalité <em>A</em> comme catégorie de référence, l’équation de régression s’écrit alors :</p></li>
</ul>

<p><span class="math display">\[\begin{equation}
Y = b_{0} + b_{1}X_{1} + b_{2B}X_{2B} + b_{2C}X_{2C} + b_{2D}X_{2D}+ e
(\#eq:regvarpoly1)
\end{equation}\]</span>
</p>
<ul>
<li>Vous aurez compris que choisir la modalité <em>D</em> comme catégorie de référence revient à écrire l’équation suivante :</li>
</ul>

<p><span class="math display">\[\begin{equation}
Y = b_{0} + b_{1}X_{1} + b_{2A}X_{2A} + b_{2B}X_{2B} + b_{2C}X_{2C} + e
(\#eq:regvarpoly2)
\end{equation}\]</span>
</p>
</div>
<div id="sect07532" class="section level4">
<h4><span class="header-section-number">7.5.3.2</span> Comment interpréter les coefficients des modalités d’une variable explicative qualitative polytomique</h4>
<p>Les coefficients des différentes modalités s’interprètent en fonction de la catégorie de référence. Dans l’exemple ci-dessous, nous avons inclus la ville de Montréal comme catégorie de référence (tableau @ref(tab:ModeleVarPoly1)). Toutes choses étant égales par ailleurs, nous pouvons alors constater que  :</p>
<ul>
<li>en moyenne, les îlots résidentiels de Senneville et de Baie-D’Urfé ont respectivement 23,235 % et 21,400 % plus de végétation que ceux de la ville de Montréal.</li>
<li>la seule municipalité comprenant en moyenne moins de végétation dans ses îlots résidentiels est Montréal-Est (-13,334 %)</li>
<li>nous remarquons aussi que les îlots des municipalités de Sainte-Anne-de-Bellevue, de Montréal-Ouest et de Côte-Saint-Luc ne présentent pas significativement moins ou plus de végétation que ceux de la ville de Montréal (leurs valeurs de <em>p</em> sont supérieures à 0,05).</li>
</ul>
<p>Par conséquent, les valeurs de <em>t</em> et de <em>p</em> pour une modalité permettent de vérifier si elle est ou non significativement différente de la catégorie de référence.</p>
<table>
<caption>
(#tab:ModeleVarPoly1)Modèle avec une variable polytomique (ville de Montréal en catégorie de référence)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coef.
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
48,193
</td>
<td style="text-align:right;">
0,992
</td>
<td style="text-align:right;">
48,580
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
log(HABHA)
</td>
<td style="text-align:right;">
-5,836
</td>
<td style="text-align:right;">
0,168
</td>
<td style="text-align:right;">
-34,840
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 1
</td>
<td style="text-align:right;">
-11,807
</td>
<td style="text-align:right;">
15,648
</td>
<td style="text-align:right;">
-0,750
</td>
<td style="text-align:right;">
0,451
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 2
</td>
<td style="text-align:right;">
-266,469
</td>
<td style="text-align:right;">
13,613
</td>
<td style="text-align:right;">
-19,570
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
0,794
</td>
<td style="text-align:right;">
0,032
</td>
<td style="text-align:right;">
25,190
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,277
</td>
<td style="text-align:right;">
0,018
</td>
<td style="text-align:right;">
15,130
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,036
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-3,740
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,279
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
-25,340
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Municipalité</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : Montréal
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
Baie-D’Urfé
</td>
<td style="text-align:right;">
21,400
</td>
<td style="text-align:right;">
1,635
</td>
<td style="text-align:right;">
13,090
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Beaconsfield
</td>
<td style="text-align:right;">
14,112
</td>
<td style="text-align:right;">
0,893
</td>
<td style="text-align:right;">
15,810
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Côte-Saint-Luc
</td>
<td style="text-align:right;">
0,172
</td>
<td style="text-align:right;">
1,035
</td>
<td style="text-align:right;">
0,170
</td>
<td style="text-align:right;">
0,868
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Dollard-Des Ormeaux
</td>
<td style="text-align:right;">
7,960
</td>
<td style="text-align:right;">
0,748
</td>
<td style="text-align:right;">
10,640
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Dorval
</td>
<td style="text-align:right;">
11,157
</td>
<td style="text-align:right;">
0,971
</td>
<td style="text-align:right;">
11,490
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Hampstead
</td>
<td style="text-align:right;">
3,080
</td>
<td style="text-align:right;">
1,599
</td>
<td style="text-align:right;">
1,930
</td>
<td style="text-align:right;">
0,054
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
Kirkland
</td>
<td style="text-align:right;">
6,937
</td>
<td style="text-align:right;">
1,014
</td>
<td style="text-align:right;">
6,840
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Mont-Royal
</td>
<td style="text-align:right;">
12,699
</td>
<td style="text-align:right;">
0,894
</td>
<td style="text-align:right;">
14,210
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Montréal-Est
</td>
<td style="text-align:right;">
-13,334
</td>
<td style="text-align:right;">
1,920
</td>
<td style="text-align:right;">
-6,940
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Montréal-Ouest
</td>
<td style="text-align:right;">
3,306
</td>
<td style="text-align:right;">
1,819
</td>
<td style="text-align:right;">
1,820
</td>
<td style="text-align:right;">
0,069
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
Pointe-Claire
</td>
<td style="text-align:right;">
9,896
</td>
<td style="text-align:right;">
0,866
</td>
<td style="text-align:right;">
11,430
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Sainte-Anne-de-Bellevue
</td>
<td style="text-align:right;">
0,342
</td>
<td style="text-align:right;">
1,904
</td>
<td style="text-align:right;">
0,180
</td>
<td style="text-align:right;">
0,858
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Senneville
</td>
<td style="text-align:right;">
23,235
</td>
<td style="text-align:right;">
3,793
</td>
<td style="text-align:right;">
6,130
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Westmount
</td>
<td style="text-align:right;">
2,255
</td>
<td style="text-align:right;">
1,088
</td>
<td style="text-align:right;">
2,070
</td>
<td style="text-align:right;">
0,038
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
</tbody>
</table></li>
</ul>
<p>Utilisons maintenant comme référence la municipalité qui avait le coefficient le plus fort dans le modèle précédent, soit Senneville (tableau @ref(tab:ModeleVarPoly2)). Bien entendu, les coefficients des variables continues et de la constante ne changent pas. Par contre, les coefficients de toutes les municipalités sont négatifs puisque la municipalité de Senneville est celle qui a proportionnellement le plus de végétation dans ses îlots, toutes choses étant égales par ailleurs.</p>
<table>
<caption>
(#tab:ModeleVarPoly2)Modèle avec une variable polytomique (Senneville en catégorie de référence)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coef.
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
71,429
</td>
<td style="text-align:right;">
3,846
</td>
<td style="text-align:right;">
18,570
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
log(HABHA)
</td>
<td style="text-align:right;">
-5,836
</td>
<td style="text-align:right;">
0,168
</td>
<td style="text-align:right;">
-34,840
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 1
</td>
<td style="text-align:right;">
-11,807
</td>
<td style="text-align:right;">
15,648
</td>
<td style="text-align:right;">
-0,750
</td>
<td style="text-align:right;">
0,451
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 2
</td>
<td style="text-align:right;">
-266,469
</td>
<td style="text-align:right;">
13,613
</td>
<td style="text-align:right;">
-19,570
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
0,794
</td>
<td style="text-align:right;">
0,032
</td>
<td style="text-align:right;">
25,190
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,277
</td>
<td style="text-align:right;">
0,018
</td>
<td style="text-align:right;">
15,130
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,036
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-3,740
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,279
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
-25,340
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Municipalité</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : Senneville
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
Baie-D’Urfé
</td>
<td style="text-align:right;">
-1,835
</td>
<td style="text-align:right;">
4,093
</td>
<td style="text-align:right;">
-0,450
</td>
<td style="text-align:right;">
0,654
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Beaconsfield
</td>
<td style="text-align:right;">
-9,123
</td>
<td style="text-align:right;">
3,866
</td>
<td style="text-align:right;">
-2,360
</td>
<td style="text-align:right;">
0,018
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Côte-Saint-Luc
</td>
<td style="text-align:right;">
-23,064
</td>
<td style="text-align:right;">
3,918
</td>
<td style="text-align:right;">
-5,890
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Dollard-Des Ormeaux
</td>
<td style="text-align:right;">
-15,275
</td>
<td style="text-align:right;">
3,852
</td>
<td style="text-align:right;">
-3,970
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Dorval
</td>
<td style="text-align:right;">
-12,078
</td>
<td style="text-align:right;">
3,891
</td>
<td style="text-align:right;">
-3,100
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
Hampstead
</td>
<td style="text-align:right;">
-20,156
</td>
<td style="text-align:right;">
4,094
</td>
<td style="text-align:right;">
-4,920
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Kirkland
</td>
<td style="text-align:right;">
-16,298
</td>
<td style="text-align:right;">
3,911
</td>
<td style="text-align:right;">
-4,170
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Mont-Royal
</td>
<td style="text-align:right;">
-10,537
</td>
<td style="text-align:right;">
3,875
</td>
<td style="text-align:right;">
-2,720
</td>
<td style="text-align:right;">
0,007
</td>
<td style="text-align:right;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
Montréal
</td>
<td style="text-align:right;">
-23,235
</td>
<td style="text-align:right;">
3,793
</td>
<td style="text-align:right;">
-6,130
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Montréal-Est
</td>
<td style="text-align:right;">
-36,570
</td>
<td style="text-align:right;">
4,231
</td>
<td style="text-align:right;">
-8,640
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Montréal-Ouest
</td>
<td style="text-align:right;">
-19,930
</td>
<td style="text-align:right;">
4,187
</td>
<td style="text-align:right;">
-4,760
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pointe-Claire
</td>
<td style="text-align:right;">
-13,339
</td>
<td style="text-align:right;">
3,865
</td>
<td style="text-align:right;">
-3,450
</td>
<td style="text-align:right;">
0,001
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Sainte-Anne-de-Bellevue
</td>
<td style="text-align:right;">
-22,893
</td>
<td style="text-align:right;">
4,225
</td>
<td style="text-align:right;">
-5,420
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Westmount
</td>
<td style="text-align:right;">
-20,980
</td>
<td style="text-align:right;">
3,927
</td>
<td style="text-align:right;">
-5,340
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table></li>
</ul>
<p>À l’inverse, si nous utilisons Montréal-Est comme modalité de référence, soit la municipalité avec le coefficient le plus faible dans le premier modèle, tous les coefficients deviendront positifs (tableau @ref(tab:ModeleVarPoly3)).</p>
<table>
<caption>
(#tab:ModeleVarPoly3)Modèle avec une variable polytomique (Montréal-Est en catégorie de référence)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coef.
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
34,859
</td>
<td style="text-align:right;">
2,109
</td>
<td style="text-align:right;">
16,530
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
log(HABHA)
</td>
<td style="text-align:right;">
-5,836
</td>
<td style="text-align:right;">
0,168
</td>
<td style="text-align:right;">
-34,840
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 1
</td>
<td style="text-align:right;">
-11,807
</td>
<td style="text-align:right;">
15,648
</td>
<td style="text-align:right;">
-0,750
</td>
<td style="text-align:right;">
0,451
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 2
</td>
<td style="text-align:right;">
-266,469
</td>
<td style="text-align:right;">
13,613
</td>
<td style="text-align:right;">
-19,570
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
0,794
</td>
<td style="text-align:right;">
0,032
</td>
<td style="text-align:right;">
25,190
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,277
</td>
<td style="text-align:right;">
0,018
</td>
<td style="text-align:right;">
15,130
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,036
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-3,740
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,279
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
-25,340
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Municipalité</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : Montréal-Est
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
Baie-D’Urfé
</td>
<td style="text-align:right;">
34,735
</td>
<td style="text-align:right;">
2,495
</td>
<td style="text-align:right;">
13,920
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Beaconsfield
</td>
<td style="text-align:right;">
27,446
</td>
<td style="text-align:right;">
2,091
</td>
<td style="text-align:right;">
13,130
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Côte-Saint-Luc
</td>
<td style="text-align:right;">
13,506
</td>
<td style="text-align:right;">
2,167
</td>
<td style="text-align:right;">
6,230
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Dollard-Des Ormeaux
</td>
<td style="text-align:right;">
21,294
</td>
<td style="text-align:right;">
2,053
</td>
<td style="text-align:right;">
10,370
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Dorval
</td>
<td style="text-align:right;">
24,491
</td>
<td style="text-align:right;">
2,134
</td>
<td style="text-align:right;">
11,480
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Hampstead
</td>
<td style="text-align:right;">
16,414
</td>
<td style="text-align:right;">
2,478
</td>
<td style="text-align:right;">
6,620
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Kirkland
</td>
<td style="text-align:right;">
20,272
</td>
<td style="text-align:right;">
2,159
</td>
<td style="text-align:right;">
9,390
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Mont-Royal
</td>
<td style="text-align:right;">
26,033
</td>
<td style="text-align:right;">
2,101
</td>
<td style="text-align:right;">
12,390
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Montréal
</td>
<td style="text-align:right;">
13,334
</td>
<td style="text-align:right;">
1,920
</td>
<td style="text-align:right;">
6,940
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Montréal-Ouest
</td>
<td style="text-align:right;">
16,640
</td>
<td style="text-align:right;">
2,628
</td>
<td style="text-align:right;">
6,330
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pointe-Claire
</td>
<td style="text-align:right;">
23,230
</td>
<td style="text-align:right;">
2,087
</td>
<td style="text-align:right;">
11,130
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Sainte-Anne-de-Bellevue
</td>
<td style="text-align:right;">
13,676
</td>
<td style="text-align:right;">
2,687
</td>
<td style="text-align:right;">
5,090
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Senneville
</td>
<td style="text-align:right;">
36,570
</td>
<td style="text-align:right;">
4,231
</td>
<td style="text-align:right;">
8,640
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Westmount
</td>
<td style="text-align:right;">
15,590
</td>
<td style="text-align:right;">
2,196
</td>
<td style="text-align:right;">
7,100
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table>
<div class="bloc_astuce">
<p><strong>Comment choisir la catégorie de référence?</strong></p>
<p>Plusieurs options sont possibles. Vous pouvez retenir :</p>
<ul>
<li>la modalité comprenant le plus d’observations;</li>
<li>la modalité avec la plus forte valeur pour la variable dépendante;</li>
<li>la modalité avec la plus faible valeur pour la variable dépendante;</li>
<li>la modalité qui fait le plus de sens avec votre cadre théorique. Prenons l’exemple d’une variable qualitative comprenant plusieurs groupes d’âge (15-29 ans, 30-39 ans, 40-49 ans, 50-54 ans, 65 ans et plus). Si votre étude porte sur les jeunes et que vous souhaitez comparer leur situation comparativement aux autres groupes d’âge, toutes choses étant égales par ailleurs, sélectionnez bien évidemment la modalité des 15 à 29 ans comme catégorie de référence.</li>
</ul>
<p>Mais surtout, évitez de choisir une catégorie comprenant très peu d’observations.</p>
</div>
</div>
<div id="sect07533" class="section level4">
<h4><span class="header-section-number">7.5.3.3</span> Effet marginal d’une variable explicative qualitative polytomique</h4>
<p>Comme pour une variable dichotomique, il est possible d’illustrer l’effet marginal de la variable qualitative dichotomique avec un graphique. Quelle que soit la catégorie de référence choisie, le graphique est le même. La figure @ref(fig:EffetMarginalPoly) illustre ainsi la valeur moyenne, avec son intervalle de confiance à 95 %, de la végétation dans les îlots résidentiels de chacune des municipalités de la région de Montréal, <em>ceteris paribus</em>.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/EffetMarginalPoly-1.png" alt="Effet marginal d'une variable polytomique" width="90%" />
<p class="caption">
(#fig:EffetMarginalPoly)Effet marginal d’une variable polytomique
</p>
</div>
</div>
</div>
<div id="sect0754" class="section level3">
<h3><span class="header-section-number">7.5.4</span> Variables d’interaction</h3>
<div id="sect07541" class="section level4">
<h4><span class="header-section-number">7.5.4.1</span> Variable d’interaction entre deux variables continues</h4>
<p>Une interaction entre deux variables indépendantes continues consiste à simplement les multiplier (<span class="math inline">\(X_1 \times X_2\)</span>). Le modèle s’écrit alors :</p>

<p><span class="math display">\[\begin{equation} 
Y = \beta_{0} + \beta_{1}X_{1} + \beta_{2}X_{2} + \beta_{3}(X_{1}\times X_{2}) +\ldots+ \beta_{k}X_{k} + e(\#eq:reginteractioncontinues)
\end{equation}\]</span>
</p>
<p>Un nouveau coefficient (<span class="math inline">\(\beta_{3}\)</span>) s’ajoute pour l’interaction (la multiplication) entre les deux variables continues. <strong>Pourquoi ajouter une interaction entre deux variables?</strong> L’objectif est d’évaluer l’effet d’une augmentation de <span class="math inline">\(\beta_{1}\)</span> en fonction d’un niveau donné de <span class="math inline">\(\beta_{2}\)</span> et inversement. Cela permet ainsi de répondre à la question suivante : l’effet de la variable <span class="math inline">\(\beta_{1}\)</span> est-il influencé par la variable <span class="math inline">\(\beta_{2}\)</span> et inversement?</p>
<p>Prenons un exemple concret pour illustrer le tout. Premièrement, nous ajoutons <code>DistCBDkm</code> comme VI, soit la distance au centre-ville exprimée en kilomètres. Notez que pour ne pas surspécifier le modèle, les variables dichotomique <code>VilleMtl</code> ou polytomique <code>Municipalité</code> ont été préalablement ôtées. Le coefficient (B = 0,659, <em>p</em> &lt; 0,001) signale que plus nous nous éloignons du centre-ville, plus la couverture végétale des îlots augmente significativement. En guise d’exemple, toutes choses étant égales par ailleurs, un îlot situé à dix kilomètres du centre-ville aura en moyenne 6,59 % plus de végétation (tableau @ref(tab:ModeleInteraction1)).</p>
<table>
<caption>
(#tab:ModeleInteraction1)Modèle avec la distance au centre-ville (km)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coef.
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
41,061
</td>
<td style="text-align:right;">
1,085
</td>
<td style="text-align:right;">
37,830
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
log(HABHA)
</td>
<td style="text-align:right;">
-5,555
</td>
<td style="text-align:right;">
0,172
</td>
<td style="text-align:right;">
-32,300
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 1
</td>
<td style="text-align:right;">
176,921
</td>
<td style="text-align:right;">
16,582
</td>
<td style="text-align:right;">
10,670
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 2
</td>
<td style="text-align:right;">
-298,735
</td>
<td style="text-align:right;">
13,560
</td>
<td style="text-align:right;">
-22,030
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
0,763
</td>
<td style="text-align:right;">
0,031
</td>
<td style="text-align:right;">
24,440
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,321
</td>
<td style="text-align:right;">
0,018
</td>
<td style="text-align:right;">
17,860
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,018
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-1,880
</td>
<td style="text-align:right;">
0,060
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,288
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
-26,260
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
DistCBDkm
</td>
<td style="text-align:right;">
0,659
</td>
<td style="text-align:right;">
0,027
</td>
<td style="text-align:right;">
24,460
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table>
<p>Dans ce modèle (tableau @ref(tab:ModeleInteraction1)), les pourcentages d’enfants de moins de 15 ans et de 65 ans et plus (<code>Pct_014</code> et <code>Pct_65P</code>) sont associés positivement à la variable dépendante tandis que le pourcentage de personnes à faible revenu (<code>Pct_FR</code>) est associé négativement.</p>
<p>Que se passe-t-il si nous introduisons une variable d’interaction entre <code>DistCBDkm</code> et <code>Pct_FR</code> (tableau @ref(tab:ModeleInteraction2))? L’effet du pourcentage de personnes à faible revenu (%) est significatif et négatif lorsqu’il est mis en interaction avec la distance au centre-ville. Cela indique que plus l’îlot est éloigné du centre-ville, plus <code>Pct_FR</code> a un effet négatif sur la couverture végétale (B = −0,011, <em>p</em> &lt; 0,001).</p>
<table>
<caption>
(#tab:ModeleInteraction2)Modèle avec une variable d’interaction entre deux VI continues
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coef.
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
38,382
</td>
<td style="text-align:right;">
1,137
</td>
<td style="text-align:right;">
33,760
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
log(HABHA)
</td>
<td style="text-align:right;">
-5,505
</td>
<td style="text-align:right;">
0,172
</td>
<td style="text-align:right;">
-32,080
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 1
</td>
<td style="text-align:right;">
160,523
</td>
<td style="text-align:right;">
16,672
</td>
<td style="text-align:right;">
9,630
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 2
</td>
<td style="text-align:right;">
-310,666
</td>
<td style="text-align:right;">
13,610
</td>
<td style="text-align:right;">
-22,830
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
0,786
</td>
<td style="text-align:right;">
0,031
</td>
<td style="text-align:right;">
25,130
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,345
</td>
<td style="text-align:right;">
0,018
</td>
<td style="text-align:right;">
18,960
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,018
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-1,820
</td>
<td style="text-align:right;">
0,069
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,191
</td>
<td style="text-align:right;">
0,017
</td>
<td style="text-align:right;">
-11,500
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
DistCBDkm
</td>
<td style="text-align:right;">
0,821
</td>
<td style="text-align:right;">
0,034
</td>
<td style="text-align:right;">
24,060
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
DistCBDkmX_Pct_FR
</td>
<td style="text-align:right;">
-0,011
</td>
<td style="text-align:right;">
0,001
</td>
<td style="text-align:right;">
-7,700
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table>
<p>À nouveau, il est possible de représenter l’effet de cette interaction à l’aide d’un graphique des effets marginaux. Notez cependant que nous devons représenter l’effet simultané de deux variables indépendantes sur notre variable dépendante, ce qu’il est possible de faire avec une carte de chaleur. La figure @ref(fig:ModeleInteraction2heat) représente donc l’effet moyen de l’interaction sur la prédiction dans le premier panneau, ainsi que l’intervalle de confiance à 95 % de la prédiction dans les deuxième et troisième panneaux.</p>
<p>Nous constatons ainsi que le modèle prédit des valeurs de végétation les plus faibles lorsque le pourcentage de personnes à faible revenu est élevé et que la distance au centre-ville est élevée (en haut à droite à la figure @ref(fig:ModeleInteraction2heat)). En revanche, les valeurs les plus élevées de végétation sont atteintes lorsque la distance au centre-ville est élevée et que le pourcentage de personnes à faible revenu est faible (en bas à droite). Il semble donc que l’éloignement au centre-ville soit associé avec une augmentation de la densité végétale, mais que cette augmentation puisse être mitigée par l’augmentation parallèle du pourcentage de personnes à faible revenu.</p>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/ModeleInteraction2heat-1.png" alt="Effet marginal de l'interaction entre deux variables continues" width="95%" />
<p class="caption">
(#fig:ModeleInteraction2heat)Effet marginal de l’interaction entre deux variables continues
</p>
</div>
<p>Notez que dans la figure @ref(fig:ModeleInteraction2heat), la relation entre les deux variables indépendantes et la variable dépendante apparaît non linéaire du fait de l’interaction. À titre de comparaison, si nous utilisons les prédictions du modèle 5 (sans interaction), nous obtenons les prédictions présentées à la figure @ref(fig:ModeleInteraction2heat2). Vous pouvez constater sur cette figure sans interaction que les deux effets des variables indépendantes sont linéaires puisque toutes les lignes sont parallèles.</p>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/ModeleInteraction2heat2-1.png" alt="Effets marginaux de deux variables continues en cas d'absence d'interaction" width="75%" />
<p class="caption">
(#fig:ModeleInteraction2heat2)Effets marginaux de deux variables continues en cas d’absence d’interaction
</p>
</div>
</div>
<div id="sect07542" class="section level4">
<h4><span class="header-section-number">7.5.4.2</span> Variable d’interaction entre une variable continue et une variable dichotomique</h4>
<p>Une interaction entre une VI continue et une VI dichotomique consiste aussi à les multiplier (<span class="math inline">\(X_1 \times D_2\)</span>); le modèle s’écrit alors :</p>

<p><span class="math display">\[\begin{equation} 
Y = \beta_{0} + \beta_{1}X_{1} + \beta_{2}D_{2} + \beta_{3}(X_{1}\times D_{2}) +\ldots+ \beta_{k}X_{k} + e(\#eq:reginteractioncontinuedicho)
\end{equation}\]</span>
</p>
<p>Pour interpréter le coefficient <span class="math inline">\(B_3\)</span>, il convient alors de bien connaître le nom de la modalité ayant la valeur de 1 (0 étant la modalité de référence). Dans le modèle présenté au tableau @ref(tab:ModeleInteractionBinaireTAB), nous avons multiplié la variable dichotomique ville de Montréal (<code>VilleMtl</code>) avec le pourcentage de personnes à faible revenu (<code>Pct_FR</code>). Les résultats de ce modèle démontrent que, toutes choses étant égales par ailleurs :</p>
<ul>
<li>à chaque augmentation d’une unité du pourcentage à faible revenu (<code>Pct_FR</code>), le pourcentage de la couverture végétale diminue significativement de −0,444;</li>
<li>comparativement à un îlot situé dans une autre municipalité de l’île de Montréal, un îlot de la ville de Montréal a en moyenne −9,804 de couverture végétale;</li>
<li>à chaque augmentation d’une unité de <code>Pct_FR</code> pour un îlot de la Ville Montréal, la couverture végétale augmente de 0,166 comparativement à une autre municipalité de l’île. En d’autres termes, le <code>Pct_FR</code> sur le territoire de la ville de Montréal est associé à une diminution de la couverture végétale moins forte que les autres municipalités, comme illustré à la figure @ref(fig:ModeleInteractionBinaireFIG) (pentes en rouge et en bleu).</li>
</ul>
<table>
<caption>
(#tab:ModeleInteractionBinaireTAB)Modèle avec les variables d’interaction entre une VI continue et une VI dichotomique
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coef.
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
59,275
</td>
<td style="text-align:right;">
1,053
</td>
<td style="text-align:right;">
56,300
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
log(HABHA)
</td>
<td style="text-align:right;">
-6,160
</td>
<td style="text-align:right;">
0,168
</td>
<td style="text-align:right;">
-36,640
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 1
</td>
<td style="text-align:right;">
-20,719
</td>
<td style="text-align:right;">
15,354
</td>
<td style="text-align:right;">
-1,350
</td>
<td style="text-align:right;">
0,177
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 2
</td>
<td style="text-align:right;">
-278,141
</td>
<td style="text-align:right;">
13,656
</td>
<td style="text-align:right;">
-20,370
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
0,789
</td>
<td style="text-align:right;">
0,031
</td>
<td style="text-align:right;">
25,100
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,278
</td>
<td style="text-align:right;">
0,018
</td>
<td style="text-align:right;">
15,200
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,030
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-3,030
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,444
</td>
<td style="text-align:right;">
0,030
</td>
<td style="text-align:right;">
-14,550
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
VilleMtl
</td>
<td style="text-align:right;">
-9,804
</td>
<td style="text-align:right;">
0,549
</td>
<td style="text-align:right;">
-17,850
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
VilleMtlX_Pct_FR
</td>
<td style="text-align:right;">
0,166
</td>
<td style="text-align:right;">
0,032
</td>
<td style="text-align:right;">
5,260
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table>
<p>L’interaction entre une variable qualitative et une variable quantitative peut être représentée par un graphique des effets marginaux. La pente (coefficient) de la variable quantitative varie en fonction des deux catégories de la variable qualitative dichotomique.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/ModeleInteractionBinaireFIG-1.png" alt="Graphique de l’effet marginal de l’interaction entre une variable quantitative et qualitative" width="75%" />
<p class="caption">
(#fig:ModeleInteractionBinaireFIG)Graphique de l’effet marginal de l’interaction entre une variable quantitative et qualitative
</p>
</div>
</div>
<div id="sect07543" class="section level4">
<h4><span class="header-section-number">7.5.4.3</span> Variable d’interaction entre deux variables dichotomiques</h4>
<div class="bloc_aller_loin">
<p><strong>Variable d’interaction entre deux variables dichotomiques</strong></p>
<p>Nous avons vu qu’il est possible d’introduire une variable d’interaction entre deux variables continues ou entre une variable continue et une autre dichotomique. Sachez qu’il est aussi possible d’introduire une interaction entre deux variables dichotomiques. Sur le sujet, vous pouvez consulter la section 8.3 de l’excellent ouvrage de Hanck et al. <span class="citation">(<a href="#ref-hanck2019introduction" role="doc-biblioref">2019</a>)</span>.</p>
</div>
</div>
</div>
</div>
<div id="sect076" class="section level2">
<h2><span class="header-section-number">7.6</span> Diagnostics de la régression</h2>
<p>Pour illustrer comment vérifier si le modèle respecte ou non les hypothèses de la régression, nous utilisons le modèle suivant :</p>
<p><code>modele3 &lt;- lm(VegPct ~ log(HABHA)+poly(AgeMedian,2)+Pct_014+Pct_65P+Pct_MV+Pct_FR, data = DataFinal)</code></p>
<div id="sect0761" class="section level3">
<h3><span class="header-section-number">7.6.1</span> Nombre d’observations</h3>
<p>Tous les auteurs ne s’entendent pas sur le nombre d’observations minimal que devrait comprendre une régression linéaire multiple, tant s’en faut! Parallèlement, d’autres auteurs proposent aussi des méthodes de simulation pour estimer les coefficients de régression sur un jeu de données comprenant peu d’observations. Bien qu’aucune règle ne soit bien établie, la question du nombre d’observations mérite d’être posée puisqu’un modèle basé sur trop peu d’observations risque de produire des coefficients de régression peu fiables. Par faible fiabilité des coefficients, nous entendons que la suppression d’une ou de plusieurs observations pourrait drastiquement changer l’effet et/ou la significativité d’une ou de plusieurs variables explicatives.</p>
<p>Dans un ouvrage classique intitulé <em>Using Multivariate Statistics</em>, Barbara Tabachnick et Linda Fidell <span class="citation">(<a href="#ref-tabachnick2007" role="doc-biblioref">2007</a>, 5:123‑124)</span> proposent deux règles de pouce (à la louche) :</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(n \geq 50 + 8k\)</span> avec <span class="math inline">\(n\)</span> et <span class="math inline">\(k\)</span> étant respectivement les nombres d’observations et de variables indépendantes, pour tester le coefficient de corrélation multiple (R<sup>2</sup>).</li>
<li><span class="math inline">\(n \geq 104 + k\)</span> pour tester individuellement chaque variable indépendante.</li>
</ol>
<p>Dans le modèle, nous avons 10 210 observations et variables indépendantes. Les deux conditions sont donc largement respectées.</p>
</div>
<div id="sect0762" class="section level3">
<h3><span class="header-section-number">7.6.2</span> Normalité des résidus</h3>
<p>Pour vérifier si les résidus sont normalement distribués, trois démarches largement décrites dans la section @ref(sect0254) peuvent être utilisées :</p>
<ul>
<li>le calcul des coefficients d’asymétrie et d’aplatissement;</li>
<li>les tests de normalité, particulièrement celui de Jarque-Bera basé sur un test multiplicateur de Lagrange;</li>
<li>les graphiques (histogramme avec courbe normale et diagramme quantile-quantile) (figure @ref(fig:VerifierNormaliteResidus)).</li>
</ul>
<p>Les deux premières démarches étant parfois très restrictives, nous accordons habituellement une attention particulière aux graphiques.</p>
<p>Pour notre modèle, les coefficients d’asymétrie (−0,263) et d’aplatissement (1,149) signalent que la distribution est plutôt symétrique, mais leptokurtique, c’est-à-dire que les valeurs des résidus sont bien réparties autour de 0, mais avec une faible dispersion. Puisque la valeur de <em>p</em> associée au test de Jarque-Bera est inférieure à 0,05, nous pouvons en conclure que la distribution des résidus est anormale. La forme pointue de la distribution est d’ailleurs confirmée à la lecture de l’histogramme avec la courbe normale et du diagramme quantile-quantile.</p>
<pre><code>## Skewness Kurtosis 
##   -0.161    1.193</code></pre>
<pre><code>## 
##  Robust Jarque Bera Test
## 
## data:  residus
## X-squared = 513.15, df = 2, p-value &lt; 2.2e-16</code></pre>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/VerifierNormaliteResidus-1.png" alt="Vérification de la normalité des résidus" width="75%" />
<p class="caption">
(#fig:VerifierNormaliteResidus)Vérification de la normalité des résidus
</p>
</div>
</div>
<div id="sect0763" class="section level3">
<h3><span class="header-section-number">7.6.3</span> Linéarité et homoscédasticité des résidus</h3>
<p>Un modèle est efficace si la dispersion des résidus est homogène sur tout le spectre des valeurs prédites de la variable dépendante. Dans le cas d’une absence d’homoscédasticité – appelée problème d’hétéroscédasticité –, le nuage de points construit à partir des résidus et des valeurs prédites (figure @ref(fig:VerifierHomoscedasticiteFig)) prend la forme d’une trompette ou d’un entonnoir : les résidus sont alors faibles quand les valeurs prédites sont faibles et sont de plus en plus élevés au fur et à mesure que les valeurs prédites augmentent.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/VerifierHomoscedasticiteFig-1.png" alt="Distribution des résidus en fonction des valeurs prédites" width="75%" />
<p class="caption">
(#fig:VerifierHomoscedasticiteFig)Distribution des résidus en fonction des valeurs prédites
</p>
</div>
<p>Le test de Breusch-Pagan est souvent utilisé pour vérifier l’homoscédasticité des résidus. Il est construit avec les hypothèses suivantes :</p>
<ul>
<li><em>H<sub>0</sub></em> : homoscédasticité, c’est-à-dire que les termes d’erreur ont une variance constante à travers les valeurs prédites.</li>
<li><em>H<sub>1</sub></em> : hétéroscédasticité.</li>
</ul>
<p>Si la valeur de <em>p</em> associée à ce test est inférieure à 0,05, nous réfutons l’hypothèse nulle et nous concluons qu’il y a un problème d’hétéroscédasticité, ce qui est le cas pour notre modèle.</p>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  modele3
## BP = 1722, df = 8, p-value &lt; 2.2e-16</code></pre>
</div>
<div id="sect0764" class="section level3">
<h3><span class="header-section-number">7.6.4</span> Absence de multicolinéarité excessive</h3>
<p>Un modèle présente un problème de multicolinéarité excessive lorsque deux variables indépendantes ou plus sont très fortement corrélées entre elles. Rappelez-vous qu’un coefficient de régression estime l’effet d’une variable dépendante (<span class="math inline">\(X_k\)</span>) si toutes les autres VI restent constantes (c’est-à-dire une fois les autres VI contrôlées, toutes choses étant égales par ailleurs…).</p>
<p>Prenons deux variables indépendantes (<span class="math inline">\(X_1\)</span> et <span class="math inline">\(X_2\)</span>) fortement corrélées avec un coefficient de Pearson très élevé (0,90 par exemple). Admettons que chacune des deux VI a un effet important et significatif sur votre VD lorsqu’une seule est introduite dans le modèle. Si les deux variables sont introduites dans le même modèle, vous évaluez donc l’effet de <span class="math inline">\(X_1\)</span> une fois contrôlé <span class="math inline">\(X_2\)</span> et l’effet de <span class="math inline">\(X_2\)</span> une fois contrôlé <span class="math inline">\(X_1\)</span>. Par conséquent, l’effet de l’une des deux devient très faible, voire probablement non significatif.</p>
<div id="sect07641" class="section level4">
<h4><span class="header-section-number">7.6.4.1</span> Comment évaluer la multicolinéarité?</h4>
<p>Pour ce faire, nous utilisons habituellement le facteur d’inflation de la variance (<em>Variance Inflation Factor – VIF</em> en anglais). Le calcul de ce facteur pour chaque VI est basé sur trois étapes.</p>
<ol style="list-style-type: decimal">
<li>Pour chaque VI, nous construisons un modèle de régression multiple où elle est expliquée par toutes les autres variables indépendantes du modèle. Par exemple, pour la première VI (<span class="math inline">\(X_1\)</span>), l’équation du modèle s’écrit :</li>
</ol>

<p><span class="math display">\[\begin{equation} 
X_1 = b_0 + b_2X_2 +\ldots+ b_kX_k + e
(\#eq:RegVIF)
\end{equation}\]</span>
</p>
<ol start="2" style="list-style-type: decimal">
<li>À partir de cette équation, nous obtenons ainsi un <span class="math inline">\(R^2\)</span> qui nous indique la proportion de la variance de <span class="math inline">\(X_1\)</span> expliquée par les autres VI. Par convention, nous calculons la tolérance (équation @ref(eq:ToleranceVIF)) qui indique la proportion de la variance de <span class="math inline">\(X_k\)</span> n’étant pas expliquée par les autres VI. En guise d’exemple, une valeur de tolérance égale à 0,1 signale que 90nbsp;% de la variance de <span class="math inline">\(X_k\)</span> est expliqué par les autres variables, ce qui est un problème de multicolinéarité en soit. Concrètement, plus la valeur de la tolérance est proche de zéro, plus c’est problématique.</li>
</ol>

<p><span class="math display">\[\begin{equation} 
\mbox{Tolérance}_k=1-R_k^2=\frac{1}{VIF_k}
(\#eq:ToleranceVIF)
\end{equation}\]</span>
</p>
<ol start="3" style="list-style-type: decimal">
<li>Puis, nous calculons le facteur d’inflation de la variance (équation @ref(eq:VIF)). Là encore, des règles de pouce (à la louche) sont utilisées. Certains considéreront une valeur de VIF supérieur à 10 (soit une tolérance à 0,1 ou inférieure) comme problématique, d’autres retiendront le seuil de 5 plus conservateur (soit une tolérance à 0,2 ou inférieure).</li>
</ol>

<p><span class="math display">\[\begin{equation} 
VIF_k = \frac{1}{1-R_k^2} 
(\#eq:VIF)
\end{equation}\]</span>
</p>
<p>Pour notre modèle, toutes les valeurs de VIF sont inférieures à 2, indiquant, sans l’ombre d’un doute, l’absence de multicolinéarité excessive.</p>
<pre><code>##                     GVIF Df GVIF^(1/(2*Df))
## VilleMtl           1.319  1           1.149
## log(HABHA)         1.342  1           1.159
## poly(AgeMedian, 2) 1.399  2           1.087
## Pct_014            1.601  1           1.265
## Pct_65P            1.317  1           1.147
## Pct_MV             1.483  1           1.218
## Pct_FR             1.818  1           1.348</code></pre>
</div>
<div id="sect07642" class="section level4">
<h4><span class="header-section-number">7.6.4.2</span> Comment régler un problème de multicolinéarité?</h4>
<ul>
<li><p>La prudence est de mise! Si une ou plusieurs variables présentent une valeur de VIF supérieure à 5, construisez une matrice de corrélation de Pearson (section @ref(sect0437)) et repérez les valeurs de corrélation supérieures à 0,8 ou inférieures à −0,8. Vous repérerez ainsi les corrélations problématiques entre deux variables indépendantes du modèle.</p></li>
<li><p>Refaites ensuite un modèle en ôtant la variable indépendante avec la plus forte valeur de VIF (7 ou 12 par exemple), et revérifiez les valeurs de VIF. Refaites cette étape si le problème de multicolinéarité excessive persiste.</p></li>
</ul>
<div class="bloc_attention">
<p><strong>Une multicolinéarité excessive n’est pas forcément inquiétante</strong></p>
<p>Nous avons vu plus haut comment introduire des variables indépendantes particulières comme des variables d’interaction (<span class="math inline">\(X_1 \times X_2\)</span>) ou des variables sous une forme polynomiale (ordre 2 : <span class="math inline">\(X_1 + X_1^2\)</span>; ordre 3 : <span class="math inline">\(X_1 + X_1^2 + X_1^3\)</span>, etc.). Bien entendu, ces termes composant les variables d’interaction ou d’une forme polynomiale sont habituellement fortement corrélés entre eux. Cela n’est toutefois pas problématique!</p>
<p>Dans l’exemple ci-dessous, nous obtenons deux valeurs de VIF très élevées pour la variable d’interaction <code>Pct_014:DistCBDkm</code> (16,713) et l’un des paramètres à partir duquel elle est calculée, soit <code>DistCBDkm</code> (12,526).</p>
<pre><code>##                      GVIF Df GVIF^(1/(2*Df))
## log(HABHA)          1.426  1           1.194
## poly(AgeMedian, 2)  1.768  2           1.153
## Pct_014             3.326  1           1.824
## Pct_65P             1.359  1           1.166
## Pct_MV              1.495  1           1.223
## Pct_FR              1.810  1           1.345
## DistCBDkm          12.526  1           3.539
## Pct_014:DistCBDkm  16.713  1           4.088</code></pre>
</div>
</div>
</div>
<div id="sect0766" class="section level3">
<h3><span class="header-section-number">7.6.5</span> Absence d’observations aberrantes</h3>
<div id="sect07661" class="section level4">
<h4><span class="header-section-number">7.6.5.1</span> Détection des observations très influentes du modèle</h4>
<p>Lors de l’analyse des corrélations (section @ref(sect043)), nous avons vu que des valeurs extrêmes peuvent avoir un impact important sur le coefficient de corrélation de Pearson. Le même principe s’applique à la régression multiple, pour laquelle nous nous s’attendrions à ce que chaque observation joue un rôle équivalent dans la détermination de l’équation du modèle.</p>
<p>Autrement dit, il est possible que certaines observations avec des valeurs extrêmes – fortement dissemblables des autres – aient une influence importante, voire démesurée, dans l’estimation du modèle. Concrètement, cela signifie que si elles étaient ôtées, les coefficients de régression et la qualité d’ajustement du modèle pourraient changer drastiquement. Deux mesures sont habituellement utilisées pour évaluer l’influence de chaque observation sur le modèle :</p>
<ul>
<li><strong>La statistique de la distance de Cook</strong> qui mesure l’influence de chaque observation sur les résultats du modèle. Brièvement, la distance de Cook évalue l’influence de l’observation <em>i</em> en la supprimant du modèle (équation @ref(eq:DistanceCook)). Plus sa valeur est élevée, plus l’observation joue un rôle important dans la détermination de l’équation de régression.</li>
</ul>

<p><span class="math display">\[\begin{equation} 
D_i = \frac{\sum_{j=1}^n(\widehat{y}_i-\widehat{y}_{i(j)})^2}{ks^2}
(\#eq:DistanceCook)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(\widehat{y}_{i(j)}\)</span> la valeur prédite quand l’observation <em>i</em> est ôté du modèle, <em>k</em> le nombre de variables indépendantes et <span class="math inline">\(s^2\)</span> l’erreur quadratique moyenne du modèle.</p>
<ul>
<li><strong>La statistique de l’effet levier</strong> (<em>leverage value</em> en anglais) qui varie de 0 (aucune influence) à 1 (explique tout le modèle). La somme de toutes les valeurs de cette statistique est égale au nombre de VI dans le modèle.</li>
</ul>
<p><strong>Quel critère retenir pour détecter les observations avec potentiellement une trop grande influence sur le modèle?</strong></p>
<p>Pour les repérer, voire les supprimer, plusieurs auteur(e)s proposent les seuils suivants : <span class="math inline">\(4/n\)</span> ou <span class="math inline">\(8/n\)</span> ou <span class="math inline">\(16/n\)</span>. Avec 10210 observations dans le modèle, les seuils seraient les suivants :</p>
<pre><code>## Nombre d&#39;observations = 10210 (100 %) 
##  4/n = 0.00039 
##  8/n = 0.00078 
##  16/n = 0.00157 
## Observations avec une valeur supérieure ou égale aux différents seuils 
##  4/n = 605 soit 5.93  % 
##  8/n = 275 soit 2.69  % 
##  16/n = 133 soit 1.3  %</code></pre>
<p>Le critère de <span class="math inline">\(4/n\)</span> étant plutôt sévère, nous privilégions généralement celui de <span class="math inline">\(8/n\)</span>, voire <span class="math inline">\(16/n\)</span>. Il est aussi possible de construire un nuage de points pour les repérer (figure @ref(fig:GraphCookLev)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/GraphCookLev-1.png" alt="Repérage graphique les valeurs influentes du modèle" width="75%" />
<p class="caption">
(#fig:GraphCookLev)Repérage graphique les valeurs influentes du modèle
</p>
</div>
</div>
<div id="sect07662" class="section level4">
<h4><span class="header-section-number">7.6.5.2</span> Quoi faire avec les observations très influentes du modèle</h4>
<p>Trois approches sont possibles :</p>
<ul>
<li><p><strong>Recourir à des régressions <em>boostrap</em></strong>, ce qui permet généralement de supprimer l’effet de ces observations. Brièvement, le principe général est de créer un nombre élevé d’échantillons du jeu de données initial (1000 à 2000 itérations par exemple) et de construire un modèle de régression pour chacun d’eux. On obtiendra ainsi des intervalles de confiance pour les coefficients de régression et les mesures d’ajustement du modèle.</p></li>
<li><p><strong>Supprimer les observations trop influentes</strong> (avec l’un des critères de <span class="math inline">\(4/n\)</span>, <span class="math inline">\(8/n\)</span> et <span class="math inline">\(16/n\)</span> vus plus haut). Une fois supprimées, il convient 1) de recalculer le modèle, 2) de refaire le diagnostic de la régression au complet et finalement, 3) de comparer les modèles avant et après suppression des valeurs trop influentes, notamment la qualité d’ajustement du modèle (R<sup>2</sup> ajusté) et les coefficients de régression. Des changements importants indiqueront que le premier modèle est potentiellement biaisé.</p></li>
<li><p><strong>Utiliser un modèle linéaire généralisé (GLM)</strong> permettant d’utiliser une distribution différente correspondant plus à votre jeu de données (chapitre @ref(chap08)).</p></li>
</ul>
</div>
</div>
</div>
<div id="sect077" class="section level2">
<h2><span class="header-section-number">7.7</span> Mise en œuvre dans R</h2>
<div id="sect0771" class="section level3">
<h3><span class="header-section-number">7.7.1</span> Fonctions <code>lm</code>, <code>summary()</code> et <code>confint()</code></h3>
<p>Les fonctions de base <code>lm</code>, <code>summary()</code> et <code>confint()</code> permettent respectivement 1) de construire un modèle, 2) d’afficher ces résultats et 3) d’obtenir les intervalles de confiance des coefficients de régression :</p>
<ul>
<li><code>monModele &lt;- lm(Y ~X1+X2+..+Xk)</code> avec <em>Y</em> étant la variable dépendante et les variables indépendantes (<code>X1 à Xk</code>) étant séparées par le signe +.</li>
<li><code>summary(monModele)</code></li>
<li><code>confint(monModele, level=.95)</code>.</li>
</ul>
<p>Dans la syntaxe ci-dessous, vous retrouverez les différents modèles abordés dans les sections précédentes; remarquez que toutes que les lignes <code>summary</code> sont mises en commentaires afin de ne pas afficher les résultats des modèles.</p>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="#cb686-1"></a><span class="co"># Chargement des données</span></span>
<span id="cb686-2"><a href="#cb686-2"></a><span class="kw">load</span>(<span class="st">&quot;data/lm/DataVegetation.RData&quot;</span>)</span>
<span id="cb686-3"><a href="#cb686-3"></a></span>
<span id="cb686-4"><a href="#cb686-4"></a><span class="co"># 1er modèle de régression</span></span>
<span id="cb686-5"><a href="#cb686-5"></a>modele1 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span>AgeMedian<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR,</span>
<span id="cb686-6"><a href="#cb686-6"></a>              <span class="dt">data =</span> DataFinal)</span>
<span id="cb686-7"><a href="#cb686-7"></a><span class="co"># summary(Modele1)</span></span>
<span id="cb686-8"><a href="#cb686-8"></a></span>
<span id="cb686-9"><a href="#cb686-9"></a><span class="co"># 2e modèle de régression : fonction polynomiale d&#39;ordre 2 (poly(AgeMedian,2))</span></span>
<span id="cb686-10"><a href="#cb686-10"></a>modele2 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span>HABHA<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR,</span>
<span id="cb686-11"><a href="#cb686-11"></a>              <span class="dt">data =</span> DataFinal)</span>
<span id="cb686-12"><a href="#cb686-12"></a><span class="co"># summary(Modele2)</span></span>
<span id="cb686-13"><a href="#cb686-13"></a></span>
<span id="cb686-14"><a href="#cb686-14"></a><span class="co"># 3e modèle de régression : forme logarithmique (log(HABHA))</span></span>
<span id="cb686-15"><a href="#cb686-15"></a>modele3 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR,</span>
<span id="cb686-16"><a href="#cb686-16"></a>              <span class="dt">data =</span> DataFinal)</span>
<span id="cb686-17"><a href="#cb686-17"></a><span class="co"># summary(Modele3)</span></span>
<span id="cb686-18"><a href="#cb686-18"></a></span>
<span id="cb686-19"><a href="#cb686-19"></a><span class="co"># 4e modèle de régression : VI dichotomique</span></span>
<span id="cb686-20"><a href="#cb686-20"></a><span class="co"># création de la variable dichotomique (VilleMtl)</span></span>
<span id="cb686-21"><a href="#cb686-21"></a>DataFinal<span class="op">$</span>VilleMtl &lt;-<span class="st"> </span><span class="kw">ifelse</span>(DataFinal<span class="op">$</span>SDRNOM <span class="op">==</span><span class="st"> &quot;Montréal&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb686-22"><a href="#cb686-22"></a>modele4 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR<span class="op">+</span></span>
<span id="cb686-23"><a href="#cb686-23"></a><span class="st">                       </span>VilleMtl, <span class="co"># variable dichotomique</span></span>
<span id="cb686-24"><a href="#cb686-24"></a>              <span class="dt">data =</span> DataFinal)</span>
<span id="cb686-25"><a href="#cb686-25"></a><span class="co"># summary(Modele4)</span></span>
<span id="cb686-26"><a href="#cb686-26"></a></span>
<span id="cb686-27"><a href="#cb686-27"></a><span class="co"># 5e modèle de régression : VI polytomique</span></span>
<span id="cb686-28"><a href="#cb686-28"></a><span class="co"># création de la variable polytomique (Munic)</span></span>
<span id="cb686-29"><a href="#cb686-29"></a>DataFinal<span class="op">$</span>Munic &lt;-<span class="st"> </span><span class="kw">relevel</span>(DataFinal<span class="op">$</span>SDRNOM, <span class="dt">ref=</span><span class="st">&quot;Montréal&quot;</span>)</span>
<span id="cb686-30"><a href="#cb686-30"></a>modele5 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR<span class="op">+</span></span>
<span id="cb686-31"><a href="#cb686-31"></a><span class="st">                       </span>Munic, <span class="dt">data =</span> DataFinal)</span>
<span id="cb686-32"><a href="#cb686-32"></a><span class="co"># summary(Modele5)</span></span>
<span id="cb686-33"><a href="#cb686-33"></a></span>
<span id="cb686-34"><a href="#cb686-34"></a></span>
<span id="cb686-35"><a href="#cb686-35"></a><span class="co"># 6e modèle de régression : interaction entre deux VI continues, </span></span>
<span id="cb686-36"><a href="#cb686-36"></a><span class="co"># soit DistCBDkm*Pct_014</span></span>
<span id="cb686-37"><a href="#cb686-37"></a>modele6 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR<span class="op">+</span></span>
<span id="cb686-38"><a href="#cb686-38"></a><span class="st">                       </span>DistCBDkm<span class="op">+</span>DistCBDkm<span class="op">*</span>Pct_<span class="dv">014</span>,</span>
<span id="cb686-39"><a href="#cb686-39"></a>                <span class="dt">data =</span> DataFinal)</span>
<span id="cb686-40"><a href="#cb686-40"></a><span class="co"># summary(Modele6)</span></span>
<span id="cb686-41"><a href="#cb686-41"></a></span>
<span id="cb686-42"><a href="#cb686-42"></a><span class="co"># 7e modèle de régression : interaction entre une VI continue et une VI dichotomique,</span></span>
<span id="cb686-43"><a href="#cb686-43"></a><span class="co"># soit VilleMtl*Pct_FR</span></span>
<span id="cb686-44"><a href="#cb686-44"></a>modele8 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR<span class="op">+</span></span>
<span id="cb686-45"><a href="#cb686-45"></a><span class="st">                       </span>VilleMtl<span class="op">*</span>Pct_FR,</span>
<span id="cb686-46"><a href="#cb686-46"></a>                <span class="dt">data =</span> DataFinal)</span>
<span id="cb686-47"><a href="#cb686-47"></a><span class="co"># summary(Modele7)</span></span></code></pre></div>
<p>À la figure @ref(fig:figOutputRegression), les résultats de la régression linéaire multiple, obtenus avec la <code>summary(monModele)</code>, sont présentés en quatre sections distinctes :</p>
<ol style="list-style-type: lower-alpha">
<li>Le rappel de l’équation du modèle.</li>
<li>Quelques statistiques descriptives sur les résidus du modèle, soit la différence entre les valeurs observées et prédites.</li>
<li>Un tableau pour les coefficients de régression comprenant plusieurs colonnes, à savoir les coefficients de régression (<code>Estimate</code>), l’erreur type du coefficient (<code>Std. Error</code>), la valeur de <em>t</em> (<code>t value</code>) et la probabilité associée à la valeur de <em>t</em> (<code>Pr(&gt;|t|)</code>). La première ligne de ce tableau (<code>Estimate</code>) est pour la constante (<em>Intercept</em> en anglais) et celles qui suivent sont pour les variables indépendantes.</li>
<li>Les mesures d’ajustement du modèle, dont le RMSE (<code>Residual standard error</code>), les R<sup>2</sup> classique (<code>Multiple R-squared</code>) et ajusté (<code>Adjusted R-squared</code>), la statistique <em>F</em> avec le nombre de degrés de liberté en lignes (nombre d’observations) et en colonnes (<em>n-k-1</em>) ainsi que la valeur de <em>p</em> qui est lui associée (<code>F-statistic:  1223 on 6 and 10203 DF,  p-value: &lt; 2.2e-16</code>).</li>
</ol>
<div class="figure" style="text-align: center">
<img src="images/lm/SortiesLM.jpg" alt="Différentes parties obtenues avec la fonction summary(Modèle)" width="75%" />
<p class="caption">
(#fig:figOutputRegression)Différentes parties obtenues avec la fonction summary(Modèle)
</p>
</div>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="#cb687-1"></a><span class="co"># Intervalle de confiance des coefficients à 95 %</span></span>
<span id="cb687-2"><a href="#cb687-2"></a><span class="kw">confint</span>(modele3)</span></code></pre></div>
<pre><code>##                            2.5 %        97.5 %
## (Intercept)           50.8684505   54.79255157
## log(HABHA)            -7.1847527   -6.52495353
## poly(AgeMedian, 2)1  -18.5676034   42.53686203
## poly(AgeMedian, 2)2 -313.4726002 -258.81630119
## Pct_014                0.8793672    1.00190861
## Pct_65P                0.2699504    0.34250907
## Pct_MV                -0.0557951   -0.01681481
## Pct_FR                -0.3659445   -0.32269562</code></pre>
</div>
<div id="sect0772" class="section level3">
<h3><span class="header-section-number">7.7.2</span> Comparaison des modèles</h3>
<p>Tel que détaillé à la section @ref(sect0732), pour comparer des modèles imbriqués, il convient d’analyser les valeurs du R<sup>2</sup> ajusté et du <em>F</em> incrémentiel, ce qui peut être fait en trois étapes.</p>
<p><strong>Première étape.</strong> Il peut être judicieux d’afficher l’équation des différents modèles afin de se remémorer les VI introduites dans chacun d’eux, et ce, avec la fonction <code>MonModèle$call$formula</code>.</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="#cb689-1"></a><span class="co"># Rappel des équations des huit modèles </span></span>
<span id="cb689-2"><a href="#cb689-2"></a><span class="kw">print</span>(modele1<span class="op">$</span>call<span class="op">$</span>formula)</span></code></pre></div>
<pre><code>## VegPct ~ HABHA + AgeMedian + Pct_014 + Pct_65P + Pct_MV + Pct_FR</code></pre>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb691-1"><a href="#cb691-1"></a><span class="kw">print</span>(modele2<span class="op">$</span>call<span class="op">$</span>formula)</span></code></pre></div>
<pre><code>## VegPct ~ HABHA + poly(AgeMedian, 2) + Pct_014 + Pct_65P + Pct_MV + 
##     Pct_FR</code></pre>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb693-1"><a href="#cb693-1"></a><span class="kw">print</span>(modele3<span class="op">$</span>call<span class="op">$</span>formula)</span></code></pre></div>
<pre><code>## VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + 
##     Pct_MV + Pct_FR</code></pre>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb695-1"><a href="#cb695-1"></a><span class="kw">print</span>(modele4<span class="op">$</span>call<span class="op">$</span>formula)</span></code></pre></div>
<pre><code>## VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + 
##     Pct_MV + Pct_FR + VilleMtl</code></pre>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="#cb697-1"></a><span class="kw">print</span>(modele5<span class="op">$</span>call<span class="op">$</span>formula)</span></code></pre></div>
<pre><code>## VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + 
##     Pct_MV + Pct_FR + Munic</code></pre>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="#cb699-1"></a><span class="kw">print</span>(modele6<span class="op">$</span>call<span class="op">$</span>formula)</span></code></pre></div>
<pre><code>## VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + 
##     Pct_MV + Pct_FR + DistCBDkm + DistCBDkm * Pct_014</code></pre>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="#cb701-1"></a><span class="kw">print</span>(modele7<span class="op">$</span>call<span class="op">$</span>formula)</span></code></pre></div>
<pre><code>## VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + 
##     Pct_MV + Pct_FR + VilleMtl + VilleMtlX_Pct_FR</code></pre>
<p><strong>Deuxième étape.</strong> La syntaxe ci-dessous vous permet de comparer les R<sup>2</sup> ajustés des différents modèles. Nous constatons ainsi que :</p>
<ul>
<li>La valeur du R<sup>2</sup> ajusté du modèle 2 est supérieure à celle du modèle 1 (0,4378 versus 0,4179), signalant que la forme polynomiale d’ordre 2 pour l’âge médian des bâtiments (<code>poly(AgeMedian, 2)</code>) améliore la prédiction comparativement à la forme originelle de (<code>AgeMedian</code>).</li>
<li>La valeur du R<sup>2</sup> ajusté du modèle 3 est supérieure à celle du modèle 2 (0,4653 versus 0,4378), signalant que la forme logarithmique pour la densité de population (<code>log(HABHA)</code>) améliore la prédiction comparativement à la forme originelle (<code>HABHA</code>).</li>
<li>La valeur du R<sup>2</sup> ajusté du modèle 4 est supérieure à celle du modèle 3 (0,4863 versus 0,4653), signalant que l’introduction de la variable dichotomique (<code>VilleMtl</code>) pour la municipalité apporte un gain de variance expliquée non négligeable.</li>
<li>La valeur du R<sup>2</sup> ajusté du modèle 5 est supérieure à celle du modèle 4 (0,5064 versus 0,4863), signalant que l’introduction de la variable polytomique pour les municipalités de l’île de Montréal (<code>Muni</code>) améliore la prédiction du modèle comparativement à la variable dichotomique (<code>VilleMtl</code>).</li>
<li>La valeur du R<sup>2</sup> ajusté du modèle 6 est supérieure à celle du modèle 2 (0,4953 versus 0,4378), signalant que l’introduction d’une variable d’interaction entre deux variables continues (<code>DistCBDkm + DistCBDkm * Pct_014</code>) apporte également un gain substantiel comparativement au modèle 2, ne comprenant pas cette variable d’interaction.</li>
<li>La valeur du R<sup>2</sup> ajusté du modèle 7 est supérieure à celle du modèle 2 (0,4877 versus 0,4378), signalant que l’introduction d’une variable d’interaction entre une variable continue et la variable dichotomique (<code>DistCBDkm + DistCBDkm * Pct_014</code>) apporte également un gain substantiel comparativement au modèle 2, ne comprenant pas cette variable d’interaction.</li>
</ul>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="#cb703-1"></a><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Comparaison des R2 ajustés :&quot;</span>,</span>
<span id="cb703-2"><a href="#cb703-2"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Modèle 1.&quot;</span>, <span class="kw">round</span>(<span class="kw">summary</span>(modele1)<span class="op">$</span>adj.r.squared,<span class="dv">4</span>), </span>
<span id="cb703-3"><a href="#cb703-3"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Modèle 2.&quot;</span>, <span class="kw">round</span>(<span class="kw">summary</span>(modele2)<span class="op">$</span>adj.r.squared,<span class="dv">4</span>), </span>
<span id="cb703-4"><a href="#cb703-4"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Modèle 3.&quot;</span>, <span class="kw">round</span>(<span class="kw">summary</span>(modele3)<span class="op">$</span>adj.r.squared,<span class="dv">4</span>), </span>
<span id="cb703-5"><a href="#cb703-5"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Modèle 4.&quot;</span>, <span class="kw">round</span>(<span class="kw">summary</span>(modele4)<span class="op">$</span>adj.r.squared,<span class="dv">4</span>), </span>
<span id="cb703-6"><a href="#cb703-6"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Modèle 5.&quot;</span>, <span class="kw">round</span>(<span class="kw">summary</span>(modele5)<span class="op">$</span>adj.r.squared,<span class="dv">4</span>), </span>
<span id="cb703-7"><a href="#cb703-7"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Modèle 6.&quot;</span>, <span class="kw">round</span>(<span class="kw">summary</span>(modele6)<span class="op">$</span>adj.r.squared,<span class="dv">4</span>), </span>
<span id="cb703-8"><a href="#cb703-8"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Modèle 7.&quot;</span>, <span class="kw">round</span>(<span class="kw">summary</span>(modele7)<span class="op">$</span>adj.r.squared,<span class="dv">4</span>)</span>
<span id="cb703-9"><a href="#cb703-9"></a>)</span></code></pre></div>
<pre><code>## 
## Comparaison des R2 ajustés : 
## Modèle 1. 0.4179 
## Modèle 2. 0.4378 
## Modèle 3. 0.4653 
## Modèle 4. 0.4863 
## Modèle 5. 0.5064 
## Modèle 6. 0.4953 
## Modèle 7. 0.4877</code></pre>
<p><strong>Troisième étape.</strong> La syntaxe ci-dessous permet d’obtenir le <em>F</em> incrémentiel pour des modèles ne comprenant pas le même nombre de variables dépendantes, et ce, en utilisant la fonction <code>anova(modele1, modele2, ..., modelen)</code>.</p>
<p>Par exemple, la syntaxe <code>anova(modele1, modele2)</code> permet de comparer les deux modèles et signale que le gain de variance expliquée entre les deux modèles (R<sup>2</sup> de 0,4179 et de 0,4378) est significatif (<em>F</em> incrémentiel = 362,64; <em>p</em> &lt; 0,001).</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="#cb705-1"></a><span class="co"># Comparaison des deux modèles uniquement (modèles 1 et 2)</span></span>
<span id="cb705-2"><a href="#cb705-2"></a><span class="kw">anova</span>(modele1, modele2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: VegPct ~ HABHA + AgeMedian + Pct_014 + Pct_65P + Pct_MV + Pct_FR
## Model 2: VegPct ~ HABHA + poly(AgeMedian, 2) + Pct_014 + Pct_65P + Pct_MV + 
##     Pct_FR
##   Res.Df     RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1  10203 2046427                                  
## 2  10202 1976182  1     70245 362.64 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Il est aussi possible de comparer plusieurs modèles simultanément. Notez que dans la syntaxe ci-dessous, le troisième modèle n’est pas inclus, car il comprend le même nombre de variables indépendantes que le second modèle; il en va de même pour le sixième modèle comparativement au cinquième. Ici aussi, l’analyse des valeurs de <em>F</em> et de <em>p</em> vous permettent de vérifier si les modèles, et donc leurs R<sup>2</sup> ajustés, sont significativement différents (quand <em>p</em> &lt; 0,05).</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="#cb707-1"></a><span class="co"># Comparaison de plusieurs modèles</span></span>
<span id="cb707-2"><a href="#cb707-2"></a><span class="kw">anova</span>(modele1, modele2, modele4, modele5, modele7)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: VegPct ~ HABHA + AgeMedian + Pct_014 + Pct_65P + Pct_MV + Pct_FR
## Model 2: VegPct ~ HABHA + poly(AgeMedian, 2) + Pct_014 + Pct_65P + Pct_MV + 
##     Pct_FR
## Model 3: VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + 
##     Pct_MV + Pct_FR + VilleMtl
## Model 4: VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + 
##     Pct_MV + Pct_FR + Munic
## Model 5: VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + 
##     Pct_MV + Pct_FR + VilleMtl + VilleMtlX_Pct_FR
##   Res.Df     RSS  Df Sum of Sq        F    Pr(&gt;F)    
## 1  10203 2046427                                     
## 2  10202 1976182   1     70245  412.995 &lt; 2.2e-16 ***
## 3  10201 1805547   1    170636 1003.224 &lt; 2.2e-16 ***
## 4  10188 1732849  13     72698   32.878 &lt; 2.2e-16 ***
## 5  10200 1800664 -12    -67815   33.226 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="bloc_attention">
<p><strong>Quel modèle choisir?</strong></p>
<p>Nous avons déjà évoqué le principe de parcimonie. À titre de rappel, l’ajout de variables indépendantes qui s’avèrent significatives fait inévitablement augmenter la variance expliquée et ainsi la valeur R<sup>2</sup> ajusté. Par contre, elle peut rendre le modèle plus complexe à analyser, voire entraîner un surajustement du modèle. Nous avons vu que l’introduction des variables ditchtomique, polytomique et d’interaction avait pour effet d’augmenter la capacité de prédiction du modèle. Quoi qu’il en soit, le gain de variance expliquée s’élève à environ 4nbsp;% entre le troisième modèle versus le cinquième et le sixième :</p>
<ul>
<li>Modèle 3 (R<sup>2</sup>=0,465). <code>VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + Pct_MV + Pct_FR</code></li>
<li>Modèle 5 (R<sup>2</sup>=0,506). <code>VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + Muni</code></li>
<li>Modèle 6 (R<sup>2</sup>=0,495). <code>VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + Pct_65P + Pct_MV + Pct_FR + DistCBDkm + DistCBDkm * Pct_014</code></li>
</ul>
<p>Par conséquent, il est légitime de se questionner sur le bien-fondé de conserver ces variables indépendantes additionnelles : <code>Muni</code> pour le modèle 5 et <code>DistCBDkm + DistCBDkm * Pct_014</code> pour le modèle 6. Trois options sont alors envisageables :</p>
<ul>
<li>Bien entendu, conservez l’une ou l’autre de ces variables additionnelles si elles sont initialement reliées à votre cadre théorique.</li>
<li>Conservez l’une ou l’autre de ces variables additionnelles si elles permettent de répondre à une question spécifique (non prévue initialement) et si les associations ainsi révélées méritent, selon vous, discussion.</li>
<li>Supprimez-les si leur apport est limité et ne fait que complexifier le modèle.</li>
</ul>
</div>
</div>
<div id="sect0773" class="section level3">
<h3><span class="header-section-number">7.7.3</span> Diagnostic sur un modèle</h3>
<div id="sect07731" class="section level4">
<h4><span class="header-section-number">7.7.3.1</span> Vérification le nombre d’observations</h4>
<p>La syntaxe suivante permet de vérifier si le nombre d’observations est suffisant pour tester le R<sup>2</sup> et chacune des variables indépendantes.</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="#cb709-1"></a>modele3 &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb709-2"><a href="#cb709-2"></a><span class="st">                       </span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal)</span>
<span id="cb709-3"><a href="#cb709-3"></a></span>
<span id="cb709-4"><a href="#cb709-4"></a><span class="co"># Nombre d&#39;observation</span></span>
<span id="cb709-5"><a href="#cb709-5"></a>nobs &lt;-<span class="st"> </span><span class="kw">length</span>(modele3<span class="op">$</span>fitted.values)</span>
<span id="cb709-6"><a href="#cb709-6"></a></span>
<span id="cb709-7"><a href="#cb709-7"></a><span class="co"># Nombre de variables indépendantes (coefficients moins la constante)</span></span>
<span id="cb709-8"><a href="#cb709-8"></a>k &lt;-<span class="st"> </span><span class="kw">length</span>(modele3<span class="op">$</span>coefficients)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb709-9"><a href="#cb709-9"></a></span>
<span id="cb709-10"><a href="#cb709-10"></a><span class="co"># Première règle de pouce</span></span>
<span id="cb709-11"><a href="#cb709-11"></a><span class="cf">if</span>(nobs <span class="op">&gt;=</span><span class="st"> </span><span class="dv">50</span><span class="op">+</span>(<span class="dv">8</span><span class="op">*</span>k)){</span>
<span id="cb709-12"><a href="#cb709-12"></a>    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Nombre d&#39;observations suffisant pour tester le R2&quot;</span>)</span>
<span id="cb709-13"><a href="#cb709-13"></a>}<span class="cf">else</span>{</span>
<span id="cb709-14"><a href="#cb709-14"></a>  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Attention! Nombre d&#39;observations insuffisant pour tester le R2&quot;</span>)</span>
<span id="cb709-15"><a href="#cb709-15"></a>}</span></code></pre></div>
<pre><code>## 
## Nombre d&#39;observations suffisant pour tester le R2</code></pre>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="#cb711-1"></a><span class="co"># Deuxième règle de pouce</span></span>
<span id="cb711-2"><a href="#cb711-2"></a><span class="cf">if</span>(nobs <span class="op">&gt;=</span><span class="st"> </span><span class="dv">104</span><span class="op">+</span>k){</span>
<span id="cb711-3"><a href="#cb711-3"></a>    <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Nombre d&#39;observations suffisant pour tester individuellement chaque VI&quot;</span>)</span>
<span id="cb711-4"><a href="#cb711-4"></a>}<span class="cf">else</span>{</span>
<span id="cb711-5"><a href="#cb711-5"></a>  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Attention! Nombre d&#39;observations insuffisant&quot;</span>,</span>
<span id="cb711-6"><a href="#cb711-6"></a>  <span class="st">&quot;</span><span class="ch">\n</span><span class="st">pour tester individuellement chaque VI&quot;</span>)</span>
<span id="cb711-7"><a href="#cb711-7"></a>}</span></code></pre></div>
<pre><code>## 
## Nombre d&#39;observations suffisant pour tester individuellement chaque VI</code></pre>
</div>
<div id="sect07732" class="section level4">
<h4><span class="header-section-number">7.7.3.2</span> Vérification la normalité des résidus</h4>
<p>La syntaxe suivante permet de vérifier la normalité des résidus selon les trois démarches classiques : 1) coefficients d’asymétrie et d’aplatissement, 2) test de normalité de Jarque-Bera (fonction <code>JarqueBeraTest</code> du <em>package</em> <code>DescTools</code>) et 3) les graphiques (histogramme avec courbe normale et diagramme quantile-quantile).</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="#cb713-1"></a><span class="kw">library</span>(DescTools)</span>
<span id="cb713-2"><a href="#cb713-2"></a><span class="kw">library</span>(stats)</span>
<span id="cb713-3"><a href="#cb713-3"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb713-4"><a href="#cb713-4"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb713-5"><a href="#cb713-5"></a></span>
<span id="cb713-6"><a href="#cb713-6"></a><span class="co"># Vecteur pour les résidus du modèle</span></span>
<span id="cb713-7"><a href="#cb713-7"></a>residus &lt;-<span class="st"> </span>modele3<span class="op">$</span>residuals</span>
<span id="cb713-8"><a href="#cb713-8"></a></span>
<span id="cb713-9"><a href="#cb713-9"></a><span class="co"># 1. coefficients d’asymétrie et d’aplatissement </span></span>
<span id="cb713-10"><a href="#cb713-10"></a><span class="kw">c</span>(<span class="dt">Skewness=</span> <span class="kw">round</span>(DescTools<span class="op">::</span><span class="kw">Skew</span>(residus),<span class="dv">3</span>), </span>
<span id="cb713-11"><a href="#cb713-11"></a>  <span class="dt">Kurtosis =</span> <span class="kw">round</span>(DescTools<span class="op">::</span><span class="kw">Kurt</span>(residus),<span class="dv">3</span>))</span></code></pre></div>
<pre><code>## Skewness Kurtosis 
##   -0.263    1.149</code></pre>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="#cb715-1"></a><span class="co"># 2. Test de normalité de Jarque-Bera</span></span>
<span id="cb715-2"><a href="#cb715-2"></a><span class="kw">JarqueBeraTest</span>(residus)</span></code></pre></div>
<pre><code>## 
##  Robust Jarque Bera Test
## 
## data:  residus
## X-squared = 528.51, df = 2, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="#cb717-1"></a><span class="co"># 3. Graphiques </span></span>
<span id="cb717-2"><a href="#cb717-2"></a>Ghisto &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb717-3"><a href="#cb717-3"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> residus, <span class="dt">y =</span> ..density..),</span>
<span id="cb717-4"><a href="#cb717-4"></a>                 <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>) <span class="op">+</span></span>
<span id="cb717-5"><a href="#cb717-5"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, </span>
<span id="cb717-6"><a href="#cb717-6"></a>                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(residus),</span>
<span id="cb717-7"><a href="#cb717-7"></a>                            <span class="dt">sd =</span> <span class="kw">sd</span>(residus)), </span>
<span id="cb717-8"><a href="#cb717-8"></a>                <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb717-9"><a href="#cb717-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Histogramme et courbe normale&quot;</span>,</span>
<span id="cb717-10"><a href="#cb717-10"></a>      <span class="dt">y =</span> <span class="st">&quot;densité&quot;</span>, <span class="st">&quot;Résidus du modèle&quot;</span>)</span>
<span id="cb717-11"><a href="#cb717-11"></a></span>
<span id="cb717-12"><a href="#cb717-12"></a>Gqqplot &lt;-<span class="st"> </span><span class="kw">qplot</span>(<span class="dt">sample =</span> residus)<span class="op">+</span></span>
<span id="cb717-13"><a href="#cb717-13"></a><span class="st">  </span><span class="kw">geom_qq_line</span>(<span class="dt">line.p =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>),</span>
<span id="cb717-14"><a href="#cb717-14"></a>               <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size=</span><span class="fl">1.2</span>)<span class="op">+</span></span>
<span id="cb717-15"><a href="#cb717-15"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Diagramme quantile-quantile&quot;</span>,</span>
<span id="cb717-16"><a href="#cb717-16"></a>     <span class="dt">x=</span><span class="st">&quot;Valeurs théoriques&quot;</span>,</span>
<span id="cb717-17"><a href="#cb717-17"></a>     <span class="dt">y =</span> <span class="st">&quot;Résidus&quot;</span>)</span>
<span id="cb717-18"><a href="#cb717-18"></a></span>
<span id="cb717-19"><a href="#cb717-19"></a><span class="kw">ggarrange</span>(Ghisto, Gqqplot, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">nrow=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/VerifierNormaliteResidusDia-1.png" alt="Diagnostic : la normalité des résidus" width="75%" />
<p class="caption">
(#fig:VerifierNormaliteResidusDia)Diagnostic : la normalité des résidus
</p>
</div>
</div>
<div id="sect07733" class="section level4">
<h4><span class="header-section-number">7.7.3.3</span> Évaluation de la linéarité et l’homoscédasticité des résidus</h4>
<p>La syntaxe suivante permet de vérifier si l’hypothèse d’homoscédasticité des résidus est respectée avec : 1) un nuage de points entre les valeurs prédites et des résidus, 3) les graphiques (histogramme avec courbe normale et diagramme quantile-quantile) et 2) le test de Breusch-Pagan (fonction <code>bptest</code> du <em>package</em> <code>lmtest</code>).</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="#cb718-1"></a><span class="co"># 1. Test de Breusch-Pagan pour vérifier l&#39;homoscédasticité</span></span>
<span id="cb718-2"><a href="#cb718-2"></a><span class="kw">library</span>(lmtest)</span>
<span id="cb718-3"><a href="#cb718-3"></a><span class="kw">bptest</span>(modele3)</span></code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  modele3
## BP = 1651.5, df = 7, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="#cb720-1"></a><span class="cf">if</span>(<span class="kw">bptest</span>(modele3)<span class="op">$</span>p.value <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>){</span>
<span id="cb720-2"><a href="#cb720-2"></a>  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Attention : problème d&#39;hétéroscédasticité des résidus&quot;</span>)</span>
<span id="cb720-3"><a href="#cb720-3"></a>}<span class="cf">else</span>{</span>
<span id="cb720-4"><a href="#cb720-4"></a>   <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Parfait : homoscédasticité des résidus&quot;</span>)</span>
<span id="cb720-5"><a href="#cb720-5"></a>}</span></code></pre></div>
<pre><code>## 
## Attention : problème d&#39;hétéroscédasticité des résidus</code></pre>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="#cb722-1"></a><span class="co"># 2. Graphique entre les valeurs prédites et les résidus</span></span>
<span id="cb722-2"><a href="#cb722-2"></a>residus &lt;-<span class="st">  </span>modele3<span class="op">$</span>residuals</span>
<span id="cb722-3"><a href="#cb722-3"></a>ypredits &lt;-<span class="st"> </span>modele3<span class="op">$</span>fitted.values</span>
<span id="cb722-4"><a href="#cb722-4"></a></span>
<span id="cb722-5"><a href="#cb722-5"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb722-6"><a href="#cb722-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ypredits, <span class="dt">y =</span> residus),</span>
<span id="cb722-7"><a href="#cb722-7"></a>                 <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>,</span>
<span id="cb722-8"><a href="#cb722-8"></a>                 <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb722-9"><a href="#cb722-9"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ypredits, <span class="dt">y =</span> residus), </span>
<span id="cb722-10"><a href="#cb722-10"></a>              <span class="dt">method =</span> lm, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb722-11"><a href="#cb722-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Valeurs prédites&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Résidus&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/DiaHomoscedasticite-1.png" alt="Distribution des résidus en fonction des valeurs prédites" width="75%" />
<p class="caption">
(#fig:DiaHomoscedasticite)Distribution des résidus en fonction des valeurs prédites
</p>
</div>
</div>
<div id="sect07734" class="section level4">
<h4><span class="header-section-number">7.7.3.4</span> Vérification la multicolinéarité excessive</h4>
<p>Pour vérifier la présence ou l’absence de multicolinéarité excessive, nous utilisons habituellement la fonction <code>vif</code> du <em>package</em> <code>car</code>.</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb723-1"><a href="#cb723-1"></a><span class="kw">library</span>(car)</span>
<span id="cb723-2"><a href="#cb723-2"></a></span>
<span id="cb723-3"><a href="#cb723-3"></a><span class="co"># facteur d&#39;inflation de la variance</span></span>
<span id="cb723-4"><a href="#cb723-4"></a><span class="kw">round</span>(car<span class="op">::</span><span class="kw">vif</span>(modele3),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##                     GVIF Df GVIF^(1/(2*Df))
## log(HABHA)         1.289  1           1.136
## poly(AgeMedian, 2) 1.387  2           1.085
## Pct_014            1.518  1           1.232
## Pct_65P            1.304  1           1.142
## Pct_MV             1.480  1           1.217
## Pct_FR             1.730  1           1.315</code></pre>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb725-1"><a href="#cb725-1"></a><span class="co"># problème de multicolinéarité (VIF &gt; 10)?</span></span>
<span id="cb725-2"><a href="#cb725-2"></a>car<span class="op">::</span><span class="kw">vif</span>(modele3) <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span></span></code></pre></div>
<pre><code>##                     GVIF    Df GVIF^(1/(2*Df))
## log(HABHA)         FALSE FALSE           FALSE
## poly(AgeMedian, 2) FALSE FALSE           FALSE
## Pct_014            FALSE FALSE           FALSE
## Pct_65P            FALSE FALSE           FALSE
## Pct_MV             FALSE FALSE           FALSE
## Pct_FR             FALSE FALSE           FALSE</code></pre>
<div class="sourceCode" id="cb727"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb727-1"><a href="#cb727-1"></a><span class="co"># problème de multicolinéarité (VIF &gt; 5)?</span></span>
<span id="cb727-2"><a href="#cb727-2"></a>car<span class="op">::</span><span class="kw">vif</span>(modele3) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span> </span></code></pre></div>
<pre><code>##                     GVIF    Df GVIF^(1/(2*Df))
## log(HABHA)         FALSE FALSE           FALSE
## poly(AgeMedian, 2) FALSE FALSE           FALSE
## Pct_014            FALSE FALSE           FALSE
## Pct_65P            FALSE FALSE           FALSE
## Pct_MV             FALSE FALSE           FALSE
## Pct_FR             FALSE FALSE           FALSE</code></pre>
</div>
<div id="sect07735" class="section level4">
<h4><span class="header-section-number">7.7.3.5</span> Répérage des valeurs très influentes du modèle</h4>
<p>La syntaxe suivante permet d’évaluer le nombre de valeurs très influentes dans le modèle avec les critères de <span class="math inline">\(\mbox{4/n}\)</span>, <span class="math inline">\(\mbox{8/n}\)</span> et <span class="math inline">\(\mbox{16/n}\)</span> pour la distance de Cook.</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="#cb729-1"></a>nobs &lt;-<span class="st"> </span><span class="kw">length</span>(modele3<span class="op">$</span>fitted.values)</span>
<span id="cb729-2"><a href="#cb729-2"></a>DistanceCook &lt;-<span class="st"> </span><span class="kw">cooks.distance</span>(modele3)</span>
<span id="cb729-3"><a href="#cb729-3"></a>n4 &lt;-<span class="st"> </span><span class="kw">length</span>(DistanceCook[DistanceCook <span class="op">&gt;</span><span class="st"> </span><span class="dv">4</span><span class="op">/</span>nobs])</span>
<span id="cb729-4"><a href="#cb729-4"></a>n8 &lt;-<span class="st"> </span><span class="kw">length</span>(DistanceCook[DistanceCook <span class="op">&gt;</span><span class="st"> </span><span class="dv">8</span><span class="op">/</span>nobs])</span>
<span id="cb729-5"><a href="#cb729-5"></a>n16 &lt;-<span class="st">  </span><span class="kw">length</span>(DistanceCook[DistanceCook <span class="op">&gt;</span><span class="st"> </span><span class="dv">16</span><span class="op">/</span>nobs])</span>
<span id="cb729-6"><a href="#cb729-6"></a><span class="kw">cat</span>(<span class="st">&quot;Nombre d&#39;observations =&quot;</span>, nobs, <span class="st">&quot;(100 %)&quot;</span>,</span>
<span id="cb729-7"><a href="#cb729-7"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> 4/n =&quot;</span>, <span class="kw">round</span>(<span class="dv">4</span><span class="op">/</span>nobs,<span class="dv">5</span>),</span>
<span id="cb729-8"><a href="#cb729-8"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> 8/n =&quot;</span>, <span class="kw">round</span>(<span class="dv">8</span><span class="op">/</span>nobs,<span class="dv">5</span>),</span>
<span id="cb729-9"><a href="#cb729-9"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> 16/n =&quot;</span>, <span class="kw">round</span>(<span class="dv">16</span><span class="op">/</span>nobs,<span class="dv">5</span>),</span>
<span id="cb729-10"><a href="#cb729-10"></a><span class="st">&quot;</span><span class="ch">\n</span><span class="st">Observations avec une valeur supérieure ou égale aux différents seuils&quot;</span>,</span>
<span id="cb729-11"><a href="#cb729-11"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> 4/n =&quot;</span>, n4, <span class="st">&quot;soit&quot;</span>, <span class="kw">round</span>(n4<span class="op">/</span>nobs<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">&quot; %&quot;</span>,</span>
<span id="cb729-12"><a href="#cb729-12"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> 8/n =&quot;</span>, n8, <span class="st">&quot;soit&quot;</span>, <span class="kw">round</span>(n8<span class="op">/</span>nobs<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">&quot; %&quot;</span>,</span>
<span id="cb729-13"><a href="#cb729-13"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> 16/n =&quot;</span>, n16, <span class="st">&quot;soit&quot;</span>, <span class="kw">round</span>(n16<span class="op">/</span>nobs<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot; %&quot;</span></span>
<span id="cb729-14"><a href="#cb729-14"></a>    )</span></code></pre></div>
<pre><code>## Nombre d&#39;observations = 10210 (100 %) 
##  4/n = 0.00039 
##  8/n = 0.00078 
##  16/n = 0.00157 
## Observations avec une valeur supérieure ou égale aux différents seuils 
##  4/n = 604 soit 5.92  % 
##  8/n = 285 soit 2.79  % 
##  16/n = 132 soit 1.29  %</code></pre>
<p>Vous pouvez également construire un nuage de points avec la distance de Cook et l’effet de levier (<em>leverage value</em>) pour repérer visuellement les observations très influentes.</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb731-1"><a href="#cb731-1"></a><span class="kw">library</span>(car)</span>
<span id="cb731-2"><a href="#cb731-2"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb731-3"><a href="#cb731-3"></a>DistanceCook &lt;-<span class="st"> </span><span class="kw">cooks.distance</span>(modele3)</span>
<span id="cb731-4"><a href="#cb731-4"></a>LeverageValue &lt;-<span class="st"> </span><span class="kw">hatvalues</span>(modele3)</span>
<span id="cb731-5"><a href="#cb731-5"></a></span>
<span id="cb731-6"><a href="#cb731-6"></a>G1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb731-7"><a href="#cb731-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> LeverageValue, <span class="dt">y =</span> DistanceCook), </span>
<span id="cb731-8"><a href="#cb731-8"></a>             <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb731-9"><a href="#cb731-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Effet levier&quot;</span>,</span>
<span id="cb731-10"><a href="#cb731-10"></a>       <span class="dt">y =</span> <span class="st">&#39;Distance de Cook&#39;</span>,</span>
<span id="cb731-11"><a href="#cb731-11"></a>       <span class="dt">title =</span> <span class="st">&#39;Repérer les valeurs influentes&#39;</span>,</span>
<span id="cb731-12"><a href="#cb731-12"></a>       <span class="dt">subtitle =</span> <span class="st">&#39;(toutes les observations)&#39;</span>)</span>
<span id="cb731-13"><a href="#cb731-13"></a></span>
<span id="cb731-14"><a href="#cb731-14"></a>G2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb731-15"><a href="#cb731-15"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> LeverageValue, <span class="dt">y =</span> DistanceCook), </span>
<span id="cb731-16"><a href="#cb731-16"></a>             <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb731-17"><a href="#cb731-17"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>,<span class="fl">0.01</span>)<span class="op">+</span></span>
<span id="cb731-18"><a href="#cb731-18"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="dv">0</span>,<span class="fl">0.01</span>)<span class="op">+</span></span>
<span id="cb731-19"><a href="#cb731-19"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Effet levier&quot;</span>,</span>
<span id="cb731-20"><a href="#cb731-20"></a>       <span class="dt">y =</span> <span class="st">&#39;Distance de Cook&#39;</span>,</span>
<span id="cb731-21"><a href="#cb731-21"></a>       <span class="dt">title =</span> <span class="st">&#39;Repérer les valeurs influentes&#39;</span>,</span>
<span id="cb731-22"><a href="#cb731-22"></a>       <span class="dt">subtitle =</span> <span class="st">&#39;(agrandissement)&#39;</span>)</span>
<span id="cb731-23"><a href="#cb731-23"></a></span>
<span id="cb731-24"><a href="#cb731-24"></a><span class="kw">ggarrange</span>(G1,G2, <span class="dt">nrow=</span><span class="dv">1</span>, <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/DiaGraphCookLev-1.png" alt="Repérage graphique des valeurs influentes du modèle" width="75%" />
<p class="caption">
(#fig:DiaGraphCookLev)Repérage graphique des valeurs influentes du modèle
</p>
</div>
</div>
<div id="sect07736" class="section level4">
<h4><span class="header-section-number">7.7.3.6</span> Construction d’un nouveau modèle en supprimant les observations très influentes du modèle</h4>
<p>Dans un premier temps, il convient de construire un nouveau modèle sans les valeurs influentes du modèle de départ.</p>
<div class="sourceCode" id="cb732"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb732-1"><a href="#cb732-1"></a><span class="co"># Nombre d&#39;observation dans le modèle 3</span></span>
<span id="cb732-2"><a href="#cb732-2"></a>nobs &lt;-<span class="kw">length</span>(modele3<span class="op">$</span>fitted.values)</span>
<span id="cb732-3"><a href="#cb732-3"></a></span>
<span id="cb732-4"><a href="#cb732-4"></a><span class="co"># Distance de Cook</span></span>
<span id="cb732-5"><a href="#cb732-5"></a>cook &lt;-<span class="st"> </span><span class="kw">cooks.distance</span>(modele3)</span>
<span id="cb732-6"><a href="#cb732-6"></a></span>
<span id="cb732-7"><a href="#cb732-7"></a><span class="co"># Les observations très influentes avec le critère de 16/n</span></span>
<span id="cb732-8"><a href="#cb732-8"></a>DataSansOutliers &lt;-<span class="st"> </span><span class="kw">cbind</span>(DataFinal, cook)</span>
<span id="cb732-9"><a href="#cb732-9"></a>DataSansOutliers &lt;-<span class="st"> </span>DataSansOutliers[DataSansOutliers<span class="op">$</span>cook  <span class="op">&lt;</span><span class="st"> </span><span class="dv">8</span><span class="op">/</span>nobs, ]</span>
<span id="cb732-10"><a href="#cb732-10"></a>modele3b &lt;-<span class="st"> </span><span class="kw">lm</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR,</span>
<span id="cb732-11"><a href="#cb732-11"></a>              <span class="dt">data =</span> DataSansOutliers)</span>
<span id="cb732-12"><a href="#cb732-12"></a>nobsb &lt;-<span class="kw">length</span>(modele3b<span class="op">$</span>fitted.values)</span></code></pre></div>
<p>Comparez les valeurs du R<sup>2</sup> ajusté des deux modèles. Habituellement, la suppression des valeurs très influentes s’accompagne d’une augmentation du R<sup>2</sup> ajusté. C’est notamment le cas ici puisque sa valeur grimpe de 0,4653 à 0,5684, signalant ainsi un gain important pour la variance expliquée.</p>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="#cb733-1"></a><span class="co"># Comparaison des mesures d&#39;ajustement</span></span>
<span id="cb733-2"><a href="#cb733-2"></a><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Comparaison des R2 ajustés :&quot;</span>,</span>
<span id="cb733-3"><a href="#cb733-3"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Modèle de départ (n=&quot;</span>, nobs, <span class="st">&quot;), &quot;</span>,</span>
<span id="cb733-4"><a href="#cb733-4"></a>    <span class="kw">round</span>(<span class="kw">summary</span>(modele3)<span class="op">$</span>adj.r.squared,<span class="dv">4</span>), </span>
<span id="cb733-5"><a href="#cb733-5"></a>    </span>
<span id="cb733-6"><a href="#cb733-6"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Modèle sans les observations très influentes (n=&quot;</span>, nobsb, <span class="st">&quot;), &quot;</span>,</span>
<span id="cb733-7"><a href="#cb733-7"></a>    <span class="kw">round</span>(<span class="kw">summary</span>(modele3b)<span class="op">$</span>adj.r.squared,<span class="dv">4</span>),</span>
<span id="cb733-8"><a href="#cb733-8"></a>    <span class="dt">sep=</span><span class="st">&quot;&quot;</span></span>
<span id="cb733-9"><a href="#cb733-9"></a>)</span></code></pre></div>
<pre><code>## 
## Comparaison des R2 ajustés :
## Modèle de départ (n=10210), 0.4653
## Modèle sans les observations très influentes (n=9925), 0.5684</code></pre>
<p>Pour le modèle, il convient alors de refaire le diagnostic de la régression et de vérifier si la suppression des observations très influentes a amélioré : 1) la normalité, la linéarité et l’homoscédasticité des résidus, 2) la multicolinéarité excessive et 3) l’absence de valeurs trop influentes.</p>
<p><strong>La normalité des résidus s’est-elle ou non améliorée?</strong></p>
<p>Pour ce faire, comparez les valeurs d’asymétrie,d’aplatissement et du test de Jarque-Bera et les graphiques de normalité. À la lecture des valeurs :</p>
<ul>
<li>l’asymétrie est très similaire (-0,260 à -0,265);</li>
<li>l’aplatissement s’est amélioré (1,183 à 0,164);</li>
<li>le test de Jarque-Bera signale toujours un problème de normalité (<em>p</em> &lt; 0,001), mais sa valeur a nettement diminué (548,7 à 131,24);</li>
<li>les graphiques démontrent une nette amélioration de la normalité des résidus.</li>
</ul>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="#cb735-1"></a><span class="co"># 1. coefficients d’asymétrie et d’aplatissement </span></span>
<span id="cb735-2"><a href="#cb735-2"></a>resmodele3  &lt;-<span class="st"> </span><span class="kw">rstudent</span>(modele3)</span>
<span id="cb735-3"><a href="#cb735-3"></a>resmodele3b &lt;-<span class="st"> </span><span class="kw">rstudent</span>(modele3b)</span>
<span id="cb735-4"><a href="#cb735-4"></a>  </span>
<span id="cb735-5"><a href="#cb735-5"></a><span class="kw">c</span>(<span class="dt">Skewness=</span> <span class="kw">round</span>(<span class="kw">Skew</span>(resmodele3),<span class="dv">3</span>), </span>
<span id="cb735-6"><a href="#cb735-6"></a>  <span class="dt">Kurtosis =</span> <span class="kw">round</span>(<span class="kw">Kurt</span>(resmodele3),<span class="dv">3</span>))</span></code></pre></div>
<pre><code>## Skewness1 Skewness2 Skewness3 Skewness4 Kurtosis1 Kurtosis2 Kurtosis3 Kurtosis4 
##    -0.260     0.024   -10.739     0.000     1.185     0.048    24.448     0.000</code></pre>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb737-1"><a href="#cb737-1"></a><span class="kw">c</span>(<span class="dt">Skewness=</span> <span class="kw">round</span>(<span class="kw">Skew</span>(resmodele3b),<span class="dv">3</span>), </span>
<span id="cb737-2"><a href="#cb737-2"></a>  <span class="dt">Kurtosis =</span> <span class="kw">round</span>(<span class="kw">Kurt</span>(resmodele3b),<span class="dv">3</span>))</span></code></pre></div>
<pre><code>## Skewness1 Skewness2 Skewness3 Skewness4 Kurtosis1 Kurtosis2 Kurtosis3 Kurtosis4 
##    -0.265     0.025   -10.790     0.000     0.165     0.049     3.360     0.000</code></pre>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb739-1"><a href="#cb739-1"></a><span class="co"># 2. Test de normalité de Jarque-Bera</span></span>
<span id="cb739-2"><a href="#cb739-2"></a><span class="kw">JarqueBeraTest</span>(resmodele3)</span></code></pre></div>
<pre><code>## 
##  Robust Jarque Bera Test
## 
## data:  resmodele3
## X-squared = 548.7, df = 2, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="#cb741-1"></a><span class="kw">JarqueBeraTest</span>(resmodele3b)</span></code></pre></div>
<pre><code>## 
##  Robust Jarque Bera Test
## 
## data:  resmodele3b
## X-squared = 131.24, df = 2, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="#cb743-1"></a><span class="co"># 3. Graphiques </span></span>
<span id="cb743-2"><a href="#cb743-2"></a>Ghisto1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb743-3"><a href="#cb743-3"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> resmodele3, <span class="dt">y =</span> ..density..),</span>
<span id="cb743-4"><a href="#cb743-4"></a>                 <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>) <span class="op">+</span></span>
<span id="cb743-5"><a href="#cb743-5"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm,  <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(resmodele3),</span>
<span id="cb743-6"><a href="#cb743-6"></a>                                          <span class="dt">sd =</span> <span class="kw">sd</span>(resmodele3)), </span>
<span id="cb743-7"><a href="#cb743-7"></a>                <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb743-8"><a href="#cb743-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Modèle de départ&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;densité&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Résidus studentisés&quot;</span>)</span>
<span id="cb743-9"><a href="#cb743-9"></a></span>
<span id="cb743-10"><a href="#cb743-10"></a>Gqqplot1 &lt;-<span class="st"> </span><span class="kw">qplot</span>(<span class="dt">sample =</span> residus)<span class="op">+</span></span>
<span id="cb743-11"><a href="#cb743-11"></a><span class="st">  </span><span class="kw">geom_qq_line</span>(<span class="dt">line.p =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size=</span><span class="fl">1.2</span>)<span class="op">+</span></span>
<span id="cb743-12"><a href="#cb743-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Modèle de départ&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Valeurs théoriques&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Résidus studentisés&quot;</span>)</span>
<span id="cb743-13"><a href="#cb743-13"></a></span>
<span id="cb743-14"><a href="#cb743-14"></a>Ghisto2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb743-15"><a href="#cb743-15"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> resmodele3b, <span class="dt">y =</span> ..density..),</span>
<span id="cb743-16"><a href="#cb743-16"></a>                 <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>) <span class="op">+</span></span>
<span id="cb743-17"><a href="#cb743-17"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm,  <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(resmodele3b),</span>
<span id="cb743-18"><a href="#cb743-18"></a>                                          <span class="dt">sd =</span> <span class="kw">sd</span>(resmodele3b)), </span>
<span id="cb743-19"><a href="#cb743-19"></a>                <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb743-20"><a href="#cb743-20"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Modèle après suppression&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Valeurs théoriques&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Résidus studentisés&quot;</span>)</span>
<span id="cb743-21"><a href="#cb743-21"></a></span>
<span id="cb743-22"><a href="#cb743-22"></a>Gqqplot2 &lt;-<span class="st"> </span><span class="kw">qplot</span>(<span class="dt">sample =</span> resmodele3b)<span class="op">+</span></span>
<span id="cb743-23"><a href="#cb743-23"></a><span class="st">  </span><span class="kw">geom_qq_line</span>(<span class="dt">line.p =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="dt">color =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">size=</span><span class="fl">1.2</span>)<span class="op">+</span></span>
<span id="cb743-24"><a href="#cb743-24"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Modèle après suppression&quot;</span>,<span class="dt">x=</span><span class="st">&quot;Valeurs théoriques&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Résidus studentisés&quot;</span>)</span>
<span id="cb743-25"><a href="#cb743-25"></a></span>
<span id="cb743-26"><a href="#cb743-26"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb743-27"><a href="#cb743-27"></a><span class="kw">ggarrange</span>(Ghisto1, Ghisto2, Gqqplot1, Gqqplot2, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/ResidusCompa-1.png" alt="Normalité des résidus avant et après la suppression des valeurs influentes" width="65%" />
<p class="caption">
(#fig:ResidusCompa)Normalité des résidus avant et après la suppression des valeurs influentes
</p>
</div>
<p><strong>Le problème d’hétéroscédasticité est-il corrigé?</strong></p>
<ul>
<li>la valeur du test de Breusch-Pagan est beaucoup plus faible, mais il semble persister un problème d’hétéroscédasticité.</li>
</ul>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb744-1"><a href="#cb744-1"></a><span class="co"># homoscédasticité des résidus améliorée ou non?</span></span>
<span id="cb744-2"><a href="#cb744-2"></a><span class="kw">library</span>(lmtest)</span>
<span id="cb744-3"><a href="#cb744-3"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb744-4"><a href="#cb744-4"></a></span>
<span id="cb744-5"><a href="#cb744-5"></a><span class="kw">bptest</span>(modele3)</span></code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  modele3
## BP = 1651.5, df = 7, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="#cb746-1"></a><span class="kw">bptest</span>(modele3b)</span></code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  modele3b
## BP = 640.53, df = 7, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="#cb748-1"></a>resmodele3  &lt;-<span class="st"> </span><span class="kw">residuals</span>(modele3)</span>
<span id="cb748-2"><a href="#cb748-2"></a>resmodele3b &lt;-<span class="st"> </span><span class="kw">residuals</span>(modele3b)</span>
<span id="cb748-3"><a href="#cb748-3"></a>ypredits3 &lt;-<span class="st"> </span>modele3<span class="op">$</span>fitted.values</span>
<span id="cb748-4"><a href="#cb748-4"></a>ypredits3b &lt;-<span class="st"> </span>modele3b<span class="op">$</span>fitted.values</span>
<span id="cb748-5"><a href="#cb748-5"></a></span>
<span id="cb748-6"><a href="#cb748-6"></a>G1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb748-7"><a href="#cb748-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ypredits3, <span class="dt">y =</span> resmodele3),</span>
<span id="cb748-8"><a href="#cb748-8"></a>                 <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb748-9"><a href="#cb748-9"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ypredits3, <span class="dt">y =</span> resmodele3),  <span class="dt">method =</span> lm, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb748-10"><a href="#cb748-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Modèle de départ&quot;</span>,<span class="dt">x=</span><span class="st">&quot;Valeurs prédites&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Résidus studentisés&quot;</span>)</span>
<span id="cb748-11"><a href="#cb748-11"></a></span>
<span id="cb748-12"><a href="#cb748-12"></a>G2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb748-13"><a href="#cb748-13"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ypredits3b, <span class="dt">y =</span> resmodele3b),</span>
<span id="cb748-14"><a href="#cb748-14"></a>                 <span class="dt">color =</span> <span class="st">&quot;#343a40&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.8</span>) <span class="op">+</span></span>
<span id="cb748-15"><a href="#cb748-15"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ypredits3b, <span class="dt">y =</span> resmodele3b),  <span class="dt">method =</span> lm, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb748-16"><a href="#cb748-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Modèle après suppression&quot;</span>,<span class="dt">x=</span><span class="st">&quot;Valeurs prédites&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Résidus studentisés&quot;</span>)</span>
<span id="cb748-17"><a href="#cb748-17"></a></span>
<span id="cb748-18"><a href="#cb748-18"></a><span class="kw">ggarrange</span>(G1, G2, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">nrow=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/HomosComp-1.png" alt="Amélioration de l'homoscédasticité des résidus" width="65%" />
<p class="caption">
(#fig:HomosComp)Amélioration de l’homoscédasticité des résidus
</p>
</div>
<p>Finalement, il convient de comparer les coefficients de régression.</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="#cb749-1"></a><span class="co"># Comparaison des coefficients</span></span>
<span id="cb749-2"><a href="#cb749-2"></a><span class="kw">summary</span>(modele3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + 
##     Pct_65P + Pct_MV + Pct_FR, data = DataFinal)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -66.848  -8.660   0.381   8.961  83.269 
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)          5.283e+01  1.001e+00  52.781  &lt; 2e-16 ***
## log(HABHA)          -6.855e+00  1.683e-01 -40.730  &lt; 2e-16 ***
## poly(AgeMedian, 2)1  1.198e+01  1.559e+01   0.769 0.441958    
## poly(AgeMedian, 2)2 -2.861e+02  1.394e+01 -20.525  &lt; 2e-16 ***
## Pct_014              9.406e-01  3.126e-02  30.093  &lt; 2e-16 ***
## Pct_65P              3.062e-01  1.851e-02  16.546  &lt; 2e-16 ***
## Pct_MV              -3.630e-02  9.943e-03  -3.651 0.000262 ***
## Pct_FR              -3.443e-01  1.103e-02 -31.212  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 13.57 on 10202 degrees of freedom
## Multiple R-squared:  0.4657, Adjusted R-squared:  0.4653 
## F-statistic:  1270 on 7 and 10202 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="#cb751-1"></a><span class="kw">summary</span>(modele3b)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = VegPct ~ log(HABHA) + poly(AgeMedian, 2) + Pct_014 + 
##     Pct_65P + Pct_MV + Pct_FR, data = DataSansOutliers)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -46.417  -7.734   0.456   8.290  40.085 
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)          6.748e+01  9.869e-01  68.370  &lt; 2e-16 ***
## log(HABHA)          -1.000e+01  1.720e-01 -58.167  &lt; 2e-16 ***
## poly(AgeMedian, 2)1  4.357e+01  1.387e+01   3.142  0.00168 ** 
## poly(AgeMedian, 2)2 -3.564e+02  1.250e+01 -28.510  &lt; 2e-16 ***
## Pct_014              8.351e-01  2.870e-02  29.101  &lt; 2e-16 ***
## Pct_65P              2.271e-01  1.807e-02  12.566  &lt; 2e-16 ***
## Pct_MV              -8.517e-03  9.109e-03  -0.935  0.34976    
## Pct_FR              -2.924e-01  1.028e-02 -28.440  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.96 on 9917 degrees of freedom
## Multiple R-squared:  0.5687, Adjusted R-squared:  0.5684 
## F-statistic:  1868 on 7 and 9917 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div id="sect0774" class="section level3">
<h3><span class="header-section-number">7.7.4</span> Graphiques pour les effets marginaux</h3>
<p>Tel que signalé ultérieurement, il est courant de représenter l’effet marginal d’une VI sur une VD, une fois contrôlées les autres VI. Pour ce faire, il est possible d’utiliser les <em>packages</em> <code>ggplot2</code> et <code>ggeffects</code>.</p>
<div id="sect07741" class="section level4">
<h4><span class="header-section-number">7.7.4.1</span> Effet marginal pour une variable continue</h4>
<p>La syntaxe ci-dessous illustre comment obtenir un graphique pour nos quatre variables explicatives. Bien entendu, si le coefficient de régression est positif (comme pour les pourcentages de jeunes de moins de 15 ans et les personnes âgées), la pente est alors montante, et inversement descendante pour des coefficients négatifs (comme pour les personnes ayant déclaré appartenir à une minorité visible et les personnes à faible revenu). En outre, plus la valeur absolue du coefficient est forte, plus la pente est prononcée.</p>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb753-1"><a href="#cb753-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb753-2"><a href="#cb753-2"></a><span class="kw">library</span>(ggeffects)</span>
<span id="cb753-3"><a href="#cb753-3"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb753-4"><a href="#cb753-4"></a></span>
<span id="cb753-5"><a href="#cb753-5"></a><span class="co"># Création d&#39;un DataFrame pour les valeurs prédites pour chaque VI continue</span></span>
<span id="cb753-6"><a href="#cb753-6"></a>fitV1 &lt;-<span class="st"> </span><span class="kw">ggpredict</span>(modele3, <span class="dt">terms =</span> <span class="st">&quot;Pct_014&quot;</span>)</span>
<span id="cb753-7"><a href="#cb753-7"></a>fitV2 &lt;-<span class="st"> </span><span class="kw">ggpredict</span>(modele3, <span class="dt">terms =</span> <span class="st">&quot;Pct_65P&quot;</span>)</span>
<span id="cb753-8"><a href="#cb753-8"></a>fitV3 &lt;-<span class="st"> </span><span class="kw">ggpredict</span>(modele3, <span class="dt">terms =</span> <span class="st">&quot;Pct_MV&quot;</span>)</span>
<span id="cb753-9"><a href="#cb753-9"></a>fitV4 &lt;-<span class="st"> </span><span class="kw">ggpredict</span>(modele3, <span class="dt">terms =</span> <span class="st">&quot;Pct_FR&quot;</span>)</span>
<span id="cb753-10"><a href="#cb753-10"></a></span>
<span id="cb753-11"><a href="#cb753-11"></a><span class="co"># Construction des graphiques</span></span>
<span id="cb753-12"><a href="#cb753-12"></a>G1 &lt;-<span class="kw">ggplot</span>(fitV1, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span></span>
<span id="cb753-13"><a href="#cb753-13"></a><span class="st">    </span><span class="co"># ligne de régression</span></span>
<span id="cb753-14"><a href="#cb753-14"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb753-15"><a href="#cb753-15"></a><span class="st">    </span><span class="co"># intervalle de confiance à 95 %</span></span>
<span id="cb753-16"><a href="#cb753-16"></a><span class="st">    </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">.3</span>)<span class="op">+</span></span>
<span id="cb753-17"><a href="#cb753-17"></a><span class="st">    </span><span class="co">#  Titres</span></span>
<span id="cb753-18"><a href="#cb753-18"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;valeur prédite Y&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Moins de 15 ans (%)&quot;</span>)</span>
<span id="cb753-19"><a href="#cb753-19"></a></span>
<span id="cb753-20"><a href="#cb753-20"></a>G2 &lt;-<span class="kw">ggplot</span>(fitV2, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span></span>
<span id="cb753-21"><a href="#cb753-21"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb753-22"><a href="#cb753-22"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">.3</span>)<span class="op">+</span></span>
<span id="cb753-23"><a href="#cb753-23"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;valeur prédite Y&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;65 ans et plus (%)&quot;</span>)</span>
<span id="cb753-24"><a href="#cb753-24"></a></span>
<span id="cb753-25"><a href="#cb753-25"></a>G3 &lt;-<span class="kw">ggplot</span>(fitV3, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span></span>
<span id="cb753-26"><a href="#cb753-26"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb753-27"><a href="#cb753-27"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">.3</span>)<span class="op">+</span></span>
<span id="cb753-28"><a href="#cb753-28"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;valeur prédite Y&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Minorités visibles (%)&quot;</span>)</span>
<span id="cb753-29"><a href="#cb753-29"></a></span>
<span id="cb753-30"><a href="#cb753-30"></a>G4 &lt;-<span class="kw">ggplot</span>(fitV4, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span></span>
<span id="cb753-31"><a href="#cb753-31"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb753-32"><a href="#cb753-32"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">.3</span>)<span class="op">+</span></span>
<span id="cb753-33"><a href="#cb753-33"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;valeur prédite Y&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Personne à faible revenu (%)&quot;</span>)</span>
<span id="cb753-34"><a href="#cb753-34"></a></span>
<span id="cb753-35"><a href="#cb753-35"></a><span class="co"># Assemblage des graphiques</span></span>
<span id="cb753-36"><a href="#cb753-36"></a><span class="kw">ggarrange</span>(G1, G2, G3, G4, <span class="dt">ncol =</span><span class="dv">2</span>, <span class="dt">nrow =</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/EffetMarginalVariablesContinues-1.png" alt="Effets marginaux pour des variables continues" width="85%" />
<p class="caption">
(#fig:EffetMarginalVariablesContinues)Effets marginaux pour des variables continues
</p>
</div>
</div>
<div id="sect07742" class="section level4">
<h4><span class="header-section-number">7.7.4.2</span> Effet marginal pour une variable avec une fonction polynomiale d’ordre 2</h4>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="#cb754-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb754-2"><a href="#cb754-2"></a><span class="kw">library</span>(ggeffects)</span>
<span id="cb754-3"><a href="#cb754-3"></a><span class="kw">library</span>(ggpubr)</span>
<span id="cb754-4"><a href="#cb754-4"></a></span>
<span id="cb754-5"><a href="#cb754-5"></a>fitAgeMedian &lt;-<span class="st"> </span><span class="kw">ggpredict</span>(modele3, <span class="dt">terms =</span> <span class="st">&quot;AgeMedian&quot;</span>)</span>
<span id="cb754-6"><a href="#cb754-6"></a></span>
<span id="cb754-7"><a href="#cb754-7"></a> <span class="kw">ggplot</span>(fitAgeMedian, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span></span>
<span id="cb754-8"><a href="#cb754-8"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&#39;green&#39;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb754-9"><a href="#cb754-9"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">.3</span>)<span class="op">+</span></span>
<span id="cb754-10"><a href="#cb754-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Variable sous forme polynomiale (ordre 2)&quot;</span>,</span>
<span id="cb754-11"><a href="#cb754-11"></a>       <span class="dt">y=</span><span class="st">&quot;VD: valeur prédite&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Âge médian des bâtiments&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/Titi-1.png" alt="Effet marginal d'une variable avec un fonction polynomiale d'ordre 2" width="70%" />
<p class="caption">
(#fig:Titi)Effet marginal d’une variable avec un fonction polynomiale d’ordre 2
</p>
</div>
</div>
<div id="sect07743" class="section level4">
<h4><span class="header-section-number">7.7.4.3</span> Effet marginal pour une variable transformée en logarithme</h4>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb755-1"><a href="#cb755-1"></a>fitHabHa &lt;-<span class="st"> </span><span class="kw">ggpredict</span>(modele3, <span class="dt">terms =</span> <span class="st">&quot;HABHA&quot;</span>)</span>
<span id="cb755-2"><a href="#cb755-2"></a></span>
<span id="cb755-3"><a href="#cb755-3"></a><span class="kw">ggplot</span>(fitHabHa, <span class="kw">aes</span>(x, predicted)) <span class="op">+</span></span>
<span id="cb755-4"><a href="#cb755-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb755-5"><a href="#cb755-5"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">.3</span>)<span class="op">+</span></span>
<span id="cb755-6"><a href="#cb755-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;VD: valeur prédite&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Habitants km2&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/EffetMarginalVariableLog-1.png" alt="Effet du logarithme de la densité" width="75%" />
<p class="caption">
(#fig:EffetMarginalVariableLog)Effet du logarithme de la densité
</p>
</div>
</div>
<div id="sect07744" class="section level4">
<h4><span class="header-section-number">7.7.4.4</span> Effet marginal pour une variable dichotomique</h4>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="#cb756-1"></a><span class="co"># Valeurs prédites selon le modèle avec la variable dichotomique</span></span>
<span id="cb756-2"><a href="#cb756-2"></a>fitVilleMtl &lt;-<span class="st"> </span><span class="kw">ggpredict</span>(modele4, <span class="dt">terms =</span> <span class="st">&quot;VilleMtl&quot;</span>)</span>
<span id="cb756-3"><a href="#cb756-3"></a></span>
<span id="cb756-4"><a href="#cb756-4"></a><span class="co"># Graphique</span></span>
<span id="cb756-5"><a href="#cb756-5"></a><span class="kw">ggplot</span>(fitVilleMtl, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>predicted)) <span class="op">+</span></span>
<span id="cb756-6"><a href="#cb756-6"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(), <span class="dt">fill=</span><span class="st">&quot;wheat&quot;</span>) <span class="op">+</span></span>
<span id="cb756-7"><a href="#cb756-7"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">.9</span>,<span class="dt">position =</span> <span class="kw">position_dodge</span>())<span class="op">+</span></span>
<span id="cb756-8"><a href="#cb756-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Effet marginal de la ville de Montréal sur la végétation&quot;</span>,</span>
<span id="cb756-9"><a href="#cb756-9"></a>       <span class="dt">x=</span><span class="st">&quot;Municipalités de la région de Montréal&quot;</span>,</span>
<span id="cb756-10"><a href="#cb756-10"></a>       <span class="dt">y=</span><span class="st">&quot;Couverture végétation de l&#39;îlot (%)&quot;</span>)<span class="op">+</span></span>
<span id="cb756-11"><a href="#cb756-11"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb756-12"><a href="#cb756-12"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Autre municipalité&quot;</span>, <span class="st">&quot;Ville de Montréal&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/EffetMarginalDichCode-1.png" alt="Effet marginal d'une variable dichotomique" width="70%" />
<p class="caption">
(#fig:EffetMarginalDichCode)Effet marginal d’une variable dichotomique
</p>
</div>
</div>
<div id="sect07745" class="section level4">
<h4><span class="header-section-number">7.7.4.5</span> Effet marginal pour une variable polytomique</h4>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="#cb757-1"></a><span class="co"># Valeurs prédites selon le modèle avec la variable polytomique</span></span>
<span id="cb757-2"><a href="#cb757-2"></a>fitVilles &lt;-<span class="st"> </span><span class="kw">ggpredict</span>(modele5, <span class="dt">terms =</span> <span class="st">&quot;Munic&quot;</span>)</span>
<span id="cb757-3"><a href="#cb757-3"></a></span>
<span id="cb757-4"><a href="#cb757-4"></a><span class="co"># Graphique</span></span>
<span id="cb757-5"><a href="#cb757-5"></a>Graphique &lt;-<span class="st"> </span><span class="kw">ggplot</span>(fitVilles, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>predicted)) <span class="op">+</span></span>
<span id="cb757-6"><a href="#cb757-6"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(), <span class="dt">fill=</span><span class="st">&quot;wheat&quot;</span>) <span class="op">+</span></span>
<span id="cb757-7"><a href="#cb757-7"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">.9</span>,<span class="dt">position =</span> <span class="kw">position_dodge</span>())<span class="op">+</span></span>
<span id="cb757-8"><a href="#cb757-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Effet marginal de la ville de Montréal sur la végétation&quot;</span>,</span>
<span id="cb757-9"><a href="#cb757-9"></a>       <span class="dt">x=</span><span class="st">&quot;Municipalités de la région de Montréal&quot;</span>,</span>
<span id="cb757-10"><a href="#cb757-10"></a>       <span class="dt">y=</span><span class="st">&quot;Couverture végétation de l&#39;îlot (%)&quot;</span>)</span>
<span id="cb757-11"><a href="#cb757-11"></a></span>
<span id="cb757-12"><a href="#cb757-12"></a><span class="co"># Rotation du graphique</span></span>
<span id="cb757-13"><a href="#cb757-13"></a>Graphique <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/EffetMarginalPolyT-1.png" alt="Effet marginal d'une variable polytomique" width="70%" />
<p class="caption">
(#fig:EffetMarginalPolyT)Effet marginal d’une variable polytomique
</p>
</div>
</div>
<div id="sect07746" class="section level4">
<h4><span class="header-section-number">7.7.4.6</span> Effet marginal pour une variable d’interaction (deux VI continues)</h4>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="#cb758-1"></a><span class="kw">library</span>(metR) <span class="co"># pour ajouter des labels aux contours</span></span>
<span id="cb758-2"><a href="#cb758-2"></a></span>
<span id="cb758-3"><a href="#cb758-3"></a>df &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(</span>
<span id="cb758-4"><a href="#cb758-4"></a>  <span class="dt">DistCBDkm =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">33</span>,<span class="fl">0.1</span>),</span>
<span id="cb758-5"><a href="#cb758-5"></a>  <span class="dt">Pct_FR =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">95</span>,<span class="dv">1</span>),</span>
<span id="cb758-6"><a href="#cb758-6"></a>  <span class="dt">HABHA =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>HABHA),</span>
<span id="cb758-7"><a href="#cb758-7"></a>  <span class="dt">AgeMedian =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>AgeMedian),</span>
<span id="cb758-8"><a href="#cb758-8"></a>  <span class="dt">Pct_014 =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>Pct_<span class="dv">014</span>),</span>
<span id="cb758-9"><a href="#cb758-9"></a>  <span class="dt">Pct_65P =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>Pct_65P),</span>
<span id="cb758-10"><a href="#cb758-10"></a>  <span class="dt">Pct_MV =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>Pct_MV)</span>
<span id="cb758-11"><a href="#cb758-11"></a>)</span>
<span id="cb758-12"><a href="#cb758-12"></a></span>
<span id="cb758-13"><a href="#cb758-13"></a>df<span class="op">$</span>DistCBDkmX_Pct_FR &lt;-<span class="st">  </span>df<span class="op">$</span>DistCBDkm <span class="op">*</span><span class="st"> </span>df<span class="op">$</span>Pct_FR</span>
<span id="cb758-14"><a href="#cb758-14"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(modele6, <span class="dt">newdata =</span> df, <span class="dt">se =</span> T)</span>
<span id="cb758-15"><a href="#cb758-15"></a>df<span class="op">$</span>pred &lt;-<span class="st"> </span>pred<span class="op">$</span>fit</span>
<span id="cb758-16"><a href="#cb758-16"></a>df<span class="op">$</span>pred_se &lt;-<span class="st"> </span>pred<span class="op">$</span>se.fit</span>
<span id="cb758-17"><a href="#cb758-17"></a>df<span class="op">$</span>lower &lt;-<span class="st"> </span>df<span class="op">$</span>pred <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>df<span class="op">$</span>pred_se</span>
<span id="cb758-18"><a href="#cb758-18"></a>df<span class="op">$</span>upper &lt;-<span class="st"> </span>df<span class="op">$</span>pred <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>df<span class="op">$</span>pred_se</span>
<span id="cb758-19"><a href="#cb758-19"></a></span>
<span id="cb758-20"><a href="#cb758-20"></a>P1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb758-21"><a href="#cb758-21"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DistCBDkm, <span class="dt">y =</span> Pct_FR, <span class="dt">fill =</span> pred)) <span class="op">+</span></span>
<span id="cb758-22"><a href="#cb758-22"></a><span class="st">  </span><span class="kw">stat_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DistCBDkm, <span class="dt">y =</span> Pct_FR, <span class="dt">z =</span> pred), </span>
<span id="cb758-23"><a href="#cb758-23"></a>               <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb758-24"><a href="#cb758-24"></a><span class="st">  </span><span class="kw">geom_text_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DistCBDkm, <span class="dt">y =</span> Pct_FR, <span class="dt">z =</span> pred), )<span class="op">+</span></span>
<span id="cb758-25"><a href="#cb758-25"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb758-26"><a href="#cb758-26"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Distance au centre-ville&quot;</span>, </span>
<span id="cb758-27"><a href="#cb758-27"></a>       <span class="dt">y =</span> <span class="st">&quot;Pers à faible revenu (%)&quot;</span>,</span>
<span id="cb758-28"><a href="#cb758-28"></a>       <span class="dt">fill =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb758-29"><a href="#cb758-29"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Prédiction&quot;</span>)</span>
<span id="cb758-30"><a href="#cb758-30"></a></span>
<span id="cb758-31"><a href="#cb758-31"></a>P2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb758-32"><a href="#cb758-32"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DistCBDkm, <span class="dt">y =</span> Pct_FR, <span class="dt">fill =</span> lower)) <span class="op">+</span></span>
<span id="cb758-33"><a href="#cb758-33"></a><span class="st">  </span><span class="kw">stat_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DistCBDkm, <span class="dt">y =</span> Pct_FR, <span class="dt">z =</span> lower), </span>
<span id="cb758-34"><a href="#cb758-34"></a>               <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb758-35"><a href="#cb758-35"></a><span class="st">  </span><span class="kw">geom_text_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DistCBDkm, <span class="dt">y =</span> Pct_FR, <span class="dt">z =</span> lower), )<span class="op">+</span></span>
<span id="cb758-36"><a href="#cb758-36"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete=</span><span class="ot">FALSE</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb758-37"><a href="#cb758-37"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Distance au centre-ville&quot;</span>, </span>
<span id="cb758-38"><a href="#cb758-38"></a>       <span class="dt">y =</span> <span class="st">&quot;Pers à faible revenu (%)&quot;</span>,</span>
<span id="cb758-39"><a href="#cb758-39"></a>       <span class="dt">fill =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb758-40"><a href="#cb758-40"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;IC 2,5 %&quot;</span>)</span>
<span id="cb758-41"><a href="#cb758-41"></a></span>
<span id="cb758-42"><a href="#cb758-42"></a>P3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb758-43"><a href="#cb758-43"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DistCBDkm, <span class="dt">y =</span> Pct_FR, <span class="dt">fill =</span> upper)) <span class="op">+</span></span>
<span id="cb758-44"><a href="#cb758-44"></a><span class="st">  </span><span class="kw">stat_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DistCBDkm, <span class="dt">y =</span> Pct_FR, <span class="dt">z =</span> upper), </span>
<span id="cb758-45"><a href="#cb758-45"></a>               <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb758-46"><a href="#cb758-46"></a><span class="st">  </span><span class="kw">geom_text_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DistCBDkm, <span class="dt">y =</span> Pct_FR, <span class="dt">z =</span> upper), )<span class="op">+</span></span>
<span id="cb758-47"><a href="#cb758-47"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete=</span><span class="ot">FALSE</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb758-48"><a href="#cb758-48"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Distance au centre-ville&quot;</span>, </span>
<span id="cb758-49"><a href="#cb758-49"></a>       <span class="dt">y =</span> <span class="st">&quot;Pers à faible revenu (%)&quot;</span>,</span>
<span id="cb758-50"><a href="#cb758-50"></a>       <span class="dt">fill =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb758-51"><a href="#cb758-51"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;IC 97,5 %&quot;</span>)</span>
<span id="cb758-52"><a href="#cb758-52"></a></span>
<span id="cb758-53"><a href="#cb758-53"></a><span class="kw">ggarrange</span>(P1,P2,P3,<span class="dt">common.legend =</span> F, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/ModeleInteraction2heatex-1.png" alt="Effet marginal de l'interaction entre deux variables continues" width="95%" />
<p class="caption">
(#fig:ModeleInteraction2heatex)Effet marginal de l’interaction entre deux variables continues
</p>
</div>
</div>
<div id="sect07747" class="section level4">
<h4><span class="header-section-number">7.7.4.7</span> Effet marginal pour une variable d’interaction (une VI continue et une VI dichotomique)</h4>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="#cb759-1"></a>df &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(</span>
<span id="cb759-2"><a href="#cb759-2"></a>  <span class="dt">VilleMtl =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb759-3"><a href="#cb759-3"></a>  <span class="dt">Pct_FR =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">95</span>,<span class="dv">1</span>),</span>
<span id="cb759-4"><a href="#cb759-4"></a>  <span class="dt">HABHA =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>HABHA),</span>
<span id="cb759-5"><a href="#cb759-5"></a>  <span class="dt">AgeMedian =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>AgeMedian),</span>
<span id="cb759-6"><a href="#cb759-6"></a>  <span class="dt">Pct_014 =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>Pct_<span class="dv">014</span>),</span>
<span id="cb759-7"><a href="#cb759-7"></a>  <span class="dt">Pct_65P =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>Pct_65P),</span>
<span id="cb759-8"><a href="#cb759-8"></a>  <span class="dt">Pct_MV =</span> <span class="kw">mean</span>(DataFinal<span class="op">$</span>Pct_MV)</span>
<span id="cb759-9"><a href="#cb759-9"></a>)</span>
<span id="cb759-10"><a href="#cb759-10"></a>df<span class="op">$</span>VilleMtlX_Pct_FR &lt;-<span class="st"> </span>df<span class="op">$</span>VilleMtl <span class="op">*</span><span class="st"> </span>df<span class="op">$</span>Pct_FR</span>
<span id="cb759-11"><a href="#cb759-11"></a></span>
<span id="cb759-12"><a href="#cb759-12"></a><span class="kw">head</span>(df, <span class="dt">n=</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   VilleMtl Pct_FR   HABHA AgeMedian  Pct_014  Pct_65P   Pct_MV VilleMtlX_Pct_FR
## 1        0      0 87.7694  52.11494 15.89268 14.86761 20.96675                0
## 2        1      0 87.7694  52.11494 15.89268 14.86761 20.96675                0
## 3        0      1 87.7694  52.11494 15.89268 14.86761 20.96675                0
## 4        1      1 87.7694  52.11494 15.89268 14.86761 20.96675                1
## 5        0      2 87.7694  52.11494 15.89268 14.86761 20.96675                0</code></pre>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="#cb761-1"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(modele7, <span class="dt">se =</span> T, <span class="dt">newdata =</span> df)</span>
<span id="cb761-2"><a href="#cb761-2"></a>df<span class="op">$</span>pred &lt;-<span class="st"> </span>pred<span class="op">$</span>fit</span>
<span id="cb761-3"><a href="#cb761-3"></a>df<span class="op">$</span>upper &lt;-<span class="st"> </span>df<span class="op">$</span>pred <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>pred<span class="op">$</span>se.fit</span>
<span id="cb761-4"><a href="#cb761-4"></a>df<span class="op">$</span>lower &lt;-<span class="st"> </span>df<span class="op">$</span>pred <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>pred<span class="op">$</span>se.fit</span>
<span id="cb761-5"><a href="#cb761-5"></a></span>
<span id="cb761-6"><a href="#cb761-6"></a>df<span class="op">$</span>VilleMtl_str &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df<span class="op">$</span>VilleMtl<span class="op">==</span><span class="dv">0</span>,<span class="st">&quot;Autre municipalité&quot;</span>,<span class="st">&quot;Ville de Montréal&quot;</span>)</span>
<span id="cb761-7"><a href="#cb761-7"></a>DataFinal<span class="op">$</span>VilleMtl_str &lt;-<span class="st"> </span><span class="kw">ifelse</span>(DataFinal<span class="op">$</span>VilleMtl<span class="op">==</span><span class="dv">0</span>,<span class="st">&quot;Autre municipalité&quot;</span>,<span class="st">&quot;Ville de Montréal&quot;</span>)</span>
<span id="cb761-8"><a href="#cb761-8"></a></span>
<span id="cb761-9"><a href="#cb761-9"></a>cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Autre municipalité&quot;</span> =<span class="st">&quot;#1d3557&quot;</span> ,<span class="st">&quot;Ville de Montréal&quot;</span>=<span class="st">&quot;#e63946&quot;</span>)</span>
<span id="cb761-10"><a href="#cb761-10"></a></span>
<span id="cb761-11"><a href="#cb761-11"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df) <span class="op">+</span></span>
<span id="cb761-12"><a href="#cb761-12"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> DataFinal, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Pct_FR, <span class="dt">y =</span> VegPct, <span class="dt">color =</span> VilleMtl_str),</span>
<span id="cb761-13"><a href="#cb761-13"></a>             <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>)<span class="op">+</span></span>
<span id="cb761-14"><a href="#cb761-14"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Pct_FR, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper, <span class="dt">group =</span> VilleMtl_str),</span>
<span id="cb761-15"><a href="#cb761-15"></a>              <span class="dt">fill =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>))<span class="op">+</span></span>
<span id="cb761-16"><a href="#cb761-16"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Pct_FR, <span class="dt">y =</span> pred, <span class="dt">color =</span> VilleMtl_str), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb761-17"><a href="#cb761-17"></a><span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> cols)<span class="op">+</span></span>
<span id="cb761-18"><a href="#cb761-18"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Personnes à faible revenu (%)&quot;</span>,</span>
<span id="cb761-19"><a href="#cb761-19"></a>       <span class="dt">y =</span> <span class="st">&quot;Densité de végétation prédite (%)&quot;</span>,</span>
<span id="cb761-20"><a href="#cb761-20"></a>       <span class="dt">color =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/ModeleInteractionBinaireeffectex-1.png" alt="Graphique de l’effet marginal de l’interaction entre une variable quantitative et qualitative" width="2100" />
<p class="caption">
(#fig:ModeleInteractionBinaireeffectex)Graphique de l’effet marginal de l’interaction entre une variable quantitative et qualitative
</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="sect078" class="section level2">
<h2><span class="header-section-number">7.8</span> Quiz de révision du chapitre</h2>
<div id="Chapitre7_Lm" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_Chapitre7_Lm;
  window.onload = function() {
    quizz_Chapitre7_Lm = new Quiz('Chapitre7_Lm', ['1','2','1','2',['1', '2'],'1','2',['1', '2', '3', '4', '5']]);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels modèles sont imbriqués?
</div>
<div>
Relisez au besoin la section @ref(sect0732).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Modèle A : Y = X1 + X2 + X3 / Modèle B : Y = X1 + X2 + X3 + X4 + X5</label>
</td>
<td>
<input type="radio" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Modèle A : Y = X1 + X4 + X5 / Modèle B : Y = X1 + X2 + X3 + X7 + X8</label>
</td>
<td>
<input type="radio" name="q1" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelle mesure relative à la qualité d’ajustement du modèle indique la proportion de la variance de la variable dépendante expliquée par les variables indépendantes du modèle?
</div>
<div>
Relisez au besoin la section @ref(sect0731).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Statistique de Fisher</label>
</td>
<td>
<input type="radio" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Coefficient de détermination (R2)</label>
</td>
<td>
<input type="radio" name="q2" value="2"/>
</td>
</tr>
<tr>
<td>
<label>L’erreur quadratique moyenne (RMSE)</label>
</td>
<td>
<input type="radio" name="q2" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Le coefficient de régression standardisé</label>
</td>
<td>
<input type="radio" name="q2" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le R2 ajusté permet de comparer des modèles avec des nombres de variables indépendantes et/ou d’observations différents
</div>
<div>
Relisez au besoin le début de la section @ref(sect0732).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q3" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Comment repérer les variables les plus importantes du modèle?
</div>
<div>
Relisez au besoin la section @ref(sect0742).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Coefficients de régression</label>
</td>
<td>
<input type="radio" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Coefficients de régression standardisés</label>
</td>
<td>
<input type="radio" name="q4" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Erreurs types</label>
</td>
<td>
<input type="radio" name="q4" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Comment évaluer la significativité des coefficients?
</div>
<div>
Relisez au besoin la section @ref(sect0743).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Valeur de t</label>
</td>
<td>
<input type="checkbox" name="q5" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Valeur de p</label>
</td>
<td>
<input type="checkbox" name="q5" value="2"/>
</td>
</tr>
<tr>
<td>
<label>R2</label>
</td>
<td>
<input type="checkbox" name="q5" value="3"/>
</td>
</tr>
<tr>
<td>
<label>F de Fisher</label>
</td>
<td>
<input type="checkbox" name="q5" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour un nombre très élevé d’observations, quelle affirmation est vraie pour les valeurs de t et de p?
</div>
<div>
Relisez au besoin la section @ref(sect0743).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>1,96 (p &lt;= 0,05); 2,58 (p &lt;= 0,01); 3,29 (p &lt;= 0,001)</label>
</td>
<td>
<input type="radio" name="q6" value="1"/>
</td>
</tr>
<tr>
<td>
<label>1,96 (p &lt;= 0,001); 2,58 (p &lt;= 0,01); 3,29 (p &lt;= 0,05)</label>
</td>
<td>
<input type="radio" name="q6" value="2"/>
</td>
</tr>
<tr>
<td>
<label>2,96 (p &lt;= 0,05); 3,58 (p &lt;= 0,01); 4,29 (p &lt;= 0,001)</label>
</td>
<td>
<input type="radio" name="q6" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Une variable indépendante dont l’intervalle de confiance à 95 % du coefficient de régression est de [-15,06 ; 28,17] est-elle significatif au seuil de p = 0,05?
</div>
<div>
Relisez au besoin la section @ref(sect0744).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q7" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q7" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Comment poser un diagnostic sur un modèle de régression linéaire?
</div>
<div>
Relisez le deuxième encadré à la section @ref(sect076).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Nombre d’observations</label>
</td>
<td>
<input type="checkbox" name="q8" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Normalité des résidus</label>
</td>
<td>
<input type="checkbox" name="q8" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Linéarité et homoscédasticité des résidus</label>
</td>
<td>
<input type="checkbox" name="q8" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Absence de multicolinéarité excessive</label>
</td>
<td>
<input type="checkbox" name="q8" value="4"/>
</td>
</tr>
<tr>
<td>
<label>Absence d’observations trop influentes</label>
</td>
<td>
<input type="checkbox" name="q8" value="5"/>
</td>
</tr>
<tr>
<td>
<label>Nombre de variables indépendantes</label>
</td>
<td>
<input type="checkbox" name="q8" value="6"/>
</td>
</tr>
</table>
</div>
</div>
<button type="button" onclick="showResults(quizz_Chapitre7_Lm);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:07-regressionlineaire.Rmd-->
</div>
</div>
<div id="chap08" class="section level1">
<h1><span class="header-section-number">8</span> Régressions linéaires généralisées (GLM)</h1>
<div class="bloc_attention">
<p>Ce chapitre n’a pas encore fait l’objet d’une révision linguistique. Il comprend certainement plusieurs coquilles… Une version révisée sera mise à jour prochainement.</p>
</div>
<p>Dans ce chapitre, nous présentons les modèles linéaires généralisés plus communément appelés GLM (<em>generalized linear models</em> en anglais). Il s’agit d’une extension directe du modèle de régression linéaire multiple (LM) basé sur la méthode des moindres carrés ordinaires, décrite dans le chapitre précédent. Pour aborder cette section sereinement, il est important d’avoir bien compris le concept de distribution présenté dans la section @ref(sect024). À la fin de cette section, vous serez en mesure de :</p>
<ul>
<li>comprendre la distinction entre un modèle LM classique et un GLM;</li>
<li>identifier les composantes d’un GLM;</li>
<li>interpréter les résultats d’un GLM;</li>
<li>effectuer les diagnostics d’un GLM.</li>
</ul>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons principalement les <em>packages</em> suivants :</p>
<ul>
<li>Pour créer des graphiques :
<ul>
<li><code>ggplot2</code>, le seul, l’unique!</li>
<li><code>ggpubr</code> pour combiner des graphiques et réaliser des diagrammes.</li>
</ul></li>
<li>Pour ajuster des modèles GLM :
<ul>
<li><code>VGAM</code> et <code>gamlss</code> offrent tous les deux un très large choix de distributions et de fonctions de diagnostic, mais nécessitent souvent un peu plus de code.</li>
<li><code>mgcv</code> offre moins de distributions que les deux précédents, mais est plus simple d’utilisation.</li>
</ul></li>
<li>Pour analyser des modèles GLM :</li>
<li><code>car</code> essentiellement pour la fonction <code>vif</code>.</li>
<li><code>DHARMa</code> pour le diagnostic des résidus simulés.</li>
<li><code>ROCR</code> et <code>caret</code> pour l’analyse de la qualité d’ajustement de modèles pour des variables qualitatives.</li>
<li><code>AER</code> pour des tests de sur-dispersion.</li>
<li><code>fitdistrplus</code> pour ajuster des distributions à des données.</li>
<li><code>LaplacesDemon</code> pour manipuler certaines distributions.</li>
<li><code>sandwich</code> pour générer des erreurs standards robustes pour le modèle GLM logistique binomial.</li>
</ul>
</div>
<div id="sect081" class="section level2">
<h2><span class="header-section-number">8.1</span> Qu’est qu’un modèle GLM?</h2>
<p>Nous avons vu qu’une régression linéaire multiple (LM) ne peut être appliquée que si la variable dépendante analysée est continue et si elle est normalement distribuée, une fois les variables indépendantes contrôlées. Il s’agit d’une limite très importante puisqu’elle ne peut être utilisée pour modéliser et prédire des variables binaires, multinomiales, de comptage, ordinales ou plus simplement des données anormalement distribuées. Une seconde limite importante des LM est que l’influence des variables indépendantes sur la variable dépendante ne peut être que linéaire. L’augmentation d’une unité de <em>X</em> conduits à une augmentation (ou diminution) de <span class="math inline">\(\beta\)</span> (coefficient de régression) unités de <em>Y</em>, ce qui n’est pas toujours représentatif des phénomènes étudiés. Afin de dépasser ces contraintes, <span class="citation">Nelder et Wedderburn (<a href="#ref-GLMnelder" role="doc-biblioref">1972</a>)</span> ont proposé une extension des modèles LM, soit les modèles linéaires généralisés (GLM).</p>
<div id="sect0811" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Formulation d’un GLM</h3>
<p>Puisqu’un modèle GLM est une extension des modèles LM, il est possible de traduire un modèle LM sous forme d’un GLM. Nous utilisons ce point de départ pour détailler la morphologie d’un GLM. Nous avons vu dans la section précédente qu’un modèle LM est formulé de la façon suivante (notation matricielle) :</p>

<p><span class="math display">\[\begin{equation}
Y = \beta_0 + X\beta + \epsilon
(\#eq:regmultiple5B)
\end{equation}\]</span>
</p>
<p>Avec <span class="math inline">\(\beta_0\)</span> la constante (<em>intercept</em> en anglais) et <span class="math inline">\(\beta\)</span> un vecteur de coefficients de régression pour les <em>k</em> variables indépendantes (<em>X</em>).</p>
<p>D’après cette formule, nous modélisons la variable <em>Y</em> avec une équation de régression linéaire et un terme d’erreur que nous estimons être normalement distribué. Nous pouvons reformuler ce simple LM sous forme d’un GLM avec l’écriture suivante :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \beta X\\
&amp;g(x) = x
\end{aligned}
(\#eq:glm1)
\end{equation}\]</span>
</p>
<p>Pas de panique! Cette écriture se lit comme suit : la variable <em>Y</em> est issue d’une distribution normale <span class="math inline">\((Y \sim Normal)\)</span> avec deux paramètres : <span class="math inline">\(\mu\)</span> (sa moyenne) et <span class="math inline">\(\sigma\)</span> (son écart-type). <span class="math inline">\(\mu\)</span> varie en fonction d’une équation de régression linéaire (<span class="math inline">\(\beta_0 + \beta X\)</span>) transformée par une fonction de lien <em>g</em> (détaillée plus loin). Dans ce cas précis, la fonction de lien est appelée fonction identitaire puisqu’elle n’applique aucune transformation (<span class="math inline">\(g(x) = x\)</span>). Notez ici que le second paramètre de la distribution normale <span class="math inline">\(\sigma\)</span> (paramètre de dispersion) a une valeur fixe et ne dépend donc pas des variables indépendantes à la différence de <span class="math inline">\(\mu\)</span>. Dans ce modèle spécifiquement, les paramètres à estimer sont <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(\beta_0\)</span> et <span class="math inline">\(\beta\)</span>.
Notez que dans la notation traditionnelle, la fonction de lien est appliquée au paramètre modélisé. Il est possible de renverser cette notation en utilisant la réciproque (<span class="math inline">\(g&#39;\)</span>) de la fonction de lien (<span class="math inline">\(g\)</span>) :</p>

<p><span class="math display">\[\begin{equation}
g(\mu) = \beta_0 + \beta X \Longleftrightarrow \mu = g&#39;(\beta_0 + \beta X)
\text{ si : }g&#39;(g(x)) = x
(\#eq:glm2)
\end{equation}\]</span>
</p>
<p>Dans un modèle GLM, la distribution attendue de la variable <em>Y</em> est déclarée de façon explicite ainsi que la façon dont nos variables indépendantes conditionnent cette distribution. Ici, c’est la moyenne (<span class="math inline">\(\mu\)</span>) de la distribution qui est modélisée, nous nous intéressons ainsi au changement moyen de <em>Y</em> provoqué par les variables <em>X</em>.</p>
<p>Avec cet exemple, nous voyons les deux composantes supplémentaires d’un modèle GLM :</p>
<ul>
<li>La distribution supposée de la variable <em>Y</em> conditionnée par les variables <em>X</em> (ici, la distribution normale).</li>
<li>Une fonction de lien associant l’équation de régression formée par les variables indépendantes et un paramètre de la distribution retenue (ici la fonction identitaire et le paramètre <span class="math inline">\(\mu\)</span>).</li>
</ul>
<p>Notez également que l’estimation des paramètres d’un modèle GLM (ici <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta X\)</span> et <span class="math inline">\(\sigma\)</span>) ne se fait plus avec la méthode des moindres carrés ordinaires utilisée pour les modèles LM. À la place, la méthode par maximum de vraisemblance (<em>maximum likelihood</em>) est le plus souvent utilisée, mais certains <em>packages</em> utilisent également la méthode des moments (<em>method of moments</em>). Ces deux méthodes nécessitent des échantillons plus grands que la méthode des moindres carrés. Dans le cas spécifique d’un modèle GLM utilisant une distribution normale, la méthode des moindres carrés et la méthode par maximum de vraisemblance produisent les mêmes résultats.</p>
</div>
<div id="sect0812" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Autres distributions et rôle de la fonction de lien</h3>
<p>À première vue, il serait possible de se demander pourquoi rajouter ces deux éléments puisqu’ils ne font que complexifier le modèle. Pour mieux saisir la pertinence des GLM, prenons un exemple appliqué au cas d’une variable binaire. Admettons que nous souhaitons modéliser / prédire la probabilité qu’un(e) cycliste décède lors d’une collision avec un véhicule motorisé. Notre variable dépendante est donc binaire (0 = survie, 1 = décès) et nous souhaitons la prédire avec trois variables continues que sont : la vitesse de déplacement du ou de la cycliste (<span class="math inline">\(x_1\)</span>), la vitesse de déplacement du véhicule (<span class="math inline">\(x_2\)</span>) et la masse du véhicule (<span class="math inline">\(x_3\)</span>). Puisque la variable <em>Y</em> n’est pas continue, il serait absurde de supposer qu’elle est issue d’une distribution normale. Il serait plus logique de penser qu’elle provient d’une distribution de Bernoulli (pour rappel, une distribution de Bernoulli permet de modéliser un phénomène ayant deux issues possibles comme un lancer de pièce de monnaie, section @ref(sect024)). Plus spécifiquement, nous pourrions formuler l’hypothèse que nos trois variables <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span> et <span class="math inline">\(x_3\)</span> influencent le paramètre <em>p</em> (la probabilité d’occurrence de l’évènement) d’une distribution de Bernoulli. À partir de ces premières hypothèses, nous pouvons écrire le modèle suivant :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Bernoulli(p)\\
&amp;g(p) = \beta_0 + \beta X\\
&amp;g(x) = x
\end{aligned}
(\#eq:glm3)
\end{equation}\]</span>
</p>
<p>Toutefois, le résultat n’est pas entièrement satisfaisant. En effet, <em>p</em> est une probabilité et, par nature, ce paramètre doit être compris entre 0 et 1 (entre 0 et 100 % de « chances de décès », ni plus ni moins). L’équation de régression que nous utilisons actuellement peut produire des résultats compris entre <span class="math inline">\(-\infty\)</span> et <span class="math inline">\(+\infty\)</span> pour <em>p</em> puisque rien ne contraint la somme <span class="math inline">\(\beta_0+ \beta_1x_1+\beta_2x_2+ \beta_3x_3\)</span> à être comprise entre 0 et 1. Il est possible de visualiser le problème soulevé par cette situation avec les figures suivantes. Admettons que nous ayons observé une variable <em>Y</em> binaire et que nous sachions qu’elle est influencée par une variable <em>X</em> qui, plus elle augmente, plus les chances que <em>Y</em> soit 1 augmentent (figure @ref(fig:linearbinom)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/linearbinom-1.png" alt="Exemple de données issues d'une distribution de Bernoulli" width="70%" />
<p class="caption">
(#fig:linearbinom)Exemple de données issues d’une distribution de Bernoulli
</p>
</div>
<p>Si nous utilisons l’équation de régression actuelle, cela revient à trouver la droite la mieux ajustée passant dans ce nuage de points (figure @ref(fig:linearbinom2)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/linearbinom2-1.png" alt="Ajustement d'une droite de régression aux données issues d'une distribution de Bernoulli" width="70%" />
<p class="caption">
(#fig:linearbinom2)Ajustement d’une droite de régression aux données issues d’une distribution de Bernoulli
</p>
</div>
<p>Ce modèle semble bien cerner l’influence positive de <em>X</em> sur <em>Y</em>, mais la droite est au final très éloignée de chaque point, indiquant un faible ajustement du modèle. De plus, la droite prédit des probabilités négatives lorsque <em>X</em> est inférieur à −2,5 et des probabilités supérieures à 1 quand <em>X</em> est supérieur à 1. Elle est donc loin de bien représenter les données.</p>
<p>C’est ici qu’intervient la fonction de lien. La fonction identitaire que nous avons utilisée jusqu’ici n’est pas satisfaisante, nous devons la remplacer par une fonction qui conditionnera la somme <span class="math inline">\(\beta_0+ \beta_1x_1+\beta_2x_2+ \beta_3x_3\)</span> pour donner un résultat entre 0 et 1. Une candidate toute désignée est la fonction <em>sigmoidale</em>, plus souvent appelée la fonction <em>logistique</em>!</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Bernoulli(p)\\
&amp;S(p) = \beta_0 + \beta X\\
&amp;S(x) = \frac{e^{x}}{e^x+1}
\end{aligned}
(\#eq:glm4)
\end{equation}\]</span>
</p>
<p>La fonction logistique prend la forme d’un <em>S</em>. Plus la valeur entrée dans la fonction est grande, plus le résultat produit par la fonction est proche de 1 et inversement. Si nous reprenons l’exemple précédent, nous obtenons le modèle illustré à la figure @ref(fig:linearbinom3).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/linearbinom3-1.png" alt="Utilisation de la fonction de lien logistique" width="70%" />
<p class="caption">
(#fig:linearbinom3)Utilisation de la fonction de lien logistique
</p>
</div>
<p>Une fois cette fonction insérée dans le modèle, nous constatons qu’une augmentation de la somme <span class="math inline">\(\beta_0+ \beta_1x_1+\beta_2x_2+ \beta_3x_3\)</span> conduits à une augmentation de la probabilité <em>p</em> et inversement, et que cet impact est non linéaire. Nous avons donc maintenant un GLM permettant de prédire la probabilité d’un décès lors d’un accident en combinant une distribution et une fonction de lien adéquates.</p>
</div>
<div id="sect0813" class="section level3">
<h3><span class="header-section-number">8.1.3</span> Conditions d’application</h3>
<p>La famille des GLM englobe de (très) nombreux modèles du fait de la diversité de distributions existantes et des fonctions de liens utilisables. Cependant, certaines combinaisons sont plus souvent utilisées que d’autres. Nous présentons donc dans les prochaines sections les modèles GLM les plus communs. Les conditions d’application varient d’un modèle à l’autre, il existe cependant quelques conditions d’application communes à tous ces modèles :</p>
<ul>
<li>l’indépendance des observations (et donc des erreurs);</li>
<li>l’absence de valeurs aberrantes / fortement influentes;</li>
<li>l’absence de multicolinéarité excessive entre les variables indépendantes.</li>
</ul>
<p>Ces trois conditions sont également valables pour les modèles LM tel qu’abordés dans le chapitre @ref(chap07). La distance de <em>Cook</em> peut ainsi être utilisée pour détecter les potentielles valeurs aberrantes et le facteur d’inflation de la variance (<em>VIF</em>) pour détecter la multicolinéarité.
Les conditions d’application particulières sont détaillées dans les sections dédiées à chaque modèle.</p>
</div>
<div id="sect0814" class="section level3">
<h3><span class="header-section-number">8.1.4</span> Résidus et déviance</h3>
<p>Dans la section sur la régression linéaire simple, nous avions présenté la notion de résidu, soit l’écart entre la valeur observée (réelle) de <em>Y</em> et la valeur prédite par le modèle. Pour un modèle GLM, ces résidus traditionnels (aussi appelés résidus naturels) ne sont pas très informatifs si la variable à modéliser est binaire, multinomiale ou même de comptage. Lorsque l’on travaille avec des GLM, nous préférons utiliser trois autres formes de résidus, soit les résidus de Pearson, les résidus de déviance et les résidus simulés.</p>
<p><strong>Les résidus de Pearson</strong> sont une forme ajustée des résidus classiques, obtenus par la division des résidus naturels par la racine carrée de la variance modélisée. Leur formule varie donc d’un modèle à l’autre puisque l’expression de la variance change en fonction de la distribution du modèle. Pour un modèle GLM gaussien, il s’écrit :</p>

<p><span class="math display">\[\begin{equation}
r_i = \frac{y_i - \mu_i}{\sigma}
(\#eq:glm5)
\end{equation}\]</span>
</p>
<p>Pour un modèle GLM de Bernoulli, il s’écrit :</p>

<p><span class="math display">\[\begin{equation}
r_i = \frac{y_i - p_i}{\sqrt{p_i(1-p_i)}}
(\#eq:glm6)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(\mu_i\)</span> et <span class="math inline">\(p_i\)</span> les préditions du modèle pour l’observation <em>i</em>.</p>
<p><strong>Les résidus de déviance</strong> sont basés sur le concept de <em>likelihood</em> présenté dans la section @ref(sect02adjdistrib). Pour rappel, le <em>likelihood</em>, ou la vraisemblance d’un modèle, correspond à la probabilité conjointe d’avoir observé les données <em>Y</em> selon le modèle étudié. Pour des raisons mathématiques (voir section @ref(sect02adjdistrib)), le <em>log likelihood</em> est plus souvent calculé. Plus cette valeur est forte, moins le modèle se trompe. Cette interprétation est donc inverse à celle des résidus classiques, c’est pourquoi le <em>log likelihood</em> est généralement multiplié par −2 pour retrouver une interprétation intuitive. Ainsi, pour chaque observation <em>i</em>, nous pouvons calculer :</p>

<p><span class="math display">\[\begin{equation}
d_i = \mbox{-2} \times log(P(y_i|M_e))
(\#eq:glm7)
\end{equation}\]</span>
</p>
<p>Avec <span class="math inline">\(d_i\)</span> le résidu de déviance, et <span class="math inline">\(P(y_i|M_e)\)</span> la probabilité d’avoir observé la valeur <span class="math inline">\(y_i\)</span> selon le modèle étudié (<span class="math inline">\(M_e\)</span>).</p>
<p>La somme de tous ces résidus est appelée la déviance totale du modèle.</p>

<p><span class="math display">\[\begin{equation}
D(M_e) = \sum_{i=1}^n \mbox{-2} \times log(P(y_i|M_e))
(\#eq:glm8)
\end{equation}\]</span>
</p>
<p>Il s’agit donc d’une quantité représentant à quel point le modèle est erroné vis-à-vis des données. Notez qu’en tant que telle, la déviance n’a pas d’interprétation directe, en revanche, elle est utilisée pour calculer des mesures d’ajustement des modèles GLM.</p>
<p><strong>Les résidus simulés</strong> sont une avancée récente dans le monde des GLM, ils fournissent une définition et une interprétation harmonisée des résidus pour l’ensemble des modèles GLM. Dans la section sur les LM (voir section @ref(sect0722)), nous avions vu comment interpréter les graphiques des résidus pour détecter d’éventuels problèmes dans le modèle. Cependant, cette technique est bien plus compliquée à mettre en œuvre pour les GLM puisque la forme attendue des résidus varie en fonction de la distribution choisie pour modéliser <em>Y</em>. La façon la plus efficace de procéder est d’interpréter les graphiques des résidus simulés qui ont la particularité d’être <strong>identiquement distribués, quel que soit le modèle GLM construit</strong>. Ces résidus simulés sont compris entre 0 et 1, et sont calculés de la manière suivante :</p>
<ul>
<li><p>À partir du modèle GLM construit, simuler <em>S</em> fois (généralement 1 000) une variable <em>Y’</em> avec autant d’observation (<em>n</em>) que <em>Y</em>. Cette variable simulée est une combinaison de la prédiction du modèle (coefficient et variables indépendantes) et de sa dispersion (variance). Ces simulations représentent des variations vraisemblables de la variable <em>Y</em> si le modèle est correctement spécifié. En d’autres termes, si le modèle représente bien le phénomène à l’origine de la variable <em>Y</em>, alors les simulations <em>Y’</em> issues du modèle devraient être proches de la variable <em>Y</em> originale. Pour une explication plus détaillée de ce que signifie simuler des données à partir d’un modèle, référez-vous au <em>bloc attention</em> intitulé <em>distinction entre simulation et prédiction</em> dans la section @ref(compOrigPred).</p></li>
<li><p>Pour chaque observation, nous obtenons ainsi <em>S</em> valeurs formant une distribution, <span class="math inline">\(Ds_i\)</span>, des valeurs simulées par le modèle pour cette observation.</p></li>
<li><p>Pour chacune de ces distributions, nous calculons la probabilité cumulative d’observer la vraie valeur <span class="math inline">\(Y_i\)</span> d’après la distribution <span class="math inline">\(Ds_i\)</span>. Cette valeur est comprise entre 0 (toutes les valeurs simulées sont plus grandes que <span class="math inline">\(Y_i\)</span>) et 1 (toutes les valeurs simulées sont inférieures à <span class="math inline">\(Y_i\)</span>).</p></li>
</ul>
<p>Si le modèle est correctement spécifié, le résultat attendu est que la distribution de ces résidus est uniforme. En effet, il y a autant de chances que les simulations produisent des résultats supérieurs ou inférieurs à <span class="math inline">\(Y_i\)</span> si le modèle représente bien le phénomène <span class="citation">(Dunn et Smyth <a href="#ref-RandomizedResid" role="doc-biblioref">1996</a>; Gelman et Hill <a href="#ref-gelman2006data" role="doc-biblioref">2006</a>)</span>. Si la distribution des résidus ne suit pas une loi uniforme, cela signifie que le modèle échoue à reproduire le phénomène à l’origine de <em>Y</em>, ce qui doit nous alerter sur sa pertinence.</p>
</div>
<div id="sect0815" class="section level3">
<h3><span class="header-section-number">8.1.5</span> Vérifier l’ajustement</h3>
<p>Il existe trois façons de vérifier l’ajustement d’un modèle GLM :</p>
<ul>
<li>utiliser des mesures d’ajustement (AIC, pseudo-R<sup>2</sup>, déviance expliquée, etc.);</li>
<li>comparer les distributions de la variable originale et celle des prédictions;</li>
<li>comparer les prédictions du modèle avec les valeurs originales.</li>
</ul>
<p>Notez d’emblée que vérifier la qualité d’ajustement d’un modèle (ajustement aux données originales) ne revient pas à vérifier la validité d’un modèle (respect des conditions d’application). Cependant, ces deux éléments sont généralement liés, car un modèle mal ajusté a peu de chances d’être valide et inversement.</p>
<div id="mesures-dajustement" class="section level4">
<h4><span class="header-section-number">8.1.5.1</span> Mesures d’ajustement</h4>
<p>Les mesures d’ajustement sont des indicateurs plus ou moins arbitraires dont le principal intérêt est de faciliter la comparaison entre plusieurs modèles similaires. Il est nécessaire de les reporter, car dans certains cas, ils peuvent indiquer que des modèles sont très mal ajustés.</p>
<div id="déviance-expliquée" class="section level5">
<h5><span class="header-section-number">8.1.5.1.1</span> Déviance expliquée</h5>
<p>Rappelons que la déviance d’un modèle est une quantité représentant à quel point le modèle est erroné. L’objectif de l’indicateur de la déviance expliquée est d’estimer le pourcentage de la déviance maximale observable dans les données que le modèle est parvenu à expliquer. La déviance maximale observable dans les données est obtenue en utilisant la déviance totale du modèle nul (notée <span class="math inline">\(M_n\)</span>, soit un modèle dans lequel aucune variable indépendante n’est ajoutée et ne comportant qu’une constante). Cette déviance est maximale puisqu’aucune variable indépendante n’est présente dans le modèle. Nous calculons ensuite le pourcentage de cette déviance totale qui a été contrôlée par le modèle étudié (<span class="math inline">\(M_e\)</span>).</p>

<p><span class="math display">\[\begin{equation}
\mbox{déviance expliquée} = \frac{D(M_n) - D(M_e)}{D(M_n)} = 1- \frac{D(M_e)}{D(M_n)}
(\#eq:glm9)
\end{equation}\]</span>
</p>
<p>Il s’agit donc d’un simple calcul de pourcentage entre la déviance maximale (<span class="math inline">\(D(M_n)\)</span>) et la déviance expliquée par le modèle étudié (<span class="math inline">\(D(M_n )-D(M_e)\)</span>). Cet indicateur est compris entre 0 et 1, plus il est petit, plus la capacité de prédiction du modèle est faible. Attention, cet indicateur ne tient pas compte de la complexité du modèle. Ajouter une variable indépendante supplémentaire ne fait qu’augmenter la déviance expliquée, ce qui ne signifie pas que la complexification du modèle soit justifiée (<strong>voir l’encadré sur le principe de parcimonie</strong>, section @ref(sect0732)).</p>
</div>
<div id="pseudo-r2" class="section level5">
<h5><span class="header-section-number">8.1.5.1.2</span> Pseudo-<span class="math inline">\(R^2\)</span></h5>
<p>Le R<sup>2</sup> est une mesure d’ajustement représentant la part de la variance expliquée dans un modèle linéaire classique. Cette mesure n’est pas directement transposable au cas des GLM puisqu’ils peuvent être appliqués à des variables non continues et anormalement distribuées. Toutefois, il existe des mesures semblables appelées pseudo-R<sup>2</sup>, remplissant un rôle similaire. Notez cependant qu’ils ne peuvent pas être interprétés comme le R<sup>2</sup> classique (d’une régression linéaire multiple) : <strong>ils ne représentent pas la part de la variance expliquée</strong>. Ils sont compris dans l’intervalle 0 et 1; plus leurs valeurs s’approchent de 1, plus le modèle est ajusté.</p>
<table>
<caption>
(#tab:tablepseudor2)Principaux pseudo-<span class="math inline">\(R^2\)</span>
</caption>
<thead>
<tr>
<th>
Nom
</th>
<th>
Formule
</th>
<th>
Commentaire
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
McFadden
</td>
<td>
<span class="math inline">\(1-\frac{loglike(M_e)}{loglike(M_n)}\)</span>
</td>
<td>
Le rapport des <em>loglikelihood</em>, très proche de la déviance expliquée.
</td>
</tr>
<tr>
<td>
McFadden ajusté
</td>
<td>
<span class="math inline">\(1-\frac{loglike(M_e)-K}{loglike(M_n)}\)</span>
</td>
<td>
Version ajustée du R<sup>2</sup> de McFadden tenant compte du nombre de paramètres (<em>k</em>) dans le modèle.
</td>
</tr>
<tr>
<td>
Efron
</td>
<td>
<span class="math inline">\(1-\frac{\sum_{i=1}^n(y_i-\hat{y}_i)^2}{\sum_{i=1}^n(y_i-\bar{y}_i)^2}\)</span>
</td>
<td>
Rapport entre la somme des résidus classiques au carré (numérateur) et de la somme des écarts au carré à la moyenne (dénominateur). Notez que pour un GLM gaussien, ce pseudo-R<sup>2</sup> est identique au R<sup>2</sup> classique.
</td>
</tr>
<tr>
<td>
Cox &amp; Snell
</td>
<td>
<span class="math inline">\(1-e^{-\frac{2}{n}({loglike(M_e) - loglike(M_n))}}\)</span>
</td>
<td>
Transformation de la déviance afin de la mettre sur une échelle de 0 à 1 (mais ne pouvant atteindre exactement 1).
</td>
</tr>
<tr>
<td>
Nagelkerke
</td>
<td>
<span class="math inline">\(\frac{1-e^{-\frac{2}{n}({loglike(M_e) - loglike(M_n))}}}{1-e^{\frac{2*loglike(M_n)}{n}}}\)</span>
</td>
<td>
Ajustement du R<sup>2</sup> de Cox et Snell pour que l’échelle de valeurs possibles puisse comporter 1 (attention, car les valeurs de ce R<sup>2</sup> tendent à être toujours plus fortes que les autres).
</td>
</tr>
</tbody>
</table>
<p>En dehors du pseudo-R<sup>2</sup> de McFadden ajusté, aucune de ces mesures ne tient compte de la complexité du modèle. Il est cependant important de les reporter, car des valeurs très faibles indiquent vraisemblablement un modèle avec une moindre capacité informative. À l’inverse, des valeurs trop fortes pourraient indiquer un problème de surajustement (<strong>voir encadré sur le principe de parcimonie</strong>, section @ref(sect0732)).</p>
</div>
<div id="critère-dinformation-dakaike-aic" class="section level5">
<h5><span class="header-section-number">8.1.5.1.3</span> Critère d’information d’Akaike (<em>AIC</em>)</h5>
<p>Probablement l’indicateur le plus répandu, sa formule est relativement simple, car il s’agit seulement d’un ajustement de la déviance :</p>

<p><span class="math display">\[\begin{equation}
AIC = D(M_e) + 2K
(\#eq:glm10)
\end{equation}\]</span>
</p>
<p>Avec <em>K</em> le nombre de paramètres à estimer dans le modèle (coefficients, paramètres de distribution, etc.).</p>
<p>L’<em>AIC</em> n’a pas d’interprétation directe, mais permet de comparer deux modèles imbriqués (voir section @ref(sect0732)). Plus L’<em>AIC</em> est petit, mieux le modèle est ajusté. L’idée derrière cet indicateur est relativement simple. Si la déviance <em>D</em> est grande, alors le modèle est mal ajusté. Ajouter des paramètres (des coefficients pour de nouvelles variables <em>X</em>, par exemple) ne peut que réduire <em>D</em>, mais cette réduction n’est pas forcément suffisamment grande pour justifier la complexification du modèle. L’<em>AIC</em> pondère donc <em>D</em> en lui ajoutant 2 fois le nombre de paramètres du modèle. Un modèle plus simple (avec moins de paramètres) parvenant à une même déviance est préférable à un modèle complexe (principe de parcimonie ou du rasoir d’Ockham), ce que permet de « quantifier » L’<em>AIC</em>. Attention, L’<em>AIC</em> <strong>ne peut pas être utilisé pour comparer des modèles non imbriqués</strong>. Notez que d’autres indicateurs similaires comme le <em>WAIC</em>, le <em>BIC</em> et le <em>DIC</em> sont utilisés dans un contexte d’inférence bayésienne. Retenez simplement que ces indicateurs sont conceptuellement proches du <em>AIC</em> et s’interprètent (à peu de choses près) de la même façon.</p>
</div>
</div>
<div id="compOrigPred" class="section level4">
<h4><span class="header-section-number">8.1.5.2</span> Comparaison des distributions originales et prédites</h4>
<p>Une façon rapide de vérifier si un modèle est mal ajusté est de comparer la forme de la distribution originale et celle capturée par le modèle. L’idée est la suivante, si le modèle est bien ajusté aux données, il est possible de se servir de celui-ci pour générer de nouvelles données dont la distribution ressemble à celle des données originales. Si une différence importante est observable, alors les résultats du modèle ne sont pas fiables, car le modèle échoue à reproduire le phénomène étudié. Cette lecture graphique ne permet pas de s’assurer que le modèle est valide ou bien ajusté, mais simplement d’écarter rapidement les mauvais candidats. Notez que cette méthode ne s’applique pas lorsque la variable modélisée est binaire, multinomiale ou ordinale.
Le graphique à réaliser comprend donc la distribution de la variable dépendante <em>Y</em> (représentée avec un histogramme ou un graphique de densité) et plusieurs distributions simulées à partir du modèle. Cette approche est plus répandue dans la statistique bayésienne, mais elle reste pertinente dans l’approche fréquentiste. Il est rare de reporter ces figures, mais elles doivent faire partie de votre diagnostic.</p>
<div class="bloc_attention">
<p><strong>Distinction entre simulation et prédiction</strong></p>
<p>Notez ici que <strong>simuler des données</strong> à partir d’un modèle et <strong>effectuer des prédictions</strong> à partir d’un modèle sont deux opérations différentes. Prédire une valeur à partir d’un modèle revient simplement à appliquer son équation de régression à des données. Si lnous réutilisons les mêmes données, la prédiction renvoie toujours le même résultat, il s’agit de la partie systématique (ou déterministe) du modèle.
Pour illustrer cela, admettons que nous ayons ajusté un modèle GLM de type gaussien (fonction de lien identitaire) avec trois variables continues <span class="math inline">\(X_1\)</span>, <span class="math inline">\(X_2\)</span> et <span class="math inline">\(X_3\)</span> et des coefficients respectifs de 0,5, 1,2 et 1,8 ainsi qu’une constante de 7. Nous pouvons utiliser ces valeurs pour prédire la valeur attendue de <span class="math inline">\(Y\)</span> quand <span class="math inline">\(X_1= 3\)</span>, <span class="math inline">\(X_2= 5\)</span> et <span class="math inline">\(X_3 = 5\)</span> :</p>
<p><span class="math inline">\(\mbox{Prédiction} = \mbox{7 + 3}\times \mbox{0,5 + 5}\times \mbox{1,2 + 5}\times\mbox{1,8 = 23,5}\)</span></p>
<p>En revanche, simuler des données à partir d’un modèle revient à ajouter la dimension stochastique (aléatoire) du modèle. Puisque notre modèle GLM est gaussien, il comporte un paramètre <span class="math inline">\(\sigma\)</span> (son écart-type); admettons pour cet exemple qu’il soit de 1,2. Ainsi, avec les données précédentes, il est possible de simuler un ensemble infini de valeurs dont la distribution est la suivante : <span class="math inline">\(Normal(\mu = 23,5 \text{ , } \sigma = 1,2)\)</span>. 95 % du temps, ces valeurs simulées se trouveront dans l’intervalle <span class="math inline">\(\mbox{[21,1-25,9]}\)</span> (<span class="math inline">\(\mu - 2\sigma \text{; } \mu + 2\sigma\)</span>), puisque cette distribution est normale. Les valeurs simulées dépendent donc de la distribution choisie pour le modèle et de l’ensemble des paramètres du modèle, pas seulement de l’équation de régression.</p>
<p>Si vous aviez à ne retenir qu’une seule phrase de ce bloc, retenez que la prédiction ne se réfère qu’à la partie systématique du modèle (équation de régression), alors que la simulation incorpore la partie stochastique (aléatoire) de la distribution du modèle. Deux prédictions effectuées sur des données identiques donnent nécessairement des résultats identiques, ce qui n’est pas le cas pour la simulation.</p>
</div>
</div>
<div id="comparaison-des-prédictions-du-modèle-avec-les-valeurs-originales" class="section level4">
<h4><span class="header-section-number">8.1.5.3</span> Comparaison des prédictions du modèle avec les valeurs originales</h4>
<p>Les prédictions d’un modèle devraient être proches des valeurs réelles observées. Si ce n’est pas le cas, alors le modèle n’est pas fiable et ses paramètres ne sont pas informatifs. Dépendamment de la nature de la variable modélisée (quantitative ou qualitative), plusieurs approches peuvent être utilisées pour quantifier l’écart entre valeurs réelles et valeurs prédites.</p>
<div id="pour-une-variable-quantitative" class="section level5">
<h5><span class="header-section-number">8.1.5.3.1</span> Pour une variable quantitative</h5>
<p>La mesure la plus couramment utilisée pour une variable quantitative est l’erreur moyenne quadatrique (<em>Root Mean Square Error</em> – <em>RMSE</em> en anglais).</p>

<p><span class="math display">\[\begin{equation}
RMSE = \sqrt{\frac{\sum_{i=1}^n(y_i - \hat{y_i})^2}{n}}
(\#eq:glm11)
\end{equation}\]</span>
</p>
<p>Il s’agit de la racine carrée de la moyenne des écarts au carré entre valeurs réelles et prédites. Le <em>RMSE</em> est exprimé dans la même unité que la donnée originale et nous donne une indication sur l’erreur moyenne de la prédiction du modèle. Admettons, par exemple, que nous modélisions les niveaux de bruit environnemental en ville en décibels et que notre modèle de régression ait un <em>RMSE</em> de 3,5. Cela signifierait qu’en moyenne notre modèle se trompe de 3,5 décibels (erreur pouvant être négative ou positive) ce qui serait énorme (3 décibels correspond à une multiplication par deux de l’intensité sonore) et nous amènerait à reconsidérer la fiabilité du modèle. Notez que l’usage d’une moyenne quadratique plutôt qu’une moyenne arithmétique permet de donner plus d’impact aux larges erreurs et donc de pénaliser davantage des modèles faisant parfois de grosses erreurs de prédiction. Le <em>RMSE</em> est donc très sensible à la présence de valeurs aberrantes.
À la place de la moyenne quadratique, il est possible d’utiliser la simple moyenne arithmétique des valeurs absolues des erreurs (<em>MAE</em>). Cette mesure est cependant moins souvent utilisée :</p>

<p><span class="math display">\[\begin{equation}
MAE = \frac{\sum_{i=1}^n|y_i - \hat{y_i|}}{n}
(\#eq:glm12)
\end{equation}\]</span>
</p>
<p>Ces deux mesures peuvent être utilisées pour comparer la capacité de prédiction de deux modèles appliqués aux mêmes données, même s’ils ne sont pas imbriqués. Elles ne permettent cependant pas de prendre en compte de la complexité du modèle. Un modèle plus complexe aura toujours un <em>RMSE</em> et un <em>MAE</em> plus petits.</p>
</div>
<div id="pour-une-variable-qualitative" class="section level5">
<h5><span class="header-section-number">8.1.5.3.2</span> Pour une variable qualitative</h5>
<p>Lorsque l’on modélise une variable qualitative, une erreur revient à prédire la mauvaise catégorie pour une observation. Il est ainsi possible de compter, pour un modèle, le nombre de bonnes et de mauvaises prédictions et d’organiser cette information dans une <strong>matrice de confusion</strong>. Cette dernière prend la forme suivante pour un modèle binaire :</p>
<table>
<caption>
(#tab:confusmat1)Exemple de matrice de confusion
</caption>
<thead>
<tr>
<th style="text-align:left;">
Valeur prédite / Valeur réelle
</th>
<th style="text-align:right;">
A
</th>
<th style="text-align:right;">
B
</th>
<th style="text-align:right;">
Total (%)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
18 (41,9)
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
25 (51,1)
</td>
</tr>
<tr>
<td style="text-align:left;">
Total (%)
</td>
<td style="text-align:right;">
20 (46,6)
</td>
<td style="text-align:right;">
23 (53,5)
</td>
<td style="text-align:right;">
43 (81,4)
</td>
</tr>
</tbody>
</table>
<p>En colonne du tableau @ref(tab:confusmat1), nous avons les catégories observées et en ligne, les catégories prédites. La diagonale représente les prédictions correctes. Dans le cas présent, le modèle a bien catégorisé 35 (15 + 20) observations sur 43, soit une précision totale de 81,4 %; huit sont mal classifiées (18,6 %); cinq avec la modalité A ont été catégorisées comme des B, soit 20 % des A, et seuls trois B ont été catégorisées comme des A (13 %).</p>
<p>La matrice ci-dessus (tableau @ref(tab:confusmat1)) ne comporte que deux catégories possibles puisque la variable <em>Y</em> modélisée est binaire. Il est facile d’étendre le concept de matrice de confusion au cas des variables avec plus de deux modalités (multinomiale). Le tableau @ref(tab:confusmat2) est un exemple de matrice de confusion multinomiale.</p>
<table>
<caption>
(#tab:confusmat2)Exemple de matrice de confusion multinomiale
</caption>
<thead>
<tr>
<th style="text-align:left;">
Valeur prédite / Valeur réelle
</th>
<th style="text-align:right;">
A
</th>
<th style="text-align:right;">
B
</th>
<th style="text-align:right;">
C
</th>
<th style="text-align:right;">
D
</th>
<th style="text-align:right;">
Total (%)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
24 (18,7)
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
39 (30,4)
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
45 (35,2)
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
20 (15,6)
</td>
</tr>
<tr>
<td style="text-align:left;">
Total (%)
</td>
<td style="text-align:right;">
23 (18,1)
</td>
<td style="text-align:right;">
33 (25,7)
</td>
<td style="text-align:right;">
33 (25,7)
</td>
<td style="text-align:right;">
39 (30,5)
</td>
<td style="text-align:right;">
128
</td>
</tr>
</tbody>
</table>
<p>Trois mesures pour chaque catégorie peuvent être utilisées pour déterminer la capacité de prédiction du modèle :</p>
<ul>
<li>La précision (<em>precision</em> en anglais), soit le nombre de fois où une classe a été correctement prédite, divisée par le nombre de fois où la classe a été prédite.</li>
<li>Le rappel (<em>recall</em> en anglais), soit le nombre de fois où une classe a été correctement prédite divisée par le nombre de fois où elle se trouve dans les données originales.</li>
<li>Le score <em>F1</em> est la moyenne harmonique entre la précision et le rappel, soit :</li>
</ul>

<p><span class="math display">\[\begin{equation}
F1 = 2 \times \frac{\text{précision} \times \text{rappel}}{\text{précision} + \text{rappel}}
(\#eq:glm13)
\end{equation}\]</span>
</p>
<p>Il est possible de calculer les moyennes pondérées des différents indicateurs (macro-indicateurs) afin de disposer d’une valeur d’ensemble pour le modèle. La pondération est faite en fonction du nombre de cas observé de chaque catégorie; l’idée étant qu’il est moins grave d’avoir des indicateurs plus faibles pour des catégories moins fréquentes. Cependant, il est tout à fait possible que cette pondération ne soit pas souhaitable. C’est par exemple le cas dans de nombreuses études en santé portant sur des maladies rares où l’attention est concentrée sur ces catégories peu fréquentes.</p>
<p>Le <strong>coefficient de Kappa</strong> (variant de 0 à 1) peut aussi être utilisé pour quantifier la fidélité générale de la prédiction du modèle. Il est calculé avec l’équation @ref(eq:kappEq)</p>

<p><span class="math display">\[\begin{equation}
k = \frac{Pr(a)-Pr(e)}{1-Pr(e)}
(\#eq:kappEq)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(Pr(a)\)</span> la proportion d’accord entre les catégories observées et les catégories prédites, et <span class="math inline">\(Pr(e)\)</span> la probabilité d’un accord alétoire entre les catégories observées et les catégories prédites (équation @ref(eq:kappEq2)).</p>

<p><span class="math display">\[\begin{equation}
Pr(e) = \sum^{J}_{j=1} \frac{Cnt_{prédit}(j)}{n\times2} \times \frac{Cnt_{réel}(j)}{n\times2}
(\#eq:kappEq2)
\end{equation}\]</span>
</p>
<p>avec <em>n</em> le nombre d’observations, <span class="math inline">\(Cnt_{prédit}(j)\)</span> le nombre de fois où le modèle prédit la catégorie <em>j</em> et <span class="math inline">\(Cnt_{réel}(j)\)</span> le nombre de fois où la catégorie <em>j</em> a été observée.</p>
<p>Pour l’interprétation du coefficient de Kappa, référez-vous au tableau @ref(tab:Kappvals).</p>
<table>
<caption>
(#tab:Kappvals)Inteprétation des valeurs du coefficient de Kappa
</caption>
<thead>
<tr>
<th style="text-align:left;">
K
</th>
<th style="text-align:left;">
Interprétation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
&lt; 0
</td>
<td style="text-align:left;">
Désaccord
</td>
</tr>
<tr>
<td style="text-align:left;">
0 - 0,20
</td>
<td style="text-align:left;">
Accord très faible
</td>
</tr>
<tr>
<td style="text-align:left;">
0,21 - 0,40
</td>
<td style="text-align:left;">
Accord faible
</td>
</tr>
<tr>
<td style="text-align:left;">
0,41 - 0,60
</td>
<td style="text-align:left;">
Accord modéré
</td>
</tr>
<tr>
<td style="text-align:left;">
0,61 - 0,80
</td>
<td style="text-align:left;">
Accord fort
</td>
</tr>
<tr>
<td style="text-align:left;">
0,81 - 1
</td>
<td style="text-align:left;">
Accord presque parfait
</td>
</tr>
</tbody>
</table>
<p>Enfin, un test statistique basé sur la distribution binomiale peut être utilisé pour vérifier que le modèle atteint un niveau de précision supérieur au seuil de non-information. Ce seuil correspond à la proportion de la modalité la plus présente dans le jeu de données. Dans la matrice de confusion utilisée ci-dessus, ce seuil est de 30,5 % (catégorie D), ce qui signifie qu’un modèle prédisant tout le temps la catégorie D aurait une précision de 30,5 % pour cette catégorie. Il est donc nécessaire que notre modèle fasse mieux que ce seuil.</p>
<p>Dans le cas de la matrice de confusion du tableau @ref(tab:confusmat2), nous obtenons donc les valeurs affichées dans le tableau @ref(tab:confusIndic).</p>
<table>
<caption>
(#tab:confusIndic)Indicateurs de qualité de prédiction
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
précision
</th>
<th style="text-align:right;">
rappel
</th>
<th style="text-align:right;">
F1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
65,2
</td>
<td style="text-align:right;">
31,3
</td>
<td style="text-align:right;">
42,3
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
60,6
</td>
<td style="text-align:right;">
25,6
</td>
<td style="text-align:right;">
36,0
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
75,8
</td>
<td style="text-align:right;">
27,8
</td>
<td style="text-align:right;">
40,7
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
35,9
</td>
<td style="text-align:right;">
35,0
</td>
<td style="text-align:right;">
35,4
</td>
</tr>
<tr>
<td style="text-align:left;">
macro
</td>
<td style="text-align:right;">
57,8
</td>
<td style="text-align:right;">
30,0
</td>
<td style="text-align:right;">
38,2
</td>
</tr>
<tr>
<td style="text-align:left;">
Kappa
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Valeur de p (précision &gt; NIR)
</td>
<td style="text-align:right;">
&lt;0.0001
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
<p>À la lecture du tableau @ref(tab:confusIndic), nous remarquons que :</p>
<ul>
<li>la catégorie D est la moins bien prédite des quatre catégories (faible précision et faible rappel);</li>
<li>la catégorie C a une forte précision, mais un faible rappel, ce qui signifie que de nombreuses observations étant originalement des A, B ou D ont été prédites comme des C. Ce constat est également vrai pour la catégorie B;</li>
<li>le coefficient de Kappa indique un accord modéré entre les valeurs originales et la prédiction;</li>
<li>la probabilité que la précision du modèle ne dépasse pas le seuil de non-information est inférieure à 0,001, indiquant que le modèle à une précision supérieure à ce seuil.</li>
</ul>
</div>
</div>
</div>
<div id="sect0816" class="section level3">
<h3><span class="header-section-number">8.1.6</span> Comparaison de deux modèles GLM</h3>
<p>Tel qu’abordé dans le chapitre sur les régressions linéaires classiques, il est courant de comparer plusieurs modèles imbriqués (section @ref(sect0732)). Cette procédure permet de déterminer si l’ajout d’une ou de plusieurs variables contribue à significativement améliorer le modèle. Il est possible d’appliquer la même démarche aux GLM à l’aide du test de rapport de vraisemblance (<em>likelihood ratio test</em>). Le principe de base de ce test est de comparer le <em>likelihood</em> de deux modèles GLM imbriqués; la valeur de ce test se calcule avec l’équation suivante :</p>

<p><span class="math display">\[\begin{equation}
LR = 2(loglik(M_2) - loglik(M_1))
(\#eq:glm14)
\end{equation}\]</span>
</p>
<p>Avec <span class="math inline">\(M_2\)</span> un modèle reprenant toutes les variables du modèle <span class="math inline">\(M_1\)</span>, impliquant donc que <span class="math inline">\(loglik(M_2) &gt;= loglik(M_1))\)</span>.</p>
<p>Avec ce test, nous supposons que le modèle <span class="math inline">\(M_2\)</span> qui comporte plus de paramètres que le modèle <span class="math inline">\(M_1\)</span> devrait être mieux ajusté aux données. Si c’est bien le cas, la différence entre les <em>loglikelihood</em> de deux modèles devrait être supérieure à zéro. La valeur calculée <em>LR</em> suit une distribution du khi-deux avec un nombre de degrés de liberté égal au nombre de paramètres supplémentaires dans le modèle <span class="math inline">\(M_2\)</span> comparativement à <span class="math inline">\(M_1\)</span>. Avec ces deux informations, il est possible de déterminer la valeur de <em>p</em> associée à ce test et de déterminer si <span class="math inline">\(M_2\)</span> est significativement mieux ajusté que <span class="math inline">\(M_1\)</span> aux données. Notez qu’il existe aussi deux autres tests (test de Wald et test de Lagrange) ayant la même fonction. Il s’agit, dans les deux cas, d’approximation du test de rapport des vraisemblances dont la puissance statistique est inférieure au test de rapport de vraisemblance <span class="citation">(Neyman, Pearson et Pearson <a href="#ref-NeymanLemma" role="doc-biblioref">1933</a>)</span>.</p>
<p>Dans les prochaines sections, nous décrivons les modèles GLM les plus couramment utilisés. Il en existe de nombreuses variantes que nous ne pouvons pas toutes décrire ici. L’objectif est de comprendre les rouages de ces modèles afin de pouvoir, en cas de besoin, transposer ces connaissances sur des modèles plus spécifiques. Pour faciliter la lecture de ces sections, nous vous proposons une carte d’identité de chacun des modèles présentés. Elles contiennent l’ensemble des informations pertinentes à retenir pour chaque modèle.</p>
</div>
</div>
<div id="sect082" class="section level2">
<h2><span class="header-section-number">8.2</span> Modèles GLM pour des variables qualitatives</h2>
<p>Nous abordons en premier les principaux GLM utilisés pour modéliser des variables binaires, multinomiales et ordinales. Prenez bien le temps de saisir le fonctionnement du modèle logistique binomial, car il sert de base pour les trois autres modèles présentés.</p>
<div id="sect0821" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Modèle logistique binomial</h3>
<p>Le modèle logistique binomial est une généralisation du modèle de Bernoulli que nous avons présenté dans l’introduction de cette section. Le modèle logistique binomiale couvre donc deux cas de figure :</p>
<ol style="list-style-type: decimal">
<li>La variable observée est binaire (0 ou 1). Dans ce cas, le modèle logistique binomiale devient un simple modèle de Bernoulli.</li>
<li>La variable observée est un comptage (nombre de réussites) et nous disposons d’une autre variable avec le nombre de réplications de l’expérience. Par exemple, pour chaque intersection d’un réseau routier, nous pourrions avoir le nombre de décès à vélo (variable <em>Y</em> de comptage) et le nombre de collisions vélo / automobile (variable quantifiant le nombre d’expériences, chaque collision étant une expérience).
Spécifiquement, nous tentons de prédire le paramètre <em>p</em> de la distribution binomiale à l’aide de notre équation de régression et la fonction logistique comme fonction de lien. Notez ici que cette fonction de lien influence directement l’interprétation des paramètres du modèle. Pour rappel, cette fonction est définie comme :</li>
</ol>

<p><span class="math display">\[\begin{equation}
g(x) = ln(\frac{x}{1-x})
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(ln\)</span> le logarithme naturel.</p>
<p>Au-delà de sa propriété mathématique assurant que <span class="math inline">\(g(x) \in \mathopen[0,1\mathclose]\)</span>, cette fonction offre une interprétation intéressante. La partie <span class="math inline">\(\frac{x}{1-x}\)</span> est une cote et s’interprète en termes de chances d’observer un évènement. Par exemple, dans le cas des accidents des cyclistes, si la probabilité d’observer un décès suite à une collision est de 0,1, alors la cote de cet évènement est <span class="math inline">\(\frac{\frac{1}{10}}{\frac{9}{10}} = \frac{1}{9}\)</span> soit un contre neuf. Dans un modèle GLM logistique, les coefficients ajustés pour les variables indépendantes vont représenter des <strong>logarithmes de rapport de cote</strong>, car ils comparent les cotes d’observer l’évènement (y = 1) en fonction des valeurs des variables indépendantes.</p>
<table>
<caption>
(#tab:binomidentity)Carte d’identité du modèle logistique binomial
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable binaire (0 ou 1) ou comptage de réussite à une expérience (ex : 3 réussites sur 5 expériences)
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Binomiale
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim Binomial(p)\)</span> <br/> <span class="math inline">\(g(p) = \beta_0 + \beta X\)</span> <br/> <span class="math inline">\(g(x) = log(\frac{x}{1-x})\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
logistique
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
p
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
Non séparation complète. Absence de sur-dispersion ou sous-dispersion
</td>
</tr>
</tbody>
</table>
<div id="interprétation-des-paramètres" class="section level4">
<h4><span class="header-section-number">8.2.1.1</span> Interprétation des paramètres</h4>
<p>Les seuls paramètres à estimer du modèle sont les coefficients <span class="math inline">\(\beta\)</span> et la constante <span class="math inline">\(\beta_0\)</span>. La fonction de lien logistique transforme la valeur de ces coefficients, en conséquence, <strong>ils ne peuvent plus être interprétés directement</strong>. <span class="math inline">\(\beta_0\)</span> et <span class="math inline">\(\beta\)</span> sont exprimés dans une unité particulière: des logarithmes de rapports de cote (<em>log odd ratio</em>). Le rapport de cote est relativement facile à interpréter contrairement à son logarithme. Pour l’obtenir, il suffit d’utiliser la fonction exponentielle (l’inverse de la fonction logarithme) pour passer des log rapport de cote à de simples rapports de cote.
Donc si <span class="math inline">\(exp(\beta)\)</span> est inférieur à 1, il réduit les chances d’observer l’évènement et inversement si <span class="math inline">\(exp(\beta)\)</span> est supérieur à 1.</p>
<p>Par exemple, admettons que nous ayons eu un coefficient <span class="math inline">\(\beta_1\)</span> de 1,2 pour une variable <span class="math inline">\(X_1\)</span> dans une régression logistique. Il est nécessaire d’utiliser son exponentiel pour l’interpréter de façon intuitive. <span class="math inline">\(\mbox{exp(1,2)} = \mbox{3,32}\)</span>, ce qui signifie que lorsque <span class="math inline">\(X_1\)</span> augmente d’une unité, les chances d’observer 1 plutôt que 0 comme valeur de <em>Y</em> sont multipliées par 3,32. Admettons maintenant que <span class="math inline">\(\beta_1\)</span> vaille −1,2, nous calculons donc <span class="math inline">\(\mbox{exp(-1,2) = 0,30}\)</span>, ce qui signifie qu’à chaque augmentation d’une unité de <span class="math inline">\(X_1\)</span>, les chances d’observer 1 plutôt que 0 comme valeur de <em>Y</em> sont multipliées par 0,30. En d’autres termes,les chances d’observer 1 plutôt que 0 sont divisées par 3,33 (<span class="math inline">\(\mbox{1}/\mbox{0,30} = \mbox{3,33}\)</span>), soit une diminution de 70 % (<span class="math inline">\(\mbox{1}-\mbox{0,3} = \mbox{0,7}\)</span>) des chances d’observer 1 plutôt que 0.</p>
<div class="bloc_aller_loin">
<p><strong>Les rapports de cotes</strong></p>
<p>Le rapport de cote ou rapport des chances est une mesure utilisée pour exprimer l’effet d’un facteur sur une probabilité. Il est très utilisé dans le domaine de la santé, mais aussi des paris. Prenons un exemple concret avec le port du casque à vélo. Si sur 100 accidents impliquant des cyclistes portant un casque, nous observons seulement 3 cas de blessures graves à la tête, contre 15 dans un second groupe de 100 cyclistes ne portant pas de casque, nous pouvons calculer le rapport de cote suivant :</p>
<p><span class="math display">\[\begin{equation}
\frac{p(1-q)}{q(1-p)} = \frac{0,15 \times (1-0,03)}{0,03 \times (1-0,15)} = 5,71
\end{equation}\]</span>
</p>
<p>avec <em>p</em> la probabilité d’observer le phénomène (ici la blessure grave à la tête) dans le groupe 1 (ici les cyclistes sans casque) et <em>q</em> la probabilité d’observer le phénomène dans le groupe 2 (ici les cyclistes avec un casque). Ce rapport de cote indique que les cyclistes sans casques ont 5,71 fois plus de chances de se blesser gravement à la tête lors d’un accident comparativement à celles et ceux portant un casque.</p>
</div>
</div>
<div id="sectcondapp" class="section level4">
<h4><span class="header-section-number">8.2.1.2</span> Conditions d’application</h4>
<p>La non-séparation complète signifie qu’aucune des variables <em>X</em> n’est, à elle seule, capable de parfaitement distinguer les deux catégories 0 et 1 de la variable <em>Y</em>. Dans un tel cas de figure, les algorithmes d’ajustement utilisés pour estimer les paramètres des modèles sont incapables de converger. Notez aussi l’absurdité de créer un modèle pour prédire une variable <em>Y</em> si une variable <em>X</em> est capable à elle seule de la prédire à coup sûr. Ce problème est appelé un effet de Hauck-Donner. Il est assez facile de le repérer, car la plupart du temps les fonctions de R signalent ce problème (message d’erreur sur la convergence). Sinon, des valeurs extrêmement élevées ou faibles pour certains rapports de cote peuvent aussi indiquer un effet de Hauck-Donner.</p>
<p>La sur-dispersion est un problème spécifique aux distributions n’ayant pas de paramètre de dispersion (binomiale, Poisson, exponentielle, etc.), pour lesquelles la variance dépend directement de l’espérance. La sur-dispersion désigne une situation dans laquelle les résidus (ou erreurs) d’un modèle sont plus dispersés que ce que suppose la distribution utilisée. À l’inverse, il est aussi possible (mais rare) d’observer des cas de sous-dispersion (lorsque la dispersion des résidus est plus petite que ce que suppose la distribution choisie). Ce cas de figure se produit généralement lorsque le modèle parvient à réaliser une prédiction trop précise pour être crédible. Si vous rencontrez une forte sous-dispersion, cela signifie souvent que l’une de vos variables indépendantes provoque une séparation complète. La meilleure option dans ce cas est de supprimer la variable en question du modèle. La variance attendue d’une distribution binomiale est <span class="math inline">\(nb \times p \times(1-p)\)</span>, soit le produit entre le nombre de tirages, la probabilité de réussite et la probabilité d’échec. À titre d’exemple, si nous considérons une distribution binomiale avec un seul tirage et 50 % de chances de réussite, sa variance serait : <span class="math inline">\(1 \times \mbox{0,5} \times \mbox{(1-0,5) = 0,25}\)</span>.</p>
<p>Plusieurs raisons peuvent expliquer la présence de sur-dispersion dans une modèle:</p>
<ul>
<li>il manque des variables importantes dans le modèle, conduisant à un mauvais ajustement et donc une sur-dispersion des erreurs;</li>
<li>les observations ne sont pas indépendantes, impliquant qu’une partie de la variance n’est pas contrôlée et augmente les erreurs;</li>
<li>la probabilité de succès de chaque expérience varie d’une répétition à l’autre (différentes distributions).</li>
</ul>
<p>La conséquence directe de la sur-dispersion est la sous-estimation de la variance des coefficients de régression. En d’autres termes, la sur-dispersion conduit à sous-estimer notre incertitude quant aux coefficients obtenus et réduit les valeurs de <em>p</em> calculées pour ces coefficients. Les risques de trouver des résultats significatifs à cause des fluctuations d’échantillonnage augmentent.</p>
<p>Pour détecter de la sur-dispersion ou de la sous-dispersion dans un modèle logistique binomial, il est possible d’observer les résidus de déviance du modèle. Ces derniers sont supposés suivre une distribution du khi-deux avec <em>n−k</em> degrés de liberté (avec <em>n</em> le nombre d’observations et <em>k</em> le nombre de coefficients dans le modèle). Par conséquent, la somme des résidus de déviance d’un modèle logistique binomiale divisée par le nombre de degrés de liberté devrait être proche de 1. Une légère déviation (jusqu’à 0,15 au-dessus ou au-dessous de 1) n’est pas alarmante, au-delà, il est nécessaire d’ajuster le modèle.</p>
<p>Notez que si la variable <em>Y</em> modélisée est exactement binaire (chaque expérience est indépendante et n’est composée que d’un seul tirage) et que le modèle utilise donc une distribution de Bernoulli, le test précédent pour détecter une éventuelle sur-dispersion n’est pas valide. <span class="citation">Hilbe (<a href="#ref-hilbe2009logistic" role="doc-biblioref">2009</a>)</span> parle de sur-dispersion implicite pour le modèle de Bernoulli et recommande notamment de toujours ajuster les erreurs standards des modèles utilisant des distributions de Bernoulli, binomiale et Poisson. L’idée ici est d’éviter d’être trop optimiste face à l’incertitude du modèle sur les coefficients et de l’ajuster en conséquence. Pour cela, il est possible d’utiliser des quasi-distributions, ou des estimateurs robustes <span class="citation">(Zeileis <a href="#ref-zeileis2004econometric" role="doc-biblioref">2004</a>)</span>. Notez que si le modèle ne souffrait pas de sur ou sous-dispersion, ces ajustements produisent des résultats équivalents aux résultats non ajustés.</p>
</div>
<div id="sectexemplebinom" class="section level4">
<h4><span class="header-section-number">8.2.1.3</span> Exemple appliqué dans R</h4>
<p><strong>Présentation des données</strong></p>
<p>Pour illustrer le modèle logistique binomial, nous utilisons ici un jeu de données proposé par l’Union européenne : <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/P82V9X">l’enquête de déplacement sur la demande pour des systèmes de transports innovants</a>. Pour cette enquête, un échantillon de 1 000 individus représentatifs de la population a été constitué dans chacun des 26 États membres de l’UE, soit un total de 26 000 observations. Pour chaque individu, plusieurs informations ont été collectées relatives à la catégorie socioprofessionnelle, le mode de transport le plus fréquent, le temps du trajet de son déplacement le plus fréquent et son niveau de sensibilité à la cause environnementale. Nous modélisons ici la probabilité qu’un individu déclare utiliser le plus fréquemment le vélo comme moyen de transport. Les variables explicatives sont résumées au tableau @ref(tab:binomdata). Il existe bien évidemment un grand nombre de facteurs au niveau individuel qui impacte la prise de décision sur le mode de transport. Les résultats de ce modèle ne doivent donc pas être pris avec un grand sérieux; il est uniquement construit à des fins pédagogiques, sans cadre conceptuel solide.</p>
<table>
<caption>
(#tab:binomdata)Variables indépendantes utilisées pour prédire le mode de transport le plus utilisé
</caption>
<thead>
<tr>
<th style="text-align:left;">
Nom de la variable
</th>
<th style="text-align:left;">
Signification
</th>
<th style="text-align:left;">
Type de variable
</th>
<th style="text-align:left;">
Mesure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Pays
</td>
<td style="text-align:left;">
Pays de résidence
</td>
<td style="text-align:left;">
Variable multinomiale
</td>
<td style="text-align:left;">
Le nom d’un des 26 pays membres de l’UE
</td>
</tr>
<tr>
<td style="text-align:left;">
Sexe
</td>
<td style="text-align:left;">
Sexe biologique
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
Homme ou Femme
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:left;">
Âge biologique
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
L’âge en nombre d’années variant de 16 à 84 ans dans le jeu de données
</td>
</tr>
<tr>
<td style="text-align:left;">
Education
</td>
<td style="text-align:left;">
Niveau d’éducation maximum atteint
</td>
<td style="text-align:left;">
Variable multinomiale
</td>
<td style="text-align:left;">
Premier cycle, secondaire inférieur (classes supérieures de l’école élémentaire), secondaire, troisième cycle
</td>
</tr>
<tr>
<td style="text-align:left;">
StatutEmploi
</td>
<td style="text-align:left;">
Employé ou non
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
Employé ou non
</td>
</tr>
<tr>
<td style="text-align:left;">
Revenu
</td>
<td style="text-align:left;">
Niveau de revenu autodéclaré
</td>
<td style="text-align:left;">
Variable multinomiale
</td>
<td style="text-align:left;">
Très faible revenu, faible revenu, revenu moyen, revenu élevé, revenu très élevé, sans reponse
</td>
</tr>
<tr>
<td style="text-align:left;">
Residence
</td>
<td style="text-align:left;">
Lieu de résidence
</td>
<td style="text-align:left;">
Variable multinomiale
</td>
<td style="text-align:left;">
Zone rurale, petite ou moyenne ville (moins de 250 000 habitants), grande ville (entre 250 000 et 1 million d’habitants) , aire métropolitaine (plus d’un million d’habitants)
</td>
</tr>
<tr>
<td style="text-align:left;">
Duree
</td>
<td style="text-align:left;">
Durée du voyage le plus fréquent autodéclarée (en minutes)
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Nombre de minutes
</td>
</tr>
<tr>
<td style="text-align:left;">
ConsEnv
</td>
<td style="text-align:left;">
Préoccupation environnementale
</td>
<td style="text-align:left;">
Variable ordinale
</td>
<td style="text-align:left;">
Échelle de Likert de 1 à 10
</td>
</tr>
</tbody>
</table>
<p><strong>Vérification des conditions d’application</strong></p>
<p>La première étape de la vérification des conditions d’application est de calculer les valeurs du facteur d’inflation de variance (VIF) pour s’assurer de l’absence de multicolinéarité trop forte entre les variables indépendantes. L’ensemble des valeurs de VIF sont inférieures à 5, indiquant l’absence de multicolinéarité excessive dans le modèle.</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb762-1"><a href="#cb762-1"></a><span class="kw">library</span>(car)</span>
<span id="cb762-2"><a href="#cb762-2"></a><span class="co"># Chargement des données</span></span>
<span id="cb762-3"><a href="#cb762-3"></a>dfenquete &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/glm/enquete_transport_UE.csv&quot;</span>, <span class="dt">encoding =</span> <span class="st">&#39;UTF-8&#39;</span>)</span>
<span id="cb762-4"><a href="#cb762-4"></a>dfenquete<span class="op">$</span>Pays &lt;-<span class="st"> </span><span class="kw">relevel</span>(<span class="kw">as.factor</span>(dfenquete<span class="op">$</span>Pays), <span class="dt">ref =</span> <span class="st">&quot;Allemagne&quot;</span>)</span>
<span id="cb762-5"><a href="#cb762-5"></a><span class="co"># Vérification du VIF</span></span>
<span id="cb762-6"><a href="#cb762-6"></a>model1 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span></span>
<span id="cb762-7"><a href="#cb762-7"></a><span class="st">              </span>Pays <span class="op">+</span><span class="st"> </span>Sexe <span class="op">+</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>StatutEmploi <span class="op">+</span><span class="st"> </span>Revenu <span class="op">+</span></span>
<span id="cb762-8"><a href="#cb762-8"></a><span class="st">              </span>Residence <span class="op">+</span><span class="st"> </span>Duree <span class="op">+</span><span class="st"> </span>ConsEnv,</span>
<span id="cb762-9"><a href="#cb762-9"></a>            <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb762-10"><a href="#cb762-10"></a>            <span class="dt">data =</span> dfenquete</span>
<span id="cb762-11"><a href="#cb762-11"></a>)</span>
<span id="cb762-12"><a href="#cb762-12"></a><span class="kw">vif</span>(model1)</span></code></pre></div>
<pre><code>##                  GVIF Df GVIF^(1/(2*Df))
## Pays         1.794797 27        1.010890
## Sexe         1.028618  1        1.014208
## Age          1.060256  1        1.029687
## Education    1.428872  3        1.061285
## StatutEmploi 1.151879  1        1.073256
## Revenu       1.220934  5        1.020162
## Residence    1.130526  3        1.020658
## Duree        1.042638  1        1.021096
## ConsEnv      1.090987  1        1.044503</code></pre>
<p>La seconde étape de vérification est le calcul des distances de Cook et l’identification d’éventuelles valeurs aberrantes (figure @ref(fig:cookdistGLMbinom)).</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb764-1"><a href="#cb764-1"></a><span class="co"># Calcul et représentation des distances de Cook</span></span>
<span id="cb764-2"><a href="#cb764-2"></a>cookd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb764-3"><a href="#cb764-3"></a>  <span class="dt">dist =</span> <span class="kw">cooks.distance</span>(model1),</span>
<span id="cb764-4"><a href="#cb764-4"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dfenquete)</span>
<span id="cb764-5"><a href="#cb764-5"></a>)</span>
<span id="cb764-6"><a href="#cb764-6"></a><span class="kw">ggplot</span>(cookd) <span class="op">+</span><span class="st"> </span></span>
<span id="cb764-7"><a href="#cb764-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> dist ), <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>), <span class="dt">size =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb764-8"><a href="#cb764-8"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.002</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb764-9"><a href="#cb764-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;observations&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;distance de Cook&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb764-10"><a href="#cb764-10"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb764-11"><a href="#cb764-11"></a>        <span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cookdistGLMbinom-1.png" alt="Distances de Cook pour le modèle binomial avec toutes les observations" width="60%" />
<p class="caption">
(#fig:cookdistGLMbinom)Distances de Cook pour le modèle binomial avec toutes les observations
</p>
</div>
<p>Le calcul de la distance de Cook révèle un ensemble d’observations se démarquant nettement des autres (délimitées dans la figure @ref(fig:cookdistGLMbinom) par la ligne rouge). Nous les isolons dans un premier temps pour les analyser.</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="#cb765-1"></a><span class="co"># Isoler les observations avec de très fortes valeurs de Cook</span></span>
<span id="cb765-2"><a href="#cb765-2"></a><span class="co"># valeur seuil choisie : 0,002</span></span>
<span id="cb765-3"><a href="#cb765-3"></a>cas_etranges &lt;-<span class="st"> </span><span class="kw">subset</span>(dfenquete, cookd<span class="op">$</span>dist<span class="op">&gt;=</span><span class="fl">0.002</span>)</span>
<span id="cb765-4"><a href="#cb765-4"></a><span class="kw">cat</span>(<span class="kw">nrow</span>(cas_etranges),<span class="st">&#39;observations se démarquant dans le modèle&#39;</span>)</span></code></pre></div>
<pre><code>## 19 observations se démarquant dans le modèle</code></pre>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="#cb767-1"></a><span class="kw">print</span>(cas_etranges)</span></code></pre></div>
<pre><code>##           X y       Pays  Sexe Age            Education Statut_emploi
## 7660   7660 1  Slovaquie homme  50           universite      Employed
## 25150 25150 1      Malte homme  16           secondaire  Not Employed
## 25227 25227 1      Malte femme  53 secondaire inferieur  Not Employed
## 25309 25309 1      Malte femme  32           secondaire      Employed
## 25322 25322 1      Malte homme  38           universite      Employed
## 25536 25536 1      Malte homme  27           universite      Employed
## 25541 25541 1      Malte homme  38 secondaire inferieur      Employed
## 25549 25549 1      Malte homme  31           universite      Employed
## 25690 25690 1 Luxembourg homme  32           universite      Employed
## 26190 26190 1     Chypre homme  24           secondaire  Not Employed
## 26201 26201 1     Chypre homme  25           secondaire      Employed
## 26244 26244 1     Chypre homme  32           secondaire      Employed
## 26269 26269 1     Chypre homme  60           secondaire  Not Employed
## 26303 26303 1     Chypre homme  59           secondaire  Not Employed
## 26393 26393 1     Chypre homme  30        premier cycle      Employed
## 26444 26444 1     Chypre femme  52           universite      Employed
## 26516 26516 1     Chypre homme  21           universite  Not Employed
## 26549 26549 1     Chypre homme  28           universite      Employed
## 26600 26600 1     Chypre homme  36           secondaire      Employed
##             Revenu            Residence Duree mode_pref StatutEmploi ConsEnv
## 7660         moyen          zone rurale   775      velo      employe       7
## 25150        moyen          zone rurale    15      velo  sans emploi       3
## 25227        moyen          zone rurale    45    marche  sans emploi       5
## 25309        moyen petite-moyenne ville    25    marche      employe       4
## 25322        eleve          zone rurale    30    marche      employe      10
## 25536   tres eleve petite-moyenne ville    14      velo      employe      10
## 25541        moyen          zone rurale     5    marche      employe       8
## 25549 sans reponse petite-moyenne ville    60      velo      employe      10
## 25690   tres eleve petite-moyenne ville   720      velo      employe       6
## 26190        moyen         grande ville    20      velo  sans emploi       5
## 26201       faible          zone rurale    20      velo      employe       5
## 26244  tres faible petite-moyenne ville    18      velo      employe       4
## 26269        moyen petite-moyenne ville     5      velo  sans emploi       7
## 26303        moyen          zone rurale     7      velo  sans emploi       8
## 26393   tres eleve petite-moyenne ville    61      velo      employe       5
## 26444        eleve petite-moyenne ville   120      velo      employe       3
## 26516        moyen petite-moyenne ville    25      velo  sans emploi       8
## 26549  tres faible petite-moyenne ville    15      velo      employe       2
## 26600        moyen petite-moyenne ville     8      velo      employe       1</code></pre>
<p>À la lecture des valeurs pour ces 19 cas étranges, nous remarquons que la plupart des observations proviennent de Malte et de Chypre. Ces deux petites îles constituent des cas particuliers en Europe et devraient vraisemblablement faire l’objet d’une analyse séparée. Nous décidons donc de les retirer du jeu de données. Deux autres observations étranges sont observables en Slovaquie et au Luxembourg. Dans les deux cas, les répondants ont renseigné des temps de trajet fantaisistes de respectivement 775 et 720 minutes. Nous les retirons donc également de l’analyse.</p>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="#cb769-1"></a><span class="co"># Retirer les observations aberrantes</span></span>
<span id="cb769-2"><a href="#cb769-2"></a>dfenquete2 &lt;-<span class="st"> </span><span class="kw">subset</span>(dfenquete, (dfenquete<span class="op">$</span>Pays <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Malte&quot;</span>, <span class="st">&quot;Chypre&quot;</span>)) <span class="op">==</span><span class="st"> </span>F <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb769-3"><a href="#cb769-3"></a><span class="st">                  </span>dfenquete<span class="op">$</span>Duree <span class="op">&lt;</span><span class="st"> </span><span class="dv">400</span>)</span>
<span id="cb769-4"><a href="#cb769-4"></a><span class="co"># Réajuster le modèle</span></span>
<span id="cb769-5"><a href="#cb769-5"></a>model2 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span></span>
<span id="cb769-6"><a href="#cb769-6"></a><span class="st">              </span>Pays <span class="op">+</span><span class="st"> </span>Sexe <span class="op">+</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>StatutEmploi <span class="op">+</span><span class="st"> </span>Revenu <span class="op">+</span></span>
<span id="cb769-7"><a href="#cb769-7"></a><span class="st">              </span>Residence <span class="op">+</span><span class="st"> </span>Duree <span class="op">+</span><span class="st"> </span>ConsEnv,</span>
<span id="cb769-8"><a href="#cb769-8"></a>            <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb769-9"><a href="#cb769-9"></a>            <span class="dt">data =</span> dfenquete2)</span>
<span id="cb769-10"><a href="#cb769-10"></a><span class="co"># Recalculer la distance de Cook</span></span>
<span id="cb769-11"><a href="#cb769-11"></a>cookd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb769-12"><a href="#cb769-12"></a>  <span class="dt">dist =</span> <span class="kw">cooks.distance</span>(model2),</span>
<span id="cb769-13"><a href="#cb769-13"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dfenquete2)</span>
<span id="cb769-14"><a href="#cb769-14"></a>)</span>
<span id="cb769-15"><a href="#cb769-15"></a><span class="kw">ggplot</span>(cookd) <span class="op">+</span><span class="st"> </span></span>
<span id="cb769-16"><a href="#cb769-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> dist ), <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>), <span class="dt">size =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb769-17"><a href="#cb769-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;observations&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;distance de Cook&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb769-18"><a href="#cb769-18"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb769-19"><a href="#cb769-19"></a>        <span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cookdistGLMbinom2-1.png" alt="Distances de Cook pour le modèle binomial sans les valeurs aberrantes" width="60%" />
<p class="caption">
(#fig:cookdistGLMbinom2)Distances de Cook pour le modèle binomial sans les valeurs aberrantes
</p>
</div>
<p>Après avoir retiré ces valeurs aberrantes, nous n’observons plus de nouveaux cas singuliers avec les distances de Cook (figure @ref(fig:cookdistGLMbinom2)).</p>
<p>La prochaine étape de vérification des conditions d’application est l’analyse des résidus simulés. Nous commençons donc par calculer ces résidus et afficher leur histogramme (figure @ref(fig:figresidsimbinomHistoUnif)).</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="#cb770-1"></a><span class="kw">library</span>(DHARMa)</span>
<span id="cb770-2"><a href="#cb770-2"></a><span class="co"># Extraire les probabilités prédites par le modèle</span></span>
<span id="cb770-3"><a href="#cb770-3"></a>probs &lt;-<span class="st"> </span><span class="kw">predict</span>(model2, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb770-4"><a href="#cb770-4"></a><span class="co"># Calculer 1000 simulations a partir du modele ajuste</span></span>
<span id="cb770-5"><a href="#cb770-5"></a>sims &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(probs), <span class="cf">function</span>(i){</span>
<span id="cb770-6"><a href="#cb770-6"></a>  p &lt;-<span class="st"> </span>probs[[i]]</span>
<span id="cb770-7"><a href="#cb770-7"></a>  vals &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">size =</span> <span class="dv">1</span>,<span class="dt">prob =</span> p)</span>
<span id="cb770-8"><a href="#cb770-8"></a>})</span>
<span id="cb770-9"><a href="#cb770-9"></a>matsim &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind,sims)</span>
<span id="cb770-10"><a href="#cb770-10"></a><span class="co"># Utiliser le package DHARMa pour calculer les résidus simulés</span></span>
<span id="cb770-11"><a href="#cb770-11"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> matsim, </span>
<span id="cb770-12"><a href="#cb770-12"></a>                            <span class="dt">observedResponse =</span> dfenquete2<span class="op">$</span>y,</span>
<span id="cb770-13"><a href="#cb770-13"></a>                            <span class="dt">fittedPredictedResponse =</span> probs,</span>
<span id="cb770-14"><a href="#cb770-14"></a>                            <span class="dt">integerResponse =</span> T)</span>
<span id="cb770-15"><a href="#cb770-15"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb770-16"><a href="#cb770-16"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">residuals</span>(sim_res)),</span>
<span id="cb770-17"><a href="#cb770-17"></a>                 <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.3</span>,<span class="fl">0.3</span>,<span class="fl">0.3</span>))<span class="op">+</span></span>
<span id="cb770-18"><a href="#cb770-18"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;résidus simulés&quot;</span>, <span class="dt">y=</span><span class="st">&quot;fréquence&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figresidsimbinomHistoUnif-1.png" alt="Distribution des résidus simulé pour le modèle binomial" width="60%" />
<p class="caption">
(#fig:figresidsimbinomHistoUnif)Distribution des résidus simulé pour le modèle binomial
</p>
</div>
<p>L’histogramme indique clairement que les résidus simulés suivent une distribution uniforme (figure @ref(fig:figresidsimbinomHistoUnif)). Il est possible d’aller plus loin dans le diagnostic en utilisant la fonction <code>plot</code> sur l’objet <code>sim_res</code>. La partie de droite de la figure ainsi obtenue (figure @ref(fig:figresidsimbinom)) est un diagramme de quantiles-quantiles (ou Q-Q plot). Les points du graphique sont supposés suivre une ligne droite matérialisée par la ligne rouge. Une déviation de cette ligne indique un éloignement des résidus de leur distribution attendue. Trois tests sont également réalisés par la fonction :</p>
<ul>
<li>Le premier (Test de Kolmogorov-Smirnov, <em>KS test</em>) permet de tester si les points dévient significativement de la ligne droite. Dans notre cas, la valeur de <em>p</em> n’est pas significative, indiquant que les résidus ne dévient pas de la distribution uniforme.</li>
<li>Le second test permet de vérifier la présence de sur ou sous-dispersion. Dans notre cas, ce test n’est pas significatif, n’indiquant aucun problème de sur-dispersion ou sous-dispersion.</li>
<li>Le dernier test permet de vérifier si des valeurs aberrantes sont présentes dans les résidus. Une valeur non significative indique une absence de valeurs aberrantes.</li>
</ul>
<p>Le second graphique permet de comparer les résidus et les valeurs prédites. L’idéal est donc d’observer une ligne droite horizontale au milieu du graphique qui indiquerait une absence de relation entre les valeurs prédites et les résidus (ce que nous observons bien ici).</p>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="#cb771-1"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/glm/figresidsimbinom.png" alt="Diagnostic des résidus simulés par le *package* DHARMa" width="100%" />
<p class="caption">
(#fig:figresidsimbinom)Diagnostic des résidus simulés par le <em>package</em> DHARMa
</p>
</div>
<p>L’analyse approfondie des résidus nous permet donc de conclure que le modèle respecte les conditions d’application et que nous pouvons passer à la vérification de la qualité d’ajustement du modèle.</p>
<p><strong>Vérification de la qualité d’ajustement</strong></p>
<p>Pour calculer les différents R<sup>2</sup> d’un modèle GLM, nous proposons la fonction suivante :</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb772-1"><a href="#cb772-1"></a>rsqs &lt;-<span class="st"> </span><span class="cf">function</span>(loglike.full, loglike.null,full.deviance, null.deviance, nb.params, n){</span>
<span id="cb772-2"><a href="#cb772-2"></a>  <span class="co"># Calcul de la déviance expliquée</span></span>
<span id="cb772-3"><a href="#cb772-3"></a>  explained_dev &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">-</span>(full.deviance <span class="op">/</span><span class="st"> </span>null.deviance)</span>
<span id="cb772-4"><a href="#cb772-4"></a>  K &lt;-<span class="st"> </span>nb.params</span>
<span id="cb772-5"><a href="#cb772-5"></a>  <span class="co"># R2 de McFadden ajusté</span></span>
<span id="cb772-6"><a href="#cb772-6"></a>  r2_faddenadj &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">-</span><span class="st"> </span>(loglike.full <span class="op">-</span><span class="st"> </span>K) <span class="op">/</span><span class="st"> </span>loglike.null</span>
<span id="cb772-7"><a href="#cb772-7"></a>  Lm &lt;-<span class="st"> </span>loglike.full</span>
<span id="cb772-8"><a href="#cb772-8"></a>  Ln &lt;-<span class="st"> </span>loglike.null</span>
<span id="cb772-9"><a href="#cb772-9"></a>  <span class="co"># R2 de Cox and Snell</span></span>
<span id="cb772-10"><a href="#cb772-10"></a>  Rcs &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>((<span class="op">-</span><span class="dv">2</span><span class="op">/</span>n) <span class="op">*</span><span class="st"> </span>(Lm<span class="op">-</span>Ln))</span>
<span id="cb772-11"><a href="#cb772-11"></a>  <span class="co"># R2 de Nagelkerke</span></span>
<span id="cb772-12"><a href="#cb772-12"></a>  Rn &lt;-<span class="st"> </span>Rcs <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span><span class="kw">exp</span>(<span class="dv">2</span><span class="op">*</span>Ln<span class="op">/</span>n))</span>
<span id="cb772-13"><a href="#cb772-13"></a>  <span class="kw">return</span>(</span>
<span id="cb772-14"><a href="#cb772-14"></a>    <span class="kw">list</span>(<span class="st">&quot;deviance expliquee&quot;</span> =<span class="st"> </span>explained_dev,</span>
<span id="cb772-15"><a href="#cb772-15"></a>         <span class="st">&quot;McFadden ajuste&quot;</span> =<span class="st"> </span>r2_faddenadj,</span>
<span id="cb772-16"><a href="#cb772-16"></a>         <span class="st">&quot;Cox and Snell&quot;</span> =<span class="st"> </span>Rcs,</span>
<span id="cb772-17"><a href="#cb772-17"></a>         <span class="st">&quot;Nagelkerke&quot;</span> =<span class="st"> </span>Rn</span>
<span id="cb772-18"><a href="#cb772-18"></a>    )</span>
<span id="cb772-19"><a href="#cb772-19"></a>  )</span>
<span id="cb772-20"><a href="#cb772-20"></a>}</span></code></pre></div>
<p>Nous l’utiliserons pour l’ensemble des modèles GLM de ce chapitre. Dans le cas du modèle binomial, nous obtenons :</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="#cb773-1"></a><span class="co"># Ajuster un modele null avec seulement une constante</span></span>
<span id="cb773-2"><a href="#cb773-2"></a>model2.null &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="dv">1</span>,</span>
<span id="cb773-3"><a href="#cb773-3"></a>            <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb773-4"><a href="#cb773-4"></a>            <span class="dt">data =</span> dfenquete2)</span>
<span id="cb773-5"><a href="#cb773-5"></a><span class="co"># Calculer les R2</span></span>
<span id="cb773-6"><a href="#cb773-6"></a><span class="kw">rsqs</span>(<span class="dt">loglike.full =</span> <span class="kw">as.numeric</span>(<span class="kw">logLik</span>(model2)), <span class="co"># loglikelihood du modèle complet</span></span>
<span id="cb773-7"><a href="#cb773-7"></a>     <span class="dt">loglike.null =</span> <span class="kw">as.numeric</span>(<span class="kw">logLik</span>(model2.null)), <span class="co"># loglikelihood du modèle nul</span></span>
<span id="cb773-8"><a href="#cb773-8"></a>     <span class="dt">full.deviance =</span> <span class="kw">deviance</span>(model2), <span class="co"># déviance du modèle complet</span></span>
<span id="cb773-9"><a href="#cb773-9"></a>     <span class="dt">null.deviance =</span> <span class="kw">deviance</span>(model2.null), <span class="co"># déviance du modèle nul</span></span>
<span id="cb773-10"><a href="#cb773-10"></a>     <span class="dt">nb.params =</span> model2<span class="op">$</span>rank, <span class="co"># nombre de paramètres dans le modèle</span></span>
<span id="cb773-11"><a href="#cb773-11"></a>     <span class="dt">n =</span> <span class="kw">nrow</span>(dfenquete2) <span class="co"># nombre d&#39;observations</span></span>
<span id="cb773-12"><a href="#cb773-12"></a>     )</span></code></pre></div>
<pre><code>## $`deviance expliquee`
## [1] 0.0876057
## 
## $`McFadden ajuste`
## [1] 0.08357379
## 
## $`Cox and Snell`
## [1] 0.0689509
## 
## $Nagelkerke
## [1] 0.1236597</code></pre>
<p>La déviance expliquée par le modèle est de 8,8 %, les pseudos R<sup>2</sup> de McFadden (ajusté), Efron et Nagelkerke sont respectivement 0,084, 0,069 et 0,124. L’ensemble de ces valeurs sont relativement faibles et indiquent qu’une large partie de la variabilité de <em>Y</em> reste inexpliquée.</p>
<p>Pour vérifier la qualité de prédiction du modèle, nous devons comparer les catégories prédites et les catégories réelles de notre variable dépendante et construire une matrice de confusion. Cependant, un modèle GLM binomial prédit <strong>la probabilité d’appartenance au groupe 1</strong> (ici les personnes utilisant le vélo pour effectuer leur déplacement le plus fréquent). Pour convertir ces probabilités prédites en catégories prédites, il faut choisir un seuil de probabilité au-delà duquel nous considérons que la valeur attendue est 1 (cycliste) plutôt que 0 (autre). Un exemple naïf serait de prendre le seuil 0,5, ce qui signifierait que si le modèle prédit qu’une observation a au moins 50 % de chance d’être un(e) cycliste, alors nous l’attribuons à cette catégorie. Cependant, cette méthode est rarement optimale; il est donc plus judicieux de le fixer en trouvant le point d’équilibre entre la sensibilité (proportion de 1 correctement identifiés) et la spécificité (proportion de 0 correctement identifiés). Ce point d’équilibre est identifiable graphiquement en calculant la spécificité et la sensibilité de la prédiction selon toutes les valeurs possibles du seuil.</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="#cb775-1"></a><span class="kw">library</span>(ROCR)</span>
<span id="cb775-2"><a href="#cb775-2"></a><span class="co"># Obtention des prédictions du modèle</span></span>
<span id="cb775-3"><a href="#cb775-3"></a>prob &lt;-<span class="st"> </span><span class="kw">predict</span>(model2, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb775-4"><a href="#cb775-4"></a><span class="co"># Calcul de la sensibilité et de la spécificité (package ROCR)</span></span>
<span id="cb775-5"><a href="#cb775-5"></a>predictions &lt;-<span class="st"> </span><span class="kw">prediction</span>(prob, dfenquete2<span class="op">$</span>y)</span>
<span id="cb775-6"><a href="#cb775-6"></a>sens &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">unlist</span>(<span class="kw">performance</span>(predictions, <span class="st">&quot;sens&quot;</span>)<span class="op">@</span>x.values),</span>
<span id="cb775-7"><a href="#cb775-7"></a>                   <span class="dt">y=</span><span class="kw">unlist</span>(<span class="kw">performance</span>(predictions, <span class="st">&quot;sens&quot;</span>)<span class="op">@</span>y.values))</span>
<span id="cb775-8"><a href="#cb775-8"></a>spec &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">unlist</span>(<span class="kw">performance</span>(predictions, <span class="st">&quot;spec&quot;</span>)<span class="op">@</span>x.values),</span>
<span id="cb775-9"><a href="#cb775-9"></a>                   <span class="dt">y=</span><span class="kw">unlist</span>(<span class="kw">performance</span>(predictions, <span class="st">&quot;spec&quot;</span>)<span class="op">@</span>y.values))</span>
<span id="cb775-10"><a href="#cb775-10"></a><span class="co"># Trouver numériquement la valeur seuil (minimiser la différence absolue</span></span>
<span id="cb775-11"><a href="#cb775-11"></a><span class="co"># entre sensibilité et spécificité)</span></span>
<span id="cb775-12"><a href="#cb775-12"></a>real &lt;-<span class="st"> </span>dfenquete2<span class="op">$</span>y</span>
<span id="cb775-13"><a href="#cb775-13"></a>find_cutoff &lt;-<span class="st"> </span><span class="cf">function</span>(seuil){</span>
<span id="cb775-14"><a href="#cb775-14"></a>  pred &lt;-<span class="st"> </span><span class="kw">ifelse</span>(prob<span class="op">&gt;</span>seuil,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb775-15"><a href="#cb775-15"></a>  sensi &lt;-<span class="st"> </span><span class="kw">sum</span>(real<span class="op">==</span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>pred<span class="op">==</span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(real<span class="op">==</span><span class="dv">1</span>)</span>
<span id="cb775-16"><a href="#cb775-16"></a>  spec &lt;-<span class="st"> </span><span class="kw">sum</span>(real<span class="op">==</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>pred<span class="op">==</span><span class="dv">0</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(real<span class="op">==</span><span class="dv">0</span>)</span>
<span id="cb775-17"><a href="#cb775-17"></a>  <span class="kw">return</span>(<span class="kw">abs</span>(sensi<span class="op">-</span>spec))</span>
<span id="cb775-18"><a href="#cb775-18"></a>}</span>
<span id="cb775-19"><a href="#cb775-19"></a>prob_seuil &lt;-<span class="st"> </span><span class="kw">optimize</span>(find_cutoff,<span class="dt">interval =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">maximum =</span> F)<span class="op">$</span>minimum</span>
<span id="cb775-20"><a href="#cb775-20"></a><span class="kw">cat</span>(<span class="st">&quot;Le seuil de probabilité à retenir équilibrant&quot;</span>,</span>
<span id="cb775-21"><a href="#cb775-21"></a>  <span class="st">&quot;la sensibilité et la spécificité est de&quot;</span>,prob_seuil)</span></code></pre></div>
<pre><code>## Le seuil de probabilité à retenir équilibrant la sensibilité et la spécificité est de 0.14785</code></pre>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="#cb777-1"></a><span class="co"># Affichage du graphique</span></span>
<span id="cb777-2"><a href="#cb777-2"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb777-3"><a href="#cb777-3"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> sens, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></span>
<span id="cb777-4"><a href="#cb777-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> spec, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x,<span class="dt">y =</span> y,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)) <span class="op">+</span></span>
<span id="cb777-5"><a href="#cb777-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">sec.axis =</span> <span class="kw">sec_axis</span>(<span class="op">~</span>., <span class="dt">name =</span> <span class="st">&quot;Spécificité&quot;</span>)) <span class="op">+</span></span>
<span id="cb777-6"><a href="#cb777-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&#39;Seuil de probabilité&#39;</span>, <span class="dt">y=</span><span class="st">&quot;Sensibilité&quot;</span>) <span class="op">+</span></span>
<span id="cb777-7"><a href="#cb777-7"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> prob_seuil, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb777-8"><a href="#cb777-8"></a><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> prob_seuil, <span class="dt">y =</span> <span class="fl">0.01</span>, <span class="dt">label =</span> <span class="kw">round</span>(prob_seuil,<span class="dv">3</span>))<span class="op">+</span></span>
<span id="cb777-9"><a href="#cb777-9"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title.y.right =</span> <span class="kw">element_text</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>), <span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/equlibresensispeci-1.png" alt="Point d'équilibre entre sensibilité et spécificité" width="100%" />
<p class="caption">
(#fig:equlibresensispeci)Point d’équilibre entre sensibilité et spécificité
</p>
</div>
<p>Nous constatons à la figure @ref(fig:equlibresensispeci) que si la valeur du seuil est 0 %, alors la prédiction a une sensibilité parfaite (le modèle prédit toujours 1, donc tous les 1 sont détectés); à l’inverse, si le seuil choisi est 100 % alors la prédiction à une spécificité parfaite (le modèle prédit toujours 0, donc tous les 0 sont détectés). Dans notre cas, la valeur d’équilibre est d’environ 0,148, donc si le modèle prédit une probabilité au moins égale à 14,8 % qu’un individu utilise le vélo pour son déplacement le plus fréquent, nous devons l’attribuer à la catégorie <em>cycliste</em>. Avec ce seuil, nous pouvons convertir les probabilités prédites en classes prédites et construire notre matrice de confusion.</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="#cb778-1"></a><span class="kw">library</span>(caret) <span class="co"># pour la matrice de confusion</span></span>
<span id="cb778-2"><a href="#cb778-2"></a><span class="co"># Calcul des catégories prédites</span></span>
<span id="cb778-3"><a href="#cb778-3"></a>ypred &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">predict</span>(model2,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>)<span class="op">&gt;</span><span class="fl">0.148</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb778-4"><a href="#cb778-4"></a>info &lt;-<span class="st"> </span><span class="kw">confusionMatrix</span>(<span class="kw">as.factor</span>(dfenquete2<span class="op">$</span>y), <span class="kw">as.factor</span>(ypred))</span>
<span id="cb778-5"><a href="#cb778-5"></a><span class="co"># Affichage des valeurs brutes de la matrice de confusion</span></span>
<span id="cb778-6"><a href="#cb778-6"></a><span class="kw">print</span>(info)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction     0     1
##          0 14355  7576
##          1  1251  2365
##                                           
##                Accuracy : 0.6545          
##                  95% CI : (0.6486, 0.6603)
##     No Information Rate : 0.6109          
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.1783          
##                                           
##  Mcnemar&#39;s Test P-Value : &lt; 2.2e-16       
##                                           
##             Sensitivity : 0.9198          
##             Specificity : 0.2379          
##          Pos Pred Value : 0.6546          
##          Neg Pred Value : 0.6540          
##              Prevalence : 0.6109          
##          Detection Rate : 0.5619          
##    Detection Prevalence : 0.8585          
##       Balanced Accuracy : 0.5789          
##                                           
##        &#39;Positive&#39; Class : 0               
## </code></pre>
<p>Les résultats proposés par le <em>package</em> <code>caret</code> sont exhaustifs; nous vous proposons ici une façon de les présenter dans deux tableaux : l’un présente la matrice de confusion (tableau @ref(tab:confusmatbinom)) et l’autre, les indicateurs de qualité de prédiction (tableau @ref(tab:confusmatbinom2)).</p>
<table>
<caption>
(#tab:confusmatbinom)Matrice de confusion pour le modèle binomial
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
0 (réel)
</th>
<th style="text-align:right;">
1 (réel)
</th>
<th style="text-align:right;">
Total
</th>
<th style="text-align:right;">
%
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0 (prédit)
</td>
<td style="text-align:right;">
14355
</td>
<td style="text-align:right;">
7576
</td>
<td style="text-align:right;">
21931
</td>
<td style="text-align:right;">
85.8
</td>
</tr>
<tr>
<td style="text-align:left;">
1 (prédit)
</td>
<td style="text-align:right;">
1251
</td>
<td style="text-align:right;">
2365
</td>
<td style="text-align:right;">
3616
</td>
<td style="text-align:right;">
14.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Total
</td>
<td style="text-align:right;">
15606
</td>
<td style="text-align:right;">
9941
</td>
<td style="text-align:right;">
25547
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
%
</td>
<td style="text-align:right;">
61.1
</td>
<td style="text-align:right;">
38.9
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
<p>D’après ces indicateurs, nous constatons que le modèle a une capacité de prédiction relativement faible, mais tout de même significativement supérieure au seuil de non-information. La valeur de rappel pour la catégorie 1 (cycliste) est faible, indiquant que le modèle a manqué un nombre important de cyclistes lors de sa prédiction.</p>
<table>
<caption>
(#tab:confusmatbinom2)Matrice de confusion pour le modèle binomial
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Précision
</th>
<th style="text-align:right;">
Rappel
</th>
<th style="text-align:right;">
F1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.92
</td>
<td style="text-align:right;">
0.76
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
0.35
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
macro
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.65
</td>
<td style="text-align:right;">
0.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Kappa
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Valeur de p (précision &gt; NIR)
</td>
<td style="text-align:right;">
&lt; 0,0001
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
<p><strong>Interprétation des résultats du modèle</strong></p>
<p>L’interprétation des résultats d’un modèle binomial passe par la lecture des rapports de cotes (exponentiel des coefficients) et de leurs intervalles de confiance. Nous commençons donc par calculer la version robuste des erreurs standards des coefficients :</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="#cb780-1"></a><span class="kw">library</span>(sandwich) <span class="co"># pour calculer les erreurs standards robustes</span></span>
<span id="cb780-2"><a href="#cb780-2"></a>covModel2 &lt;-<span class="st"> </span><span class="kw">vcovHC</span>(model2, <span class="dt">type =</span> <span class="st">&quot;HC0&quot;</span>) <span class="co"># méthode HC0, basée sur les résidus</span></span>
<span id="cb780-3"><a href="#cb780-3"></a>stdErrRobuste &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">diag</span>(covModel2)) <span class="co"># extraire la diagonale</span></span>
<span id="cb780-4"><a href="#cb780-4"></a><span class="co"># Extraction des coefficients</span></span>
<span id="cb780-5"><a href="#cb780-5"></a>coeffs &lt;-<span class="st"> </span>model2<span class="op">$</span>coefficients</span>
<span id="cb780-6"><a href="#cb780-6"></a><span class="co"># Recalcul des scores Z</span></span>
<span id="cb780-7"><a href="#cb780-7"></a>zvalRobuste &lt;-<span class="st"> </span>coeffs <span class="op">/</span><span class="st"> </span>stdErrRobuste</span>
<span id="cb780-8"><a href="#cb780-8"></a><span class="co"># Recalcul des valeurs de P</span></span>
<span id="cb780-9"><a href="#cb780-9"></a>pvalRobuste &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="kw">abs</span>(zvalRobuste), <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</span>
<span id="cb780-10"><a href="#cb780-10"></a><span class="co"># Calcul des rapports de cote</span></span>
<span id="cb780-11"><a href="#cb780-11"></a>oddRatio &lt;-<span class="st"> </span><span class="kw">exp</span>(coeffs)</span>
<span id="cb780-12"><a href="#cb780-12"></a><span class="co"># Calcul des intervalles de confiance à 95 % des rapports de cote</span></span>
<span id="cb780-13"><a href="#cb780-13"></a>lowerBound &lt;-<span class="st"> </span><span class="kw">exp</span>(coeffs <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>stdErrRobuste)</span>
<span id="cb780-14"><a href="#cb780-14"></a>upperBound &lt;-<span class="st"> </span><span class="kw">exp</span>(coeffs <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>stdErrRobuste)</span>
<span id="cb780-15"><a href="#cb780-15"></a><span class="co"># Étoiles pour les valeurs de p</span></span>
<span id="cb780-16"><a href="#cb780-16"></a>starsp &lt;-<span class="st"> </span><span class="kw">case_when</span>(pvalRobuste <span class="op">&lt;=</span><span class="st">  </span><span class="fl">0.001</span>  <span class="op">~</span><span class="st"> &quot;***&quot;</span>,</span>
<span id="cb780-17"><a href="#cb780-17"></a>                    pvalRobuste <span class="op">&gt;</span><span class="st">  </span><span class="fl">0.001</span> <span class="op">&amp;</span><span class="st"> </span>pvalRobuste <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">~</span><span class="st"> &quot;**&quot;</span>,</span>
<span id="cb780-18"><a href="#cb780-18"></a>                    pvalRobuste <span class="op">&gt;</span><span class="st">  </span><span class="fl">0.01</span> <span class="op">&amp;</span><span class="st"> </span>pvalRobuste <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">~</span><span class="st"> &quot;*&quot;</span>,</span>
<span id="cb780-19"><a href="#cb780-19"></a>                    pvalRobuste <span class="op">&gt;</span><span class="st">  </span><span class="fl">0.05</span> <span class="op">&amp;</span><span class="st"> </span>pvalRobuste <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.1</span> <span class="op">~</span><span class="st"> &quot;.&quot;</span>,</span>
<span id="cb780-20"><a href="#cb780-20"></a>                    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;&quot;</span></span>
<span id="cb780-21"><a href="#cb780-21"></a>                    )</span>
<span id="cb780-22"><a href="#cb780-22"></a><span class="co"># Compilation des résultats dans un tableau</span></span>
<span id="cb780-23"><a href="#cb780-23"></a>tableau_binom &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb780-24"><a href="#cb780-24"></a>  <span class="dt">coefficients =</span> coeffs,</span>
<span id="cb780-25"><a href="#cb780-25"></a>  <span class="dt">rap.cote =</span> oddRatio,</span>
<span id="cb780-26"><a href="#cb780-26"></a>  <span class="dt">err.std =</span> stdErrRobuste,</span>
<span id="cb780-27"><a href="#cb780-27"></a>  <span class="dt">score.z =</span> zvalRobuste,</span>
<span id="cb780-28"><a href="#cb780-28"></a>  <span class="dt">p.val =</span> pvalRobuste,</span>
<span id="cb780-29"><a href="#cb780-29"></a>  <span class="dt">rap.cote.2.5 =</span> lowerBound,</span>
<span id="cb780-30"><a href="#cb780-30"></a>  <span class="dt">rap.cote.97.5 =</span> upperBound,</span>
<span id="cb780-31"><a href="#cb780-31"></a>  <span class="dt">sign =</span> starsp</span>
<span id="cb780-32"><a href="#cb780-32"></a>)</span></code></pre></div>
<p>Considérant que la variable <em>Pays</em> a 24 modalités, il est plus judicieux de présenter ses 23 rapports de cotes sous forme d’un graphique. Nous avons choisi l’Allemagne comme catégorie de référence puisqu’elle fait partie des pays avec une importante part modale pour le vélo sans pour autant constituer un cas extrême comme le Danemark.</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="#cb781-1"></a><span class="co"># Isoler les ligne du tableau récapitualtif pour les pays</span></span>
<span id="cb781-2"><a href="#cb781-2"></a>paysdf &lt;-<span class="st"> </span><span class="kw">subset</span>(tableau_binom, <span class="kw">grepl</span>(<span class="st">&quot;Pays&quot;</span>,<span class="kw">row.names</span>(tableau_binom), <span class="dt">fixed =</span> T))</span>
<span id="cb781-3"><a href="#cb781-3"></a><span class="co">#paysdf$Pays &lt;- gsub(&quot;Pays&quot;,&quot;&quot;,row.names(paysdf),fixed=T)</span></span>
<span id="cb781-4"><a href="#cb781-4"></a>paysdf<span class="op">$</span>Pays &lt;-<span class="st"> </span><span class="kw">substr</span>(<span class="kw">row.names</span>(paysdf), <span class="dv">5</span>, <span class="kw">nchar</span>(<span class="kw">row.names</span>(paysdf)))</span>
<span id="cb781-5"><a href="#cb781-5"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> paysdf) <span class="op">+</span></span>
<span id="cb781-6"><a href="#cb781-6"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span><span class="st"> </span><span class="co">#afficher la valeur de référence</span></span>
<span id="cb781-7"><a href="#cb781-7"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> rap.cote.<span class="fl">2.5</span>, <span class="dt">xmax =</span> rap.cote.<span class="fl">97.5</span>, </span>
<span id="cb781-8"><a href="#cb781-8"></a>                     <span class="dt">y =</span> <span class="kw">reorder</span>(Pays, rap.cote)), <span class="dt">height =</span> <span class="dv">0</span>)<span class="op">+</span></span>
<span id="cb781-9"><a href="#cb781-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rap.cote, <span class="dt">y =</span> <span class="kw">reorder</span>(Pays, rap.cote))) <span class="op">+</span></span>
<span id="cb781-10"><a href="#cb781-10"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rap.cote.<span class="fl">97.5</span>, <span class="dt">y =</span> <span class="kw">reorder</span>(Pays, rap.cote), </span>
<span id="cb781-11"><a href="#cb781-11"></a>                <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;RC : &quot;</span>,<span class="kw">round</span>(rap.cote,<span class="dv">2</span>),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)),</span>
<span id="cb781-12"><a href="#cb781-12"></a>                <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">nudge_x =</span> <span class="fl">0.25</span>)<span class="op">+</span></span>
<span id="cb781-13"><a href="#cb781-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Rapports de cote&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Pays (référence : Allemagne)&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figpaysbinom-1.png" alt="Rapports de cote pour les différents pays de l'UE" width="100%" />
<p class="caption">
(#fig:figpaysbinom)Rapports de cote pour les différents pays de l’UE
</p>
</div>
<p>Dans la figure @ref(fig:figpaysbinom), la barre horizontale pour chaque pays représente l’intervalle de confiance de son rapport de cotes (le point); plus cette ligne est longue, plus grande est l’incertitude autour de ce paramètre. Lorsque les lignes de deux pays se chevauchent, cela signifie qu’il n’y a pas de différence significative au seuil 0,05 entre les rapports de cotes des deux pays. La ligne rouge tracée à x = 1, représente le rapport de cotes du pays de référence (ici l’Allemagne). Nous constatons ainsi que comparativement à un individu vivant en Allemagne, ceux vivant au Danemark et aux Pays-Bas ont 2,4 fois plus de chances d’utiliser le vélo pour leur déplacement le plus fréquent. Les Pays de l’Ouest (France, Luxembourg, Royaume-Uni, Irlande) et du Sud (Grèce, Italie, Espagne, Portugal) ont en revanche des rapports de cotes plus faibles. En France, les chances qu’un individu utilise le vélo pour son trajet le plus fréquent sont 3,22 (1/0,31) fois plus faibles que si l’individu vivait en Allemagne.</p>
<p>Pour le reste des coefficients et rapports de cotes, nous les rapportons dans le tableau @ref(tab:tablcoeffbinom).</p>
<table>
<caption>
(#tab:tablcoeffbinom)Résultats du modèle binomial
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coefficient
</th>
<th style="text-align:right;">
Rapport de cote
</th>
<th style="text-align:right;">
Err.std
</th>
<th style="text-align:right;">
Val.z
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
RC 2,5 %
</th>
<th style="text-align:right;">
RC 97,5 %
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
-2,497
</td>
<td style="text-align:right;">
0,082
</td>
<td style="text-align:right;">
0,183
</td>
<td style="text-align:right;">
-13,674
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,058
</td>
<td style="text-align:right;">
0,118
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Sexe</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : femme
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
homme
</td>
<td style="text-align:right;">
0,372
</td>
<td style="text-align:right;">
1,451
</td>
<td style="text-align:right;">
0,038
</td>
<td style="text-align:right;">
9,803
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,347
</td>
<td style="text-align:right;">
1,562
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:right;">
-0,009
</td>
<td style="text-align:right;">
0,991
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
-5,361
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,988
</td>
<td style="text-align:right;">
0,994
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Education</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : premier cycle
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
secondaire
</td>
<td style="text-align:right;">
0,193
</td>
<td style="text-align:right;">
1,213
</td>
<td style="text-align:right;">
0,105
</td>
<td style="text-align:right;">
1,836
</td>
<td style="text-align:right;">
0,066
</td>
<td style="text-align:right;">
0,987
</td>
<td style="text-align:right;">
1,490
</td>
</tr>
<tr>
<td style="text-align:left;">
secondaire inferieur
</td>
<td style="text-align:right;">
0,301
</td>
<td style="text-align:right;">
1,351
</td>
<td style="text-align:right;">
0,114
</td>
<td style="text-align:right;">
2,649
</td>
<td style="text-align:right;">
0,008
</td>
<td style="text-align:right;">
1,081
</td>
<td style="text-align:right;">
1,687
</td>
</tr>
<tr>
<td style="text-align:left;">
universite
</td>
<td style="text-align:right;">
0,146
</td>
<td style="text-align:right;">
1,157
</td>
<td style="text-align:right;">
0,108
</td>
<td style="text-align:right;">
1,349
</td>
<td style="text-align:right;">
0,177
</td>
<td style="text-align:right;">
0,936
</td>
<td style="text-align:right;">
1,432
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>StatutEmploi</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : employe
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
sans emploi
</td>
<td style="text-align:right;">
0,257
</td>
<td style="text-align:right;">
1,293
</td>
<td style="text-align:right;">
0,043
</td>
<td style="text-align:right;">
6,045
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,190
</td>
<td style="text-align:right;">
1,405
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Revenu</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : eleve
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
faible
</td>
<td style="text-align:right;">
0,077
</td>
<td style="text-align:right;">
1,080
</td>
<td style="text-align:right;">
0,072
</td>
<td style="text-align:right;">
1,067
</td>
<td style="text-align:right;">
0,286
</td>
<td style="text-align:right;">
0,938
</td>
<td style="text-align:right;">
1,244
</td>
</tr>
<tr>
<td style="text-align:left;">
moyen
</td>
<td style="text-align:right;">
0,042
</td>
<td style="text-align:right;">
1,043
</td>
<td style="text-align:right;">
0,065
</td>
<td style="text-align:right;">
0,639
</td>
<td style="text-align:right;">
0,523
</td>
<td style="text-align:right;">
0,917
</td>
<td style="text-align:right;">
1,185
</td>
</tr>
<tr>
<td style="text-align:left;">
sans reponse
</td>
<td style="text-align:right;">
0,217
</td>
<td style="text-align:right;">
1,242
</td>
<td style="text-align:right;">
0,102
</td>
<td style="text-align:right;">
2,120
</td>
<td style="text-align:right;">
0,034
</td>
<td style="text-align:right;">
1,016
</td>
<td style="text-align:right;">
1,517
</td>
</tr>
<tr>
<td style="text-align:left;">
tres eleve
</td>
<td style="text-align:right;">
-0,120
</td>
<td style="text-align:right;">
0,887
</td>
<td style="text-align:right;">
0,188
</td>
<td style="text-align:right;">
-0,637
</td>
<td style="text-align:right;">
0,524
</td>
<td style="text-align:right;">
0,613
</td>
<td style="text-align:right;">
1,283
</td>
</tr>
<tr>
<td style="text-align:left;">
tres faible
</td>
<td style="text-align:right;">
0,240
</td>
<td style="text-align:right;">
1,271
</td>
<td style="text-align:right;">
0,086
</td>
<td style="text-align:right;">
2,776
</td>
<td style="text-align:right;">
0,006
</td>
<td style="text-align:right;">
1,073
</td>
<td style="text-align:right;">
1,505
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Residence</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : aire metropolitaine
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
grande ville
</td>
<td style="text-align:right;">
0,273
</td>
<td style="text-align:right;">
1,314
</td>
<td style="text-align:right;">
0,070
</td>
<td style="text-align:right;">
3,911
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,146
</td>
<td style="text-align:right;">
1,507
</td>
</tr>
<tr>
<td style="text-align:left;">
petite-moyenne ville
</td>
<td style="text-align:right;">
0,277
</td>
<td style="text-align:right;">
1,319
</td>
<td style="text-align:right;">
0,061
</td>
<td style="text-align:right;">
4,503
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,169
</td>
<td style="text-align:right;">
1,487
</td>
</tr>
<tr>
<td style="text-align:left;">
zone rurale
</td>
<td style="text-align:right;">
-0,119
</td>
<td style="text-align:right;">
0,888
</td>
<td style="text-align:right;">
0,069
</td>
<td style="text-align:right;">
-1,713
</td>
<td style="text-align:right;">
0,087
</td>
<td style="text-align:right;">
0,775
</td>
<td style="text-align:right;">
1,017
</td>
</tr>
<tr>
<td style="text-align:left;">
Duree
</td>
<td style="text-align:right;">
-0,001
</td>
<td style="text-align:right;">
0,999
</td>
<td style="text-align:right;">
0,001
</td>
<td style="text-align:right;">
-0,981
</td>
<td style="text-align:right;">
0,326
</td>
<td style="text-align:right;">
0,998
</td>
<td style="text-align:right;">
1,001
</td>
</tr>
<tr>
<td style="text-align:left;">
ConsEnv
</td>
<td style="text-align:right;">
0,102
</td>
<td style="text-align:right;">
1,108
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
10,502
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,087
</td>
<td style="text-align:right;">
1,130
</td>
</tr>
</tbody>
</table>
<p>Les chances pour un individu d’utiliser le vélo pour son trajet le plus fréquent sont augmentées de 45 % s’il s’agit d’un homme plutôt qu’une femme. Pour l’âge, nous constatons un effet relativement faible puisque chaque année supplémentaire réduit les chances qu’un individu utilise le vélo comme mode de transport pour son trajet le plus fréquent de 0,9 % <span class="math inline">\(((0.991-1)\times100)\)</span>. Le fait d’être sans emploi augmente les chances d’utiliser le vélo de 29 % comparativement au fait d’avoir un emploi. Concernant le niveau d’éducation, seul le coefficient pour le groupe des personnes de la catégorie « secondaire inférieure » est significatif, indiquant que les personnes de ce groupe ont 35 % de chances en plus d’utiliser le vélo comme mode de transport pour leur déplacement le plus fréquent comparativement aux personnes de la catégorie « premier cycle ». Pour le revenu, seul le groupe avec de très faibles revenus se distingue significativement du groupe avec un revenu élevé avec un rapport de cotes de 1,27, soit 27 % de chances en plus d’utiliser le vélo.</p>
<p>Comparativement à ceux vivant dans une aire métropolitaine, les personnes vivant dans de petites, moyennes et grandes villes ont des chances accrues d’utiliser le vélo comme mode de déplacement pour leur trajet le plus fréquent. En revanche, nous ne pouvons observer aucune différence entre la probabilité d’utiliser le vélo dans une métropole et en zone rurale. La figure @ref(fig:figvillebinom) permet de clairement visualiser cette situation. Rappelons que la référence est la situation : vivre dans une région métropolitaine, représentée par la ligne verticale rouge. Plusieurs pistes d’interprétation peuvent être envisagées pour ce résultat :</p>
<ul>
<li>En métropole et dans les zones rurales, les distances domicile-travail tendent à être plus grandes que dans les petites, moyennes et grandes villes.</li>
<li>En métropole, le système de transport en commun est davantage développé et entre donc en concurrence avec les modes de transport actifs.</li>
</ul>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="#cb782-1"></a><span class="co"># Isoler les lignes du tableau récapitualtif pour les lieux de résidence</span></span>
<span id="cb782-2"><a href="#cb782-2"></a>residdf &lt;-<span class="st"> </span><span class="kw">subset</span>(tableau_binom, <span class="kw">grepl</span>(<span class="st">&quot;Residence&quot;</span>,<span class="kw">row.names</span>(tableau_binom), <span class="dt">fixed =</span> T))</span>
<span id="cb782-3"><a href="#cb782-3"></a>residdf<span class="op">$</span>resid &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;Residence&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="kw">row.names</span>(residdf),<span class="dt">fixed=</span>T)</span>
<span id="cb782-4"><a href="#cb782-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> residdf) <span class="op">+</span></span>
<span id="cb782-5"><a href="#cb782-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span><span class="st"> </span><span class="co">#afficher la valeur de référence</span></span>
<span id="cb782-6"><a href="#cb782-6"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> rap.cote.<span class="fl">2.5</span>, <span class="dt">xmax =</span> rap.cote.<span class="fl">97.5</span>, <span class="dt">y =</span> resid), <span class="dt">height =</span> <span class="dv">0</span>)<span class="op">+</span></span>
<span id="cb782-7"><a href="#cb782-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rap.cote, <span class="dt">y =</span> resid)) <span class="op">+</span></span>
<span id="cb782-8"><a href="#cb782-8"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rap.cote.<span class="fl">97.5</span>, <span class="dt">y =</span> resid, </span>
<span id="cb782-9"><a href="#cb782-9"></a>                <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;RC : &quot;</span>,<span class="kw">round</span>(rap.cote,<span class="dv">2</span>),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)),</span>
<span id="cb782-10"><a href="#cb782-10"></a>                <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">nudge_x =</span> <span class="fl">0.1</span>)<span class="op">+</span></span>
<span id="cb782-11"><a href="#cb782-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Rapports de cotes&quot;</span>,</span>
<span id="cb782-12"><a href="#cb782-12"></a>       <span class="dt">y =</span> <span class="st">&quot;Lieu de résidence (référence : aire métropolitaine)&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figvillebinom-1.png" alt="Rapports de cote pour les différents lieux de résidence" width="85%" />
<p class="caption">
(#fig:figvillebinom)Rapports de cote pour les différents lieux de résidence
</p>
</div>
<p>Il est aussi intéressant de noter que la durée des trajets ne semble pas impacter la probabilité d’utiliser le vélo. Enfin, une conscience environnementale plus affirmée semble être associée avec une probabilité supérieure d’utiliser le vélo pour son déplacement le plus fréquent, avec une augmentation des chances de 11 % pour chaque point supplémentaire sur l’échelle de Likert.</p>
<p>Afin de simplifier la présentation de certains résultats, il est possible de calculer exactement les prédictions réalisées par le modèle. Un bon exemple ici est le cas de la variable âge. Quelle différence peut-on attendre entre deux individus identiques ayant seulement une différence d’âge de 15 ans?</p>
<p>Prenons comme individu un homme de 30 ans, vivant dans une grande ville allemande, ayant un niveau d’éducation de niveau secondaire, employé, dans la tranche de revenu moyen, déclarant effectuer un trajet de 45 minutes et ayant rapporté un niveau de conscience environnementale de 5 (sur 10). Nous pouvons prédire la probabilité qu’il utilise le vélo pour son trajet le plus fréquent en utilisant la formule suivante :</p>
<p><span class="math inline">\(logit(p) = -\mbox{2,497} + \mbox{1} \times \mbox{0,372} + \mbox{30} \times -\mbox{0,009} + \mbox{1} \times \mbox{0,193} + \mbox{1} \times \mbox{0,042} + \mbox{1} \times \mbox{0,273} + \mbox{45} \times -\mbox{0,001} + \mbox{5} \times \mbox{0,102}\)</span></p>
<p><span class="math inline">\(p = exp(-\mbox{2,497} + \mbox{1} \times \mbox{0,372} + \mbox{30} \times -\mbox{0,009} + \mbox{1} \times \mbox{0,193} + \mbox{1} \times \mbox{0,042} + 1 \times \mbox{0,273} + 45 \times -\mbox{0,001} + \mbox{5} \times \mbox{0,102})/(\mbox{1}+exp(-\mbox{2,497} + 1 \times \mbox{0,372} + \mbox{30} \times-\mbox{0,009} + 1 \times \mbox{0,193} + 1 \times \mbox{0,042} + \mbox{1} \times \mbox{0,273} + \mbox{45} \times -\mbox{0,001} + 5 \times \mbox{0,102})) = \mbox{0,194}\)</span></p>
<p>Il y aurait 19,4 % de chances pour que cette personne soit cycliste. Cette probabilité dépasse le seuil que nous avons sélectionné, cette personne serait donc classée comme. Si nous augmentons son âge de 15 ans, nous obtenons :</p>
<p><span class="math inline">\(p = exp(-\mbox{2,497} + \mbox{1} \times \mbox{0,372} + \mbox{45} \times \mbox{-0,009} + \mbox{1} \times \mbox{0,193} + \mbox{1} \times \mbox{0,042} + \mbox{1} \times \mbox{0,273} + \mbox{45} \times -\mbox{0,001} + \mbox{5} \times \mbox{0,102}) / (\mbox{1}+exp(-\mbox{2,497} + \mbox{1} \times \mbox{0,372} + \mbox{45} \times -\mbox{0,009} + \mbox{1} \times \mbox{0,193} + \mbox{1} \times \mbox{0,042} + \mbox{1} \times \mbox{0,273} + \mbox{45} \times -\mbox{0,001} + \mbox{5} \times \mbox{0,102})) = \mbox{0,174}\)</span></p>
<p>Soit une réduction de 2 points de pourcentages. Il est également possible de représenter cette évolution sur un graphique pour montrer l’effet sur l’étendue des valeurs possibles. Sur ces graphiques des effets marginaux, il est essentiel de représenter l’incertitude quant à la prédiction. En temps normal, la fonction <code>predict</code> calcule directement l’erreur standard de la prédiction et cette dernière peut être utilisée pour calculer l’intervalle de confiance de la prédiction. Cependant, nous voulons ici utiliser nos erreurs standards robustes. Nous devons donc procéder par simulation pour déterminer l’intervalle de confiance à 95 % de nos prédictions. Cette opération nécessite de réaliser plusieurs opérations manuellement dans R.</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="#cb783-1"></a><span class="co"># Créer un jeu de données fictif pour la prédiction</span></span>
<span id="cb783-2"><a href="#cb783-2"></a>mat &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(model2<span class="op">$</span>terms, model2<span class="op">$</span>model)</span>
<span id="cb783-3"><a href="#cb783-3"></a>age2seq &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">20</span>,<span class="dv">80</span>)</span>
<span id="cb783-4"><a href="#cb783-4"></a>mat2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(mat[<span class="dv">1</span>,], <span class="dt">nrow=</span><span class="kw">length</span>(age2seq), <span class="dt">ncol=</span><span class="kw">length</span>(mat[<span class="dv">1</span>,]), <span class="dt">byrow=</span><span class="ot">TRUE</span>)</span>
<span id="cb783-5"><a href="#cb783-5"></a><span class="kw">colnames</span>(mat2) &lt;-<span class="st"> </span><span class="kw">colnames</span>(mat)</span>
<span id="cb783-6"><a href="#cb783-6"></a>mat2[,<span class="st">&quot;Age&quot;</span>] &lt;-<span class="st"> </span>age2seq</span>
<span id="cb783-7"><a href="#cb783-7"></a>mat2[,<span class="st">&quot;PaysBelgique&quot;</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb783-8"><a href="#cb783-8"></a>mat2[,<span class="st">&quot;Duree&quot;</span>] &lt;-<span class="st"> </span><span class="dv">45</span></span>
<span id="cb783-9"><a href="#cb783-9"></a>mat2[,<span class="st">&quot;ConsEnv&quot;</span>] &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb783-10"><a href="#cb783-10"></a>mat2[,<span class="st">&quot;StatutEmploisans emploi&quot;</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb783-11"><a href="#cb783-11"></a>mat2[,<span class="st">&quot;Residencegrande ville&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb783-12"><a href="#cb783-12"></a>mat2[,<span class="st">&quot;Educationsecondaire&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb783-13"><a href="#cb783-13"></a>mat2[,<span class="st">&quot;Sexehomme&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb783-14"><a href="#cb783-14"></a>mat2[,<span class="st">&quot;Revenumoyen&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb783-15"><a href="#cb783-15"></a>mat2[,<span class="st">&quot;Revenufaible&quot;</span>] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb783-16"><a href="#cb783-16"></a><span class="co"># Calculer la prédiction comme un log de rapport de cote (avec les erreurs standards)</span></span>
<span id="cb783-17"><a href="#cb783-17"></a><span class="co"># en multipliant les coefficient par les valeurs des données fictives</span></span>
<span id="cb783-18"><a href="#cb783-18"></a>coeffs &lt;-<span class="st"> </span>model2<span class="op">$</span>coefficients</span>
<span id="cb783-19"><a href="#cb783-19"></a>pred &lt;-<span class="st"> </span>coeffs <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(mat2)</span>
<span id="cb783-20"><a href="#cb783-20"></a><span class="co"># Simulation de prédictions (toujours en log de rapport de cote)</span></span>
<span id="cb783-21"><a href="#cb783-21"></a><span class="co"># Étape 1 : simuler 1000 valeurs pour chaque coefficient</span></span>
<span id="cb783-22"><a href="#cb783-22"></a>sim_coeffs &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(coeffs), <span class="cf">function</span>(i){</span>
<span id="cb783-23"><a href="#cb783-23"></a>  coef &lt;-<span class="st"> </span>coeffs[[i]]</span>
<span id="cb783-24"><a href="#cb783-24"></a>  std.err &lt;-<span class="st"> </span>stdErrRobuste[[i]]</span>
<span id="cb783-25"><a href="#cb783-25"></a>  vals &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">mean =</span> coef, <span class="dt">sd =</span> std.err)</span>
<span id="cb783-26"><a href="#cb783-26"></a>  <span class="kw">return</span>(vals)</span>
<span id="cb783-27"><a href="#cb783-27"></a>})</span>
<span id="cb783-28"><a href="#cb783-28"></a>mat_sim_coeffs &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind,sim_coeffs)</span>
<span id="cb783-29"><a href="#cb783-29"></a><span class="co"># Étape 2 : effectuer les prédictions à partir des coefficients simulés</span></span>
<span id="cb783-30"><a href="#cb783-30"></a>sim_preds &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(mat_sim_coeffs),<span class="cf">function</span>(i){</span>
<span id="cb783-31"><a href="#cb783-31"></a>  temp_coefs &lt;-<span class="st"> </span>mat_sim_coeffs[,i]</span>
<span id="cb783-32"><a href="#cb783-32"></a>  temp_pred &lt;-<span class="st"> </span><span class="kw">as.vector</span>(temp_coefs <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(mat2))</span>
<span id="cb783-33"><a href="#cb783-33"></a>  <span class="kw">return</span>(temp_pred)</span>
<span id="cb783-34"><a href="#cb783-34"></a>})</span>
<span id="cb783-35"><a href="#cb783-35"></a>mat_sim_preds &lt;-<span class="st"> </span><span class="kw">do.call</span>(cbind,sim_preds)</span>
<span id="cb783-36"><a href="#cb783-36"></a><span class="co"># Étape 3 : extraire les intervalles de confiances pour les simulations</span></span>
<span id="cb783-37"><a href="#cb783-37"></a>intervals &lt;-<span class="st"> </span><span class="kw">apply</span>(mat_sim_preds,<span class="dt">MARGIN =</span> <span class="dv">1</span>, <span class="dt">FUN =</span> <span class="cf">function</span>(vec){</span>
<span id="cb783-38"><a href="#cb783-38"></a>  <span class="kw">return</span>(<span class="kw">quantile</span>(vec,<span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)))</span>
<span id="cb783-39"><a href="#cb783-39"></a>})</span>
<span id="cb783-40"><a href="#cb783-40"></a><span class="co"># Étape 4 : récupérer tous ces éléments dans un DataFrame</span></span>
<span id="cb783-41"><a href="#cb783-41"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb783-42"><a href="#cb783-42"></a>  <span class="dt">Age =</span> <span class="kw">seq</span>(<span class="dv">20</span>,<span class="dv">80</span>),</span>
<span id="cb783-43"><a href="#cb783-43"></a>  <span class="dt">pred =</span> <span class="kw">as.vector</span>(pred),</span>
<span id="cb783-44"><a href="#cb783-44"></a>  <span class="dt">lower =</span> <span class="kw">as.vector</span>(intervals[<span class="dv">1</span>,]),</span>
<span id="cb783-45"><a href="#cb783-45"></a>  <span class="dt">upper =</span> <span class="kw">as.vector</span>(intervals[<span class="dv">2</span>,])</span>
<span id="cb783-46"><a href="#cb783-46"></a>)</span>
<span id="cb783-47"><a href="#cb783-47"></a><span class="co"># Étape 5 : appliquer l&#39;inverse de la fonction de lien pour</span></span>
<span id="cb783-48"><a href="#cb783-48"></a><span class="co"># obtenir les prédictions en termes de probabilité</span></span>
<span id="cb783-49"><a href="#cb783-49"></a>ilink &lt;-<span class="st"> </span><span class="kw">family</span>(model2)<span class="op">$</span>linkinv</span>
<span id="cb783-50"><a href="#cb783-50"></a>df<span class="op">$</span>prob_pred &lt;-<span class="st"> </span><span class="kw">ilink</span>(df<span class="op">$</span>pred)</span>
<span id="cb783-51"><a href="#cb783-51"></a>df<span class="op">$</span>prob_lower &lt;-<span class="st"> </span><span class="kw">ilink</span>(df<span class="op">$</span>lower)</span>
<span id="cb783-52"><a href="#cb783-52"></a>df<span class="op">$</span>prob_upper &lt;-<span class="st"> </span><span class="kw">ilink</span>(df<span class="op">$</span>upper)</span>
<span id="cb783-53"><a href="#cb783-53"></a><span class="co"># Étape 6 : représenter le tout sur un graphique</span></span>
<span id="cb783-54"><a href="#cb783-54"></a><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb783-55"><a href="#cb783-55"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">ymax =</span> prob_upper, <span class="dt">ymin =</span> prob_lower), </span>
<span id="cb783-56"><a href="#cb783-56"></a>              <span class="dt">fill =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb783-57"><a href="#cb783-57"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> prob_pred), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb783-58"><a href="#cb783-58"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.15</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="fl">0.7</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb783-59"><a href="#cb783-59"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Âge&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Probabilité prédite (intervalle de confiance à 95 %)&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figagebinom-1.png" alt="Impact de l'âge sur la probabilité d'utiliser le vélo comme moyen de déplacement pour son trajet le plus fréquent" width="85%" />
<p class="caption">
(#fig:figagebinom)Impact de l’âge sur la probabilité d’utiliser le vélo comme moyen de déplacement pour son trajet le plus fréquent
</p>
</div>
<p>La figure @ref(fig:figagebinom) permet de bien constater la diminution de la probabilité d’utiliser le vélo pour son trajet le plus fréquent avec l’âge, mais cette réduction est relativement ténue. Dans le cas utilisé en exemple, l’individu ne serait plus classé cycliste qu’après 67 ans.</p>
</div>
</div>
<div id="sect0822" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Modèle probit binomial</h3>
<p>Le modèle GLM probit binomial est pour ainsi dire le frère du modèle logistique binomial. La seule différence entre les deux réside dans l’utilisation d’une autre fonction de lien: probit plutôt que logistique. La fonction de lien probit (Φ) correspond à la fonction cumulative de la distribution normale et a également une forme de <em>S</em>. Cette version du modèle est plus souvent utilisée par les économistes. Le principal changement réside dans l’interprétation des coefficients <span class="math inline">\(\beta_0\)</span> et <span class="math inline">\(\beta\)</span>. Du fait de la transformation probit, ces derniers indiquent le changement en termes de scores Z de la probabilité modélisée. Vous conviendrez qu’il ne s’agit pas d’une échelle très intuitive, la plupart du temps, seuls la significativité et le signe (positif ou négatif) des coefficients sont interprétés.</p>
<table>
<caption>
(#tab:probitdentity)Carte d’identité du modèle probit binomial
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable binaire (0 ou 1) ou comptage de réussite à une expérience (ex : 3 réussites sur 5 expériences)
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Binomiale
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim Binomial(p)\)</span> <br/> <span class="math inline">\(g(p) = \beta_0 + \beta X\)</span> <br/> <span class="math inline">\(g(x) = \Phi^-1(x)\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
probit
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
p
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
Non séparation complète, absence de sur-dispersion ou sous-dispersion
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect0823" class="section level3">
<h3><span class="header-section-number">8.2.3</span> Modèle logistique des cotes proportionnelles</h3>
<p>Le modèle logistique des cotes proportionnelles (aussi appelé modèle logistique cumulatif) est utilisé pour modéliser une variable qualitative ordinale. Un exemple classique de ce type de variable est une échelle de satisfaction (très insatisfait, insatisfait, mitigé, satisfait, très satisfait) qui peut être recodée avec des valeurs numériques (0, 1, 2, 3, 4; ces échelons étant notés <em>j</em>). Il n’existe pas à proprement parler de distribution pour représenter ces données, mais avec une petite astuce, il est possible de simplement utiliser la distribution binomiale. Cette astuce consiste à poser l’hypothèse de la proportionnalité des cotes, soit que le passage de la catégorie 0 à la catégorie 1 est proportionnel au passage de la catégorie 1 à la catégorie 2 et ainsi de suite. Si cette hypothèse est respectée, alors les coefficients du modèle pourront autant décrire le passage de la catégorie <em>satisfait</em> à celle <em>très satisfait</em> que le passage de <em>insatisfait</em> à <em>mitigé</em>. Si cette hypothèse n’est pas respectée, il faudrait des coefficients différents pour représenter les passages d’une catégorie à l’autre (ce qui est le cas pour le modèle multinomial présenté dans la section @ref(sect0824)).</p>
<table>
<caption>
(#tab:cumuldentity)Carte d’identité du modèle logistique des cotes proportionnelles
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable qualitative ordinale avec <em>j</em> catégories
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Binomiale
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim Binomial(p)\)</span> <br/> <span class="math inline">\(g(p \leq j) = \beta_{0j} + \beta X\)</span> <br/> <span class="math inline">\(g(x) = log(\frac{x}{1-x})\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
logistique
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
p
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta\)</span> et <em>j</em>-1 constantes <span class="math inline">\(\beta_{0j}\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
Non séparation complète, absence de sur-dispersion ou sous-dispersion, Proportionnalité des cotes
</td>
</tr>
</tbody>
</table>
<p>Ainsi, dans le modèle logistique binomial vu précédemment, nous modélisons la probabilité d’observer un évènement <span class="math inline">\(P(Y = 1)\)</span>. Dans un modèle logistique ordinal, nous modélisons la probabilité cumulative d’observer l’échelon <em>j</em> de notre variable ordinale <span class="math inline">\(P(Y \leq j)\)</span>. L’intérêt de cette reformulation est que nous conservons la facilité d’interprétation du modèle logistique binomial classique avec les rapports de cotes, à ceci prêt qu’ils représentent maintenant la probabilité de passer à un échelon supérieur de <em>Y</em>. La différence pratique est que notre modèle se retrouve avec autant de constantes qu’il y a de catégories à prédire moins une, chacune de ces constantes contrôlant la probabilité de base de passer de la catégorie <em>j</em> à la catégorie <em>j</em>+1.</p>
<div id="conditions-dapplication" class="section level4">
<h4><span class="header-section-number">8.2.3.1</span> Conditions d’application</h4>
<p>Les conditions d’application sont les mêmes que pour un modèle binomial, avec bien sûr l’ajout de l’hypothèse sur la proportionnalité des cotes. Selon cette hypothèse, l’impact de chaque variable indépendante est identique sur la probabilité de passer d’un échelon de la variable <em>Y</em> au suivant. Afin de tester cette condition, deux approches sont envisageables :</p>
<ol style="list-style-type: decimal">
<li>Utiliser l’approche de Brant <span class="citation">(<a href="#ref-brant1990assessing" role="doc-biblioref">1990</a>)</span>. Il s’agit d’un test statistique comparant les résultats du modèle ordinal avec ceux d’une série de modèles logistiques binomiaux (1 pour chaque catégorie possible de <em>Y</em>).</li>
<li>Ajuster un modèle ordinal sans l’hypothèse de proportionnalité des cotes et effectuer un test de ratio des <em>likelihood</em> pour vérifier si le premier est significativement mieux ajusté.</li>
</ol>
<p>Si certaines variables ne respectent pas cette condition d’application, trois options sont possibles pour y remédier :</p>
<ol style="list-style-type: decimal">
<li>Supprimer la variable du modèle (à éviter si cette variable est importante dans votre cadre théorique).</li>
<li>Autoriser la variable à avoir un effet différent entre chaque palier (possible avec le <em>package</em> <code>VGAM</code>).</li>
<li>Changer de modèle et opter pour un modèle des catégories adjacentes. Il s’agit du cas particulier où toutes les variables sont autorisées à changer à chaque niveau. Ne pas confondre ce dernier modèle et le modèle multinomial (section @ref(sect0824))), puisque le modèle des catégories adjacentes continues à prédire la probabilité de passer à une catégorie supérieure.</li>
</ol>
</div>
<div id="exemple-appliqué-dans-r" class="section level4">
<h4><span class="header-section-number">8.2.3.2</span> Exemple appliqué dans R</h4>
<p>Pour cet exemple, nous allons analyser un jeu de données proposé par <a href="http://insideairbnb.com/get-the-data.html">Inside Airbnb</a>, une organisation sans but lucratif collectant des données des annonces sur le site d’Airbnb pour alimenter le débat sur l’impact de cette société sur les quartiers. Plus spécifiquement, nous utilisons le jeu de données pour Montréal compilé le 30 juin 2020. Nous modélisons ici le prix par nuit des logements, ce type d’exercice est appelé modélisation hédonique. Il est particulièrement utilisé en économie urbaine pour évaluer les déterminants du marché immobilier et prédire son évolution. Le cas d’Airbnb a déjà été étudié dans plusieurs articles <span class="citation">(Teubner, Hawlitschek et Dann <a href="#ref-teubner2017price" role="doc-biblioref">2017</a>; Wang et Nicolau <a href="#ref-wang2017price" role="doc-biblioref">2017</a>; Zhang et al. <a href="#ref-zhang2017key" role="doc-biblioref">2017</a>)</span>, il en ressort notamment que le niveau de confiance inspiré par l’hôte, les caractéristiques intrinsèques du logement et sa localisation sont les principales variables indépendantes de son prix. Nous construisons donc notre modèle sur cette base. Notez que nous avons décidé de retirer les logements avec des prix supérieurs à 250 $ par nuit qui constituent des cas particuliers et qui devraient faire l’objet d’une analyse à part entière. Nous avons également retiré les observations pour lesquelles certaines données sont manquantes, et obtenons un nombre final de 9 051 observations.</p>
<p>La distribution originale du prix des logements dans notre jeu de données est présentée à la figure @ref(fig:histopriceairbnb).</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="#cb784-1"></a><span class="co"># Charger le jeu de données</span></span>
<span id="cb784-2"><a href="#cb784-2"></a>data_airbnb &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/glm/airbnb_data.csv&quot;</span>)</span>
<span id="cb784-3"><a href="#cb784-3"></a><span class="co"># Afficher la distribution du prix</span></span>
<span id="cb784-4"><a href="#cb784-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> data_airbnb) <span class="op">+</span><span class="st"> </span></span>
<span id="cb784-5"><a href="#cb784-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> price), <span class="dt">bins =</span> <span class="dv">30</span>, </span>
<span id="cb784-6"><a href="#cb784-6"></a>                 <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#1d3557&quot;</span>, <span class="dt">size =</span> <span class="fl">0.02</span>)<span class="op">+</span></span>
<span id="cb784-7"><a href="#cb784-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Prix (en dollars)&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Fréquence&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/histopriceairbnb-1.png" alt="Distribution des prix des logements Airbnb" width="65%" />
<p class="caption">
(#fig:histopriceairbnb)Distribution des prix des logements Airbnb
</p>
</div>
<p>Nous avons ensuite découpé le prix des logements en trois catégories : inférieur à 50 $, entre 50 $ et 99 $ et entre 100 $ et 249 $. Ces catégories forment une variable ordinale de trois échelons que nous modélisons à partir de trois catégories de variables :</p>
<ul>
<li>les caractéristiques propres au logement;</li>
<li>les caractéristiques environnementales autour du logement;</li>
<li>les notes obtenues par le logement sur le site d’Airbnb.</li>
</ul>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="#cb785-1"></a><span class="co"># Afficher le nombre de logement par catégories</span></span>
<span id="cb785-2"><a href="#cb785-2"></a><span class="kw">table</span>(data_airbnb<span class="op">$</span>fac_price_cat)</span></code></pre></div>
<pre><code>## 
##    1    2    3 
## 2212 3911 2928</code></pre>
<p>Le tableau @ref(tab:variablecumul) présente l’ensemble des variables utilisées dans le modèle.</p>
<table>
<caption>
(#tab:variablecumul)Variables indépendantes utilisées pour prédire la catégorie de prix de logements Airbnb
</caption>
<thead>
<tr>
<th style="text-align:left;">
Nom de la variable
</th>
<th style="text-align:left;">
Description
</th>
<th style="text-align:left;">
Type de variable
</th>
<th style="text-align:left;">
Mesure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
beds
</td>
<td style="text-align:left;">
Nombre de lits dans le logement
</td>
<td style="text-align:left;">
Variable de comptage
</td>
<td style="text-align:left;">
Nombre de lits dans le logement
</td>
</tr>
<tr>
<td style="text-align:left;">
Garden_or_backyard
</td>
<td style="text-align:left;">
Présence d’un jardin ou d’une arrière-cour
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
Oui ou Non
</td>
</tr>
<tr>
<td style="text-align:left;">
private
</td>
<td style="text-align:left;">
Le logement est entièrement à disposition du locataire ou seulement une pièce
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
Privé ou partagé
</td>
</tr>
<tr>
<td style="text-align:left;">
Free_street_parking
</td>
<td style="text-align:left;">
Une place de stationnement gratuite est disponible sur la rue
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
Oui ou Non
</td>
</tr>
<tr>
<td style="text-align:left;">
Host_greets_you
</td>
<td style="text-align:left;">
L’hôte accueille personnellement les locataires
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
Oui ou Non
</td>
</tr>
<tr>
<td style="text-align:left;">
prt_veg_500m
</td>
<td style="text-align:left;">
Végétation dans les environs du logement
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Pourcentage de surface végétale dans un rayon de 500m autour du logement
</td>
</tr>
<tr>
<td style="text-align:left;">
has_metro_500m
</td>
<td style="text-align:left;">
Présence d’une station de métro à proximité du logement
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
Présence d’une station de métro dans un rayon de 500 mètres autour du logement
</td>
</tr>
<tr>
<td style="text-align:left;">
commercial_1km
</td>
<td style="text-align:left;">
Commerce dans les environs du logement
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Pourcentage de surface dédiée au commerce (mode d’occupation du sol) dans un rayon d’un kilomètre autour du logement
</td>
</tr>
<tr>
<td style="text-align:left;">
cat_review
</td>
<td style="text-align:left;">
Évaluation de la qualité du logement par les usagers
</td>
<td style="text-align:left;">
Variable ordinale
</td>
<td style="text-align:left;">
Note obtenu par le logement sur une échelle allant de 1 (très mauvais) à 5 (parfait)
</td>
</tr>
<tr>
<td style="text-align:left;">
host_total_listings_count
</td>
<td style="text-align:left;">
Nombre total de logements détenus par l’hôte sur Airbnb
</td>
<td style="text-align:left;">
Variable de comptage
</td>
<td style="text-align:left;">
Nombre total de logements détenus par l’hôte sur Airbnb
</td>
</tr>
</tbody>
</table>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Avant d’ajuster le modèle, il convient de vérifier l’absence de multicolinéarité excessive entre les variables indépendantes.</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb787-1"><a href="#cb787-1"></a><span class="co"># Notez que la fonction vif ne s&#39;intéresse qu&#39;aux variables indépendantes.</span></span>
<span id="cb787-2"><a href="#cb787-2"></a><span class="co"># Vous pouvez ainsi utiliser la fonction glm avec la fonction vif </span></span>
<span id="cb787-3"><a href="#cb787-3"></a><span class="co"># pour n&#39;importe quel modèle glm</span></span>
<span id="cb787-4"><a href="#cb787-4"></a><span class="kw">vif</span>(<span class="kw">glm</span>(price <span class="op">~</span><span class="st"> </span>beds <span class="op">+</span></span>
<span id="cb787-5"><a href="#cb787-5"></a><span class="st">    </span>Garden_or_backyard <span class="op">+</span><span class="st"> </span>Host_greets_you <span class="op">+</span><span class="st"> </span>Free_street_parking <span class="op">+</span><span class="st"> </span></span>
<span id="cb787-6"><a href="#cb787-6"></a><span class="st">      </span>prt_veg_500m <span class="op">+</span><span class="st"> </span>has_metro_500m <span class="op">+</span><span class="st"> </span>commercial_1km <span class="op">+</span>host_total_listings_count <span class="op">+</span></span>
<span id="cb787-7"><a href="#cb787-7"></a><span class="st">      </span>private <span class="op">+</span><span class="st"> </span>cat_review, <span class="dt">data =</span> data_airbnb))</span></code></pre></div>
<pre><code>##                      beds        Garden_or_backyard           Host_greets_you 
##                  1.123595                  1.079324                  1.046884 
##       Free_street_parking              prt_veg_500m            has_metro_500m 
##                  1.142189                  1.532536                  1.239516 
##            commercial_1km host_total_listings_count                   private 
##                  1.225301                  1.058232                  1.143932 
##                cat_review 
##                  1.015778</code></pre>
<p>Toutes les valeurs de VIF sont inférieures à 2, indiquant une absence de multicolinéarité excessive. Nous pouvons alors ajuster le modèle et analyser les distances de Cook afin de vérifier la présence ou non d’observations très influentes. Pour ajuster le modèle, nous utilisons le <em>package</em> <code>VGAM</code> et la fonction <code>vglm</code> qui nous donnent accès à la famille <code>cumulative</code> pour ajuster des modèles logistiques ordinaux. Notez que le fonctionnement de base de cette famille est de modéliser <span class="math inline">\(P(Y\leq1),P(Y\leq2),...,P(Y\leq J)\)</span> avec <em>J</em> le nombre de catégories. Cependant, nous voulons ici modéliser la probabilité de passer à une catégorie supérieure de prix. Pour cela, il est nécessaire de spécifier le paramètre <code>reverse = TRUE</code> pour la famille <code>cumulative</code> (voir <code>help(cumulative)</code> pour plus de détail).</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="#cb789-1"></a><span class="kw">library</span>(VGAM)</span>
<span id="cb789-2"><a href="#cb789-2"></a>modele &lt;-<span class="st"> </span><span class="kw">vglm</span>(fac_price_cat <span class="op">~</span><span class="st"> </span>beds <span class="op">+</span></span>
<span id="cb789-3"><a href="#cb789-3"></a><span class="st">                </span>Garden_or_backyard <span class="op">+</span><span class="st"> </span>Free_street_parking <span class="op">+</span><span class="st"> </span></span>
<span id="cb789-4"><a href="#cb789-4"></a><span class="st">                </span>prt_veg_500m <span class="op">+</span><span class="st"> </span>has_metro_500m <span class="op">+</span><span class="st"> </span>commercial_1km <span class="op">+</span></span>
<span id="cb789-5"><a href="#cb789-5"></a><span class="st">                </span>private <span class="op">+</span><span class="st"> </span>cat_review <span class="op">+</span><span class="st"> </span>host_total_listings_count ,</span>
<span id="cb789-6"><a href="#cb789-6"></a>             <span class="dt">family =</span> <span class="kw">cumulative</span>(<span class="dt">link=</span><span class="st">&quot;logitlink&quot;</span>, <span class="co"># fonction de lien </span></span>
<span id="cb789-7"><a href="#cb789-7"></a>                                 <span class="dt">parallel =</span> <span class="ot">TRUE</span>, <span class="co"># cote proportionelle</span></span>
<span id="cb789-8"><a href="#cb789-8"></a>                                 <span class="dt">reverse =</span> <span class="ot">TRUE</span>),</span>
<span id="cb789-9"><a href="#cb789-9"></a>             <span class="dt">data =</span> data_airbnb, <span class="dt">model =</span> T)</span></code></pre></div>
<p>Notez que puisque la variable <em>Y</em> a trois catégories différentes et que nous modélisons la probabilité de passer à une catégorie supérieure, chaque observation a alors deux (3-1) valeurs de résidus différentes. Par conséquent, nous calculons deux distances de Cook différentes que nous devons analyser conjointement. Malheureusement, la fonction <code>cook.distance</code> ne fonctionne pas avec les objets <code>vglm</code>, nous devons donc les calculer manuellement.</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb790-1"><a href="#cb790-1"></a><span class="co"># Extraction des résidus</span></span>
<span id="cb790-2"><a href="#cb790-2"></a>res &lt;-<span class="st"> </span><span class="kw">residuals</span>(modele, <span class="dt">type =</span> <span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb790-3"><a href="#cb790-3"></a><span class="co"># Extraction de la hat matrix (nécessaire pour calculer la distance de Cook)</span></span>
<span id="cb790-4"><a href="#cb790-4"></a>hat &lt;-<span class="st"> </span><span class="kw">hatvaluesvlm</span>(modele)</span>
<span id="cb790-5"><a href="#cb790-5"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb790-6"><a href="#cb790-6"></a>cooks &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(res),<span class="cf">function</span>(i){</span>
<span id="cb790-7"><a href="#cb790-7"></a>  r &lt;-<span class="st"> </span>res[,i]</span>
<span id="cb790-8"><a href="#cb790-8"></a>  h &lt;-<span class="st"> </span>hat[,i]</span>
<span id="cb790-9"><a href="#cb790-9"></a>  cook &lt;-<span class="st"> </span>(r<span class="op">/</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>h))<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>h<span class="op">/</span>(<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>modele<span class="op">@</span>rank)</span>
<span id="cb790-10"><a href="#cb790-10"></a>})</span>
<span id="cb790-11"><a href="#cb790-11"></a><span class="co"># Structuration dans un DataFrame</span></span>
<span id="cb790-12"><a href="#cb790-12"></a>matcook &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">do.call</span>(cbind, cooks))</span>
<span id="cb790-13"><a href="#cb790-13"></a><span class="kw">names</span>(matcook) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dist1&quot;</span>,<span class="st">&quot;dist2&quot;</span>)</span>
<span id="cb790-14"><a href="#cb790-14"></a>matcook<span class="op">$</span>oid &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(matcook)</span>
<span id="cb790-15"><a href="#cb790-15"></a><span class="co"># Afficher les distances de Cook</span></span>
<span id="cb790-16"><a href="#cb790-16"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> matcook) <span class="op">+</span><span class="st"> </span></span>
<span id="cb790-17"><a href="#cb790-17"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> dist1), <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb790-18"><a href="#cb790-18"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;distance de Cook P(Y&gt;=2)&quot;</span>)<span class="op">+</span></span>
<span id="cb790-19"><a href="#cb790-19"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb790-20"><a href="#cb790-20"></a>        <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>())</span>
<span id="cb790-21"><a href="#cb790-21"></a>plot2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> matcook) <span class="op">+</span><span class="st"> </span></span>
<span id="cb790-22"><a href="#cb790-22"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> dist2), <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb790-23"><a href="#cb790-23"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot;distance de Cook P(Y&gt;=3)&quot;</span>)<span class="op">+</span></span>
<span id="cb790-24"><a href="#cb790-24"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb790-25"><a href="#cb790-25"></a>        <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>())</span>
<span id="cb790-26"><a href="#cb790-26"></a></span>
<span id="cb790-27"><a href="#cb790-27"></a><span class="kw">ggarrange</span>(plot1, plot2, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/CookdCotePropor-1.png" alt="Distances de Cook pour le modèle logistique des cotes proportionnelles" width="65%" />
<p class="caption">
(#fig:CookdCotePropor)Distances de Cook pour le modèle logistique des cotes proportionnelles
</p>
</div>
<p>Les distances de Cook (figure @ref(fig:CookdCotePropor)) nous permettent d’identifier quelques observations potentiellement trop influentes, mais elles semblent être différentes d’un graphique à l’autre. Nous décidons donc de ne pas retirer d’observations à ce stade et de passer à l’analyse des résidus simulés. Pour effectuer des simulations à partir de ce modèle, nous nous basons sur les probabilités d’appartenance prédites par le modèle.</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="#cb791-1"></a><span class="co"># Extraire les probabilités prédites</span></span>
<span id="cb791-2"><a href="#cb791-2"></a>predicted &lt;-<span class="st"> </span><span class="kw">predict</span>(modele,<span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb791-3"><a href="#cb791-3"></a><span class="kw">round</span>(<span class="kw">head</span>(predicted,<span class="dt">n =</span> <span class="dv">4</span>),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##       1     2     3
## 1 0.706 0.267 0.028
## 2 0.073 0.461 0.466
## 3 0.687 0.283 0.030
## 4 0.049 0.383 0.568</code></pre>
<p>Nous constatons ainsi que pour la première observation, la probabilité prédite d’appartenir au groupe 1 est de 69,4 %, 27,7 % pour le groupe 2 et 2,9 % pour le groupe 3. Si nous effectuons 1 000 simulations, nous pouvons nous attendre à ce qu’en moyenne, sur ces 1 000 simulations, 694 indiqueront 1 comme catégorie prédite, 277 indiqueront 2 et seulement 29 indiqueront 3.</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="#cb793-1"></a><span class="co"># Nous effectuerons 1000 simulations</span></span>
<span id="cb793-2"><a href="#cb793-2"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb793-3"><a href="#cb793-3"></a><span class="co"># Lancement des simulations pour chaque observation (lignes dans predicted)</span></span>
<span id="cb793-4"><a href="#cb793-4"></a>simulations &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(predicted), <span class="cf">function</span>(i){</span>
<span id="cb793-5"><a href="#cb793-5"></a>  probs &lt;-<span class="st"> </span>predicted[i,]</span>
<span id="cb793-6"><a href="#cb793-6"></a>  sims &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">size =</span> nsim, <span class="dt">replace =</span> T, <span class="dt">prob =</span> probs)</span>
<span id="cb793-7"><a href="#cb793-7"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb793-8"><a href="#cb793-8"></a>})</span>
<span id="cb793-9"><a href="#cb793-9"></a><span class="co"># Combiner les prédictions dans un tableau</span></span>
<span id="cb793-10"><a href="#cb793-10"></a>matsim &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, simulations)</span>
<span id="cb793-11"><a href="#cb793-11"></a><span class="co"># Observons si nos simulations sont proches de ce que nous attendions</span></span>
<span id="cb793-12"><a href="#cb793-12"></a><span class="kw">table</span>(matsim[<span class="dv">1</span>,])</span></code></pre></div>
<pre><code>## 
##   1   2   3 
## 694 278  28</code></pre>
<p>À partir de ces simulations de prédiction, nous pouvons réaliser un diagnostic des résidus simulés grâce au <em>package</em> <code>DHARMa</code>.</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="#cb795-1"></a><span class="kw">library</span>(DHARMa)</span>
<span id="cb795-2"><a href="#cb795-2"></a><span class="co"># Extraction de la prédiction moyenne du modèle</span></span>
<span id="cb795-3"><a href="#cb795-3"></a>pred_cat &lt;-<span class="st"> </span><span class="kw">unique</span>(data_airbnb<span class="op">$</span>fac_price_cat)[<span class="kw">max.col</span>(predicted)]</span>
<span id="cb795-4"><a href="#cb795-4"></a><span class="co"># Préparer les données avec le package DHARMa</span></span>
<span id="cb795-5"><a href="#cb795-5"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> matsim, </span>
<span id="cb795-6"><a href="#cb795-6"></a>                            <span class="dt">observedResponse =</span> <span class="kw">as.numeric</span>(data_airbnb<span class="op">$</span>fac_price_cat),</span>
<span id="cb795-7"><a href="#cb795-7"></a>                            <span class="dt">fittedPredictedResponse =</span> <span class="kw">as.numeric</span>(pred_cat),</span>
<span id="cb795-8"><a href="#cb795-8"></a>                            <span class="dt">integerResponse =</span> T)</span>
<span id="cb795-9"><a href="#cb795-9"></a><span class="co"># Afficher le graphique de diagnostic général</span></span>
<span id="cb795-10"><a href="#cb795-10"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/diagressimcumul-1.png" alt="Diagnostic général des résidus simulés du modèle des cotes proportionnelles" width="100%" />
<p class="caption">
(#fig:diagressimcumul)Diagnostic général des résidus simulés du modèle des cotes proportionnelles
</p>
</div>
<p>La figure @ref(fig:diagressimcumul) nous indique que les résidus simulés suivent bien une distribution uniforme et qu’aucune valeur aberrante n’est observable. Pour affiner notre diagnostic, nous vérifions également si aucune relation ne semble exister entre chaque variable indépendante et les résidus.</p>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb796-1"><a href="#cb796-1"></a><span class="co"># Préparons un plot multiple</span></span>
<span id="cb796-2"><a href="#cb796-2"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb796-3"><a href="#cb796-3"></a>vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;nombre de lits&quot;</span> =<span class="st"> &quot;beds&quot;</span>,</span>
<span id="cb796-4"><a href="#cb796-4"></a>          <span class="st">&quot;couvert végétal&quot;</span> =<span class="st"> &quot;prt_veg_500m&quot;</span>, </span>
<span id="cb796-5"><a href="#cb796-5"></a>          <span class="st">&quot;commercial&quot;</span> =<span class="st"> &quot;commercial_1km&quot;</span>,</span>
<span id="cb796-6"><a href="#cb796-6"></a>          <span class="st">&quot;nb logements hôte&quot;</span> =<span class="st"> &quot;host_total_listings_count&quot;</span>,</span>
<span id="cb796-7"><a href="#cb796-7"></a>          <span class="st">&quot;jardin&quot;</span> =<span class="st"> &quot;Garden_or_backyard&quot;</span>,</span>
<span id="cb796-8"><a href="#cb796-8"></a>          <span class="st">&quot;accueil&quot;</span> =<span class="st"> &quot;Host_greets_you&quot;</span>,</span>
<span id="cb796-9"><a href="#cb796-9"></a>          <span class="st">&quot;stationnement gratuit&quot;</span> =<span class="st"> &quot;Free_street_parking&quot;</span>, </span>
<span id="cb796-10"><a href="#cb796-10"></a>          <span class="st">&quot;métro&quot;</span> =<span class="st"> &quot;has_metro_500m&quot;</span>, </span>
<span id="cb796-11"><a href="#cb796-11"></a>          <span class="st">&quot;logement privé&quot;</span> =<span class="st"> &quot;private&quot;</span>,</span>
<span id="cb796-12"><a href="#cb796-12"></a>          <span class="st">&quot;évaluation&quot;</span> =<span class="st"> &quot;cat_review&quot;</span>)</span>
<span id="cb796-13"><a href="#cb796-13"></a></span>
<span id="cb796-14"><a href="#cb796-14"></a><span class="cf">for</span>(name <span class="cf">in</span>  <span class="kw">names</span>(vars)){</span>
<span id="cb796-15"><a href="#cb796-15"></a>  v &lt;-<span class="st"> </span>vars[[name]]</span>
<span id="cb796-16"><a href="#cb796-16"></a>  <span class="kw">plotResiduals</span>(sim_res, data_airbnb[[v]], <span class="dt">rank =</span> F, <span class="dt">quantreg =</span> F, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb796-17"><a href="#cb796-17"></a>                <span class="dt">xlab =</span> name, <span class="dt">ylab =</span> <span class="st">&quot;résidus&quot;</span>)</span>
<span id="cb796-18"><a href="#cb796-18"></a>}</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/glm/diagressimcumul2.png" alt="Diagnostic des variables indépendantes et des résidus simulés du modèle des cotes proportionnelles" width="100%" />
<p class="caption">
(#fig:diagressimcumul2)Diagnostic des variables indépendantes et des résidus simulés du modèle des cotes proportionnelles
</p>
</div>
<p>La fonction <code>plotResiduals</code> du <em>package</em> <code>DHARMa</code> produit des graphiques peu esthétiques, mais pratiques pour effectuer ce type de diagnostic.</p>
<p>La figure @ref(fig:diagressimcumul2) indique qu’aucune relation marquée n’existe entre nos variables indépendantes et nos résidus simulés, sauf pour la variable nombre de lits. En effet, nous pouvons constater que les résidus ont tendance à être toujours plus faibles quand le nombre de lits augmente. Cet effet est sûrement lié au fait qu’au-delà de cinq lits, le logement en question est vraisemblablement un dortoir. Il pourrait être judicieux de retirer ces observations de l’analyse, considérant qu’elles sont peu nombreuses et constituent un type de logement particulier.</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="#cb797-1"></a>data_airbnb2 &lt;-<span class="st"> </span><span class="kw">subset</span>(data_airbnb, data_airbnb<span class="op">$</span>beds <span class="op">&lt;=</span><span class="dv">5</span>)</span>
<span id="cb797-2"><a href="#cb797-2"></a>modele2 &lt;-<span class="st"> </span><span class="kw">vglm</span>(fac_price_cat <span class="op">~</span><span class="st"> </span>beds  <span class="op">+</span><span class="st"> </span></span>
<span id="cb797-3"><a href="#cb797-3"></a><span class="st">                </span>Garden_or_backyard <span class="op">+</span><span class="st"> </span>Free_street_parking <span class="op">+</span><span class="st"> </span></span>
<span id="cb797-4"><a href="#cb797-4"></a><span class="st">                </span>prt_veg_500m <span class="op">+</span><span class="st"> </span>has_metro_500m <span class="op">+</span><span class="st"> </span>commercial_1km <span class="op">+</span></span>
<span id="cb797-5"><a href="#cb797-5"></a><span class="st">                </span>private <span class="op">+</span><span class="st"> </span>cat_review <span class="op">+</span><span class="st"> </span>host_total_listings_count ,</span>
<span id="cb797-6"><a href="#cb797-6"></a>             <span class="dt">family =</span> <span class="kw">cumulative</span>(<span class="dt">link=</span><span class="st">&quot;logitlink&quot;</span>, <span class="co"># fonction de lien </span></span>
<span id="cb797-7"><a href="#cb797-7"></a>                                 <span class="dt">parallel =</span> <span class="ot">TRUE</span>, <span class="co"># cote proportionelle</span></span>
<span id="cb797-8"><a href="#cb797-8"></a>                                 <span class="dt">reverse =</span> <span class="ot">TRUE</span>),</span>
<span id="cb797-9"><a href="#cb797-9"></a>             <span class="dt">data =</span> data_airbnb2, <span class="dt">model =</span> T)</span></code></pre></div>
<p>Nous pouvons ensuite recalculer les résidus simulés pour observer si cette tendance a été corrigée. La figure @ref(fig:diagressimcumul3) montre qu’une bonne partie du problème a été corrigée, cependant il semble tout de même que les résidus soient plus forts pour les logements avec un seul lit.</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="#cb798-1"></a><span class="co"># Nous effectuerons 1000 simulations</span></span>
<span id="cb798-2"><a href="#cb798-2"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb798-3"><a href="#cb798-3"></a>predicted &lt;-<span class="st"> </span><span class="kw">predict</span>(modele2, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb798-4"><a href="#cb798-4"></a><span class="co"># Lancement des simulations pour chaque observation (lignes dans predicted)</span></span>
<span id="cb798-5"><a href="#cb798-5"></a>simulations &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(predicted), <span class="cf">function</span>(i){</span>
<span id="cb798-6"><a href="#cb798-6"></a>  probs &lt;-<span class="st"> </span>predicted[i,]</span>
<span id="cb798-7"><a href="#cb798-7"></a>  sims &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">size =</span> nsim, <span class="dt">replace =</span> T, <span class="dt">prob =</span> probs)</span>
<span id="cb798-8"><a href="#cb798-8"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb798-9"><a href="#cb798-9"></a>})</span>
<span id="cb798-10"><a href="#cb798-10"></a><span class="co"># Combiner les prédictions dans un tableau</span></span>
<span id="cb798-11"><a href="#cb798-11"></a>matsim &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, simulations)</span>
<span id="cb798-12"><a href="#cb798-12"></a><span class="co"># Extraction de la prédiction moyenne du modèle</span></span>
<span id="cb798-13"><a href="#cb798-13"></a>pred_cat &lt;-<span class="st"> </span><span class="kw">unique</span>(data_airbnb2<span class="op">$</span>fac_price_cat)[<span class="kw">max.col</span>(predicted)]</span>
<span id="cb798-14"><a href="#cb798-14"></a><span class="co"># Préparer les donnees avec le package DHARMa</span></span>
<span id="cb798-15"><a href="#cb798-15"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> matsim, </span>
<span id="cb798-16"><a href="#cb798-16"></a>                            <span class="dt">observedResponse =</span> <span class="kw">as.numeric</span>(data_airbnb2<span class="op">$</span>fac_price_cat),</span>
<span id="cb798-17"><a href="#cb798-17"></a>                            <span class="dt">fittedPredictedResponse =</span> <span class="kw">as.numeric</span>(pred_cat),</span>
<span id="cb798-18"><a href="#cb798-18"></a>                            <span class="dt">integerResponse =</span> T)</span></code></pre></div>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="#cb799-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb799-2"><a href="#cb799-2"></a>vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;nombre de lits&quot;</span> =<span class="st"> &quot;beds&quot;</span>,</span>
<span id="cb799-3"><a href="#cb799-3"></a>          <span class="st">&quot;couvert végétal&quot;</span> =<span class="st"> &quot;prt_veg_500m&quot;</span>, </span>
<span id="cb799-4"><a href="#cb799-4"></a>          <span class="st">&quot;commercial&quot;</span> =<span class="st"> &quot;commercial_1km&quot;</span>,</span>
<span id="cb799-5"><a href="#cb799-5"></a>          <span class="st">&quot;nb logements hôte&quot;</span> =<span class="st"> &quot;host_total_listings_count&quot;</span>,</span>
<span id="cb799-6"><a href="#cb799-6"></a>          <span class="st">&quot;jardin&quot;</span> =<span class="st"> &quot;Garden_or_backyard&quot;</span>,</span>
<span id="cb799-7"><a href="#cb799-7"></a>          <span class="st">&quot;accueil&quot;</span> =<span class="st"> &quot;Host_greets_you&quot;</span>,</span>
<span id="cb799-8"><a href="#cb799-8"></a>          <span class="st">&quot;stationnement gratuit&quot;</span> =<span class="st"> &quot;Free_street_parking&quot;</span>, </span>
<span id="cb799-9"><a href="#cb799-9"></a>          <span class="st">&quot;métro&quot;</span> =<span class="st"> &quot;has_metro_500m&quot;</span>, </span>
<span id="cb799-10"><a href="#cb799-10"></a>          <span class="st">&quot;logement privé&quot;</span> =<span class="st"> &quot;private&quot;</span>,</span>
<span id="cb799-11"><a href="#cb799-11"></a>          <span class="st">&quot;évaluation&quot;</span> =<span class="st"> &quot;cat_review&quot;</span>)</span>
<span id="cb799-12"><a href="#cb799-12"></a></span>
<span id="cb799-13"><a href="#cb799-13"></a><span class="cf">for</span>(name <span class="cf">in</span>  <span class="kw">names</span>(vars)){</span>
<span id="cb799-14"><a href="#cb799-14"></a>  v &lt;-<span class="st"> </span>vars[[name]]</span>
<span id="cb799-15"><a href="#cb799-15"></a>  <span class="kw">plotResiduals</span>(sim_res, data_airbnb2[[v]], <span class="dt">rank =</span> F, <span class="dt">quantreg =</span> F, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb799-16"><a href="#cb799-16"></a>                <span class="dt">xlab =</span> name, <span class="dt">ylab =</span> <span class="st">&quot;résidus&quot;</span>)</span>
<span id="cb799-17"><a href="#cb799-17"></a>}</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/glm/diagressimcumul3.png" alt="Diagnostic des variables indépendantes et des résidus simulés du modèle des cotes proportionnelles (arpès correction)" width="100%" />
<p class="caption">
(#fig:diagressimcumul3)Diagnostic des variables indépendantes et des résidus simulés du modèle des cotes proportionnelles (arpès correction)
</p>
</div>
<p>La prochaine étape du diagnostic est de vérifier si nous n’avons pas de séparation parfaite provoquée par une de nos variable indépendantes. Le <em>package</em> <code>VGAM</code> propose pour cela la fonction <code>hdeff</code>.</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="#cb800-1"></a>tests &lt;-<span class="st"> </span><span class="kw">hdeff</span>(modele2)</span>
<span id="cb800-2"><a href="#cb800-2"></a>problem &lt;-<span class="st"> </span><span class="kw">table</span>(tests)</span>
<span id="cb800-3"><a href="#cb800-3"></a>problem</span></code></pre></div>
<pre><code>## tests
## FALSE 
##    11</code></pre>
<p>La fonction nous informe qu’aucune de nos variables indépendantes ne provoque de séparation parfaite : toutes les valeurs renvoyées par la fonction <code>hdeff</code> sont égales à <code>FALSE.</code></p>
<p>Il ne nous reste donc plus qu’à vérifier que l’hypothèse de proportionnalité des cotes est respectée, soit que l’impact de chacune des variables indépendantes est bien le même pour passer de la catégorie 1 à 2 que pour passer des catégories 2 à 3. Pour cela, deux approches sont possibles : le test de Brant ou la réalisation d’une séquence de tests de rapport de vraisemblance.</p>
<p>Le <em>package</em> <code>brant</code> propose une implémentation du test de Brant, mais elle ne peut être appliquée qu’à des modèles construits avec la fonction <code>polr</code> du <em>package</em> <code>MASS</code>. Nous avons donc récupéré le code source de la fonction <code>brant</code> du <em>package</em> <code>brant</code> et apporté quelques modifications pour qu’elle soit utilisable sur un objet <code>vglm</code>. Cette nouvelle fonction appelée <code>brant.vglm</code> est disponible dans le code source de ce livre.</p>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="#cb802-1"></a>tableau_brant &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">brant.vglm</span>(modele2),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## ------------------------------------------------------------ 
## Test for         X2  df  probability 
## ------------------------------------------------------------ 
## Omnibus              113.72  9   0
## beds             0.63    1   0.43
## Garden_or_backyardYES        0.16    1   0.69
## Free_street_parkingYES   0.84    1   0.36
## prt_veg_500m         6.49    1   0.01
## has_metro_500mYES        0.02    1   0.89
## commercial_1km           0.01    1   0.92
## privateEntier            93.56   1   0
## cat_review           0.63    1   0.43
## host_total_listings_count    1.51    1   0.22
## ------------------------------------------------------------ 
## 
## H0: Parallel Regression Assumption holds</code></pre>
<p>Ce premier tableau nous indique que seule la variable indiquant si le logement est disponible en entier ou partagé contrevient à l’hypothèse de proportionnalité des cotes (la seule valeur <em>p</em> significative). Pour confirmer cette observation, nous pouvons réaliser un ensemble de tests de rapport de vraisemblance. Pour chaque variable du modèle, nous allons créer un second modèle dans lequel cette variable est autorisée à varier pour chaque catégorie et comparer les niveaux d’ajustement des modèles. Nous avons implémenté cette procédure dans la fonction <code>parallel.likelihoodtest.vglm</code> disponible dans le code source de ce livre.</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="#cb804-1"></a>tableau_likelihood &lt;-<span class="st"> </span><span class="kw">parallel.likelihoodtest.vglm</span>(modele2, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb804-2"><a href="#cb804-2"></a><span class="kw">print</span>(tableau_likelihood)</span></code></pre></div>
<pre><code>##      variable non parallele   AIC loglikelihood p.val loglikelihood ratio test
## 1                      beds 15304         -7640                          0.271
## 2        Garden_or_backyard 15305         -7641                          0.417
## 3       Free_street_parking 15301         -7639                          0.079
## 4              prt_veg_500m 15296         -7636                          0.007
## 5            has_metro_500m 15303         -7640                          0.191
## 6            commercial_1km 15305         -7640                          0.271
## 7                   private 15215         -7595                          0.000
## 8                cat_review 15306         -7641                          0.430
## 9 host_total_listings_count 15304         -7640                          0.257</code></pre>
<p>Les résultats de cette seconde série de tests confirment les précédents, la variable concernant le type de logement doit être autorisée à varier en fonction de la catégorie. Ce second tableau nous indique que la variable concernant la densité de végétation pourrait aussi être amenée à varier en fonction du groupe, mais ce changement a un effet très marginal (différence entre les AICs de seulement 8 points). Nous ajustons donc un nouveau modèle autorisant la variable <code>private</code> à changer en fonction de la catégorie prédite.</p>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="#cb806-1"></a>modele3 &lt;-<span class="st"> </span><span class="kw">vglm</span>(fac_price_cat <span class="op">~</span><span class="st"> </span>beds <span class="op">+</span><span class="st"> </span></span>
<span id="cb806-2"><a href="#cb806-2"></a><span class="st">                  </span>Garden_or_backyard <span class="op">+</span><span class="st"> </span>Host_greets_you <span class="op">+</span><span class="st"> </span>Free_street_parking <span class="op">+</span><span class="st"> </span></span>
<span id="cb806-3"><a href="#cb806-3"></a><span class="st">                  </span>prt_veg_500m <span class="op">+</span><span class="st"> </span>has_metro_500m <span class="op">+</span><span class="st"> </span>commercial_1km <span class="op">+</span></span>
<span id="cb806-4"><a href="#cb806-4"></a><span class="st">                  </span>private <span class="op">+</span><span class="st"> </span>cat_review <span class="op">+</span><span class="st"> </span>host_total_listings_count,</span>
<span id="cb806-5"><a href="#cb806-5"></a>                <span class="dt">family =</span> <span class="kw">cumulative</span>(<span class="dt">link=</span><span class="st">&quot;logitlink&quot;</span>,</span>
<span id="cb806-6"><a href="#cb806-6"></a>                                    <span class="dt">parallel =</span> <span class="ot">FALSE</span> <span class="op">~</span><span class="st"> </span>private ,</span>
<span id="cb806-7"><a href="#cb806-7"></a>                                    <span class="dt">reverse =</span> <span class="ot">TRUE</span>),</span>
<span id="cb806-8"><a href="#cb806-8"></a>                <span class="dt">data =</span> data_airbnb2, <span class="dt">model =</span> T)</span></code></pre></div>
<p><strong>Vérifier l’ajustement du modèle</strong></p>
<p>Maintenant que toutes les conditions d’application ont été passées en revue, nous pouvons passer à la vérification de l’ajustement du modèle.</p>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb807-1"><a href="#cb807-1"></a>modelenull &lt;-<span class="st"> </span><span class="kw">vglm</span>(fac_price_cat <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb807-2"><a href="#cb807-2"></a>                <span class="dt">family =</span> <span class="kw">cumulative</span>(<span class="dt">link=</span><span class="st">&quot;logitlink&quot;</span>,</span>
<span id="cb807-3"><a href="#cb807-3"></a>                                    <span class="dt">parallel =</span> <span class="ot">TRUE</span>,</span>
<span id="cb807-4"><a href="#cb807-4"></a>                                    <span class="dt">reverse =</span> <span class="ot">TRUE</span>),</span>
<span id="cb807-5"><a href="#cb807-5"></a>                <span class="dt">data =</span> data_airbnb2, <span class="dt">model =</span> T)</span>
<span id="cb807-6"><a href="#cb807-6"></a><span class="kw">rsqs</span>(<span class="dt">loglike.full =</span> <span class="kw">logLik</span>(modele3),</span>
<span id="cb807-7"><a href="#cb807-7"></a>     <span class="dt">loglike.null =</span> <span class="kw">logLik</span>(modelenull),</span>
<span id="cb807-8"><a href="#cb807-8"></a>     <span class="dt">full.deviance =</span> <span class="kw">deviance</span>(modele3),</span>
<span id="cb807-9"><a href="#cb807-9"></a>     <span class="dt">null.deviance =</span> <span class="kw">deviance</span>(modelenull),</span>
<span id="cb807-10"><a href="#cb807-10"></a>     <span class="dt">nb.params =</span> modele3<span class="op">@</span>rank,</span>
<span id="cb807-11"><a href="#cb807-11"></a>     <span class="dt">n =</span> <span class="kw">nrow</span>(data_airbnb2)</span>
<span id="cb807-12"><a href="#cb807-12"></a>)</span></code></pre></div>
<pre><code>## $`deviance expliquee`
## [1] 0.2087098
## 
## $`McFadden ajuste`
## [1] 0.2073552
## 
## $`Cox and Snell`
## [1] 0.3606848
## 
## $Nagelkerke
## [1] 0.4085924</code></pre>
<p>Le modèle final parvient à expliquer 21 % de la déviance originale, il obtient un R<sup>2</sup> ajusté de McFadden de 0,21, et des R<sup>2</sup> de Cox et Snell et Nagelkerke de respectivement 0,36 et 0,41. Construisons à présent la matrice de confusion de la prédiction du modèle (nous utilisons ici la fonction <code>nice_confusion_matrix</code> également disponible dans le code source de ce livre).</p>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb809-1"><a href="#cb809-1"></a>preds_probs &lt;-<span class="st"> </span><span class="kw">fitted</span>(modele3)</span>
<span id="cb809-2"><a href="#cb809-2"></a>pred_cat &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)[<span class="kw">max.col</span>(preds_probs)]</span>
<span id="cb809-3"><a href="#cb809-3"></a><span class="kw">library</span>(caret)</span>
<span id="cb809-4"><a href="#cb809-4"></a>matrices &lt;-<span class="st"> </span><span class="kw">nice_confusion_matrix</span>(data_airbnb2<span class="op">$</span>fac_price_cat,pred_cat)</span>
<span id="cb809-5"><a href="#cb809-5"></a><span class="co"># Afficher la matrice de confusion</span></span>
<span id="cb809-6"><a href="#cb809-6"></a><span class="kw">print</span>(matrices<span class="op">$</span>confusion_matrix)</span></code></pre></div>
<pre><code>##           rowsnames    1          2          3          rs      rp    
## colsnames &quot;&quot;           &quot;1 (reel)&quot; &quot;2 (reel)&quot; &quot;3 (reel)&quot; &quot;Total&quot; &quot;%&quot;   
## 1         &quot;1 (predit)&quot; &quot;1576&quot;     &quot;736&quot;      &quot;168&quot;      &quot;2480&quot;  &quot;27.7&quot;
## 2         &quot;2 (predit)&quot; &quot;579&quot;      &quot;2385&quot;     &quot;1331&quot;     &quot;4295&quot;  &quot;48&quot;  
## 3         &quot;3 (predit)&quot; &quot;49&quot;       &quot;771&quot;      &quot;1360&quot;     &quot;2180&quot;  &quot;24.3&quot;
##           &quot;Total&quot;      &quot;2204&quot;     &quot;3892&quot;     &quot;2859&quot;     &quot;8955&quot;  NA    
##           &quot;%&quot;          &quot;24.6&quot;     &quot;43.5&quot;     &quot;31.9&quot;     NA      NA</code></pre>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="#cb811-1"></a><span class="co"># Afficher les indicateurs de qualité de prédiction</span></span>
<span id="cb811-2"><a href="#cb811-2"></a><span class="kw">print</span>(matrices<span class="op">$</span>indicators)</span></code></pre></div>
<pre><code>##              rnames                           precision rappel F1    
## 1            &quot;1&quot;                              &quot;0.64&quot;    &quot;0.72&quot; &quot;0.67&quot;
## 2            &quot;2&quot;                              &quot;0.56&quot;    &quot;0.61&quot; &quot;0.58&quot;
## 3            &quot;3&quot;                              &quot;0.62&quot;    &quot;0.48&quot; &quot;0.54&quot;
## macro_scores &quot;macro&quot;                          &quot;0.6&quot;     &quot;0.59&quot; &quot;0.59&quot;
##              &quot;Kappa&quot;                          &quot;0.37&quot;    NA     NA    
##              &quot;Valeur de p  (precision &gt; NIR)&quot; &quot;0&quot;       NA     NA</code></pre>
<p>Le modèle a une précision totale de 61 % (61 % des observations ont été correctement prédites). La catégorie 1 a de loin la meilleure précision (72 %) et la 3 a la pire (48 %), ce qui indique qu’il manque vraisemblablement des variables indépendantes contribuant à prédire les prix des logements les plus chers. Le coefficient de Kappa () indique un niveau d’accord entre modéré et faible, mais le modèle parvient à une prédiction significativement supérieure au seuil de non-information. Si l’ajustement du modèle est imparfait, il est suffisamment fiable pour nous donner des renseignements pertinents sur le phénomène étudié.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>L’ensemble des coefficients du modèle sont accessibles via la fonction <code>summary</code>. À partir des coefficients et de leurs erreurs standards, il est possible de calculer les rapports de cotes ainsi que leurs intervalles de confiances.</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="#cb813-1"></a>tableau &lt;-<span class="st"> </span><span class="kw">summary</span>(modele3)<span class="op">@</span>coef3</span>
<span id="cb813-2"><a href="#cb813-2"></a>rappCote &lt;-<span class="st"> </span><span class="kw">exp</span>(tableau[,<span class="dv">1</span>])</span>
<span id="cb813-3"><a href="#cb813-3"></a>rappCote2<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">exp</span>(tableau[,<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>tableau[,<span class="dv">2</span>])</span>
<span id="cb813-4"><a href="#cb813-4"></a>rappCote97<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">exp</span>(tableau[,<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>tableau[,<span class="dv">2</span>])</span>
<span id="cb813-5"><a href="#cb813-5"></a>tableau &lt;-<span class="st"> </span><span class="kw">cbind</span>(tableau, rappCote, rappCote2<span class="fl">.5</span>, rappCote97<span class="fl">.5</span>)</span>
<span id="cb813-6"><a href="#cb813-6"></a><span class="kw">print</span>(<span class="kw">round</span>(tableau,<span class="dv">3</span>))</span></code></pre></div>
<pre><code>##                           Estimate Std. Error z value Pr(&gt;|z|) rappCote
## (Intercept):1               -1.203      0.137  -8.768    0.000    0.300
## (Intercept):2               -3.240      0.151 -21.516    0.000    0.039
## beds                         0.748      0.027  28.143    0.000    2.113
## Garden_or_backyardYES        0.120      0.067   1.795    0.073    1.128
## Host_greets_youYES           0.094      0.060   1.548    0.122    1.098
## Free_street_parkingYES      -0.015      0.046  -0.320    0.749    0.985
## prt_veg_500m                -0.026      0.003 -10.182    0.000    0.975
## has_metro_500mYES            0.063      0.048   1.326    0.185    1.065
## commercial_1km               0.008      0.008   0.955    0.340    1.008
## privateEntier:1              2.445      0.062  39.241    0.000   11.533
## privateEntier:2              1.576      0.081  19.573    0.000    4.834
## cat_review                   0.200      0.021   9.563    0.000    1.222
## host_total_listings_count   -0.002      0.001  -2.094    0.036    0.998
##                           rappCote2.5 rappCote97.5
## (Intercept):1                   0.230        0.393
## (Intercept):2                   0.029        0.053
## beds                            2.006        2.226
## Garden_or_backyardYES           0.989        1.287
## Host_greets_youYES              0.975        1.236
## Free_street_parkingYES          0.900        1.078
## prt_veg_500m                    0.970        0.980
## has_metro_500mYES               0.970        1.170
## commercial_1km                  0.992        1.024
## privateEntier:1                10.207       13.031
## privateEntier:2                 4.128        5.660
## cat_review                      1.173        1.273
## host_total_listings_count       0.996        1.000</code></pre>
<p>Pour faciliter la lecture des résultats, nous proposons le tableau @ref(tab:TabFinalOrdinale).</p>
<table>
<caption>
(#tab:TabFinalOrdinale)Coefficients du modèle logistique des cotes proportionnelles
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coefficient
</th>
<th style="text-align:right;">
RC
</th>
<th style="text-align:right;">
P
</th>
<th style="text-align:right;">
RC 2,5 %
</th>
<th style="text-align:right;">
RC 97,5 %
</th>
<th style="text-align:right;">
sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept):1
</td>
<td style="text-align:right;">
-1,200
</td>
<td style="text-align:right;">
0,300
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,230
</td>
<td style="text-align:right;">
0,395
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
(Intercept):2
</td>
<td style="text-align:right;">
-3,240
</td>
<td style="text-align:right;">
0,039
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,029
</td>
<td style="text-align:right;">
0,052
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
beds
</td>
<td style="text-align:right;">
0,750
</td>
<td style="text-align:right;">
2,113
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
2,014
</td>
<td style="text-align:right;">
2,226
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Garden_or_backyard</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : NO
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
YES
</td>
<td style="text-align:right;">
0,120
</td>
<td style="text-align:right;">
1,128
</td>
<td style="text-align:right;">
0,073
</td>
<td style="text-align:right;">
0,990
</td>
<td style="text-align:right;">
1,284
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Host_greets_you</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : NO
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
YES
</td>
<td style="text-align:right;">
0,090
</td>
<td style="text-align:right;">
1,098
</td>
<td style="text-align:right;">
0,122
</td>
<td style="text-align:right;">
0,980
</td>
<td style="text-align:right;">
1,234
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Free_street_parking</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : NO
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
YES
</td>
<td style="text-align:right;">
-0,010
</td>
<td style="text-align:right;">
0,985
</td>
<td style="text-align:right;">
0,749
</td>
<td style="text-align:right;">
0,896
</td>
<td style="text-align:right;">
1,083
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
prt_veg_500m
</td>
<td style="text-align:right;">
-0,030
</td>
<td style="text-align:right;">
0,975
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,970
</td>
<td style="text-align:right;">
0,980
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>has_metro_500m</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : NO
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
YES
</td>
<td style="text-align:right;">
0,060
</td>
<td style="text-align:right;">
1,065
</td>
<td style="text-align:right;">
0,185
</td>
<td style="text-align:right;">
0,970
</td>
<td style="text-align:right;">
1,174
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
commercial_1km
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
1,008
</td>
<td style="text-align:right;">
0,340
</td>
<td style="text-align:right;">
0,990
</td>
<td style="text-align:right;">
1,020
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
cat_review
</td>
<td style="text-align:right;">
0,200
</td>
<td style="text-align:right;">
1,222
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,174
</td>
<td style="text-align:right;">
1,271
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
host_total_listings_count
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,998
</td>
<td style="text-align:right;">
0,036
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<strong>Effets par niveau</strong>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>private</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : Chambre
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
Entier:1
</td>
<td style="text-align:right;">
2,450
</td>
<td style="text-align:right;">
11,533
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
10,176
</td>
<td style="text-align:right;">
13,066
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Entier:2
</td>
<td style="text-align:right;">
1,580
</td>
<td style="text-align:right;">
4,834
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
4,137
</td>
<td style="text-align:right;">
5,641
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table></li>
</ul>
<p>Sans surprise, chaque lit supplémentaire contribue à augmenter les chances que le logement soit dans une catégorie de prix supérieure (multiplication par deux à chaque lit supplémentaire). En revanche, la présence d’un stationnement gratuit, d’un jardin et l’accueil en personne par l’hôte n’ont pas d’impacts significatifs. Comme l’indiquaient les articles mentionnés en début de section, les revues positives augmentent la probabilité d’appartenir à une catégorie supérieure de prix. Pour chaque point supplémentaire sur l’échelle de 1 à 5, la probabilité d’appartenir à une catégorie de prix supérieure augmente de 22,2 %. Il est intéressant de noter que le fait de disposer du logement entier plutôt que d’une simple chambre augmente davantage les chances de passer du groupe de prix 1 à 2 (multiplication par 2,45) que du groupe 2 à 3 (multiplication par 1,58). Il semblerait également que si l’hôte possède plusieurs logements, la probabilité d’avoir une classe de prix supérieure diminue légèrement. Cependant, l’effet est trop petit pour pouvoir se livrer à des interprétations.</p>
<p>Les variables environnementales ont peu d’impact : le pourcentage de surface commerciale dans un rayon d’un kilomètre et la présence d’une station de métro ne sont pas significatifs. En revanche, une augmentation de la surface végétale dans un rayon de 500 mètres tend à réduire la probabilité d’appartenir à une classe supérieure. Notre hypothèse concernant ce résultat est que cette variable représente un effet associé à la localisation des Airbnb, les plus centraux ayant tendance à être plus dispendieux, mais avec un environnement moins vert et inversement. Pour l’illustrer, prédisons les probabilités d’appartenance aux différents niveaux de prix d’un logement avec les caractéristiques suivantes : entièrement privé, 2 lits, un jardin, une place de stationnement gratuite, l’hôte ne dispose que d’un logement sur Airbnb et accueille les arrivants en personne, 10 % de surface commerciale dans un rayon d’un kilomètre, noté 2 comme catégorie de revue, absence de métro dans un rayon de 500 mètres.</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="#cb815-1"></a><span class="co"># Créer un jeu de données pour effectuer des prédictions</span></span>
<span id="cb815-2"><a href="#cb815-2"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb815-3"><a href="#cb815-3"></a>  <span class="dt">prt_veg_500m =</span> <span class="kw">seq</span>(<span class="dv">5</span>,<span class="dv">90</span>),</span>
<span id="cb815-4"><a href="#cb815-4"></a>  <span class="dt">beds =</span> <span class="dv">2</span>, </span>
<span id="cb815-5"><a href="#cb815-5"></a>  <span class="dt">Garden_or_backyard =</span> <span class="st">&quot;YES&quot;</span>,</span>
<span id="cb815-6"><a href="#cb815-6"></a>  <span class="dt">Host_greets_you =</span> <span class="st">&quot;YES&quot;</span>,</span>
<span id="cb815-7"><a href="#cb815-7"></a>  <span class="dt">Free_street_parking =</span> <span class="st">&quot;YES&quot;</span>,</span>
<span id="cb815-8"><a href="#cb815-8"></a>  <span class="dt">has_metro_500m =</span> <span class="st">&quot;NO&quot;</span>,</span>
<span id="cb815-9"><a href="#cb815-9"></a>  <span class="dt">commercial_1km =</span> <span class="dv">10</span>,</span>
<span id="cb815-10"><a href="#cb815-10"></a>  <span class="dt">private =</span> <span class="st">&quot;Entier&quot;</span>,</span>
<span id="cb815-11"><a href="#cb815-11"></a>  <span class="dt">cat_review =</span> <span class="dv">2</span>,</span>
<span id="cb815-12"><a href="#cb815-12"></a>  <span class="dt">host_total_listings_count =</span> <span class="dv">1</span></span>
<span id="cb815-13"><a href="#cb815-13"></a>)</span>
<span id="cb815-14"><a href="#cb815-14"></a><span class="co"># Effectuer les prédictions (dans l&#39;échelle log)</span></span>
<span id="cb815-15"><a href="#cb815-15"></a>preds &lt;-<span class="st"> </span><span class="kw">predict</span>(modele3, <span class="dt">newdata =</span> df, <span class="dt">type =</span> <span class="st">&quot;link&quot;</span>, <span class="dt">se.fit=</span>T)</span>
<span id="cb815-16"><a href="#cb815-16"></a><span class="co"># Définir l&#39;inverse de la fonction de lien</span></span>
<span id="cb815-17"><a href="#cb815-17"></a>ilink &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">exp</span>(x)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(x))}</span>
<span id="cb815-18"><a href="#cb815-18"></a><span class="co"># Calculer les probabilités et leurs intervalles de confiance</span></span>
<span id="cb815-19"><a href="#cb815-19"></a>df[[<span class="st">&quot;P[Y&gt;=2]&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">ilink</span>(preds<span class="op">$</span>fitted.values[,<span class="dv">1</span>])</span>
<span id="cb815-20"><a href="#cb815-20"></a>df[[<span class="st">&quot;P[Y&gt;=2] 2,5&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">ilink</span>(preds<span class="op">$</span>fitted.values[,<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>preds<span class="op">$</span>se.fit[,<span class="dv">1</span>])</span>
<span id="cb815-21"><a href="#cb815-21"></a>df[[<span class="st">&quot;P[Y&gt;=2] 97,5&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">ilink</span>(preds<span class="op">$</span>fitted.values[,<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>preds<span class="op">$</span>se.fit[,<span class="dv">1</span>])</span>
<span id="cb815-22"><a href="#cb815-22"></a>df[[<span class="st">&quot;P[Y&gt;=3]&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">ilink</span>(preds<span class="op">$</span>fitted.values[,<span class="dv">2</span>])</span>
<span id="cb815-23"><a href="#cb815-23"></a>df[[<span class="st">&quot;P[Y&gt;=3] 2,5&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">ilink</span>(preds<span class="op">$</span>fitted.values[,<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>preds<span class="op">$</span>se.fit[,<span class="dv">2</span>])</span>
<span id="cb815-24"><a href="#cb815-24"></a>df[[<span class="st">&quot;P[Y&gt;=3] 97,5&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">ilink</span>(preds<span class="op">$</span>fitted.values[,<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>preds<span class="op">$</span>se.fit[,<span class="dv">2</span>])</span>
<span id="cb815-25"><a href="#cb815-25"></a>df[[<span class="st">&quot;P[Y=1]&quot;</span>]] =<span class="st"> </span><span class="dv">1</span><span class="op">-</span>df[[<span class="st">&quot;P[Y&gt;=2]&quot;</span>]]</span>
<span id="cb815-26"><a href="#cb815-26"></a>df[[<span class="st">&quot;P[Y=1] 2,5&quot;</span> ]] =<span class="st"> </span><span class="dv">1</span><span class="op">-</span>df[[<span class="st">&quot;P[Y&gt;=2] 2,5&quot;</span>]]</span>
<span id="cb815-27"><a href="#cb815-27"></a>df[[<span class="st">&quot;P[Y=1] 97,5&quot;</span>]] =<span class="st"> </span><span class="dv">1</span><span class="op">-</span>df[[<span class="st">&quot;P[Y&gt;=2] 97,5&quot;</span>]]</span>
<span id="cb815-28"><a href="#cb815-28"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb815-29"><a href="#cb815-29"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb815-30"><a href="#cb815-30"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg_500m, </span>
<span id="cb815-31"><a href="#cb815-31"></a>                         <span class="dt">ymin =</span> <span class="st">`</span><span class="dt">P[Y&gt;=2] 2,5</span><span class="st">`</span>,</span>
<span id="cb815-32"><a href="#cb815-32"></a>                         <span class="dt">ymax =</span> <span class="st">`</span><span class="dt">P[Y&gt;=2] 97,5</span><span class="st">`</span>),<span class="dt">fill =</span><span class="st">&quot;#f94144&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span>)<span class="op">+</span></span>
<span id="cb815-33"><a href="#cb815-33"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg_500m, <span class="dt">y =</span> <span class="st">`</span><span class="dt">P[Y&gt;=2]</span><span class="st">`</span>,<span class="dt">color=</span><span class="st">&quot;Y2&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb815-34"><a href="#cb815-34"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg_500m, </span>
<span id="cb815-35"><a href="#cb815-35"></a>                         <span class="dt">ymin =</span> <span class="st">`</span><span class="dt">P[Y&gt;=3] 2,5</span><span class="st">`</span>,</span>
<span id="cb815-36"><a href="#cb815-36"></a>                         <span class="dt">ymax =</span> <span class="st">`</span><span class="dt">P[Y&gt;=3] 97,5</span><span class="st">`</span>), <span class="dt">fill =</span><span class="st">&quot;#90be6d&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span>)<span class="op">+</span></span>
<span id="cb815-37"><a href="#cb815-37"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg_500m, <span class="dt">y =</span> <span class="st">`</span><span class="dt">P[Y&gt;=3]</span><span class="st">`</span>, <span class="dt">color =</span> <span class="st">&quot;Y3&quot;</span> )) <span class="op">+</span><span class="st"> </span></span>
<span id="cb815-38"><a href="#cb815-38"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg_500m, </span>
<span id="cb815-39"><a href="#cb815-39"></a>                         <span class="dt">ymin =</span> <span class="st">`</span><span class="dt">P[Y=1] 2,5</span><span class="st">`</span>,</span>
<span id="cb815-40"><a href="#cb815-40"></a>                         <span class="dt">ymax =</span> <span class="st">`</span><span class="dt">P[Y=1] 97,5</span><span class="st">`</span>),<span class="dt">fill =</span><span class="st">&quot;#277da1&quot;</span> , <span class="dt">alpha =</span> <span class="fl">0.4</span>)<span class="op">+</span></span>
<span id="cb815-41"><a href="#cb815-41"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg_500m, <span class="dt">y =</span> <span class="st">`</span><span class="dt">P[Y=1]</span><span class="st">`</span>, <span class="dt">color =</span> <span class="st">&quot;Y1&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb815-42"><a href="#cb815-42"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">name =</span> <span class="st">&quot;Probabilités prédites&quot;</span>,</span>
<span id="cb815-43"><a href="#cb815-43"></a>                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Y1&quot;</span>, <span class="st">&quot;Y2&quot;</span>, <span class="st">&quot;Y3&quot;</span>),</span>
<span id="cb815-44"><a href="#cb815-44"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;P[Y=1]&quot;</span>, <span class="st">&quot;P[Y&gt;=2]&quot;</span>, <span class="st">&quot;P[Y&gt;=3]&quot;</span>),</span>
<span id="cb815-45"><a href="#cb815-45"></a>                     <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;Y2&quot;</span> =<span class="st"> &quot;#f94144&quot;</span>, <span class="st">&quot;Y3&quot;</span> =<span class="st"> &quot;#90be6d&quot;</span>,</span>
<span id="cb815-46"><a href="#cb815-46"></a>                                   <span class="st">&quot;Y1&quot;</span> =<span class="st"> &quot;#277da1&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb815-47"><a href="#cb815-47"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Densité de végétation (%)&quot;</span>,</span>
<span id="cb815-48"><a href="#cb815-48"></a>       <span class="dt">y =</span> <span class="st">&quot;Probabilité&quot;</span>,</span>
<span id="cb815-49"><a href="#cb815-49"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Y1 : moins de 50$; Y2 : 50 à 99$; Y3 : 100 à 249$&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/predpricecatveg-1.png" alt="Prédiction de la probabilité d'appartenance aux trois catégories de prix en fonction de la densité de végétation" width="90%" />
<p class="caption">
(#fig:predpricecatveg)Prédiction de la probabilité d’appartenance aux trois catégories de prix en fonction de la densité de végétation
</p>
</div>
<p>Nous constatons à la figure @ref(fig:predpricecatveg) que les probabilités d’appartenir aux niveaux 2 et 3 diminuent à mesure qu’augmente le pourcentage de végétation. La probabilité d’appartenir à la classe 2 et plus (en rouge), passe de plus de 95 %, en cas d’absence de végétation, à environ 75 % avec 80 % de végétation dans un rayon de 500m. Comme vous pouvez le constater, la probabilité <span class="math inline">\(P[Y=1]\)</span> est la symétrie de <span class="math inline">\(P[Y&gt;=2]\)</span> puisque <span class="math inline">\(P[Y=1]+P[Y&gt;=2] = 1\)</span>.</p>
</div>
</div>
<div id="sect0824" class="section level3">
<h3><span class="header-section-number">8.2.4</span> Modèle logistique multinomial</h3>
<p>La régression logistique multinomiale est utilisée pour modéliser une variable <em>Y</em> qualitative multinomiale, c’est-à-dire une variable dont les modalités ne peuvent pas être ordonnées. Dans le modèle précédent, nous avons vu qu’il était possible de modéliser une variable ordinale avec une distribution binomiale en formulant l’hypothèse de la proportionnalité des cotes. Avec une variable multinomiale, cette hypothèse ne tient plus, car les catégories ne sont plus ordonnées. Il faut donc formuler le modèle différemment.</p>
<p>L’idée derrière un modèle multinomial est de choisir une catégorie de référence, puis de modéliser les probabilités d’appartenir à chaque autre catégorie plutôt qu’à cette catégorie de référence (tableau @ref(tab:multinomdentity)). Si nous avons <em>K</em> catégories possibles dans notre variable <em>Y</em>, nous obtenons <em>K</em>-1 comparaisons. Chaque comparaison est modélisée avec sa propre équation ce qui génère de nombreux paramètres. Par exemple, admettons que notre variable <em>Y</em> ait cinq catégories et que nous disposons de six variables <em>X</em> prédictives. Nous avons ainsi 4 (5-1) équations de régression avec 7 paramètres (6 coefficients et une constante), soit 28 coefficients à analyser.</p>
<p>Considérant cette tendance à la multiplication des coefficients, il est fréquent de recourir à une méthode appelée <em>Analyse de type 3</em> pour limiter au maximum le nombre de variables indépendantes (VI) dans le modèle. L’idée de cette méthode est de recalculer plusieurs versions du modèle dans lesquelles une variable indépendante est retirée, puis de réaliser un test de rapport de vraisemblance en comparant ce nouveau modèle (complet moins une VI) au modèle complet (toutes les VI) pour vérifier si la variable en question améliore significativement le modèle. Il est alors possible de retirer toutes les variables dont l’apport est négligeable si elles étaient également peu intéressantes du point de vue théorique.</p>
<table>
<caption>
(#tab:multinomdentity)Carte d’identité du modèle logistique multinomial
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable qualitative multinomiale avec <em>K</em> catégories
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Binomiale
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim Binomial(p)\)</span> <br/> <span class="math inline">\(g(p = k\text{ avec }ref = a) = \beta_{0k} + \beta X_{k}\)</span> <br/> <span class="math inline">\(g(x) = \frac{log(x)}{1-x}\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
logistique
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
p
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_{0k}\)</span>, <span class="math inline">\(\beta\)</span>k pour <span class="math inline">\(k \in [2,...,K]\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
Non séparation complète, Absence de sur-dispersion ou sous-dispersion, Indépendance des alternatives non pertinentes
</td>
</tr>
</tbody>
</table>
<div id="conditions-dapplication-1" class="section level4">
<h4><span class="header-section-number">8.2.4.1</span> Conditions d’application</h4>
<p>Les conditions d’application sont les mêmes que pour un modèle binomial, avec l’ajout de l’hypothèse sur <strong>l’indépendance des alternatives non pertinentes</strong>. Cette dernière suppose que le choix entre deux catégories est indépendant des catégories proposées. Voici un exemple simple pour illustrer cette hypothèse: admettons que nous disposons d’une trentaine de personnes et que nous leur demandions la couleur de leurs yeux. Cette variable ne serait pas affectée par la présence de nouvelles couleurs en dehors de notre échantillon. En revanche, si nous leur demandions de choisir un mode de transport parmi une liste pour se rendre à leur lieu de travail, leur réponse serait nécessairement affectée par la liste des modes de transport disponibles. Les tests développés pour vérifier cette hypothèse sont connus pour leur <a href="https://statisticalhorizons.com/iia">faible fiabilité</a>. Il est plus pertinent de décider théoriquement si cette hypothèse est valide ou non. Dans le cas contraire, il est possible d’utiliser une classe de modèle logistique plus rare: le modèle logistique imbriqué.</p>
<p>Notez également que le grand nombre de paramètres dans ce type de modèle implique de disposer d’un plus grand nombre d’observations afin de disposer de suffisamment d’information dans chaque catégorie pour ajuster tous les paramètres.</p>
<p>Pour vérifier la présence de sur-dispersion, il est possible, dans le cas du modèle multinomial, de calculer le rapport entre le khi-deux de Pearson et le nombre de degrés de liberté du modèle. Si ce rapport est supérieur à 1 (des valeurs jusqu’à 1,15 ne sont pas problématiques), alors le modèle souffre de sur-dispersion <span class="citation">(SAS Institute Inc <a href="#ref-Sasmultinom" role="doc-biblioref">2020</a><a href="#ref-Sasmultinom" role="doc-biblioref">a</a>)</span>. Le khi-deux de Pearson est simplement la somme des résidus de Pearson au carré dans le cas d’un modèle GLM.</p>

<p><span class="math display">\[\begin{equation}
\chi^2 = \sum_{i=1}^N\sum_{c=1}^K{\frac{(y_{ic} - p_{ic})^2}{p_{ic}}}
(\#eq:glm15)
\end{equation}\]</span>
</p>
<p>Avec <span class="math inline">\(y_{ic}\)</span> 1 si l’observation <em>i</em> appartient à la catégorie <em>c</em>, 0 autrement, <span class="math inline">\(p_{ic}\)</span> la probabilité prédite pour l’observation <em>i</em> d’appartenir à la catégorie <em>c</em>, <em>N</em> le nombre d’observations et <em>K</em> le nombre de catégories.</p>
<p>Le ratio est ensuite calculé comme suit: <span class="math inline">\(\frac{\chi^2}{(N - p)(K-1)}\)</span>, avec <em>N</em> le nombre d’observations et <em>K</em> le nombre de modalités dans la variable <em>Y</em>. Si ce ratio est égal est supérieur à 1, alors le modèle souffre de sur-dispersion, si le ratio est inférieur à 1, le modèle souffre de sous-dispersion. Un léger écart (&gt;0,15) n’est pas considéré comme problématique.</p>
<div class="bloc_aller_loin">
<p><strong>Le modèle logistique imbriqué</strong></p>
<p>Du fait de sa proximité avec les modèles à effets mixtes que nous aborderons plus tard (chapitre @ref(chap09)), nous ne détaillons pas ici le modèle logistique imbriqué, mais présentons plutôt son principe général. Il s’agit d’une généralisation du modèle logistique multinomial basé sur l’idée que certaines catégories pourraient être regroupées dans des « nids » (<em>nest</em> en anglais). Dans ces groupes, les erreurs peuvent être corrélées, indiquant ainsi que si une catégorie est manquante, une autre catégorie du même groupe sera préférée. Un paramètre <span class="math inline">\(\lambda\)</span> contrôle spécifiquement cette corrélation et permet de mesurer sa force une fois le modèle ajusté. Il peut être pertinent de comparer un modèle imbriqué à un modèle multinomial pour déterminer lequel des deux est le mieux ajusté aux données.</p>
</div>
</div>
<div id="exemple-appliqué-dans-r-1" class="section level4">
<h4><span class="header-section-number">8.2.4.2</span> Exemple appliqué dans R</h4>
<p>Pour cet exemple, nous reproduisons une partie de l’analyse effectuée dans l’étude de <span class="citation">McFadden (<a href="#ref-mcfadden2016examining" role="doc-biblioref">2016</a>)</span>. Cet article s’intéresse aux écarts entre les croyances des individus et les connaissances scientifiques sur les sujets des OGM et du réchauffement climatique. Les auteurs utilisent pour cela des données issues d’une enquête auprès de 961 individus formant un échantillon représentatif de la population des États-Unis. Les données issues de cette enquête sont téléchargeables sur le <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0166140">site de l’éditeur</a>, ce qui nous permet ici de reproduire l’analyse effectuée par les auteurs. Deux questions sont centrales dans l’enquête :</p>
<ul>
<li>Dans quelle mesure êtes-vous en accord ou en désaccord avec la phrase suivante : les plantations génétiquement modifiées sont sans danger pour la consommation ?</li>
<li>Dans quelle mesure êtes-vous en accord ou en désaccord avec la phrase suivante : la Terre se réchauffe du fait des activités humaines ?</li>
</ul>
<p>Pour ces deux questions, les répondants devaient sélectionner leur degré d’accord sur une échelle de Likert allant de 1 (fortement en désaccord) à 5 (fortement en accord). Les réponses à ces deux questions ont été utilisées pour former une variable multinomiale à quatre modalités :</p>
<ul>
<li>A. Les individus sont en accord avec les deux propositions.</li>
<li>B. Les individus sont en désaccord sur les OGM, mais en accord sur le réchauffement climatique.</li>
<li>C. Les individus sont en accord sur les OGM, mais en désaccord sur le réchauffement climatique.</li>
<li>D. Les individus sont en désaccord avec les deux propositions.</li>
</ul>
<p>Un modèle logistique multinomial a été utilisé pour déterminer quels facteurs contribuent à la probabilité d’appartenir à ces différentes catégories. Les variables indépendantes présentes dans le modèle sont détaillées dans le tableau @ref(tab:variablemultinom). Les auteurs avaient notamment conclu que :</p>
<ul>
<li>Les effets des connaissances (réelles ou perçues) sur l’appartenance aux différentes catégories n’étaient pas uniformes et pouvaient varier en fonction du sujet.</li>
<li>L’orientation politique avait une influence significative sur les croyances.</li>
<li>Les répondants avec de plus hauts résultats au test de cognition CRT avaient plus souvent des opinions divergentes de la communauté scientifique.</li>
</ul>
<table>
<caption>
(#tab:variablemultinom)Variables indépendantes utilisées dans le modèle logistique multinomial
</caption>
<thead>
<tr>
<th style="text-align:left;">
Nom de la variable
</th>
<th style="text-align:left;">
signification
</th>
<th style="text-align:left;">
Type de variable
</th>
<th style="text-align:left;">
Mesure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
PercepOGM
</td>
<td style="text-align:left;">
La recherche scientifique supporte ma vision sur la sécurité des plantes OGM
</td>
<td style="text-align:left;">
Variable ordinale
</td>
<td style="text-align:left;">
Échelle de Likert de 1 (fortement en désaccord) à 5 (fortement en accord)
</td>
</tr>
<tr>
<td style="text-align:left;">
PercepRechClim
</td>
<td style="text-align:left;">
La recherche scientifique supporte ma vision sur le réchauffement climatique
</td>
<td style="text-align:left;">
Variable ordinale
</td>
<td style="text-align:left;">
Échelle de Likert de 1 (fortement en désaccord) à 5 (fortement en accord)
</td>
</tr>
<tr>
<td style="text-align:left;">
ConnaisOGM
</td>
<td style="text-align:left;">
Niveau de connaissance sur les OGM
</td>
<td style="text-align:left;">
Variable ordinale
</td>
<td style="text-align:left;">
Nombre de réponses juste sur trois questions portant sur les OGM
</td>
</tr>
<tr>
<td style="text-align:left;">
ConnaisRechClim
</td>
<td style="text-align:left;">
Niveau de connaissance sur le réchauffement climatique
</td>
<td style="text-align:left;">
Variable ordinale
</td>
<td style="text-align:left;">
Nombre de réponses juste sur trois questions portant sur le réchauffement climatique
</td>
</tr>
<tr>
<td style="text-align:left;">
CRT
</td>
<td style="text-align:left;">
Score obtenu au Cognitive Reflection Test, utilisé pour déterminer la propension à faire preuve d’esprit d’analyse plutôt que choisir des réponses intuitives
</td>
<td style="text-align:left;">
Variable ordinale
</td>
<td style="text-align:left;">
Nombre de réponses juste sur trois questions pièges
</td>
</tr>
<tr>
<td style="text-align:left;">
Parti
</td>
<td style="text-align:left;">
Orientation politique du répondant
</td>
<td style="text-align:left;">
Variable multinomiale
</td>
<td style="text-align:left;">
Républicain, Démocrate et autre
</td>
</tr>
<tr>
<td style="text-align:left;">
Sexe
</td>
<td style="text-align:left;">
Sexe du répondant
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
Femme ou Homme
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:left;">
Âge du répondant
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Âge du répondant
</td>
</tr>
<tr>
<td style="text-align:left;">
Revenu
</td>
<td style="text-align:left;">
Niveau de revenu du répondant
</td>
<td style="text-align:left;">
Variable ordinale
</td>
<td style="text-align:left;">
Échelle de 1 (moins de 20 000$) à 8 (140 000$ et plus)
</td>
</tr>
</tbody>
</table>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Avant d’ajuster le modèle, nous commençons par vérifier l’absence de multicolinéarité excessive entre les variables indépendantes. Toutes les valeurs de VIF sont inférieures à 2, indiquant bien une absence de multicolinéarité.</p>
<div class="sourceCode" id="cb816"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb816-1"><a href="#cb816-1"></a>data_quest &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/glm/enquete_PublicOpinion_vs_Science.csv&quot;</span>)</span>
<span id="cb816-2"><a href="#cb816-2"></a><span class="co"># Choix des valeurs de références dans les facteurs</span></span>
<span id="cb816-3"><a href="#cb816-3"></a>data_quest<span class="op">$</span>Parti &lt;-<span class="st"> </span><span class="kw">relevel</span>(<span class="kw">as.factor</span>(data_quest<span class="op">$</span>Parti), <span class="dt">ref =</span> <span class="st">&quot;Democrate&quot;</span>)</span>
<span id="cb816-4"><a href="#cb816-4"></a>data_quest<span class="op">$</span>Sexe &lt;-<span class="st"> </span><span class="kw">relevel</span>(<span class="kw">as.factor</span>(data_quest<span class="op">$</span>Sexe), <span class="dt">ref =</span> <span class="st">&quot;homme&quot;</span>)</span>
<span id="cb816-5"><a href="#cb816-5"></a><span class="kw">vif</span>(<span class="kw">glm</span>(SCIGM <span class="op">~</span><span class="st"> </span>PercepOGM <span class="op">+</span><span class="st"> </span>PercepRechClim <span class="op">+</span><span class="st"> </span>ConnaisOGM <span class="op">+</span><span class="st"> </span>ConnaisRechClim <span class="op">+</span></span>
<span id="cb816-6"><a href="#cb816-6"></a><span class="st">          </span>CRT <span class="op">+</span><span class="st"> </span>Parti <span class="op">+</span><span class="st"> </span>AGE <span class="op">+</span><span class="st"> </span>Sexe <span class="op">+</span><span class="st"> </span>Revenu, <span class="dt">data =</span> data_quest))</span></code></pre></div>
<pre><code>##                     GVIF Df GVIF^(1/(2*Df))
## PercepOGM       1.092693  1        1.045320
## PercepRechClim  1.177495  1        1.085125
## ConnaisOGM      1.150662  1        1.072689
## ConnaisRechClim 1.158438  1        1.076307
## CRT             1.155371  1        1.074882
## Parti           1.130817  2        1.031212
## AGE             1.071655  1        1.035208
## Sexe            1.064918  1        1.031949
## Revenu          1.049499  1        1.024451</code></pre>
<p>La seconde étape est d’ajuster le modèle et de vérifier l’absence de sur ou sous-dispersion. Pour ajuster le modèle, nous utilisons à nouveau la fonction <code>vglm</code> du <em>package</em> <code>VGAM</code>, avec le paramètre <code>family = multinomial()</code>. Le ratio entre la statistique de Pearson et le nombre de degrés de liberté du modèle indique une absence de sur ou sous-dispersion (1,04).</p>
<div class="sourceCode" id="cb818"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb818-1"><a href="#cb818-1"></a><span class="co"># Ajustement du modèle</span></span>
<span id="cb818-2"><a href="#cb818-2"></a>modele &lt;-<span class="st"> </span><span class="kw">vglm</span>(Y <span class="op">~</span><span class="st"> </span>PercepOGM <span class="op">+</span><span class="st"> </span>PercepRechClim <span class="op">+</span><span class="st"> </span>ConnaisOGM <span class="op">+</span><span class="st"> </span>ConnaisRechClim <span class="op">+</span><span class="st"> </span></span>
<span id="cb818-3"><a href="#cb818-3"></a><span class="st">                 </span>CRT <span class="op">+</span><span class="st"> </span>Parti <span class="op">+</span><span class="st"> </span>AGE <span class="op">+</span><span class="st"> </span>Sexe <span class="op">+</span><span class="st"> </span>Revenu,</span>
<span id="cb818-4"><a href="#cb818-4"></a>               <span class="dt">data =</span> data_quest, </span>
<span id="cb818-5"><a href="#cb818-5"></a>               <span class="dt">family =</span> <span class="kw">multinomial</span>(<span class="dt">refLevel=</span><span class="st">&quot;A&quot;</span>), <span class="dt">model =</span> T)</span>
<span id="cb818-6"><a href="#cb818-6"></a><span class="co"># Calcul du Khi2 de Pearson</span></span>
<span id="cb818-7"><a href="#cb818-7"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(modele, <span class="dt">type=</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb818-8"><a href="#cb818-8"></a>cat_predict &lt;-<span class="st"> </span><span class="kw">colnames</span>(pred)[<span class="kw">max.col</span>(pred)]</span>
<span id="cb818-9"><a href="#cb818-9"></a>freq_real &lt;-<span class="st"> </span><span class="kw">table</span>(data_quest<span class="op">$</span>Y)</span>
<span id="cb818-10"><a href="#cb818-10"></a>freq_pred &lt;-<span class="st"> </span><span class="kw">table</span>(cat_predict)</span>
<span id="cb818-11"><a href="#cb818-11"></a></span>
<span id="cb818-12"><a href="#cb818-12"></a>khi2 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">residuals</span>(modele, <span class="dt">type =</span> <span class="st">&quot;pearson&quot;</span>)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb818-13"><a href="#cb818-13"></a></span>
<span id="cb818-14"><a href="#cb818-14"></a>N &lt;-<span class="st"> </span><span class="kw">nrow</span>(data_quest)</span>
<span id="cb818-15"><a href="#cb818-15"></a>p &lt;-<span class="st"> </span>modele<span class="op">@</span>rank</span>
<span id="cb818-16"><a href="#cb818-16"></a>r &lt;-<span class="st"> </span><span class="kw">length</span>(freq_real)</span>
<span id="cb818-17"><a href="#cb818-17"></a>ratio &lt;-<span class="st"> </span>khi2 <span class="op">/</span><span class="st"> </span>((N<span class="op">-</span>p)<span class="op">*</span>(r<span class="dv">-1</span>))</span>
<span id="cb818-18"><a href="#cb818-18"></a><span class="kw">print</span>(ratio)</span></code></pre></div>
<pre><code>## [1] 1.045889</code></pre>
<p>La troisième étape de la vérification des conditions d’application est l’analyse des distances de Cook. À nouveau, puisque le modèle évalue la probabilité d’appartenir à <span class="math inline">\(K-1\)</span> catégorie, nous pouvons calculer <span class="math inline">\(K-1\)</span> résidus par observation et par extension <span class="math inline">\(K-1\)</span> distances de Cook. Aucune observation ne semble se détacher nettement dans la figure @ref(fig:cookmultinom). Nous décidons donc pour le moment de conserver toutes les observations.</p>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="#cb820-1"></a><span class="co"># Extraction des résidus</span></span>
<span id="cb820-2"><a href="#cb820-2"></a>res &lt;-<span class="st"> </span><span class="kw">residuals</span>(modele, <span class="dt">type =</span> <span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb820-3"><a href="#cb820-3"></a><span class="co"># Extraction de la hat matrix (nécessaire pour calculer la distance de Cook)</span></span>
<span id="cb820-4"><a href="#cb820-4"></a>hat &lt;-<span class="st"> </span><span class="kw">hatvaluesvlm</span>(modele)</span>
<span id="cb820-5"><a href="#cb820-5"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb820-6"><a href="#cb820-6"></a>vals &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>)</span>
<span id="cb820-7"><a href="#cb820-7"></a>cooks &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(res),<span class="cf">function</span>(i){</span>
<span id="cb820-8"><a href="#cb820-8"></a>  r &lt;-<span class="st"> </span>res[,i]</span>
<span id="cb820-9"><a href="#cb820-9"></a>  h &lt;-<span class="st"> </span>hat[,i]</span>
<span id="cb820-10"><a href="#cb820-10"></a>  cook &lt;-<span class="st"> </span>(r<span class="op">/</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>h))<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>h<span class="op">/</span>(<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>modele<span class="op">@</span>rank)</span>
<span id="cb820-11"><a href="#cb820-11"></a>  df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb820-12"><a href="#cb820-12"></a>    <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cook),</span>
<span id="cb820-13"><a href="#cb820-13"></a>    <span class="dt">cook =</span> cook</span>
<span id="cb820-14"><a href="#cb820-14"></a>  )</span>
<span id="cb820-15"><a href="#cb820-15"></a>  plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb820-16"><a href="#cb820-16"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cook), <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb820-17"><a href="#cb820-17"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>, <span class="dt">subtitle =</span> <span class="kw">paste</span>(<span class="st">&quot;distance de Cook P(&quot;</span>,vals[[<span class="dv">1</span>]],<span class="st">&quot; VS &quot;</span>,vals[[i<span class="op">+</span><span class="dv">1</span>]],<span class="st">&quot;)&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))<span class="op">+</span></span>
<span id="cb820-18"><a href="#cb820-18"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb820-19"><a href="#cb820-19"></a>          <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>())</span>
<span id="cb820-20"><a href="#cb820-20"></a>  <span class="kw">return</span>(plot)</span>
<span id="cb820-21"><a href="#cb820-21"></a>})</span>
<span id="cb820-22"><a href="#cb820-22"></a><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> cooks, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cookmultinom-1.png" alt="Distances de Cook pour le modèle logistique multinomial" width="90%" />
<p class="caption">
(#fig:cookmultinom)Distances de Cook pour le modèle logistique multinomial
</p>
</div>
<p>Avant de passer à l’analyse de résidus simulés, il est pertinent de réaliser une analyse de type 3 afin de retirer les variables indépendantes dont l’apport au modèle est négligeable. La fonction <code>AnalyseType3</code> (disponible dans le code source de ce livre) permet d’effectuer cette opération automatiquement pour un objet de type <code>vglm</code>.</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb821-1"><a href="#cb821-1"></a>tableau &lt;-<span class="st"> </span><span class="kw">AnalyseType3</span>(modele, data_quest, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## ************************************* 
## Type 3 Analysis of Effects 
## ************************************* 
## AIC model complet :  1855 
## loglikelihood model complet :  1789 
##   variable retiree  AIC loglikelihood  p.val
## 1        PercepOGM 1879          1819      0
## 2   PercepRechClim 1941          1881      0
## 3       ConnaisOGM 1910          1850      0
## 4  ConnaisRechClim 1862          1802 0.0059
## 5              CRT 1860          1800 0.0125
## 6            Parti 1879          1825      0
## 7              AGE 1852          1792 0.4469
## 8             Sexe 1875          1815      0
## 9           Revenu 1850          1790 0.7718</code></pre>
<p>L’analyse de type 3 nous permet de déterminer que l’âge et le revenu sont deux variables dont la contribution au modèle est marginale. À titre de rappel, l’analyse de Type 3 permet de comparer si le modèle complet (avec l’ensemble des variables indépendantes) est statistiquement mieux ajusté que le modèle avec l’ensemble des variables, sauf une. Or, dans notre cas, le modèle complet n’est pas statistiquement mieux ajusté que le modèle complet sans la variable Age (P=0,44) et que le modèle complet sans la variable Revenu (<em>p</em> = 0,77). Cela signifie donc que ces deux variables n’ont pas un apport significatif au modèle et peuvent par conséquent être ôtées par parcimonie. Nous décidons donc de les retirer afin d’alléger les tableaux de coefficients que nous présenterons plus loin. Nous pouvons également en conclure que ces deux variables ne jouent aucun rôle dans la propension à être en désaccord avec la recherche scientifique. Nous réajustons le modèle en conséquence.</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="#cb823-1"></a>modele2 &lt;-<span class="st"> </span><span class="kw">vglm</span>(Y <span class="op">~</span><span class="st"> </span>PercepOGM <span class="op">+</span><span class="st"> </span>PercepRechClim <span class="op">+</span><span class="st"> </span>ConnaisOGM <span class="op">+</span><span class="st"> </span>ConnaisRechClim <span class="op">+</span><span class="st"> </span></span>
<span id="cb823-2"><a href="#cb823-2"></a><span class="st">                 </span>CRT <span class="op">+</span><span class="st"> </span>Parti <span class="op">+</span><span class="st"> </span>Sexe,</span>
<span id="cb823-3"><a href="#cb823-3"></a>               <span class="dt">data =</span> data_quest, </span>
<span id="cb823-4"><a href="#cb823-4"></a>               <span class="dt">family =</span> <span class="kw">multinomial</span>(<span class="dt">refLevel=</span><span class="st">&quot;A&quot;</span>), <span class="dt">model =</span> T)</span></code></pre></div>
<p>Nous pouvons à présent passer à l’analyse des résidus simulés. Le problème avec ce modèle est que sa variable <em>Y</em> est qualitative alors que la méthode d’analyse des résidus du <em>package</em> <code>DHARMa</code> ne peut traiter que des variables quantitatives, binaires ou ordinales. Pour rappel, il est possible d’envisager la prédiction d’un modèle logistique multinomial comme la prédiction d’une série de modèles logistiques binomiaux. En représentant nos prédictions de cette façon, nous pouvons à nouveau utiliser le <em>package</em> <code>DHARMa</code> pour analyser nos résidus. Veuillez noter que cette approche n’est pas optimale et que cette section du livre peut être amenée à changer.</p>
<p>La figure @ref(fig:residusmultinom) indique que les résidus suivent bien une distribution uniforme et qu’aucune valeur aberrante n’est observable.</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="#cb824-1"></a><span class="co"># Extraire les prédictions du modèle</span></span>
<span id="cb824-2"><a href="#cb824-2"></a>categories &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>)</span>
<span id="cb824-3"><a href="#cb824-3"></a>predicted &lt;-<span class="st"> </span><span class="kw">predict</span>(modele2, <span class="dt">type =</span> <span class="st">&quot;link&quot;</span>)</span>
<span id="cb824-4"><a href="#cb824-4"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb824-5"><a href="#cb824-5"></a>ilink &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">exp</span>(x)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(x))}</span>
<span id="cb824-6"><a href="#cb824-6"></a><span class="co"># Boucler sur chacune des catégories en dehors de la référence</span></span>
<span id="cb824-7"><a href="#cb824-7"></a>data_sims &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(predicted),<span class="cf">function</span>(i){</span>
<span id="cb824-8"><a href="#cb824-8"></a>  categorie &lt;-<span class="st"> </span>categories[[i]]</span>
<span id="cb824-9"><a href="#cb824-9"></a>  <span class="co"># Extraire les observation de la catégorie i et de la référence</span></span>
<span id="cb824-10"><a href="#cb824-10"></a>  test &lt;-<span class="st"> </span>data_quest<span class="op">$</span>Y <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>,categorie)</span>
<span id="cb824-11"><a href="#cb824-11"></a>  <span class="co"># Calculer les probabilité d&#39;appartenance à i</span></span>
<span id="cb824-12"><a href="#cb824-12"></a>  values &lt;-<span class="st"> </span>predicted[test,i]</span>
<span id="cb824-13"><a href="#cb824-13"></a>  probs &lt;-<span class="st"> </span><span class="kw">ilink</span>(values)</span>
<span id="cb824-14"><a href="#cb824-14"></a>  <span class="co"># Extraire les valeurs réelles et les convertir en 0 / 1</span></span>
<span id="cb824-15"><a href="#cb824-15"></a>  real &lt;-<span class="st"> </span>data_quest[test,]<span class="op">$</span>Y</span>
<span id="cb824-16"><a href="#cb824-16"></a>  real &lt;-<span class="st"> </span><span class="kw">ifelse</span>(real<span class="op">==</span><span class="st">&quot;A&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb824-17"><a href="#cb824-17"></a>  <span class="co"># Enregistrer ces différents éléments</span></span>
<span id="cb824-18"><a href="#cb824-18"></a>  all_probs &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dv">1</span><span class="op">-</span>probs,probs)</span>
<span id="cb824-19"><a href="#cb824-19"></a>  sub_data &lt;-<span class="st"> </span><span class="kw">subset</span>(data_quest,test)</span>
<span id="cb824-20"><a href="#cb824-20"></a>  <span class="kw">return</span>(<span class="kw">list</span>(<span class="st">&quot;real&quot;</span> =<span class="st"> </span>real, <span class="st">&quot;probs&quot;</span> =<span class="st"> </span>all_probs, <span class="st">&quot;data&quot;</span> =<span class="st"> </span>sub_data))</span>
<span id="cb824-21"><a href="#cb824-21"></a>})</span>
<span id="cb824-22"><a href="#cb824-22"></a><span class="co"># Extraire les probabilités prédites</span></span>
<span id="cb824-23"><a href="#cb824-23"></a>all_probs &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, <span class="kw">lapply</span>(data_sims, <span class="cf">function</span>(i){i<span class="op">$</span>probs}))</span>
<span id="cb824-24"><a href="#cb824-24"></a><span class="co"># Extraire les vrais catégories</span></span>
<span id="cb824-25"><a href="#cb824-25"></a>all_real &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(data_sims, <span class="cf">function</span>(i){i<span class="op">$</span>real}))</span>
<span id="cb824-26"><a href="#cb824-26"></a><span class="co"># Effectuer les simulations</span></span>
<span id="cb824-27"><a href="#cb824-27"></a>simulations &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(all_probs), <span class="cf">function</span>(i){</span>
<span id="cb824-28"><a href="#cb824-28"></a>  probs &lt;-<span class="st"> </span>all_probs[i,]</span>
<span id="cb824-29"><a href="#cb824-29"></a>  sims &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">size =</span> nsim, <span class="dt">replace =</span> T, <span class="dt">prob =</span> probs)</span>
<span id="cb824-30"><a href="#cb824-30"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb824-31"><a href="#cb824-31"></a>})</span>
<span id="cb824-32"><a href="#cb824-32"></a>matsim &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, simulations)</span>
<span id="cb824-33"><a href="#cb824-33"></a><span class="co"># Calculer les résidus simulés</span></span>
<span id="cb824-34"><a href="#cb824-34"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> matsim, </span>
<span id="cb824-35"><a href="#cb824-35"></a>                            <span class="dt">observedResponse =</span> all_real,</span>
<span id="cb824-36"><a href="#cb824-36"></a>                            <span class="dt">fittedPredictedResponse =</span> all_probs[,<span class="dv">2</span>],</span>
<span id="cb824-37"><a href="#cb824-37"></a>                            <span class="dt">integerResponse =</span> T)</span>
<span id="cb824-38"><a href="#cb824-38"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb824-39"><a href="#cb824-39"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/residusmultinom-1.png" alt="Diagnostic général des résidus simulés pour le modèle multinomial" width="100%" />
<p class="caption">
(#fig:residusmultinom)Diagnostic général des résidus simulés pour le modèle multinomial
</p>
</div>
<p>La figure @ref(fig:residusmultinom2) permet d’affiner le diagnostic en s’assurant de l’absence de relation entre les variables indépendantes et les résidus. Il est possible de remarquer des irrégularités pour les variables de perceptions (premier et second panneaux). Dans les deux cas, la catégorie 1 (fort désaccord) se démarque nettement des autres catégories. Nous proposons donc de les recoder comme des variables binaires : en désaccord / pas en désaccord pour minimiser cet effet.</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="#cb825-1"></a><span class="co"># Recomposer les données pour coller au format</span></span>
<span id="cb825-2"><a href="#cb825-2"></a><span class="co"># étendu de la prediction</span></span>
<span id="cb825-3"><a href="#cb825-3"></a>etend_data &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, <span class="kw">lapply</span>(data_sims, <span class="cf">function</span>(i){i<span class="op">$</span>data}))</span>
<span id="cb825-4"><a href="#cb825-4"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb825-5"><a href="#cb825-5"></a>vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PercepOGM&quot;</span>, <span class="st">&quot;PercepRechClim&quot;</span>, <span class="st">&quot;ConnaisOGM&quot;</span>, </span>
<span id="cb825-6"><a href="#cb825-6"></a>          <span class="st">&quot;ConnaisRechClim&quot;</span>, <span class="st">&quot;CRT&quot;</span>, <span class="st">&quot;Parti&quot;</span>, <span class="st">&quot;Sexe&quot;</span>)</span>
<span id="cb825-7"><a href="#cb825-7"></a><span class="cf">for</span>(v <span class="cf">in</span>  vars){</span>
<span id="cb825-8"><a href="#cb825-8"></a>  <span class="kw">plotResiduals</span>(sim_res, etend_data[[v]], <span class="dt">xlab=</span> v, <span class="dt">ylab =</span> <span class="st">&quot;résidus&quot;</span>)</span>
<span id="cb825-9"><a href="#cb825-9"></a>}</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/glm/residusmultinom2.png" alt="Diagnostic des variables indépendantes et des résidus simulés pour le modèle multinomial" width="100%" />
<p class="caption">
(#fig:residusmultinom2)Diagnostic des variables indépendantes et des résidus simulés pour le modèle multinomial
</p>
</div>
<p>Nous réajustons donc le modèle et recalculons nos résidus ajustés (masqué ici pour alléger le document). La figure @ref(fig:residusmultinom3) nous confirme que le problème a été corrigé.</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="#cb826-1"></a><span class="co"># Convertir les variables ordinales et variables binaires</span></span>
<span id="cb826-2"><a href="#cb826-2"></a>data_quest<span class="op">$</span>PercepOGMDes &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data_quest<span class="op">$</span>PercepOGM <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb826-3"><a href="#cb826-3"></a>data_quest<span class="op">$</span>PercepRechClimDes &lt;-<span class="st"> </span><span class="kw">ifelse</span>(data_quest<span class="op">$</span>PercepRechClim <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb826-4"><a href="#cb826-4"></a><span class="co"># Réajuster le modèle</span></span>
<span id="cb826-5"><a href="#cb826-5"></a>modele3 &lt;-<span class="st"> </span><span class="kw">vglm</span>(Y <span class="op">~</span><span class="st"> </span>PercepOGMDes <span class="op">+</span><span class="st"> </span>PercepRechClimDes <span class="op">+</span><span class="st"> </span></span>
<span id="cb826-6"><a href="#cb826-6"></a><span class="st">                  </span>ConnaisOGM <span class="op">+</span><span class="st"> </span>ConnaisRechClim <span class="op">+</span><span class="st"> </span></span>
<span id="cb826-7"><a href="#cb826-7"></a><span class="st">                  </span>CRT <span class="op">+</span><span class="st"> </span>Parti <span class="op">+</span><span class="st"> </span>Sexe,</span>
<span id="cb826-8"><a href="#cb826-8"></a>               <span class="dt">data =</span> data_quest, </span>
<span id="cb826-9"><a href="#cb826-9"></a>               <span class="dt">family =</span> <span class="kw">multinomial</span>(<span class="dt">refLevel=</span><span class="st">&quot;A&quot;</span>), <span class="dt">model =</span> T)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/glm/residusmultinom3.png" alt="Diagnostic général des résidus simulés pour le modèle multinomial (version 3)" width="75%" />
<p class="caption">
(#fig:residusmultinom3)Diagnostic général des résidus simulés pour le modèle multinomial (version 3)
</p>
</div>
<p>Profitons du fait que nous utilisons le <em>package</em> <code>VGAM</code> pour vérifier l’absence d’effet de Hauck-Donner qui indiquerait que des variables indépendantes provoquent des séparations parfaites.</p>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb827-1"><a href="#cb827-1"></a>test &lt;-<span class="st"> </span><span class="kw">hdeff</span>(modele3)</span>
<span id="cb827-2"><a href="#cb827-2"></a>test[test<span class="op">==</span><span class="ot">TRUE</span>]</span></code></pre></div>
<pre><code>## (Intercept):2 (Intercept):3 
##          TRUE          TRUE</code></pre>
<p>La fonction nous informe que les constantes permettant de comparer le groupe C au groupe A, et le groupe D au groupe A provoquent des séparations parfaites. Ceci s’explique notamment par le faible nombre d’observations tombant dans ces catégories. Considérant que comparativement à la catégorie A, être dans les catégories B, C, ou D signifie remettre en cause au moins un consensus scientifique, il peut être raisonnable de fixer la constante pour qu’elle soit la même pour les trois comparaisons. Ainsi, les chances de passer de A à un autre groupe ne dépenderaient pas du groupe en question, mais uniquement des variables indépendantes. Pour cela, nous pouvons forcer le modèle à n’ajuster qu’une seule constante avec la syntaxe suivante :</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="#cb829-1"></a>modele4 &lt;-<span class="st"> </span><span class="kw">vglm</span>(Y <span class="op">~</span><span class="st"> </span>PercepOGMDes <span class="op">+</span><span class="st"> </span>PercepRechClimDes <span class="op">+</span><span class="st"> </span></span>
<span id="cb829-2"><a href="#cb829-2"></a><span class="st">                  </span>ConnaisOGM <span class="op">+</span><span class="st"> </span>ConnaisRechClim <span class="op">+</span><span class="st"> </span></span>
<span id="cb829-3"><a href="#cb829-3"></a><span class="st">                  </span>CRT <span class="op">+</span><span class="st"> </span>Parti <span class="op">+</span><span class="st"> </span>Sexe,</span>
<span id="cb829-4"><a href="#cb829-4"></a>               <span class="dt">data =</span> data_quest, </span>
<span id="cb829-5"><a href="#cb829-5"></a>               <span class="dt">family =</span> <span class="kw">multinomial</span>(<span class="dt">refLevel=</span><span class="st">&quot;A&quot;</span>,</span>
<span id="cb829-6"><a href="#cb829-6"></a>                                    <span class="dt">parallel =</span> <span class="ot">TRUE</span> <span class="op">~</span><span class="dv">1</span>), <span class="dt">model =</span> T)</span>
<span id="cb829-7"><a href="#cb829-7"></a>test &lt;-<span class="st"> </span><span class="kw">hdeff</span>(modele4)</span>
<span id="cb829-8"><a href="#cb829-8"></a><span class="kw">print</span>(<span class="kw">table</span>(test))</span></code></pre></div>
<pre><code>## test
## FALSE 
##    25</code></pre>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="#cb831-1"></a><span class="co"># Calcul du khi2 de Pearson</span></span>
<span id="cb831-2"><a href="#cb831-2"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(modele4, <span class="dt">type=</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb831-3"><a href="#cb831-3"></a>cat_predict &lt;-<span class="st"> </span><span class="kw">colnames</span>(pred)[<span class="kw">max.col</span>(pred)]</span>
<span id="cb831-4"><a href="#cb831-4"></a>freq_real &lt;-<span class="st"> </span><span class="kw">table</span>(data_quest<span class="op">$</span>Y)</span>
<span id="cb831-5"><a href="#cb831-5"></a>freq_pred &lt;-<span class="st"> </span><span class="kw">table</span>(cat_predict)</span>
<span id="cb831-6"><a href="#cb831-6"></a>khi2 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">residuals</span>(modele4, <span class="dt">type =</span> <span class="st">&quot;pearson&quot;</span>)<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb831-7"><a href="#cb831-7"></a>N &lt;-<span class="st"> </span><span class="kw">nrow</span>(data_quest)</span>
<span id="cb831-8"><a href="#cb831-8"></a>p &lt;-<span class="st"> </span>modele4<span class="op">@</span>rank</span>
<span id="cb831-9"><a href="#cb831-9"></a>r &lt;-<span class="st"> </span><span class="kw">length</span>(freq_real)</span>
<span id="cb831-10"><a href="#cb831-10"></a>ratio &lt;-<span class="st"> </span>khi2 <span class="op">/</span><span class="st"> </span>((N)<span class="op">*</span>(r<span class="dv">-1</span>)<span class="op">-</span>p)</span>
<span id="cb831-11"><a href="#cb831-11"></a><span class="kw">print</span>(ratio)</span></code></pre></div>
<pre><code>## [1] 1.010319</code></pre>
<p>Nous n’avons donc plus de séparation complète ni de sur ou sous-dispersion et les résidus simulés de la quatrième version du modèle sont toujours acceptables (figure @ref(fig:residusmultinom4)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/residusmultinom4-1.png" alt="Diagnostic général des résidus simulés pour le modèle multinomial (version 4)" width="75%" />
<p class="caption">
(#fig:residusmultinom4)Diagnostic général des résidus simulés pour le modèle multinomial (version 4)
</p>
</div>
<p><strong>Vérifier l’ajustement du modèle</strong></p>
<p>Puisque les conditions d’application du modèle sont respectées, nous pouvons à présent vérifier sa qualité d’ajustement.</p>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb833-1"><a href="#cb833-1"></a>modelenull &lt;-<span class="st"> </span><span class="kw">vglm</span>(Y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> ,</span>
<span id="cb833-2"><a href="#cb833-2"></a>                   <span class="dt">data =</span> data_quest, </span>
<span id="cb833-3"><a href="#cb833-3"></a>                   <span class="dt">family =</span> <span class="kw">multinomial</span>(<span class="dt">refLevel=</span><span class="st">&quot;A&quot;</span>,</span>
<span id="cb833-4"><a href="#cb833-4"></a>                                        <span class="dt">parallel =</span> <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>CRT)</span>
<span id="cb833-5"><a href="#cb833-5"></a>                   , <span class="dt">model =</span> T)</span>
<span id="cb833-6"><a href="#cb833-6"></a><span class="kw">rsqs</span>(<span class="dt">loglike.full =</span> <span class="kw">logLik</span>(modele4),</span>
<span id="cb833-7"><a href="#cb833-7"></a>     <span class="dt">loglike.null =</span> <span class="kw">logLik</span>(modelenull),</span>
<span id="cb833-8"><a href="#cb833-8"></a>     <span class="dt">full.deviance =</span> <span class="kw">deviance</span>(modele4),</span>
<span id="cb833-9"><a href="#cb833-9"></a>     <span class="dt">null.deviance =</span> <span class="kw">deviance</span>(modelenull),</span>
<span id="cb833-10"><a href="#cb833-10"></a>     <span class="dt">nb.params =</span> modele4<span class="op">@</span>rank,</span>
<span id="cb833-11"><a href="#cb833-11"></a>     <span class="dt">n =</span> <span class="kw">nrow</span>(data_quest)</span>
<span id="cb833-12"><a href="#cb833-12"></a>)</span></code></pre></div>
<pre><code>## $`deviance expliquee`
## [1] 0.1750071
## 
## $`McFadden ajuste`
## [1] 0.1530715
## 
## $`Cox and Snell`
## [1] 0.3397248
## 
## $Nagelkerke
## [1] 0.3746843</code></pre>
<p>Le modèle parvient à expliquer 17,5 % de la déviance totale, il obtient un R<sup>2</sup> ajusté de McFadden de 0,15, et des R<sup>2</sup> de Cox et Snell et de Nagelkerke de respectivement 0,34 et 0,37. Passons à la construction de la matrice de confusion pour analyser la capacité de prédiction du modèle.</p>
<div class="sourceCode" id="cb835"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb835-1"><a href="#cb835-1"></a>preds &lt;-<span class="st"> </span><span class="kw">predict</span>(modele4, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb835-2"><a href="#cb835-2"></a>pred_cats &lt;-<span class="st"> </span><span class="kw">colnames</span>(preds)[<span class="kw">max.col</span>(preds)]</span>
<span id="cb835-3"><a href="#cb835-3"></a>real &lt;-<span class="st"> </span>data_quest<span class="op">$</span>Y</span>
<span id="cb835-4"><a href="#cb835-4"></a>matrices &lt;-<span class="st"> </span><span class="kw">nice_confusion_matrix</span>(real, pred_cats)</span>
<span id="cb835-5"><a href="#cb835-5"></a></span>
<span id="cb835-6"><a href="#cb835-6"></a><span class="co"># Afficher la matrice de confusion</span></span>
<span id="cb835-7"><a href="#cb835-7"></a><span class="kw">print</span>(matrices<span class="op">$</span>confusion_matrix)</span></code></pre></div>
<pre><code>##           rowsnames    A          B          C          D          rs     
## colsnames &quot;&quot;           &quot;A (reel)&quot; &quot;B (reel)&quot; &quot;C (reel)&quot; &quot;D (reel)&quot; &quot;Total&quot;
## A         &quot;A (predit)&quot; &quot;482&quot;      &quot;168&quot;      &quot;75&quot;       &quot;29&quot;       &quot;754&quot;  
## B         &quot;B (predit)&quot; &quot;31&quot;       &quot;88&quot;       &quot;9&quot;        &quot;20&quot;       &quot;148&quot;  
## C         &quot;C (predit)&quot; &quot;10&quot;       &quot;6&quot;        &quot;18&quot;       &quot;6&quot;        &quot;40&quot;   
## D         &quot;D (predit)&quot; &quot;3&quot;        &quot;4&quot;        &quot;3&quot;        &quot;9&quot;        &quot;19&quot;   
##           &quot;Total&quot;      &quot;526&quot;      &quot;266&quot;      &quot;105&quot;      &quot;64&quot;       &quot;961&quot;  
##           &quot;%&quot;          &quot;54.7&quot;     &quot;27.7&quot;     &quot;10.9&quot;     &quot;6.7&quot;      NA     
##           rp    
## colsnames &quot;%&quot;   
## A         &quot;78.5&quot;
## B         &quot;15.4&quot;
## C         &quot;4.2&quot; 
## D         &quot;2&quot;   
##           NA    
##           NA</code></pre>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb837-1"><a href="#cb837-1"></a><span class="co"># Afficher les indicateurs de qualité de prédiction</span></span>
<span id="cb837-2"><a href="#cb837-2"></a><span class="kw">print</span>(matrices<span class="op">$</span>indicators)</span></code></pre></div>
<pre><code>##              rnames                           precision rappel F1    
## A            &quot;A&quot;                              &quot;0.64&quot;    &quot;0.92&quot; &quot;0.75&quot;
## B            &quot;B&quot;                              &quot;0.59&quot;    &quot;0.33&quot; &quot;0.43&quot;
## C            &quot;C&quot;                              &quot;0.45&quot;    &quot;0.17&quot; &quot;0.25&quot;
## D            &quot;D&quot;                              &quot;0.47&quot;    &quot;0.14&quot; &quot;0.22&quot;
## macro_scores &quot;macro&quot;                          &quot;0.6&quot;     &quot;0.62&quot; &quot;0.57&quot;
##              &quot;Kappa&quot;                          &quot;0.27&quot;    NA     NA    
##              &quot;Valeur de p  (precision &gt; NIR)&quot; &quot;0&quot;       NA     NA</code></pre>
<p>La précision globale (macro) du modèle est de 60 % et dépasse significativement le seuil de non-information. L’indicateur de Kappa indique un accord modéré entre la prédiction et les valeurs réelles. Les catégories C et D sont les catégories avec la plus faible précision, indiquant ainsi que le modèle a tendance à manquer les prédictions pour les individus en désaccord avec le consensus scientifique sur le réchauffement climatique. Les indices de rappel sont également très faibles pour les catégories B, C et D, indiquant que très peu d’observations appartenant originalement à ces groupes ont bien été classées dans ces groupes. La capacité de prédiction du modèle est donc relativement faible.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>Puisque nous disposons de quatre catégories dans notre variable <em>Y</em>, nous obtenons au final trois tableaux de coefficients. Il est possible de visualiser l’ensemble des coefficients du modèle avec la fonction <code>summary</code>, nous proposons les tableaux @ref(tab:coeffsmultinom1), @ref(tab:coeffsmultinom2) et @ref(tab:coeffsmultinom3) pour présenter l’ensemble des résultats.</p>
<table>
<caption>
(#tab:coeffsmultinom1)Coefficients du modèle multinomial A versus B
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coefficient
</th>
<th style="text-align:right;">
RC
</th>
<th style="text-align:right;">
val.p
</th>
<th style="text-align:right;">
RC 2,5 %
</th>
<th style="text-align:right;">
RC 97,5 %
</th>
<th style="text-align:right;">
sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
PercepOGMDes
</td>
<td style="text-align:right;">
1,940
</td>
<td style="text-align:right;">
6,989
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
4,221
</td>
<td style="text-align:right;">
11,588
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
PercepRechClimDes
</td>
<td style="text-align:right;">
0,430
</td>
<td style="text-align:right;">
1,532
</td>
<td style="text-align:right;">
0,305
</td>
<td style="text-align:right;">
0,677
</td>
<td style="text-align:right;">
3,456
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ConnaisOGM
</td>
<td style="text-align:right;">
-0,330
</td>
<td style="text-align:right;">
0,718
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,607
</td>
<td style="text-align:right;">
0,852
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
ConnaisRechClim
</td>
<td style="text-align:right;">
0,180
</td>
<td style="text-align:right;">
1,197
</td>
<td style="text-align:right;">
0,084
</td>
<td style="text-align:right;">
0,980
</td>
<td style="text-align:right;">
1,462
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
CRT
</td>
<td style="text-align:right;">
0,350
</td>
<td style="text-align:right;">
1,417
</td>
<td style="text-align:right;">
0,016
</td>
<td style="text-align:right;">
1,073
</td>
<td style="text-align:right;">
1,878
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
<em>Parti</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : Democrate
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
autre
</td>
<td style="text-align:right;">
0,660
</td>
<td style="text-align:right;">
1,934
</td>
<td style="text-align:right;">
0,001
</td>
<td style="text-align:right;">
1,310
</td>
<td style="text-align:right;">
2,858
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Republicain
</td>
<td style="text-align:right;">
0,650
</td>
<td style="text-align:right;">
1,910
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
1,259
</td>
<td style="text-align:right;">
2,915
</td>
<td style="text-align:right;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Sexe</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : homme
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
femme
</td>
<td style="text-align:right;">
1,280
</td>
<td style="text-align:right;">
3,581
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
2,535
</td>
<td style="text-align:right;">
5,053
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table></li>
</ul>
<p>Le tableau @ref(tab:coeffsmultinom1) compare donc le groupe A (en accord avec la recherche scientifique sur les deux sujets) et le groupe B (en désaccord sur la question des OGM). Les résultats indiquent que le fait de se percevoir en désaccord avec le consensus scientifique sur la question des OGM multiplie par sept les chances d’appartenir au groupe B comparativement au groupe A. Cependant, pour chaque bonne réponse supplémentaire sur les questions testant les connaissances sur les OGM, les chances d’appartenir au groupe B comparativement au groupe A diminue de 28 %. Ainsi, un individu ayant répondu correctement aux trois questions verrait ses chances réduites de 63 % d’appartenir au groupe B (<span class="math inline">\(exp(-0.33\times3)\)</span>). Il est intéressant de noter que les variables concernant le réchauffement climatique n’ont pas d’effet significatif ici. La variable CRT indique qu’à chaque bonne réponse supplémentaire au test de cognition, les chances d’appartenir au groupe B augmentent de 42 %. Un individu qui aurait répondu juste aux trois questions du test aurait donc 2,9 fois plus de chances d’appartenir au groupe B qu’au groupe A. Concernant le parti politique, comparativement à une personne se déclarant plus proche du parti démocrate, les personnes proches du parti républicain ou d’un autre parti ont près de deux fois plus de chances d’appartenir au groupe B. Enfin, une femme, comparativement à un homme, à 3,6 fois plus de chance d’appartenir au groupe B.</p>
<table>
<caption>
(#tab:coeffsmultinom2)Coefficients du modèle multinomial A versus C
</caption>
<thead>
<tr>
<th style="text-align:left;">
variable
</th>
<th style="text-align:right;">
Coefficient
</th>
<th style="text-align:right;">
RC
</th>
<th style="text-align:right;">
val.p
</th>
<th style="text-align:right;">
RC 2,5 %
</th>
<th style="text-align:right;">
RC 97,5 %
</th>
<th style="text-align:right;">
sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
PercepOGMDes
</td>
<td style="text-align:right;">
-0,180
</td>
<td style="text-align:right;">
0,834
</td>
<td style="text-align:right;">
0,705
</td>
<td style="text-align:right;">
0,326
</td>
<td style="text-align:right;">
2,138
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
PercepRechClimDes
</td>
<td style="text-align:right;">
2,060
</td>
<td style="text-align:right;">
7,821
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
3,819
</td>
<td style="text-align:right;">
16,119
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
ConnaisOGM
</td>
<td style="text-align:right;">
-0,110
</td>
<td style="text-align:right;">
0,896
</td>
<td style="text-align:right;">
0,287
</td>
<td style="text-align:right;">
0,733
</td>
<td style="text-align:right;">
1,094
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ConnaisRechClim
</td>
<td style="text-align:right;">
0,280
</td>
<td style="text-align:right;">
1,323
</td>
<td style="text-align:right;">
0,024
</td>
<td style="text-align:right;">
1,041
</td>
<td style="text-align:right;">
1,682
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
CRT
</td>
<td style="text-align:right;">
0,240
</td>
<td style="text-align:right;">
1,275
</td>
<td style="text-align:right;">
0,149
</td>
<td style="text-align:right;">
0,914
</td>
<td style="text-align:right;">
1,768
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Parti</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : Democrate
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
autre
</td>
<td style="text-align:right;">
-0,190
</td>
<td style="text-align:right;">
0,828
</td>
<td style="text-align:right;">
0,496
</td>
<td style="text-align:right;">
0,482
</td>
<td style="text-align:right;">
1,433
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Republicain
</td>
<td style="text-align:right;">
0,920
</td>
<td style="text-align:right;">
2,512
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,584
</td>
<td style="text-align:right;">
4,015
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Sexe</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : homme
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
femme:1
</td>
<td style="text-align:right;">
-0,450
</td>
<td style="text-align:right;">
0,640
</td>
<td style="text-align:right;">
0,040
</td>
<td style="text-align:right;">
0,419
</td>
<td style="text-align:right;">
0,980
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul>
<p>Le tableau @ref(tab:coeffsmultinom2) compare les groupes A et C (en désaccord sur le réchauffement climatique). Il est intéressant de noter ici que se percevoir en désaccord avec la recherche scientifique est associé avec une forte augmentation des chances d’appartenir au groupe C. Cependant, un plus grand nombre de bonnes réponses aux questions sur le réchauffement climatique est également associé avec une augmentation des chances (30 % à chaque bonne réponse supplémentaire) d’appartenir au groupe C. Le CRT n’a cette fois-ci pas d’impact. Se déclarer proche du parti républicain, comparativement au parti démocrate, multiplie les chances par 2,5 d’appartenir au groupe C. Comparativement au tableau précédent, le fait d’être une femme diminue les chances de 36 % d’appartenir au groupe C.</p>
<table>
<caption>
(#tab:coeffsmultinom3)Coefficients du modèle multinomial A versus D
</caption>
<thead>
<tr>
<th style="text-align:left;">
variable
</th>
<th style="text-align:right;">
Coefficient
</th>
<th style="text-align:right;">
RC
</th>
<th style="text-align:right;">
val.p
</th>
<th style="text-align:right;">
RC 2,5 %
</th>
<th style="text-align:right;">
RC 97,5 %
</th>
<th style="text-align:right;">
sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
PercepOGMDes
</td>
<td style="text-align:right;">
1,500
</td>
<td style="text-align:right;">
4,488
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
2,270
</td>
<td style="text-align:right;">
8,935
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
PercepRechClimDes
</td>
<td style="text-align:right;">
2,440
</td>
<td style="text-align:right;">
11,501
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
5,312
</td>
<td style="text-align:right;">
25,028
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
ConnaisOGM
</td>
<td style="text-align:right;">
-0,480
</td>
<td style="text-align:right;">
0,621
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,492
</td>
<td style="text-align:right;">
0,787
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
ConnaisRechClim
</td>
<td style="text-align:right;">
0,130
</td>
<td style="text-align:right;">
1,140
</td>
<td style="text-align:right;">
0,399
</td>
<td style="text-align:right;">
0,844
</td>
<td style="text-align:right;">
1,553
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
CRT
</td>
<td style="text-align:right;">
0,340
</td>
<td style="text-align:right;">
1,409
</td>
<td style="text-align:right;">
0,119
</td>
<td style="text-align:right;">
0,914
</td>
<td style="text-align:right;">
2,160
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Parti</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : Democrate
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
autre
</td>
<td style="text-align:right;">
0,190
</td>
<td style="text-align:right;">
1,211
</td>
<td style="text-align:right;">
0,531
</td>
<td style="text-align:right;">
0,664
</td>
<td style="text-align:right;">
2,203
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Republicain
</td>
<td style="text-align:right;">
0,630
</td>
<td style="text-align:right;">
1,872
</td>
<td style="text-align:right;">
0,038
</td>
<td style="text-align:right;">
1,041
</td>
<td style="text-align:right;">
3,387
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
<em>Sexe</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : homme
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
femme:1
</td>
<td style="text-align:right;">
-0,110
</td>
<td style="text-align:right;">
0,896
</td>
<td style="text-align:right;">
0,664
</td>
<td style="text-align:right;">
0,543
</td>
<td style="text-align:right;">
1,477
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table></li>
</ul>
<p>Le dernier tableau @ref(tab:coeffsmultinom3) compare le groupe A au groupe D (en désaccord sur les deux sujets). Les variables les plus importantes sont une fois encore le fait de se sentir en désaccord avec la recherche scientifique et le degré de connaissance sur les OGM. La variable concernant le parti politique est significative au seuil 0,05 et exprime toujours une tendance accrue pour les individus du parti républicain à appartenir au groupe D.</p>
<p>Nos propres conclusions corroborent celles de l’article original. Une des conclusions intéressantes est que le rejet du consensus scientifique ne semble pas nécessairement être associé à un déficit d’information ni à une plus faible capacité analytique, mais relèverait davantage d’une polarisation politique. Notez que cette littérature sur les croyances et la confiance dans la recherche est complexe, si le sujet vous intéresse, la discussion de l’article de <span class="citation">McFadden (<a href="#ref-mcfadden2016examining" role="doc-biblioref">2016</a>)</span> est un bon point de départ.</p>
</div>
</div>
<div id="conclusion-sur-les-modèles-pour-des-variables-qualitatives" class="section level3">
<h3><span class="header-section-number">8.2.5</span> Conclusion sur les modèles pour des variables qualitatives</h3>
<p>Nous avons pu voir dans cette section les trois principales formes de modèles GLM pour modéliser une variable binaire (modèle binomial), une variable ordinale (modèle de cotes proportionnel) et une variable multinomiale (modèle multinomial). Pour ces trois modèles, nous avons vu que la distribution utilisée est toujours la distribution binomiale et la fonction de lien logistique. Les coefficients obtenus s’interprètent comme des rapports de cotes, une fois qu’ils sont transformés avec la fonction exponentielle.</p>
</div>
</div>
<div id="sect084" class="section level2">
<h2><span class="header-section-number">8.3</span> Modèles GLM pour des variables de comptage</h2>
<p>Dans cette section, nous présentons les principaux modèles utilisés pour modéliser des variables de comptage. Il peut s’agir de variables comme le nombre d’accidents à une intersection, le nombre de cafés par quartier, le nombre de cas d’une maladie donnée par entité géographique, etc.</p>
<div id="sect0841" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Modèle de Poisson</h3>
<p>Le modèle GLM de base pour modéliser une variable de comptage est le modèle Poisson. Pour rappel, la distribution de Poisson a un seul paramètre: <span class="math inline">\(\lambda\)</span>. Il représente le nombre moyen d’évènements observés sur l’intervalle de temps d’une observation, ainsi que la dispersion de la distribution. En conséquence, <span class="math inline">\(\lambda\)</span> doit être un nombre strictement positif; autrement dit, nous ne pouvons pas observer un nombre négatif d’évènements. Il est donc nécessaire d’utiliser une fonction de lien pour contraindre l’équation de régression sur l’intervalle <span class="math inline">\([0 ,+\infty]\)</span>. La fonction la plus utilisée est le logarithme naturel (log) dont la réciproque est la fonction exponentielle (exp).</p>
<table>
<caption>
(#tab:poissondentity)Carte d’identité du modèle Poisson
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable de comptage
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Poisson
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim Poisson(\lambda)\)</span> <br/> <span class="math inline">\(g(\lambda) = \beta_0 + \beta X\)</span> <br/> <span class="math inline">\(g(x) =log(x)\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
log
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
<span class="math inline">\(\lambda\)</span>
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
Absence d’excès de zéros, absence de sur-dispersion ou de sous-dispersion
</td>
</tr>
</tbody>
</table>
<div id="interprétation-des-paramètres-1" class="section level4">
<h4><span class="header-section-number">8.3.1.1</span> Interprétation des paramètres</h4>
<p>Les coefficients du modèle expriment l’impact du changement d’une unité des variables <em>X</em> sur <span class="math inline">\(\lambda\)</span> (le nombre de cas) dans l’échelle logarithmique (<em>log-scale</em>). Pour rappel, l’échelle logarithmique est multiplicative : si nous convertissons les coefficients dans leur échelle originale avec la fonction exponentielle, leur effet n’est plus additif, mais multiplicatif.
Prenons un exemple concret, admettons que nous ayons ajusté un modèle Poisson à une variable de comptage <em>Y</em> avec deux variables <span class="math inline">\(X_1\)</span> et <span class="math inline">\(X_2\)</span> et que nous ayons obtenus les coefficients suivants :</p>
<p><span class="math inline">\(\beta_0 = 1,8 \text{; } \beta_1 = 0,5 \text{; } \beta_2 = -1,5\)</span></p>
<p>L’interprétation basique (sur l’échelle logarithmique) est la suivante : une augmentation d’une unité de la variable <span class="math inline">\(X_1\)</span> est associée avec une augmentation de 0,5 du logarithme du nombre de cas attendus. Une augmentation d’une unité de la variable <span class="math inline">\(X_2\)</span> est associée avec une réduction de 1,5 unités du logarithme du nombre de cas attendus. Avec la conversion avec la fonction exponentielle, nous obtenons alors :</p>
<ul>
<li><span class="math inline">\(\mbox{exp(0,5) = 1,649}\)</span>, soit une multiplication par 1,649 du nombre de cas attendu (aussi appelé taux d’incident) à chaque augmentation d’une unité de <span class="math inline">\(X_1\)</span>;</li>
<li><span class="math inline">\(\mbox{exp(-1,5) = 0,223}\)</span>, soit une division par 4,54 (1/0,223) du nombre de cas attendu (aussi appelé taux d’incident) à chaque augmentation d’une unité de <span class="math inline">\(X_2\)</span>.</li>
</ul>
<p>Utilisons maintenant notre équation pour effectuer une prédiction si <span class="math inline">\(X_1 = 1\)</span> et <span class="math inline">\(X_2 = 1\)</span>.</p>
<p><span class="math inline">\(\lambda = exp(1,8 + (\mbox{0,5}\times 1) + (\mbox{-1,5}\times1)) = \mbox{2,225}\)</span></p>
<p>Si nous augmentons <span class="math inline">\(X_1\)</span> d’une unité, nous obtenons alors :</p>
<p><span class="math inline">\(\lambda = exp(1,8 + (\mbox{0,5}\times 2) + (\mbox{-1,5}\times1)) = \mbox{3,670}\)</span></p>
<p>En ayant augmenté d’une unité <span class="math inline">\(X_1\)</span>, nous avons multiplié notre résultat par 1,649 (<span class="math inline">\(\mbox{2,225} \times \mbox{1,649 = 3,670}\)</span>).</p>
<p>Notez que ces effets se multiplient entre eux. Si nous augmentons à la fois <span class="math inline">\(X_1\)</span> et <span class="math inline">\(X_2\)</span> d’une unité chacune, nous obtenons : <span class="math inline">\(\lambda = exp(1,8 + (\mbox{0,5} \times 2) + (\mbox{-1,5} \times 2)) = \mbox{0,818}\)</span>, ce qui correspond bien à <span class="math inline">\(\mbox{2,225} \times \mbox{1,649} \text{ (effet de  }X_1\text{)} \times \mbox{0,223} \text{ (effet de }X_2\text{)} = \mbox{0,818}\)</span>.</p>
<p>Il existe des fonctions dans R qui calculent ces prédictions à partir des équations des modèles. Il est cependant essentiel de bien saisir ce comportement multiplicatif induit par la fonction de lien log.</p>
<div id="conditions-dapplication-2" class="section level5">
<h5><span class="header-section-number">8.3.1.1.1</span> Conditions d’application</h5>
<p>Puisque la distribution de Poisson n’a qu’un seul paramètre, le modèle GLM de Poisson est exposé au même problème potentiel de sur-dispersion que les modèles binomiaux de la section précédente. Référez-vous à la section @ref(sectcondapp) pour davantage de détails sur le problème posé par la sur-dispersion. Pour détecter une potentielle sur-dispersion dans un modèle de Poisson, il est possible dans un premier temps de calculer le ratio entre la déviance du modèle et son nombre de degrés de liberté <span class="citation">(SAS Institute Inc <a href="#ref-Saspoiss" role="doc-biblioref">2020</a><a href="#ref-Saspoiss" role="doc-biblioref">b</a>)</span>. Ce ratio doit être proche de 1, s’il est plus grand, le modèle souffre de sur-dispersion.</p>

<p><span class="math display">\[\begin{equation}
\hat{\phi} = \frac{D(modele)}{N-p}
(\#eq:glm16)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(N\)</span> et <span class="math inline">\(p\)</span> étant respectivement les nombres d’observations et de paramètres. Il est également possible de tester formellement si la sur-dispersion est significative avec un test de dispersion.</p>
<p>La question de l’excès de zéros a été abordée dans la section @ref(sectpoissonzero) du chapitre @ref(chap02). Il s’agit d’une situation où un plus grand nombre de zéros sont présents dans les données que ce que suppose la distribution de Poisson. Dans ce cas, il convient d’utiliser la distribution de Poisson avec excès de zéros.</p>
</div>
</div>
<div id="exemple-appliqué-dans-r-2" class="section level4">
<h4><span class="header-section-number">8.3.1.2</span> Exemple appliqué dans R</h4>
<p>Pour cet exemple, nous allons reproduire l’analyse effectuée dans l’article de <span class="citation">Cloutier et al. (<a href="#ref-cloutier2014carrefours" role="doc-biblioref">2014</a>)</span>. L’enjeu de cette étude était de modéliser le nombre de piétons blessés autour de plus de 500 carrefours dans les quartiers centraux de Montréal. Pour cela, trois types de variables étaient utilisées : des variables décrivant l’intersection, des variables décrivant les activités humaines dans un rayon d’un kilomètre autour de l’intersection et des variables représentant le trafic routier autour de l’intersection. Un impact direct de ce type d’étude est bien évidemment l’établissement de meilleures pratiques d’aménagement réduisant les risques encourus par les piétons lors de leurs déplacements en ville. Le tableau @ref(tab:variablepoiss) présente l’ensemble des variables utilisées dans l’analyse.</p>
<table>
<caption>
(#tab:variablepoiss)Variables indépendantes utilisées dans le modèle de Poisson
</caption>
<thead>
<tr>
<th style="text-align:left;">
Nom de la variable
</th>
<th style="text-align:left;">
Signification
</th>
<th style="text-align:left;">
Type de variable
</th>
<th style="text-align:left;">
Mesure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Feux_auto
</td>
<td style="text-align:left;">
Présence de feux de circulation
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
0 = absence; 1 = présence
</td>
</tr>
<tr>
<td style="text-align:left;">
Feux_piet
</td>
<td style="text-align:left;">
Présence de feux de traversée pour les piétons
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
0 = absence; 1 = présence
</td>
</tr>
<tr>
<td style="text-align:left;">
Pass_piet
</td>
<td style="text-align:left;">
Présence d’un passage piéton
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
0 = absence; 1 = présence
</td>
</tr>
<tr>
<td style="text-align:left;">
Terreplein
</td>
<td style="text-align:left;">
Présence d’un terre-plein central
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
0 = absence; 1 = présence
</td>
</tr>
<tr>
<td style="text-align:left;">
Apaisement
</td>
<td style="text-align:left;">
Présence de mesure d’apaisement de la circulation
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
0 = absence; 1 = présence
</td>
</tr>
<tr>
<td style="text-align:left;">
LogEmploi
</td>
<td style="text-align:left;">
Logarithme du nombre d’emplois dans un rayon d’un kilomètre
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Logarithme du nombre d’emploi. Utilisation du logarithme car la variable est fortement asymétrique
</td>
</tr>
<tr>
<td style="text-align:left;">
Densite_pop
</td>
<td style="text-align:left;">
Densité de population dans un rayon d’un kilomètre
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Habitants par hectare
</td>
</tr>
<tr>
<td style="text-align:left;">
Entropie
</td>
<td style="text-align:left;">
Diversité des occupations du sol dans un rayon d’un kilomètre (indice d’entropie)
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Mesure de 0 à 1; 0 = spécialisation parfaite; 1 = diversité parfaite
</td>
</tr>
<tr>
<td style="text-align:left;">
DensiteInter
</td>
<td style="text-align:left;">
Densité d’intersections dans un rayon d’un kilomètre (connexité)
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Nombre d’intersection par km2
</td>
</tr>
<tr>
<td style="text-align:left;">
Artere
</td>
<td style="text-align:left;">
Présence d’une artère à l’intersection
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
0 = absence; 1 = présence
</td>
</tr>
<tr>
<td style="text-align:left;">
Long_arterePS
</td>
<td style="text-align:left;">
Longueur d’artère dans un rayon d’un kilomètre
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Exprimée en mètres
</td>
</tr>
<tr>
<td style="text-align:left;">
NB_voies5
</td>
<td style="text-align:left;">
Présence d’une cinq voies à l’intersection
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
0 = absence; 1 = présence
</td>
</tr>
</tbody>
</table>
<p>La distribution originale de la variable est décrite à la figure @ref(fig:distripoissmod). Les barres grises représentent la distribution du nombre d’accidents et les barres rouges une distribution de Poisson ajustée sans variable indépendante (modèle nul). Ce premier graphique peut laisser penser qu’un modèle de Poisson ne sera pas nécessairement le plus adapté considérant le grand nombre d’intersections pour lesquelles nous n’avons aucun accident. Cependant, rappelons que la variable <em>Y</em> n’a pas besoin de suivre une distribution de Poisson. Dans un modèle GLM, l’hypothèse que nous formulons est que la variable dépendante (<em>Y</em>) <strong>conditionnée par les variables indépendantes (<em>X</em>)</strong> suit une certaine distribution (ici Poisson).</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb839-1"><a href="#cb839-1"></a><span class="co"># Chargement des données</span></span>
<span id="cb839-2"><a href="#cb839-2"></a>data_accidents &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/glm/accident_pietons.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb839-3"><a href="#cb839-3"></a><span class="co"># Ajustement d&#39;une distribution de Poisson sans variable indépendante</span></span>
<span id="cb839-4"><a href="#cb839-4"></a><span class="kw">library</span>(fitdistrplus)</span>
<span id="cb839-5"><a href="#cb839-5"></a>model_poisson &lt;-<span class="st"> </span><span class="kw">fitdist</span>(data_accidents<span class="op">$</span>Nbr_acci,<span class="dt">distr =</span> <span class="st">&quot;pois&quot;</span>)</span>
<span id="cb839-6"><a href="#cb839-6"></a><span class="co"># Création d&#39;un graphique pour comparer les deux distributions</span></span>
<span id="cb839-7"><a href="#cb839-7"></a>dfpoisson &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">19</span>),</span>
<span id="cb839-8"><a href="#cb839-8"></a>                        <span class="dt">y=</span><span class="kw">dpois</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">19</span>, model_poisson<span class="op">$</span>estimate)</span>
<span id="cb839-9"><a href="#cb839-9"></a>)</span>
<span id="cb839-10"><a href="#cb839-10"></a>counts &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">table</span>(data_accidents<span class="op">$</span>Nbr_acci))</span>
<span id="cb839-11"><a href="#cb839-11"></a><span class="kw">names</span>(counts) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;nb_accident&quot;</span>,<span class="st">&#39;frequence&#39;</span>)</span>
<span id="cb839-12"><a href="#cb839-12"></a>counts<span class="op">$</span>nb_accident &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(counts<span class="op">$</span>nb_accident))</span>
<span id="cb839-13"><a href="#cb839-13"></a>counts<span class="op">$</span>prop &lt;-<span class="st"> </span>counts<span class="op">$</span>frequence <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(counts<span class="op">$</span>frequence)</span>
<span id="cb839-14"><a href="#cb839-14"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb839-15"><a href="#cb839-15"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>nb_accident, <span class="dt">weight =</span> prop, <span class="dt">fill =</span> <span class="st">&quot;real&quot;</span>), <span class="dt">width =</span> <span class="fl">0.6</span>, <span class="dt">data =</span> counts)<span class="op">+</span></span>
<span id="cb839-16"><a href="#cb839-16"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">weight =</span> y, <span class="dt">fill =</span> <span class="st">&quot;adj&quot;</span>), <span class="dt">width =</span> <span class="fl">0.15</span>, <span class="dt">data =</span> dfpoisson)<span class="op">+</span></span>
<span id="cb839-17"><a href="#cb839-17"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="dv">7</span>), <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">7</span>))<span class="op">+</span></span>
<span id="cb839-18"><a href="#cb839-18"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">name =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb839-19"><a href="#cb839-19"></a>          <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;real&quot;</span>,<span class="st">&quot;adj&quot;</span>),</span>
<span id="cb839-20"><a href="#cb839-20"></a>          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;distribution originale&quot;</span>, <span class="st">&quot;distribution de Poisson&quot;</span>),</span>
<span id="cb839-21"><a href="#cb839-21"></a>          <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;real&quot;</span> =<span class="st"> </span><span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>), <span class="st">&quot;adj&quot;</span> =<span class="st"> &quot;red&quot;</span>))<span class="op">+</span></span>
<span id="cb839-22"><a href="#cb839-22"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb839-23"><a href="#cb839-23"></a>       <span class="dt">x =</span> <span class="st">&quot;nombre d&#39;accidents&quot;</span>,</span>
<span id="cb839-24"><a href="#cb839-24"></a>       <span class="dt">y =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/distripoissmod-1.png" alt="Distribution originale du nombre d'accidents par intersection" width="65%" />
<p class="caption">
(#fig:distripoissmod)Distribution originale du nombre d’accidents par intersection
</p>
</div>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Comme précédemment, notre première étape est de vérifier l’absence de multicolinéarité excessive avec la fonction <code>vif</code> du <em>package</em> <code>car</code>.</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="#cb840-1"></a><span class="kw">vif</span>(<span class="kw">glm</span>(Nbr_acci <span class="op">~</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Pass_piet <span class="op">+</span><span class="st"> </span>Terreplein <span class="op">+</span><span class="st"> </span>Apaisement <span class="op">+</span></span>
<span id="cb840-2"><a href="#cb840-2"></a><span class="st">          </span>LogEmploi <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span>Entropie <span class="op">+</span><span class="st"> </span>DensiteInter <span class="op">+</span></span>
<span id="cb840-3"><a href="#cb840-3"></a><span class="st">          </span>Long_arterePS <span class="op">+</span><span class="st"> </span>Artere <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb840-4"><a href="#cb840-4"></a>        <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link=</span><span class="st">&quot;log&quot;</span>),</span>
<span id="cb840-5"><a href="#cb840-5"></a>        <span class="dt">data =</span> data_accidents))</span></code></pre></div>
<pre><code>##     Feux_auto     Feux_piet     Pass_piet    Terreplein    Apaisement 
##      2.861708      1.518668      2.321213      1.221683      1.059722 
##     LogEmploi   Densite_pop      Entropie  DensiteInter Long_arterePS 
##      4.763692      1.153096      1.770904      2.040457      4.467841 
##        Artere     NB_voies5 
##      1.887728      1.520514</code></pre>
<p>Toutes les valeurs de VIF sont inférieures à 5. Notons tout de même que le logarithme de l’emploi et la longueur d’artère dans un rayon d’un kilomètre ont des valeurs de VIF proches de 5. La seconde étape du diagnostic consiste à calculer et visualiser les distances de Cook.</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="#cb842-1"></a><span class="co"># Ajustement d&#39;une première version du modèle</span></span>
<span id="cb842-2"><a href="#cb842-2"></a>modele &lt;-<span class="st"> </span><span class="kw">glm</span>(Nbr_acci <span class="op">~</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Pass_piet <span class="op">+</span><span class="st"> </span>Terreplein <span class="op">+</span><span class="st"> </span>Apaisement <span class="op">+</span></span>
<span id="cb842-3"><a href="#cb842-3"></a><span class="st">                </span>LogEmploi <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span>Entropie <span class="op">+</span><span class="st"> </span>DensiteInter <span class="op">+</span></span>
<span id="cb842-4"><a href="#cb842-4"></a><span class="st">                </span>Long_arterePS <span class="op">+</span><span class="st"> </span>Artere <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb842-5"><a href="#cb842-5"></a>              <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link=</span><span class="st">&quot;log&quot;</span>),</span>
<span id="cb842-6"><a href="#cb842-6"></a>              <span class="dt">data =</span> data_accidents)</span>
<span id="cb842-7"><a href="#cb842-7"></a></span>
<span id="cb842-8"><a href="#cb842-8"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb842-9"><a href="#cb842-9"></a>cooksd &lt;-<span class="st"> </span><span class="kw">cooks.distance</span>(modele)</span>
<span id="cb842-10"><a href="#cb842-10"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb842-11"><a href="#cb842-11"></a>  <span class="dt">cook =</span> cooksd,</span>
<span id="cb842-12"><a href="#cb842-12"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cooksd)</span>
<span id="cb842-13"><a href="#cb842-13"></a>)</span>
<span id="cb842-14"><a href="#cb842-14"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb842-15"><a href="#cb842-15"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cook), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)<span class="op">+</span></span>
<span id="cb842-16"><a href="#cb842-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb842-17"><a href="#cb842-17"></a>       <span class="dt">y =</span> <span class="st">&quot;Distance de Cook&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/poisscookdist-1.png" alt="Distances de Cook pour le modèle de Poisson" width="60%" />
<p class="caption">
(#fig:poisscookdist)Distances de Cook pour le modèle de Poisson
</p>
</div>
<p>La figure @ref(fig:poisscookdist) signale la présence de trois observations avec des valeurs extrêmement fortes de distance de Cook. Nous les isolons dans un premier temps pour les analyser.</p>
<div class="sourceCode" id="cb843"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb843-1"><a href="#cb843-1"></a>cas_etrange &lt;-<span class="st"> </span><span class="kw">subset</span>(data_accidents, cooksd<span class="op">&gt;</span><span class="fl">0.1</span>)</span>
<span id="cb843-2"><a href="#cb843-2"></a><span class="kw">print</span>(cas_etrange)</span></code></pre></div>
<pre><code>##     Nbr_acci Feux_auto Feux_piet Pass_piet Terreplein Apaisement EmpTotBuffer
## 1         19         1         1         1          1          0     7208.538
## 26         7         0         0         1          0          0     1342.625
## 428        0         1         1         1          0          1    13122.560
##     Densite_pop  Entropie DensiteInter Long_arterePS Artere NB_voies5 log_acci
## 1      5980.923 0.8073926     42.41597       6955.00      1         1 2.995732
## 26     2751.012 0.0000000     73.35344       2849.66      0         0 2.079442
## 428   14148.827 0.6643891    109.25066       4634.20      0         0 0.000000
##     catego_acci catego_acci2 Arret VAG sum_app LogEmploi AccOrdinal     PopHa
## 1             1            1     0   1       4  8.883021          2  5.980923
## 26            1            1     1   1       3  7.202382          2  2.751012
## 428           0            0     0   0       3  9.482088          0 14.148827</code></pre>
<p>Les deux premiers cas sont des intersections avec de nombreux accidents (respectivement 19 et 7) qui risquent de perturber les estimations du modèle. Le troisième cas ne comprend en revanche aucun accident. Puisqu’il ne s’agit que de trois observations et que leurs distances de Cook sont très nettement supérieures aux autres, nous les retirons du modèle.</p>
<div class="sourceCode" id="cb845"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb845-1"><a href="#cb845-1"></a>data2 &lt;-<span class="st"> </span><span class="kw">subset</span>(data_accidents, cooksd<span class="op">&lt;</span><span class="fl">0.1</span>)</span>
<span id="cb845-2"><a href="#cb845-2"></a><span class="co"># Ajustement d&#39;une première version du modèle</span></span>
<span id="cb845-3"><a href="#cb845-3"></a>modele &lt;-<span class="st"> </span><span class="kw">glm</span>(Nbr_acci <span class="op">~</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Pass_piet <span class="op">+</span><span class="st"> </span>Terreplein <span class="op">+</span><span class="st"> </span>Apaisement <span class="op">+</span></span>
<span id="cb845-4"><a href="#cb845-4"></a><span class="st">                </span>LogEmploi <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span>Entropie <span class="op">+</span><span class="st"> </span>DensiteInter <span class="op">+</span></span>
<span id="cb845-5"><a href="#cb845-5"></a><span class="st">                </span>Long_arterePS <span class="op">+</span><span class="st"> </span>Artere <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb845-6"><a href="#cb845-6"></a>              <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link=</span><span class="st">&quot;log&quot;</span>),</span>
<span id="cb845-7"><a href="#cb845-7"></a>              <span class="dt">data =</span> data2)</span>
<span id="cb845-8"><a href="#cb845-8"></a></span>
<span id="cb845-9"><a href="#cb845-9"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb845-10"><a href="#cb845-10"></a>cooksd &lt;-<span class="st"> </span><span class="kw">cooks.distance</span>(modele)</span>
<span id="cb845-11"><a href="#cb845-11"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb845-12"><a href="#cb845-12"></a>  <span class="dt">cook =</span> cooksd,</span>
<span id="cb845-13"><a href="#cb845-13"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cooksd)</span>
<span id="cb845-14"><a href="#cb845-14"></a>)</span>
<span id="cb845-15"><a href="#cb845-15"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb845-16"><a href="#cb845-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cook), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)<span class="op">+</span></span>
<span id="cb845-17"><a href="#cb845-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb845-18"><a href="#cb845-18"></a>       <span class="dt">y =</span> <span class="st">&quot;distance de Cook&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/poisscookdist2-1.png" alt="Distances de Cook pour le modèle de Poisson après avoir retiré les valeurs aberrentes" width="60%" />
<p class="caption">
(#fig:poisscookdist2)Distances de Cook pour le modèle de Poisson après avoir retiré les valeurs aberrentes
</p>
</div>
<p>La figure @ref(fig:poisscookdist2) montre que nous n’avons plus d’observations fortement influentes dans le modèle après avoir retiré les trois observations identifiées précédemment. Nous devons à présent vérifier l’absence de sur-dispersion.</p>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="#cb846-1"></a><span class="co"># Calcul du rapport entre déviance et nombre de degrés de liberté du modèle</span></span>
<span id="cb846-2"><a href="#cb846-2"></a><span class="kw">deviance</span>(modele)<span class="op">/</span>(<span class="kw">nrow</span>(data2) <span class="op">-</span><span class="st"> </span>modele<span class="op">$</span>rank)</span></code></pre></div>
<pre><code>## [1] 1.674691</code></pre>
<p>Le rapport entre la déviance et le nombre de degrés de liberté du modèle est nettement supérieur à 1, indiquant une sur-dispersion excessive. Nous pouvons confirmer ce résultat avec la fonction <code>dispersiontest</code> du <em>package</em> <code>AER</code>.</p>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb848-1"><a href="#cb848-1"></a><span class="kw">library</span>(AER)</span>
<span id="cb848-2"><a href="#cb848-2"></a><span class="co"># Test de sur-dispersion</span></span>
<span id="cb848-3"><a href="#cb848-3"></a><span class="kw">dispersiontest</span>(modele)</span></code></pre></div>
<pre><code>## 
##  Overdispersion test
## 
## data:  modele
## z = 5.2737, p-value = 6.686e-08
## alternative hypothesis: true dispersion is greater than 1
## sample estimates:
## dispersion 
##   1.891565</code></pre>
<p>Contrairement à la forme classique d’un modèle de Poisson pour laquelle la dispersion attendue est de 1, le test nous indique qu’une dispersion de serait mieux ajustée aux données.</p>
<p>Il est également possible d’illuster cet écart à l’aide d’un graphique représentant les valeurs réelles, les valeurs prédites, ainsi que la variance (sous forme de barres d’erreurs) attendue par le modèle (figure @ref(fig:surdisppoiss)). Nous constatons ainsi que les valeurs réelles (en rouge) ont largement tendance à dépasser la variance attendue par le modèle, surtout pour les valeurs les plus faibles de la distribution.</p>
<div class="sourceCode" id="cb850"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb850-1"><a href="#cb850-1"></a><span class="co"># Extraction des prédictions du modèle</span></span>
<span id="cb850-2"><a href="#cb850-2"></a>lambdas &lt;-<span class="st"> </span><span class="kw">predict</span>(modele, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb850-3"><a href="#cb850-3"></a><span class="co"># Création d&#39;un DataFrame pour contenir la prédiction et les vraies valeurs</span></span>
<span id="cb850-4"><a href="#cb850-4"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb850-5"><a href="#cb850-5"></a>  <span class="dt">lambdas =</span> lambdas,</span>
<span id="cb850-6"><a href="#cb850-6"></a>  <span class="dt">reals =</span> data2<span class="op">$</span>Nbr_acci</span>
<span id="cb850-7"><a href="#cb850-7"></a>)</span>
<span id="cb850-8"><a href="#cb850-8"></a><span class="co"># Calcul de l&#39;intervalle de confiance à 95 % selon la distribution de Poisson</span></span>
<span id="cb850-9"><a href="#cb850-9"></a><span class="co"># et stockage dans un second DataFrame</span></span>
<span id="cb850-10"><a href="#cb850-10"></a>seqa &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="kw">round</span>(<span class="kw">max</span>(lambdas)),<span class="dv">1</span>)</span>
<span id="cb850-11"><a href="#cb850-11"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb850-12"><a href="#cb850-12"></a>  <span class="dt">lambdas =</span> seqa,</span>
<span id="cb850-13"><a href="#cb850-13"></a>  <span class="dt">lower =</span> <span class="kw">qpois</span>(<span class="dt">p =</span> <span class="fl">0.025</span>, <span class="dt">lambda =</span> seqa),</span>
<span id="cb850-14"><a href="#cb850-14"></a>  <span class="dt">upper =</span> <span class="kw">qpois</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">lambda =</span> seqa)</span>
<span id="cb850-15"><a href="#cb850-15"></a>)</span>
<span id="cb850-16"><a href="#cb850-16"></a><span class="co"># Affichage des valeurs réelles et prédites (en rouge)</span></span>
<span id="cb850-17"><a href="#cb850-17"></a><span class="co"># et de leur variance selon le modèle (en noir)</span></span>
<span id="cb850-18"><a href="#cb850-18"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb850-19"><a href="#cb850-19"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="dt">data =</span> df2,</span>
<span id="cb850-20"><a href="#cb850-20"></a>                <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> lambdas, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper),</span>
<span id="cb850-21"><a href="#cb850-21"></a>                <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb850-22"><a href="#cb850-22"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df1, </span>
<span id="cb850-23"><a href="#cb850-23"></a>             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> lambdas, <span class="dt">y =</span> reals),</span>
<span id="cb850-24"><a href="#cb850-24"></a>             <span class="dt">color =</span><span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb850-25"><a href="#cb850-25"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;valeurs prédites&#39;</span>,</span>
<span id="cb850-26"><a href="#cb850-26"></a>       <span class="dt">y =</span> <span class="st">&quot;valeurs réelles&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/surdisppoiss-1.png" alt="Représentation de la sur-dispersion des données dans le modèle de Poisson" width="65%" />
<p class="caption">
(#fig:surdisppoiss)Représentation de la sur-dispersion des données dans le modèle de Poisson
</p>
</div>
<p>Pour tenir compte de cette particularité des données, nous modifions légèrement le modèle pour utiliser une distribution de quasi-Poisson, intégrant spécifiquement un paramètre de dispersion. Cet ajustement ne modifie pas l’estimation des coefficients du modèle, mais modifie le calcul des erreurs standards et par extension les valeurs de <em>p</em> pour les rendre moins sensibles au problème de sur-dispersion. Une autre approche aurait été de calculer une version robuste des erreurs standards avec le <em>package</em> <code>sandwich</code> comme nous l’avons fait dans la section @ref(sect0821) sur le modèle binomial. Après réajustement du modèle, le nouveau paramètre de dispersion estimé est de 1,92.</p>
<div class="bloc_notes">
<p><strong>Les quasi-distributions</strong></p>
<p>Les distributions binomiale et de Poisson ne disposent chacune que d’un paramètre décrivant à la fois leur dispersion et leur espérance. Elles manquent donc de flexibilité et échouent parfois à représenter fidèlement des données avec une forte variance. Il existe donc des distributions alternatives, respectivement les distributions quasi-binomiale et quasi-Poisson comprenant chacune un paramètre supplémentaire pour contrôler la dispersion. Bien que cette solution soit attrayante, il ne faut pas perdre de vue que la sur ou la sous dispersion peuvent être causées par l’absence de certaines variables explicatives, la sur-représentation de zéros, ou encore une séparation parfaite de la variable dépendante causée par une variable indépendante.</p>
</div>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="#cb851-1"></a>modele2 &lt;-<span class="st"> </span><span class="kw">glm</span>(Nbr_acci <span class="op">~</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Pass_piet <span class="op">+</span><span class="st"> </span>Terreplein <span class="op">+</span><span class="st"> </span>Apaisement <span class="op">+</span></span>
<span id="cb851-2"><a href="#cb851-2"></a><span class="st">                </span>LogEmploi <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span>Entropie <span class="op">+</span><span class="st"> </span>DensiteInter <span class="op">+</span></span>
<span id="cb851-3"><a href="#cb851-3"></a><span class="st">                </span>Long_arterePS <span class="op">+</span><span class="st"> </span>Artere <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb851-4"><a href="#cb851-4"></a>              <span class="dt">family =</span> <span class="kw">quasipoisson</span>(<span class="dt">link=</span><span class="st">&quot;log&quot;</span>),</span>
<span id="cb851-5"><a href="#cb851-5"></a>              <span class="dt">data =</span> data2)</span></code></pre></div>
<p>Nous pouvons à présent comparer la distribution originale des données et les simulations issues du modèle. Notez que contrairement à la distribution de Poisson simple, il n’existe pas dans R de fonction pour simuler des valeurs issues d’une distribution de quasi-Poisson. Il est cependant possible d’exploiter sa proximité théorique avec la distribution binomiale négative pour définir notre propre fonction de simulation. La figure @ref(fig:comppoissdistr) permet de comparer la distribution originale (en gris) et l’intervalle de confiance à 95 % des simulations (en rouge). Nous remarquons que le modèle semble capturer efficacement la forme générale de la distribution originale. À titre de comparaison, nous pouvons effectuer le même exercice avec la distribution de Poisson classique (le code n’est pas montré pour éviter les répétitions). La figure @ref(fig:comppoissdistr2) montre qu’un simple modèle de Poisson est très éloigné de la distribution originale de <em>Y</em>.</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb852-1"><a href="#cb852-1"></a><span class="co"># Définition d&#39;une fonction pour simuler des données quasi-Poisson</span></span>
<span id="cb852-2"><a href="#cb852-2"></a>rqpois &lt;-<span class="st"> </span><span class="cf">function</span>(n, lambda, disp) {</span>
<span id="cb852-3"><a href="#cb852-3"></a>  <span class="kw">rnbinom</span>(<span class="dt">n =</span> n, <span class="dt">mu =</span> lambda, <span class="dt">size =</span> lambda<span class="op">/</span>(disp<span class="dv">-1</span>))</span>
<span id="cb852-4"><a href="#cb852-4"></a>}</span>
<span id="cb852-5"><a href="#cb852-5"></a><span class="co"># Extraction des valeurs prédites par le modèle</span></span>
<span id="cb852-6"><a href="#cb852-6"></a>preds &lt;-<span class="st"> </span><span class="kw">predict</span>(modele2, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb852-7"><a href="#cb852-7"></a><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span id="cb852-8"><a href="#cb852-8"></a>disp &lt;-<span class="st"> </span><span class="kw">summary</span>(modele2)<span class="op">$</span>dispersion</span>
<span id="cb852-9"><a href="#cb852-9"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb852-10"><a href="#cb852-10"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(preds),<span class="cf">function</span>(i){</span>
<span id="cb852-11"><a href="#cb852-11"></a>  lambda &lt;-<span class="st"> </span>preds[[i]]</span>
<span id="cb852-12"><a href="#cb852-12"></a>  sims &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rqpois</span>(<span class="dt">n =</span> nsim, <span class="dt">lambda =</span> lambda, <span class="dt">disp =</span> disp))</span>
<span id="cb852-13"><a href="#cb852-13"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb852-14"><a href="#cb852-14"></a>})</span>
<span id="cb852-15"><a href="#cb852-15"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb852-16"><a href="#cb852-16"></a><span class="co"># Préparation des données pour le graphique (valeurs réelles)</span></span>
<span id="cb852-17"><a href="#cb852-17"></a>counts &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">table</span>(data2<span class="op">$</span>Nbr_acci))</span>
<span id="cb852-18"><a href="#cb852-18"></a><span class="kw">names</span>(counts) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;nb_accident&quot;</span>,<span class="st">&#39;frequence&#39;</span>)</span>
<span id="cb852-19"><a href="#cb852-19"></a>counts<span class="op">$</span>nb_accident &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(counts<span class="op">$</span>nb_accident))</span>
<span id="cb852-20"><a href="#cb852-20"></a>counts<span class="op">$</span>prop &lt;-<span class="st"> </span>counts<span class="op">$</span>frequence <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(counts<span class="op">$</span>frequence)</span>
<span id="cb852-21"><a href="#cb852-21"></a><span class="co"># Préparation des données pour le graphique (valeurs simulées)</span></span>
<span id="cb852-22"><a href="#cb852-22"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">count =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">25</span>)</span>
<span id="cb852-23"><a href="#cb852-23"></a>count_sims &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span>nsim, <span class="cf">function</span>(i){</span>
<span id="cb852-24"><a href="#cb852-24"></a>  sim &lt;-<span class="st"> </span>mat_sims[,i]</span>
<span id="cb852-25"><a href="#cb852-25"></a>  cnt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">table</span>(sim))</span>
<span id="cb852-26"><a href="#cb852-26"></a>  df2 &lt;-<span class="st"> </span><span class="kw">merge</span>(df1,cnt, <span class="dt">by.x=</span><span class="st">&quot;count&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;sim&quot;</span>, <span class="dt">all.x =</span> T, <span class="dt">all.y=</span>F)</span>
<span id="cb852-27"><a href="#cb852-27"></a>  df2<span class="op">$</span>Freq &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(df2<span class="op">$</span>Freq),<span class="dv">0</span>,df2<span class="op">$</span>Freq)</span>
<span id="cb852-28"><a href="#cb852-28"></a>  <span class="kw">return</span>(df2<span class="op">$</span>Freq)</span>
<span id="cb852-29"><a href="#cb852-29"></a>})</span>
<span id="cb852-30"><a href="#cb852-30"></a>count_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(cbind,count_sims)</span>
<span id="cb852-31"><a href="#cb852-31"></a>df_sims &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb852-32"><a href="#cb852-32"></a>  <span class="dt">val =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">25</span>,</span>
<span id="cb852-33"><a href="#cb852-33"></a>  <span class="dt">med =</span> <span class="kw">apply</span>(count_sims, <span class="dt">MARGIN =</span> <span class="dv">1</span>, median),</span>
<span id="cb852-34"><a href="#cb852-34"></a>  <span class="dt">lower =</span> <span class="kw">apply</span>(count_sims, <span class="dt">MARGIN =</span> <span class="dv">1</span>, quantile, <span class="dt">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb852-35"><a href="#cb852-35"></a>  <span class="dt">upper =</span> <span class="kw">apply</span>(count_sims, <span class="dt">MARGIN =</span> <span class="dv">1</span>, quantile, <span class="dt">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb852-36"><a href="#cb852-36"></a>)</span>
<span id="cb852-37"><a href="#cb852-37"></a></span>
<span id="cb852-38"><a href="#cb852-38"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb852-39"><a href="#cb852-39"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>nb_accident, <span class="dt">weight =</span> frequence), <span class="dt">width =</span> <span class="fl">0.6</span>, <span class="dt">data =</span> counts)<span class="op">+</span></span>
<span id="cb852-40"><a href="#cb852-40"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> val, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper),</span>
<span id="cb852-41"><a href="#cb852-41"></a>                <span class="dt">data =</span> df_sims, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">width =</span> <span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb852-42"><a href="#cb852-42"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> val, <span class="dt">y =</span> med), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">1.3</span>, <span class="dt">data =</span> df_sims)<span class="op">+</span></span>
<span id="cb852-43"><a href="#cb852-43"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="dv">7</span>), <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">7</span>))<span class="op">+</span></span>
<span id="cb852-44"><a href="#cb852-44"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">12</span>)<span class="op">+</span></span>
<span id="cb852-45"><a href="#cb852-45"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb852-46"><a href="#cb852-46"></a>       <span class="dt">x =</span> <span class="st">&quot;nombre d&#39;accidents&quot;</span>,</span>
<span id="cb852-47"><a href="#cb852-47"></a>       <span class="dt">y =</span> <span class="st">&quot;nombre d&#39;occurrences&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/comppoissdistr-1.png" alt="Comparaison de la distribution originale et des simulations pour le modèle de quasi-Poisson" width="65%" />
<p class="caption">
(#fig:comppoissdistr)Comparaison de la distribution originale et des simulations pour le modèle de quasi-Poisson
</p>
</div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/comppoissdistr2-1.png" alt="Comparaison de la distribution originale et des simulations pour le modèle de Poisson" width="65%" />
<p class="caption">
(#fig:comppoissdistr2)Comparaison de la distribution originale et des simulations pour le modèle de Poisson
</p>
</div>
<p>La prochaine étape du diagnostic est l’analyse des résidus simulés. La figure @ref(fig:simrespoiss) indique que les résidus du modèle suivent bien une distribution uniforme et qu’aucune valeur aberrante n’est observable.</p>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb853-1"><a href="#cb853-1"></a><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span id="cb853-2"><a href="#cb853-2"></a>disp &lt;-<span class="st"> </span><span class="fl">1.918757</span> <span class="co"># trouvable dans le summary(modele2)</span></span>
<span id="cb853-3"><a href="#cb853-3"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb853-4"><a href="#cb853-4"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(preds),<span class="cf">function</span>(i){</span>
<span id="cb853-5"><a href="#cb853-5"></a>  lambda &lt;-<span class="st"> </span>preds[[i]]</span>
<span id="cb853-6"><a href="#cb853-6"></a>  sims &lt;-<span class="st"> </span><span class="kw">rqpois</span>(<span class="dt">n =</span> nsim, <span class="dt">lambda =</span> lambda, <span class="dt">disp =</span> disp)</span>
<span id="cb853-7"><a href="#cb853-7"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb853-8"><a href="#cb853-8"></a>})</span>
<span id="cb853-9"><a href="#cb853-9"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb853-10"><a href="#cb853-10"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> mat_sims, </span>
<span id="cb853-11"><a href="#cb853-11"></a>                            <span class="dt">observedResponse =</span> data2<span class="op">$</span>Nbr_acci,</span>
<span id="cb853-12"><a href="#cb853-12"></a>                            <span class="dt">fittedPredictedResponse =</span> modele2<span class="op">$</span>fitted.values,</span>
<span id="cb853-13"><a href="#cb853-13"></a>                            <span class="dt">integerResponse =</span> T)</span>
<span id="cb853-14"><a href="#cb853-14"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/simrespoiss-1.png" alt="Analyse globale des résidus simulés pour le modèle de quasi-Poisson" width="95%" />
<p class="caption">
(#fig:simrespoiss)Analyse globale des résidus simulés pour le modèle de quasi-Poisson
</p>
</div>
<p>Pour affiner notre diagnostic, nous pouvons également comparer les résidus simulés et chaque variable indépendante. La figure @ref(fig:simrespoiss2) n’indique aucune relation problématique entre nos variables indépendantes et les résidus.</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb854-1"><a href="#cb854-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb854-2"><a href="#cb854-2"></a>vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Feux_auto&quot;</span>, <span class="st">&quot;Feux_piet&quot;</span>, <span class="st">&quot;Pass_piet&quot;</span>, <span class="st">&quot;Terreplein&quot;</span>, <span class="st">&quot;Apaisement&quot;</span>,</span>
<span id="cb854-3"><a href="#cb854-3"></a>                <span class="st">&quot;LogEmploi&quot;</span>, <span class="st">&quot;Densite_pop&quot;</span>, <span class="st">&quot;Entropie&quot;</span>, <span class="st">&quot;DensiteInter&quot;</span>,</span>
<span id="cb854-4"><a href="#cb854-4"></a>                <span class="st">&quot;Long_arterePS&quot;</span>, <span class="st">&quot;Artere&quot;</span>, <span class="st">&quot;NB_voies5&quot;</span>)</span>
<span id="cb854-5"><a href="#cb854-5"></a><span class="cf">for</span>(v <span class="cf">in</span>  vars){</span>
<span id="cb854-6"><a href="#cb854-6"></a>  <span class="kw">plotResiduals</span>(sim_res, data2[[v]], <span class="dt">xlab =</span> v, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;résidus&quot;</span>)</span>
<span id="cb854-7"><a href="#cb854-7"></a>}</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/glm/simrespoiss2.png" alt="Comparaison des résidus simulés et de chaque variable indépendante" width="100%" />
<p class="caption">
(#fig:simrespoiss2)Comparaison des résidus simulés et de chaque variable indépendante
</p>
</div>
<p>Maintenant que l’ensemble des diagnostics a été effectué, nous pouvons passer à la vérification de la qualité d’ajustement.</p>
<p><strong>Vérifier la qualité d’ajustement</strong></p>
<p>Pour le calcul des pseudo-R<sup>2</sup>, notez qu’il n’existe pas à proprement parler de <em>loglikelihood</em> pour les quasi-distributions. Pour contourner ce problème, il est possible d’utiliser le <em>loglikelihood</em> d’un simple modèle de Poisson (puisque les coefficients ne changent pas), mais il est important de garder à l’esprit que ces pseudo-R<sup>2</sup> seront d’autant plus faibles que la sur-dispersion originale était forte.</p>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb855-1"><a href="#cb855-1"></a>modelnull &lt;-<span class="st"> </span><span class="kw">glm</span>(Nbr_acci <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb855-2"><a href="#cb855-2"></a>              <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link=</span><span class="st">&quot;log&quot;</span>),</span>
<span id="cb855-3"><a href="#cb855-3"></a>              <span class="dt">data =</span> data2)</span>
<span id="cb855-4"><a href="#cb855-4"></a><span class="kw">rsqs</span>(<span class="dt">loglike.full =</span> <span class="kw">logLik</span>(modele),</span>
<span id="cb855-5"><a href="#cb855-5"></a>     <span class="dt">loglike.null =</span> <span class="kw">logLik</span>(modelnull),</span>
<span id="cb855-6"><a href="#cb855-6"></a>     <span class="dt">full.deviance =</span> <span class="kw">deviance</span>(modele),</span>
<span id="cb855-7"><a href="#cb855-7"></a>     <span class="dt">null.deviance =</span> <span class="kw">deviance</span>(modelnull),</span>
<span id="cb855-8"><a href="#cb855-8"></a>     <span class="dt">nb.params =</span> modele<span class="op">$</span>rank,</span>
<span id="cb855-9"><a href="#cb855-9"></a>     <span class="dt">n =</span> <span class="kw">nrow</span>(data2))</span></code></pre></div>
<pre><code>## $`deviance expliquee`
## [1] 0.4805998
## 
## $`McFadden ajuste`
## &#39;log Lik.&#39; 0.3258375 (df=13)
## 
## $`Cox and Snell`
## &#39;log Lik.&#39; 0.7789704 (df=13)
## 
## $Nagelkerke
## &#39;log Lik.&#39; 0.787958 (df=13)</code></pre>
<p>Le modèle parvient ainsi à expliquer 48 % de la déviance totale, il obtient un R<sup>2</sup> ajusté de McFadden de 0,33 et un R<sup>2</sup> de Cox et Snell de 0,78.</p>
<div class="sourceCode" id="cb857"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb857-1"><a href="#cb857-1"></a><span class="co"># Calcul du RMSE</span></span>
<span id="cb857-2"><a href="#cb857-2"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>((<span class="kw">predict</span>(modele2, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>) <span class="op">-</span><span class="st"> </span>data2<span class="op">$</span>Nbr_acci)<span class="op">**</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 1.838026</code></pre>
<div class="sourceCode" id="cb859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb859-1"><a href="#cb859-1"></a><span class="co"># Nombre moyen d&#39;accidents</span></span>
<span id="cb859-2"><a href="#cb859-2"></a><span class="kw">mean</span>(data2<span class="op">$</span>Nbr_acci)</span></code></pre></div>
<pre><code>## [1] 1.503984</code></pre>
<p>L’erreur quadratique moyenne du modèle est de 1,84, ce que signifie qu’en moyenne le modèle se trompe d’environ deux accidents pour chaque intersection. Cette valeur est relativement élevée si nous la comparons avec le nombre moyen d’accidents, soit 1,5. Ceci s’explique certainement par le grand nombre de zéros dans la variable <em>Y</em> qui tendent à tirer les prédictions vers le bas.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>L’ensemble des coefficients du modèle sont accessibles via la fonction <code>summary</code>. Puisque la fonction de lien du modèle est la fonction <code>log</code>, il est pertinent de convertir les coefficients avec la fonction <code>exp</code> afin de pouvoir les interpréter sur l’échelle originale (<code>nombre d'accidents</code>) plutôt que l’échelle logarithmique (<code>log(nombre d'accidents)</code>). N’oubliez pas que ces effets sont multiplicatifs une fois transformés avec la fonction <code>exp</code>. Nous pouvons également utiliser les erreurs standards pour calculer des intervalles de confiance à 95 % des exponentiels des coefficients. Le tableau @ref(tab:coeffpoiss) présente l’ensemble des informations pertinentes pour l’interprétation des résultats.</p>
<div class="sourceCode" id="cb861"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb861-1"><a href="#cb861-1"></a><span class="co"># Calcul des coefficients en exponentiel et des intervalles de confiance</span></span>
<span id="cb861-2"><a href="#cb861-2"></a>tableau &lt;-<span class="st"> </span><span class="kw">summary</span>(modele2)<span class="op">$</span>coefficients</span>
<span id="cb861-3"><a href="#cb861-3"></a>coeffs &lt;-<span class="st"> </span>tableau[,<span class="dv">1</span>]</span>
<span id="cb861-4"><a href="#cb861-4"></a>err.std &lt;-<span class="st"> </span>tableau[,<span class="dv">2</span>]</span>
<span id="cb861-5"><a href="#cb861-5"></a>expcoeff &lt;-<span class="st"> </span><span class="kw">exp</span>(coeffs)</span>
<span id="cb861-6"><a href="#cb861-6"></a>exp2<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">exp</span>(coeffs <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>err.std)</span>
<span id="cb861-7"><a href="#cb861-7"></a>exp975 &lt;-<span class="st"> </span><span class="kw">exp</span>(coeffs <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>err.std)</span>
<span id="cb861-8"><a href="#cb861-8"></a>pvals &lt;-<span class="st"> </span>tableau[,<span class="dv">4</span>]</span>
<span id="cb861-9"><a href="#cb861-9"></a>tableauComplet &lt;-<span class="st"> </span><span class="kw">cbind</span>(coeffs,err.std,expcoeff,exp2<span class="fl">.5</span>,exp975,pvals)</span>
<span id="cb861-10"><a href="#cb861-10"></a><span class="co"># print(tableauComplet)</span></span></code></pre></div>
<table>
<caption>
(#tab:coeffpoiss)Résultats du modèle de quasi-Poisson
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coeff.
</th>
<th style="text-align:right;">
exp(Coeff.)
</th>
<th style="text-align:right;">
Val.p
</th>
<th style="text-align:right;">
IC 2,5 % exp(Coeff.)
</th>
<th style="text-align:right;">
IC 97,5 % exp(Coeff.)
</th>
<th style="text-align:right;">
Sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
-3,680
</td>
<td style="text-align:right;">
0,030
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
0,090
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Feux_auto
</td>
<td style="text-align:right;">
1,100
</td>
<td style="text-align:right;">
3,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,970
</td>
<td style="text-align:right;">
4,660
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Feux_piet
</td>
<td style="text-align:right;">
0,330
</td>
<td style="text-align:right;">
1,390
</td>
<td style="text-align:right;">
0,009
</td>
<td style="text-align:right;">
1,090
</td>
<td style="text-align:right;">
1,790
</td>
<td style="text-align:right;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
Pass_piet
</td>
<td style="text-align:right;">
0,340
</td>
<td style="text-align:right;">
1,400
</td>
<td style="text-align:right;">
0,149
</td>
<td style="text-align:right;">
0,880
</td>
<td style="text-align:right;">
2,200
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Terreplein
</td>
<td style="text-align:right;">
-0,360
</td>
<td style="text-align:right;">
0,700
</td>
<td style="text-align:right;">
0,099
</td>
<td style="text-align:right;">
0,440
</td>
<td style="text-align:right;">
1,050
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
Apaisement
</td>
<td style="text-align:right;">
0,290
</td>
<td style="text-align:right;">
1,330
</td>
<td style="text-align:right;">
0,157
</td>
<td style="text-align:right;">
0,880
</td>
<td style="text-align:right;">
1,950
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
LogEmploi
</td>
<td style="text-align:right;">
0,230
</td>
<td style="text-align:right;">
1,260
</td>
<td style="text-align:right;">
0,017
</td>
<td style="text-align:right;">
1,040
</td>
<td style="text-align:right;">
1,520
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Densite_pop
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Entropie
</td>
<td style="text-align:right;">
-0,420
</td>
<td style="text-align:right;">
0,660
</td>
<td style="text-align:right;">
0,271
</td>
<td style="text-align:right;">
0,320
</td>
<td style="text-align:right;">
1,390
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
DensiteInter
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
0,410
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
1,010
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Long_arterePS
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
0,684
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Artere
</td>
<td style="text-align:right;">
0,030
</td>
<td style="text-align:right;">
1,030
</td>
<td style="text-align:right;">
0,842
</td>
<td style="text-align:right;">
0,780
</td>
<td style="text-align:right;">
1,360
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
NB_voies5
</td>
<td style="text-align:right;">
0,640
</td>
<td style="text-align:right;">
1,890
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,460
</td>
<td style="text-align:right;">
2,440
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table></li>
</ul>
<p>Parmi les variables décrivant les aménagements de l’intersection, nous constatons que les présences d’un feu de circulation et d’un feu de traversée pour les piétons multiplient le nombre attendu d’accidents à une intersection par 3,0 et 1,39. Par contre, les présences d’un passage piéton, d’un terre-plein ou de mesures d’apaisement n’ont pas d’effets significatifs (valeurs de <em>p</em> &gt; 0,05).
Concernant les variables décrivant l’environnement à proximité des intersections, nous observons que la concentration d’emplois et la densité de population contribuent toutes les deux à augmenter le nombre d’accidents à une intersection, bien que leurs effets soient limités. Enfin, la présence d’une rue à cinq voies à l’intersection augmente le nombre d’accidents attendu à l’intersection de 89 %. Nous ne détaillons pas plus les résultats, car nous utilisons le même jeu de données dans les prochaines sections.</p>
</div>
</div>
<div id="sect0842" class="section level3">
<h3><span class="header-section-number">8.3.2</span> Modèle binomial négatif</h3>
<p>Dans le cas où une variable de comptage serait marquée par une sur ou sous-dispersion, la distribution de Poisson n’est pas en mesure de capturer efficacement sa variance. Pour contourner ce problème, il est possible d’utiliser la distribution binomiale négative plutôt que la distribution de Poisson (ou quasi-Poisson). Cette distribution peut être décrite comme une généralisation de la distribution de Poisson : elle inclut un second paramètre <span class="math inline">\(\theta\)</span> contrôlant la dispersion. L’intérêt premier de ce changement de distribution est que l’interprétation des paramètres est la même pour les deux modèles, tout en contrôlant directement l’effet d’une potentielle sur ou sous-dispersion.</p>
<table>
<caption>
(#tab:nbdentity)Carte d’identité du modèle binomial négatif
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable de comptage
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Négative binomiale
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim NB(\mu,\theta)\)</span> <br/> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <br/> <span class="math inline">\(g(x) =log(x)\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
log
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
<span class="math inline">\(\mu\)</span>
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span> et <span class="math inline">\(\theta\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
Absence d’excès de zéros, respect du lien variance-moyenne
</td>
</tr>
</tbody>
</table>
<div id="conditions-dapplication-3" class="section level4">
<h4><span class="header-section-number">8.3.2.1</span> Conditions d’application</h4>
<p>Les conditions d’application d’un modèle binomial négatif sont presque les mêmes que celles d’un modèle de Poisson. La seule différence est que la condition d’absence de sur ou sous-dispersion est remplacée par une condition de respect du lien espérance-variance. En effet, dans un modèle binomial négatif, le paramètre de dispersion <span class="math inline">\(\theta\)</span> est combiné avec <span class="math inline">\(\mu\)</span> (l’espérance) pour exprimer la dispersion de la distribution. Dans le <em>package</em> <code>mgcv</code> que nous utilisons dans l’exemple, le lien entre <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\theta\)</span> et la variance est le suivant :</p>

<p><span class="math display">\[\begin{equation}
variance = \mu + \mu^{\frac{2}{\theta}}
(\#eq:glm17)
\end{equation}\]</span>
</p>
<p>Il s’agit donc d’un <strong>modèle hétéroscédastique</strong>, sa variance n’est pas fixe, mais varie en fonction de sa propre espérance. Si celle-ci augmente, la variance augmente (comme pour un modèle de Poisson), et l’intensité de cette augmentation est contrôlée par le paramètre <span class="math inline">\(\theta\)</span>. Si cette condition n’est pas respectée, l’analyse des résidus simulés révélera un problème de dispersion.</p>
</div>
<div id="exemple-appliqué-dans-r-3" class="section level4">
<h4><span class="header-section-number">8.3.2.2</span> Exemple appliqué dans R</h4>
<p>Dans l’exemple précédent avec le modèle de Poisson, nous avions observé une certaine sur-dispersion que nous avions contournée en utilisant un modèle de quasi-Poisson. Dans l’article original, les auteurs avaient opté pour un modèle binomial négatif, ce que nous reproduisons ici. Les variables utilisées sont les mêmes que pour le modèle de Poisson. Nous utilisons le <em>package</em> <code>mgcv</code> et sa fonction <code>gam</code> pour ajuster le modèle.</p>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Nous avions vu précédemment que nos variables indépendantes n’étaient pas marquées par une multicolinéarité forte. Il n’est pas nécessaire de recalculer les valeurs de VIF puisque nous utilisons les mêmes données. La première étape du diagnostic est donc de calculer les distances de Cook.</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="#cb862-1"></a><span class="kw">library</span>(mgcv)</span>
<span id="cb862-2"><a href="#cb862-2"></a><span class="co"># Chargement des données</span></span>
<span id="cb862-3"><a href="#cb862-3"></a>data_accidents &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/glm/accident_pietons.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>)</span>
<span id="cb862-4"><a href="#cb862-4"></a><span class="co"># Ajustement d&#39;une première version du modèle</span></span>
<span id="cb862-5"><a href="#cb862-5"></a>modelnb &lt;-<span class="st"> </span><span class="kw">gam</span>(Nbr_acci <span class="op">~</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Pass_piet <span class="op">+</span><span class="st"> </span></span>
<span id="cb862-6"><a href="#cb862-6"></a><span class="st">                 </span>Terreplein <span class="op">+</span><span class="st"> </span>Apaisement <span class="op">+</span></span>
<span id="cb862-7"><a href="#cb862-7"></a><span class="st">                </span>LogEmploi <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span>Entropie <span class="op">+</span><span class="st"> </span>DensiteInter <span class="op">+</span></span>
<span id="cb862-8"><a href="#cb862-8"></a><span class="st">                </span>Long_arterePS <span class="op">+</span><span class="st"> </span>Artere <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb862-9"><a href="#cb862-9"></a>              <span class="dt">family =</span> <span class="kw">nb</span>(<span class="dt">link=</span><span class="st">&quot;log&quot;</span>),</span>
<span id="cb862-10"><a href="#cb862-10"></a>              <span class="dt">data =</span> data_accidents)</span>
<span id="cb862-11"><a href="#cb862-11"></a><span class="co"># Calcul et affichage des distances de Cook</span></span>
<span id="cb862-12"><a href="#cb862-12"></a>cooksd &lt;-<span class="st"> </span><span class="kw">cooks.distance</span>(modelnb)</span>
<span id="cb862-13"><a href="#cb862-13"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb862-14"><a href="#cb862-14"></a>  <span class="dt">cook =</span> cooksd,</span>
<span id="cb862-15"><a href="#cb862-15"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cooksd)</span>
<span id="cb862-16"><a href="#cb862-16"></a>)</span>
<span id="cb862-17"><a href="#cb862-17"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb862-18"><a href="#cb862-18"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cook), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>)) <span class="op">+</span></span>
<span id="cb862-19"><a href="#cb862-19"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;distance de Cook&quot;</span>)<span class="op">+</span></span>
<span id="cb862-20"><a href="#cb862-20"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb862-21"><a href="#cb862-21"></a>        <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cookdistnb-1.png" alt="Distances de Cook pour le modèle binomial négatif" width="75%" />
<p class="caption">
(#fig:cookdistnb)Distances de Cook pour le modèle binomial négatif
</p>
</div>
<p>Nous observons dans la figure @ref(fig:cookdistnb) que quatre observations se distinguent très nettement des autres.</p>
<div class="sourceCode" id="cb863"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb863-1"><a href="#cb863-1"></a>cas_etrange &lt;-<span class="st"> </span><span class="kw">subset</span>(data_accidents, cooksd <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.03</span>)</span>
<span id="cb863-2"><a href="#cb863-2"></a><span class="kw">print</span>(cas_etrange)</span></code></pre></div>
<pre><code>##    Nbr_acci Feux_auto Feux_piet Pass_piet Terreplein Apaisement EmpTotBuffer
## 1        19         1         1         1          1          0     7208.538
## 5        12         1         0         1          0          0     8585.350
## 26        7         0         0         1          0          0     1342.625
## 34        6         0         0         1          0          0    12516.410
##    Densite_pop  Entropie DensiteInter Long_arterePS Artere NB_voies5 log_acci
## 1     5980.923 0.8073926     42.41597       6955.00      1         1 2.995732
## 5     8655.430 0.7607852     89.11495       6412.27      0         0 2.564949
## 26    2751.012 0.0000000     73.35344       2849.66      0         0 2.079442
## 34    8950.942 0.4300549     74.91879       8443.01      1         0 1.945910
##    catego_acci catego_acci2 Arret VAG sum_app LogEmploi AccOrdinal    PopHa
## 1            1            1     0   1       4  8.883021          2 5.980923
## 5            1            1     0   1       4  9.057813          2 8.655430
## 26           1            1     1   1       3  7.202382          2 2.751012
## 34           1            1     1   0       3  9.434796          2 8.950942</code></pre>
<p>Il s’agit à nouveau de quatre observations avec un grand nombre d’accidents. Nous décidons de les retirer du jeu de données pour ne pas fausser les résultats concernant l’ensemble des autres intersections. Dans une analyse plus détaillée, il serait judicieux de chercher à comprendre pourquoi ces quatre observations sont particulièrement accidentogènes.</p>
<div class="sourceCode" id="cb865"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb865-1"><a href="#cb865-1"></a>data2 &lt;-<span class="st"> </span><span class="kw">subset</span>(data_accidents, cooksd <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.03</span>)</span>
<span id="cb865-2"><a href="#cb865-2"></a><span class="co"># Ajustement d&#39;une première version du modèle</span></span>
<span id="cb865-3"><a href="#cb865-3"></a>modelnb &lt;-<span class="st"> </span><span class="kw">gam</span>(Nbr_acci <span class="op">~</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Pass_piet <span class="op">+</span><span class="st"> </span></span>
<span id="cb865-4"><a href="#cb865-4"></a><span class="st">                 </span>Terreplein <span class="op">+</span><span class="st"> </span>Apaisement <span class="op">+</span></span>
<span id="cb865-5"><a href="#cb865-5"></a><span class="st">                </span>LogEmploi <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span>Entropie <span class="op">+</span><span class="st"> </span>DensiteInter <span class="op">+</span></span>
<span id="cb865-6"><a href="#cb865-6"></a><span class="st">                </span>Long_arterePS <span class="op">+</span><span class="st"> </span>Artere <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb865-7"><a href="#cb865-7"></a>              <span class="dt">family =</span> <span class="kw">nb</span>(<span class="dt">link=</span><span class="st">&quot;log&quot;</span>),</span>
<span id="cb865-8"><a href="#cb865-8"></a>              <span class="dt">data =</span> data2)</span>
<span id="cb865-9"><a href="#cb865-9"></a><span class="co"># Calcul et affichage des distances de Cook</span></span>
<span id="cb865-10"><a href="#cb865-10"></a>cooksd &lt;-<span class="st"> </span><span class="kw">cooks.distance</span>(modelnb)</span>
<span id="cb865-11"><a href="#cb865-11"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb865-12"><a href="#cb865-12"></a>  <span class="dt">cook =</span> cooksd,</span>
<span id="cb865-13"><a href="#cb865-13"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cooksd)</span>
<span id="cb865-14"><a href="#cb865-14"></a>)</span>
<span id="cb865-15"><a href="#cb865-15"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb865-16"><a href="#cb865-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cook), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>)) <span class="op">+</span></span>
<span id="cb865-17"><a href="#cb865-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;distance de Cook&quot;</span>)<span class="op">+</span></span>
<span id="cb865-18"><a href="#cb865-18"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb865-19"><a href="#cb865-19"></a>        <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cookdistnb2-1.png" alt="Distances de Cook pour le modèle binomial négatif (après avoir retiré quatre observations fortement influentes)" width="75%" />
<p class="caption">
(#fig:cookdistnb2)Distances de Cook pour le modèle binomial négatif (après avoir retiré quatre observations fortement influentes)
</p>
</div>
<p>Après avoir retiré ces quatre observations, les distances de Cook (figure @ref(fig:cookdistnb2)) ne révèlent plus d’observations fortement influentes dans le modèle. La prochaine étape du diagnostic est donc d’analyser les résidus simulés.</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="#cb866-1"></a><span class="co"># Extraction de la valeur de theta</span></span>
<span id="cb866-2"><a href="#cb866-2"></a>theta &lt;-<span class="st"> </span>modelnb<span class="op">$</span>family<span class="op">$</span><span class="kw">getTheta</span>(T)</span>
<span id="cb866-3"><a href="#cb866-3"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb866-4"><a href="#cb866-4"></a><span class="co"># Extraction des valeurs prédites par le modèle</span></span>
<span id="cb866-5"><a href="#cb866-5"></a>mus &lt;-<span class="st"> </span><span class="kw">predict</span>(modelnb, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb866-6"><a href="#cb866-6"></a><span class="co"># Calcul des simulations</span></span>
<span id="cb866-7"><a href="#cb866-7"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(mus),<span class="cf">function</span>(i){</span>
<span id="cb866-8"><a href="#cb866-8"></a>  mu &lt;-<span class="st"> </span>mus[[i]]</span>
<span id="cb866-9"><a href="#cb866-9"></a>  sims &lt;-<span class="st"> </span><span class="kw">rnbinom</span>(<span class="dt">n =</span> nsim, <span class="dt">mu =</span> mu, <span class="dt">size =</span> theta)</span>
<span id="cb866-10"><a href="#cb866-10"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb866-11"><a href="#cb866-11"></a>})</span>
<span id="cb866-12"><a href="#cb866-12"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb866-13"><a href="#cb866-13"></a><span class="co"># Calcul des résidus simulés</span></span>
<span id="cb866-14"><a href="#cb866-14"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> mat_sims, </span>
<span id="cb866-15"><a href="#cb866-15"></a>                            <span class="dt">observedResponse =</span> data2<span class="op">$</span>Nbr_acci,</span>
<span id="cb866-16"><a href="#cb866-16"></a>                            <span class="dt">fittedPredictedResponse =</span> mus,</span>
<span id="cb866-17"><a href="#cb866-17"></a>                            <span class="dt">integerResponse =</span> T)</span>
<span id="cb866-18"><a href="#cb866-18"></a><span class="co"># Affichage du diagnostic</span></span>
<span id="cb866-19"><a href="#cb866-19"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/diagresnb-1.png" alt="Diagnostic général des résidus simulés pour le modèle binomial négatif" width="95%" />
<p class="caption">
(#fig:diagresnb)Diagnostic général des résidus simulés pour le modèle binomial négatif
</p>
</div>
<p>La figure @ref(fig:diagresnb), présentant le diagnostic des résidus simulés, montre que ces derniers suivent bien une distribution uniforme, aucun problème de dispersion ni de valeurs aberrantes. La figure @ref(fig:compnbdistr2) permet de comparer la distribution originale de la variable <em>Y</em> et les simulations issues du modèle (intervalles de confiance représentés en bleu). Nous constatons que le modèle parvient bien à reproduire la distribution originale, et ce, même pour les valeurs les plus extrèmes de la distribution.</p>
<div class="sourceCode" id="cb867"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb867-1"><a href="#cb867-1"></a><span class="co"># Extraction des valeurs prédites par le modèle</span></span>
<span id="cb867-2"><a href="#cb867-2"></a>mus &lt;-<span class="st"> </span><span class="kw">predict</span>(modelnb, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb867-3"><a href="#cb867-3"></a><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span id="cb867-4"><a href="#cb867-4"></a>theta &lt;-<span class="st"> </span>modelnb<span class="op">$</span>family<span class="op">$</span><span class="kw">getTheta</span>(T)</span>
<span id="cb867-5"><a href="#cb867-5"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb867-6"><a href="#cb867-6"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(mus),<span class="cf">function</span>(i){</span>
<span id="cb867-7"><a href="#cb867-7"></a>  mu &lt;-<span class="st"> </span>mus[[i]]</span>
<span id="cb867-8"><a href="#cb867-8"></a>  sims &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rnbinom</span>(<span class="dt">n =</span> nsim, <span class="dt">mu =</span> mu, <span class="dt">size =</span> theta))</span>
<span id="cb867-9"><a href="#cb867-9"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb867-10"><a href="#cb867-10"></a>})</span>
<span id="cb867-11"><a href="#cb867-11"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb867-12"><a href="#cb867-12"></a><span class="co"># Préparation des données pour le graphique (valeurs réelles)</span></span>
<span id="cb867-13"><a href="#cb867-13"></a>counts &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">table</span>(data2<span class="op">$</span>Nbr_acci))</span>
<span id="cb867-14"><a href="#cb867-14"></a><span class="kw">names</span>(counts) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;nb_accident&quot;</span>,<span class="st">&#39;frequence&#39;</span>)</span>
<span id="cb867-15"><a href="#cb867-15"></a>counts<span class="op">$</span>nb_accident &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(counts<span class="op">$</span>nb_accident))</span>
<span id="cb867-16"><a href="#cb867-16"></a>counts<span class="op">$</span>prop &lt;-<span class="st"> </span>counts<span class="op">$</span>frequence <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(counts<span class="op">$</span>frequence)</span>
<span id="cb867-17"><a href="#cb867-17"></a><span class="co"># Préparation des données pour le graphique (valeurs simulées)</span></span>
<span id="cb867-18"><a href="#cb867-18"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">count =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">25</span>)</span>
<span id="cb867-19"><a href="#cb867-19"></a>count_sims &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span>nsim, <span class="cf">function</span>(i){</span>
<span id="cb867-20"><a href="#cb867-20"></a>  sim &lt;-<span class="st"> </span>mat_sims[,i]</span>
<span id="cb867-21"><a href="#cb867-21"></a>  cnt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">table</span>(sim))</span>
<span id="cb867-22"><a href="#cb867-22"></a>  df2 &lt;-<span class="st"> </span><span class="kw">merge</span>(df1,cnt, <span class="dt">by.x=</span><span class="st">&quot;count&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;sim&quot;</span>, <span class="dt">all.x =</span> T, <span class="dt">all.y=</span>F)</span>
<span id="cb867-23"><a href="#cb867-23"></a>  df2<span class="op">$</span>Freq &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(df2<span class="op">$</span>Freq),<span class="dv">0</span>,df2<span class="op">$</span>Freq)</span>
<span id="cb867-24"><a href="#cb867-24"></a>  <span class="kw">return</span>(df2<span class="op">$</span>Freq)</span>
<span id="cb867-25"><a href="#cb867-25"></a>})</span>
<span id="cb867-26"><a href="#cb867-26"></a>count_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(cbind,count_sims)</span>
<span id="cb867-27"><a href="#cb867-27"></a>df_sims &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb867-28"><a href="#cb867-28"></a>  <span class="dt">val =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">25</span>,</span>
<span id="cb867-29"><a href="#cb867-29"></a>  <span class="dt">med =</span> <span class="kw">apply</span>(count_sims, <span class="dt">MARGIN =</span> <span class="dv">1</span>, median),</span>
<span id="cb867-30"><a href="#cb867-30"></a>  <span class="dt">lower =</span> <span class="kw">apply</span>(count_sims, <span class="dt">MARGIN =</span> <span class="dv">1</span>, quantile, <span class="dt">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb867-31"><a href="#cb867-31"></a>  <span class="dt">upper =</span> <span class="kw">apply</span>(count_sims, <span class="dt">MARGIN =</span> <span class="dv">1</span>, quantile, <span class="dt">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb867-32"><a href="#cb867-32"></a>)</span>
<span id="cb867-33"><a href="#cb867-33"></a><span class="co"># Affichage du graphique</span></span>
<span id="cb867-34"><a href="#cb867-34"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb867-35"><a href="#cb867-35"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>nb_accident, <span class="dt">weight =</span> frequence), <span class="dt">width =</span> <span class="fl">0.6</span>, <span class="dt">data =</span> counts)<span class="op">+</span></span>
<span id="cb867-36"><a href="#cb867-36"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> val, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper),</span>
<span id="cb867-37"><a href="#cb867-37"></a>                <span class="dt">data =</span> df_sims, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">width =</span> <span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb867-38"><a href="#cb867-38"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> val, <span class="dt">y =</span> med), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">1.3</span>, <span class="dt">data =</span> df_sims)<span class="op">+</span></span>
<span id="cb867-39"><a href="#cb867-39"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="dv">7</span>), <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">7</span>))<span class="op">+</span></span>
<span id="cb867-40"><a href="#cb867-40"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">12</span>)<span class="op">+</span></span>
<span id="cb867-41"><a href="#cb867-41"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb867-42"><a href="#cb867-42"></a>       <span class="dt">x =</span> <span class="st">&quot;nombre d&#39;accidents&quot;</span>,</span>
<span id="cb867-43"><a href="#cb867-43"></a>       <span class="dt">y =</span> <span class="st">&quot;nombre d&#39;occurrences&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/compnbdistr2-1.png" alt="Comparaison de la distribution originale et des simulations pour le modèle binomial négatif" width="65%" />
<p class="caption">
(#fig:compnbdistr2)Comparaison de la distribution originale et des simulations pour le modèle binomial négatif
</p>
</div>
<p>À titre de comparaison, nous pouvons à nouveau réaliser le graphique permettant de visualiser si la variance attendue par le modèle est proche de celle effectivement observée dans les données. Nous avions constaté avec ce graphique, lorsque nous ajustions un modèle de Poisson, que la variance des données était trop grande comparativement à celle attendue par le modèle (figure @ref(fig:surdisppoiss)).</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb868-1"><a href="#cb868-1"></a><span class="co"># Extraction des prédictions du modèle</span></span>
<span id="cb868-2"><a href="#cb868-2"></a>mus &lt;-<span class="st"> </span><span class="kw">predict</span>(modelnb, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb868-3"><a href="#cb868-3"></a><span class="co"># Création d&#39;un DataFrame pour contenir la prédiction et les vraies valeurs</span></span>
<span id="cb868-4"><a href="#cb868-4"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb868-5"><a href="#cb868-5"></a>  <span class="dt">mus =</span> mus,</span>
<span id="cb868-6"><a href="#cb868-6"></a>  <span class="dt">reals =</span> data2<span class="op">$</span>Nbr_acci</span>
<span id="cb868-7"><a href="#cb868-7"></a>)</span>
<span id="cb868-8"><a href="#cb868-8"></a><span class="co"># Calcul de l&#39;intervalle de confiance à 95 % selon la distribution de Poisson</span></span>
<span id="cb868-9"><a href="#cb868-9"></a><span class="co"># et stockage dans un second DataFrame</span></span>
<span id="cb868-10"><a href="#cb868-10"></a>seqa &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="kw">round</span>(<span class="kw">max</span>(mus)),<span class="dv">1</span>)</span>
<span id="cb868-11"><a href="#cb868-11"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb868-12"><a href="#cb868-12"></a>  <span class="dt">mus =</span> seqa,</span>
<span id="cb868-13"><a href="#cb868-13"></a>  <span class="dt">lower =</span> <span class="kw">qnbinom</span>(<span class="dt">p =</span> <span class="fl">0.025</span>, <span class="dt">mu =</span> seqa, <span class="dt">size =</span> theta),</span>
<span id="cb868-14"><a href="#cb868-14"></a>  <span class="dt">upper =</span> <span class="kw">qnbinom</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">mu =</span> seqa, <span class="dt">size =</span> theta)</span>
<span id="cb868-15"><a href="#cb868-15"></a>)</span>
<span id="cb868-16"><a href="#cb868-16"></a><span class="co"># Affichage des valeurs réelles et prédites (en rouge)</span></span>
<span id="cb868-17"><a href="#cb868-17"></a><span class="co"># et de leur variance selon le modèle (en noir)</span></span>
<span id="cb868-18"><a href="#cb868-18"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb868-19"><a href="#cb868-19"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="dt">data =</span> df2,</span>
<span id="cb868-20"><a href="#cb868-20"></a>                <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> mus, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper),</span>
<span id="cb868-21"><a href="#cb868-21"></a>                <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb868-22"><a href="#cb868-22"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df1, </span>
<span id="cb868-23"><a href="#cb868-23"></a>             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> mus, <span class="dt">y =</span> reals),</span>
<span id="cb868-24"><a href="#cb868-24"></a>             <span class="dt">color =</span><span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb868-25"><a href="#cb868-25"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;valeurs prédites&#39;</span>,</span>
<span id="cb868-26"><a href="#cb868-26"></a>       <span class="dt">y =</span> <span class="st">&quot;valeurs réelles&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/surdispnb-1.png" alt="Représentation de la sur-dispersion des données dans le modèle de Poisson" width="2100" />
<p class="caption">
(#fig:surdispnb)Représentation de la sur-dispersion des données dans le modèle de Poisson
</p>
</div>
<p>Nous pouvons ainsi constater à la figure @ref(fig:surdispnb) que le modèle binomial négatif autorise une variance bien plus large que le modèle de Poisson et est ainsi mieux ajusté aux données.</p>
<p><strong>Vérification de la qualité d’ajustement</strong></p>
<div class="sourceCode" id="cb869"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb869-1"><a href="#cb869-1"></a><span class="co"># Calcul des pseudo R2</span></span>
<span id="cb869-2"><a href="#cb869-2"></a><span class="kw">rsqs</span>(<span class="dt">loglike.full =</span> <span class="kw">logLik</span>(modelnb),</span>
<span id="cb869-3"><a href="#cb869-3"></a>     <span class="dt">loglike.null =</span> <span class="kw">logLik</span>(modelnull),</span>
<span id="cb869-4"><a href="#cb869-4"></a>     <span class="dt">full.deviance =</span> <span class="kw">deviance</span>(modelnb),</span>
<span id="cb869-5"><a href="#cb869-5"></a>     <span class="dt">null.deviance =</span> modelnb<span class="op">$</span>null.deviance,</span>
<span id="cb869-6"><a href="#cb869-6"></a>     <span class="dt">nb.params =</span> modelnb<span class="op">$</span>rank,</span>
<span id="cb869-7"><a href="#cb869-7"></a>     <span class="dt">n =</span> <span class="kw">nrow</span>(data2))</span></code></pre></div>
<pre><code>## $`deviance expliquee`
## [1] 0.458052
## 
## $`McFadden ajuste`
## &#39;log Lik.&#39; 0.384353 (df=14)
## 
## $`Cox and Snell`
## &#39;log Lik.&#39; 0.8304773 (df=14)
## 
## $Nagelkerke
## &#39;log Lik.&#39; 0.8399731 (df=14)</code></pre>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb871-1"><a href="#cb871-1"></a><span class="co"># Calcul du RMSE</span></span>
<span id="cb871-2"><a href="#cb871-2"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>((<span class="kw">predict</span>(modelnb, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>) <span class="op">-</span><span class="st"> </span>data2<span class="op">$</span>Nbr_acci)<span class="op">**</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 1.825278</code></pre>
<p>Le modèle parvient à expliquer 45 % de la déviance, il obtient un R<sup>2</sup> ajusté de McFadden de 0,14 et un R<sup>2</sup> de Nagelkerke de 0,42. L’erreur moyenne quadratique de la prédiction est de , ce qui est identique au modèle de Poisson ajusté précédemment.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>Il est possible d’accéder à l’ensemble des coefficients du modèle via la fonction <code>summary</code>. À nouveau, les coefficients doivent être convertis avec la fonction exponentielle (du fait de la fonction de lien log) et interprétés comme des effets multiplicatifs. Le tableau @ref(tab:coeffsnb) présente les coefficients estimés par le modèle. Les résultats sont très similaires à ceux du modèle de quasi-Poisson original. Nous notons cependant que la variable présence d’un feu pour piéton n’est plus significative au seuil de 0,05.</p>
<table>
<caption>
(#tab:coeffsnb)Résultats du modèle binomial négatif
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coeff.
</th>
<th style="text-align:right;">
exp(Coeff.)
</th>
<th style="text-align:right;">
Val.p
</th>
<th style="text-align:right;">
IC 2, 5% exp(Coeff.)
</th>
<th style="text-align:right;">
IC 97,5 % exp(Coeff.)
</th>
<th style="text-align:right;">
Sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
-3,880
</td>
<td style="text-align:right;">
0,020
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
0,080
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Feux_auto
</td>
<td style="text-align:right;">
1,130
</td>
<td style="text-align:right;">
3,100
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
2,030
</td>
<td style="text-align:right;">
4,710
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Feux_piet
</td>
<td style="text-align:right;">
0,350
</td>
<td style="text-align:right;">
1,420
</td>
<td style="text-align:right;">
0,016
</td>
<td style="text-align:right;">
1,060
</td>
<td style="text-align:right;">
1,900
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Pass_piet
</td>
<td style="text-align:right;">
0,220
</td>
<td style="text-align:right;">
1,240
</td>
<td style="text-align:right;">
0,300
</td>
<td style="text-align:right;">
0,830
</td>
<td style="text-align:right;">
1,880
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Terreplein
</td>
<td style="text-align:right;">
-0,340
</td>
<td style="text-align:right;">
0,710
</td>
<td style="text-align:right;">
0,155
</td>
<td style="text-align:right;">
0,440
</td>
<td style="text-align:right;">
1,140
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Apaisement
</td>
<td style="text-align:right;">
0,240
</td>
<td style="text-align:right;">
1,270
</td>
<td style="text-align:right;">
0,315
</td>
<td style="text-align:right;">
0,790
</td>
<td style="text-align:right;">
2,030
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
LogEmploi
</td>
<td style="text-align:right;">
0,230
</td>
<td style="text-align:right;">
1,260
</td>
<td style="text-align:right;">
0,025
</td>
<td style="text-align:right;">
1,030
</td>
<td style="text-align:right;">
1,550
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Densite_pop
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Entropie
</td>
<td style="text-align:right;">
-0,170
</td>
<td style="text-align:right;">
0,840
</td>
<td style="text-align:right;">
0,669
</td>
<td style="text-align:right;">
0,380
</td>
<td style="text-align:right;">
1,860
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
DensiteInter
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
0,925
</td>
<td style="text-align:right;">
0,990
</td>
<td style="text-align:right;">
1,010
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Long_arterePS
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
0,587
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Artere
</td>
<td style="text-align:right;">
0,110
</td>
<td style="text-align:right;">
1,110
</td>
<td style="text-align:right;">
0,497
</td>
<td style="text-align:right;">
0,820
</td>
<td style="text-align:right;">
1,510
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
NB_voies5
</td>
<td style="text-align:right;">
0,700
</td>
<td style="text-align:right;">
2,010
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,480
</td>
<td style="text-align:right;">
2,750
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul>
</div>
</div>
<div id="sect0843" class="section level3">
<h3><span class="header-section-number">8.3.3</span> Modèle de Poisson avec excès fixe de zéros</h3>
<p>Dans le cas où la variable <em>Y</em> comprendrait significativement plus de zéros que ce que suppose une distribution de Poisson, il est possible d’utiliser la distribution de Poisson avec excès de zéros. Pour rappel, cette distribution ajoute un paramètre <em>p</em> contrôlant pour la proportion de zéros dans la distribution. Du point de vue conceptuel, cela revient à formuler l’hypothèse suivante : dans les données que nous avons a observées, deux processus distincts sont à l’œuvre. Le premier est issu d’une distribution de Poisson et le second produit des zéros qui s’ajoutent aux données. Les zéros produits par la distribution de Poisson sont appelés les <strong>vrais zéros</strong>, alors que ceux produits par le second phénomène sont appelés les <strong>faux zéros</strong>.</p>
<table>
<caption>
(#tab:poisszidentity)Carte d’identité du modèle de Poisson avec excès fixe de zéros
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable de comptage
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Poisson avec excès de zéros
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim ZIP(\mu,\theta)\)</span> <br/> <span class="math inline">\(g(\lambda) = \beta_0 + \beta X\)</span> <br/> <span class="math inline">\(g(x) =log(x)\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
log
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
<span class="math inline">\(\lambda\)</span>
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span> et <em>p</em>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
Absence de sur-dispersion
</td>
</tr>
</tbody>
</table>
<p>Dans cette formulation, <em>p</em> est fixé. Nous n’avons donc aucune information sur ce qui produit les zéros supplémentaires, mais seulement leur proportion totale dans le jeu de données.</p>
<div id="interprétation-des-paramètres-2" class="section level4">
<h4><span class="header-section-number">8.3.3.1</span> Interprétation des paramètres</h4>
<p>L’interprétation des paramètres est identique à celle d’un modèle de Poisson. Le paramètre <em>p</em> représente la proportion de faux zéros dans la variable <em>Y</em> une fois que les variables indépendantes sont contrôlées.</p>
</div>
<div id="exemple-appliqué-dans-r-4" class="section level4">
<h4><span class="header-section-number">8.3.3.2</span> Exemple appliqué dans R</h4>
<p>La variable de comptage des accidents des piétons que nous avons utilisée dans les deux exemples précédents semble être une bonne candidate pour une distribution de Poisson avec excès de zéros. En effet, nous avions pu constater une sur-dispersion dans le modèle de Poisson original, ainsi qu’un nombre important d’intersections sans accident. Tentons donc d’améliorer notre modèle en ajustant un excès fixe de zéros. Nous utilisons la fonction <code>gamlss</code> du <em>package</em> <code>gamlss</code>.</p>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb873-1"><a href="#cb873-1"></a><span class="kw">library</span>(gamlss)</span>
<span id="cb873-2"><a href="#cb873-2"></a>modelzi &lt;-<span class="st"> </span><span class="kw">gamlss</span>(<span class="dt">formula =</span> Nbr_acci <span class="op">~</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Pass_piet <span class="op">+</span></span>
<span id="cb873-3"><a href="#cb873-3"></a><span class="st">                    </span>Terreplein <span class="op">+</span><span class="st"> </span>Apaisement <span class="op">+</span><span class="st"> </span>LogEmploi <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span></span>
<span id="cb873-4"><a href="#cb873-4"></a><span class="st">                    </span>Entropie <span class="op">+</span><span class="st"> </span>DensiteInter <span class="op">+</span><span class="st"> </span>Long_arterePS <span class="op">+</span><span class="st"> </span>Artere <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb873-5"><a href="#cb873-5"></a>                  <span class="dt">sigma.formula =</span> <span class="op">~</span><span class="dv">1</span>,</span>
<span id="cb873-6"><a href="#cb873-6"></a>               <span class="dt">family =</span> <span class="kw">ZIP</span>(<span class="dt">mu.link =</span> <span class="st">&quot;log&quot;</span>, <span class="dt">sigma.link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb873-7"><a href="#cb873-7"></a>               <span class="dt">data =</span> data_accidents)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1516.53 
## GAMLSS-RS iteration 2: Global Deviance = 1514.656 
## GAMLSS-RS iteration 3: Global Deviance = 1514.52 
## GAMLSS-RS iteration 4: Global Deviance = 1514.508 
## GAMLSS-RS iteration 5: Global Deviance = 1514.506 
## GAMLSS-RS iteration 6: Global Deviance = 1514.506</code></pre>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb875-1"><a href="#cb875-1"></a>modelnull &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">formula =</span> Nbr_acci <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb875-2"><a href="#cb875-2"></a>               <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link=</span><span class="st">&quot;log&quot;</span>),</span>
<span id="cb875-3"><a href="#cb875-3"></a>               <span class="dt">data =</span> data_accidents)</span>
<span id="cb875-4"><a href="#cb875-4"></a></span>
<span id="cb875-5"><a href="#cb875-5"></a><span class="co"># Constante pour p</span></span>
<span id="cb875-6"><a href="#cb875-6"></a>coeff_p &lt;-<span class="st"> </span>modelzi<span class="op">$</span>sigma.coefficients</span>
<span id="cb875-7"><a href="#cb875-7"></a><span class="kw">cat</span>(<span class="st">&quot;Coefficient pour p =&quot;</span>, <span class="kw">round</span>(coeff_p,<span class="dv">4</span>))</span></code></pre></div>
<pre><code>## Coefficient pour p = -1.4376</code></pre>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb877-1"><a href="#cb877-1"></a><span class="co"># Calcul de la déviance expliquée</span></span>
<span id="cb877-2"><a href="#cb877-2"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">deviance</span>(modelzi) <span class="op">/</span><span class="st"> </span><span class="kw">deviance</span>(modelnull)</span></code></pre></div>
<pre><code>## [1] 0.08267513</code></pre>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb879-1"><a href="#cb879-1"></a><span class="co"># Calcul de la probabilité de base p d&#39;être un faux 0</span></span>
<span id="cb879-2"><a href="#cb879-2"></a><span class="co"># en appliquant l&#39;inverse de la fonction logistique</span></span>
<span id="cb879-3"><a href="#cb879-3"></a><span class="kw">exp</span>(<span class="op">-</span>coeff_p) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(<span class="op">-</span>coeff_p))</span></code></pre></div>
<pre><code>## (Intercept) 
##     0.80809</code></pre>
<p>Nous constatons immédiatement que le modèle avec excès fixe de zéros est peu ajusté aux données. Cette version du modèle ne parvient à capter que 8 % de la déviance, ce qui s’explique facilement, car nous n’avons donné aucune variable au modèle pour distinguer les vrais et les faux zéros. Pour cela, nous devons passer au prochain modèle : Poisson avec excès ajusté de zéros. Notons tout de même que d’après ce modèle, 81 % des observations seraient des faux zéros.</p>
</div>
</div>
<div id="sect0844" class="section level3">
<h3><span class="header-section-number">8.3.4</span> Modèle de Poisson avec excès ajusté de zéros</h3>
<p>Nous avons vu dans le modèle précédent que l’excès de zéro était conceptualisé comme la combinaison de deux phénomènes, l’un issu d’une distribution de Poisson que l’on souhaite modéliser, et le second générant des zéros supplémentaires. Il est possible d’aller plus loin que de simplement contrôler la proportion de zéro supplémentaire en modélisant explicitement ce second processus en ajoutant une deuxième équation au modèle. Cette deuxième équation a pour enjeu de modéliser <em>p</em> (la proportion de 0) à l’aide de variables indépendantes, ces dernières pouvant se retrouver dans les deux parties du modèle. L’idée étant que pour chaque observation, le modèle évalue sa probabilité d’être un faux zéro (partie binomiale), et le nombre attendu d’accidents.</p>
<table>
<caption>
(#tab:poisszadentity)Carte d’identité du modèle de Poisson avec excès ajusté de zéros
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable de comptage
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Poisson avec excès de zéros
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim ZIP(\mu,\theta)\)</span> <br/> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <br/> <span class="math inline">\(s(p) = \alpha_0 + \alpha_X\)</span> <br/> <span class="math inline">\(g(x) =log(x)\)</span> <br/> <span class="math inline">\(s(x) = log(\frac{x}{1-x})\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
log et logistique
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
<span class="math inline">\(\mu\)</span> et <em>p</em>
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\alpha_0\)</span> et <span class="math inline">\(\alpha\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
Absence de sur-dispersion
</td>
</tr>
</tbody>
</table>
<div id="interprétation-des-paramètres-3" class="section level4">
<h4><span class="header-section-number">8.3.4.1</span> Interprétation des paramètres</h4>
<p>L’interprétation des paramètres <span class="math inline">\(\beta_0\)</span> et <span class="math inline">\(\beta\)</span> est identique à celle d’un modèle de Poisson. Les paramètres <span class="math inline">\(\alpha_0\)</span> et <span class="math inline">\(\alpha\)</span> sont identiques à ceux d’un modèle binomial. Plus spécifiquement, ces derniers paramètres modélisent la probabilité d’observer des valeurs supérieures à zéro.</p>
</div>
<div id="exemple-appliqué" class="section level4">
<h4><span class="header-section-number">8.3.4.2</span> Exemple appliqué</h4>
<p>Nous avions vu dans l’exemple précédent que l’utilisation du modèle avec excès fixe de zéros pour les données d’accident des piétons aux intersections ne donnait pas de résultats satisfaisants. Nous tentons ici d’améliorer le modèle en ajoutant les variables indépendantes significatives du modèle Poisson dans la seconde équation de régression destinée à détecter les faux zéros.</p>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Pour un modèle de Poisson avec excès de zéros, il n’est pas possible de calculer de distances de Cook. Nous devons donc directement passer à l’analyse des résidus simulés.</p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb881-1"><a href="#cb881-1"></a><span class="co"># Ajuster une première version du modèle</span></span>
<span id="cb881-2"><a href="#cb881-2"></a>modelza &lt;-<span class="st"> </span><span class="kw">gamlss</span>(<span class="dt">formula =</span> Nbr_acci <span class="op">~</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Pass_piet <span class="op">+</span></span>
<span id="cb881-3"><a href="#cb881-3"></a><span class="st">                    </span>Terreplein <span class="op">+</span><span class="st"> </span>Apaisement <span class="op">+</span><span class="st"> </span>LogEmploi <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span></span>
<span id="cb881-4"><a href="#cb881-4"></a><span class="st">                    </span>Entropie <span class="op">+</span><span class="st"> </span>DensiteInter <span class="op">+</span><span class="st"> </span>Long_arterePS <span class="op">+</span><span class="st"> </span>Artere <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb881-5"><a href="#cb881-5"></a>                  <span class="dt">sigma.formula =</span> <span class="op">~</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb881-6"><a href="#cb881-6"></a>               <span class="dt">family =</span> <span class="kw">ZIP</span>(<span class="dt">mu.link =</span> <span class="st">&quot;log&quot;</span>, <span class="dt">sigma.link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb881-7"><a href="#cb881-7"></a>               <span class="dt">data =</span> data_accidents)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1505.155 
## GAMLSS-RS iteration 2: Global Deviance = 1488.658 
## GAMLSS-RS iteration 3: Global Deviance = 1483.304 
## GAMLSS-RS iteration 4: Global Deviance = 1482.085 
## GAMLSS-RS iteration 5: Global Deviance = 1481.868 
## GAMLSS-RS iteration 6: Global Deviance = 1481.832 
## GAMLSS-RS iteration 7: Global Deviance = 1481.827 
## GAMLSS-RS iteration 8: Global Deviance = 1481.825 
## GAMLSS-RS iteration 9: Global Deviance = 1481.825</code></pre>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb883-1"><a href="#cb883-1"></a><span class="co"># Extraire la prédiction des valeurs lambda</span></span>
<span id="cb883-2"><a href="#cb883-2"></a>lambdas &lt;-<span class="st"> </span><span class="kw">predict</span>(modelza, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;mu&quot;</span>)</span>
<span id="cb883-3"><a href="#cb883-3"></a><span class="co"># Extraire la prédiction des valeurs p</span></span>
<span id="cb883-4"><a href="#cb883-4"></a>ps &lt;-<span class="st"> </span><span class="kw">predict</span>(modelza, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;sigma&quot;</span>)</span>
<span id="cb883-5"><a href="#cb883-5"></a><span class="co"># Calculer la combinaison de ces deux éléments</span></span>
<span id="cb883-6"><a href="#cb883-6"></a>preds &lt;-<span class="st"> </span>lambdas <span class="op">*</span><span class="st"> </span>ps</span>
<span id="cb883-7"><a href="#cb883-7"></a><span class="co"># Effectuer les 1000 simulations</span></span>
<span id="cb883-8"><a href="#cb883-8"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb883-9"><a href="#cb883-9"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(lambdas),<span class="cf">function</span>(i){</span>
<span id="cb883-10"><a href="#cb883-10"></a>  lambda &lt;-<span class="st"> </span>lambdas[[i]]</span>
<span id="cb883-11"><a href="#cb883-11"></a>  p &lt;-<span class="st"> </span>ps[[i]]</span>
<span id="cb883-12"><a href="#cb883-12"></a>  sims &lt;-<span class="st"> </span><span class="kw">rZIP</span>(<span class="dt">n =</span> nsim, <span class="dt">mu =</span> lambda, <span class="dt">sigma =</span> p)</span>
<span id="cb883-13"><a href="#cb883-13"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb883-14"><a href="#cb883-14"></a>})</span>
<span id="cb883-15"><a href="#cb883-15"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb883-16"><a href="#cb883-16"></a><span class="co"># Calculer les résidus simulés</span></span>
<span id="cb883-17"><a href="#cb883-17"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> mat_sims, </span>
<span id="cb883-18"><a href="#cb883-18"></a>                            <span class="dt">observedResponse =</span> data_accidents<span class="op">$</span>Nbr_acci,</span>
<span id="cb883-19"><a href="#cb883-19"></a>                            <span class="dt">fittedPredictedResponse =</span> preds,</span>
<span id="cb883-20"><a href="#cb883-20"></a>                            <span class="dt">integerResponse =</span> T)</span></code></pre></div>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="#cb884-1"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/glm/diagzip.png" alt="Diagnostic général des résidus simulés du modèle de Poisson avec excès de zéros ajusté" width="100%" />
<p class="caption">
(#fig:diagzip)Diagnostic général des résidus simulés du modèle de Poisson avec excès de zéros ajusté
</p>
</div>
<p>La figure @ref(fig:diagzip) indique deux problèmes importants dans le modèle : la présence de valeurs aberrantes ainsi qu’un potentiel problème de dispersion. Nous commençons donc par identifier ces valeurs aberrantes.</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb885-1"><a href="#cb885-1"></a><span class="co"># Identification des outliers</span></span>
<span id="cb885-2"><a href="#cb885-2"></a>isOutlier &lt;-<span class="st"> </span><span class="kw">outliers</span>(sim_res,<span class="dt">return =</span> <span class="st">&quot;logical&quot;</span>,<span class="dt">lowerQuantile =</span> <span class="fl">0.001</span>,</span>
<span id="cb885-3"><a href="#cb885-3"></a>                      <span class="dt">upperQuantile =</span> <span class="fl">0.999</span>)</span>
<span id="cb885-4"><a href="#cb885-4"></a>cas_etrange &lt;-<span class="st"> </span><span class="kw">subset</span>(data_accidents, isOutlier)</span>
<span id="cb885-5"><a href="#cb885-5"></a><span class="kw">print</span>(cas_etrange)</span></code></pre></div>
<pre><code>##     Nbr_acci Feux_auto Feux_piet Pass_piet Terreplein Apaisement EmpTotBuffer
## 1         19         1         1         1          1          0     7208.538
## 5         12         1         0         1          0          0     8585.350
## 26         7         0         0         1          0          0     1342.625
## 34         6         0         0         1          0          0    12516.410
## 44         5         0         0         0          0          0     4998.519
## 482        0         0         0         0          0          0     1813.911
##     Densite_pop  Entropie DensiteInter Long_arterePS Artere NB_voies5 log_acci
## 1      5980.923 0.8073926     42.41597       6955.00      1         1 2.995732
## 5      8655.430 0.7607852     89.11495       6412.27      0         0 2.564949
## 26     2751.012 0.0000000     73.35344       2849.66      0         0 2.079442
## 34     8950.942 0.4300549     74.91879       8443.01      1         0 1.945910
## 44     8090.478 0.7879618     66.86856       4517.65      0         0 1.791759
## 482    8988.260 0.4486079     60.93742       3821.78      1         0 0.000000
##     catego_acci catego_acci2 Arret VAG sum_app LogEmploi AccOrdinal    PopHa
## 1             1            1     0   1       4  8.883021          2 5.980923
## 5             1            1     0   1       4  9.057813          2 8.655430
## 26            1            1     1   1       3  7.202382          2 2.751012
## 34            1            1     1   0       3  9.434796          2 8.950942
## 44            1            1     1   1       4  8.516897          2 8.090478
## 482           0            0     0   0       3  7.503240          0 8.988260</code></pre>
<p>Nous retirons des données les quelques observations pouvant avoir une trop forte influence sur le modèle. Après réajustement, la figure @ref(fig:diagzip2) nous informe que nous n’avons plus de valeurs aberrantes restantes ni de fort problème de dispersion. En revanche, le premier quantile des résidus tant à être plus faible que ce que nous aurions pu nous attendre d’une distribution uniforme. Ce constat laisse penser que le modèle a du mal à bien identifier les faux zéros. Ce résultat n’est pas étonnant, car aucune variable n’avait été identifiée à cette fin dans l’article original <span class="citation">(Cloutier et al. <a href="#ref-cloutier2014carrefours" role="doc-biblioref">2014</a>)</span> qui utilisait un modèle binomial négatif.</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="#cb887-1"></a>data2 &lt;-<span class="st"> </span><span class="kw">subset</span>(data_accidents, isOutlier<span class="op">==</span><span class="ot">FALSE</span>)</span>
<span id="cb887-2"><a href="#cb887-2"></a><span class="co"># Ajuster une première version du modèle</span></span>
<span id="cb887-3"><a href="#cb887-3"></a>modelza &lt;-<span class="st"> </span><span class="kw">gamlss</span>(<span class="dt">formula =</span> Nbr_acci <span class="op">~</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Pass_piet <span class="op">+</span></span>
<span id="cb887-4"><a href="#cb887-4"></a><span class="st">                    </span>Terreplein <span class="op">+</span><span class="st"> </span>Apaisement <span class="op">+</span><span class="st"> </span>LogEmploi <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span></span>
<span id="cb887-5"><a href="#cb887-5"></a><span class="st">                    </span>Entropie <span class="op">+</span><span class="st"> </span>DensiteInter <span class="op">+</span><span class="st"> </span>Long_arterePS <span class="op">+</span><span class="st"> </span>Artere <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb887-6"><a href="#cb887-6"></a>                  <span class="dt">sigma.formula =</span> <span class="op">~</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Feux_auto <span class="op">+</span><span class="st"> </span>Feux_piet <span class="op">+</span><span class="st"> </span>Densite_pop <span class="op">+</span><span class="st"> </span>NB_voies5,</span>
<span id="cb887-7"><a href="#cb887-7"></a>               <span class="dt">family =</span> <span class="kw">ZIP</span>(<span class="dt">mu.link =</span> <span class="st">&quot;log&quot;</span>, <span class="dt">sigma.link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb887-8"><a href="#cb887-8"></a>               <span class="dt">data =</span> data2)</span></code></pre></div>
<pre><code>## GAMLSS-RS iteration 1: Global Deviance = 1376.558 
## GAMLSS-RS iteration 2: Global Deviance = 1368.237 
## GAMLSS-RS iteration 3: Global Deviance = 1365.622 
## GAMLSS-RS iteration 4: Global Deviance = 1364.753 
## GAMLSS-RS iteration 5: Global Deviance = 1364.436 
## GAMLSS-RS iteration 6: Global Deviance = 1364.317 
## GAMLSS-RS iteration 7: Global Deviance = 1364.274 
## GAMLSS-RS iteration 8: Global Deviance = 1364.258 
## GAMLSS-RS iteration 9: Global Deviance = 1364.252 
## GAMLSS-RS iteration 10: Global Deviance = 1364.25 
## GAMLSS-RS iteration 11: Global Deviance = 1364.249</code></pre>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="#cb889-1"></a><span class="co"># Extraire la prédiction des valeurs lambda</span></span>
<span id="cb889-2"><a href="#cb889-2"></a>lambdas &lt;-<span class="st"> </span><span class="kw">predict</span>(modelza, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;mu&quot;</span>)</span>
<span id="cb889-3"><a href="#cb889-3"></a><span class="co"># Extraire la prédiction des valeurs p</span></span>
<span id="cb889-4"><a href="#cb889-4"></a>ps &lt;-<span class="st"> </span><span class="kw">predict</span>(modelza, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;sigma&quot;</span>)</span>
<span id="cb889-5"><a href="#cb889-5"></a><span class="co"># Calculer la combinaison de ces deux éléments</span></span>
<span id="cb889-6"><a href="#cb889-6"></a>preds &lt;-<span class="st"> </span>lambdas <span class="op">*</span><span class="st"> </span>ps</span>
<span id="cb889-7"><a href="#cb889-7"></a><span class="co"># Effectuer les 1000 simulations</span></span>
<span id="cb889-8"><a href="#cb889-8"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb889-9"><a href="#cb889-9"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(lambdas),<span class="cf">function</span>(i){</span>
<span id="cb889-10"><a href="#cb889-10"></a>  lambda &lt;-<span class="st"> </span>lambdas[[i]]</span>
<span id="cb889-11"><a href="#cb889-11"></a>  p &lt;-<span class="st"> </span>ps[[i]]</span>
<span id="cb889-12"><a href="#cb889-12"></a>  sims &lt;-<span class="st"> </span><span class="kw">rZIP</span>(<span class="dt">n =</span> nsim, <span class="dt">mu =</span> lambda, <span class="dt">sigma =</span> p)</span>
<span id="cb889-13"><a href="#cb889-13"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb889-14"><a href="#cb889-14"></a>})</span>
<span id="cb889-15"><a href="#cb889-15"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb889-16"><a href="#cb889-16"></a><span class="co"># Calculer les résidus simulés</span></span>
<span id="cb889-17"><a href="#cb889-17"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> mat_sims, </span>
<span id="cb889-18"><a href="#cb889-18"></a>                            <span class="dt">observedResponse =</span> data2<span class="op">$</span>Nbr_acci,</span>
<span id="cb889-19"><a href="#cb889-19"></a>                            <span class="dt">fittedPredictedResponse =</span> preds,</span>
<span id="cb889-20"><a href="#cb889-20"></a>                            <span class="dt">integerResponse =</span> T)</span>
<span id="cb889-21"><a href="#cb889-21"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/diagzip2-1.png" alt="Diagnostic général des résidus simulés du modèle de Poisson avec excès de zéros ajusté (sans valeurs aberrantes)" width="100%" />
<p class="caption">
(#fig:diagzip2)Diagnostic général des résidus simulés du modèle de Poisson avec excès de zéros ajusté (sans valeurs aberrantes)
</p>
</div>
<p>Nous pouvons une fois encore comparer des simulations issues du modèle et la distribution originale de la variable <em>Y</em>. La figure @ref(fig:compzipdistr) montre clairement que les simulations du modèle (en bleu) sont très éloignées dans la distribution originale (en gris), ce qui remet directement en question la pertinence de ce modèle.</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="#cb890-1"></a><span class="co"># Extraire la prédiction des valeurs lambda</span></span>
<span id="cb890-2"><a href="#cb890-2"></a>lambdas &lt;-<span class="st"> </span><span class="kw">predict</span>(modelza, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;mu&quot;</span>)</span>
<span id="cb890-3"><a href="#cb890-3"></a><span class="co"># Extraire la prédiction des valeurs p</span></span>
<span id="cb890-4"><a href="#cb890-4"></a>ps &lt;-<span class="st"> </span><span class="kw">predict</span>(modelza, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">what =</span> <span class="st">&quot;sigma&quot;</span>)</span>
<span id="cb890-5"><a href="#cb890-5"></a><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span id="cb890-6"><a href="#cb890-6"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb890-7"><a href="#cb890-7"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(lambdas),<span class="cf">function</span>(i){</span>
<span id="cb890-8"><a href="#cb890-8"></a>  lambda &lt;-<span class="st"> </span>lambdas[[i]]</span>
<span id="cb890-9"><a href="#cb890-9"></a>  p &lt;-<span class="st"> </span>ps[[<span class="dv">1</span>]]</span>
<span id="cb890-10"><a href="#cb890-10"></a>  sims &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rZIP</span>(nsim,<span class="dt">mu=</span>lambda, <span class="dt">sigma =</span> p))</span>
<span id="cb890-11"><a href="#cb890-11"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb890-12"><a href="#cb890-12"></a>})</span>
<span id="cb890-13"><a href="#cb890-13"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb890-14"><a href="#cb890-14"></a><span class="co"># Préparation des données pour le graphique (valeurs réelles)</span></span>
<span id="cb890-15"><a href="#cb890-15"></a>counts &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">table</span>(data2<span class="op">$</span>Nbr_acci))</span>
<span id="cb890-16"><a href="#cb890-16"></a><span class="kw">names</span>(counts) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;nb_accident&quot;</span>,<span class="st">&#39;frequence&#39;</span>)</span>
<span id="cb890-17"><a href="#cb890-17"></a>counts<span class="op">$</span>nb_accident &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(counts<span class="op">$</span>nb_accident))</span>
<span id="cb890-18"><a href="#cb890-18"></a>counts<span class="op">$</span>prop &lt;-<span class="st"> </span>counts<span class="op">$</span>frequence <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(counts<span class="op">$</span>frequence)</span>
<span id="cb890-19"><a href="#cb890-19"></a><span class="co"># Préparation des données pour le graphique (valeurs simulées)</span></span>
<span id="cb890-20"><a href="#cb890-20"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">count =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">25</span>)</span>
<span id="cb890-21"><a href="#cb890-21"></a>count_sims &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span>nsim, <span class="cf">function</span>(i){</span>
<span id="cb890-22"><a href="#cb890-22"></a>  sim &lt;-<span class="st"> </span>mat_sims[,i]</span>
<span id="cb890-23"><a href="#cb890-23"></a>  cnt &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">table</span>(sim))</span>
<span id="cb890-24"><a href="#cb890-24"></a>  df2 &lt;-<span class="st"> </span><span class="kw">merge</span>(df1,cnt, <span class="dt">by.x=</span><span class="st">&quot;count&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;sim&quot;</span>, <span class="dt">all.x =</span> T, <span class="dt">all.y=</span>F)</span>
<span id="cb890-25"><a href="#cb890-25"></a>  df2<span class="op">$</span>Freq &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(df2<span class="op">$</span>Freq),<span class="dv">0</span>,df2<span class="op">$</span>Freq)</span>
<span id="cb890-26"><a href="#cb890-26"></a>  <span class="kw">return</span>(df2<span class="op">$</span>Freq)</span>
<span id="cb890-27"><a href="#cb890-27"></a>})</span>
<span id="cb890-28"><a href="#cb890-28"></a>count_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(cbind,count_sims)</span>
<span id="cb890-29"><a href="#cb890-29"></a>df_sims &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb890-30"><a href="#cb890-30"></a>  <span class="dt">val =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">25</span>,</span>
<span id="cb890-31"><a href="#cb890-31"></a>  <span class="dt">med =</span> <span class="kw">apply</span>(count_sims, <span class="dt">MARGIN =</span> <span class="dv">1</span>, median),</span>
<span id="cb890-32"><a href="#cb890-32"></a>  <span class="dt">lower =</span> <span class="kw">apply</span>(count_sims, <span class="dt">MARGIN =</span> <span class="dv">1</span>, quantile, <span class="dt">probs =</span> <span class="fl">0.025</span>),</span>
<span id="cb890-33"><a href="#cb890-33"></a>  <span class="dt">upper =</span> <span class="kw">apply</span>(count_sims, <span class="dt">MARGIN =</span> <span class="dv">1</span>, quantile, <span class="dt">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb890-34"><a href="#cb890-34"></a>)</span>
<span id="cb890-35"><a href="#cb890-35"></a><span class="co"># Affichage du graphique</span></span>
<span id="cb890-36"><a href="#cb890-36"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb890-37"><a href="#cb890-37"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>nb_accident, <span class="dt">weight =</span> frequence), <span class="dt">width =</span> <span class="fl">0.6</span>, <span class="dt">data =</span> counts)<span class="op">+</span></span>
<span id="cb890-38"><a href="#cb890-38"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> val, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper),</span>
<span id="cb890-39"><a href="#cb890-39"></a>                <span class="dt">data =</span> df_sims, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">width =</span> <span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb890-40"><a href="#cb890-40"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> val, <span class="dt">y =</span> med), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">1.3</span>, <span class="dt">data =</span> df_sims)<span class="op">+</span></span>
<span id="cb890-41"><a href="#cb890-41"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="dv">7</span>), <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">7</span>))<span class="op">+</span></span>
<span id="cb890-42"><a href="#cb890-42"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">12</span>)<span class="op">+</span></span>
<span id="cb890-43"><a href="#cb890-43"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb890-44"><a href="#cb890-44"></a>       <span class="dt">x =</span> <span class="st">&quot;nombre d&#39;accidents&quot;</span>,</span>
<span id="cb890-45"><a href="#cb890-45"></a>       <span class="dt">y =</span> <span class="st">&quot;nombre d&#39;occurrences&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/compzipdistr-1.png" alt="Comparaison de la distribution originale et des simulations pour le modèle de Poisson avec excès de zéros ajusté" width="65%" />
<p class="caption">
(#fig:compzipdistr)Comparaison de la distribution originale et des simulations pour le modèle de Poisson avec excès de zéros ajusté
</p>
</div>
<p><strong>Vérifier la qualité d’ajustement</strong></p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="#cb891-1"></a>modelenull &lt;-<span class="st"> </span><span class="kw">glm</span>(Nbr_acci <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb891-2"><a href="#cb891-2"></a>               <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link=</span><span class="st">&quot;log&quot;</span>),</span>
<span id="cb891-3"><a href="#cb891-3"></a>               <span class="dt">data =</span> data2)</span>
<span id="cb891-4"><a href="#cb891-4"></a><span class="co"># Calcul des R2</span></span>
<span id="cb891-5"><a href="#cb891-5"></a><span class="kw">rsqs</span>(<span class="dt">loglike.full =</span> <span class="kw">logLik</span>(modelza),</span>
<span id="cb891-6"><a href="#cb891-6"></a>     <span class="dt">loglike.null =</span> <span class="kw">logLik</span>(modelenull),</span>
<span id="cb891-7"><a href="#cb891-7"></a>     <span class="dt">full.deviance =</span> <span class="kw">deviance</span>(modelza),</span>
<span id="cb891-8"><a href="#cb891-8"></a>     <span class="dt">null.deviance =</span> <span class="kw">deviance</span>(modelenull),</span>
<span id="cb891-9"><a href="#cb891-9"></a>     <span class="dt">nb.params =</span> modelza<span class="op">$</span>sigma.df <span class="op">+</span><span class="st"> </span>modelza<span class="op">$</span>mu.df,</span>
<span id="cb891-10"><a href="#cb891-10"></a>     <span class="dt">n =</span> <span class="kw">nrow</span>(data2)</span>
<span id="cb891-11"><a href="#cb891-11"></a>     )</span></code></pre></div>
<pre><code>## $`deviance expliquee`
## [1] 0.1110817
## 
## $`McFadden ajuste`
## &#39;log Lik.&#39; 0.361296 (df=18)
## 
## $`Cox and Snell`
## &#39;log Lik.&#39; 0.8097617 (df=18)
## 
## $Nagelkerke
## &#39;log Lik.&#39; 0.819894 (df=18)</code></pre>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="#cb893-1"></a><span class="co"># Calcul du RMSE</span></span>
<span id="cb893-2"><a href="#cb893-2"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>((preds <span class="op">-</span><span class="st"> </span>data2<span class="op">$</span>Nbr_acci)<span class="op">**</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 2.626853</code></pre>
<p>Le modèle avec excès de zéro ajusté ne parvient à expliquer que 11 % de la déviance totale. Il obtient toutefois des valeurs de R<sup>2</sup> assez hautes (McFadden ajusté : 0,36, Nagerlkerke : 0,82). Son RMSE est très élevé (2,6), comparativement à celui que nous avions obtenu avec le modèle binomial négatif (1,9). Considérant ces éléments, ce modèle est nettement moins informatif que le modèle binomial négatif et ne devrait pas être retenu. Nous allons tout de même montrer ici comment interpréter ces résultats.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>L’ensemble des coefficients du modèle sont accessibles avec la fonction <code>summary</code>. Les coefficients dédiés à la partie Poisson (appelée <strong>Mu</strong> dans le résumé) doivent être analysés et interprétés de la même manière que s’ils provenaient d’un modèle de Poisson. Les coefficients appartenant à la partie logistique (appelé <strong>Sigma</strong> dans le résumé) doivent être analysés et interprétés de la même manière que s’ils provenaient d’un modèle logistique.</p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="#cb895-1"></a><span class="co"># Extraction des résultats</span></span>
<span id="cb895-2"><a href="#cb895-2"></a>base_table &lt;-<span class="st"> </span><span class="kw">summary</span>(modelza)</span></code></pre></div>
<pre><code>## ******************************************************************
## Family:  c(&quot;ZIP&quot;, &quot;Poisson Zero Inflated&quot;) 
## 
## Call:  gamlss(formula = Nbr_acci ~ Feux_auto + Feux_piet +  
##     Pass_piet + Terreplein + Apaisement + LogEmploi +  
##     Densite_pop + Entropie + DensiteInter + Long_arterePS +  
##     Artere + NB_voies5, sigma.formula = ~1 + Feux_auto +  
##     Feux_piet + Densite_pop + NB_voies5, family = ZIP(mu.link = &quot;log&quot;,  
##     sigma.link = &quot;logit&quot;), data = data2) 
## 
## Fitting method: RS() 
## 
## ------------------------------------------------------------------
## Mu link function:  log
## Mu Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -2.589e+00  5.459e-01  -4.743 2.78e-06 ***
## Feux_auto      7.126e-01  2.008e-01   3.549 0.000424 ***
## Feux_piet      4.244e-01  1.068e-01   3.975 8.12e-05 ***
## Pass_piet      2.894e-01  1.994e-01   1.451 0.147472    
## Terreplein    -3.347e-01  1.662e-01  -2.013 0.044643 *  
## Apaisement     2.284e-01  1.534e-01   1.489 0.137136    
## LogEmploi      1.542e-01  7.542e-02   2.044 0.041506 *  
## Densite_pop    8.619e-05  1.523e-05   5.659 2.62e-08 ***
## Entropie      -1.700e-01  3.018e-01  -0.563 0.573371    
## DensiteInter   3.950e-03  2.058e-03   1.919 0.055562 .  
## Long_arterePS  1.140e-05  2.017e-05   0.565 0.572332    
## Artere         5.150e-02  1.140e-01   0.452 0.651661    
## NB_voies5      4.518e-01  1.037e-01   4.358 1.61e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------------------------------
## Sigma link function:  logit
## Sigma Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  9.625e-01  5.699e-01   1.689  0.09188 . 
## Feux_auto   -1.641e+00  6.159e-01  -2.664  0.00797 **
## Feux_piet    2.260e-01  7.507e-01   0.301  0.76355   
## Densite_pop -1.167e-04  5.582e-05  -2.091  0.03701 * 
## NB_voies5   -1.807e+00  1.271e+00  -1.422  0.15575   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## ------------------------------------------------------------------
## No. of observations in the fit:  499 
## Degrees of Freedom for the fit:  18
##       Residual Deg. of Freedom:  481 
##                       at cycle:  11 
##  
## Global Deviance:     1364.249 
##             AIC:     1400.249 
##             SBC:     1476.076 
## ******************************************************************</code></pre>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="#cb897-1"></a><span class="co"># Multiplication par 1000 des coefficients de population</span></span>
<span id="cb897-2"><a href="#cb897-2"></a><span class="co"># (effet pour 1000 habitants)</span></span>
<span id="cb897-3"><a href="#cb897-3"></a>base_table[<span class="dv">8</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>base_table[<span class="dv">8</span>,<span class="dv">1</span>]</span>
<span id="cb897-4"><a href="#cb897-4"></a>base_table[<span class="dv">8</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>base_table[<span class="dv">8</span>,<span class="dv">2</span>]</span>
<span id="cb897-5"><a href="#cb897-5"></a>base_table[<span class="dv">17</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>base_table[<span class="dv">17</span>,<span class="dv">1</span>]</span>
<span id="cb897-6"><a href="#cb897-6"></a>base_table[<span class="dv">17</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>base_table[<span class="dv">17</span>,<span class="dv">2</span>]</span>
<span id="cb897-7"><a href="#cb897-7"></a><span class="co"># Multiplication par 1000 des coefficients de longueur artère</span></span>
<span id="cb897-8"><a href="#cb897-8"></a><span class="co"># (effet pour 1 km)</span></span>
<span id="cb897-9"><a href="#cb897-9"></a>base_table[<span class="dv">11</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>base_table[<span class="dv">11</span>,<span class="dv">1</span>]</span>
<span id="cb897-10"><a href="#cb897-10"></a>base_table[<span class="dv">11</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>base_table[<span class="dv">11</span>,<span class="dv">2</span>]</span>
<span id="cb897-11"><a href="#cb897-11"></a><span class="co"># Calcul des exponentiels des variables indépendantes</span></span>
<span id="cb897-12"><a href="#cb897-12"></a><span class="co"># et des intervalles de confiance</span></span>
<span id="cb897-13"><a href="#cb897-13"></a>expcoeff &lt;-<span class="st"> </span><span class="kw">exp</span>(base_table[,<span class="dv">1</span>])</span>
<span id="cb897-14"><a href="#cb897-14"></a>expcoeff2<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">exp</span>(base_table[,<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>base_table[,<span class="dv">2</span>])</span>
<span id="cb897-15"><a href="#cb897-15"></a>expcoeff97<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">exp</span>(base_table[,<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>base_table[,<span class="dv">2</span>])</span>
<span id="cb897-16"><a href="#cb897-16"></a>base_table &lt;-<span class="st"> </span><span class="kw">cbind</span>(base_table, expcoeff, expcoeff2<span class="fl">.5</span>,expcoeff97<span class="fl">.5</span>)</span>
<span id="cb897-17"><a href="#cb897-17"></a><span class="co"># Calculer une colonne indiquant le niveau de significativité</span></span>
<span id="cb897-18"><a href="#cb897-18"></a>sign &lt;-<span class="st"> </span><span class="kw">case_when</span>(</span>
<span id="cb897-19"><a href="#cb897-19"></a>  base_table[,<span class="dv">4</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.001</span> <span class="op">~</span><span class="st"> &quot;***&quot;</span>,</span>
<span id="cb897-20"><a href="#cb897-20"></a>  base_table[,<span class="dv">4</span>]  <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.001</span> <span class="op">&amp;</span><span class="st">  </span>base_table[,<span class="dv">4</span>]<span class="op">&lt;</span><span class="fl">0.01</span> <span class="op">~</span><span class="st"> &quot;**&quot;</span>,</span>
<span id="cb897-21"><a href="#cb897-21"></a>  base_table[,<span class="dv">4</span>]  <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">&amp;</span><span class="st">  </span>base_table[,<span class="dv">4</span>]<span class="op">&lt;</span><span class="fl">0.05</span> <span class="op">~</span><span class="st"> &quot;*&quot;</span>,</span>
<span id="cb897-22"><a href="#cb897-22"></a>  base_table[,<span class="dv">4</span>]  <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">&amp;</span><span class="st">  </span>base_table[,<span class="dv">4</span>]<span class="op">&lt;</span><span class="fl">0.1</span> <span class="op">~</span><span class="st"> &quot;.&quot;</span>,</span>
<span id="cb897-23"><a href="#cb897-23"></a>  <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;&quot;</span></span>
<span id="cb897-24"><a href="#cb897-24"></a>)</span>
<span id="cb897-25"><a href="#cb897-25"></a><span class="co"># Arrondir à trois décimales</span></span>
<span id="cb897-26"><a href="#cb897-26"></a>base_table &lt;-<span class="st"> </span><span class="kw">round</span>(base_table,<span class="dv">3</span>)</span>
<span id="cb897-27"><a href="#cb897-27"></a><span class="co"># Enlever les colonnes de valeurs de t et d&#39;erreur standard</span></span>
<span id="cb897-28"><a href="#cb897-28"></a>base_table &lt;-<span class="st"> </span>base_table[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)]</span>
<span id="cb897-29"><a href="#cb897-29"></a>base_table &lt;-<span class="st"> </span><span class="kw">cbind</span>(base_table, sign)</span>
<span id="cb897-30"><a href="#cb897-30"></a><span class="co"># Remplacer les 0 dans la colonne pval</span></span>
<span id="cb897-31"><a href="#cb897-31"></a>base_table[,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">ifelse</span>(base_table[,<span class="dv">2</span>]<span class="op">==</span><span class="st">&quot;0&quot;</span>,<span class="st">&quot;&lt;0.001&quot;</span>,base_table[,<span class="dv">2</span>])</span>
<span id="cb897-32"><a href="#cb897-32"></a><span class="co"># Séparer le tout en deux tableaux</span></span>
<span id="cb897-33"><a href="#cb897-33"></a>part_poiss &lt;-<span class="st"> </span>base_table[<span class="dv">1</span><span class="op">:</span><span class="dv">13</span>,]</span>
<span id="cb897-34"><a href="#cb897-34"></a>part_logit &lt;-<span class="st"> </span>base_table[<span class="dv">14</span><span class="op">:</span><span class="dv">18</span>,]</span>
<span id="cb897-35"><a href="#cb897-35"></a><span class="co"># Mettre les bons noms de colonnes</span></span>
<span id="cb897-36"><a href="#cb897-36"></a><span class="kw">colnames</span>(part_poiss) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Coeff.&quot;</span>,<span class="st">&quot;Val.p&quot;</span>,<span class="st">&quot;Exp(Coeff.)&quot;</span>,</span>
<span id="cb897-37"><a href="#cb897-37"></a>                          <span class="st">&quot;IC 2,5 % exp(Coeff.)&quot;</span>,<span class="st">&quot;IC 97,5 % exp(Coeff.)&quot;</span>, <span class="st">&quot;Sign.&quot;</span>)</span>
<span id="cb897-38"><a href="#cb897-38"></a><span class="kw">colnames</span>(part_logit) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Coeff.&quot;</span>,<span class="st">&quot;Val.p&quot;</span>,<span class="st">&quot;RC&quot;</span>,<span class="st">&quot;IC 2,5 % RC&quot;</span>,<span class="st">&quot;IC 97,5 % RC&quot;</span>, <span class="st">&quot;Sign.&quot;</span>)</span></code></pre></div>
<p>Nous rapportons les résultats de ce modèle Poisson avec excès de zéro ajusté dans les tableaux @ref(tab:zapoisstab1) et @ref(tab:zapoisstab2).</p>
<table>
<caption>
(#tab:zapoisstab1)Résultats de la partie Poisson du modèle de Poisson avec excès de zéros ajusté
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coeff.
</th>
<th style="text-align:right;">
Val.p
</th>
<th style="text-align:right;">
Exp(Coeff.)
</th>
<th style="text-align:right;">
IC 2,5 % exp(Coeff.)
</th>
<th style="text-align:right;">
IC 97,5 % exp(Coeff.)
</th>
<th style="text-align:right;">
Sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
-2.589
</td>
<td style="text-align:right;">
&lt;0.001
</td>
<td style="text-align:right;">
0.075
</td>
<td style="text-align:right;">
0.026
</td>
<td style="text-align:right;">
0.219
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Feux_auto
</td>
<td style="text-align:right;">
0.713
</td>
<td style="text-align:right;">
&lt;0.001
</td>
<td style="text-align:right;">
2.039
</td>
<td style="text-align:right;">
1.376
</td>
<td style="text-align:right;">
3.022
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Feux_piet
</td>
<td style="text-align:right;">
0.424
</td>
<td style="text-align:right;">
&lt;0.001
</td>
<td style="text-align:right;">
1.529
</td>
<td style="text-align:right;">
1.24
</td>
<td style="text-align:right;">
1.885
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pass_piet
</td>
<td style="text-align:right;">
0.289
</td>
<td style="text-align:right;">
0.147
</td>
<td style="text-align:right;">
1.336
</td>
<td style="text-align:right;">
0.903
</td>
<td style="text-align:right;">
1.974
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Terreplein
</td>
<td style="text-align:right;">
-0.335
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.716
</td>
<td style="text-align:right;">
0.517
</td>
<td style="text-align:right;">
0.991
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Apaisement
</td>
<td style="text-align:right;">
0.228
</td>
<td style="text-align:right;">
0.137
</td>
<td style="text-align:right;">
1.257
</td>
<td style="text-align:right;">
0.93
</td>
<td style="text-align:right;">
1.697
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
LogEmploi
</td>
<td style="text-align:right;">
0.154
</td>
<td style="text-align:right;">
0.042
</td>
<td style="text-align:right;">
1.167
</td>
<td style="text-align:right;">
1.006
</td>
<td style="text-align:right;">
1.353
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
Densite_pop
</td>
<td style="text-align:right;">
0.086
</td>
<td style="text-align:right;">
&lt;0.001
</td>
<td style="text-align:right;">
1.09
</td>
<td style="text-align:right;">
1.058
</td>
<td style="text-align:right;">
1.123
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Entropie
</td>
<td style="text-align:right;">
-0.17
</td>
<td style="text-align:right;">
0.573
</td>
<td style="text-align:right;">
0.844
</td>
<td style="text-align:right;">
0.467
</td>
<td style="text-align:right;">
1.524
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
DensiteInter
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.056
</td>
<td style="text-align:right;">
1.004
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.008
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
Long_arterePS
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
0.572
</td>
<td style="text-align:right;">
1.011
</td>
<td style="text-align:right;">
0.972
</td>
<td style="text-align:right;">
1.052
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Artere
</td>
<td style="text-align:right;">
0.051
</td>
<td style="text-align:right;">
0.652
</td>
<td style="text-align:right;">
1.053
</td>
<td style="text-align:right;">
0.842
</td>
<td style="text-align:right;">
1.316
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
NB_voies5
</td>
<td style="text-align:right;">
0.452
</td>
<td style="text-align:right;">
&lt;0.001
</td>
<td style="text-align:right;">
1.571
</td>
<td style="text-align:right;">
1.282
</td>
<td style="text-align:right;">
1.925
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul>
<table>
<caption>
(#tab:zapoisstab2)Résultats de la partie logistique du modèle de Poisson avec excès de zéros ajusté
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coeff.
</th>
<th style="text-align:right;">
Val.p
</th>
<th style="text-align:right;">
RC
</th>
<th style="text-align:right;">
IC 2,5 % RC
</th>
<th style="text-align:right;">
IC 97,5 % RC
</th>
<th style="text-align:right;">
Sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
0.963
</td>
<td style="text-align:right;">
0.092
</td>
<td style="text-align:right;">
2.618
</td>
<td style="text-align:right;">
0.857
</td>
<td style="text-align:right;">
8.001
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
Feux_auto
</td>
<td style="text-align:right;">
-1.641
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:right;">
0.194
</td>
<td style="text-align:right;">
0.058
</td>
<td style="text-align:right;">
0.648
</td>
<td style="text-align:right;">
**
</td>
</tr>
<tr>
<td style="text-align:left;">
Feux_piet
</td>
<td style="text-align:right;">
0.226
</td>
<td style="text-align:right;">
0.764
</td>
<td style="text-align:right;">
1.254
</td>
<td style="text-align:right;">
0.288
</td>
<td style="text-align:right;">
5.46
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Densite_pop
</td>
<td style="text-align:right;">
-0.117
</td>
<td style="text-align:right;">
0.037
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:right;">
0.798
</td>
<td style="text-align:right;">
0.993
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
NB_voies5
</td>
<td style="text-align:right;">
-1.807
</td>
<td style="text-align:right;">
0.156
</td>
<td style="text-align:right;">
0.164
</td>
<td style="text-align:right;">
0.014
</td>
<td style="text-align:right;">
1.982
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table></li>
</ul>
<p>Nous observons ainsi que la présence d’un feu de circulation divise par 5 les chances de rentrer dans la catégorie d’intersection où des accidents peuvent se produire. De même, la densité de population réduit les chances de passer dans cette catégorie de 11 % tous les paliers de 1 000 personnes.</p>
<p>Concernant les coefficients pour la partie Poisson du modèle, nous observons que les présences d’un feu de circulation et d’un feu pour piéton contribuent à multiplier respectivement par 2 et 1,5 le nombre attendu d’accidents à une intersection. De même, la présence d’un axe de circulation à cinq voies augmente de 57 % le nombre d’accidents. Enfin, la densité de population est aussi associée à une augmentation du nombre d’accidents : pour 1 000 habitants supplémentaires autour de l’intersection, nous augmentons le nombre d’accidents attendu de 9 %.</p>
</div>
</div>
<div id="sect0845" class="section level3">
<h3><span class="header-section-number">8.3.5</span> Conclusion sur les modèles destinés à des variables de comptage</h3>
<p>Dans cette section, nous avons vu que modéliser une variable de comptage ne doit pas toujours être réalisé avec une simple distribution de Poisson. Il est nécessaire de tenir compte de la sur ou sous-dispersion potentielle ainsi que de l’excès de zéros. Nous n’avons cependant pas couvert tous les cas, il est en effet possible d’ajuster des modèles avec une distribution binomiale négative avec excès de zéros (avec le <em>package</em> <code>gamlss</code>), ainsi que des modèles de <strong>Hurdle</strong>. Ces derniers ont une approche différente de celle proposée par les distributions ajustées pour tenir compte de l’excès de zéro que nous détaillons dans l’encadré « pour aller plus loin » ci-dessous. Le processus de sélection du modèle peut être résumé avec la figure @ref(fig:figpoisswork). Notez que même en suivant cette procédure, rien ne garantit que votre modèle final reflète bien les données que vous étudiez. L’analyse approfondie des résidus et des prédictions du modèle est la seule façon de déterminer si oui ou non le modèle est fiable.</p>
<div class="figure" style="text-align: center">
<img src="images/glm/poisson_workflow.png" alt="Processus de sélection d'un modèle pour une variable de comptage" width="100%" />
<p class="caption">
(#fig:figpoisswork)Processus de sélection d’un modèle pour une variable de comptage
</p>
</div>
<div class="bloc_aller_loin">
<p><strong>Modèle de Hurdle <em>versus</em> modèle avec excès de zéro</strong></p>
<p>Les modèles Hurdle sont une autre catégorie de modèles GLM. Ils peuvent être décrits avec la formulation suivante :</p>
<p><span class="math display">\[\begin{equation}\left\{\begin{array}{c}
Y \sim \text {Binomial}(p) \text { si } y=0 \\
\text { logit }(p)=\beta_{a} X_{a} \\
Y \sim \text { TrPoisson}(\lambda) \text { si } y&gt;0 \\
\log (\lambda)=\beta_{b} X_{b}
\end{array}\right.
(\#eq:glmHurdle)
\end{equation}\]</span>
</p>
<p>Nous constatons qu’un modèle Hurdle utilise deux distributions, la première est une distribution binomiale dont l’objectif est de prédire si les observations sont à 0 ou au-dessus de 0. La seconde est une distribution strictement positive (supérieure à 0), il peut s’agir d’une distribution tronquée de Poisson, tronquée binomiale négative, Gamma, log-normale ou autre, dépendamment du phénomène modélisé. Puisque le modèle fait appel à deux distributions, deux équations de régressions sont utilisées, l’une pour prédire <em>p</em> (la probabilité d’observer une valeur au-dessus de 0) et l’autre l’espérance (moyenne) de la seconde distribution.</p>
<p>En d’autres termes, un modèle de Hurdle modélise les données à zéro et les données au-delà de 0 comme deux processus différents (chacun avec sa propre distribution). Cette approche se distingue des modèles avec excès de zéros qui utilisent une seule distribution pour décrire l’ensemble des données. D’après un modèle avec excès de zéro, il existe des vrais et des faux zéros que l’on tente de distinguer. Dans un modèle de Hurdle, l’idée est que les zéros constituent une limite. Nous modélisons la probabilité de dépasser cette limite et ensuite la magnitude du dépassement de cette limite.</p>
<p>Prenons un exemple pour rendre la distinction plus concrète. Admettons que nous utilisions un capteur capable de mesurer la concentration de particules fines dans l’air. D’après les spécifications du fabricant, le capteur est capable de mesurer des taux de concentration à partir de 0,001 µg/m<sup>3</sup>. Dans une ville avec des niveaux de concentration très faibles, il sera très fréquent que le capteur enregistre des valeurs à zéro. Considérant ce phénomène, il serait judicieux de modéliser le processus avec un modèle de Hurdle Gamma puisque les 0 représentent une limite qui n’a pas été franchie : le seuil de détection du capteur. Nous allons donc traiter différemment les secteurs au-dessous et au-dessus de ce seuil. Si l’on reprend notre exemple sur les accidents des piétons à des intersections, il est plus judicieux dans ce cas de modéliser le phénomène avec un modèle avec excès de zéro puisque l’on peut observer zéro accident à une intersection dangereuse (vrai zéro) et zéro accident à une intersection sur laquelle aucun piéton ne traverse jamais (faux zéro).</p>
</div>
</div>
</div>
<div id="sect085" class="section level2">
<h2><span class="header-section-number">8.4</span> Modèles GLM pour des variables continues</h2>
<p>Comme nous avons pu le voir dans la section @ref(sect024), il existe un grand nombre de distributions permettant de décrire une grande diversité de variables continues. Il serait fastidieux de tous les présenter, nous allons seulement revenir sur les plus fréquents.</p>
<div id="sect0851" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Modèle GLM gaussien</h3>
<p>Comme nous l’avons vu en introduction, le modèle GLM gaussien est le plus simple puisqu’il correspond à la transposition de la régression linéaire classique (des moindres carrés) dans la forme des modèles généralisés.</p>
<table>
<caption>
(#tab:gaussiandentity)Carte d’identité du modèle gaussien
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable continue dans l’intervalle <span class="math inline">\(]-\infty ; + \infty[\)</span>
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Normale
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim Normal(\mu,\sigma)\)</span> <br/> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <br/> <span class="math inline">\(g(x) = x\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
identitaire
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
<span class="math inline">\(\mu\)</span>
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span> et <span class="math inline">\(\sigma\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
Homoscédasticité
</td>
</tr>
</tbody>
</table>
<div id="conditions-dapplication-4" class="section level4">
<h4><span class="header-section-number">8.4.1.1</span> Conditions d’application</h4>
<p>Les conditions d’application sont les mêmes que celles d’une régression linéaire classique. La condition de l’homoscédasticité (homogénéité de la variance), est due au fait que la variance du modèle est contrôlée par un seul paramètre fixe <span class="math inline">\(var(y) = \sigma\)</span> (l’écart-type de la distribution normale). À titre de comparaison, rappelons que dans un modèle de Poisson, la variance est égale à la moyenne (<span class="math inline">\(var(y) = E(y)\)</span>) alors que dans un modèle binomial négatif, la variance est fonction de la moyenne et d’un paramètre <span class="math inline">\(\theta\)</span> (<span class="math inline">\(var(y) = E(y) + E(y)^{\frac{2}{\theta}}\)</span>). Pour ces deux exemples, la variance augmente au fur et à mesure que la moyenne augmente.</p>
</div>
<div id="interprétation-des-paramètres-4" class="section level4">
<h4><span class="header-section-number">8.4.1.2</span> Interprétation des paramètres</h4>
<p>L’interprétation des paramètres est la même que pour une régression linéaire classique :</p>
<ul>
<li><span class="math inline">\(\beta_0\)</span> : la constante, soit la moyenne attendue de la variable <em>Y</em> lorsque les valeurs de toutes les variables <em>X</em> sont 0.</li>
<li><span class="math inline">\(\beta\)</span> : les coefficients de régression qui quantifient l’impact d’une augmentation d’une unité des variables <em>X</em> sur la moyenne de la variable <em>Y</em>.</li>
<li><span class="math inline">\(\sigma\)</span> : l’écart-type de <em>Y</em> après avoir contrôlé les variables <em>X</em>. Il peut s’interpréter comme l’incertitude restante après modélisation de la moyenne de <em>Y</em>. Concrètement, si vous utilisez votre équation de régression pour prédire une nouvelle valeur de <em>Y</em> : <span class="math inline">\(\hat{Y}\)</span>, l’intervalle de confiance à 95 % de cette prédiction est (<span class="math inline">\(\hat{Y} - 3\sigma\text{ ; }\hat{Y} + 3\sigma\)</span>). Vous noterez donc que plus <span class="math inline">\(\sigma\)</span> est grand, plus grande est l’incertitude de la prédiction.</li>
</ul>
</div>
<div id="exemple-appliqué-dans-r-5" class="section level4">
<h4><span class="header-section-number">8.4.1.3</span> Exemple appliqué dans R</h4>
<p>Pour cet exemple, nous reprenons le modèle LM que nous avions présenté dans la section @ref(sect077). À titre de rappel, l’objectif est de modéliser la densité végétale dans les secteurs de recensement de Montréal. Pour cela, nous utilisons des variables relatives aux populations vulnérables physiologiquement ou socioéconomiquement, tout en contrôlant l’impact de la forme urbaine. Parmi ces dernières, l’âge médian des bâtiments est ajouté au modèle avec, une polynomiale d’ordre deux, et la densité d’habitants est transformée avec la fonction logarithmique.</p>
<p><strong>Vérification des conditions d’application</strong></p>
<p>La première étape de la vérification des conditions d’application est bien sûr de s’assurer de l’absence de multicolinéarité excessive.</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="#cb898-1"></a><span class="co"># Chargement des données</span></span>
<span id="cb898-2"><a href="#cb898-2"></a><span class="kw">load</span>(<span class="st">&quot;data/lm/DataVegetation.RData&quot;</span>)</span>
<span id="cb898-3"><a href="#cb898-3"></a><span class="co"># Calcul du VIF</span></span>
<span id="cb898-4"><a href="#cb898-4"></a><span class="kw">library</span>(car)</span>
<span id="cb898-5"><a href="#cb898-5"></a><span class="kw">vif</span>(<span class="kw">glm</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb898-6"><a href="#cb898-6"></a><span class="st">                       </span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal))</span></code></pre></div>
<pre><code>##                        GVIF Df GVIF^(1/(2*Df))
## log(HABHA)         1.289495  1        1.135559
## poly(AgeMedian, 2) 1.387429  2        1.085307
## Pct_014            1.517957  1        1.232054
## Pct_65P            1.304094  1        1.141969
## Pct_MV             1.480275  1        1.216666
## Pct_FR             1.729646  1        1.315160</code></pre>
<p>Puisque l’ensemble des valeurs de VIF sont inférieures à deux, nos données ne sont pas marquées par une multicolinéarité problématique. La seconde étape du diagnostic consiste à calculer et afficher les distances de Cook.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/gausscook-1.png" alt="Distances de Cook pour le modèle gaussien" width="65%" />
<p class="caption">
(#fig:gausscook)Distances de Cook pour le modèle gaussien
</p>
</div>
<p>La figure @ref(fig:gausscook) indique clairement que quatre observations sont très influentes dans le modèle.</p>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="#cb900-1"></a><span class="co"># Sélection des cas étranges</span></span>
<span id="cb900-2"><a href="#cb900-2"></a>cas_etranges &lt;-<span class="st"> </span><span class="kw">subset</span>(DataFinal, cooksd <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.03</span>)</span>
<span id="cb900-3"><a href="#cb900-3"></a><span class="kw">print</span>(cas_etranges)</span></code></pre></div>
<pre><code>##      VegPct ArbPct V250Pct V500Pct A250Pct A500Pct      HABHA AgeMedian Pct_014
## 3374 10.481  5.478  18.987  13.744   2.908   2.704  74.835867       226    4.76
## 3378  0.000  0.000  12.709  12.505   2.116   2.324  88.006946       206    6.25
## 4446 23.162  5.209  31.437  31.535   8.672   9.108 313.142733       206   14.40
## 9088 85.767 27.583  78.195  83.492  42.999  51.074   2.070472       207   12.00
##      Pct_65P Pct_MV Pct_FR DistCBDkm   SDRNOM
## 3374   14.29  23.81  14.29     0.748 Montréal
## 3378   12.50  25.00  12.50     0.706 Montréal
## 4446   16.87  53.50  42.39     8.678 Montréal
## 9088   24.00  12.00  16.00    28.440 Montréal</code></pre>
<p>Il s’agit de quatre îlots dans Montréal avec des logements très anciens : plus de 200 ans, alors que la moyenne est de 52 ans pour le reste de la zone d’étude. Le fait que nous ayons dans le modèle une polynomiale d’ordre 2 pour cette variable intensifie l’impact de ces valeurs extrêmes. Par conséquent, nous décidons de simplement les supprimer. Nous verrons plus tard qu’une alternative envisageable est de changer la distribution du modèle pour une distribution de Student (plus robuste aux valeurs extrêmes).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/gausscook2-1.png" alt="Distances de Cook pour le modèle gaussien après suppression des observations influentes" width="2100" />
<p class="caption">
(#fig:gausscook2)Distances de Cook pour le modèle gaussien après suppression des observations influentes
</p>
</div>
<p>Une fois ces observations retirées, les nouvelles distances de Cook (figure @ref(fig:gausscook2)) ne révèlent plus d’observations fortement influentes. Nous pouvons passer à l’analyse des résidus simulés. La figure @ref(fig:gaussresid) démontre que la distribution des résidus est significativement différente d’une distribution uniforme, que des valeurs aberrantes sont encore présentes et qu’il existe un lien entre résidus et prédiction dans le modèle.</p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb902-1"><a href="#cb902-1"></a><span class="co"># Extraction des prédictions du modèle</span></span>
<span id="cb902-2"><a href="#cb902-2"></a>mus &lt;-<span class="st"> </span><span class="kw">predict</span>(modele, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>)</span>
<span id="cb902-3"><a href="#cb902-3"></a>modsigma &lt;-<span class="st"> </span><span class="kw">sigma</span>(modele)</span>
<span id="cb902-4"><a href="#cb902-4"></a><span class="co"># Extraction de l&#39;écart type du modèle</span></span>
<span id="cb902-5"><a href="#cb902-5"></a><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span id="cb902-6"><a href="#cb902-6"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb902-7"><a href="#cb902-7"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(mus),<span class="cf">function</span>(i){</span>
<span id="cb902-8"><a href="#cb902-8"></a>  mu &lt;-<span class="st"> </span>mus[[i]]</span>
<span id="cb902-9"><a href="#cb902-9"></a>  sims &lt;-<span class="st"> </span><span class="kw">rnorm</span>(nsim, <span class="dt">mean=</span>mu, <span class="dt">sd =</span> modsigma)</span>
<span id="cb902-10"><a href="#cb902-10"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb902-11"><a href="#cb902-11"></a>})</span>
<span id="cb902-12"><a href="#cb902-12"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb902-13"><a href="#cb902-13"></a><span class="co"># Calculer les résidus simulés</span></span>
<span id="cb902-14"><a href="#cb902-14"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> mat_sims, </span>
<span id="cb902-15"><a href="#cb902-15"></a>                            <span class="dt">observedResponse =</span> DataFinal2<span class="op">$</span>VegPct,</span>
<span id="cb902-16"><a href="#cb902-16"></a>                            <span class="dt">fittedPredictedResponse =</span> mus,</span>
<span id="cb902-17"><a href="#cb902-17"></a>                            <span class="dt">integerResponse =</span> F)</span>
<span id="cb902-18"><a href="#cb902-18"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/gaussresid-1.png" alt="Diagnostic général des résidus simulés pour le modèle gaussien" width="100%" />
<p class="caption">
(#fig:gaussresid)Diagnostic général des résidus simulés pour le modèle gaussien
</p>
</div>
<p>Pour mieux cerner ce problème, nous pouvons dans un premier temps comparer la distribution originale des données et les simulations issues du modèle. La figure @ref(fig:gausssim) montre clairement que la distribution normale est mal ajustée aux données. Ces dernières sont légèrement asymétriques et ne peuvent pas être inférieures à zéro, ce que la distribution normale ne parvient pas à reproduire.</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="#cb903-1"></a>df &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(mat_sims[,<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>])</span>
<span id="cb903-2"><a href="#cb903-2"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb903-3"><a href="#cb903-3"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">data =</span> DataFinal2, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> VegPct, <span class="dt">y =</span> ..density..),</span>
<span id="cb903-4"><a href="#cb903-4"></a>                 <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">bins =</span> <span class="dv">50</span>)<span class="op">+</span></span>
<span id="cb903-5"><a href="#cb903-5"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">group =</span> Var2), </span>
<span id="cb903-6"><a href="#cb903-6"></a>               <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>), <span class="dt">fill =</span> <span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb903-7"><a href="#cb903-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Pourcentage de végétation dans l&#39;îlot (%)&quot;</span>,</span>
<span id="cb903-8"><a href="#cb903-8"></a>  <span class="dt">y =</span> <span class="st">&quot;Densité&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/gausssim-1.png" alt="Comparaison de la distribution originale de la variable et des simulations issues du modèle" width="75%" />
<p class="caption">
(#fig:gausssim)Comparaison de la distribution originale de la variable et des simulations issues du modèle
</p>
</div>
<p>Il est également possible de vérifier si la condition d’homogénéité de la variance s’applique bien aux données.</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="#cb904-1"></a><span class="co"># Extraction des prédictions du modèle</span></span>
<span id="cb904-2"><a href="#cb904-2"></a>mus &lt;-<span class="st"> </span><span class="kw">predict</span>(modele, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb904-3"><a href="#cb904-3"></a>sigma_model &lt;-<span class="st"> </span><span class="kw">sigma</span>(modele)</span>
<span id="cb904-4"><a href="#cb904-4"></a><span class="co"># Création d&#39;un DataFrame pour contenir les prédictions et les vraies valeurs</span></span>
<span id="cb904-5"><a href="#cb904-5"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb904-6"><a href="#cb904-6"></a>  <span class="dt">mus =</span> mus,</span>
<span id="cb904-7"><a href="#cb904-7"></a>  <span class="dt">reals =</span> DataFinal2<span class="op">$</span>VegPct</span>
<span id="cb904-8"><a href="#cb904-8"></a>)</span>
<span id="cb904-9"><a href="#cb904-9"></a><span class="co"># Calcul de l&#39;intervalle de confiance à 95 % selon la distribution normale</span></span>
<span id="cb904-10"><a href="#cb904-10"></a><span class="co"># et stockage dans un second DataFrame</span></span>
<span id="cb904-11"><a href="#cb904-11"></a>seqa &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>)</span>
<span id="cb904-12"><a href="#cb904-12"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb904-13"><a href="#cb904-13"></a>  <span class="dt">mus =</span> seqa,</span>
<span id="cb904-14"><a href="#cb904-14"></a>  <span class="dt">lower =</span> <span class="kw">qnorm</span>(<span class="dt">p =</span> <span class="fl">0.025</span>, <span class="dt">mean =</span> seqa, <span class="dt">sd =</span> sigma_model),</span>
<span id="cb904-15"><a href="#cb904-15"></a>  <span class="dt">upper =</span> <span class="kw">qnorm</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">mean =</span> seqa, <span class="dt">sd =</span> sigma_model)</span>
<span id="cb904-16"><a href="#cb904-16"></a>)</span>
<span id="cb904-17"><a href="#cb904-17"></a></span>
<span id="cb904-18"><a href="#cb904-18"></a><span class="co"># Affichage des valeurs réelles et prédites (en rouge)</span></span>
<span id="cb904-19"><a href="#cb904-19"></a><span class="co"># et de leur variance selon le modèle (en noir)</span></span>
<span id="cb904-20"><a href="#cb904-20"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb904-21"><a href="#cb904-21"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df1, </span>
<span id="cb904-22"><a href="#cb904-22"></a>             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> mus, <span class="dt">y =</span> reals),</span>
<span id="cb904-23"><a href="#cb904-23"></a>             <span class="dt">color =</span><span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb904-24"><a href="#cb904-24"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="dt">data =</span> df2,</span>
<span id="cb904-25"><a href="#cb904-25"></a>                <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> mus, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper),</span>
<span id="cb904-26"><a href="#cb904-26"></a>                <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb904-27"><a href="#cb904-27"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;valeurs prédites&#39;</span>,</span>
<span id="cb904-28"><a href="#cb904-28"></a>       <span class="dt">y =</span> <span class="st">&quot;valeurs réelles&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/gausssim2-1.png" alt="Comparaison de la distribution originale de la variable et des simulations issues du modèle" width="65%" />
<p class="caption">
(#fig:gausssim2)Comparaison de la distribution originale de la variable et des simulations issues du modèle
</p>
</div>
<p>À nouveau, nous constatons à la figure @ref(fig:gausssim2) que le modèle s’attendrait à trouver des valeurs négatives pour la concentration de végétation, ce qui n’est pas possible dans notre cas. En revanche, il semblerait que la variance soit bien homogène puisque la dispersion des observations semble suivre à peu près la dispersion attendue par le modèle (en noir).</p>
<p>Malgré ces différents constats indiquant clairement qu’un modèle gaussien est un choix sous-optimal pour ces données, nous allons poursuivre l’analyse de ce modèle.</p>
<p><strong>Vérification de la qualité d’ajustement</strong></p>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="#cb905-1"></a><span class="co"># Ajustement d&#39;un modèle nul</span></span>
<span id="cb905-2"><a href="#cb905-2"></a>modelenull &lt;-<span class="st"> </span><span class="kw">glm</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb905-3"><a href="#cb905-3"></a>                  <span class="dt">data =</span> DataFinal2, </span>
<span id="cb905-4"><a href="#cb905-4"></a>                  <span class="dt">family =</span> <span class="kw">gaussian</span>())</span>
<span id="cb905-5"><a href="#cb905-5"></a><span class="co"># Calcul des pseudo R2</span></span>
<span id="cb905-6"><a href="#cb905-6"></a><span class="kw">rsqs</span>(<span class="dt">loglike.full =</span> <span class="kw">logLik</span>(modele),</span>
<span id="cb905-7"><a href="#cb905-7"></a>     <span class="dt">loglike.null =</span> <span class="kw">logLik</span>(modelenull),</span>
<span id="cb905-8"><a href="#cb905-8"></a>     <span class="dt">full.deviance =</span> <span class="kw">deviance</span>(modele),</span>
<span id="cb905-9"><a href="#cb905-9"></a>     <span class="dt">null.deviance =</span> <span class="kw">deviance</span>(modelenull), </span>
<span id="cb905-10"><a href="#cb905-10"></a>     <span class="dt">nb.params =</span> modele<span class="op">$</span>rank,</span>
<span id="cb905-11"><a href="#cb905-11"></a>     <span class="dt">n =</span> <span class="kw">nrow</span>(DataFinal2)</span>
<span id="cb905-12"><a href="#cb905-12"></a>     )</span></code></pre></div>
<pre><code>## $`deviance expliquee`
## [1] 0.4706321
## 
## $`McFadden ajuste`
## &#39;log Lik.&#39; 0.07310662 (df=9)
## 
## $`Cox and Snell`
## &#39;log Lik.&#39; 0.4706321 (df=9)
## 
## $Nagelkerke
## &#39;log Lik.&#39; 0.4707122 (df=9)</code></pre>
<p>Le modèle parvient à expliquer 47 % de la déviance totale, mais obtient un R<sup>2</sup> ajusté de McFadden de seulement 0,07.</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="#cb907-1"></a><span class="co"># Calcul du RMSE</span></span>
<span id="cb907-2"><a href="#cb907-2"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>((<span class="kw">predict</span>(modele, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>) <span class="op">-</span><span class="st"> </span>DataFinal2<span class="op">$</span>VegPct)<span class="op">**</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 13.49885</code></pre>
<p>L’erreur quadratique moyenne et de 13,5 points de pourcentage, ce qui indique que le modèle a une assez faible capacité prédictive.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>L’ensemble des coefficients du modèle sont accessibles via la fonction <code>summary</code>; le tableau @ref(tab:tableaugauss) présente les résultats pour les coefficients du modèle.</p>
<table>
<caption>
(#tab:tableaugauss)Résultats du modèle gaussien
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coeff.
</th>
<th style="text-align:right;">
Err.std
</th>
<th style="text-align:right;">
Val.z
</th>
<th style="text-align:right;">
val.p
</th>
<th style="text-align:right;">
IC coeff 2,5 %
</th>
<th style="text-align:right;">
IC coeff 97,5 %
</th>
<th style="text-align:right;">
Sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
53,606
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
53,640
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
51,647
</td>
<td style="text-align:right;">
55,565
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 1
</td>
<td style="text-align:right;">
2,732
</td>
<td style="text-align:right;">
15,560
</td>
<td style="text-align:right;">
0,180
</td>
<td style="text-align:right;">
0,861
</td>
<td style="text-align:right;">
-27,772
</td>
<td style="text-align:right;">
33,237
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMedian ordre 2
</td>
<td style="text-align:right;">
-320,869
</td>
<td style="text-align:right;">
14,000
</td>
<td style="text-align:right;">
-22,910
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-348,318
</td>
<td style="text-align:right;">
-293,420
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
0,915
</td>
<td style="text-align:right;">
0,030
</td>
<td style="text-align:right;">
29,310
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,853
</td>
<td style="text-align:right;">
0,976
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,280
</td>
<td style="text-align:right;">
0,020
</td>
<td style="text-align:right;">
15,050
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,243
</td>
<td style="text-align:right;">
0,316
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,042
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-4,190
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-0,061
</td>
<td style="text-align:right;">
-0,022
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,340
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-30,940
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-0,362
</td>
<td style="text-align:right;">
-0,318
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table>
<p>Les résultats de la régression linéaire multiple avaient déjà été interprétés dans la section @ref(sect0771), nous ne commenterons pas ici les résultats du modèle GLM gaussien qui sont identiques.</p>
</div>
</div>
<div id="sect0852" class="section level3">
<h3><span class="header-section-number">8.4.2</span> Modèle GLM avec une distribution de Student</h3>
<p>Pour rappel, la distribution de Student ressemble à une distribution normale (section @ref(sect024311)). Elle est symétrique autour de sa moyenne et a également une forme de cloche. Cependant, elle dispose de queues lourdes, ce qui signifie qu’elle permet de représenter des phénomènes présentant davantage de valeurs extrêmes qu’une distribution normale. Pour contrôler le poids des queues, la distribution de Student intègre un troisième paramètre : <span class="math inline">\(\nu\)</span> (nu). Lorsque <span class="math inline">\(\nu\)</span> tends vers l’infini, la distribution de Student tend vers une distribution normale (figure @ref(fig:studentdistrib)).</p>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/studentdistrib-1.png" alt="Effet du paramètre nu sur une distribution de Stundent" width="65%" />
<p class="caption">
(#fig:studentdistrib)Effet du paramètre nu sur une distribution de Stundent
</p>
</div>
<p>Comme vous pouvez le constater dans la carte d’identité au tableau @ref(tab:studentdentity), le modèle GLM de Student est très proche du modèle GLM gaussien. Nous modélisons explicitement la moyenne de la distribution et son paramètre de dispersion (variance) est laissé fixe. Ce GLM est même souvent utilisé comme une version « robuste » du modèle gaussien du fait de sa capacité à intégrer explicitement l’effet des observations extrêmes. En effet, dans un modèle gaussien, les observations extrêmes (aussi appelées observations aberrantes) vont davantage influencer les paramètres du modèle que pour un modèle utilisant une distribution de Student.</p>
<table>
<caption>
(#tab:studentdentity)Carte d’identité du modèle de Student
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable continue dans l’intervalle <span class="math inline">\(]-\infty ; + \infty[\)</span>
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Student
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim Student(\mu,\sigma,\nu)\)</span> <br/> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <br/> <span class="math inline">\(g(x) = x\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
identitaire
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
<span class="math inline">\(\mu\)</span>
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\sigma\)</span> et <span class="math inline">\(\nu\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
Homoscédasticité
</td>
</tr>
</tbody>
</table>
<div id="conditions-dapplication-5" class="section level4">
<h4><span class="header-section-number">8.4.2.1</span> Conditions d’application</h4>
<p>Les conditions d’application sont les mêmes que pour un modèle GLM gaussien, à ceci prêt que ce modèle utilisant la distribution de Student est moins sensible aux observations extrêmes.</p>
</div>
<div id="interprétation-des-paramètres-5" class="section level4">
<h4><span class="header-section-number">8.4.2.2</span> Interprétation des paramètres</h4>
<p>L’interprétation des paramètres est la même que pour un modèle gaussien puisque l’on modélise la moyenne de la distribution et que la fonction de lien est la fonction identitaire. Le seul paramètre supplémentaire est <span class="math inline">\(\nu\)</span> qui n’a en soit aucune interprétation pratique. Notez simplement que si <span class="math inline">\(\nu\)</span> est supérieur à 30, un simple modèle GLM gaussien serait sûrement suffisant.</p>
</div>
<div id="exemple-appliqué-dans-r-6" class="section level4">
<h4><span class="header-section-number">8.4.2.3</span> Exemple appliqué dans R</h4>
<p>Nous proposons ici de simplement réajuster le modèle gaussien présenté dans la section précédente en utilisant une distribution de Student. Nous utilisons pour cela la fonction <code>gam</code> du <em>package</em> <code>mgcv</code> avec le paramètre <code>family=scat</code> pour utiliser une distribution de Student. Les valeurs de VIF ont déjà été calculées dans l’exemple précédent, nous pouvons donc passer directement au calcul des distances de Cook.</p>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb909-1"><a href="#cb909-1"></a><span class="co"># Chargement des données</span></span>
<span id="cb909-2"><a href="#cb909-2"></a><span class="kw">load</span>(<span class="st">&quot;data/lm/DataVegetation.RData&quot;</span>)</span>
<span id="cb909-3"><a href="#cb909-3"></a><span class="co"># Ajustement du modèle</span></span>
<span id="cb909-4"><a href="#cb909-4"></a>modele &lt;-<span class="st"> </span><span class="kw">gam</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb909-5"><a href="#cb909-5"></a><span class="st">                       </span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal,</span>
<span id="cb909-6"><a href="#cb909-6"></a>              <span class="dt">family =</span> scat)</span>
<span id="cb909-7"><a href="#cb909-7"></a></span>
<span id="cb909-8"><a href="#cb909-8"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb909-9"><a href="#cb909-9"></a>cooksd &lt;-<span class="st"> </span><span class="kw">cooks.distance</span>(modele)</span>
<span id="cb909-10"><a href="#cb909-10"></a><span class="co"># Affichage des valeurs</span></span>
<span id="cb909-11"><a href="#cb909-11"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb909-12"><a href="#cb909-12"></a>  <span class="dt">cook =</span> cooksd,</span>
<span id="cb909-13"><a href="#cb909-13"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cooksd)</span>
<span id="cb909-14"><a href="#cb909-14"></a>)</span>
<span id="cb909-15"><a href="#cb909-15"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb909-16"><a href="#cb909-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cook), <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.7</span>), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb909-17"><a href="#cb909-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;distance de Cook&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/stucookdist-1.png" alt="Distances de Cook pour un modèle GLM avec une distribution de Student" width="50%" />
<p class="caption">
(#fig:stucookdist)Distances de Cook pour un modèle GLM avec une distribution de Student
</p>
</div>
<p>Nous retrouvons les quatre observations avec des distances de Cook très fortes que nous avions identifiées dans le modèle gaussien. Nous décidons donc de les enlever pour les mêmes raisons que précédemment.</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="#cb910-1"></a><span class="co"># Chargement des données</span></span>
<span id="cb910-2"><a href="#cb910-2"></a>DataFinal2 &lt;-<span class="st"> </span><span class="kw">subset</span>(DataFinal, cooksd<span class="op">&lt;</span><span class="fl">0.1</span>)</span>
<span id="cb910-3"><a href="#cb910-3"></a><span class="co"># Ajustement du modèle</span></span>
<span id="cb910-4"><a href="#cb910-4"></a>modele &lt;-<span class="st"> </span><span class="kw">gam</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb910-5"><a href="#cb910-5"></a><span class="st">                       </span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal2,</span>
<span id="cb910-6"><a href="#cb910-6"></a>              <span class="dt">family =</span> scat)</span>
<span id="cb910-7"><a href="#cb910-7"></a></span>
<span id="cb910-8"><a href="#cb910-8"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb910-9"><a href="#cb910-9"></a>cooksd &lt;-<span class="st"> </span><span class="kw">cooks.distance</span>(modele)</span>
<span id="cb910-10"><a href="#cb910-10"></a><span class="co"># Affichage des valeurs</span></span>
<span id="cb910-11"><a href="#cb910-11"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb910-12"><a href="#cb910-12"></a>  <span class="dt">cook =</span> cooksd,</span>
<span id="cb910-13"><a href="#cb910-13"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cooksd)</span>
<span id="cb910-14"><a href="#cb910-14"></a>)</span>
<span id="cb910-15"><a href="#cb910-15"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb910-16"><a href="#cb910-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cook), <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.7</span>), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb910-17"><a href="#cb910-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;distance de Cook&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/stucookdist2-1.png" alt="Distances de Cook pour un modèle GLM avec une distribution de Student après suppression des valeurs fortement influentes" width="50%" />
<p class="caption">
(#fig:stucookdist2)Distances de Cook pour un modèle GLM avec une distribution de Student après suppression des valeurs fortement influentes
</p>
</div>
<p>Nous pouvons à présent vérifier si les résidus simulés se comportent tel qu’attendu.</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb911-1"><a href="#cb911-1"></a><span class="co"># Extraction des prédictions du modèle</span></span>
<span id="cb911-2"><a href="#cb911-2"></a>mus &lt;-<span class="st"> </span><span class="kw">predict</span>(modele, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>)</span>
<span id="cb911-3"><a href="#cb911-3"></a><span class="co"># Affichage des paramètres nu et sigma</span></span>
<span id="cb911-4"><a href="#cb911-4"></a>modele<span class="op">$</span>family<span class="op">$</span>family</span></code></pre></div>
<pre><code>## [1] &quot;Scaled t(6.333,11.281)&quot;</code></pre>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="#cb913-1"></a>sigma_model &lt;-<span class="st"> </span><span class="fl">11.281</span></span>
<span id="cb913-2"><a href="#cb913-2"></a>nu_model &lt;-<span class="st"> </span><span class="fl">6.333</span></span>
<span id="cb913-3"><a href="#cb913-3"></a><span class="kw">library</span>(LaplacesDemon) <span class="co"># pour simuler des données d&#39;une distribution de Student</span></span>
<span id="cb913-4"><a href="#cb913-4"></a><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span id="cb913-5"><a href="#cb913-5"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb913-6"><a href="#cb913-6"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(mus),<span class="cf">function</span>(i){</span>
<span id="cb913-7"><a href="#cb913-7"></a>  mu &lt;-<span class="st"> </span>mus[[i]]</span>
<span id="cb913-8"><a href="#cb913-8"></a>  sims &lt;-<span class="st"> </span><span class="kw">rst</span>(nsim, <span class="dt">mu=</span>mu, <span class="dt">sigma =</span> sigma_model, <span class="dt">nu =</span> nu_model)</span>
<span id="cb913-9"><a href="#cb913-9"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb913-10"><a href="#cb913-10"></a>})</span>
<span id="cb913-11"><a href="#cb913-11"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb913-12"><a href="#cb913-12"></a><span class="co"># Calculer les résidus simulés</span></span>
<span id="cb913-13"><a href="#cb913-13"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> mat_sims, </span>
<span id="cb913-14"><a href="#cb913-14"></a>                            <span class="dt">observedResponse =</span> DataFinal2<span class="op">$</span>VegPct,</span>
<span id="cb913-15"><a href="#cb913-15"></a>                            <span class="dt">fittedPredictedResponse =</span> mus,</span>
<span id="cb913-16"><a href="#cb913-16"></a>                            <span class="dt">integerResponse =</span> F)</span>
<span id="cb913-17"><a href="#cb913-17"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/studentresid-1.png" alt="Diagnostic général des résidus simulés pour le GLM avec distribution de Student" width="100%" />
<p class="caption">
(#fig:studentresid)Diagnostic général des résidus simulés pour le GLM avec distribution de Student
</p>
</div>
<p>Il semble que nous obtenions des résultats similaires à ceux du modèle gaussien: les résidus divergent significativement d’une distribution uniforme (figure @ref(fig:studentresid)). Le graphique quantile-quantile n’est parfois pas très adapté pour discerner une déviation de la distribution uniforme, nous pouvons dans ce cas afficher un histogramme des résidus pour en avoir le coeur net (figure @ref(fig:studentresid2)).</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="#cb914-1"></a><span class="kw">ggplot</span>()<span class="op">+</span></span>
<span id="cb914-2"><a href="#cb914-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">residuals</span>(sim_res)), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb914-3"><a href="#cb914-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;effectifs&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;résidus simulés&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/studentresid2-1.png" alt="Distribution des résidus simulés du modèle GLM avec distribution de Student" width="95%" />
<p class="caption">
(#fig:studentresid2)Distribution des résidus simulés du modèle GLM avec distribution de Student
</p>
</div>
<p>Pour cet exercice, il est intéressant de comparer les formes des simulations issues du modèle gaussien et du modèle de Student pour bien distinguer la différence entre les deux.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/studentresid3-1.png" alt="Simulations issues des modèles gaussien et Student, comparées aux données originales" width="95%" />
<p class="caption">
(#fig:studentresid3)Simulations issues des modèles gaussien et Student, comparées aux données originales
</p>
</div>
<p>Nous constatons ainsi que la différence entre les deux modèles est ici très mince, voire inexistante. Le seul élément que nous pouvons noter est que le modèle de Student à une courbe (une queue de distribution) moins aplatie vers la droite. Cela lui permettrait de mieux tenir compte de cas extrêmes avec de fortes densités de végétation (ce qui concerne donc très peu d’observations puisque cette variable a un maximum de 100).</p>
<p>Pour déterminer si le modèle de Student est plus pertinent à retenir que le modèle gaussien, nous pouvons ajuster un second modèle de Student pour lequel nous forçons artificiellement <span class="math inline">\(\nu\)</span> à être très élevé. Pour rappel, quand <span class="math inline">\(\nu\)</span> tend vers l’infini, la distribution de Student tend vers une distribution normale. Nous forçons ici <span class="math inline">\(\nu\)</span> à être supérieur à 100 pour créer un second modèle de Student se comportant quasiment comme un modèle gaussien et calculons les AIC des deux modèles.</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="#cb915-1"></a><span class="co"># Calcul d&#39;un modèle de Student identitique à un modèle gaussien</span></span>
<span id="cb915-2"><a href="#cb915-2"></a>modele2 &lt;-<span class="st"> </span><span class="kw">gam</span>(VegPct <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(HABHA)<span class="op">+</span><span class="kw">poly</span>(AgeMedian,<span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb915-3"><a href="#cb915-3"></a><span class="st">                   </span>Pct_<span class="dv">014</span><span class="op">+</span>Pct_65P<span class="op">+</span>Pct_MV<span class="op">+</span>Pct_FR, <span class="dt">data =</span> DataFinal2,</span>
<span id="cb915-4"><a href="#cb915-4"></a>               <span class="dt">family =</span> <span class="kw">scat</span>(<span class="dt">min.df =</span> <span class="dv">100</span>))</span>
<span id="cb915-5"><a href="#cb915-5"></a><span class="co"># Calcul des deux AIC</span></span>
<span id="cb915-6"><a href="#cb915-6"></a><span class="kw">AIC</span>(modele)</span></code></pre></div>
<pre><code>## [1] 81771.92</code></pre>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb917-1"><a href="#cb917-1"></a><span class="kw">AIC</span>(modele2)</span></code></pre></div>
<pre><code>## [1] 82057.79</code></pre>
<p>Le second AIC (modèle gaussien) est plus élevé, indiquant que le modèle est moins bien ajusté aux données. Dans le cas présent, il est plus pertinent de retenir le modèle de Student même si les écarts entre ces deux modèles sont minimes. Ce résultat n’est pas surprenant puisque la variable <em>Y</em> (pourcentage de végétation dans les îlots de l’île de Montréal) est relativement compacte et comporte peu / pas de valeurs pouvant être qualifiées de valeurs extrêmes.</p>
<p>Nous ne détaillons pas ici l’interprétation des coefficients du modèle (présentés au tableau @ref(tab:glmstudentres)) puisqu’ils s’interprètent de la même façon qu’un modèle GLM et qu’un modèle de régression linéaire multiple.</p>
<table>
<caption>
(#tab:glmstudentres)Résultats du modèle Student
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coeff.
</th>
<th style="text-align:right;">
Err.std
</th>
<th style="text-align:right;">
Val.z
</th>
<th style="text-align:right;">
val.p
</th>
<th style="text-align:right;">
IC coeff 2,5 %
</th>
<th style="text-align:right;">
IC coeff 97,5 %
</th>
<th style="text-align:right;">
Sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
65,096
</td>
<td style="text-align:right;">
0,940
</td>
<td style="text-align:right;">
69,110
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
63,250
</td>
<td style="text-align:right;">
66,943
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
log(HABHA)
</td>
<td style="text-align:right;">
-9,502
</td>
<td style="text-align:right;">
0,160
</td>
<td style="text-align:right;">
-60,160
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-9,811
</td>
<td style="text-align:right;">
-9,192
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_014
</td>
<td style="text-align:right;">
0,866
</td>
<td style="text-align:right;">
0,030
</td>
<td style="text-align:right;">
29,450
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,808
</td>
<td style="text-align:right;">
0,924
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65P
</td>
<td style="text-align:right;">
0,237
</td>
<td style="text-align:right;">
0,020
</td>
<td style="text-align:right;">
13,540
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,203
</td>
<td style="text-align:right;">
0,272
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_MV
</td>
<td style="text-align:right;">
-0,015
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-1,650
</td>
<td style="text-align:right;">
0,099
</td>
<td style="text-align:right;">
-0,034
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_FR
</td>
<td style="text-align:right;">
-0,301
</td>
<td style="text-align:right;">
0,010
</td>
<td style="text-align:right;">
-29,040
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
-0,321
</td>
<td style="text-align:right;">
-0,280
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="sect0853" class="section level3">
<h3><span class="header-section-number">8.4.3</span> Modèle GLM avec distribution Gamma</h3>
<p>Pour rappel, la distribution Gamma est strictement positive (<span class="math inline">\([0;+\infty[\)</span>), asymétrique, et a une variance proportionnelle à sa moyenne (hétéroscedastique). Dans la section sur les distributions, nous avions vu que la distribution Gamma (section @ref(sect024315)) est formulée avec deux paramètres : sa forme (<span class="math inline">\(\alpha\)</span> ou <em>shape</em>) et son échelle (<span class="math inline">\(b\)</span> ou <em>scale</em>). Ces deux paramètres n’ont pas une interprétation intuitive, mais il est possible avec un peu de jonglage mathématique d’arriver à une reparamétrisation intéressante. Cela est détaillé dans l’encadré ci-dessous; notez toutefois qu’il n’est pas nécessaire de maîtriser le contenu de cet encadré pour lire la suite de cette section sur les modèles GLM avec une distribution Gamma.</p>
<div class="bloc_aller_loin">
<p><strong>Reparamétrisation d’une distribution Gamma pour un GLM</strong></p>
<p>Si nous disposons d’une variable <em>Y</em>, suivant une distribution Gamma telle que <span class="math inline">\(Y \sim Gamma(\alpha,b)\)</span> avec <span class="math inline">\(\alpha\)</span> le paramètre de forme et <span class="math inline">\(b\)</span> le paramètre d’échelle, alors, l’espérance et la variance de <em>Y</em> peuvent être définies comme suit :</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;E(Y) = \alpha \times b \\
&amp;Var(Y) = \alpha \times b^2\\
\end{aligned}
(\#eq:glm18)
\end{equation}\]</span>
</p>
<p>En d’autres termes, l’espérance (l’équivalent de la moyenne pour une distribution normale) de notre variable <em>Y</em> est égale au produit des paramètres de forme et d’échelle.</p>
<p>Avec ces propriétés, il est possible de redéfinir la fonction de densité de la distribution Gamma et d’arriver à une nouvelle formulation : <span class="math inline">\(Y \sim Gamma(\mu,\alpha)\)</span>. <span class="math inline">\(\mu\)</span> est donc l’espérance de <em>Y</em> (interprétable comme sa moyenne, soit sa valeur attendue) et <span class="math inline">\(\alpha\)</span> permet de capturer la dispersion de la distribution Gamma. Par extension des relations présentées ci-dessus, il est alors possible de reformuler la variance en fonction de <span class="math inline">\(\mu\)</span> et <span class="math inline">\(\alpha\)</span>.</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Var(Y) = \alpha \times b^2\\
&amp;\mu = \alpha \times b \text{ soit }b = \frac{\mu}{a}\\
&amp;Var(Y) = \alpha \times (\frac{\mu}{\alpha})^2 \text{ soit } Var(Y) = \frac{\mu^2}{\alpha}\\
\end{aligned}
(\#eq:glm19)
\end{equation}\]</span>
</p>
<p>Nous observons donc que la variance dans un modèle Gamma augmente de façon quadratique avec la moyenne, mais est tempérée par le paramètre de forme. Nous en concluons qu’un paramètre de forme plus grand produira une distribution moins étalée.</p>
<p>Dans ce contexte, <span class="math inline">\(\mu\)</span> doit être strictement positif : la valeur attendue moyenne d’une distribution Gamma doit être positive par définition puisqu’une distribution Gamma ne peut pas produire de valeurs négatives. Il est donc logique d’utiliser la fonction logarithmique comme fonction de lien, puisque sa contrepartie (la fonction exponentielle) ne produit que des résultats positifs.</p>
</div>
<p>Pour résumer, nous nous retrouvons donc avec un modèle qui prédit, sur une échelle logarithmique, l’espérance (~moyenne) d’une distribution Gamma. Notez qu’il existe d’autres façons de spécifier un modèle GLM avec une distribution Gamma, mais celle-ci est la plus intuitive.</p>
<table>
<caption>
(#tab:gammadentity)Carte d’identité du modèle Gamma
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable continue dans l’intervalle <span class="math inline">\(]0 ; + \infty[\)</span>
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Gamma
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim Gamma(\mu,\alpha)\)</span> <br/> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <br/> <span class="math inline">\(g(x) = log(x)\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
log
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
<span class="math inline">\(\mu\)</span>
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>, et <span class="math inline">\(\alpha\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
<span class="math inline">\(Variance = \frac{\mu^2}{\alpha}\)</span>
</td>
</tr>
</tbody>
</table>
<div id="interprétation-des-paramètres-6" class="section level4">
<h4><span class="header-section-number">8.4.3.1</span> Interprétation des paramètres</h4>
<p>Puisque le modèle utilise la fonction de lien <em>log</em>, alors les coefficients <span class="math inline">\(\beta\)</span> expriment l’augmentation de l’espérance (la valeur attendue de <em>Y</em>, ce qui est proche de l’idée de moyenne) de la variable Y sur une échelle logarithmique (comme dans un modèle de Poisson). Il est possible de convertir les coefficients dans l’échelle originale de la variable <em>Y</em> en utilisant la fonction exponentielle (l’inverse de la fonction <em>log</em>), mais ces coefficients représentent alors des effets multiplicatifs et non des effets additifs.
Prenons un exemple, admettons que le coefficient <span class="math inline">\(\beta_1\)</span>, associé à la variable <span class="math inline">\(X_1\)</span> soit de 1,5. Cela signifie qu’une augmentation d’une unité de <span class="math inline">\(X_1\)</span>, augmente le log de l’espérance de <em>Y</em> de 1,5 unité. L’exponentielle du coefficient est 4,48, ce qui signifie qu’une augmentation d’une unité entraîne une multiplication par 4,48 de la valeur attendue de <em>Y</em> (l’espérance de <em>Y</em>). Le paramètre de forme (<span class="math inline">\(\alpha\)</span>) n’a pas d’interprétation pratique, bien qu’il soit utilisé dans les différents tests des conditions d’application du modèle et dans le calcul de sa déviance.</p>
</div>
<div id="conditions-dapplication-6" class="section level4">
<h4><span class="header-section-number">8.4.3.2</span> Conditions d’application</h4>
<p>Dans un modèle GLM gaussien, la variance est capturée par un paramètre <span class="math inline">\(\sigma\)</span> et est constante, produisant la condition d’homoscédasticité des résidus. Dans un modèle Gamma, la variance varie en fonction de l’espérance et du paramètre de forme selon la relation : <span class="math inline">\(Var(Y) = \frac{E(Y)^2}{\alpha}\)</span>. Les résidus sont donc par nature hétéroscédastiques dans un modèle Gamma et doivent suivre cette relation.</p>
</div>
<div id="exemple-appliqué-dans-r-7" class="section level4">
<h4><span class="header-section-number">8.4.3.3</span> Exemple appliqué dans R</h4>
<p>Pour cet exemple, nous nous intéressons à la durée de déplacements en milieu urbain. Ce type d’analyse permet notamment de mieux comprendre les habitudes de déplacement de la population et d’orienter les politiques de transport. Plusieurs travaux concluent que les durées de déplacement en milieu urbain varient en fonction du motif du déplacement, du mode de transport utilisé, des caractéristiques socio-économiques de l’individu, et des caractéristiques du trajet lui-même <span class="citation">(Anastasopoulos et al. <a href="#ref-anastasopoulos2012analysis" role="doc-biblioref">2012</a>; Frank et al. <a href="#ref-frank2008urban" role="doc-biblioref">2008</a>)</span>. Nous modélisons ici la durée en minute d’un ensemble de déplacements effectués par des Montréalais en 2017 et enregistré avec l’application MTL Trajet proposée par la ville de Montréal. Ces données sont disponibles sur le site web des <a href="http://donnees.ville.montreal.qc.ca/dataset/mtl-trajet">données ouvertes de Montréal</a> et son anonymisées. Nous ne disposons donc d’aucune information au niveau individuel. Compte tenu du très grand nombre d’observations (plus de 185 000), nous avons dû effectuer quelques opérations de tri et nous avons ainsi supprimé:</p>
<ul>
<li>les trajets utilisant de multiples modes de transport (sauf en combinaison avec la marche à pied, par exemple, un trajet effectué à pied et en transport en commun a été recatégorisé comme un trajet en transport en commun uniquement). Les déplacements multimodaux se distinguent largement des déplacements unimodaux dans la littérature scientifique;</li>
<li>les trajets de nuit (seuls les trajets démarrant entre 7 h et 21 h ont été conservés);</li>
<li>les trajets dont le point de départ est un arrondissement / municipalité pour lequel moins de 150 trajets ont été enregistrés (trop peu d’observations)</li>
<li>les trajets de plus de deux heures (cas rares, considérés comme des données aberrantes);</li>
<li>les trajets dont le point de départ est à moins de 100 mètres du point d’arrivée (formant des boucles plutôt que des déplacements).</li>
</ul>
<p>Nous arrivons ainsi à un total de 24 969 observations. Pour modéliser ces durées de déplacement, nous utilisons les variables indépendantes présentées dans le tableau @ref(tab:variablegamma).</p>
<table>
<caption>
(#tab:variablegamma)Variables indépendantes utilisées dans le modèle Gamma
</caption>
<thead>
<tr>
<th style="text-align:left;">
Nom de la variable
</th>
<th style="text-align:left;">
Signification
</th>
<th style="text-align:left;">
Type de variable
</th>
<th style="text-align:left;">
Mesure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mode
</td>
<td style="text-align:left;">
Mode de déplacement
</td>
<td style="text-align:left;">
Variable catégorielle
</td>
<td style="text-align:left;">
Transport collectif; piéton; vélo et véhicule individuel
</td>
</tr>
<tr>
<td style="text-align:left;">
Motif
</td>
<td style="text-align:left;">
Motif du déplacement
</td>
<td style="text-align:left;">
Variable catégorielle
</td>
<td style="text-align:left;">
Travail; loisir; magasinage et éducation
</td>
</tr>
<tr>
<td style="text-align:left;">
HeureDep
</td>
<td style="text-align:left;">
Heure de départ
</td>
<td style="text-align:left;">
Variable catégorielle
</td>
<td style="text-align:left;">
De 7 h à 21 h
</td>
</tr>
<tr>
<td style="text-align:left;">
ArrondDep
</td>
<td style="text-align:left;">
Arrondissement de départ
</td>
<td style="text-align:left;">
Variable catégorielle
</td>
<td style="text-align:left;">
Nom de l’arrondissement dont part le trajet
</td>
</tr>
<tr>
<td style="text-align:left;">
LogDist
</td>
<td style="text-align:left;">
Logarithme de la distance à vol d’oiseau en km
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Logarithme de la distance à vol d’oiseau en km entre le point de départ et d’arrivée
</td>
</tr>
<tr>
<td style="text-align:left;">
MemeArrond
</td>
<td style="text-align:left;">
L’arrivée du trajet du trajet se situe-t-elle dans le même arrondissement que le départ?
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
Oui ou non
</td>
</tr>
<tr>
<td style="text-align:left;">
Semaine
</td>
<td style="text-align:left;">
Le trajet a-t-il été effectué en semaine ou en fin de semaine?
</td>
<td style="text-align:left;">
Variable binaire
</td>
<td style="text-align:left;">
Semaine ou fin de semaine
</td>
</tr>
</tbody>
</table>
<p>Les temps de trajet forment une variable strictement positive et très vraisemblablement asymétrique. En effet, nous nous attendons à observer une certaine concentration de valeurs autour d’une moyenne, et davantage de trajets avec de courtes durées que de trajets avec de longues durées. Pour nous en assurer, réalisons un histogramme de la distribution de notre variable <em>Y</em> et comparons la avec des distributions normale et Gamma.</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="#cb919-1"></a><span class="co"># Chargement des données</span></span>
<span id="cb919-2"><a href="#cb919-2"></a>dataset &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/glm/DureeTrajets.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb919-3"><a href="#cb919-3"></a>arrondMTL &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mercier-Hochelaga-Maisonneuve&quot;</span>, <span class="st">&quot;Villeray-Saint-Michel-Parc-Extension&quot;</span>, </span>
<span id="cb919-4"><a href="#cb919-4"></a>               <span class="st">&quot;Ville-Marie&quot;</span>, <span class="st">&quot;Verdun&quot;</span>, <span class="st">&quot;Saint-Leonard&quot;</span>, <span class="st">&quot;Saint-Laurent&quot;</span>, </span>
<span id="cb919-5"><a href="#cb919-5"></a>               <span class="st">&quot;Rosemont-La Petite-Patrie&quot;</span>, <span class="st">&quot;Riviere-des-Prairies-Pointe-aux-Trembles&quot;</span>, </span>
<span id="cb919-6"><a href="#cb919-6"></a>               <span class="st">&quot;Pierrefonds-Roxboro&quot;</span>, <span class="st">&quot;Outremont&quot;</span>, <span class="st">&quot;Montreal-Nord&quot;</span>, <span class="st">&quot;Le Sud-Ouest&quot;</span>, </span>
<span id="cb919-7"><a href="#cb919-7"></a>               <span class="st">&quot;Le Plateau-Mont-Royal&quot;</span>, <span class="st">&quot;Lachine&quot;</span> , <span class="st">&quot;Ahuntsic-Cartierville&quot;</span>,</span>
<span id="cb919-8"><a href="#cb919-8"></a>               <span class="st">&quot;Anjou&quot;</span> ,<span class="st">&quot;Cote-des-Neiges-Notre-Dame-de-Grace&quot;</span>, <span class="st">&quot;LaSalle&quot;</span>  </span>
<span id="cb919-9"><a href="#cb919-9"></a>)</span>
<span id="cb919-10"><a href="#cb919-10"></a>dataset &lt;-<span class="st"> </span><span class="kw">subset</span>(dataset,dataset<span class="op">$</span>ArrondDep <span class="op">%in%</span><span class="st"> </span>arrondMTL)</span>
<span id="cb919-11"><a href="#cb919-11"></a><span class="co"># Définissons 7 h du matin comme la référence pour la variable Heure de départ</span></span>
<span id="cb919-12"><a href="#cb919-12"></a>dataset<span class="op">$</span>HeureDep &lt;-<span class="st"> </span><span class="kw">relevel</span>(</span>
<span id="cb919-13"><a href="#cb919-13"></a>  <span class="kw">factor</span>(dataset<span class="op">$</span>HeureDep, <span class="dt">levels =</span> <span class="kw">as.character</span>(<span class="dv">7</span><span class="op">:</span><span class="dv">21</span>)),</span>
<span id="cb919-14"><a href="#cb919-14"></a>  <span class="dt">ref =</span> <span class="st">&quot;7&quot;</span>)</span>
<span id="cb919-15"><a href="#cb919-15"></a><span class="co"># Comparaison de la distribution originale avec une distribution </span></span>
<span id="cb919-16"><a href="#cb919-16"></a><span class="co"># normale et une distribution Gamma</span></span>
<span id="cb919-17"><a href="#cb919-17"></a><span class="kw">library</span>(fitdistrplus)</span>
<span id="cb919-18"><a href="#cb919-18"></a>model_gamma &lt;-<span class="st"> </span><span class="kw">fitdist</span>(dataset<span class="op">$</span>Duree, <span class="dt">distr =</span> <span class="st">&quot;gamma&quot;</span>)</span>
<span id="cb919-19"><a href="#cb919-19"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dataset) <span class="op">+</span><span class="st"> </span></span>
<span id="cb919-20"><a href="#cb919-20"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Duree, <span class="dt">y =</span> ..density..), <span class="dt">bins =</span> <span class="dv">40</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>)<span class="op">+</span></span>
<span id="cb919-21"><a href="#cb919-21"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dgamma, <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="fl">0.8</span>, </span>
<span id="cb919-22"><a href="#cb919-22"></a>                <span class="dt">args =</span> <span class="kw">as.list</span>(model_gamma<span class="op">$</span>estimate))<span class="op">+</span></span>
<span id="cb919-23"><a href="#cb919-23"></a><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">size =</span> <span class="fl">0.8</span>, </span>
<span id="cb919-24"><a href="#cb919-24"></a>                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>Duree), </span>
<span id="cb919-25"><a href="#cb919-25"></a>                            <span class="dt">sd =</span> <span class="kw">sd</span>(dataset<span class="op">$</span>Duree)))<span class="op">+</span></span>
<span id="cb919-26"><a href="#cb919-26"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Temps de déplacement (minutes)&#39;</span>,</span>
<span id="cb919-27"><a href="#cb919-27"></a>       <span class="dt">y =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb919-28"><a href="#cb919-28"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;modèles Gamma et gaussien&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/gammadatadistrib-1.png" alt="Distribution des temps de trajets diurnes à Montréal" width="50%" />
<p class="caption">
(#fig:gammadatadistrib)Distribution des temps de trajets diurnes à Montréal
</p>
</div>
<p>La figure @ref(fig:gammadatadistrib) permet de constater l’asymétrie de la distribution des temps de trajets et qu’un modèle Gamma (ligne rouge) a plus de chance d’être adapté aux données qu’un modèle gaussien (ligne bleue).</p>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Comme pour les modèles précédents, nous commençons par la vérification de l’absence de multicolinéarité.</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="#cb920-1"></a><span class="co">## Calcul du VIF</span></span>
<span id="cb920-2"><a href="#cb920-2"></a><span class="kw">vif</span>(<span class="kw">glm</span>(Duree <span class="op">~</span><span class="st"> </span>Mode <span class="op">+</span><span class="st"> </span>Motif <span class="op">+</span><span class="st"> </span>HeureDep <span class="op">+</span><span class="st"> </span>LogDist <span class="op">+</span></span>
<span id="cb920-3"><a href="#cb920-3"></a><span class="st">          </span>ArrondDep <span class="op">+</span><span class="st"> </span>MemeArrond <span class="op">+</span><span class="st"> </span>Jour,</span>
<span id="cb920-4"><a href="#cb920-4"></a>        <span class="dt">data =</span> dataset,</span>
<span id="cb920-5"><a href="#cb920-5"></a>        <span class="dt">family =</span> <span class="kw">Gamma</span>(<span class="dt">link=</span><span class="st">&quot;log&quot;</span>)))</span></code></pre></div>
<pre><code>##                GVIF Df GVIF^(1/(2*Df))
## Mode       2.103392  3        1.131931
## Motif      1.934997  3        1.116298
## HeureDep   1.791009 14        1.021032
## LogDist    2.665998  1        1.632789
## ArrondDep  1.439499 17        1.010772
## MemeArrond 2.151113  1        1.466667
## Jour       1.330091  6        1.024055</code></pre>
<p>L’ensemble des valeurs de VIF sont inférieures à trois, indiquant donc l’absence de multicolinéarité excessive. Nous pouvons donc ajuster une première version du modèle (ici avec le <em>package</em> <code>VGAM</code> et la fonction <code>vglm</code>) et calculer les distances de Cook.</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="#cb922-1"></a><span class="co"># Calcul du modèle avec VGAM</span></span>
<span id="cb922-2"><a href="#cb922-2"></a>modele &lt;-<span class="st"> </span><span class="kw">vglm</span>(Duree <span class="op">~</span><span class="st"> </span>Mode <span class="op">+</span><span class="st"> </span>Motif <span class="op">+</span><span class="st"> </span>HeureDep <span class="op">+</span><span class="st"> </span>LogDist <span class="op">+</span></span>
<span id="cb922-3"><a href="#cb922-3"></a><span class="st">                 </span>ArrondDep<span class="op">+</span><span class="st"> </span>MemeArrond <span class="op">+</span><span class="st"> </span>Semaine,</span>
<span id="cb922-4"><a href="#cb922-4"></a>               <span class="dt">data =</span> dataset,</span>
<span id="cb922-5"><a href="#cb922-5"></a>               <span class="dt">family=</span><span class="kw">gamma2</span>(<span class="dt">lmu =</span> <span class="st">&quot;loglink&quot;</span>))</span>
<span id="cb922-6"><a href="#cb922-6"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb922-7"><a href="#cb922-7"></a>hats &lt;-<span class="st"> </span><span class="kw">hatvaluesvlm</span>(modele)[,<span class="dv">1</span>]</span>
<span id="cb922-8"><a href="#cb922-8"></a>res &lt;-<span class="st"> </span><span class="kw">residuals</span>(modele,<span class="dt">type =</span> <span class="st">&quot;pearson&quot;</span>)[,<span class="dv">1</span>]</span>
<span id="cb922-9"><a href="#cb922-9"></a>disp &lt;-<span class="st"> </span>modele<span class="op">@</span>coefficients[[<span class="dv">2</span>]]<span class="op">**-</span><span class="dv">1</span></span>
<span id="cb922-10"><a href="#cb922-10"></a>nbparams &lt;-<span class="st"> </span>modele<span class="op">@</span>rank</span>
<span id="cb922-11"><a href="#cb922-11"></a>cooksd &lt;-<span class="st"> </span>(res<span class="op">/</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>hats))<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>hats<span class="op">/</span>(disp <span class="op">*</span><span class="st"> </span>nbparams)</span>
<span id="cb922-12"><a href="#cb922-12"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb922-13"><a href="#cb922-13"></a>  <span class="dt">cook =</span> cooksd,</span>
<span id="cb922-14"><a href="#cb922-14"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cooksd)</span>
<span id="cb922-15"><a href="#cb922-15"></a>)</span>
<span id="cb922-16"><a href="#cb922-16"></a><span class="co"># Représentation des distances de Cook</span></span>
<span id="cb922-17"><a href="#cb922-17"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb922-18"><a href="#cb922-18"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cook), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb922-19"><a href="#cb922-19"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.003</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb922-20"><a href="#cb922-20"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;distance de Cook&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cookdistgamma-1.png" alt="Distances de Cook pour le modèle Gamma" width="50%" />
<p class="caption">
(#fig:cookdistgamma)Distances de Cook pour le modèle Gamma
</p>
</div>
<p>Puisque nous disposons d’un (très) grand nombre d’observations, nous pouvons nous permettre de retirer les quelques observations fortement influentes (distance de Cook &gt; 0,003 dans notre cas) qui apparaissent dans la figure @ref(fig:cookdistgamma). Nous retirons ainsi 28 observations et réajustons le modèle.</p>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb923-1"><a href="#cb923-1"></a><span class="co"># Retirer les valeurs influentes</span></span>
<span id="cb923-2"><a href="#cb923-2"></a>dataset2 &lt;-<span class="st"> </span><span class="kw">subset</span>(dataset, cooksd<span class="op">&lt;</span><span class="fl">0.003</span>)</span>
<span id="cb923-3"><a href="#cb923-3"></a><span class="co"># Calcul du modèle avec VGAM</span></span>
<span id="cb923-4"><a href="#cb923-4"></a>modele &lt;-<span class="st"> </span><span class="kw">vglm</span>(Duree <span class="op">~</span><span class="st"> </span>Mode <span class="op">+</span><span class="st"> </span>Motif <span class="op">+</span><span class="st"> </span>HeureDep <span class="op">+</span><span class="st"> </span>LogDist <span class="op">+</span></span>
<span id="cb923-5"><a href="#cb923-5"></a><span class="st">                 </span>ArrondDep<span class="op">+</span><span class="st"> </span>MemeArrond <span class="op">+</span><span class="st"> </span>Semaine,</span>
<span id="cb923-6"><a href="#cb923-6"></a>               <span class="dt">data =</span> dataset2,</span>
<span id="cb923-7"><a href="#cb923-7"></a>               <span class="dt">family=</span><span class="kw">gamma2</span>(<span class="dt">lmu =</span> <span class="st">&quot;loglink&quot;</span>))</span></code></pre></div>
<p>Nous constatons ainsi à la figure @ref(fig:cookdistgamma2) que dans la nouvelle version du modèle, aucune valeur particulièrement influente ne semble être présente.</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="#cb924-1"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb924-2"><a href="#cb924-2"></a>hats &lt;-<span class="st"> </span><span class="kw">hatvaluesvlm</span>(modele)[,<span class="dv">1</span>]</span>
<span id="cb924-3"><a href="#cb924-3"></a>res &lt;-<span class="st"> </span><span class="kw">residuals</span>(modele,<span class="dt">type =</span> <span class="st">&quot;pearson&quot;</span>)[,<span class="dv">1</span>]</span>
<span id="cb924-4"><a href="#cb924-4"></a>disp &lt;-<span class="st"> </span>modele<span class="op">@</span>coefficients[[<span class="dv">2</span>]]<span class="op">**-</span><span class="dv">1</span></span>
<span id="cb924-5"><a href="#cb924-5"></a>nbparams &lt;-<span class="st"> </span>modele<span class="op">@</span>rank</span>
<span id="cb924-6"><a href="#cb924-6"></a>cooksd &lt;-<span class="st"> </span>(res<span class="op">/</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>hats))<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>hats<span class="op">/</span>(disp <span class="op">*</span><span class="st"> </span>nbparams)</span>
<span id="cb924-7"><a href="#cb924-7"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb924-8"><a href="#cb924-8"></a>  <span class="dt">cook =</span> cooksd,</span>
<span id="cb924-9"><a href="#cb924-9"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cooksd)</span>
<span id="cb924-10"><a href="#cb924-10"></a>)</span>
<span id="cb924-11"><a href="#cb924-11"></a><span class="co"># Représentation des distances de Cook</span></span>
<span id="cb924-12"><a href="#cb924-12"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb924-13"><a href="#cb924-13"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cook), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>)) <span class="op">+</span></span>
<span id="cb924-14"><a href="#cb924-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;distance de Cook&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cookdistgamma2-1.png" alt="Distances de Cook pour le modèle Gamma (sans les observations fortement influentes)" width="50%" />
<p class="caption">
(#fig:cookdistgamma2)Distances de Cook pour le modèle Gamma (sans les observations fortement influentes)
</p>
</div>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb925-1"><a href="#cb925-1"></a><span class="co"># Extraction des prédictions du modèle (mu)</span></span>
<span id="cb925-2"><a href="#cb925-2"></a>mus &lt;-<span class="st"> </span>modele<span class="op">@</span>fitted.values</span>
<span id="cb925-3"><a href="#cb925-3"></a><span class="co"># Extration du paramètre de forme</span></span>
<span id="cb925-4"><a href="#cb925-4"></a>shape &lt;-<span class="st"> </span><span class="kw">exp</span>(modele<span class="op">@</span>coefficients[[<span class="dv">2</span>]])</span>
<span id="cb925-5"><a href="#cb925-5"></a><span class="co"># Calcul des simulations</span></span>
<span id="cb925-6"><a href="#cb925-6"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb925-7"><a href="#cb925-7"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(mus),<span class="cf">function</span>(i){</span>
<span id="cb925-8"><a href="#cb925-8"></a>  mu &lt;-<span class="st"> </span>mus[[i]]</span>
<span id="cb925-9"><a href="#cb925-9"></a>  sims &lt;-<span class="st"> </span><span class="kw">rgamma</span>(<span class="dt">n =</span> nsim,<span class="dt">shape =</span> shape, <span class="dt">scale =</span> mu<span class="op">/</span>shape)</span>
<span id="cb925-10"><a href="#cb925-10"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb925-11"><a href="#cb925-11"></a>})</span>
<span id="cb925-12"><a href="#cb925-12"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb925-13"><a href="#cb925-13"></a><span class="co"># Représentation graphique de 20 simulations</span></span>
<span id="cb925-14"><a href="#cb925-14"></a>df2 &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(mat_sims[,<span class="dv">0</span><span class="op">:</span><span class="dv">20</span>])</span>
<span id="cb925-15"><a href="#cb925-15"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb925-16"><a href="#cb925-16"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Duree, <span class="dt">y =</span> ..density..),</span>
<span id="cb925-17"><a href="#cb925-17"></a>                 <span class="dt">data =</span> dataset, <span class="dt">bins =</span> <span class="dv">100</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb925-18"><a href="#cb925-18"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y=</span>..density.., <span class="dt">group =</span> Var2), <span class="dt">data =</span> df2, </span>
<span id="cb925-19"><a href="#cb925-19"></a>               <span class="dt">fill =</span> <span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.9</span>,<span class="fl">0.22</span>,<span class="fl">0.27</span>,<span class="fl">0.4</span>), <span class="dt">size =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb925-20"><a href="#cb925-20"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="dv">0</span>,<span class="dv">200</span>)<span class="op">+</span></span>
<span id="cb925-21"><a href="#cb925-21"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">X=</span><span class="st">&quot;durée (minutes)&quot;</span>, <span class="dt">y=</span><span class="st">&quot;densité&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/simdistribgamma-1.png" alt="Comparaison de la distribution originale et de simulations issues du modèle Gamma" width="60%" />
<p class="caption">
(#fig:simdistribgamma)Comparaison de la distribution originale et de simulations issues du modèle Gamma
</p>
</div>
<p>Avant de calculer les résidus simulés, nous comparons la distribution originale des données et des simulations issues du modèle. La figure @ref(fig:simdistribgamma) permet de constater que le modèle semble bien capturer l’essentiel de la forme de la variable <em>Y</em> originale. Nous notons un léger décalage entre la pointe des deux distributions, laissant penser que les valeurs prédites par le modèle tendent à être légèrement plus grandes que les valeurs réelles. Pour mieux appréhender ce constat, nous passons à l’analyse des résidus simulés.</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb926-1"><a href="#cb926-1"></a><span class="co"># DHarma tests</span></span>
<span id="cb926-2"><a href="#cb926-2"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> mat_sims, </span>
<span id="cb926-3"><a href="#cb926-3"></a>                            <span class="dt">observedResponse =</span> dataset2<span class="op">$</span>Duree,</span>
<span id="cb926-4"><a href="#cb926-4"></a>                            <span class="dt">fittedPredictedResponse =</span> modele<span class="op">@</span>fitted.values[,<span class="dv">1</span>],</span>
<span id="cb926-5"><a href="#cb926-5"></a>                            <span class="dt">integerResponse =</span> F)</span>
<span id="cb926-6"><a href="#cb926-6"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb926-7"><a href="#cb926-7"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">residuals</span>(sim_res)), <span class="dt">bins =</span> <span class="dv">100</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb926-8"><a href="#cb926-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;résidus simulés&quot;</span>,</span>
<span id="cb926-9"><a href="#cb926-9"></a>        <span class="dt">y =</span> <span class="st">&quot;effectifs&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/gammaresids-1.png" alt="Distribution des résidus simulés du modèle Gamma" width="60%" />
<p class="caption">
(#fig:gammaresids)Distribution des résidus simulés du modèle Gamma
</p>
</div>
<p>Nul besoin d’un test statistique pour constater que ces résidus (figure @ref(fig:gammaresids)) ne suivent pas une distribution uniforme. Nous observons une nette surreprésentation de résidus à 1 et une nette sous-représentation de résidus à 0. Il y a donc de nombreuses observations dans notre modèle pour lesquelles les simulations sont systématiquement trop fortes et pas assez pour lesquelles les simulations seraient systématiquement trop faibles.</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="#cb927-1"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/gammaresids2-1.png" alt="Diagnostic général des résidus simulés du modèle Gamma" width="100%" />
<p class="caption">
(#fig:gammaresids2)Diagnostic général des résidus simulés du modèle Gamma
</p>
</div>
<p>La figure @ref(fig:gammaresids2) indique que le modèle souffre à la fois d’un problème de dispersion (la relation espérance-variance n’est donc pas respectée) et est affecté par des valeurs aberrantes. Considérant que nous avons encore un très grand nombre d’observations, nous faisons le choix de retirer celles pour lesquelles la méthode des résidus simulés estime qu’elles sont des valeurs aberrantes dans au moins 1 % des simulations, soit environ 620 observations.</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="#cb928-1"></a><span class="co"># Sélection des valeurs aberrantes au seuil 0.01</span></span>
<span id="cb928-2"><a href="#cb928-2"></a>sim_outliers &lt;-<span class="st"> </span><span class="kw">outliers</span>(sim_res, </span>
<span id="cb928-3"><a href="#cb928-3"></a>                         <span class="dt">lowerQuantile =</span> <span class="fl">0.01</span>,</span>
<span id="cb928-4"><a href="#cb928-4"></a>                         <span class="dt">upperQuantile =</span> <span class="fl">0.99</span>, </span>
<span id="cb928-5"><a href="#cb928-5"></a>                         <span class="dt">return =</span> <span class="st">&quot;logical&quot;</span>)</span>
<span id="cb928-6"><a href="#cb928-6"></a><span class="kw">table</span>(sim_outliers)</span></code></pre></div>
<pre><code>## sim_outliers
## FALSE  TRUE 
## 22932   614</code></pre>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="#cb930-1"></a><span class="co"># Retirer ces observations des données</span></span>
<span id="cb930-2"><a href="#cb930-2"></a>dataset3 &lt;-<span class="st"> </span><span class="kw">subset</span>(dataset2, sim_outliers<span class="op">==</span><span class="ot">FALSE</span>)</span>
<span id="cb930-3"><a href="#cb930-3"></a><span class="co"># Réajuster le modèle</span></span>
<span id="cb930-4"><a href="#cb930-4"></a>modele &lt;-<span class="st"> </span><span class="kw">vglm</span>(Duree <span class="op">~</span><span class="st"> </span>Mode <span class="op">+</span><span class="st"> </span>Motif <span class="op">+</span><span class="st"> </span>HeureDep <span class="op">+</span><span class="st"> </span></span>
<span id="cb930-5"><a href="#cb930-5"></a><span class="st">                 </span>LogDist <span class="op">+</span><span class="st"> </span>ArrondDep <span class="op">+</span><span class="st"> </span>MemeArrond <span class="op">+</span><span class="st"> </span>Semaine,</span>
<span id="cb930-6"><a href="#cb930-6"></a>               <span class="dt">data =</span> dataset3,</span>
<span id="cb930-7"><a href="#cb930-7"></a>               <span class="dt">model =</span> T,</span>
<span id="cb930-8"><a href="#cb930-8"></a>               <span class="dt">family=</span>gamma2)</span>
<span id="cb930-9"><a href="#cb930-9"></a>modele2 &lt;-<span class="st"> </span><span class="kw">vglm</span>(Duree <span class="op">~</span><span class="st"> </span>Mode <span class="op">+</span><span class="st"> </span>Motif <span class="op">+</span><span class="st"> </span>HeureDep <span class="op">+</span><span class="st"> </span>ArrondDep <span class="op">+</span><span class="st"> </span>MemeArrond <span class="op">+</span><span class="st"> </span>Semaine,</span>
<span id="cb930-10"><a href="#cb930-10"></a>               <span class="dt">data =</span> dataset3,</span>
<span id="cb930-11"><a href="#cb930-11"></a>               <span class="dt">model =</span> T,</span>
<span id="cb930-12"><a href="#cb930-12"></a>               <span class="dt">family=</span>gamma2)</span>
<span id="cb930-13"><a href="#cb930-13"></a><span class="co"># Extraction des prédictions du modèle (mu)</span></span>
<span id="cb930-14"><a href="#cb930-14"></a>mus &lt;-<span class="st"> </span>modele<span class="op">@</span>fitted.values</span>
<span id="cb930-15"><a href="#cb930-15"></a><span class="co"># Extration du paramètre de forme</span></span>
<span id="cb930-16"><a href="#cb930-16"></a>shape &lt;-<span class="st"> </span><span class="kw">exp</span>(modele<span class="op">@</span>coefficients[[<span class="dv">2</span>]])</span>
<span id="cb930-17"><a href="#cb930-17"></a><span class="co"># Calcul des simulations</span></span>
<span id="cb930-18"><a href="#cb930-18"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb930-19"><a href="#cb930-19"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(mus),<span class="cf">function</span>(i){</span>
<span id="cb930-20"><a href="#cb930-20"></a>  mu &lt;-<span class="st"> </span>mus[[i]]</span>
<span id="cb930-21"><a href="#cb930-21"></a>  sims &lt;-<span class="st"> </span><span class="kw">rgamma</span>(<span class="dt">n =</span> nsim,<span class="dt">shape =</span> shape, <span class="dt">scale =</span> mu<span class="op">/</span>shape)</span>
<span id="cb930-22"><a href="#cb930-22"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb930-23"><a href="#cb930-23"></a>})</span>
<span id="cb930-24"><a href="#cb930-24"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb930-25"><a href="#cb930-25"></a><span class="co"># Calcul des résidus simulés</span></span>
<span id="cb930-26"><a href="#cb930-26"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> mat_sims, </span>
<span id="cb930-27"><a href="#cb930-27"></a>                            <span class="dt">observedResponse =</span> dataset3<span class="op">$</span>Duree,</span>
<span id="cb930-28"><a href="#cb930-28"></a>                            <span class="dt">fittedPredictedResponse =</span> modele<span class="op">@</span>fitted.values[,<span class="dv">1</span>],</span>
<span id="cb930-29"><a href="#cb930-29"></a>                            <span class="dt">integerResponse =</span> F)</span>
<span id="cb930-30"><a href="#cb930-30"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/gammaresids3-1.png" alt="Diagnostic général des résidus simulés du modèle Gamma (après suppression d'environ 620 valeurs aberrantes)" width="100%" />
<p class="caption">
(#fig:gammaresids3)Diagnostic général des résidus simulés du modèle Gamma (après suppression d’environ 620 valeurs aberrantes)
</p>
</div>
<p>La figure @ref(fig:gammaresids3) indique que les résidus simulés ne suivent toujours pas une distribution uniforme et qu’il existe une relation prononcée (panneau de droite) entre les résidus et les valeurs prédites. Cette dernière laisse penser que des variables indépendantes importantes ont été omises dans le modèle, ce qui n’est pas surprenant compte tenu du fait que nous ne disposons d’aucune donnée socioéconomique sur les individus ayant réalisé les trajets. Nos données sont également potentiellement affectées par la présence de dépendance spatiale.</p>
<p>Nous pouvons comparer graphiquement la variance observée dans les données et la variance attendue par le modèle. La figure @ref(fig:dispgamma) montre clairement que la variance des données tend à être plus grande qu’attendue quand les temps de trajet sont courts, mais diminue trop vite quand les temps de trajet augmentent. D’autres distributions pourraient être envisagées pour ajuster notre modèle : Lognormal, Weibull, etc.</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb931-1"><a href="#cb931-1"></a><span class="co"># Extraction des prédictions du modèle</span></span>
<span id="cb931-2"><a href="#cb931-2"></a>mus &lt;-<span class="st"> </span><span class="kw">predict</span>(modele, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)[,<span class="dv">1</span>]</span>
<span id="cb931-3"><a href="#cb931-3"></a><span class="co"># Création d&#39;un DataFrame pour contenir la prédiction et les vraies valeurs</span></span>
<span id="cb931-4"><a href="#cb931-4"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb931-5"><a href="#cb931-5"></a>  <span class="dt">mus =</span> mus,</span>
<span id="cb931-6"><a href="#cb931-6"></a>  <span class="dt">reals =</span> dataset3<span class="op">$</span>Duree</span>
<span id="cb931-7"><a href="#cb931-7"></a>)</span>
<span id="cb931-8"><a href="#cb931-8"></a><span class="co"># Calcul de l&#39;intervalle de confiance à 95 % selon la distribution Gamma</span></span>
<span id="cb931-9"><a href="#cb931-9"></a><span class="co"># et stockage dans un second DataFrame</span></span>
<span id="cb931-10"><a href="#cb931-10"></a>seqa &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">10</span>,<span class="dv">120</span>,<span class="dv">10</span>)</span>
<span id="cb931-11"><a href="#cb931-11"></a>shape &lt;-<span class="st"> </span><span class="kw">exp</span>(modele<span class="op">@</span>coefficients[[<span class="dv">2</span>]])</span>
<span id="cb931-12"><a href="#cb931-12"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb931-13"><a href="#cb931-13"></a>  <span class="dt">mus =</span> seqa,</span>
<span id="cb931-14"><a href="#cb931-14"></a>  <span class="dt">lower =</span> <span class="kw">qgamma</span>(<span class="dt">p =</span> <span class="fl">0.025</span>, <span class="dt">shape =</span> shape, <span class="dt">scale =</span> seqa<span class="op">/</span>shape),</span>
<span id="cb931-15"><a href="#cb931-15"></a>  <span class="dt">upper =</span> <span class="kw">qgamma</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">shape =</span> shape, <span class="dt">scale =</span> seqa<span class="op">/</span>shape)</span>
<span id="cb931-16"><a href="#cb931-16"></a>)</span>
<span id="cb931-17"><a href="#cb931-17"></a><span class="co"># Affichage des valeurs réelles et prédites (en rouge)</span></span>
<span id="cb931-18"><a href="#cb931-18"></a><span class="co"># et de leur variance selon le modèle (en noir)</span></span>
<span id="cb931-19"><a href="#cb931-19"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb931-20"><a href="#cb931-20"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> df1, </span>
<span id="cb931-21"><a href="#cb931-21"></a>             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> mus, <span class="dt">y =</span> reals),</span>
<span id="cb931-22"><a href="#cb931-22"></a>             <span class="dt">color =</span><span class="kw">rgb</span>(<span class="fl">0.9</span>,<span class="fl">0.22</span>,<span class="fl">0.27</span>,<span class="fl">0.4</span>), <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb931-23"><a href="#cb931-23"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="dt">data =</span> df2,</span>
<span id="cb931-24"><a href="#cb931-24"></a>                <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> mus, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper),</span>
<span id="cb931-25"><a href="#cb931-25"></a>                <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb931-26"><a href="#cb931-26"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;valeurs prédites&#39;</span>,</span>
<span id="cb931-27"><a href="#cb931-27"></a>       <span class="dt">y =</span> <span class="st">&quot;valeurs réelles&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/dispgamma-1.png" alt="Comparaison de la variance attendue par le modèle et la variance observée dans les données pour le modèle Gamma" width="50%" />
<p class="caption">
(#fig:dispgamma)Comparaison de la variance attendue par le modèle et la variance observée dans les données pour le modèle Gamma
</p>
</div>
<p>À ce stade, nous disposons de suffisamment d’éléments pour douter des résultats du modèle. Nous allons tout de même poursuivre notre analyse afin d’illustrer l’estimation de la qualité d’ajustement d’un tel modèle et son interprétation.</p>
<p><strong>Analyse de la qualité d’ajustement</strong></p>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb932-1"><a href="#cb932-1"></a><span class="co"># Ajustement d&#39;un modele nul</span></span>
<span id="cb932-2"><a href="#cb932-2"></a>modele.null &lt;-<span class="st"> </span><span class="kw">vglm</span>(Duree <span class="op">~</span><span class="dv">1</span>,</span>
<span id="cb932-3"><a href="#cb932-3"></a>               <span class="dt">data =</span> dataset3,</span>
<span id="cb932-4"><a href="#cb932-4"></a>               <span class="dt">model =</span> T,</span>
<span id="cb932-5"><a href="#cb932-5"></a>               <span class="dt">family=</span>gamma2)</span>
<span id="cb932-6"><a href="#cb932-6"></a><span class="co"># Calcul des pseudos R2</span></span>
<span id="cb932-7"><a href="#cb932-7"></a><span class="kw">rsqs</span>(<span class="dt">loglike.full =</span> <span class="kw">logLik</span>(modele),</span>
<span id="cb932-8"><a href="#cb932-8"></a>     <span class="dt">loglike.null =</span> <span class="kw">logLik</span>(modele.null),</span>
<span id="cb932-9"><a href="#cb932-9"></a>     <span class="dt">full.deviance =</span> <span class="kw">logLik</span>(modele) <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>,</span>
<span id="cb932-10"><a href="#cb932-10"></a>     <span class="dt">null.deviance =</span> <span class="kw">logLik</span>(modele.null) <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>,</span>
<span id="cb932-11"><a href="#cb932-11"></a>     <span class="dt">nb.params =</span> modele2<span class="op">@</span>rank,</span>
<span id="cb932-12"><a href="#cb932-12"></a>     <span class="dt">n =</span> <span class="kw">nrow</span>(dataset3)</span>
<span id="cb932-13"><a href="#cb932-13"></a>     )</span></code></pre></div>
<pre><code>## $`deviance expliquee`
## [1] 0.05064818
## 
## $`McFadden ajuste`
## [1] 0.05020065
## 
## $`Cox and Snell`
## [1] 0.3328104
## 
## $Nagelkerke
## [1] 0.3329232</code></pre>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="#cb934-1"></a><span class="co"># Calcul du RMSE</span></span>
<span id="cb934-2"><a href="#cb934-2"></a>preds &lt;-<span class="st"> </span><span class="kw">predict</span>(modele, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)[,<span class="dv">1</span>]</span>
<span id="cb934-3"><a href="#cb934-3"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>((preds <span class="op">-</span><span class="st"> </span>dataset3<span class="op">$</span>Duree)<span class="op">**</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 13.37922</code></pre>
<p>Le modèle n’explique que 5 % de la déviance et obtient des valeurs de R<sup>2</sup> ajusté de McFadden, de Cox et Snell et de Nagelkerke de respectivement 0,05, 0,33 et 0,33. La moyenne de l’erreur quadratique est de seulement 13,4 indiquant que le modèle se trompe en moyenne de seulement 13,4 minutes. La capacité de prédiction du modèle est donc limitée sans être catastrophique.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>Pour rappel, la fonction de lien dans notre modèle est la fonction <code>log</code>. Chaque coefficient représente donc l’impact de l’augmentation d’une unité des variables indépendantes sur le logarithme de l’espérance de notre variable dépendante. Si nous transformons nos coefficients avec la fonction exponentielle (<code>exp</code>) nous obtenons, pour chaque augmentation d’une unité des variables indépendantes, la multiplication de l’espérance de notre variable dépendante.</p>
<p>Puisque nos trajets peuvent provenir de nombreux arrondissements, nous proposons de représenter l’exponentiel de leurs coefficients avec un graphique. Nous pouvons d’ailleurs comparer les exponentiels des coefficients et les effets marginaux pour simplifier l’interprétation.</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="#cb936-1"></a><span class="co"># Extraction des coefficient du modèle</span></span>
<span id="cb936-2"><a href="#cb936-2"></a>coeffs &lt;-<span class="st"> </span>modele<span class="op">@</span>coefficients</span>
<span id="cb936-3"><a href="#cb936-3"></a><span class="co"># Calcul des interval de confiance des coefficients</span></span>
<span id="cb936-4"><a href="#cb936-4"></a>conf &lt;-<span class="st"> </span><span class="kw">confint</span>(modele)</span>
<span id="cb936-5"><a href="#cb936-5"></a><span class="co"># Passage en exponentiel</span></span>
<span id="cb936-6"><a href="#cb936-6"></a>df &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">cbind</span>(coeffs, conf))</span>
<span id="cb936-7"><a href="#cb936-7"></a><span class="co"># Extraction des coefficients pour les arrondissements</span></span>
<span id="cb936-8"><a href="#cb936-8"></a>dfArrond &lt;-<span class="st"> </span><span class="kw">data.frame</span>(df[<span class="kw">grepl</span>(<span class="st">&quot;ArrondDep&quot;</span>,<span class="kw">row.names</span>(df), <span class="dt">fixed =</span> T),])</span>
<span id="cb936-9"><a href="#cb936-9"></a><span class="kw">names</span>(dfArrond) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;coeff&quot;</span>, <span class="st">&quot;lower&quot;</span>,<span class="st">&quot;upper&quot;</span>)</span>
<span id="cb936-10"><a href="#cb936-10"></a>dfArrond<span class="op">$</span>Arrondissement &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;ArrondDep&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="kw">rownames</span>(dfArrond),<span class="dt">fixed =</span> T)</span>
<span id="cb936-11"><a href="#cb936-11"></a><span class="co"># Graphique des exponentiels des coefficients</span></span>
<span id="cb936-12"><a href="#cb936-12"></a>P1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dfArrond) <span class="op">+</span><span class="st"> </span></span>
<span id="cb936-13"><a href="#cb936-13"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb936-14"><a href="#cb936-14"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">reorder</span>(Arrondissement, coeff), <span class="dt">xmin =</span> upper, <span class="dt">xmax =</span> lower),</span>
<span id="cb936-15"><a href="#cb936-15"></a>                 <span class="dt">height =</span> <span class="dv">0</span>)<span class="op">+</span></span>
<span id="cb936-16"><a href="#cb936-16"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">reorder</span>(Arrondissement, coeff), <span class="dt">x =</span> coeff)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb936-17"><a href="#cb936-17"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> upper, <span class="dt">y =</span> <span class="kw">reorder</span>(Arrondissement, coeff),</span>
<span id="cb936-18"><a href="#cb936-18"></a>                <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;coeff. : &quot;</span>,<span class="kw">round</span>(coeff,<span class="dv">2</span>),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)),</span>
<span id="cb936-19"><a href="#cb936-19"></a>                <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">nudge_x =</span> <span class="fl">0.07</span>)<span class="op">+</span></span>
<span id="cb936-20"><a href="#cb936-20"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Coefficient multiplicateur (ref : Ahuntsic-Cartierville)&quot;</span>,</span>
<span id="cb936-21"><a href="#cb936-21"></a>       <span class="dt">y =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb936-22"><a href="#cb936-22"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Exponentiels des coefficients du modèle&quot;</span>)<span class="op">+</span></span>
<span id="cb936-23"><a href="#cb936-23"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="fl">0.75</span>,<span class="fl">1.46</span>))</span>
<span id="cb936-24"><a href="#cb936-24"></a><span class="co"># Création d&#39;un DataFrame fictif pour les effets marginaux</span></span>
<span id="cb936-25"><a href="#cb936-25"></a>dfpred &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(</span>
<span id="cb936-26"><a href="#cb936-26"></a>  <span class="dt">LogDist =</span> <span class="kw">mean</span>(dataset3<span class="op">$</span>LogDist),</span>
<span id="cb936-27"><a href="#cb936-27"></a>  <span class="dt">Motif =</span> <span class="st">&#39;education&#39;</span>,</span>
<span id="cb936-28"><a href="#cb936-28"></a>  <span class="dt">HeureDep =</span> <span class="st">&#39;7&#39;</span>,</span>
<span id="cb936-29"><a href="#cb936-29"></a>  <span class="dt">MemeArrond =</span> <span class="st">&#39;Different&#39;</span>,</span>
<span id="cb936-30"><a href="#cb936-30"></a>  <span class="dt">ArrondDep =</span> <span class="kw">unique</span>(dataset3<span class="op">$</span>ArrondDep),</span>
<span id="cb936-31"><a href="#cb936-31"></a>  <span class="dt">Mode =</span> <span class="st">&#39;pieton&#39;</span>,<span class="st">&#39;velo&#39;</span>,<span class="st">&#39;transport collectif&#39;</span>,</span>
<span id="cb936-32"><a href="#cb936-32"></a>  <span class="dt">Semaine =</span> <span class="st">&#39;lundi au vendredi&#39;</span></span>
<span id="cb936-33"><a href="#cb936-33"></a>)</span>
<span id="cb936-34"><a href="#cb936-34"></a><span class="co"># Utiliser le modèle pour effectuer des prédictions (échelle log)</span></span>
<span id="cb936-35"><a href="#cb936-35"></a>lin_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(modele,dfpred, <span class="dt">se =</span> T)</span>
<span id="cb936-36"><a href="#cb936-36"></a>mu_lin_pred &lt;-<span class="st"> </span>lin_pred<span class="op">$</span>fitted.values[,<span class="dv">1</span>]</span>
<span id="cb936-37"><a href="#cb936-37"></a>se_lin_pred &lt;-<span class="st"> </span>lin_pred<span class="op">$</span>se.fit[,<span class="dv">1</span>]</span>
<span id="cb936-38"><a href="#cb936-38"></a>dfpred2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb936-39"><a href="#cb936-39"></a>  <span class="dt">pred =</span> <span class="kw">exp</span>(mu_lin_pred),</span>
<span id="cb936-40"><a href="#cb936-40"></a>  <span class="dt">lower =</span> <span class="kw">exp</span>(mu_lin_pred<span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se_lin_pred),</span>
<span id="cb936-41"><a href="#cb936-41"></a>  <span class="dt">upper =</span> <span class="kw">exp</span>(mu_lin_pred<span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se_lin_pred)</span>
<span id="cb936-42"><a href="#cb936-42"></a>)</span>
<span id="cb936-43"><a href="#cb936-43"></a>dfpred2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(dfpred2, dfpred)</span>
<span id="cb936-44"><a href="#cb936-44"></a><span class="co"># Réaliser le graphique des effets marginaux</span></span>
<span id="cb936-45"><a href="#cb936-45"></a>P2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dfpred2) <span class="op">+</span><span class="st"> </span></span>
<span id="cb936-46"><a href="#cb936-46"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x =</span> pred, <span class="dt">y =</span> ArrondDep)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb936-47"><a href="#cb936-47"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> lower, <span class="dt">xmax =</span> upper, <span class="dt">y =</span> ArrondDep)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb936-48"><a href="#cb936-48"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Temps de déplacement prédit&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb936-49"><a href="#cb936-49"></a>       <span class="dt">subtitle =</span> <span class="st">&quot;Prédiction du modèle&quot;</span>)</span>
<span id="cb936-50"><a href="#cb936-50"></a><span class="kw">ggarrange</span>(P1,P2, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/arrondgamma-1.png" alt="Effet de l'arrondissement de départ sur les temps de trajet à Montréal" width="100%" />
<p class="caption">
(#fig:arrondgamma)Effet de l’arrondissement de départ sur les temps de trajet à Montréal
</p>
</div>
<p>La figure @ref(fig:arrondgamma) permet de constater que les arrondissements Ville-Marie et Plateau-Mont-Royal se distinguent avec des trajets plus courts (environ 20 % plus courts en moyenne que les trajets partant d’Ahuntsic-Cartierville). À l’inverse, Lachine est de loin l’arrondissement avec les trajets les plus longs (25 % plus longs en moyenne que les trajets partant d’Ahuntsic-Cartierville).</p>
<p>Nous appliquons la même méthode de visualisation à la variable Heure de départ des trajets.</p>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb937-1"><a href="#cb937-1"></a><span class="co"># Extraction des valeurs pour les heures de départ</span></span>
<span id="cb937-2"><a href="#cb937-2"></a>dfHeures &lt;-<span class="st"> </span><span class="kw">data.frame</span>(df[<span class="kw">grepl</span>(<span class="st">&quot;HeureDep&quot;</span>,<span class="kw">row.names</span>(df), <span class="dt">fixed =</span> T),])</span>
<span id="cb937-3"><a href="#cb937-3"></a><span class="kw">names</span>(dfHeures) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;coeff&quot;</span>, <span class="st">&quot;lower&quot;</span>,<span class="st">&quot;upper&quot;</span>)</span>
<span id="cb937-4"><a href="#cb937-4"></a>dfHeures<span class="op">$</span>Heure &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;HeureDep&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="kw">rownames</span>(dfHeures),<span class="dt">fixed =</span> T)</span>
<span id="cb937-5"><a href="#cb937-5"></a><span class="co"># Rajouter des 0 et des h pour de jolies légendes</span></span>
<span id="cb937-6"><a href="#cb937-6"></a>dfHeures<span class="op">$</span>Heure &lt;-<span class="st"> </span><span class="kw">paste</span>(dfHeures<span class="op">$</span>Heure,<span class="st">&quot;h&quot;</span>,<span class="dt">sep=</span><span class="st">&quot; &quot;</span>)</span>
<span id="cb937-7"><a href="#cb937-7"></a></span>
<span id="cb937-8"><a href="#cb937-8"></a><span class="co"># Afficher le graphique</span></span>
<span id="cb937-9"><a href="#cb937-9"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dfHeures) <span class="op">+</span><span class="st"> </span></span>
<span id="cb937-10"><a href="#cb937-10"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb937-11"><a href="#cb937-11"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Heure, <span class="dt">ymin =</span> upper, <span class="dt">ymax =</span> lower), <span class="dt">width =</span> <span class="dv">0</span>)<span class="op">+</span></span>
<span id="cb937-12"><a href="#cb937-12"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Heure, <span class="dt">y =</span> coeff)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb937-13"><a href="#cb937-13"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> upper, <span class="dt">x =</span> Heure, <span class="dt">label =</span> <span class="kw">round</span>(coeff,<span class="dv">2</span>)), <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">nudge_y =</span> <span class="fl">0.07</span>)<span class="op">+</span></span>
<span id="cb937-14"><a href="#cb937-14"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Coefficient multiplicateur (ref : 7 h)&quot;</span>,</span>
<span id="cb937-15"><a href="#cb937-15"></a>       <span class="dt">y =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/heuresgamma-1.png" alt="Effet de l'heure de départ sur les temps de trajet à Montréal" width="85%" />
<p class="caption">
(#fig:heuresgamma)Effet de l’heure de départ sur les temps de trajet à Montréal
</p>
</div>
<p>Nous pouvons ainsi observer à la figure @ref(fig:heuresgamma) que les trajets effectués entre 10 h et 12 h sont les plus longs de la journée, entre 30 et 40 % plus longs que ceux effectués à 7 h et 8 h qui constituent les trajets les plus courts.</p>
<p>Le reste des coefficients (ainsi que le paramètre de forme) sont affichés dans le tableau @ref(tab:coeffsgamma). Comparativement à un trajet effectué à pied, un trajet en transport en commun durera en moyenne 52 % plus longtemps (1,53 fois plus long), alors que des déplacements en véhicule individuel et en vélo sont respectivement 28 % et 23 % moins longs. Aucune différence n’est observable entre les déplacements effectués en semaine ou pendant la fin de semaine.</p>
<table>
<caption>
(#tab:coeffsgamma)Résultats pour le modèle GLM Gamma
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coeff.
</th>
<th style="text-align:right;">
Exp(Coeff.)
</th>
<th style="text-align:right;">
Val.p
</th>
<th style="text-align:right;">
IC 2,5 % exp(Coeff.)
</th>
<th style="text-align:right;">
IC 97,5 % exp(Coeff.)
</th>
<th style="text-align:right;">
Sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
2,926
</td>
<td style="text-align:right;">
18,662
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
14,939
</td>
<td style="text-align:right;">
23,313
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Mode</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : pieton
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
transport collectif
</td>
<td style="text-align:right;">
0,427
</td>
<td style="text-align:right;">
1,532
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,493
</td>
<td style="text-align:right;">
1,571
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
vehicule individuel
</td>
<td style="text-align:right;">
-0,315
</td>
<td style="text-align:right;">
0,730
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,711
</td>
<td style="text-align:right;">
0,748
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
velo
</td>
<td style="text-align:right;">
-0,260
</td>
<td style="text-align:right;">
0,771
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,752
</td>
<td style="text-align:right;">
0,791
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Motif</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : education
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
loisir
</td>
<td style="text-align:right;">
-0,008
</td>
<td style="text-align:right;">
0,992
</td>
<td style="text-align:right;">
0,629
</td>
<td style="text-align:right;">
0,959
</td>
<td style="text-align:right;">
1,025
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
magasinage
</td>
<td style="text-align:right;">
-0,112
</td>
<td style="text-align:right;">
0,894
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,864
</td>
<td style="text-align:right;">
0,925
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
travail
</td>
<td style="text-align:right;">
-0,064
</td>
<td style="text-align:right;">
0,938
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,909
</td>
<td style="text-align:right;">
0,967
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
LogDist
</td>
<td style="text-align:right;">
0,332
</td>
<td style="text-align:right;">
1,394
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,379
</td>
<td style="text-align:right;">
1,408
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>MemeArrond</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : Different
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
Meme
</td>
<td style="text-align:right;">
-0,042
</td>
<td style="text-align:right;">
0,959
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,939
</td>
<td style="text-align:right;">
0,980
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
<em>Semaine</em>
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ref : lundi au vendredi
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
<td style="text-align:right;">
–
</td>
</tr>
<tr>
<td style="text-align:left;">
samedi et dimanche
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
1,002
</td>
<td style="text-align:right;">
0,858
</td>
<td style="text-align:right;">
0,981
</td>
<td style="text-align:right;">
1,023
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
1,145
</td>
<td style="text-align:right;">
3,143
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
3,089
</td>
<td style="text-align:right;">
3,200
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table>
<p>Les déplacements ayant comme motif le magasinage et le travail ont tendance à être en moyenne plus courts de 11 % et 6 % respectivement, comparativement aux déplacements effectués pour l’éducation ou le loisir (différence non significative entre loisir et éducation). Sans surprise, la distance entre le point de départ et d’arrivée du trajet (<code>LogDist</code>) affecte sa durée de façon positive. Considérant qu’il est difficile d’interpréter des log de kilomètre (dû à une transformation de la variable originale), nous représentons l’effet de cette variable avec la prédiction du modèle à la figure. Nous utilisons pour cela le cas suivant: déplacement à pied à 7 h en semaine, ayant pour motif éducation, dont le point de départ se situe dans l’arrondissement Ahuntsic et donc le point d’arrivée est dans un autre arrondissement. Seule la distance du trajet varie de 1 à 40 km. À titre de comparaison, nous représentons aussi pour les mêmes conditions le cas d’un(e) cycliste (en vert), et d’un(e) utilisateur(trice) du transport en commun (en bleu). Les lignes en pointillés représentent les intervalles de confiance à 95 % des prédictions (figure @ref(fig:distancegamma)).</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="#cb938-1"></a><span class="co"># Création d&#39;un DataFrame fictif pour la prédiction</span></span>
<span id="cb938-2"><a href="#cb938-2"></a>dfpred &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(</span>
<span id="cb938-3"><a href="#cb938-3"></a>  <span class="dt">Dist =</span> <span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">40</span>, <span class="fl">0.5</span>),</span>
<span id="cb938-4"><a href="#cb938-4"></a>  <span class="dt">Motif =</span> <span class="st">&#39;education&#39;</span>,</span>
<span id="cb938-5"><a href="#cb938-5"></a>  <span class="dt">HeureDep =</span> <span class="st">&#39;7&#39;</span>,</span>
<span id="cb938-6"><a href="#cb938-6"></a>  <span class="dt">MemeArrond =</span> <span class="st">&#39;Different&#39;</span>,</span>
<span id="cb938-7"><a href="#cb938-7"></a>  <span class="dt">ArrondDep =</span> <span class="st">&#39;Ahuntsic-Cartierville&#39;</span>,</span>
<span id="cb938-8"><a href="#cb938-8"></a>  <span class="dt">Mode =</span> <span class="kw">c</span>(<span class="st">&#39;pieton&#39;</span>,<span class="st">&#39;velo&#39;</span>,<span class="st">&#39;transport collectif&#39;</span>),</span>
<span id="cb938-9"><a href="#cb938-9"></a>  <span class="dt">Semaine =</span> <span class="st">&#39;lundi au vendredi&#39;</span></span>
<span id="cb938-10"><a href="#cb938-10"></a>)</span>
<span id="cb938-11"><a href="#cb938-11"></a><span class="co"># Mise en log de la variable de distance</span></span>
<span id="cb938-12"><a href="#cb938-12"></a>dfpred<span class="op">$</span>LogDist &lt;-<span class="st"> </span><span class="kw">log</span>(dfpred<span class="op">$</span>Dist)</span>
<span id="cb938-13"><a href="#cb938-13"></a><span class="co"># Calcul des prédictions et de leur erreur standard (échelle log)</span></span>
<span id="cb938-14"><a href="#cb938-14"></a>lin_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(modele,dfpred, <span class="dt">se =</span> T)</span>
<span id="cb938-15"><a href="#cb938-15"></a><span class="co"># Calcul des intervalles de confiance et mise en exponentielle des prédictions</span></span>
<span id="cb938-16"><a href="#cb938-16"></a>dfpred<span class="op">$</span>pred &lt;-<span class="st"> </span><span class="kw">exp</span>(lin_pred<span class="op">$</span>fitted.values[,<span class="dv">1</span>])</span>
<span id="cb938-17"><a href="#cb938-17"></a>dfpred<span class="op">$</span>lower &lt;-<span class="st"> </span><span class="kw">exp</span>(lin_pred<span class="op">$</span>fitted.values[,<span class="dv">1</span>] <span class="fl">-1.96</span><span class="op">*</span>lin_pred<span class="op">$</span>se.fit[,<span class="dv">1</span>])</span>
<span id="cb938-18"><a href="#cb938-18"></a>dfpred<span class="op">$</span>upper &lt;-<span class="st"> </span><span class="kw">exp</span>(lin_pred<span class="op">$</span>fitted.values[,<span class="dv">1</span>] <span class="fl">+1.96</span><span class="op">*</span>lin_pred<span class="op">$</span>se.fit[,<span class="dv">1</span>])</span>
<span id="cb938-19"><a href="#cb938-19"></a><span class="co"># Ajoutons les accents pour le graphiques</span></span>
<span id="cb938-20"><a href="#cb938-20"></a>dfpred<span class="op">$</span>Mode &lt;-<span class="st"> </span><span class="kw">as.character</span>(dfpred<span class="op">$</span>Mode)</span>
<span id="cb938-21"><a href="#cb938-21"></a>dfpred<span class="op">$</span>Mode2 &lt;-<span class="st"> </span><span class="kw">case_when</span>(dfpred<span class="op">$</span>Mode <span class="op">==</span><span class="st"> &quot;pieton&quot;</span> <span class="op">~</span><span class="st"> &quot;piéton&quot;</span>,</span>
<span id="cb938-22"><a href="#cb938-22"></a>                         dfpred<span class="op">$</span>Mode <span class="op">==</span><span class="st"> &quot;velo&quot;</span> <span class="op">~</span><span class="st"> &quot;vélo&quot;</span>,</span>
<span id="cb938-23"><a href="#cb938-23"></a>                         <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>dfpred<span class="op">$</span>Mode)</span>
<span id="cb938-24"><a href="#cb938-24"></a><span class="co"># Affichage des résultats</span></span>
<span id="cb938-25"><a href="#cb938-25"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dfpred) <span class="op">+</span><span class="st"> </span></span>
<span id="cb938-26"><a href="#cb938-26"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Dist, <span class="dt">y =</span> lower, <span class="dt">color =</span> Mode2), <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb938-27"><a href="#cb938-27"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Dist, <span class="dt">y =</span> upper, <span class="dt">color =</span> Mode2), <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb938-28"><a href="#cb938-28"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Dist, <span class="dt">y =</span> pred, <span class="dt">color =</span> Mode2), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb938-29"><a href="#cb938-29"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;temps de trajet prédit (minutes)&quot;</span>,</span>
<span id="cb938-30"><a href="#cb938-30"></a>       <span class="dt">x =</span> <span class="st">&quot;distance à vol d&#39;oiseau (km)&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/distancegamma-1.png" alt="Effet de la distance à vol d'oiseau sur les temps de trajet à Montréal" width="85%" />
<p class="caption">
(#fig:distancegamma)Effet de la distance à vol d’oiseau sur les temps de trajet à Montréal
</p>
</div>
</div>
</div>
<div id="sect0854" class="section level3">
<h3><span class="header-section-number">8.4.4</span> Modèle GLM avec une distribution bêta</h3>
<p>Pour rappel, la distribution bêta est une distribution définie sur l’intervalle <span class="math inline">\([0,1]\)</span>, elle est donc particulièrement utile pour décrire des proportions, des pourcentages ou des probabilités. Dans la section @ref(sect024316) sur les distributions, nous avions présenté la paramétrisation classique de la distribution avec les paramètres <span class="math inline">\(a\)</span> et <span class="math inline">\(b\)</span> étant tous les deux des paramètres de forme. Ces deux paramètres n’ont pas d’interprétation pratique, mais il est possible (comme pour la distribution Gamma) de reparamétrer la distribution Beta avec un paramètre de centralité (espérance) et de dispersion.</p>
<p>Notez également que si la distribution Beta autorise la présence de 0 et de 1, le modèle GLM utilisant cette distribution doit les exclure des valeurs possibles s’il utilise la fonction de lien logistique. En effet, cette fonction à la forme suivante :</p>

<p><span class="math display">\[\begin{equation}
logit(x) = log(\frac{x}{1-x})\\
(\#eq:logitbeta)
\end{equation}\]</span>
</p>
<p>Nous pouvons constater que si <span class="math inline">\(x = 1\)</span>, alors le dénominateur de la fraction est 0, or il est impossible de diviser par 0. Si <span class="math inline">\(x = 0\)</span>, alors nous obtenons <span class="math inline">\(log(0)\)</span> ce qui est également impossible au plan mathématique.</p>
<p>Dans le cas de figure où des 0 et/ou des 1 sont présents dans les données, quatre options sont possibles pour contourner le problèmes :</p>
<ol style="list-style-type: decimal">
<li>Si les observations à 0 ou 1 sont très peu nombreuses, il est envisageable de les retirer des données.</li>
<li>Si la variable mesurée le permet, il est possible de remplacer les 0 et les 1 par des valeurs très proches (0,0001 et 0,9999 par exemple) sans dénaturer excessivement les données initiales.</li>
<li>Plutôt que d’utiliser une valeur arbitraire, <span class="citation">Smithson et Verkuilen (<a href="#ref-smithson2006better" role="doc-biblioref">2006</a>)</span> recommande de recalculer la variable <span class="math inline">\(Y \in [0;1]\)</span> avec la formule @ref(eq:correctbeta)</li>
<li>Employer un modèle Hurdle à trois équations, la première prédisant la probabilité d’observer <span class="math inline">\(Y &gt; 0\)</span>, la seconde, la probabilité d’observer <span class="math inline">\(Y = 1\)</span> et la dernière prédisant les valeurs de <em>Y</em> pour <span class="math inline">\(0&gt;Y&gt;1\)</span>.</li>
</ol>

<p><span class="math display">\[\begin{equation}
Y&#39; = \frac{Y(N-1)+s}{N}
(\#eq:correctbeta)
\end{equation}\]</span>
</p>
<p>Avec <em>N</em> le nombre d’observations, <em>Y’</em> la variable <em>Y</em> transformée et <em>s</em> une constante. Plus cette dernière est élevée, plus la variable <em>Y’</em> aura des valeurs éloignée de 0 et 1. la valeur de 0,5 est recommandée par les auteurs.</p>
<div class="bloc_aller_loin">
<p><strong>Reparamétrer la distribution Beta</strong></p>
<p>Pour une distribution Beta telle que définie par <span class="math inline">\(Y \sim Beta(a,b)\)</span>, l’espérance de cette distribution et sa variance sont données par:</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;E(Y) = \frac{a}{a+b} \\
&amp;Var(Y) = \frac{a \times b}{(a+b)^2(a+b+1)}\\
\end{aligned}
(\#eq:glm20)
\end{equation}\]</span>
</p>
<p>Pour reparamétrer cette distribution, nous définissons un nouveau paramètre <span class="math inline">\(\phi\)</span> (phi) tel que:</p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;a = \phi * E(Y) \\
&amp;b = \phi - a \\
&amp;Var(Y) = \frac{E(Y) \times (1-E(Y))}{1+\phi}
\end{aligned}
(\#eq:glm21)
\end{equation}\]</span>
</p>
<p>De cette manière, il est possible d’exprimer la distribution Beta en fonction de son espérance (sa valeur attendue, ce qui s’interprète approximativement comme une moyenne) et un paramètre <span class="math inline">\(\phi\)</span> intervenant dans le calcul de sa variance. Vous noterez d’ailleurs que la variance de cette distribution dépend de sa moyenne, impliquant à nouveau une hétéroscédasticité intrinsèque.</p>
</div>
<p>Pour résumer, nous nous retrouvons donc avec un modèle qui prédit l’espérance d’une distribution Beta avec une fonction de lien logistique. La variance de cette distribution est fonction de cette moyenne et d’un second paramètre <span class="math inline">\(\phi\)</span>. Ces informations sont résumées dans la fiche d’identité du modèle (tableau @ref(tab:betaentity)).</p>
<table>
<caption>
(#tab:betaentity)Carte d’identité du modèle Beta
</caption>
<tbody>
<tr>
<td>
Type de variable dépendante
</td>
<td>
Variable continue dans l’intervalle <span class="math inline">\(]0,1[\)</span>
</td>
</tr>
<tr>
<td>
Distribution utilisée
</td>
<td>
Student
</td>
</tr>
<tr>
<td>
Formulation
</td>
<td>
<span class="math inline">\(Y \sim Beta(\mu,\phi)\)</span> <br/> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <br/> <span class="math inline">\(g(x) = log(\frac{x}{1-x})\)</span>
</td>
</tr>
<tr>
<td>
Fonction de lien
</td>
<td>
log
</td>
</tr>
<tr>
<td>
Paramètre modélisé
</td>
<td>
<span class="math inline">\(\mu\)</span>
</td>
</tr>
<tr>
<td>
Paramètres à estimer
</td>
<td>
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>, et <span class="math inline">\(\phi\)</span>
</td>
</tr>
<tr>
<td>
Conditions d’application
</td>
<td>
<span class="math inline">\(Variance = \frac{\mu \times (1-\mu)}{1+\phi}\)</span>
</td>
</tr>
</tbody>
</table>
<div id="conditions-dapplication-7" class="section level4">
<h4><span class="header-section-number">8.4.4.1</span> Conditions d’application</h4>
<p>Comme pour un modèle Gamma, la seule condition d’application spécifique à un modèle avec distribution Beta est que la variance des résidus suit la forme attendue par la distribution Beta.</p>
</div>
<div id="interprétation-des-coefficients" class="section level4">
<h4><span class="header-section-number">8.4.4.2</span> Interprétation des coefficients</h4>
<p>Puisque le modèle utilise la fonction de lien logistique, les exponentiels des coefficients <span class="math inline">\(\beta\)</span> du modèle peuvent être interprétés comme des rapports de cotes (voir la section @ref(sect0821) sur le modèle GLM binomial). Admettons ainsi que nous ayons obtenu pour une variable indépendante <span class="math inline">\(X_1\)</span> le coefficient <span class="math inline">\(\beta_1\)</span> de 0,12. Puisque le coefficient est positif, cela signifie qu’une augmentation de <span class="math inline">\(X_1\)</span> conduits à une augmentation de l’espérance de <em>Y</em>. L’exponentiel de 0,12 est 1,13, ce qui signifie qu’une augmentation d’une unité de <span class="math inline">\(X_1\)</span> multiplie par 1,13 (augmente de 13 %) les chances d’une augmentation de <em>Y</em>. <strong>Pour ce type de modèle, il est particulièrement important de calculer ses prédictions afin d’en faciliter l’interprétation</strong>.</p>
</div>
<div id="exemple-appliqué-dans-r-8" class="section level4">
<h4><span class="header-section-number">8.4.4.3</span> Exemple appliqué dans R</h4>
<p>Afin de présenter le modèle GLM avec une distribution Beta, nous utilisons un jeu de données que nous avons construit pour l’île de Montréal. Nous nous intéressons à la question des îlots de chaleur urbains au niveau des aires de diffusion (AD – entités spatiales du recensement canadien comprenant entre 400 et 700 habitants). Pour cela, nous avons calculé dans chaque AD le pourcentage de sa surface classifiée comme îlot de chaleur dans la carte des îlots de <a href="https://www.donneesquebec.ca/recherche/fr/dataset/ilots-de-chaleur-fraicheur-urbains-et-temperature-de-surface">chaleur/fraicheur</a> réalisé par l’INSPQ et le CERFO.</p>
<p>La question que nous nous posons est la suivante : les populations vulnérables socioéconomiquement et/ou physiologiquement sont-elles systématiquement plus exposées à la nuisance que représentent les îlots de chaleur? Cette question se rattache donc au champ de la recherche sur la justice environnementale et plus spécifiquement sur sa dimension spatiale (à savoir l’équité environnementale, à distinguer des dimensions procédurale et de reconnaissance). Plusieurs études se sont d’ailleurs déjà penchées sur la question des îlots de chaleur abordée sous l’angle de l’équité environnementale <span class="citation">(Harlan et al. <a href="#ref-harlan2007shade" role="doc-biblioref">2007</a>; Sanchez et Reames <a href="#ref-sanchez2019cooling" role="doc-biblioref">2019</a>; Huang, Zhou et Cadenasso <a href="#ref-huang2011everyone" role="doc-biblioref">2011</a>)</span>. Nous modélisons donc pour chaque AD (n = 3 158) de l’île de Montréal la proportion de sa surface couverte par des îlots de chaleur. Nos variables indépendantes sont divisées en deux catégories : variables environnementales et variables socio-économiques. Les premières sont des variables de contrôle, il s’agit de la densité de végétation dans l’AD (ajouté avec une polynomiale d’ordre deux) et de l’arrondissement dans lequel il se situe. Ces deux paramètres affectent directement les chances d’observer des îlots de chaleur, mais nous souhaitons isoler leurs effets (toutes choses étant égales par ailleurs) de ceux des variables socio-économiques. Ces dernières ont pour objectif de cibler les populations vulnérables sur le plan physiologique (personnes âgées et enfants de moins de 14 ans) ou socio-économique (minorités visibles et faible revenu). L’ensemble de ces variables sont présentées dans le tableau @ref(tab:variablebeta). Notez que puisque le modèle avec distribution de Beta ne peut pas prendre en compte des valeurs exactes de 1 ou 0, nous les avons remplacées respectivement par 0,99 et 0,01. Cette légère modification n’altère que marginalement les données, surtout si nous considérons qu’elles sont agrégées au niveau des AD et proviennent originalement d’imagerie satellitaire.</p>
<table>
<caption>
(#tab:variablebeta)Variables indépendantes utilisées dans le modèle Beta
</caption>
<thead>
<tr>
<th style="text-align:left;">
Nom de la variable
</th>
<th style="text-align:left;">
Signification
</th>
<th style="text-align:left;">
Type de variable
</th>
<th style="text-align:left;">
Mesure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A65PlusPct
</td>
<td style="text-align:left;">
Population de 65 ans et plus
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Pourcentage de la population ayant 65 ans et plus
</td>
</tr>
<tr>
<td style="text-align:left;">
A014Pct
</td>
<td style="text-align:left;">
Population de 14 ans et moins
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Pourcentage de la population ayant 14 ans et moins
</td>
</tr>
<tr>
<td style="text-align:left;">
PopFRPct
</td>
<td style="text-align:left;">
Population à faible revenu
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Pourcentage de la population à faible revenu
</td>
</tr>
<tr>
<td style="text-align:left;">
PopMVPct
</td>
<td style="text-align:left;">
Minorités visibles
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Pourcentage de la population faisant partie des minorités visibles
</td>
</tr>
<tr>
<td style="text-align:left;">
VegPct
</td>
<td style="text-align:left;">
Végétation
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Pourcentage de la surface de l’AD couverte par de la végétation
</td>
</tr>
<tr>
<td style="text-align:left;">
Arrond
</td>
<td style="text-align:left;">
Arrondissements
</td>
<td style="text-align:left;">
Variable continue
</td>
<td style="text-align:left;">
Arrondissement de l’Île de Montréal
</td>
</tr>
</tbody>
</table>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Sans surprise, nous commençons par charger nos données et nous nous assurons de l’absence de multicolinéarité excessive entre nos variables indépendantes.</p>
<div class="sourceCode" id="cb939"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb939-1"><a href="#cb939-1"></a><span class="co">## Chargement des données</span></span>
<span id="cb939-2"><a href="#cb939-2"></a>dataset &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/glm/data_chaleur.csv&quot;</span>,<span class="dt">fileEncoding =</span> <span class="st">&quot;utf8&quot;</span>)</span>
<span id="cb939-3"><a href="#cb939-3"></a><span class="co">## Calcul des valeurs de vif</span></span>
<span id="cb939-4"><a href="#cb939-4"></a><span class="kw">vif</span>(<span class="kw">glm</span>(hot <span class="op">~</span></span>
<span id="cb939-5"><a href="#cb939-5"></a><span class="st">          </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb939-6"><a href="#cb939-6"></a><span class="st">          </span><span class="kw">poly</span>(prt_veg, <span class="dt">degree =</span> <span class="dv">2</span>)  <span class="op">+</span><span class="st"> </span>Arrond,</span>
<span id="cb939-7"><a href="#cb939-7"></a>        <span class="dt">data =</span> dataset))</span></code></pre></div>
<pre><code>##                               GVIF Df GVIF^(1/(2*Df))
## A65Pct                    1.609917  1        1.268825
## A014Pct                   2.206072  1        1.485285
## PopFRPct                  2.162036  1        1.470386
## PopMVPct                  2.370269  1        1.539568
## poly(prt_veg, degree = 2) 2.619552  2        1.272204
## Arrond                    7.899208 32        1.032820</code></pre>
<p>La seule variable semblant poser un problème de multicolinéarité est la variable <code>Arrond</code>. Cependant, du fait de sa nature multinomiale, elle regroupe en réalité 32 coefficients (voir la colonne <code>Df</code>). Il faut donc utiliser la règle habituelle de 5 sur le carré de la troisième colonne (<code>GVIF^(1/(2*Df))</code>) du tableau <span class="citation">(Fox et Monette <a href="#ref-fox1992generalized" role="doc-biblioref">1992</a>)</span>, soit <code>1,032820^2 = 1,066717</code>, ce qui est bien inférieur à la limite de 5. Nous n’avons donc pas de problème de multicolinéarité excessive. Nous pouvons passer au calcul des distances de Cook. Pour ajuster notre modèle, nous utilisons le <em>package</em> <code>mgcv</code> et la fonction <code>gam</code> avec le paramètre <code>family = betar(link = "logit")</code>.</p>
<div class="sourceCode" id="cb941"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb941-1"><a href="#cb941-1"></a><span class="co"># Ajustement d&#39;une première version du modèle</span></span>
<span id="cb941-2"><a href="#cb941-2"></a>modele &lt;-<span class="st"> </span><span class="kw">gam</span>(hot <span class="op">~</span></span>
<span id="cb941-3"><a href="#cb941-3"></a><span class="st">                </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb941-4"><a href="#cb941-4"></a><span class="st">                </span><span class="kw">poly</span>(prt_veg, <span class="dt">degree=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>Arrond,</span>
<span id="cb941-5"><a href="#cb941-5"></a>              <span class="dt">data =</span> dataset, <span class="dt">family =</span> <span class="kw">betar</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb941-6"><a href="#cb941-6"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb941-7"><a href="#cb941-7"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb941-8"><a href="#cb941-8"></a>  <span class="dt">cooksd =</span> <span class="kw">cooks.distance</span>(modele),</span>
<span id="cb941-9"><a href="#cb941-9"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dataset)</span>
<span id="cb941-10"><a href="#cb941-10"></a>)</span>
<span id="cb941-11"><a href="#cb941-11"></a><span class="co"># Affichage des distances de Cook</span></span>
<span id="cb941-12"><a href="#cb941-12"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb941-13"><a href="#cb941-13"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cooksd),</span>
<span id="cb941-14"><a href="#cb941-14"></a>             <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>), <span class="dt">size =</span> <span class="fl">0.5</span>)<span class="op">+</span></span>
<span id="cb941-15"><a href="#cb941-15"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Distance de Cook&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cookdistbeta-1.png" alt="Distances de Cook pour le modèle GLM Beta" width="65%" />
<p class="caption">
(#fig:cookdistbeta)Distances de Cook pour le modèle GLM Beta
</p>
</div>
<p>Nous pouvons observer à la figure @ref(fig:cookdistbeta) que seulement deux observations se distinguent très nettement des autres. Nous les isolons donc dans un premier temps.</p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="#cb942-1"></a>cas_etranges &lt;-<span class="st"> </span><span class="kw">subset</span>(dataset, df<span class="op">$</span>cooksd <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.01</span>)</span>
<span id="cb942-2"><a href="#cb942-2"></a><span class="kw">print</span>(cas_etranges[,<span class="dv">23</span><span class="op">:</span><span class="kw">ncol</span>(cas_etranges)])</span></code></pre></div>
<pre><code>##      A014Pct A65Pct PopFRPct PopMVPct      Km2    HabKm2 Shape_Leng Shape_Area
## 1666   11.78  26.77     6.38    11.65 6.458460   72.3083  21153.055  6458456.6
## 2803   15.54  31.07    24.17    52.17 0.134013 5283.0879   1651.471   134012.5
##        prt_hot  prt_veg dist_cntr     Arrond  hot
## 1666  1.824483 90.11691 29.181345 Senneville 0.02
## 2803 40.117994 60.15745  4.178823  Westmount 0.40</code></pre>
<p>Ces deux observations n’ont pas de points communs marqués, et ne semblent pas avoir de valeurs particulièrement fortes sur les différentes variables indépendantes ou la variable dépendante. Nous décidons donc de les supprimer et de recalculer les distances de Cook.</p>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb944-1"><a href="#cb944-1"></a><span class="co"># Suppression des deux observations très influentes</span></span>
<span id="cb944-2"><a href="#cb944-2"></a>dataset2 &lt;-<span class="st"> </span><span class="kw">subset</span>(dataset, df<span class="op">$</span>cooksd <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.01</span>)</span>
<span id="cb944-3"><a href="#cb944-3"></a>modele2 &lt;-<span class="st"> </span><span class="kw">gam</span>(hot <span class="op">~</span></span>
<span id="cb944-4"><a href="#cb944-4"></a><span class="st">                </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb944-5"><a href="#cb944-5"></a><span class="st">                </span><span class="kw">I</span>(prt_veg<span class="op">**</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>prt_veg <span class="op">+</span><span class="st"> </span>Arrond,</span>
<span id="cb944-6"><a href="#cb944-6"></a>              <span class="dt">data =</span> dataset2, <span class="dt">family =</span> <span class="kw">betar</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="dt">methode =</span> <span class="st">&quot;REML&quot;</span>)</span>
<span id="cb944-7"><a href="#cb944-7"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb944-8"><a href="#cb944-8"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb944-9"><a href="#cb944-9"></a>  <span class="dt">cooksd =</span> <span class="kw">cooks.distance</span>(modele2),</span>
<span id="cb944-10"><a href="#cb944-10"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dataset2)</span>
<span id="cb944-11"><a href="#cb944-11"></a>)</span>
<span id="cb944-12"><a href="#cb944-12"></a><span class="co"># Affichage des distances de Cook</span></span>
<span id="cb944-13"><a href="#cb944-13"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df2)<span class="op">+</span></span>
<span id="cb944-14"><a href="#cb944-14"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cooksd),</span>
<span id="cb944-15"><a href="#cb944-15"></a>             <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>), <span class="dt">size =</span> <span class="fl">0.5</span>)<span class="op">+</span></span>
<span id="cb944-16"><a href="#cb944-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Distance de Cook&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cookdistbeta2-1.png" alt="Distances de Cook pour le modèle GLM Beta (suppression de deux observations influentes)" width="65%" />
<p class="caption">
(#fig:cookdistbeta2)Distances de Cook pour le modèle GLM Beta (suppression de deux observations influentes)
</p>
</div>
<p>Après réajustement (figure @ref(fig:cookdistbeta2)) nous constatons à nouveau qu’une observation est <strong>extrêmement</strong> éloignée des autres. Nous la retirons également, car cette différence est si forte qu’elle risque de polluer le modèle.</p>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="#cb945-1"></a><span class="co"># Suppression de l&#39;observation très étonnante</span></span>
<span id="cb945-2"><a href="#cb945-2"></a>dataset3 &lt;-<span class="st"> </span><span class="kw">subset</span>(dataset2, df2<span class="op">$</span>cooksd<span class="op">&lt;</span><span class="kw">max</span>(df2<span class="op">$</span>cooksd))</span>
<span id="cb945-3"><a href="#cb945-3"></a><span class="co"># Réajustement du modèle</span></span>
<span id="cb945-4"><a href="#cb945-4"></a>modele3 &lt;-<span class="st"> </span><span class="kw">gam</span>(hot <span class="op">~</span></span>
<span id="cb945-5"><a href="#cb945-5"></a><span class="st">                </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb945-6"><a href="#cb945-6"></a><span class="st">                </span><span class="kw">I</span>(prt_veg<span class="op">**</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>prt_veg <span class="op">+</span><span class="st"> </span>Arrond,</span>
<span id="cb945-7"><a href="#cb945-7"></a>              <span class="dt">data =</span> dataset3, <span class="dt">family =</span> <span class="kw">betar</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="dt">methode =</span> <span class="st">&quot;REML&quot;</span>)</span>
<span id="cb945-8"><a href="#cb945-8"></a><span class="co"># Calcul des distances de Cook</span></span>
<span id="cb945-9"><a href="#cb945-9"></a>df3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb945-10"><a href="#cb945-10"></a>  <span class="dt">cooksd =</span> <span class="kw">cooks.distance</span>(modele3),</span>
<span id="cb945-11"><a href="#cb945-11"></a>  <span class="dt">oid =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dataset3)</span>
<span id="cb945-12"><a href="#cb945-12"></a>)</span>
<span id="cb945-13"><a href="#cb945-13"></a><span class="co"># Affichage des distances de Cook</span></span>
<span id="cb945-14"><a href="#cb945-14"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df3)<span class="op">+</span></span>
<span id="cb945-15"><a href="#cb945-15"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> oid, <span class="dt">y =</span> cooksd),</span>
<span id="cb945-16"><a href="#cb945-16"></a>             <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>), <span class="dt">size =</span> <span class="fl">0.5</span>)<span class="op">+</span></span>
<span id="cb945-17"><a href="#cb945-17"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Distance de Cook&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cookdistbeta3-1.png" alt="Distances de Cook pour le modèle GLM Beta (suppression de trois observations influentes)" width="65%" />
<p class="caption">
(#fig:cookdistbeta3)Distances de Cook pour le modèle GLM Beta (suppression de trois observations influentes)
</p>
</div>
<p>Tout semble aller pour le mieux après ce second passage (figure @ref(fig:cookdistbeta3)). Si nous avions continué à observer des valeurs aussi influentes, nous aurions dû commencer à sérieusement questionner nos données ou notre modèle. La prochaine étape du diagnostic est donc l’analyse des résidus simulés.</p>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb946-1"><a href="#cb946-1"></a><span class="co"># Extraction de phi</span></span>
<span id="cb946-2"><a href="#cb946-2"></a>modele3<span class="op">$</span>family<span class="op">$</span>family</span></code></pre></div>
<pre><code>## [1] &quot;Beta regression(14.612)&quot;</code></pre>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb948-1"><a href="#cb948-1"></a>phi &lt;-<span class="st"> </span><span class="fl">14.612</span></span>
<span id="cb948-2"><a href="#cb948-2"></a><span class="co"># Réalisation des simulations</span></span>
<span id="cb948-3"><a href="#cb948-3"></a>nsim &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb948-4"><a href="#cb948-4"></a>mus &lt;-<span class="st"> </span>modele3<span class="op">$</span>fitted.values</span>
<span id="cb948-5"><a href="#cb948-5"></a>cols &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(mus),<span class="cf">function</span>(i){</span>
<span id="cb948-6"><a href="#cb948-6"></a>  mu &lt;-<span class="st"> </span>mus[[i]]</span>
<span id="cb948-7"><a href="#cb948-7"></a>  p &lt;-<span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>phi</span>
<span id="cb948-8"><a href="#cb948-8"></a>  q &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>mu)<span class="op">*</span>phi</span>
<span id="cb948-9"><a href="#cb948-9"></a>  sims &lt;-<span class="st"> </span><span class="kw">rbeta</span>(<span class="dt">n =</span> nsim,<span class="dt">shape1 =</span> p, <span class="dt">shape2 =</span> q)</span>
<span id="cb948-10"><a href="#cb948-10"></a>  <span class="kw">return</span>(sims)</span>
<span id="cb948-11"><a href="#cb948-11"></a>})</span>
<span id="cb948-12"><a href="#cb948-12"></a>mat_sims &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, cols)</span>
<span id="cb948-13"><a href="#cb948-13"></a><span class="co"># Calcul des résidus simulés</span></span>
<span id="cb948-14"><a href="#cb948-14"></a>sim_res &lt;-<span class="st"> </span><span class="kw">createDHARMa</span>(<span class="dt">simulatedResponse =</span> mat_sims,</span>
<span id="cb948-15"><a href="#cb948-15"></a>                           <span class="dt">observedResponse =</span> dataset3<span class="op">$</span>hot,</span>
<span id="cb948-16"><a href="#cb948-16"></a>                           <span class="dt">fittedPredictedResponse =</span> modele3<span class="op">$</span>fitted.values,</span>
<span id="cb948-17"><a href="#cb948-17"></a>                           <span class="dt">integerResponse =</span> F)</span>
<span id="cb948-18"><a href="#cb948-18"></a><span class="kw">plot</span>(sim_res)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/residsimbeta-1.png" alt="Diagnostic général des résidus simulés du modèle Beta" width="100%" />
<p class="caption">
(#fig:residsimbeta)Diagnostic général des résidus simulés du modèle Beta
</p>
</div>
<p>La figure @ref(fig:residsimbeta) indique que les résidus suivent bien une distribution uniforme. Le test des valeurs aberrantes n’est pas significatif au seuil de 0,01 (nous retenons ce seuil considérant le grand nombre de simulations et d’observations de notre jeu de données), nous décidons de ne pas supprimer davantage d’observations. Le panneau de droite indique une relation non linéaire instable, mais essentiellement centrée sur la ligne droite attendue. Pour plus de détail, nous calculons ces résidus simulés avec chacune des variables indépendantes.</p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb949-1"><a href="#cb949-1"></a><span class="co"># Préparons un plot multiple</span></span>
<span id="cb949-2"><a href="#cb949-2"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb949-3"><a href="#cb949-3"></a>vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A65Pct&quot;</span>, <span class="st">&quot;A014Pct&quot;</span>, <span class="st">&quot;PopFRPct&quot;</span>, <span class="st">&quot;PopMVPct&quot;</span>, <span class="st">&quot;prt_veg&quot;</span>)</span>
<span id="cb949-4"><a href="#cb949-4"></a><span class="cf">for</span>(v <span class="cf">in</span> vars){</span>
<span id="cb949-5"><a href="#cb949-5"></a>  <span class="kw">plotResiduals</span>(sim_res, dataset3[[v]], <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> v)</span>
<span id="cb949-6"><a href="#cb949-6"></a>}</span>
<span id="cb949-7"><a href="#cb949-7"></a><span class="kw">plotResiduals</span>(sim_res, dataset3[[<span class="st">&quot;prt_veg&quot;</span>]]<span class="op">**</span><span class="dv">2</span>, <span class="dt">xlab =</span> <span class="st">&quot;prt_veg^2&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/glm/residsimbeta2.png" alt="Relation entre chaque variable indépendante et les résidus simulés du modèle Beta" width="100%" />
<p class="caption">
(#fig:residsimbeta2)Relation entre chaque variable indépendante et les résidus simulés du modèle Beta
</p>
</div>
<p>La figure @ref(fig:residsimbeta2) indique des relations marginales et négligeables entre nos variables indépendantes et nos résidus simulés. Concernant la variable <code>Arrond</code> (figure @ref(fig:residsimbeta3)), nous observons une situation plus particulière. Pour quelques arrondissements, les résidus simulés sont nettement plus forts ou plus faibles. Notre hypothèse est que cet effet est provoqué par l’introduction de cette variable dans notre modèle comme un effet fixe alors que sa nature devrait nous inciter à l’introduire comme un effet aléatoire. Nous n’avons pas encore présenté ces concepts ici, mais nous le ferons dans le chapitre @ref(chap09). En attendant, nous conservons le modèle tel quel et passons à l’analyse de sa qualité d’ajustement.</p>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="#cb950-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb950-2"><a href="#cb950-2"></a>  <span class="dt">resid =</span> <span class="kw">residuals</span>(sim_res),</span>
<span id="cb950-3"><a href="#cb950-3"></a>  <span class="dt">Arrond =</span> dataset3<span class="op">$</span>Arrond</span>
<span id="cb950-4"><a href="#cb950-4"></a>)</span>
<span id="cb950-5"><a href="#cb950-5"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb950-6"><a href="#cb950-6"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Arrond, <span class="dt">y =</span> resid))<span class="op">+</span></span>
<span id="cb950-7"><a href="#cb950-7"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb950-8"><a href="#cb950-8"></a>        <span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>()</span>
<span id="cb950-9"><a href="#cb950-9"></a>        )<span class="op">+</span></span>
<span id="cb950-10"><a href="#cb950-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Arrondissements&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Résidus simulés&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/residsimbeta3-1.png" alt="Relation entre la variable Arrondissement et les résidus simulés du modèle Beta" width="70%" />
<p class="caption">
(#fig:residsimbeta3)Relation entre la variable Arrondissement et les résidus simulés du modèle Beta
</p>
</div>
<p><strong>Analyse de la qualité d’ajustement</strong></p>
<p>Dans un premier temps, nous comparons la distribution originale des données à des simulations issues du modèle.</p>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb951-1"><a href="#cb951-1"></a><span class="co"># Extraction de 20 simulations</span></span>
<span id="cb951-2"><a href="#cb951-2"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(mat_sims[,<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>])</span>
<span id="cb951-3"><a href="#cb951-3"></a>df3 &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(df2)</span>
<span id="cb951-4"><a href="#cb951-4"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb951-5"><a href="#cb951-5"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> hot, <span class="dt">y =</span> ..density..),</span>
<span id="cb951-6"><a href="#cb951-6"></a>                 <span class="dt">data =</span> dataset3, <span class="dt">bins =</span> <span class="dv">100</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></span>
<span id="cb951-7"><a href="#cb951-7"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y=</span>..density.., <span class="dt">group =</span> variable), <span class="dt">data =</span> df3,</span>
<span id="cb951-8"><a href="#cb951-8"></a>               <span class="dt">fill =</span> <span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">color =</span> <span class="kw">rgb</span>(<span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span>), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb951-9"><a href="#cb951-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;résidus simulés&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;densité&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/residsimbeta4-1.png" alt="Comparaison entre la distribution originale et les simulations issue du modèle" width="60%" />
<p class="caption">
(#fig:residsimbeta4)Comparaison entre la distribution originale et les simulations issue du modèle
</p>
</div>
<p>Nous constatons à la figure @ref(fig:residsimbeta4) que le modèle est parvenu à reproduire la forme générale de la distribution originale : un plus grand nombre de valeurs proches de zéro, suivies d’une répartition presque homogène dans les valeurs comprises entre 0,15 et 0,8, suivies par un plus faible nombre de valeurs quand <em>Y</em> est supérieur à 0,8. Il semble en revanche manquer un certain nombre de valeurs extrêmes proches de 0 (absence d’îlot de chaleur) et proches de 1 (couverture à 100 % par des îlots de chaleur).</p>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb952-1"><a href="#cb952-1"></a><span class="co"># Calcul des pseudo R2</span></span>
<span id="cb952-2"><a href="#cb952-2"></a><span class="kw">rsqs</span>(<span class="dt">loglike.full =</span> modele3<span class="op">$</span>deviance<span class="op">/-</span><span class="dv">2</span>,</span>
<span id="cb952-3"><a href="#cb952-3"></a>     <span class="dt">loglike.null =</span> modele3<span class="op">$</span>null.deviance<span class="op">/-</span><span class="dv">2</span>,</span>
<span id="cb952-4"><a href="#cb952-4"></a>     <span class="dt">full.deviance =</span> modele3<span class="op">$</span>deviance,</span>
<span id="cb952-5"><a href="#cb952-5"></a>     <span class="dt">null.deviance =</span> modele3<span class="op">$</span>null.deviance,</span>
<span id="cb952-6"><a href="#cb952-6"></a>     <span class="dt">nb.params =</span> modele3<span class="op">$</span>rank,</span>
<span id="cb952-7"><a href="#cb952-7"></a>     <span class="dt">n =</span> <span class="kw">nrow</span>(dataset3))</span></code></pre></div>
<pre><code>## $`deviance expliquee`
## [1] 0.9017396
## 
## $`McFadden ajuste`
## [1] 0.8992329
## 
## $`Cox and Snell`
## [1] 0.999828
## 
## $Nagelkerke
## [1] 0.9998949</code></pre>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb954-1"><a href="#cb954-1"></a><span class="co"># Calcul du RMSE</span></span>
<span id="cb954-2"><a href="#cb954-2"></a><span class="kw">sqrt</span>(<span class="kw">mean</span>((modele3<span class="op">$</span>fitted.values <span class="op">-</span><span class="st"> </span>modele3<span class="op">$</span>y)<span class="op">**</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 0.1025719</code></pre>
<p>Le modèle parvient à expliquer 90 % de la déviance totale et obtient des pseudo-R<sup>2</sup> très élevés. Il obtient cependant un <em>RMSE</em> de 0,10 soit une erreur quadratique moyenne de 10 % dans la prédiction, ce qui est tout de même important. Le modèle ne semble pas souffrir particulièrement de sur-ajustement comme les pseudo-R<sup>2</sup> auraient pu nous le laisser penser.</p>
<p>L’ensemble des coefficients du modèle sont accessibles via la fonction <code>summary</code>. Pour rappel, il est nécessaire de les convertir avec la fonction exponentielle pour pouvoir les interpréter en termes de rapport de cotes. À nouveau, nous proposons de construire dans un premier temps une figure pour observer l’effet des arrondissements.</p>
<div class="sourceCode" id="cb956"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb956-1"><a href="#cb956-1"></a><span class="co"># Identifier les coefficients pour les arrondissements</span></span>
<span id="cb956-2"><a href="#cb956-2"></a>test &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;Arrond&quot;</span>,<span class="kw">names</span>(modele3<span class="op">$</span>coefficients), <span class="dt">fixed =</span> T)</span>
<span id="cb956-3"><a href="#cb956-3"></a><span class="co"># Extraire les coefficients et les erreurs standards</span></span>
<span id="cb956-4"><a href="#cb956-4"></a>coeffs &lt;-<span class="st"> </span>modele3<span class="op">$</span>coefficients[test]</span>
<span id="cb956-5"><a href="#cb956-5"></a>err.std &lt;-<span class="st"> </span><span class="kw">summary</span>(modele3)<span class="op">$</span>se[test]</span>
<span id="cb956-6"><a href="#cb956-6"></a><span class="co"># Créer un DataFrame avec les rapports de cote et les intervalles de confiance</span></span>
<span id="cb956-7"><a href="#cb956-7"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb956-8"><a href="#cb956-8"></a>  <span class="dt">Arrond =</span> <span class="kw">gsub</span>(<span class="st">&quot;Arrond&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="kw">names</span>(coeffs), <span class="dt">fixed =</span> T),</span>
<span id="cb956-9"><a href="#cb956-9"></a>  <span class="dt">coeffs =</span> coeffs,</span>
<span id="cb956-10"><a href="#cb956-10"></a>  <span class="dt">err.std =</span> err.std,</span>
<span id="cb956-11"><a href="#cb956-11"></a>  <span class="dt">RC =</span> <span class="kw">exp</span>(coeffs),</span>
<span id="cb956-12"><a href="#cb956-12"></a>  <span class="dt">lowerRC =</span> <span class="kw">exp</span>(coeffs<span class="fl">-1.96</span><span class="op">*</span>err.std),</span>
<span id="cb956-13"><a href="#cb956-13"></a>  <span class="dt">upperRC =</span> <span class="kw">exp</span>(coeffs<span class="fl">+1.96</span><span class="op">*</span>err.std)</span>
<span id="cb956-14"><a href="#cb956-14"></a>)</span>
<span id="cb956-15"><a href="#cb956-15"></a><span class="co"># Retrouver l&#39;arrondissement de référence</span></span>
<span id="cb956-16"><a href="#cb956-16"></a>allArrond &lt;-<span class="st"> </span><span class="kw">unique</span>(dataset3<span class="op">$</span>Arrond)</span>
<span id="cb956-17"><a href="#cb956-17"></a>refArrond &lt;-<span class="st"> </span><span class="kw">setdiff</span>(allArrond, df<span class="op">$</span>Arrond)</span>
<span id="cb956-18"><a href="#cb956-18"></a><span class="co"># Créer le graphique</span></span>
<span id="cb956-19"><a href="#cb956-19"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb956-20"><a href="#cb956-20"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> lowerRC, <span class="dt">xmax =</span> upperRC, <span class="dt">y =</span> <span class="kw">reorder</span>(Arrond,RC)))<span class="op">+</span></span>
<span id="cb956-21"><a href="#cb956-21"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> RC, <span class="dt">y =</span> <span class="kw">reorder</span>(Arrond,RC)))<span class="op">+</span></span>
<span id="cb956-22"><a href="#cb956-22"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb956-23"><a href="#cb956-23"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> upperRC, <span class="dt">y =</span> <span class="kw">reorder</span>(Arrond, RC), </span>
<span id="cb956-24"><a href="#cb956-24"></a>                <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;RC : &quot;</span>,<span class="kw">round</span>(RC,<span class="dv">2</span>),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)), <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">nudge_x =</span> <span class="fl">0.3</span>)<span class="op">+</span></span>
<span id="cb956-25"><a href="#cb956-25"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">paste</span>(<span class="st">&quot;Rapport de cote (rouge : &quot;</span>,refArrond,<span class="st">&#39;)&#39;</span>,<span class="dt">sep=</span><span class="st">&#39;&#39;</span>),</span>
<span id="cb956-26"><a href="#cb956-26"></a>       <span class="dt">y =</span> <span class="st">&#39;Arrondissement&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/betaArrond-1.png" alt="Rapports de cote pour les arrondissements dans le modèle Beta" width="95%" />
<p class="caption">
(#fig:betaArrond)Rapports de cote pour les arrondissements dans le modèle Beta
</p>
</div>
<p>Nous constatons ainsi que seuls quelques arrondissements ont une différence d’exposition aux îlots de chaleur significative au seuil de 0,05 comparativement à Ahuntsic-Cartierville (figure @ref(fig:betaArrond)). Pour l’essentiel il s’agit d’arrondissements pour lesquels nous observons des rapports de cotes supérieurs à 1. Verdun, Lasalle et le Plateau Mont-Royal sont les arrondissements les plus touchés avec des chances d’observer des niveaux supérieurs de densité d’îlots de chaleur multipliés par 3,19, 2,89 et 2,74. Le reste des coefficients sont affichés dans le tableau @ref(tab:coeffsbeta).</p>
<p>Nous notons ainsi que le seul groupe associé avec une augmentation significative des chances d’observer une augmentation de la densité d’îlot de chaleur est le groupe des personnes à faible revenu (1,4 % de chance supplémentaire à chaque augmentation d’un point de pourcentage de la variable indépendante). Pour mieux cerner la taille de cet effet, nous pouvons représenter l’effet marginal de ce coefficient en maintenant toutes les autres variables à leur moyenne. Nous allons également calculer ces effets marginaux pour trois arrondissements différents : Verdun (RC le plus fort), Ahuntsic-Cartierville (la référence) et Dollard-des-Ormeaux (RC le plus faible). Nous réalisons également un second graphique pour visualiser l’effet non linéaire de la variable <em>pourcentage de végétation</em>. La figure @ref(fig:betaFR) nous indique ainsi que le rôle de l’arrondissement est plus important que celui du pourcentage de personnes à faible revenu. Cependant, nous constatons que passer de 0 % de personnes à faible revenu dans un AD à 75 % est associé avec une multiplication de la surface couverte par des îlots de chaleur par environ 1,5 (toutes choses égales par ailleurs). Le rôle de la végétation dans la réduction de la surface des îlots de chaleur est très net et non linéaire. L’essentiel de la réduction est observé entre 0 et 50 % de végétation dans un AD, au-delà de ce seuil, la réduction des îlots de chaleur par la végétation est moins flagrante. Il semblerait donc exister à Montréal une forme d’iniquité systématique pour les populations à faible revenu, qui seraient davantage exposées aux îlots de chaleur. Cependant, compte tenu de la dépendance spatiale et de l’hétéroscésadicité observée plus haut, des ajustements devraient être apportés au modèle pour confirmer ou infirmer ce résultat.</p>
<table>
<caption>
(#tab:coeffsbeta)Résultats pour le modèle GLM Beta
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Coeff.
</th>
<th style="text-align:right;">
RC
</th>
<th style="text-align:right;">
Val.p
</th>
<th style="text-align:right;">
IC 2,5 % RC
</th>
<th style="text-align:right;">
IC 97,5 % RC
</th>
<th style="text-align:right;">
Sign.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
3,468
</td>
<td style="text-align:right;">
32,059
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
25,636
</td>
<td style="text-align:right;">
40,085
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
A65Pct
</td>
<td style="text-align:right;">
-0,002
</td>
<td style="text-align:right;">
0,998
</td>
<td style="text-align:right;">
0,243
</td>
<td style="text-align:right;">
0,996
</td>
<td style="text-align:right;">
1,001
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
A014Pct
</td>
<td style="text-align:right;">
-0,006
</td>
<td style="text-align:right;">
0,994
</td>
<td style="text-align:right;">
0,035
</td>
<td style="text-align:right;">
0,988
</td>
<td style="text-align:right;">
1,000
</td>
<td style="text-align:right;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:left;">
PopFRPct
</td>
<td style="text-align:right;">
0,013
</td>
<td style="text-align:right;">
1,014
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
1,011
</td>
<td style="text-align:right;">
1,016
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
PopMVPct
</td>
<td style="text-align:right;">
-0,003
</td>
<td style="text-align:right;">
0,997
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,995
</td>
<td style="text-align:right;">
0,998
</td>
<td style="text-align:right;">
***
</td>
</tr>
<tr>
<td style="text-align:left;">
prt_veg
</td>
<td style="text-align:right;">
-0,137
</td>
<td style="text-align:right;">
0,872
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,865
</td>
<td style="text-align:right;">
0,879
</td>
<td style="text-align:right;">
***
</td>
</tr>
</tbody>
</table></li>
</ul>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb957-1"><a href="#cb957-1"></a><span class="co"># Créer un DataFrame pour la prédiction</span></span>
<span id="cb957-2"><a href="#cb957-2"></a>df &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(</span>
<span id="cb957-3"><a href="#cb957-3"></a>  <span class="dt">A65Pct =</span> <span class="kw">mean</span>(dataset3<span class="op">$</span>A65Pct),</span>
<span id="cb957-4"><a href="#cb957-4"></a>  <span class="dt">A014Pct =</span> <span class="kw">mean</span>(dataset3<span class="op">$</span>A014Pct),</span>
<span id="cb957-5"><a href="#cb957-5"></a>  <span class="dt">PopFRPct =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">75</span>, <span class="dv">1</span>),</span>
<span id="cb957-6"><a href="#cb957-6"></a>  <span class="dt">PopMVPct =</span> <span class="kw">mean</span>(dataset3<span class="op">$</span>PopMVPct),</span>
<span id="cb957-7"><a href="#cb957-7"></a>  <span class="dt">prt_veg =</span> <span class="kw">mean</span>(dataset3<span class="op">$</span>prt_veg),</span>
<span id="cb957-8"><a href="#cb957-8"></a>  <span class="dt">Arrond =</span> <span class="kw">c</span>(<span class="st">&quot;Verdun&quot;</span>,<span class="st">&#39;Ahuntsic-Cartierville&#39;</span>,<span class="st">&#39;Dollard-des-Ormeaux&#39;</span>)</span>
<span id="cb957-9"><a href="#cb957-9"></a>)</span>
<span id="cb957-10"><a href="#cb957-10"></a><span class="co"># Effectuer les prédiction sur l&#39;échelle log</span></span>
<span id="cb957-11"><a href="#cb957-11"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(modele3, df, <span class="dt">se=</span>T, <span class="dt">type =</span> <span class="st">&quot;link&quot;</span>)</span>
<span id="cb957-12"><a href="#cb957-12"></a><span class="co"># Calculer les prédictions et leurs intervalles de confiance</span></span>
<span id="cb957-13"><a href="#cb957-13"></a>ilink &lt;-<span class="st"> </span>modele3<span class="op">$</span>family<span class="op">$</span>linkinv</span>
<span id="cb957-14"><a href="#cb957-14"></a>df<span class="op">$</span>pred &lt;-<span class="st"> </span><span class="kw">ilink</span>(pred<span class="op">$</span>fit)</span>
<span id="cb957-15"><a href="#cb957-15"></a>df<span class="op">$</span>lower &lt;-<span class="st"> </span><span class="kw">ilink</span>(pred<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span><span class="st"> </span>pred<span class="op">$</span>se.fit)</span>
<span id="cb957-16"><a href="#cb957-16"></a>df<span class="op">$</span>upper &lt;-<span class="st"> </span><span class="kw">ilink</span>(pred<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span><span class="st"> </span>pred<span class="op">$</span>se.fit)</span>
<span id="cb957-17"><a href="#cb957-17"></a><span class="co"># Afficher le résultat</span></span>
<span id="cb957-18"><a href="#cb957-18"></a>P1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df)<span class="op">+</span></span>
<span id="cb957-19"><a href="#cb957-19"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> PopFRPct, <span class="dt">y =</span> pred, <span class="dt">color =</span> Arrond), <span class="dt">size =</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb957-20"><a href="#cb957-20"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> PopFRPct, <span class="dt">y =</span> lower, <span class="dt">color =</span> Arrond), <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></span>
<span id="cb957-21"><a href="#cb957-21"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> PopFRPct, <span class="dt">y =</span> upper, <span class="dt">color =</span> Arrond), <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb957-22"><a href="#cb957-22"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Pourcentage de personnes à faible revenu&quot;</span>, </span>
<span id="cb957-23"><a href="#cb957-23"></a>       <span class="dt">y =</span> <span class="st">&quot;Surface de l&#39;AD couverte par des îlots de chaleur (%)&quot;</span>,</span>
<span id="cb957-24"><a href="#cb957-24"></a>       <span class="dt">color =</span> <span class="st">&#39;Arrondissement&#39;</span>)<span class="op">+</span></span>
<span id="cb957-25"><a href="#cb957-25"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb957-26"><a href="#cb957-26"></a><span class="co"># Pour la végétation</span></span>
<span id="cb957-27"><a href="#cb957-27"></a>df2 &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(</span>
<span id="cb957-28"><a href="#cb957-28"></a>  <span class="dt">A65Pct =</span> <span class="kw">mean</span>(dataset3<span class="op">$</span>A65Pct),</span>
<span id="cb957-29"><a href="#cb957-29"></a>  <span class="dt">A014Pct =</span> <span class="kw">mean</span>(dataset3<span class="op">$</span>A014Pct),</span>
<span id="cb957-30"><a href="#cb957-30"></a>  <span class="dt">PopFRPct =</span> <span class="kw">mean</span>(dataset3<span class="op">$</span>PopFRPct),</span>
<span id="cb957-31"><a href="#cb957-31"></a>  <span class="dt">PopMVPct =</span> <span class="kw">mean</span>(dataset3<span class="op">$</span>PopMVPct),</span>
<span id="cb957-32"><a href="#cb957-32"></a>  <span class="dt">prt_veg =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">95</span>,<span class="dv">1</span>),</span>
<span id="cb957-33"><a href="#cb957-33"></a>  <span class="dt">Arrond =</span> <span class="kw">c</span>(<span class="st">&quot;Verdun&quot;</span>,<span class="st">&#39;Ahuntsic-Cartierville&#39;</span>,<span class="st">&#39;Dollard-des-Ormeaux&#39;</span>)</span>
<span id="cb957-34"><a href="#cb957-34"></a>)</span>
<span id="cb957-35"><a href="#cb957-35"></a><span class="co"># Effectuer les prédiction sur l&#39;échelle log</span></span>
<span id="cb957-36"><a href="#cb957-36"></a>pred2 &lt;-<span class="st"> </span><span class="kw">predict</span>(modele3, df2, <span class="dt">se=</span>T, <span class="dt">type =</span> <span class="st">&quot;link&quot;</span>)</span>
<span id="cb957-37"><a href="#cb957-37"></a><span class="co"># Calculer les prédictions et leurs intervalles de confiance</span></span>
<span id="cb957-38"><a href="#cb957-38"></a>df2<span class="op">$</span>pred &lt;-<span class="st"> </span><span class="kw">ilink</span>(pred2<span class="op">$</span>fit)</span>
<span id="cb957-39"><a href="#cb957-39"></a>df2<span class="op">$</span>lower &lt;-<span class="st"> </span><span class="kw">ilink</span>(pred2<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span><span class="st"> </span>pred2<span class="op">$</span>se.fit)</span>
<span id="cb957-40"><a href="#cb957-40"></a>df2<span class="op">$</span>upper &lt;-<span class="st"> </span><span class="kw">ilink</span>(pred2<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span><span class="st"> </span>pred2<span class="op">$</span>se.fit)</span>
<span id="cb957-41"><a href="#cb957-41"></a><span class="co"># Afficher le résultat</span></span>
<span id="cb957-42"><a href="#cb957-42"></a>P2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df2)<span class="op">+</span></span>
<span id="cb957-43"><a href="#cb957-43"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg, <span class="dt">y =</span> pred, <span class="dt">color =</span> Arrond), <span class="dt">size =</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb957-44"><a href="#cb957-44"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg, <span class="dt">y =</span> lower, <span class="dt">color =</span> Arrond), <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></span>
<span id="cb957-45"><a href="#cb957-45"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg, <span class="dt">y =</span> upper, <span class="dt">color =</span> Arrond), <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="op">+</span></span>
<span id="cb957-46"><a href="#cb957-46"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Pourcentage de couverture végétale&quot;</span>, <span class="dt">y =</span> <span class="st">&#39;&#39;</span>, <span class="dt">color =</span> <span class="st">&#39;Arrondissement&#39;</span>)<span class="op">+</span></span>
<span id="cb957-47"><a href="#cb957-47"></a><span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb957-48"><a href="#cb957-48"></a><span class="kw">ggarrange</span>(P1,P2, <span class="dt">common.legend =</span> T)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/betaFR-1.png" alt="Effets marginaux des variables pourcentage de personnes à faible revenu et densité de végétation" width="100%" />
<p class="caption">
(#fig:betaFR)Effets marginaux des variables pourcentage de personnes à faible revenu et densité de végétation
</p>
</div>
</div>
</div>
</div>
<div id="sect086" class="section level2">
<h2><span class="header-section-number">8.5</span> Conclusion sur les modèles linéaires généralisés</h2>
<p>Comme vous avez dû le remarquer, les modèles linéaires généralisés constituent un monde à part entière et tout un livre pourrait être rédigé à leur sujet. Leur grande flexibilité les rend extrêmement utiles dans de nombreux contextes, mais complique leur mise en œuvre, chaque modèle ayant ses propres spécificités théoriques. Ils partagent cependant tous une base commune : le choix d’une distribution et d’une fonction de lien. L’ensemble de leurs spécificités découle directement de ces deux choix.</p>
<p>La figure @ref(fig:GLMfinal) résume les choix de modèles présentés au cours de ce chapitre pour des variables qualitatives, de comptage et continues. Notez bien qu’il ne s’agit que de la partie émergée de l’iceberg, car il existe de nombreuses autres distributions plus ou moins complexes (skew-normale, log-normal, beta-binomiale, Box-Cox, Gumbel etc.). D’autres pistes pourraient aussi être explorées pour aller plus loin avec les GLM, notamment les modèles Hurdle (combinant un modèle binomial et un modèle avec une distribution continue), les modèles tronqués ou censurés (tenant compte d’une limite nette dans la variable dépendante) ou encore les modèles distributionnels ajustant une équation de régression pour chaque paramètre de la distribution utilisée.</p>
<div class="figure" style="text-align: center">
<img src="images/glm/guide_GLM.png" alt="Résumé graphique des principaux GLM abordés" width="100%" />
<p class="caption">
(#fig:GLMfinal)Résumé graphique des principaux GLM abordés
</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div id="sect087" class="section level2">
<h2><span class="header-section-number">8.6</span> Quiz de révision du chapitre</h2>
<div id="quizz_classif" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_quizz_classif;
  window.onload = function() {
    quizz_quizz_classif = new Quiz('quizz_classif', [['1', '3'],['2', '3'],'2',['1', '4'],'3',['1', '2'],'4','3',['1', '2']]);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Contrairement à un modèle LM, un GLM permet de choisir :
</div>
<div>
Relisez au besoin la section @ref(sect081)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>la distribution conditionnelle de la variable Y</label>
</td>
<td>
<input type="checkbox" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>une fonction de lien appliquée aux coefficients du modèle</label>
</td>
<td>
<input type="checkbox" name="q1" value="2"/>
</td>
</tr>
<tr>
<td>
<label>une fonction de lien appliquée à l’équation de régression du modèle</label>
</td>
<td>
<input type="checkbox" name="q1" value="3"/>
</td>
</tr>
<tr>
<td>
<label>la distribution à priori de la variable Y</label>
</td>
<td>
<input type="checkbox" name="q1" value="4"/>
</td>
</tr>
<tr>
<td>
<label>la distribution des résidus du modèle</label>
</td>
<td>
<input type="checkbox" name="q1" value="5"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
La fonction de lien est utilisée pour transformer :
</div>
<div>
Relisez au besoin la section @ref(sect0812)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>les paramètres d’un modèle et les rendre plus interprétables</label>
</td>
<td>
<input type="checkbox" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>le résultat de l’équation d’un modèle pour la contraindre à un intervalle de valeurs cohérent avec le paramètre de la distribution modélisée</label>
</td>
<td>
<input type="checkbox" name="q2" value="2"/>
</td>
</tr>
<tr>
<td>
<label>le résultat de l’équation d’un modèle pour obtenir un effet multiplicatif plutôt qu’additif des coefficients</label>
</td>
<td>
<input type="checkbox" name="q2" value="3"/>
</td>
</tr>
<tr>
<td>
<label>la variable Y pour qu’elle suive une distribution normale</label>
</td>
<td>
<input type="checkbox" name="q2" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un modèle GLM est ajusté par la méthode des moindres carrés.
</div>
<div>
Relisez au besoin la section @ref(sect0811)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q3" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Dans un modèle GLM la vraisemblance (likelihood) est :
</div>
<div>
Relisez au besoin la section @ref(sect113)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>le produit des probabilités d’observer chacune des observations selon le modèle</label>
</td>
<td>
<input type="checkbox" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>la somme des résidus du modèle</label>
</td>
<td>
<input type="checkbox" name="q4" value="2"/>
</td>
</tr>
<tr>
<td>
<label>un test de significativité du modèle</label>
</td>
<td>
<input type="checkbox" name="q4" value="3"/>
</td>
</tr>
<tr>
<td>
<label>impossible à calculer en pratique, on lui préfère le log-likelihood</label>
</td>
<td>
<input type="checkbox" name="q4" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Idéalement, les résidus simulés d’un modèle GLM devraient :
</div>
<div>
Relisez au besoin la section @ref(sect0814)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>suivre une distribution normale</label>
</td>
<td>
<input type="radio" name="q5" value="1"/>
</td>
</tr>
<tr>
<td>
<label>ne suivre aucune distribution particulière</label>
</td>
<td>
<input type="radio" name="q5" value="2"/>
</td>
</tr>
<tr>
<td>
<label>duivre une distribution uniforme</label>
</td>
<td>
<input type="radio" name="q5" value="3"/>
</td>
</tr>
<tr>
<td>
<label>être corrélés avec la variable Y</label>
</td>
<td>
<input type="radio" name="q5" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
L’AIC
</div>
<div>
Relisez au besoin la section @ref(sect0815)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>mesure de la qualité d’ajustement d’un modèle</label>
</td>
<td>
<input type="checkbox" name="q6" value="1"/>
</td>
</tr>
<tr>
<td>
<label>tient compte du nombre de paramètre dans un modèle</label>
</td>
<td>
<input type="checkbox" name="q6" value="2"/>
</td>
</tr>
<tr>
<td>
<label>mesure le niveau de significativité des coefficients d’un modèle</label>
</td>
<td>
<input type="checkbox" name="q6" value="3"/>
</td>
</tr>
<tr>
<td>
<label>pénalise les modèles avec un plus petit nombre de paramètres</label>
</td>
<td>
<input type="checkbox" name="q6" value="4"/>
</td>
</tr>
<tr>
<td>
<label>tient compte du nombre d’observations dans le modèle</label>
</td>
<td>
<input type="checkbox" name="q6" value="5"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour un modèle utilisant une distribution binomiale, le paramètre modélisé par l’équation de régression est :
</div>
<div>
Relisez au besoin la section @ref(sect0821)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>mu, la moyenne de y</label>
</td>
<td>
<input type="radio" name="q7" value="1"/>
</td>
</tr>
<tr>
<td>
<label>lambda, le nombre d’occurrence attendu pour y</label>
</td>
<td>
<input type="radio" name="q7" value="2"/>
</td>
</tr>
<tr>
<td>
<label>sigma, la variance de y</label>
</td>
<td>
<input type="radio" name="q7" value="3"/>
</td>
</tr>
<tr>
<td>
<label>p, la probabilité d’observer y = 1</label>
</td>
<td>
<input type="radio" name="q7" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Si la fonction de lien logistique est utilisée dans un modèle binomial, comment peuvent être interprétés les coefficients?
</div>
<div>
Relisez au besoin la section @ref(sect0821)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>En appliquant la fonction log aux coefficients, on obtient l’effet linéaire de ceux-ci sur la probabilité p</label>
</td>
<td>
<input type="radio" name="q8" value="1"/>
</td>
</tr>
<tr>
<td>
<label>En appliquant la fonction exp aux coefficients, on obtient l’effet linéaire de ceux-ci sur la probabilité p</label>
</td>
<td>
<input type="radio" name="q8" value="2"/>
</td>
</tr>
<tr>
<td>
<label>En appliquant la fonction exp aux coefficients, on obtient leur effet sous forme de rapport de côte sur la probabilité p</label>
</td>
<td>
<input type="radio" name="q8" value="3"/>
</td>
</tr>
<tr>
<td>
<label>En appliquant la fonction 1/exp aux coefficients, on obtient leur effet sous forme de rapport de côte sur la probabilité p</label>
</td>
<td>
<input type="radio" name="q8" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour choisir la distribution la mieux adaptée pour un modèle GLM, il est possible de :
</div>
<div>
voir section
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Consulter la littérature et retenir les distributions utilisées habituellement</label>
</td>
<td>
<input type="checkbox" name="q9" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Comparer plusieurs distributions et conserver le modèle le mieux ajusté selon les AIC</label>
</td>
<td>
<input type="checkbox" name="q9" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Utiliser systématiquement la distribution normale</label>
</td>
<td>
<input type="checkbox" name="q9" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Demander à un service de voyance</label>
</td>
<td>
<input type="checkbox" name="q9" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<button type="button" onclick="showResults(quizz_quizz_classif);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:08-GLM.Rmd-->
</div>
</div>
<div id="chap09" class="section level1">
<h1><span class="header-section-number">9</span> Régressions à effets mixtes (GLMM)</h1>
<div class="bloc_attention">
<p>Ce chapitre n’a pas encore fait l’objet d’une révision linguistique. Il comprend certainement plusieurs coquilles… Une version révisée sera mise à jour prochainement.</p>
</div>
<p>Dans les deux chapitres précédents, nous avons consécutivement présenté la méthode de la régression linéaire multiple (LM) ainsi qu’une de ses extensions, soit les modèles linéaires généralisés (GLM). Dans ce chapitre, nous poursuivons sur cette voie avec une nouvelle extension : les modèles généralisés à effet mixtes (GLMM). À la fin de cette section, vous serez en mesure de :</p>
<ul>
<li>comprendre la distinction entre un modèle GLM et un modèle GLMM;</li>
<li>distinguer un effet fixe d’un effet aléatoire;</li>
<li>formuler des modèles GLMM avec des constantes et/ou pentes aléatoires;</li>
<li>effectuer les diagnostics d’un GLMM.</li>
</ul>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons principalement les <em>packages</em> suivants :</p>
<ul>
<li>Pour créer des graphiques :
<ul>
<li><code>ggplot2</code>, le seul, l’unique!</li>
<li><code>ggpubr</code> pour combiner des graphiques et réaliser des diagrammes.</li>
<li><code>ellipse</code> pour représenter des ellipses sur certains graphiques.</li>
</ul></li>
<li>Pour ajuster des modèles GLMM :
<ul>
<li><code>lme4</code>, offrant une interface simple pour ajuster des GLMM.</li>
</ul></li>
<li>Pour analyser des modèles GLM :
<ul>
<li><code>car</code>, essentiellement pour la fonction <code>vif</code>.</li>
<li><code>DHARMa</code> pour le diagnostic des résidus simulés.</li>
<li><code>merTools</code> pour explorer les résultats d’un GLMM.</li>
<li><code>lmerTest</code> pour obtenir des tests de significativité pour les coefficients d’un GLMM.</li>
<li><code>MuMin</code> pour calculer les R<sup>2</sup> conditionnel et marginal.</li>
<li><code>performance</code> pour calculer le ICC et d’autres mesures d’ajustement.</li>
</ul></li>
</ul>
</div>
<div id="sect091" class="section level2">
<h2><span class="header-section-number">9.1</span> Introduction</h2>
<div id="sect0911" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Indépendance des observations et effets de groupes</h3>
<p>Nous avons vu dans les précédents chapitres que l’indépendance des observations est une condition d’application commune à l’ensemble des modèles de régression. Cette condition implique ainsi que chaque unité d’observation de notre jeu de données est indépendante des autres; en d’autres termes, qu’elle ne soit associée à aucune autre observation par un lien de dépendance. Prenons un exemple concret pour illustrer cette notion. Admettons que nous nous intéressons à la performance scolaire d’élèves de secondaire à Montréal. Pour cela, nous collectons la moyenne des résultats aux examens du Ministère de tous les élèves des différentes commissions scolaires de l’île de Montréal. Chaque élève appartient à une classe spécifique, et chaque classe se situe dans une école spécifique. Les classes constituent des environnements particuliers, la performance des élèves y est influencée par un ensemble de facteurs comme l’enseignant(e) et les relations entre les élèves d’une même classe. Deux élèves provenant d’une même classe sont donc lié(e)s par une forme de structure propre à leur classe et ne peuvent pas être considéré(e)s comme indépendant(e)s. De même, l’école constitue un environnement particulier pouvant influencer la performance des élèves du fait de moyens financiers plus importants, de la mise en place de programmes spéciaux, de la qualité des infrastructures (bâtiment, gymnase, cour d’école) ou d’une localisation minimisant certaines nuisances à l’apprentissage comme le bruit. À nouveau, deux élèves provenant d’une même école partagent une forme de structure qui cette fois-ci est propre à leur école. Si nous collections des données pour l’ensemble du Canada, nous pourrions étendre ce raisonnement aux villes dans lesquelles les écoles se situent et aux provinces.</p>
<p>Dans cet exemple, la dépendance entre les données est provoquée par un effet de groupe : il est possible de rassembler les observations dans des ensembles (classes et écoles) influençant vraisemblablement la variable étudiée (performance scolaire). Les effets des classes et des écoles ne sont cependant pas intrinsèques aux élèves. En effet, il est possible de changer un(e) élève de classe ou d’école, mais pas de changer son âge ou sa situation familiale. Il est ainsi possible de distinguer la population des élèves, la population des classes, et la population des écoles (figure @ref(fig:glmmecoles)). Ces effets de groupes sont plus la règle que l’exception dans l’analyse de données en sciences sociales, ce qui met à mal l’hypothèse d’indépendance des observations. Notez que les effets de groupes ne sont pas les seules formes de structures remettant en cause l’indépendance des observations. Il existe également des structures temporelles (deux observations proches dans le temps ont plus de chances de se ressembler) et spatiales (deux observations proches dans l’espace ont plus de chances de se ressembler); cependant, les cas de la dépendance temporelle et spatiale ne sont pas couverts dans ce livre, car ils sont complexes et mériteraient un ouvrage dédié.</p>
<div class="figure" style="text-align: center">
<img src="images/glmm/Hierarchie_Ecoles.png" alt="Structure hiérarchique entre élèves, classes et écoles" width="70%" />
<p class="caption">
(#fig:glmmecoles)Structure hiérarchique entre élèves, classes et écoles
</p>
</div>
<div class="bloc_aller_loin">
<p><strong>La notion de pseudo-réplication</strong></p>
<p>Les effets de dépendance causés par des structures de groupe, temporelles ou spatiales, sont regroupés sous le terme de pseudo-réplication. Il est intéressant de se pencher sur la signification de ce mot pour comprendre le problème intrinsèque causé par la dépendance entre les observations et son impact sur l’inférence.</p>
<p>Reprenons l’exemple des élèves et de la performance scolaire et admettons que nous souhaitons estimer la moyenne générale de l’ensemble des élèves sur l’île de Montréal, mais que nous ne disposons pas du jeu de données complet. Nous devons donc collecter un échantillon suffisamment grand pour estimer la moyenne pour l’ensemble de cette population. Raisonnons en termes de quantité d’informations. Si nous ne disposons d’aucune observation (nous n’avons encore interrogé aucun(e) élève), cette quantité est de 0. Si nous interrogeons un(e) premier(ère) élève, nous obtenons une donnée supplémentaire et donc un point d’information supplémentaire (+1). Admettons maintenant que nous collectons 30 observations dans une école, 10 dans une seconde et 5 dans une troisième. A priori, nous pourrions dire que nous avons ajouté 45 points d’information à notre total de connaissance. Ce serait le cas si les observations étaient indépendantes les unes des autres. Dans un tel contexte, chaque observation ajoute la même quantité d’information. Cependant, puisque les élèves issus d’une même école ont plus de chance de se ressembler, interroger les élèves d’une même école apporte moins d’information. Notez que plus la ressemblance entre les élèves d’une même école est forte, plus la quantité d’information est réduite. Nous sommes donc loin de disposer d’une quantité d’information égale à 45. Chaque réplication de l’expérience (demander à un(e) élève sa moyenne annuelle) n’apporte pas autant d’information qu’attendu si les observations étaient indépendantes, c’est pourquoi on parle de <strong>pseudo-réplication</strong>.</p>
<p>La pseudo-réplication impacte directement l’inférence statistique puisque le calcul des différents tests statistiques assume que chaque observation apporte autant d’information que les autres. En cas de présence de pseudo-réplication, la quantité d’information présente dans l’échantillon est plus petite qu’attendu. Il est possible de voir cela comme une forme de surestimation de la taille de l’échantillon. En cas de pseudo-réplication, nous disposons en réalité de moins de données que ce que l’on attendrait d’un échantillon de cette taille si les observations étaient indépendantes. La conséquence est la sous-estimation de la variabilité réelle des données et l’augmentation des risques de trouver des effets significatifs dans l’échantillon alors qu’ils ne le sont pas pour l’ensemble de la population.</p>
</div>
</div>
<div id="sect0912" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Terminologie: effets fixes et effets aléatoires</h3>
<p>Puisque les effets des classes et des écoles ne sont pas propres aux élèves, il convient de les introduire différemment dans les modèles de régression. Nous appelons un effet fixe, un effet qui est propre aux observations que nous étudions et un effet aléatoire, un effet provoqué par une structure externe (effet de groupe, effet temporel et/ou effet spatial). Un modèle combinant à la fois des effets fixes et des effets aléatoires est appelé un <strong>modèle à effets mixtes</strong>, ou GLMM pour <em>Generalized Linear Mixed Model</em>. Tous les modèles que nous avons ajustés dans les sections précédentes ne comprenaient que des effets fixes alors qu’à plusieurs reprises, des effets aléatoires induits par l’existence de structure de groupe auraient pu (dû) être utilisés. Prenons pour exemple le modèle logistique binomial visant à prédire la probabilité d’utiliser le vélo comme mode de transport pour son trajet le plus fréquent. La variable multinomiale <em>Pays</em>, représentant le pays dans lequel les personnes interrogées résident a été introduite comme un effet fixe. Cependant, l’effet du pays ne constitue pas une caractéristique propre aux individus; il s’agit plutôt d’un agrégat complexe mêlant culture, météorologie, politiques publiques et formes urbaines. À l’inverse, le sexe ou l’âge sont bien des caractéristiques intrinsèques des individus et peuvent être considérés comme des effets fixes.</p>
<p>Notez que l’utilisation du terme effet aléatoire peut porter à confusion, car il est utilisé différemment en fonction du champ d’études. Parmi les différentes définitions relevées par <span class="citation">Gelman (<a href="#ref-gelman2005analysis" role="doc-biblioref">2005</a>)</span> d’un effet aléatoire, citons les suivantes :</p>
<ul>
<li><p>Les effets fixes sont identiques pour tous les individus alors que les effets aléatoires varient (définition 1).</p></li>
<li><p>Les effets sont fixes s’ils sont intéressants en eux-mêmes, et les effets sont aléatoires si l’on s’intéresse à la population dont ils sont issus (définition 2).</p></li>
<li><p>Lorsqu’un échantillon couvre une grande part de la population, la variable correspondante est un effet fixe. Si l’échantillon couvre une faible part de la population, l’effet est aléatoire (définition 3).</p></li>
<li><p>Si l’effet est censé provenir d’une variable aléatoire, alors il s’agit d’un effet aléatoire (définition 4).</p></li>
<li><p>Les effets fixes sont estimés par la méthode des moindres carrés ou par maximum de vraisemblance alors que les effets aléatoires sont estimés avec régularisation (<em>shrinkage</em>) (définition 5).</p></li>
</ul>
<p>Il est ainsi possible de se retrouver dans des cas où un effet serait classé comme fixe selon une définition et aléatoire selon une autre. La deuxième définition suppose même qu’un effet peut être aléatoire ou fixe selon l’objectif de l’étude. La dernière définition a l’avantage d’être mathématique, mais ne permet pas de décider si un effet doit être traité comme aléatoire ou fixe. Nous ne proposons pas ici de clore le débat, mais plutôt de donner quelques pistes de réflexion pour décider si un effet doit être modélisé comme fixe ou aléatoire:</p>
<ul>
<li>Est-ce que l’effet en question est propre aux individus étudiés ou est externe aux individus? S’il est propre aux individus, il s’agit plus certainement d’un effet fixe. À titre d’exemple, il n’est pas possible de changer l’âge d’une personne, mais il est certainement possible changer sa ville de résidence.</li>
<li>Existe-t-il un nombre bien arrêté de catégories possibles pour l’effet en question? Si oui, il s’agit plus certainement d’un effet fixe. Il y a un nombre bien arrêté de catégories pour la variable sexe, mais pour la variable pays, de nombreuses autres valeurs auraient pu être ajoutées. Il est également possible de se demander s’il semble cohérent d’effectuer un échantillonnage sur les catégories en question. Dans le cas des pays, nous pourrions mener une étude à l’échelle des pays et collecter des données sur un échantillon de l’ensemble des pays. Il existe donc une population de pays, ce que nous ne pouvons pas affirmer pour la variable sexe.</li>
<li>L’effet en question est direct ou indirect? Dans le second cas, l’effet en question est un agglomérat complexe découlant de plusieurs processus n’ayant pas été mesurés directement, ce qui correspond davantage à un effet aléatoire. Ainsi, l’effet du pays de résidence des individus sur leur probabilité d’utiliser le vélo est bien une agglomération complexe d’effets (culture, météorologie, orientation des politiques publiques, formes urbaines, etc.) n’ayant pas tous été mesurés. À l’inverse, l’âge d’un individu a bien un effet direct sur sa probabilité d’utiliser le vélo.</li>
<li>L’effet est-il le même pour tous les individus, ou doit-il varier selon le groupe dans lequel l’individu se situe? Si un effet doit varier en fonction d’un groupe, il s’apparente davantage à un effet aléatoire. Pour reprendre l’exemple de l’âge, nous pourrions décider que cette caractéristique des individus n’a peut-être pas le même impact en fonction du pays dans lequel vit l’individu et l’ajouter au modèle comme un effet aléatoire.</li>
</ul>
<p>Vous comprendrez donc qu’une partie non négligeable du choix entre effet fixe ou un effet aléatoire réside dans le cadre théorique à l’origine du modèle. Maintenant que cette distinction conceptuelle a été détaillée, nous pouvons passer à la présentation statistique des modèles GLMM.</p>
</div>
</div>
<div id="sect092" class="section level2">
<h2><span class="header-section-number">9.2</span> Principes de base des GLMM</h2>
<p>Un GLMM est donc un modèle GLM introduisant à la fois des effets fixes et des effets aléatoires. Si nous ne considérons que les effets de groupes, un GLMM peut avoir trois formes : constantes aléatoires, pentes aléatoires et constantes et pentes aléatoires. Nous présentons ici ces trois formes en reprenant l’exemple ci-dessus avec des élèves intégré(e)s dans des classes et pour lesquels le niveau de performance à l’examen ministériel de mathématique nous intéresse.</p>
<div id="sect0921" class="section level3">
<h3><span class="header-section-number">9.2.1</span> GLMM avec constantes aléatoires</h3>
<p>Il s’agit de la forme la plus simple d’un GLMM. Plus spécifiquement, elle autorise le modèle à avoir une constante différente pour chaque catégorie d’une variable multinomiale. En d’autres termes, si l’on reprend l’exemple des élèves dans leurs classes, nous tentons d’ajouter dans le modèle l’idée que chaque classe a une moyenne différente en termes de performance à l’examen de mathématique. Il est assez facile de visualiser ce que cela signifie à l’aide d’un graphique. Admettons que nous modélisons la note obtenue par des élèves de secondaire à l’examen ministériel de mathématique à partir d’une autre variable continue représentant le temps de travail moyen par semaine en dehors des heures de classe et d’une variable catégorielle représentant dans quelle classe se trouve chaque élève. Notez qu’il ne s’agit pas ici de vraies données, mais de simples simulations utilisées à titre d’illustration. Si nous ne tenons pas compte des classes nous pouvons ajuster une régression linéaire simple entre nos deux variables continues comme le propose la figure @ref(fig:randominter1).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/randominter1-1.png" alt="Influence du temps de travail sur la performance scolaire d'élèves" width="70%" />
<p class="caption">
(#fig:randominter1)Influence du temps de travail sur la performance scolaire d’élèves
</p>
</div>
<p>Nous constatons que notre modèle semble bien identifier la relation positive entre le temps de travail et le niveau de performance, mais la droite de régression est très éloignée de chaque point; nous avons ainsi énormément d’erreurs de prédiction et donc des résidus importants. Jusqu’ici nous avons vu que nous pouvions ajouter un prédicteur et intégrer l’effet des classes comme un effet fixe (figure @ref(fig:randominter2)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/randominter2-1.png" alt="Influence du temps de travail sur la performance scolaire d'élèves en tenant compte de l'effet de leur classe (effet fixe)" width="70%" />
<p class="caption">
(#fig:randominter2)Influence du temps de travail sur la performance scolaire d’élèves en tenant compte de l’effet de leur classe (effet fixe)
</p>
</div>
<p>Cet ajustement constitue une nette amélioration du modèle. Prenons un instant pour reformuler clairement notre modèle à effets fixes :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \sum^k_{j=1}{\beta_j x_{2j}}\\
&amp;g(x) = x
\end{aligned}
(\#eq:glmm1)
\end{equation}\]</span>
</p>
<p>avec <span class="math inline">\(x_1\)</span> le temps de travail et <span class="math inline">\(x_2\)</span> la classe ayant <em>k-1</em> modalités (puisqu’une modalité est la référence). Nous ajustons ainsi un coefficient pour chaque classe, ce qui va avoir pour effet de tirer vers le haut ou vers le bas la prédiction du modèle en fonction de la classe. Cet effet est pour l’instant fixe, mais nous avons déterminé dans les sections précédentes qu’il serait conceptuellement plus approprié de le traiter comme un effet aléatoire.</p>
<p>Passons à présent à la reformulation de ce modèle en transformant l’effet fixe de la classe en effet aléatoire.</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma_e)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \upsilon \\
&amp;\upsilon \sim Normal(0, \sigma_{\upsilon}) \\
&amp;g(x) = x
\end{aligned}
(\#eq:glmm2)
\end{equation}\]</span>
</p>
<p>Remarquez que l’effet fixe de la classe <span class="math inline">\(\sum^k_{j=1}{\beta_j x_{2j}}\)</span> a été remplacé par <span class="math inline">\(\upsilon\)</span> qui est un terme aléatoire propre aux classes et qui suit une distribution normale centrée sur 0 (<span class="math inline">\(\upsilon \sim Normal(0, \sigma_{\upsilon})\)</span>). En d’autres termes, cela signifie que l’effet des classes sur la performance des élèves suit une distribution normale et que si nous moyennons l’effet de toutes les classes, cet effet serait de 0. Nous ne modélisons donc plus l’effet moyen de chaque classe comme dans le modèle à effets fixes, mais la variabilité de l’effet des classes, soit <span class="math inline">\(\sigma_{\upsilon}\)</span>. Notre modèle a donc deux variances, une au niveau des élèves (<span class="math inline">\(\sigma_e\)</span>) et une au niveau des classes (<span class="math inline">\(\sigma_{\upsilon}\)</span>). Cette particularité explique souvent pourquoi ce type de modèle est appelé un modèle hiérarchique ou un modèle de partition de la variance. Cette information est particulièrement intéressante, car elle permet de calculer la part de la variance présente au niveau des élèves et celle au niveau des classes.</p>
<p>Selon cette formulation, les constantes propres à chaque classe sont issues d’une distribution normale (nous reviendrons d’ailleurs sur ce choix plus tard), mais elles n’apparaissent pas directement dans le modèle. Ces paramètres ne sont plus estimés directement dans le modèle, mais a posteriori à partir des prédictions du modèle, et sont appelés <em>Best Linear Unbiased Predictor</em> (<em>BLUP</em>). Ces dernières précisions devraient d’ailleurs mieux vous aider à comprendre l’origine des définitions 1, 2 et 4 que nous avions mentionnées précédemment.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/randominter3-1.png" alt="Influence du temps de travail sur la performance scolaire d'élèves en tenant compte de l'effet de leur classe (effet aléatoire)" width="70%" />
<p class="caption">
(#fig:randominter3)Influence du temps de travail sur la performance scolaire d’élèves en tenant compte de l’effet de leur classe (effet aléatoire)
</p>
</div>
<p>En comparant les deux figures @ref(fig:randominter2) et @ref(fig:randominter3), la différence ne saute pas aux yeux; vous pourriez alors légitimement vous demander pourquoi tous ces efforts et cette complexité théorique pour une différence d’ajustement minime? Trois arguments permettent de justifier l’utilisation de constantes aléatoires plutôt que d’effets fixes dans notre cas.</p>
<div id="sect09221" class="section level4">
<h4><span class="header-section-number">9.2.1.1</span> Resserrement (<em>shrinkage</em>) et mutualisation (<em>partial pooling</em>)</h4>
<p>Le premier intérêt d’utiliser un effet aléatoire réside dans sa méthode d’estimation qui diffère largement d’un effet fixe. Il est assez facile de se représenter intuitivement la différence entre les deux. Dans le cas de nos élèves et de nos classes, lorsque l’effet des classes est estimé avec un effet fixe, l’effet de chaque classe est déterminé de façon totalement indépendante des autres classes. En d’autres termes, il n’est possible d’en apprendre plus sur une classe qu’en collectant des données dans cette classe (<em>separate pooling</em>). Si l’effet des classes est estimé comme un effet aléatoire, alors l’information entre les classes est mutualisée (<em>partial pooling</em>). L’idée étant que l’information que l’on apprend sur des élèves dans une classe est au moins en partie valide dans les autres classes. Cette méthode d’estimation est particulièrement intéressante si nous ne disposons que de peu d’observations dans certaines classes, puisque nous pouvons apprendre au moins une partie de l’effet de cette classe à partir des données des autres classes. Ceci n’est pas possible dans le cas d’un effet fixe où l’on traite chaque classe en silo. <span class="citation">McElreath (<a href="#ref-mcelreath2020statistical" role="doc-biblioref">2020</a>)</span> écrit à ce sujet qu’un effet fixe « n’a pas de mémoire » et qu’il oublie tout ce qu’il a appris sur les classes lorsqu’il passe à une nouvelle classe. La conséquence de cette mutualisation de l’information est un resserrement (<em>shrinkage</em>) des effets des classes autour de leur moyenne. Cela signifie que les tailles des effets de chaque classe sont plus petites dans le cas d’un effet aléatoire que d’un effet fixe. Utiliser des effets aléatoires conduit donc à une estimation plus conservatrice de l’effet des classes. Nous pouvons le visualiser en comparant les effets de classes dans le modèle à effets mixtes et le modèle à effets fixes. La figure @ref(fig:randominter5) montre clairement que les effets aléatoires tendent à se rapprocher (resserrement) de leur moyenne (ligne noire) et donc à identifier des effets moins extrêmes pour chaque classe. Cette explication est directement en lien avec la définition 5 d’un effet aléatoire vu précédemment.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/randominter5-1.png" alt="Comparaison des effets des classes pour le modèle à effets fixes versus le modèle effets aléatoires" width="70%" />
<p class="caption">
(#fig:randominter5)Comparaison des effets des classes pour le modèle à effets fixes versus le modèle effets aléatoires
</p>
</div>
</div>
<div id="sect09222" class="section level4">
<h4><span class="header-section-number">9.2.1.2</span> Prédiction pour de nouveaux groupes</h4>
<p>Une autre retombée directe de la mutualisation de l’information est la capacité du modèle à envisager les effets plausibles pour de nouvelles classes. En effet, puisque nous avons approximé l’effet des classes sous forme d’une distribution normale dont nous connaissons la moyenne (0) et l’écart-type (<span class="math inline">\(\sigma_{\upsilon}\)</span>), nous pouvons <strong>simuler</strong> des données pour de nouvelles classes, ce que ne permet pas un effet fixe. Ce constat est d’ailleurs directement lié à la définition 3 des effets aléatoires vue précédemment. Dans notre cas, <span class="math inline">\(\sigma_{\upsilon}\)</span> = 3,542, ce qui nous permet d’affirmer que dans 95 % des classes, l’effet de la classe sur la performance scolaire doit se trouver entre -1,96 <span class="math inline">\(\times\)</span> 3,542 et +1,96 <span class="math inline">\(\times\)</span> 3,542, soit l’intervalle [-6,942, 6,942].</p>
</div>
<div id="sect09223" class="section level4">
<h4><span class="header-section-number">9.2.1.3</span> Partition de la variance</h4>
<p>Un autre avantage net de l’effet aléatoire est l’estimation du paramètre <span class="math inline">\(\sigma_{\upsilon}\)</span>, soit la variance au niveau des écoles. Ce dernier permet de calculer un indicateur très intéressant, soit le <strong>coefficient de corrélation intraclasse (ICC)</strong> :</p>

<p><span class="math display">\[\begin{equation}
ICC = \frac{\sigma_{\upsilon}}{\sigma_{\upsilon} + \sigma_{e}}
(\#eq:glmm3)
\end{equation}\]</span>
</p>
<p>Il s’agit donc du pourcentage de la variance présente au niveau des classes, qui peut être interprétée comme le niveau de corrélation (de ressemblance) entre les élèves d’une même classe.</p>
<p>Dans notre cas, l’écart-type est de 3,542 au niveau des classes et de 7,734 au niveau des élèves. Nous pouvons donc calculer l’ICC au niveau des classes avec la formule précédente : 3,542 / (3,542 + 7,734) = 0,314. Cela signifie que le niveau de corrélation entre deux élèves d’une même classe est de 0,314 ou encore que 31,4% de la variance de <em>Y</em> se situe au niveau des classes, ce qui est conséquent. Une telle information ne peut être extraite d’un modèle avec uniquement des effets fixes. Notez ici que l’ICC peut être calculé pour chaque niveau d’un modèle à effet mixte. Dans notre exemple, nous n’avons qu’un seul niveau au-dessus des élèves, soit les classes, mais nous pourrions étendre cette logique à des écoles, par exemple. Notez également que cette formule de l’ICC n’est valide que pour un modèle pour lequel la distribution de la variable <em>Y</em> est normale. Des développements apparaissent pour proposer d’autres formulations adaptées à d’autres distributions, mais il est également possible d’estimer l’ICC à partir des simulations issues du modèle <span class="citation">(Nakagawa, Johnson et Schielzeth <a href="#ref-NakagawaICC" role="doc-biblioref">2017</a>; Aly et al. <a href="#ref-aly2014reliability" role="doc-biblioref">2014</a>; Stryhn et al. <a href="#ref-stryhn2006interpretation" role="doc-biblioref">2006</a>; Wu, Crespi et Wong <a href="#ref-wu2012comparison" role="doc-biblioref">2012</a>)</span>. L’idée générale reste d’expliquer la partition de la variance dans le modèle.</p>
<p>En plus de l’ICC, il est également possible de calculer les <strong>R<sup>2</sup> marginal et conditionnel</strong> du modèle. Le premier représente la variance expliquée par le modèle si seulement les effets fixes sont pris en compte, et le second si les effets fixes et aléatoires sont pris en compte. Distinguer les deux sources d’information permet de mieux cerner l’importance du rôle des écoles dans la performance des élèves. Dans notre cas, nous obtenons un R<sup>2</sup> marginal de 0,115 et un R<sup>2</sup> conditionnel de 0,269, ce qui nous confirme à nouveau que le rôle joué par la classe dans le niveau de performance est loin d’être négligeable.</p>
</div>
</div>
<div id="sect0923" class="section level3">
<h3><span class="header-section-number">9.2.2</span> GLMM avec pentes aléatoires</h3>
<p>Dans cette seconde version du GLMM, nous n’envisageons plus de faire varier une constante en fonction des classes, mais un coefficient en fonction des classes. Admettons que nous voulions tester ici si l’effet du temps de travail (<span class="math inline">\(x_1\)</span>) sur la performance scolaire (<em>Y</em>) ne serait pas constant partout. En d’autres termes, nous supposons que, dans certaines classes, le temps de travail hebdomadaire en dehors de l’école serait plus ou moins efficace que d’autres. L’idée sous-jacente est que nous n’observons pas de différence en termes de moyenne entre deux classes, mais en termes d’effet pour notre variable <span class="math inline">\(x_1\)</span>. À nouveau, nous pourrions nous contenter d’un effet fixe pour intégrer cette idée dans notre modèle. Pour cela, nous avons simplement à ajouter une interaction entre notre variable quantitative <em>temps de travail</em> et notre variable qualitative <em>classe</em>. Nous obtenons le résultat décrit par la figure @ref(fig:randomslope). Notez ici que la constante est bien la même pour chaque classe (les lignes s’intersectent à 0 sur l’axe des x), et que seule la pente change.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/randomslope-1.png" alt="Influence du temps de travail sur la performance scolaire d'élèves en interraction avec la classe (effet fixe)" width="70%" />
<p class="caption">
(#fig:randomslope)Influence du temps de travail sur la performance scolaire d’élèves en interraction avec la classe (effet fixe)
</p>
</div>
<p>La formulation de ce modèle à effets fixes seulement est la suivante :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \sum^k_{j=1}{\beta_j x_{2j} x_1}\\
&amp;g(x) = x
\end{aligned}
(\#eq:glmm4)
\end{equation}\]</span>
</p>
<p>Nous constatons donc que nous avons un effet principal <span class="math inline">\(\beta_1\)</span> décrivant le lien entre le temps de travail et la note obtenue à l’examen pour l’ensemble des élèves, ainsi qu’un bonus ou un malus sur cet effet <span class="math inline">\(\beta_j\)</span> s’appliquant en fonction de la classe. Nous pouvons reformuler ce modèle pour inclure cet effet spécifique par classe comme un effet aléatoire :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma_e)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \upsilon x_1 \\
&amp;\upsilon \sim Normal(0,\sigma_{\upsilon})\\
&amp;g(x) = x
\end{aligned}
(\#eq:glmm5)
\end{equation}\]</span>
</p>
<p>Nous formulons ici un modèle dans lequel la classe modifie l’impact de la variable temps d’étude sur la variable note à l’examen. L’effet moyen de <span class="math inline">\(x_1\)</span> (propre aux individus) est capté par le coefficient <span class="math inline">\(\beta_1\)</span>, les bonus ou malus ajoutés à cet effet par la classe sont issues d’une distribution normale centrée sur 0 avec un écart-type, soit <span class="math inline">\(\sigma_{\upsilon}\)</span>. À nouveau, l’idée est que si nous moyennions l’effet de toutes les classes, nous obtiendrions 0. Aussi, le fait de modéliser cet effet comme un effet aléatoire nous permet de partitionner la variance, de mutualiser l’information entre les classes et de resserrer l’estimation des effets des classes.</p>
<p>Les résultats pour ce second modèle sont présentés à la figure @ref(fig:randomslope2), et une comparaison entre les estimations des effets fixes et des effets aléatoires est présentée à la figure @ref(fig:randomslope3). Nous pouvons ainsi constater à nouveau l’effet de resserrement provoqué par l’effet aléatoire.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/randomslope2-1.png" alt="Influence du temps de travail sur la réussite scolaire d'élèves en interraction avec la classe (effet aléatoire)" width="70%" />
<p class="caption">
(#fig:randomslope2)Influence du temps de travail sur la réussite scolaire d’élèves en interraction avec la classe (effet aléatoire)
</p>
</div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/randomslope3-1.png" alt="Influence du temps de travail sur la réussite scolaire d'élèves en interraction avec la classe (effet aléatoire)" width="70%" />
<p class="caption">
(#fig:randomslope3)Influence du temps de travail sur la réussite scolaire d’élèves en interraction avec la classe (effet aléatoire)
</p>
</div>
<p>Lorsque nous intègrons des pentes aléatoires dans un modèle, nous faisons face au problème suivant : la variance associée aux pentes aléatoires n’est pas fixe, mais proportionnelle à la variable <em>X</em> autorisée à varier. Si nous comparons la figure @ref(fig:randominter3) (constantes aléatoires) et la figure @ref(fig:randomslope2) (pentes aléatoires), nous constatons bien que la dispersion des prédictions du modèle (représentées par les lignes) augmente dans le cas de pentes aléatoires et reste identique dans le cas des constantes aléatoires. La conséquence pratique est qu’il existe un nombre infini de valeurs possibles pour l’ICC. Dans ce contexte, il est préférable de laisser de côté cet indicateur et de ne reporter que les R<sup>2</sup> marginal et conditionnel. Dans notre cas, nous obtenons les valeurs 0,109 et 0,258, ce qui confirme une fois encore que le rôle joué par la classe est loin d’être négligeable.</p>
</div>
<div id="sect0924" class="section level3">
<h3><span class="header-section-number">9.2.3</span> GLMM avec constantes et pentes aléatoires</h3>
<p>Vous l’aurez certainement deviné en lisant le titre de cette section : il est tout à fait possible de combiner à la fois des constantes et des pentes aléatoires dans un modèle. Cela augmente bien sûr la complexité du modèle et introduit quelques subtilités comme la notion de distribution normale multivariée, mais chaque chose en son temps.</p>
<p>Si nous reprenons notre exemple avec nos élèves et nos classes, combiner à la fois des constantes et des pentes aléatoires revient à formuler l’hypothèse que chaque classe a un effet sur la moyenne de la performance de ses élèves, mais également un effet sur l’efficacité du temps de travail. Il serait possible de créer un modèle avec uniquement des effets fixes tenant compte de ces deux aspects en ajoutant dans le modèle la variable multinomiale classe ainsi que son interaction avec la variable temps de travail. La formulation de ce modèle à effets fixes est la suivante :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \sum^k_{j=1}{\beta_{2j}  x_{2j} + \beta_{3j} x_{2j}  x_1}\\
&amp;g(x) = x
\end{aligned}
(\#eq:glmm6)
\end{equation}\]</span>
</p>
<p>Nous pouvons représenter les résultats de ce modèle avec la figure @ref(fig:fullrandom1).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fullrandom1-1.png" alt="Influence du temps de travail sur la performance scolaire d'élèves en tenant compte de l'effet de leur classe et de l'impact de la classe sur l'efficacité du temps de travail (effet fixe)" width="70%" />
<p class="caption">
(#fig:fullrandom1)Influence du temps de travail sur la performance scolaire d’élèves en tenant compte de l’effet de leur classe et de l’impact de la classe sur l’efficacité du temps de travail (effet fixe)
</p>
</div>
<p>Nous reformulons à présent ce modèle pour intégrer l’effet moyen de chaque classe (constante) et l’effet des classes sur l’efficacité du temps de travail (pente) comme deux effets aléatoires :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \upsilon_1 + (\beta_1 + \upsilon_2) x_1\\
&amp;\left(\begin{array}{l}
\upsilon_{1} \\
\upsilon_{2}
\end{array}\right) \sim \mathcal{N}\left(\left(\begin{array}{l}
0 \\
0
\end{array}\right),\left(\begin{array}{cc}
\sigma_{\upsilon_1} &amp; \sigma_{\upsilon_1\upsilon_2} \\
 \sigma_{\upsilon_1\upsilon_2} &amp; \sigma_{\upsilon_1}
\end{array}\right)\right) \\
&amp;g(x) = x
\end{aligned}
(\#eq:glmm7)
\end{equation}\]</span>
</p>
<p>Pas de panique! Cette écriture peut être interprétée de la façon suivante :</p>
<p>Le modèle a deux effets aléatoires, l’un faisant varier la constante en fonction de la classe (<span class="math inline">\(\upsilon_1\)</span>) et l’autre l’effet de la classe sur l’efficacité du temps de travail (<span class="math inline">\(\upsilon_2\)</span>). Ces deux effets sont issus d’une distribution normale bivariée (une dimension par effet aléatoire). Cette distribution normale bivariée a donc deux moyennes et ces deux moyennes sont à 0 (les effets s’annulent si nous considérons toutes les classes ensembles). Elle dispose également d’une variance par effet aléatoire (<span class="math inline">\(\sigma_{\upsilon_1}\)</span> et <span class="math inline">\(\sigma_{\upsilon_2}\)</span>) et d’une covariance entre les deux effets aléatoires (<span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}\)</span>). Cette covariance permet de tenir compte du fait que, potentiellement, les classes avec une constante plus élevée pourraient systématiquement avoir une efficacité du temps de travail plus faible ou plus élevée. Cette formulation implique donc d’ajuster trois paramètres de variance : <span class="math inline">\(\sigma_{\upsilon_1}\)</span>, <span class="math inline">\(\sigma_{\upsilon_2}\)</span> et <span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}\)</span>. Il peut arriver que nous n’ayons pas d’assez de données pour estimer ces trois paramètres, ou que nous décidions pour des raisons théoriques qu’aucune corrélation ne soit attendue entre <span class="math inline">\(\sigma_{\upsilon_1}\)</span> et <span class="math inline">\(\sigma_{\upsilon_2}\)</span>. Dans ce cas, il est possible de fixer <span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}\)</span> à 0, ce qui revient à indiquer au modèle que <span class="math inline">\(\upsilon_1\)</span> et <span class="math inline">\(\upsilon_2\)</span> proviennent de deux distributions normales distinctes, nous pouvons donc écrire :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \upsilon_1 + (\beta_1 + \upsilon_2) x_1\\
&amp;\left(\begin{array}{l}
\upsilon_{1} \\
\upsilon_{2}
\end{array}\right) \sim \mathcal{N}\left(\left(\begin{array}{l}
0 \\
0
\end{array}\right),\left(\begin{array}{cc}
\sigma_{\upsilon_1} &amp; 0 \\
 0 &amp; \sigma_{\upsilon_1}
\end{array}\right)\right) \\
&amp;g(x) = x
\end{aligned}
(\#eq:glmm8)
\end{equation}\]</span>
</p>
<p>Ce qui est identique à :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \upsilon_1 + (\beta_1 + \upsilon_2) x_1\\
&amp;\upsilon_{1} \sim Normal(0,\sigma_{\upsilon_1}) \\
&amp;\upsilon_{2} \sim Normal(0,\sigma_{\upsilon_2}) \\
&amp;g(x) = x
\end{aligned}
(\#eq:glmm9)
\end{equation}\]</span>
</p>
<p>Nous avons déjà abordé la notion de covariance dans la section @ref(sect042). Pour rappel, la covariance dépend de l’unité de base des deux variables sur laquelle elle est calculée. Ici, il s’agit d’un coefficient et d’une constante. Il est donc préférable de la standardiser pour obtenir la corrélation entre les deux effets :</p>

<p><span class="math display">\[\begin{equation}
corr(\upsilon_1;\upsilon_2) = \frac{\sigma_{\upsilon_1\upsilon_2}}{\sqrt{\sigma_{\upsilon_1}}\sqrt{\sigma_{\upsilon_2}}}
(\#eq:glmm10)
\end{equation}\]</span>
</p>
<p>Si cette corrélation est positive, cela signifie que les classes ayant tendance à avoir un effet positif sur la performance scolaire ont également tendance à influencer positivement l’efficacité du temps de travail. À l’inverse, une corrélation négative signifierait que l’efficacité du temps de travail a tendance à être plus faible dans les classes où la performance scolaire moyenne est élevée. Si la corrélation n’est pas significative, c’est que les deux effets sont indépendants l’un de l’autre.</p>
<p>Pour cet exemple, nous conservons la première formulation afin de montrer comment interpréter <span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}\)</span>, mais nous ne disposons probablement pas de suffisamment de classes différentes pour estimer correctement ces trois paramètres. Les résultats de ce modèle sont représentés à la figure @ref(fig:fullrandom2).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fullrandom2-1.png" alt="Influence du temps de travail sur la performance scolaire d'élèves en tenant compte de l'effet de leur classe et de l'impact de la classe sur l'efficacité du temps de travail (effet aléatoire)" width="70%" />
<p class="caption">
(#fig:fullrandom2)Influence du temps de travail sur la performance scolaire d’élèves en tenant compte de l’effet de leur classe et de l’impact de la classe sur l’efficacité du temps de travail (effet aléatoire)
</p>
</div>
<p>Nous pouvons ainsi constater que pour ce troisième modèle, l’effet de resserrement est bien plus prononcé que pour les modèles précédents (figure @ref(fig:fullrandom3)). Si nous nous fions au modèle à effets fixes (figure @ref(fig:fullrandom1)), alors l’impact de l’école sur l’efficacité du temps de travail est très important. En revanche, le modèle à effet aléatoire identifie que la différence de moyenne entre les écoles est importante, mais la différence en termes d’efficacité du temps de travail est beaucoup plus anecdotique.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/fullrandom3-1.png" alt="Comparaison des effets fixes et aléatoires pour le modèle intégrant l'effet des classes et l'interaction entre les classes et le temps de travail" width="90%" />
<p class="caption">
(#fig:fullrandom3)Comparaison des effets fixes et aléatoires pour le modèle intégrant l’effet des classes et l’interaction entre les classes et le temps de travail
</p>
</div>
<p>Notre modèle estime les valeurs de <span class="math inline">\(\sigma_{\upsilon_1}\)</span> à 8,563, de <span class="math inline">\(\sigma_{\upsilon_2}\)</span> à 0,042 et de <span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}\)</span> à 0,073. La corrélation entre les deux effets est donc de 0,122 ce qui est relativement faible (pour l’anecdote, notez que la valeur originale de corrélation entre ces deux effets était de 0,1 lorsque nous avons simulé ces données, notre modèle a donc bien été capable de retrouver le paramètre original). À nouveau, puisque nous avons des pentes aléatoires dans ce modèle, nous ne pouvons pas calculer l’ICC; nous pouvons cependant rapporter les R<sup>2</sup> marginal et conditionnel. Leurs valeurs respectives sont 0,115 et 0,269, ce qui nous confirme une nouvelle fois que l’ajout d’effets aléatoires contribue à expliquer une partie importante de la variance de la performance scolaire.</p>
<p>Pour terminer cette section, comparons brièvement les trois modèles (constantes aléatoires, pentes aléatoires, constantes et pentes aléatoires) pour déterminer lequel est le mieux ajusté à nos données. Nous ajoutons également un quatrième modèle dans lequel les deux effets aléatoires sont présents, mais non corrélés (<span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}=0\)</span>). Le tableau @ref(tab:fullrandom4) nous permet de constater que l’ajout des constantes aléatoires joue un rôle essentiel dans le premier modèle : le R<sup>2</sup> conditionnel est plus que deux fois supérieur au R<sup>2</sup> marginal. Cependant, l’ajout des pentes aléatoires dans les trois autres modèles apporte finalement très peu d’information, nous laissant penser que l’effet de la classe sur le temps de travail est faible, voire inexistant.</p>
<table>
<caption>
(#tab:fullrandom4)Comparaison des trois modèles à effets aléatoires
</caption>
<thead>
<tr>
<th style="text-align:left;">
modèle
</th>
<th style="text-align:right;">
AIC
</th>
<th style="text-align:right;">
R2 marginal
</th>
<th style="text-align:right;">
R2 conditionnel
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Constantes aléatoires
</td>
<td style="text-align:right;">
2 100,9
</td>
<td style="text-align:right;">
0,12
</td>
<td style="text-align:right;">
0,27
</td>
</tr>
<tr>
<td style="text-align:left;">
Pentes aléatoires
</td>
<td style="text-align:right;">
2 101,6
</td>
<td style="text-align:right;">
0,11
</td>
<td style="text-align:right;">
0,26
</td>
</tr>
<tr>
<td style="text-align:left;">
Pentes et constantes aléatoires corrélées
</td>
<td style="text-align:right;">
2 104,7
</td>
<td style="text-align:right;">
0,11
</td>
<td style="text-align:right;">
0,27
</td>
</tr>
<tr>
<td style="text-align:left;">
Pentes et constantes aléatoires non-corrélées
</td>
<td style="text-align:right;">
2 102,7
</td>
<td style="text-align:right;">
0,11
</td>
<td style="text-align:right;">
0,27
</td>
</tr>
</tbody>
</table>
<div class="bloc_aller_loin">
<p><strong>Modèles à effets mixtes avec des structures croisées</strong></p>
<p>Jusqu’à présent, nous avons abordé des modèles GLMM comprenant des structures imbriquées (<em>nested</em> en anglais), c’est-à-dire qu’une observation d’un niveau 1 est incluse dans un et un seul groupe du niveau 2. Comme structure imbriquée à trois niveaux, nous avons vu comme exemple des élèves intégrés dans des classes elles-mêmes intégrées dans des écoles (figure @ref(fig:glmmecoles)) : un élève appartient à une et une seule classe qui est elle-même localisée dans une et une seule école (élève / classe / école).</p>
<p>Notez qu’il est aussi possible d’avoir des structures des données croisées (<em>crossed</em>).</p>
<p>Admettons à présent que nous ne nous intéressons pas à la classe dans laquelle se situe l’élève, mais plutôt à l’enseignant(e). Admettons également que les enseignant(e)s peuvent donner des cours dans plusieurs écoles. Nous nous retrouvons dans un cas de figure où un(e) enseignant(e) peut se situer dans plusieurs écoles, ce qui diffère du cas précédent où chaque classe appartient à une seule école. Dans ce second cas, on parle d’une <strong>structure croisée</strong> plutôt qu’imbriquée.</p>
<p>Si les professeur(e)s enseignent dans toutes les écoles, il est possible de dire que le design d’étude est croisé complet ou croisé partiel si les professeur(e)s n’enseignent que dans certaines écoles. La figure @ref(fig:crossednested) résume ces trois situations.</p>
<div class="figure" style="text-align: center">
<img src="images/glmm/glmm_croise-nested.png" alt="Différentes structures de données hiérarchiques (imbriquée versus croisée)" width="50%"  />
<p class="caption">
(#fig:crossednested)Différentes structures de données hiérarchiques (imbriquée versus croisée)
</p>
</div>
<p>Il est important de bien saisir la structure de son jeu de données, car l’estimation d’un modèle avec effets imbriqués ou croisés peut donner des résultats parfois significativement différents. De plus, un modèle imbriqué est généralement moins difficile à ajuster qu’un modèle croisé. En effet, dans un modèle imbriqué, deux élèves venant de deux écoles différentes sont jugé(e)s indépendant(e)s. Dans un modèle croisé, deux élèves provenant de deux écoles différentes peuvent tout de même partager une dépendance du fait qu’ils ou elles ont pu avoir le ou la même professeur(e). La structure de dépendance (et donc de la matrice de covariance des effets aléatoires) est ainsi plus complexe pour un modèle croisé.</p>
</div>
</div>
</div>
<div id="sect093" class="section level2">
<h2><span class="header-section-number">9.3</span> Conditions d’application des GLMM</h2>
<p>Puisque les GLMM sont une extension des GLM, ils partagent l’essentiel des conditions d’application de ces derniers. Pour simplifier, si vous ajustez un modèle GLMM avec une distribution Gamma, vous devez réaliser les mêmes tests que ceux pour un simple GLM avec distribution Gamma.</p>
<p>Une question importante se pose souvent lorsque l’on ajuste des modèles GLMM : <strong>combien de groupes faut-il au minimum aux différents niveaux?</strong> En effet, pour estimer les différentes variances, nous devons disposer de suffisamment de groupes différents. Dans le cas d’un modèle avec uniquement une constante aléatoire, il est fréquent de lire que l’on doit disposer au minimum de cinq groupes différents <span class="citation">(Gelman et Hill <a href="#ref-gelman2006data" role="doc-biblioref">2006</a>)</span>, en dessous de ce minimum, traiter l’effet comme aléatoire plutôt que fixe apporte très peu d’information. De plus, l’estimation des variances pour chaque niveau sera très imprécise, donnant potentiellement des valeurs inexactes pour le ICC et polluant l’interprétation. Avec cinq groupes ou moins, il est certainement plus judicieux d’ajuster seulement un effet fixe. Dans un modèle avec plusieurs effets aléatoires et plusieurs variances / covariances à estimer, ce nombre doit être augmenté proportionnellement, à moins que les effets aléatoires ne soient estimés indépendamment les uns des autres. Notez ici que si l’enjeu du modèle était d’estimer avec une grande précision les paramètres de variances, il faudrait compter au minimum une centaine de groupes. Il n’est pas nécessaire d’avoir le même nombre d’observations par groupe car, les modèles GLMM partagent l’information entre les groupes. Cependant, dans les groupes avec peu d’observations (&lt;15), l’estimation de leur effet propre (BLUP) sera très incertaine.</p>
<p>Puisque les GLMM font intervenir la distribution normale aux niveaux supérieurs du modèle, il est nécessaire de vérifier si les hypothèses qu’elle implique sont respectées. Il s’agit essentiellement de deux hypothèses : les effets aléatoires suivent bien une distribution normale (univariée ou multivariée), et la variance au sein des groupes est bien homogène.</p>
<div id="sect0931" class="section level3">
<h3><span class="header-section-number">9.3.1</span> Vérification de la distribution des effets aléatoires</h3>
<p>Reprenons la formulation d’un modèle simple avec seulement deux niveaux et seulement une constante aléatoire:</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma_e)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \upsilon \\
&amp;\upsilon \sim Normal(0, \sigma_{\upsilon}) \\
&amp;g(x) = x
\end{aligned}
\end{equation}\]</span>
</p>
<p>Ce modèle formule l’hypothèse que les constantes aléatoires <span class="math inline">\(\upsilon\)</span> proviennent d’une distribution normale avec une moyenne de 0 et un écart-type <span class="math inline">\(\sigma_{\upsilon}\)</span>. La première étape du diagnostic est donc de vérifier si les constantes aléatoires suivent bien une distribution normale, ce que nous pouvons faire habituellement avec un diagramme quantile-quantile. Si nous reprenons notre exemple avec nos données de performance scolaire des sections précédentes, nous obtenons la figure @ref(fig:diagglmm1). Puisque les points tombent bien approximativement sur la ligne rouge, nous pouvons conclure que cette condition d’application est bien respectée. Notez qu’il est également possible d’utiliser ici un des tests vus dans le chapitre @ref(chap02) pour tester formellement la distribution des constantes aléatoires, mais nous disposons rarement de suffisamment de valeurs différentes pour qu’un tel test soit pertinent.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/diagglmm1-1.png" alt="Distribution normale univariée des constantes aléatoires" width="70%" />
<p class="caption">
(#fig:diagglmm1)Distribution normale univariée des constantes aléatoires
</p>
</div>
<p>Cette vérification est bien sûr à appliquer à chacun des niveaux (en dehors du niveau de base) du modèle étudié.</p>
<p>Si nous nous intéressons maintenant au modèle avec constantes et pentes aléatoires, nous avons deux cas de figure:</p>
<ul>
<li><p>notre modèle inclut une covariance entre les constantes et les pentes; elles proviennent donc d’une distribution normale bivariée.</p></li>
<li><p>notre modèle considère les pentes et les constantes comme indépendantes; elles proviennent donc de deux distributions normales distinctes.</p></li>
</ul>
<p>Le second cas est de loin le plus simple puisqu’il nous suffit de réaliser un graphique de type quantile-quantile pour les deux effets aléatoires séparément. Dans le premier cas, il nous faut adapter notre stratégie pour vérifier si les deux effets aléatoires suivent conjointement une distribution normale multivariée. Pour cela, nous devons dans un premier temps observer séparément la distribution des pentes et des constantes, puisque chaque variable provenant d’une distribution normale multivariée suit elle-même une distribution normale univariée <span class="citation">(Burdenski <a href="#ref-burdenski2000evaluating" role="doc-biblioref">2000</a>)</span>. Nous pouvons dans un second temps construire un graphique nous permettant de juger si nos pentes et constantes suivent bien la distribution normale bivariée attendue par le modèle. Pour l’illustrer, nous reprenons le modèle sur la performance scolaire intégrant des pentes et des constantes aléatoires avec une covariance estimée entre les deux.</p>
<p>La figure @ref(fig:diagglmm2) représente donc les deux graphiques quantile-quantile univariés. Les deux semblent indiquer que nos effets aléatoires suivent bien chacun une distribution normale. La figure @ref(fig:diagglmm3) montre la distribution normale bivariée attendue par le modèle avec des ellipses représentant différents pourcentiles de cette distribution. Les valeurs des effets aléatoires sont représentées par des points noirs. Seulement 5 % des points noirs devraient se trouver dans la première ellipse et 95 % des points devraient se trouver dans la quatrième ellipse. En revanche, seulement 20 % des points devraient se trouver dans le dernier anneau et seulement 5 % des points en dehors de cet anneau. Il faut donc évaluer si les points sont plus ou moins centrés que ce que l’on attend. Pour simplifier la lecture, il est possible de rajouter des points grisés en arrière-plan représentant des réalisations possibles de cette distribution normale bivariée. Les vrais points noirs devraient avoir une dispersion similaire à celle des points grisés. Dans notre cas, ils semblent suivre un patron cohérent avec notre distribution normale bivariée. Dans le cas contraire, cela signifierait que le modèle doit être révisé.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/diagglmm2-1.png" alt="Multiples distributions normales univariées des constantes et pentes aléatoires" width="70%" />
<p class="caption">
(#fig:diagglmm2)Multiples distributions normales univariées des constantes et pentes aléatoires
</p>
</div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/diagglmm3-1.png" alt="Distribution normale bivariée des constantes et pentes aléatoires" width="70%" />
<p class="caption">
(#fig:diagglmm3)Distribution normale bivariée des constantes et pentes aléatoires
</p>
</div>
</div>
<div id="sect0932" class="section level3">
<h3><span class="header-section-number">9.3.2</span> Homogénéité des variances au sein des groupes</h3>
<p>Dans le chapitre @ref(chap08) sur les GLM nous avons vu que chaque distribution a sa propre définition de la variance. Pour rappel, un modèle gaussien assume une variance constante, un modèle de Poisson assume une variance égale à son espérance, alors qu’un modèle Gamma assume une variance proportionnelle au carré de son espérance divisée par un paramètre de forme, etc. Nous devions donc pour chaque GLM vérifier graphiquement si la variance présente dans les données originales était proche de la variance attendue par le modèle. Dans un modèle GLMM, le même exercice doit être fait pour chaque groupe aux différents niveaux du modèle.</p>
<p>Dans notre exemple sur la performance scolaire, notre variable <em>Y</em> a été modélisée avec une distribution normale. Le modèle assume donc une uniformité de sa variance (homoscédasticité). La figure @ref(fig:glmmvariance) nous montre ainsi que, qu’elle soit la classe, la dispersion des points (notes des élèves) semble bien respecter la variance attendue par le modèle (représentée par les lignes noires).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/glmmvariance-1.png" alt="Homogénéité de la variance pour les différents groupes d'un modèle GLMM Gaussien" width="95%" />
<p class="caption">
(#fig:glmmvariance)Homogénéité de la variance pour les différents groupes d’un modèle GLMM Gaussien
</p>
</div>
</div>
</div>
<div id="sect094" class="section level2">
<h2><span class="header-section-number">9.4</span> Inférence dans les modèles GLMM</h2>
<p>Une des questions importantes que l’on se pose lorsque l’on construit un modèle est toujours : est-ce que les différents effets présents dans le modèle ont un impact significativement différent de zéro sur la variable dépendante? Cette étape d’inférence est plus compliquée pour les modèles GLMM que dans les modèles GLM à cause de la présence d’effets aléatoires. Ces derniers brouillent le comptage du nombre de paramètres et par extension du nombre de degrés de liberté des modèles. Pour un effet aléatoire, il est possible de déterminer que le nombre de degrés de liberté est de 1 puisque nous ajustons un seul paramètre supplémentaire (la variance de cet effet aléatoire). Selon un autre point de vue, il serait possible d’affirmer que le nombre de degrés de liberté est de <span class="math inline">\(k - 1\)</span> (avec <em>k</em> le nombre de groupes dans cet effet aléatoire), ce que nous utilisons habituellement pour un effet fixe. La vraie valeur du nombre de degrés de liberté se situe quelque part entre ces deux extrêmes. L’enjeu du nombre de degrés de liberté est crucial, car il impacte directement l’estimation des valeurs de <em>p</em> pour l’ensemble des coefficients du modèle. Avec un nombre de degrés de liberté plus petit, les valeurs de <em>p</em> seront plus faibles et les effets “plus significatifs”. Le sujet est d’ailleurs l’objet d’une telle controverse que les auteurs de certains <em>package</em> comme <code>lme4</code> (un des <em>packages</em> les plus utilisés pour ajuster des GLMM) ont fait le choix de ne renvoyer aucune valeur de <em>p</em> dans les résultats des modèles. L’article de <span class="citation">Bolker et al. (<a href="#ref-bolker2009generalized" role="doc-biblioref">2009</a>)</span> propose une explication détaillée et relativement accessible du problème (en plus d’une excellente introduction aux GLMM) : en se basant sur leurs recommandations, il est possible de séparer le problème de l’inférence dans les GLMM en trois sous problèmes :</p>
<ul>
<li>Quel est le degré de significativité des effets fixes?</li>
<li>Quel est le degré de significativité de l’effet aléatoire dans le modèle?</li>
<li>Quels sont les degrés de significativité de chaque constante / pente aléatoire?</li>
</ul>
<div id="sect0941" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Inférence pour les effets fixes</h3>
<p>Trois approches peuvent être envisagées pour déterminer si un effet fixe est significatif ou non. Elles font appel à trois approches théoriques différentes (test classique, comparaison de modèles et <em>bootstrapping</em>) et peuvent donc donner des résultats différents. À titre exploratoire, il peut être intéressant de toutes les tester, mais certaines peuvent être préférées en fonction de votre champ de recherche.</p>
<div id="sect09411" class="section level4">
<h4><span class="header-section-number">9.4.1.1</span> Test classique</h4>
<p>Nous avions vu pour les modèles LM et GLM que les valeurs de <em>p</em> étaient calculées à partir de scores obtenus en divisant les coefficients par leurs erreurs standards. Une approche similaire peut être utilisée pour les modèles GLMM. Cependant, la question du nombre de degrés de liberté à utiliser reste un problème. L’approche la plus flexible est certainement l’approximation par la méthode Satterthwaite proposant une estimation de ce nombre de degrés de liberté et par extension des valeurs de <em>p</em>.</p>
</div>
<div id="sect09412" class="section level4">
<h4><span class="header-section-number">9.4.1.2</span> Rapports de vraisemblance</h4>
<p>Si le modèle comprend suffisamment d’observations (par suffisamment, comprenez au moins une centaine d’observations par paramètre), il est également possible d’utiliser une série de tests de rapports de vraisemblance pour vérifier si l’apport de chaque variable indépendante contribue à améliorer significativement le modèle. Cette approche correspond à une analyse de type 3 comme nous l’avions mentionné dans la section @ref(sect0824) pour le modèle logistique multinomial.</p>
</div>
<div id="sect09413" class="section level4">
<h4><span class="header-section-number">9.4.1.3</span> Bootstrapping</h4>
<p>L’approche par <em>bootstrapping</em> (<em>parametric-bootstrap</em> ou <em>semi-parametric-bootstrap</em>) permet de calculer pour les différents paramètres d’un modèle un intervalle de confiance. L’idée étant de réajuster un grand nombre de fois le modèle sur des sous-échantillons des données pour saisir la variabilité des différents paramètres du modèle. Si les intervalles de confiance ainsi construits ne comprennent pas de zéro, il est possible de dire que cet effet est significatif. À nouveau, cette méthode n’est valide que si le jeu de données comporte suffisamment d’observations. L’intérêt de cette approche est qu’elle ne postule pas d’hypothèse sur la distribution des paramètres qui ont la fâcheuse tendance à ne pas suivre une distribution normale dans le cas des GLMM. Elle est d’ailleurs considérée comme la plus robuste bien que coûteuse en termes de temps de calcul.</p>
</div>
</div>
<div id="sect0942" class="section level3">
<h3><span class="header-section-number">9.4.2</span> Inférence pour les effets aléatoires, impact global</h3>
<p>Pour déterminer si un effet aléatoire a un impact significatif dans un modèle, il est recommandé d’utiliser un test de rapport de vraisemblance entre un modèle sans l’effet aléatoire et un modèle avec l’effet aléatoire. L’analyse des différences entre les valeurs de déviance, AIC et BIC peut également aider à déterminer si l’ajout de l’effet aléatoire est justifié. Il est également possible de considérer les valeurs de l’ICC et du R<sup>2</sup> conditionnel. Notez ici que si vous avez une très bonne raison théorique d’ajouter l’effet aléatoire dans votre modèle et suffisamment d’observations / groupes pour l’ajuster, il peut être pertinent de laisser l’effet aléatoire dans le modèle même si tous les indicateurs mentionnés précédemment indiquent qu’il contribue faiblement au modèle. Le retirer risquerait en effet de donner l’impression que les autres paramètres du modèle sont plus significatifs qu’ils ne le sont en réalité.</p>
<p>Notez que l’approche par <em>bootstrapping</em> décrite pour les effets fixes peut aussi être utilisée ici pour obtenir un intervalle de confiance pour l’ICC, le R<sup>2</sup> conditionnel et les différents paramètres de variance et covariance.</p>
</div>
<div id="sect0943" class="section level3">
<h3><span class="header-section-number">9.4.3</span> Inférence pour les effets aléatoires, constantes et pentes</h3>
<p>Pour rappel, dans l’approche fréquentiste présentée ici, les valeurs des constantes et des pentes aléatoires ne sont pas à proprement parler des paramètres du modèle : elles sont estimées à posteriori (<em>BLUP</em>). Pour déterminer si ces constantes et pentes sont significativement différentes de zéro et significativement différentes les unes des autres, il est possible de calculer les intervalles de confiance de chacune d’entre elles par <em>bootstrap</em>, par profilage ou par simulation à partir du modèle. Si la constante du groupe <em>j</em> a zéro dans son intervalle de confiance, nous pouvons alors déclarer que le groupe <em>j</em> en question ne semble pas varier du reste de la population en termes de moyenne. Si la pente <em>l</em> du groupe <em>j</em> a zéro dans son intervalle de confiance, nous pouvons alors déclarer que le groupe <em>j</em> en question ne semble pas varier du reste de la population pour l’effet <em>l</em>. Notez que la méthode par simulation est bien plus rapide que les deux autres, mais que l’approche par <em>bootstrapping</em> reste la plus fiable.</p>
</div>
</div>
<div id="sect095" class="section level2">
<h2><span class="header-section-number">9.5</span> Conclusion sur les GLMM</h2>
<p>Les GLMM sont donc une extension des GLM offrant une grande flexibilité de modélisation (variabilité des pentes et des constantes en fonction de groupes) et nous permettant d’analyser la partition de la variance entre plusieurs niveaux présents dans nos données. Cependant, cette flexibilité implique des modèles plus complexes avec un travail de diagnostic et d’interprétation plus long et potentiellement plus ardu.</p>
</div>
<div id="sect096" class="section level2">
<h2><span class="header-section-number">9.6</span> Mise en œuvre des GLMM dans R</h2>
<p>Pour cet exemple de GLMM, nous proposons de d’analyser à nouveau les données présentées dans la section @ref(sect06211) sur le modèle logistique binomial. Pour rappel, nous modélisions la probabilité qu’un individu utilise le vélo comme mode de transport pour son trajet le plus fréquent en utilisant une enquête réalisée auprès d’environ 26000 Européens. Initialement, nous avions intégré les pays comme un effet fixe. Or, nous savons à présent qu’il serait plus judicieux de les traiter comme un effet aléatoire. Nous comparons deux modèles, un pour lequel seulement la constante varie par pays et un second dans lequel la pente pour l’âge varie également par pays. L’hypothèse étant que l’impact de l’âge sur l’utilisation du vélo pourrait être réduit dans certains pays où la culture du vélo est plus présente. Cette hypothèse implique également la présence potentielle d’une corrélation inverse entre la constante et la pente de chaque pays : dans un pays où la probabilité de base d’utiliser le vélo est plus élevée, l’impact de l’effet de l’âge est probablement réduit.</p>
<p>Pour ajuster ces modèles, nous utilisons le <em>package</em> <code>lme4</code>, permettant d’ajuster des modèles GLMM avec des distributions gaussienne, gamma, poisson et binomial. Lorsque d’autres distributions sont nécessaires, il est possible de se tourner vers le <em>package</em> <code>gamlss</code>. Notez cependant que les effets aléatoires de <code>gamlss</code> sont estimés avec une méthode appelée PQL très flexible, mais qui peut produire des résultats erronés dans certains cas <span class="citation">(Bolker et al. <a href="#ref-bolker2009generalized" role="doc-biblioref">2009</a>)</span>.</p>
<p>Afin de limiter les répétitions, nous ne recalculons pas ici le VIF et nous excluons d’emblée les observations aberrantes (provenant de Malte, Chypre ou avec des temps de trajets supérieurs à 400 minutes).</p>
<div id="sect0961" class="section level3">
<h3><span class="header-section-number">9.6.1</span> Ajustement du modèle avec uniquement une constante aléatoire</h3>
<p>Nous commençons donc par ajuster un premier modèle avec une constante aléatoire en fonction du pays. Dans la plupart des <em>packages</em> intégrant des effets aléatoires, la syntaxe suivante est utilisée pour stipuler une constante aléatoire : <code>+ (1|Pays)</code>. Concrètement, nous tentons d’ajuster le modèle décrit par l’équation @ref(eq:glmmbinom1).</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Binomial(p)\\
&amp;g(p) = \beta_0 + \beta_1 x_1 + \upsilon \\
&amp;\upsilon \sim Normal(0, \sigma_{\upsilon}) \\
&amp;g(x) = log(\frac{x}{1-x})
\end{aligned}
(\#eq:glmmbinom1)
\end{equation}\]</span>
</p>
<p>Il s’agit simplement d’un modèle logistique binomial dans lequel nous avons rajouté une constante aléatoire : <span class="math inline">\(\upsilon\)</span>. Dans notre cas, elle varie avec la variable <code>Pays</code>. La syntaxe dans R pour produire ce modèle est la suivante.</p>
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb958-1"><a href="#cb958-1"></a><span class="co"># Chargement des données</span></span>
<span id="cb958-2"><a href="#cb958-2"></a>dfenquete &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/glm/enquete_transport_UE.csv&quot;</span>, <span class="dt">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb958-3"><a href="#cb958-3"></a>dfenquete<span class="op">$</span>Pays &lt;-<span class="st"> </span><span class="kw">relevel</span>(<span class="kw">as.factor</span>(dfenquete<span class="op">$</span>Pays), <span class="dt">ref =</span> <span class="st">&quot;Allemagne&quot;</span>)</span>
<span id="cb958-4"><a href="#cb958-4"></a><span class="co"># Retirer les observations aberrantes</span></span>
<span id="cb958-5"><a href="#cb958-5"></a>dfenquete2 &lt;-<span class="st"> </span><span class="kw">subset</span>(dfenquete, (dfenquete<span class="op">$</span>Pays <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Malte&quot;</span>, <span class="st">&quot;Chypre&quot;</span>)) <span class="op">==</span><span class="st"> </span>F <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb958-6"><a href="#cb958-6"></a><span class="st">                  </span>dfenquete<span class="op">$</span>Duree <span class="op">&lt;</span><span class="st"> </span><span class="dv">400</span>)</span>
<span id="cb958-7"><a href="#cb958-7"></a></span>
<span id="cb958-8"><a href="#cb958-8"></a><span class="co"># Ajustement du modèle</span></span>
<span id="cb958-9"><a href="#cb958-9"></a><span class="kw">library</span>(lme4)</span>
<span id="cb958-10"><a href="#cb958-10"></a><span class="co"># Nécessité ici de centrer et réduire ces variables pour permettre au modèle de converger</span></span>
<span id="cb958-11"><a href="#cb958-11"></a>dfenquete2<span class="op">$</span>Age2 &lt;-<span class="st"> </span><span class="kw">scale</span>(dfenquete2<span class="op">$</span>Age,<span class="dt">center =</span> T, <span class="dt">scale =</span> T)</span>
<span id="cb958-12"><a href="#cb958-12"></a>dfenquete2<span class="op">$</span>Duree2 &lt;-<span class="st"> </span><span class="kw">scale</span>(dfenquete2<span class="op">$</span>Duree,<span class="dt">center =</span> T, <span class="dt">scale =</span> T)</span>
<span id="cb958-13"><a href="#cb958-13"></a>modele1 &lt;-<span class="st"> </span><span class="kw">glmer</span>(y <span class="op">~</span>Sexe <span class="op">+</span><span class="st"> </span>Age2 <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>StatutEmploi <span class="op">+</span><span class="st"> </span>Revenu <span class="op">+</span></span>
<span id="cb958-14"><a href="#cb958-14"></a><span class="st">              </span>Residence <span class="op">+</span><span class="st"> </span>Duree2 <span class="op">+</span><span class="st"> </span>ConsEnv <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>Pays),</span>
<span id="cb958-15"><a href="#cb958-15"></a>            <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb958-16"><a href="#cb958-16"></a>            <span class="dt">control =</span> <span class="kw">glmerControl</span>(<span class="dt">optimizer =</span> <span class="st">&quot;bobyqa&quot;</span>),</span>
<span id="cb958-17"><a href="#cb958-17"></a>            <span class="dt">data =</span> dfenquete2)</span></code></pre></div>
<p>Nous nous concentrons ici sur l’interprétation des résultats du modèle et nous réalisons l’ensemble des diagnostics dans une section dédiée en fin de chapitre. Notez cependant que le diagnostic <strong>devrait précéder l’interprétation</strong> comme nous l’avons vu dans le chapitre sur les modèles GLM.</p>
<p>Vous constaterez que nous avons centré-réduit les variables <code>Age</code> et <code>Duree</code>. Il est souvent nécessaire de réaliser cette étape en amont pour s’assurer que le modèle converge sans trop de difficulté. Dans notre cas, si ces deux variables sont laissées dans leur échelle d’origine, la fonction <code>glmer</code> ne parvient pas à ajuster le modèle. Notez que cette transformation nous permet d’obtenir les coefficients standardisés, s’exprimant alors en écarts-types. La fonction <code>summary</code> nous donne accès à un premier ensemble d’informations.</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb959-1"><a href="#cb959-1"></a><span class="kw">summary</span>(modele1)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence +  
##     Duree2 + ConsEnv + (1 | Pays)
##    Data: dfenquete2
## Control: glmerControl(optimizer = &quot;bobyqa&quot;)
## 
##      AIC      BIC   logLik deviance df.resid 
##  19176.1  19322.8  -9570.1  19140.1    25529 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.1989 -0.4418 -0.3212 -0.2134  7.2461 
## 
## Random effects:
##  Groups Name        Variance Std.Dev.
##  Pays   (Intercept) 0.5949   0.7713  
## Number of obs: 25547, groups:  Pays, 26
## 
## Fixed effects:
##                                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   -3.368942   0.212577 -15.848  &lt; 2e-16 ***
## Sexehomme                      0.370864   0.037921   9.780  &lt; 2e-16 ***
## Age2                          -0.102388   0.018777  -5.453 4.95e-08 ***
## Educationsecondaire            0.188096   0.103204   1.823  0.06837 .  
## Educationsecondaire inferieur  0.297591   0.111352   2.673  0.00753 ** 
## Educationuniversite            0.138670   0.106518   1.302  0.19297    
## StatutEmploisans emploi        0.256476   0.042284   6.066 1.31e-09 ***
## Revenufaible                   0.073836   0.071653   1.030  0.30279    
## Revenumoyen                    0.039404   0.065243   0.604  0.54587    
## Revenusans reponse             0.215706   0.102308   2.108  0.03500 *  
## Revenutres eleve              -0.121285   0.185352  -0.654  0.51288    
## Revenutres faible              0.237388   0.085712   2.770  0.00561 ** 
## Residencegrande ville          0.272277   0.069280   3.930 8.49e-05 ***
## Residencepetite-moyenne ville  0.276282   0.061496   4.493 7.03e-06 ***
## Residencezone rurale          -0.118967   0.069096  -1.722  0.08511 .  
## Duree2                        -0.018718   0.019241  -0.973  0.33065    
## ConsEnv                        0.101757   0.009277  10.969  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>La première partie de ce résumé nous rappelle la formule utilisée pour le modèle et nous indique différents indicateurs de qualité d’ajustement comme le AIC, le BIC et la déviance. Nous avons ensuite une partie dédiée aux effets aléatoires (<code>Random Effects</code>) et une partie dédiée aux effets fixes (<code>Fixed effects</code>). Cette dernière s’interprète de la même manière que pour un modèle à effets fixes, n’oubliez cependant pas d’utiliser la fonction exponentielle pour obtenir les rapports de cotes (fonction de lien logistique).</p>
<div id="sect09611" class="section level4">
<h4><span class="header-section-number">9.6.1.1</span> Rôle joué par l’effet aléatoire</h4>
<p>Comme vous pouvez le constater, la section <code>Random Effects</code> ne comprends qu’un seul paramètre : la variance de l’effet pays. Nous pouvons ainsi écrire que l’effet du pays suit une distribution normale avec une moyenne de 0 et une variance <span class="math inline">\(\sigma^2\)</span> de 0,595. Pour aller plus loin dans cette analyse, nous pouvons calculer le coefficient de corrélation intraclasse (ICC). Cependant, puisque notre modèle est binomial et non gaussien, nous ne disposons pas d’un paramètre de variance au niveau des individus, il est donc possible à la place d’utiliser la variance théorique du modèle : <span class="math inline">\(\frac{\pi^2}{3}\)</span>. Nous calculons ainsi notre ICC :</p>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb961-1"><a href="#cb961-1"></a><span class="co"># Extraction de la variance des Pays</span></span>
<span id="cb961-2"><a href="#cb961-2"></a>var_pays &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(modele1)[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span>
<span id="cb961-3"><a href="#cb961-3"></a><span class="co"># Calcul de l&#39;ICC</span></span>
<span id="cb961-4"><a href="#cb961-4"></a>var_pays <span class="op">/</span><span class="st"> </span>(((pi<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>var_pays)</span></code></pre></div>
<pre><code>## [1] 0.153141</code></pre>
<p>Nous pouvons parvenir au même résultat en utilisant la fonction <code>icc</code> du <em>package</em> <code>performance</code>.</p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb963-1"><a href="#cb963-1"></a><span class="kw">library</span>(performance)</span>
<span id="cb963-2"><a href="#cb963-2"></a><span class="co"># Calcul de l&#39;ICC</span></span>
<span id="cb963-3"><a href="#cb963-3"></a><span class="kw">icc</span>(modele1)</span></code></pre></div>
<pre><code>## # Intraclass Correlation Coefficient
## 
##      Adjusted ICC: 0.153
##   Conditional ICC: 0.148</code></pre>
<p>Notez que cette fonction distingue un ICC ajusté et un ICC conditionnel. Le premier correspond à l’ICC que nous avons présenté jusqu’ici et que nous avons calculé à la main. L’ICC conditionnel inclut dans son estimation la variance présente dans les effets fixes. Un fort écart entre ces deux ICC indiquerait que les effets fixes sont capables de capturer une très forte variance dans les données, ce qui pourrait remettre en cause la pertinence de l’effet aléatoire. Dans notre cas, la différence entre les deux est très faible.</p>
<p>En plus du ICC, nous pouvons calculer les R<sup>2</sup> marginal et conditionnel. Pour cela, nous utilisons la fonction <code>r.squaredGLMM</code> du <em>package</em> <code>MuMIn</code>.</p>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="#cb965-1"></a><span class="kw">library</span>(MuMIn)</span>
<span id="cb965-2"><a href="#cb965-2"></a><span class="kw">r.squaredGLMM</span>(modele1)</span></code></pre></div>
<pre><code>##                    R2m        R2c
## theoretical 0.03492136 0.18271447
## delta       0.01554518 0.08133502</code></pre>
<p>Cette fonction nous renvoie à la fois les R<sup>2</sup> obtenus en utilisant la variance théorique du modèle (<span class="math inline">\(\frac{\pi^2}{3}\)</span> dans notre cas) et la variance estimée par la méthode delta. La seconde est plus conservative, mais les deux résultats indiquent que les effets aléatoires expliquent une part importante de la variance comparativement aux effets fixes. Notez également que la fonction <code>r2</code> du <em>package</em> <code>performance</code> peut calculer ces deux R<sup>2</sup>, mais seulement en utilisant la variance théorique.</p>
</div>
<div id="sect09612" class="section level4">
<h4><span class="header-section-number">9.6.1.2</span> Significativité de l’effet aléatoire</h4>
<p>Nous souhaitons déterminer ici si notre effet aléatoire contribue à significativement améliorer le modèle. Pour cela, nous effectuons un test de rapport de vraisemblance entre le modèle sans l’effet aléatoire (un simple GLM ici) et le modèle complet. Nous utilisons pour cela la fonction <code>anova</code> :</p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="#cb967-1"></a><span class="co"># Ajustement d&#39;un modèle sans l&#39;effet aléatoire</span></span>
<span id="cb967-2"><a href="#cb967-2"></a>model_simple &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span>Sexe <span class="op">+</span><span class="st"> </span>Age2 <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>StatutEmploi <span class="op">+</span><span class="st"> </span>Revenu <span class="op">+</span></span>
<span id="cb967-3"><a href="#cb967-3"></a><span class="st">              </span>Residence <span class="op">+</span><span class="st"> </span>Duree2 <span class="op">+</span><span class="st"> </span>ConsEnv,</span>
<span id="cb967-4"><a href="#cb967-4"></a>            <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb967-5"><a href="#cb967-5"></a>            <span class="dt">data =</span> dfenquete2)</span>
<span id="cb967-6"><a href="#cb967-6"></a><span class="co"># Comparaison des deux modèles</span></span>
<span id="cb967-7"><a href="#cb967-7"></a><span class="kw">anova</span>(modele1,model_simple)</span></code></pre></div>
<pre><code>## Data: dfenquete2
## Models:
## model_simple: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence + 
## model_simple:     Duree2 + ConsEnv
## modele1: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence + 
## modele1:     Duree2 + ConsEnv + (1 | Pays)
##              npar   AIC   BIC   logLik deviance Chisq Df Pr(&gt;Chisq)    
## model_simple   17 20521 20660 -10243.6    20487                        
## modele1        18 19176 19323  -9570.1    19140  1347  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Le test indique clairement que le modèle complet est mieux ajusté : les valeurs de l’AIC, du BIC et de la déviance sont toutes grandement réduites et le test est largement significatif.</p>
<p>Pour aller plus loin, nous pouvons utiliser une approche par <em>bootstrap</em> pour calculer un intervalle de confiance pour la variance de l’effet aléatoire, l’ICC et le R<sup>2</sup> conditionnel. Nous utilisons pour cela la fonction <code>bootMer</code>. Si vous essayez de lancer cette syntaxe, vous constaterez qu’elle prend énormément de temps, ce qui s’explique par le grand nombre de fois où le modèle doit être réajusté. Nous vous recommandons donc de bien enregistrer vos résultats après l’exécution de la fonction avec la fonction <code>save.</code> Notez que pour réduire significativement le temps de calcul, il est possible d’utiliser simultanément plusieurs cœurs de votre processeur, ce que nous faisons ici avec le <em>package</em> <code>snow</code>.</p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb969-1"><a href="#cb969-1"></a><span class="co"># Définition d&#39;une fonction pour extraire les valeurs qui nous intéressent</span></span>
<span id="cb969-2"><a href="#cb969-2"></a>extractor &lt;-<span class="st"> </span><span class="cf">function</span>(mod){</span>
<span id="cb969-3"><a href="#cb969-3"></a>  vari &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(mod)[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span>
<span id="cb969-4"><a href="#cb969-4"></a>  ICC &lt;-<span class="st"> </span>vari <span class="op">/</span><span class="st"> </span>(vari <span class="op">+</span><span class="st"> </span>(pi<span class="op">**</span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span>))</span>
<span id="cb969-5"><a href="#cb969-5"></a>  r2cond &lt;-<span class="st"> </span>performance<span class="op">::</span><span class="kw">r2</span>(mod)[[<span class="dv">1</span>]]</span>
<span id="cb969-6"><a href="#cb969-6"></a>  <span class="kw">return</span>(<span class="kw">c</span>(<span class="st">&quot;vari&quot;</span>=vari,<span class="st">&quot;icc&quot;</span>=ICC,<span class="st">&quot;r2cond&quot;</span>=r2cond))</span>
<span id="cb969-7"><a href="#cb969-7"></a>}</span>
<span id="cb969-8"><a href="#cb969-8"></a><span class="co"># Préparation d&#39;un environnement multitraitement pour accélérer le calcul</span></span>
<span id="cb969-9"><a href="#cb969-9"></a><span class="kw">library</span>(snow)</span>
<span id="cb969-10"><a href="#cb969-10"></a><span class="co"># Préparation de huit coeurs (attention si votre machine en a moins!)</span></span>
<span id="cb969-11"><a href="#cb969-11"></a>cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(<span class="dv">8</span>)</span>
<span id="cb969-12"><a href="#cb969-12"></a><span class="kw">clusterEvalQ</span>(cl,<span class="kw">library</span>(<span class="st">&quot;lme4&quot;</span>))</span>
<span id="cb969-13"><a href="#cb969-13"></a>valeurs &lt;-<span class="st"> </span><span class="kw">bootMer</span>(modele1,<span class="dt">FUN =</span> extractor,<span class="dt">nsim =</span> <span class="dv">1000</span>,</span>
<span id="cb969-14"><a href="#cb969-14"></a>                   <span class="dt">use.u =</span> F, <span class="dt">type=</span><span class="st">&quot;parametric&quot;</span>, <span class="dt">ncpus =</span> <span class="dv">8</span>,</span>
<span id="cb969-15"><a href="#cb969-15"></a>                   <span class="dt">parallel=</span><span class="st">&quot;snow&quot;</span>,</span>
<span id="cb969-16"><a href="#cb969-16"></a>                   <span class="dt">cl =</span> cl)</span>
<span id="cb969-17"><a href="#cb969-17"></a><span class="co"># Sauvegarde des résultats</span></span>
<span id="cb969-18"><a href="#cb969-18"></a><span class="kw">save</span>(valeurs,<span class="dt">file =</span> <span class="st">&#39;data/glmm/boot_binom.rda&#39;</span>)</span></code></pre></div>
<p>Nous pouvons à présent analyser l’incertitude de ces différents paramètres. Pour cela nous devons commencer par observer graphiquement leurs distributions obtenues par <em>bootstrap</em> avec la figure @ref(fig:bottdistrib).</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="#cb970-1"></a><span class="co"># Chargement de nos valeurs préalablement enregistrées</span></span>
<span id="cb970-2"><a href="#cb970-2"></a><span class="kw">load</span>(<span class="st">&#39;data/glmm/boot_binom.rda&#39;</span>)</span>
<span id="cb970-3"><a href="#cb970-3"></a><span class="co"># Construction de trois graphiques de distribution</span></span>
<span id="cb970-4"><a href="#cb970-4"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(valeurs<span class="op">$</span>t)</span>
<span id="cb970-5"><a href="#cb970-5"></a><span class="kw">names</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;variance&quot;</span>,<span class="st">&quot;icc&quot;</span>,<span class="st">&quot;R2cond&quot;</span>)</span>
<span id="cb970-6"><a href="#cb970-6"></a>breaks1 &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">quantile</span>(df<span class="op">$</span>variance, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.001</span>,<span class="fl">0.15</span>,<span class="fl">0.5</span>,<span class="fl">0.85</span>, <span class="fl">0.999</span>)))</span>
<span id="cb970-7"><a href="#cb970-7"></a>labs1 &lt;-<span class="st"> </span><span class="kw">round</span>(breaks1,<span class="dv">2</span>)</span>
<span id="cb970-8"><a href="#cb970-8"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb970-9"><a href="#cb970-9"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> variance), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">fill =</span> <span class="st">&quot;#e63946&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)<span class="op">+</span></span>
<span id="cb970-10"><a href="#cb970-10"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">median</span>(df<span class="op">$</span>variance),</span>
<span id="cb970-11"><a href="#cb970-11"></a>             <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb970-12"><a href="#cb970-12"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> breaks1, <span class="dt">labels =</span> labs1)<span class="op">+</span></span>
<span id="cb970-13"><a href="#cb970-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb970-14"><a href="#cb970-14"></a>        <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())</span>
<span id="cb970-15"><a href="#cb970-15"></a>breaks2 &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">quantile</span>(df<span class="op">$</span>icc, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.001</span>,<span class="fl">0.15</span>,<span class="fl">0.5</span>,<span class="fl">0.85</span>, <span class="fl">0.999</span>)))</span>
<span id="cb970-16"><a href="#cb970-16"></a>labs2 &lt;-<span class="st"> </span><span class="kw">round</span>(breaks2,<span class="dv">2</span>)</span>
<span id="cb970-17"><a href="#cb970-17"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb970-18"><a href="#cb970-18"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> icc), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">fill =</span> <span class="st">&quot;#a8dadc&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)<span class="op">+</span></span>
<span id="cb970-19"><a href="#cb970-19"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">median</span>(df<span class="op">$</span>icc),</span>
<span id="cb970-20"><a href="#cb970-20"></a>             <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb970-21"><a href="#cb970-21"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> breaks2, <span class="dt">labels =</span> labs2)<span class="op">+</span></span>
<span id="cb970-22"><a href="#cb970-22"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb970-23"><a href="#cb970-23"></a>        <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())</span>
<span id="cb970-24"><a href="#cb970-24"></a>breaks3 &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">quantile</span>(df<span class="op">$</span>R2cond, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.001</span>,<span class="fl">0.15</span>,<span class="fl">0.5</span>,<span class="fl">0.85</span>, <span class="fl">0.999</span>)))</span>
<span id="cb970-25"><a href="#cb970-25"></a>labs3 &lt;-<span class="st"> </span><span class="kw">round</span>(breaks3,<span class="dv">3</span>)</span>
<span id="cb970-26"><a href="#cb970-26"></a>p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb970-27"><a href="#cb970-27"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> R2cond), <span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">fill =</span> <span class="st">&quot;#1d3557&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)<span class="op">+</span></span>
<span id="cb970-28"><a href="#cb970-28"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">median</span>(df<span class="op">$</span>R2cond),</span>
<span id="cb970-29"><a href="#cb970-29"></a>             <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb970-30"><a href="#cb970-30"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> breaks3, <span class="dt">labels =</span> labs3)<span class="op">+</span></span>
<span id="cb970-31"><a href="#cb970-31"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb970-32"><a href="#cb970-32"></a>        <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())</span>
<span id="cb970-33"><a href="#cb970-33"></a><span class="kw">ggarrange</span>(p1,p2,p3, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/bottdistrib-1.png" alt="Distributions obtenues par bootstrap de la variance de l'effet aléatoire, l'ICC et le $R^2$ conditionnel" width="80%" />
<p class="caption">
(#fig:bottdistrib)Distributions obtenues par bootstrap de la variance de l’effet aléatoire, l’ICC et le <span class="math inline">\(R^2\)</span> conditionnel
</p>
</div>
<p>Les trois distributions sont toutes suffisamment éloignées de zéros pour que nous puissions en conclure que ces différentes valeurs sont toutes différentes de zéro. Notez également que les distributions sont relativement symétriques, indiquant que nous disposons de probablement suffisamment d’information dans nos données pour inclure notre effet aléatoire. Des distributions fortement asymétriques auraient indiqué, au contraire, une forte difficulté du modèle à estimer le paramètre de variance à partir des données. Dans un article, il n’est pas nécessaire de reporter ces graphiques, mais plus simplement les intervalles de confiance à 95 % et les médianes.</p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb971-1"><a href="#cb971-1"></a><span class="co"># Intervalle de confiance pour la variance</span></span>
<span id="cb971-2"><a href="#cb971-2"></a><span class="kw">quantile</span>(df<span class="op">$</span>variance,<span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.0275</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##     2.75%       50%     97.5% 
## 0.3059400 0.5578986 0.9200472</code></pre>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="#cb973-1"></a><span class="co"># Intervalle de confiance pour l&#39;ICC</span></span>
<span id="cb973-2"><a href="#cb973-2"></a><span class="kw">quantile</span>(df<span class="op">$</span>icc,<span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.0275</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##     2.75%       50%     97.5% 
## 0.0850824 0.1449928 0.2185428</code></pre>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb975-1"><a href="#cb975-1"></a><span class="co"># Intervalle de confiance pour le R2 conditionnel</span></span>
<span id="cb975-2"><a href="#cb975-2"></a><span class="kw">quantile</span>(df<span class="op">$</span>R2cond,<span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.0275</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##     2.75%       50%     97.5% 
## 0.1208577 0.1772778 0.2462622</code></pre>
</div>
<div id="sect09613" class="section level4">
<h4><span class="header-section-number">9.6.1.3</span> Significativité des différentes constantes</h4>
<p>Puisque nous avons conclu que l’effet aléatoire contribue significativement au modèle, nous pouvons à présent vérifier si les constantes ajustées pour chaque pays varient significativement les unes des autres. Pour rappel, les pentes et les constantes aléatoires ne sont pas directement estimées par le modèle, mais à posteriori. Il en résulte qu’il n’y a pas de moyen direct de mesurer l’incertitude de ces paramètres et donc de construire des intervalles de confiance. Une première option pour contourner ce problème est d’effectuer des simulations à partir de la distribution postérieure du modèle. Notez que cette approche s’inspire largement de l’approche statistique bayésienne. Nous utilisons ici le <em>package</em> <code>merTools</code> pour effectuer 1000 simulations et obtenir une erreur standard pour chaque constante aléatoire de chaque pays.</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb977-1"><a href="#cb977-1"></a><span class="co"># Simulations et extraction des effets aléatoires</span></span>
<span id="cb977-2"><a href="#cb977-2"></a><span class="kw">library</span>(merTools)</span>
<span id="cb977-3"><a href="#cb977-3"></a>simsRE &lt;-<span class="st"> </span><span class="kw">REsim</span>(modele1,<span class="dt">n.sims =</span> <span class="dv">1000</span>, <span class="dt">oddsRatio =</span> F)</span>
<span id="cb977-4"><a href="#cb977-4"></a><span class="co"># Calcul des intervalles de confiance</span></span>
<span id="cb977-5"><a href="#cb977-5"></a>simsRE<span class="op">$</span>lower &lt;-<span class="st"> </span>simsRE<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>simsRE<span class="op">$</span>sd</span>
<span id="cb977-6"><a href="#cb977-6"></a>simsRE<span class="op">$</span>upper &lt;-<span class="st"> </span>simsRE<span class="op">$</span>mean <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>simsRE<span class="op">$</span>sd</span>
<span id="cb977-7"><a href="#cb977-7"></a><span class="co"># Variable binaire pour la significativité</span></span>
<span id="cb977-8"><a href="#cb977-8"></a>simsRE<span class="op">$</span>sign &lt;-<span class="st"> </span><span class="kw">case_when</span>(</span>
<span id="cb977-9"><a href="#cb977-9"></a>  simsRE<span class="op">$</span>lower<span class="op">&lt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>simsRE<span class="op">$</span>upper<span class="op">&lt;</span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;inf&quot;</span>,</span>
<span id="cb977-10"><a href="#cb977-10"></a>  simsRE<span class="op">$</span>lower<span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>simsRE<span class="op">$</span>upper<span class="op">&gt;</span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;sup&quot;</span>,</span>
<span id="cb977-11"><a href="#cb977-11"></a>  <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;not&quot;</span></span>
<span id="cb977-12"><a href="#cb977-12"></a>)</span>
<span id="cb977-13"><a href="#cb977-13"></a><span class="co"># Représentation des intervalles de confiance</span></span>
<span id="cb977-14"><a href="#cb977-14"></a><span class="kw">ggplot</span>(simsRE) <span class="op">+</span><span class="st"> </span></span>
<span id="cb977-15"><a href="#cb977-15"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> lower, <span class="dt">xmax =</span> upper,</span>
<span id="cb977-16"><a href="#cb977-16"></a>                     <span class="dt">y =</span> <span class="kw">reorder</span>(groupID,mean)), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">height =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb977-17"><a href="#cb977-17"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean, <span class="dt">y =</span> <span class="kw">reorder</span>(groupID,mean),</span>
<span id="cb977-18"><a href="#cb977-18"></a>                 <span class="dt">color =</span> sign)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb977-19"><a href="#cb977-19"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;inf&quot;</span> =<span class="st"> &quot;#0077b6&quot;</span>, <span class="st">&quot;sup&quot;</span> =<span class="st"> &quot;#e63946&quot;</span>, <span class="st">&quot;not&quot;</span>=<span class="st">&quot;#000000&quot;</span>), </span>
<span id="cb977-20"><a href="#cb977-20"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;sign. &lt; 0&quot;</span>, <span class="st">&quot;sign. &gt; 0&quot;</span>, <span class="st">&quot;non sign.&quot;</span>)) <span class="op">+</span></span>
<span id="cb977-21"><a href="#cb977-21"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Constante aléatoire&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Pays&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/randomconstantes1-1.png" alt="Constantes aléatoires estimées par Pays (IC par simulations)" width="70%" />
<p class="caption">
(#fig:randomconstantes1)Constantes aléatoires estimées par Pays (IC par simulations)
</p>
</div>
<p>La figure @ref(fig:randomconstantes1) permet de repérer en un coup d’oeil les pays pour lesquels la probabilité d’utiliser le vélo comme moyen de transport pour le trajet le plus fréquent est la plus élevée ou la plus faible. Notez cependant que les valeurs représentées sont pour l’instant des logarithmes de rapport de cotes. Nous devons donc les convertir en rapports de cotes avec la fonction exponentielle pour faciliter leur interprétation.</p>
<div class="sourceCode" id="cb978"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb978-1"><a href="#cb978-1"></a><span class="co"># Conversion en rapports de cote (et arrondissement à trois décimales)</span></span>
<span id="cb978-2"><a href="#cb978-2"></a>mat &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">exp</span>(simsRE[<span class="kw">c</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;lower&quot;</span>,<span class="st">&quot;upper&quot;</span>)]),<span class="dv">3</span>)</span>
<span id="cb978-3"><a href="#cb978-3"></a><span class="kw">rownames</span>(mat) &lt;-<span class="st"> </span>simsRE<span class="op">$</span>groupID</span>
<span id="cb978-4"><a href="#cb978-4"></a><span class="kw">names</span>(mat) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;RC&quot;</span>,<span class="st">&quot;RC.025&quot;</span>,<span class="st">&quot;RC.975&quot;</span>)</span>
<span id="cb978-5"><a href="#cb978-5"></a><span class="kw">print</span>(mat)</span></code></pre></div>
<pre><code>##                    RC RC.025 RC.975
## Allemagne       1.667  1.191  2.333
## Autriche        1.311  0.927  1.853
## Belgique        1.428  1.022  1.997
## Bulgarie        0.541  0.374  0.784
## Croatie         1.880  1.354  2.610
## Danemark        4.043  2.926  5.587
## Espagne         0.292  0.194  0.439
## Estonie         1.121  0.787  1.598
## Finlande        2.242  1.621  3.102
## France          0.523  0.357  0.766
## Grande Bretagne 0.396  0.269  0.583
## Grèce           0.615  0.422  0.897
## Hongrie         2.359  1.700  3.273
## Ireland         0.377  0.254  0.558
## Italie          0.805  0.575  1.126
## Lettonie        1.270  0.901  1.790
## Lituanie        0.902  0.632  1.287
## Luxembourg      0.419  0.262  0.670
## Pays-Bas        3.939  2.873  5.400
## Pologne         1.658  1.189  2.311
## Portugal        0.218  0.139  0.340
## Roumanie        0.542  0.376  0.781
## Slovaquie       1.029  0.727  1.455
## Slovénie        1.362  0.969  1.916
## Suède           2.166  1.555  3.018
## Tchéquie        1.172  0.837  1.641</code></pre>
<p>Nous observons ainsi qu’une personne vivant en Finlande voit ses chances multipliées par 2,25 fois d’utiliser le vélo comme mode de transport pour son trajet le plus fréquent comparativement à la moyenne des pays européens. À l’inverse, une personne résidant en France a 47 % de chances de moins d’utiliser le vélo.</p>
<p>Notez cependant que cette approche basée sur des simulations peut poser des problèmes, car elle ne renvoie qu’une erreur standard pour mesurer l’incertitude de nos constantes. Dans les cas où nous ne disposons pas de beaucoup d’observations par groupe, la distribution à posteriori des constantes peut être asymétrique, rendant l’estimation des intervalles de confiance par les erreurs standards inutiles. Il est possible de détecter ce cas de figure quand les médianes et les moyennes renvoyées par la fonction <code>simsRE</code> diffèrent nettement. Une alternative plus robuste est à nouveau d’estimer la variabilité des effets aléatoires par <em>bootstrap</em>. Cette méthode requiert bien plus de temps de calcul que la précédente, nous vous recommandons donc de commencer par la méthode par simulations pour disposer d’un premier aperçu des résultats et d’utiliser ensuite la méthode <em>bootstrap</em> quand votre modèle est dans sa forme finale.</p>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb980-1"><a href="#cb980-1"></a><span class="co"># Création de la fonction d&#39;extraction</span></span>
<span id="cb980-2"><a href="#cb980-2"></a>extractor2 &lt;-<span class="st"> </span><span class="cf">function</span>(mod){</span>
<span id="cb980-3"><a href="#cb980-3"></a>  elements &lt;-<span class="st"> </span><span class="kw">ranef</span>(mod)<span class="op">$</span>Pays</span>
<span id="cb980-4"><a href="#cb980-4"></a>  vec &lt;-<span class="st"> </span>elements[,<span class="dv">1</span>]</span>
<span id="cb980-5"><a href="#cb980-5"></a>  <span class="kw">names</span>(vec) &lt;-<span class="st"> </span><span class="kw">rownames</span>(elements)</span>
<span id="cb980-6"><a href="#cb980-6"></a>  <span class="kw">return</span>(vec)</span>
<span id="cb980-7"><a href="#cb980-7"></a>}</span>
<span id="cb980-8"><a href="#cb980-8"></a><span class="co"># Préparation de l&#39;opération en multitraitement</span></span>
<span id="cb980-9"><a href="#cb980-9"></a>cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(<span class="dv">8</span>)</span>
<span id="cb980-10"><a href="#cb980-10"></a><span class="kw">clusterEvalQ</span>(cl,<span class="kw">library</span>(<span class="st">&quot;lme4&quot;</span>))</span>
<span id="cb980-11"><a href="#cb980-11"></a><span class="co"># Calcul des effets aléatoires en bootstrap</span></span>
<span id="cb980-12"><a href="#cb980-12"></a>valeurs &lt;-<span class="st"> </span><span class="kw">bootMer</span>(modele1,<span class="dt">FUN =</span> extractor2,<span class="dt">nsim =</span> <span class="dv">1000</span>,</span>
<span id="cb980-13"><a href="#cb980-13"></a>                   <span class="dt">use.u =</span> T, <span class="dt">type=</span><span class="st">&quot;parametric&quot;</span>, <span class="dt">ncpus =</span> <span class="dv">8</span>,</span>
<span id="cb980-14"><a href="#cb980-14"></a>                   <span class="dt">parallel=</span><span class="st">&quot;snow&quot;</span>,</span>
<span id="cb980-15"><a href="#cb980-15"></a>                   <span class="dt">cl =</span> cl)</span>
<span id="cb980-16"><a href="#cb980-16"></a><span class="co"># Sauvegarder des résultats!</span></span>
<span id="cb980-17"><a href="#cb980-17"></a><span class="kw">save</span>(valeurs,<span class="dt">file =</span> <span class="st">&#39;data/glmm/boot_binom2.rda&#39;</span>)</span></code></pre></div>
<p>Puisque nous disposons des distributions <em>bootstrapées</em> des différents effets aléatoires, nous pouvons directement les représenter dans un graphique (figure @ref(fig:randomconstantes2)). Les résultats sont très similaires à ceux de la figure @ref(fig:randomconstantes1), ce qui s’explique par le grand nombre d’observations et de groupes. Avec moins d’observations, il est recommandé de privilégier l’approche par <em>bootstrap</em>.</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb981-1"><a href="#cb981-1"></a><span class="co"># Chargement de nos valeurs bootstrapées</span></span>
<span id="cb981-2"><a href="#cb981-2"></a><span class="kw">load</span>(<span class="st">&#39;data/glmm/boot_binom2.rda&#39;</span>)</span>
<span id="cb981-3"><a href="#cb981-3"></a><span class="co"># Conversion des bootstraps en intervalle de confiance</span></span>
<span id="cb981-4"><a href="#cb981-4"></a>q025 &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">return</span>(<span class="kw">quantile</span>(x,<span class="dt">probs =</span> <span class="fl">0.025</span>))}</span>
<span id="cb981-5"><a href="#cb981-5"></a>q975 &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">return</span>(<span class="kw">quantile</span>(x,<span class="dt">probs =</span> <span class="fl">0.975</span>))}</span>
<span id="cb981-6"><a href="#cb981-6"></a>df &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(valeurs<span class="op">$</span>t)</span>
<span id="cb981-7"><a href="#cb981-7"></a>df_med &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Var2) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(</span>
<span id="cb981-8"><a href="#cb981-8"></a>  <span class="dt">med =</span> <span class="kw">median</span>(value),</span>
<span id="cb981-9"><a href="#cb981-9"></a>  <span class="dt">lower =</span> <span class="kw">q025</span>(value),</span>
<span id="cb981-10"><a href="#cb981-10"></a>  <span class="dt">upper =</span> <span class="kw">q975</span>(value))</span>
<span id="cb981-11"><a href="#cb981-11"></a><span class="co"># Ajout d&#39;une variable pour la couleur si significatif</span></span>
<span id="cb981-12"><a href="#cb981-12"></a>df_med<span class="op">$</span>sign &lt;-<span class="st"> </span><span class="kw">case_when</span>(</span>
<span id="cb981-13"><a href="#cb981-13"></a>  df_med<span class="op">$</span>lower<span class="op">&lt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>df_med<span class="op">$</span>upper<span class="op">&lt;</span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;inf&quot;</span>,</span>
<span id="cb981-14"><a href="#cb981-14"></a>  df_med<span class="op">$</span>lower<span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>df_med<span class="op">$</span>upper<span class="op">&gt;</span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;sup&quot;</span>,</span>
<span id="cb981-15"><a href="#cb981-15"></a>  <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;not&quot;</span></span>
<span id="cb981-16"><a href="#cb981-16"></a>)</span>
<span id="cb981-17"><a href="#cb981-17"></a><span class="co"># Affichage des résultats</span></span>
<span id="cb981-18"><a href="#cb981-18"></a><span class="kw">ggplot</span>(df_med) <span class="op">+</span><span class="st"> </span></span>
<span id="cb981-19"><a href="#cb981-19"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> lower, <span class="dt">xmax =</span> upper, <span class="dt">y =</span> <span class="kw">reorder</span>(Var2,med)), <span class="dt">width =</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb981-20"><a href="#cb981-20"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> med, <span class="dt">y =</span> <span class="kw">reorder</span>(Var2,med), <span class="dt">color =</span> sign)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb981-21"><a href="#cb981-21"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;inf&quot;</span> =<span class="st"> &quot;#0077b6&quot;</span>, <span class="st">&quot;sup&quot;</span> =<span class="st"> &quot;#e63946&quot;</span>, <span class="st">&quot;not&quot;</span>=<span class="st">&quot;#000000&quot;</span>), </span>
<span id="cb981-22"><a href="#cb981-22"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;sign. &lt; 0&quot;</span>, <span class="st">&quot;sign. &gt; 0&quot;</span>, <span class="st">&quot;non sign.&quot;</span>)) <span class="op">+</span></span>
<span id="cb981-23"><a href="#cb981-23"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Constante aléatoire&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Pays&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/randomconstantes2-1.png" alt="Constantes aléatoires estimées par Pays (IC par bootstrap)" width="70%" />
<p class="caption">
(#fig:randomconstantes2)Constantes aléatoires estimées par Pays (IC par bootstrap)
</p>
</div>
</div>
</div>
<div id="sect0962" class="section level3">
<h3><span class="header-section-number">9.6.2</span> Ajustement du modèle avec constantes et pentes aléatoires</h3>
<p>Dans le modèle précédent, nous avons ajusté pour chaque pays une constante aléatoire afin de vérifier si la probabilité d’utiliser le vélo comme mode de transport principal changeait d’un pays d’Europe à l’autre. Nous souhaitons à présent tester l’hypothèse que l’impact de l’âge sur la probabilité d’utiliser le vélo varie d’un pays à l’autre. Pour cela, nous allons ajuster des constantes aléatoires par pays. Nous comparerons trois modèles, triés ici selon leur niveau de complexité (nombre de paramètres) :</p>
<ul>
<li>le modèle avec uniquement des constantes aléatoires;</li>
<li>le modèle avec des constantes et pentes aléatoires indépendantes;</li>
<li>le modèle avec des constantes et pentes aléatoires corrélées.</li>
</ul>
<p>Dans le <em>package</em> <code>lme4</code>, les syntaxes pour ajuster ces trois modèles sont les suivantes :</p>
<ul>
<li>constantes aléatoires : <code>+(1|Pays)</code>;</li>
<li>constantes et pentes aléatoires indépendantes : <code>+(1 + Age||Pays)</code>;</li>
<li>constantes et pentes aléatoires corrélées : <code>+(1 + Age|Pays)</code>.</li>
</ul>
<p>Notez qu’il est aussi possible d’ajuster un modèle avec uniquement des pentes aléatoires avec la syntaxe : <code>+(-1 + Age|Pays)</code>. Le paramètre <code>-1</code> sert à retirer explicitement la constante aléatoire du modèle. Ajustons donc nos deux modèles avec pentes et constantes aléatoires.</p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="#cb982-1"></a><span class="co"># Constantes et pentes aléatoires indépendantes</span></span>
<span id="cb982-2"><a href="#cb982-2"></a>modele2 &lt;-<span class="st"> </span><span class="kw">glmer</span>(y <span class="op">~</span><span class="st"> </span>Sexe <span class="op">+</span><span class="st"> </span>Age2 <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>StatutEmploi <span class="op">+</span><span class="st"> </span>Revenu <span class="op">+</span></span>
<span id="cb982-3"><a href="#cb982-3"></a><span class="st">              </span>Residence <span class="op">+</span><span class="st"> </span>Duree2 <span class="op">+</span><span class="st"> </span>ConsEnv <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Age2<span class="op">||</span>Pays),</span>
<span id="cb982-4"><a href="#cb982-4"></a>            <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb982-5"><a href="#cb982-5"></a>            <span class="dt">control =</span> <span class="kw">glmerControl</span>(<span class="dt">optimizer =</span> <span class="st">&quot;bobyqa&quot;</span>),</span>
<span id="cb982-6"><a href="#cb982-6"></a>            <span class="dt">data =</span> dfenquete2)</span>
<span id="cb982-7"><a href="#cb982-7"></a><span class="co"># Constantes et pentes aléatoires corrélées</span></span>
<span id="cb982-8"><a href="#cb982-8"></a>modele3 &lt;-<span class="st"> </span><span class="kw">glmer</span>(y <span class="op">~</span><span class="st"> </span>Sexe <span class="op">+</span><span class="st"> </span>Age2 <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>StatutEmploi <span class="op">+</span><span class="st"> </span>Revenu <span class="op">+</span></span>
<span id="cb982-9"><a href="#cb982-9"></a><span class="st">              </span>Residence <span class="op">+</span><span class="st"> </span>Duree2 <span class="op">+</span><span class="st"> </span>ConsEnv <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Age2<span class="op">|</span>Pays),</span>
<span id="cb982-10"><a href="#cb982-10"></a>            <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&quot;logit&quot;</span>),</span>
<span id="cb982-11"><a href="#cb982-11"></a>            <span class="dt">control =</span> <span class="kw">glmerControl</span>(<span class="dt">optimizer =</span> <span class="st">&quot;bobyqa&quot;</span>),</span>
<span id="cb982-12"><a href="#cb982-12"></a>            <span class="dt">data =</span> dfenquete2)</span></code></pre></div>
<div id="sect09621" class="section level4">
<h4><span class="header-section-number">9.6.2.1</span> Significativité de l’effet aléatoire</h4>
<p>Puisque les trois modèles sont imbriqués, la première étape est de vérifier si les ajouts successifs au modèle de base sont significatifs, ce que nous pouvons tester avec un rapport de vraisemblance.</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb983-1"><a href="#cb983-1"></a><span class="kw">anova</span>(modele1,modele2,modele3)</span></code></pre></div>
<pre><code>## Data: dfenquete2
## Models:
## modele1: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence + 
## modele1:     Duree2 + ConsEnv + (1 | Pays)
## modele2: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence + 
## modele2:     Duree2 + ConsEnv + (1 + Age2 || Pays)
## modele3: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence + 
## modele3:     Duree2 + ConsEnv + (1 + Age2 | Pays)
##         npar   AIC   BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)   
## modele1   18 19176 19323 -9570.1    19140                        
## modele2   19 19171 19325 -9566.3    19133 7.5754  1   0.005917 **
## modele3   20 19172 19335 -9566.1    19132 0.4033  1   0.525385   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Nous constatons ainsi que l’ajout des pentes aléatoires permet d’améliorer significativement le modèle, mais que l’ajout de la corrélation entre les pentes et les constantes aléatoires a un apport très marginal. Nous décidons tout de même de le garder dans un premier temps, car ce paramètre a un intérêt théorique. Affichons le résumé du modèle 3.</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="#cb985-1"></a><span class="kw">summary</span>(modele3)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence +  
##     Duree2 + ConsEnv + (1 + Age2 | Pays)
##    Data: dfenquete2
## Control: glmerControl(optimizer = &quot;bobyqa&quot;)
## 
##      AIC      BIC   logLik deviance df.resid 
##  19172.2  19335.1  -9566.1  19132.2    25527 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.2087 -0.4392 -0.3218 -0.2137  7.1677 
## 
## Random effects:
##  Groups Name        Variance Std.Dev. Corr 
##  Pays   (Intercept) 0.594976 0.77135       
##         Age2        0.007326 0.08559  -0.22
## Number of obs: 25547, groups:  Pays, 26
## 
## Fixed effects:
##                                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   -3.357922   0.213122 -15.756  &lt; 2e-16 ***
## Sexehomme                      0.372886   0.037961   9.823  &lt; 2e-16 ***
## Age2                          -0.087748   0.027796  -3.157 0.001595 ** 
## Educationsecondaire            0.179620   0.103838   1.730 0.083664 .  
## Educationsecondaire inferieur  0.286993   0.111904   2.565 0.010329 *  
## Educationuniversite            0.130114   0.107149   1.214 0.224622    
## StatutEmploisans emploi        0.256253   0.042508   6.028 1.66e-09 ***
## Revenufaible                   0.070578   0.071820   0.983 0.325754    
## Revenumoyen                    0.038414   0.065347   0.588 0.556630    
## Revenusans reponse             0.203615   0.102658   1.983 0.047319 *  
## Revenutres eleve              -0.124202   0.185684  -0.669 0.503564    
## Revenutres faible              0.235617   0.085949   2.741 0.006118 ** 
## Residencegrande ville          0.269577   0.069366   3.886 0.000102 ***
## Residencepetite-moyenne ville  0.275698   0.061575   4.477 7.56e-06 ***
## Residencezone rurale          -0.118979   0.069177  -1.720 0.085446 .  
## Duree2                        -0.018889   0.019274  -0.980 0.327067    
## ConsEnv                        0.101888   0.009291  10.967  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>À nouveau, nous nous intéressons ici principalement à la section <code>Random Effect</code>, puisque les effets fixes s’interprètent exactement comme dans les modèles présentés dans le chapitre @ref(chap06). Les constantes ont une variance de 0,595 et les pentes de 0,007. La corrélation entre les deux effets est de -0,22. Cette corrélation est négative et relativement faible, ce qui signifie que les pays dans lesquels la constante est forte tendent à avoir un coefficient plus petit pour l’âge et donc une réduction accrue de la probabilité d’utiliser le vélo avec l’âge. Nous devons cependant encore nous assurer qu’elle est significativement différente de 0. Pour cela, nous devons calculer l’intervalle de confiance des trois paramètres de variance du modèle. Nous utilisons à nouveau une approche par <em>bootstrap</em> et nous enregistrons les résultats.</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="#cb987-1"></a><span class="co"># Fonction d&#39;extraction des trois paramètres de variance</span></span>
<span id="cb987-2"><a href="#cb987-2"></a>extractor3 &lt;-<span class="st"> </span><span class="cf">function</span>(mod){</span>
<span id="cb987-3"><a href="#cb987-3"></a>  vari1 &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(mod)[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span>
<span id="cb987-4"><a href="#cb987-4"></a>  vari2 &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(mod)[[<span class="dv">1</span>]][[<span class="dv">4</span>]]</span>
<span id="cb987-5"><a href="#cb987-5"></a>  covari &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(mod)[[<span class="dv">1</span>]][[<span class="dv">2</span>]]</span>
<span id="cb987-6"><a href="#cb987-6"></a>  <span class="kw">return</span>(<span class="kw">c</span>(<span class="st">&quot;vari1&quot;</span>=vari1,<span class="st">&quot;vari2&quot;</span>=vari2,<span class="st">&quot;covari&quot;</span>=covari))</span>
<span id="cb987-7"><a href="#cb987-7"></a>}</span>
<span id="cb987-8"><a href="#cb987-8"></a><span class="co"># Lancement du bootstrap</span></span>
<span id="cb987-9"><a href="#cb987-9"></a>valeurs &lt;-<span class="st"> </span><span class="kw">bootMer</span>(modele3,<span class="dt">FUN =</span> extractor3,<span class="dt">nsim =</span> <span class="dv">1000</span>,</span>
<span id="cb987-10"><a href="#cb987-10"></a>                   <span class="dt">use.u =</span> F, <span class="dt">type=</span><span class="st">&quot;parametric&quot;</span>, <span class="dt">ncpus =</span> <span class="dv">8</span>,</span>
<span id="cb987-11"><a href="#cb987-11"></a>                   <span class="dt">parallel=</span><span class="st">&quot;snow&quot;</span>,</span>
<span id="cb987-12"><a href="#cb987-12"></a>                   <span class="dt">cl =</span> cl,</span>
<span id="cb987-13"><a href="#cb987-13"></a>                   <span class="dt">.progress=</span><span class="st">&quot;txt&quot;</span>,<span class="dt">PBarg=</span><span class="kw">list</span>(<span class="dt">style=</span><span class="dv">3</span>))</span>
<span id="cb987-14"><a href="#cb987-14"></a><span class="co"># Enregistrement des résultats</span></span>
<span id="cb987-15"><a href="#cb987-15"></a><span class="kw">save</span>(valeurs,<span class="dt">file =</span> <span class="st">&#39;data/glmm/boot_binom3.rda&#39;</span>)</span></code></pre></div>
<p>À partir des valeurs <em>bootstrapées</em>, nous pouvons représenter les distributions de ces trois paramètres (variance des constantes, variance des pentes et corrélation entre les deux).</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="#cb988-1"></a><span class="co"># Chargement des résultats</span></span>
<span id="cb988-2"><a href="#cb988-2"></a><span class="kw">load</span>(<span class="st">&#39;data/glmm/boot_binom3.rda&#39;</span>)</span>
<span id="cb988-3"><a href="#cb988-3"></a><span class="co"># Conversion des valeurs de covariance en corrélation</span></span>
<span id="cb988-4"><a href="#cb988-4"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb988-5"><a href="#cb988-5"></a>  <span class="dt">corr_values =</span> valeurs<span class="op">$</span>t[,<span class="dv">3</span>] <span class="op">/</span><span class="st"> </span>(<span class="kw">sqrt</span>(valeurs<span class="op">$</span>t[,<span class="dv">1</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(valeurs<span class="op">$</span>t[,<span class="dv">2</span>])),</span>
<span id="cb988-6"><a href="#cb988-6"></a>  <span class="dt">vari_const =</span> valeurs<span class="op">$</span>t[,<span class="dv">1</span>],</span>
<span id="cb988-7"><a href="#cb988-7"></a>  <span class="dt">vari_pente =</span> valeurs<span class="op">$</span>t[,<span class="dv">2</span>]</span>
<span id="cb988-8"><a href="#cb988-8"></a>  )</span>
<span id="cb988-9"><a href="#cb988-9"></a><span class="co"># Histogramme pour la variance des constantes</span></span>
<span id="cb988-10"><a href="#cb988-10"></a>breaks1 &lt;-<span class="st"> </span><span class="kw">quantile</span>(df<span class="op">$</span>vari_const,<span class="dt">probs=</span><span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>,<span class="fl">0.999</span>))</span>
<span id="cb988-11"><a href="#cb988-11"></a>label1 &lt;-<span class="st"> </span><span class="kw">round</span>(breaks1,<span class="dv">3</span>)</span>
<span id="cb988-12"><a href="#cb988-12"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-13"><a href="#cb988-13"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> vari_const), <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">bins =</span> <span class="dv">30</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-14"><a href="#cb988-14"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">median</span>(df<span class="op">$</span>vari_const), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-15"><a href="#cb988-15"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">quantile</span>(df<span class="op">$</span>vari_const, <span class="dt">probs =</span> <span class="fl">0.025</span>), </span>
<span id="cb988-16"><a href="#cb988-16"></a>             <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-17"><a href="#cb988-17"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">quantile</span>(df<span class="op">$</span>vari_const, <span class="dt">probs =</span> <span class="fl">0.975</span>), </span>
<span id="cb988-18"><a href="#cb988-18"></a>             <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-19"><a href="#cb988-19"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Variance des constantes&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>)<span class="op">+</span><span class="st"> </span></span>
<span id="cb988-20"><a href="#cb988-20"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> breaks1, <span class="dt">labels =</span> label1)</span>
<span id="cb988-21"><a href="#cb988-21"></a><span class="co"># Histogramme pour la variance des pentes</span></span>
<span id="cb988-22"><a href="#cb988-22"></a>breaks2 &lt;-<span class="st"> </span><span class="kw">quantile</span>(df<span class="op">$</span>vari_pente,<span class="dt">probs=</span><span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>,<span class="fl">0.999</span>))</span>
<span id="cb988-23"><a href="#cb988-23"></a>label2 &lt;-<span class="st"> </span><span class="kw">round</span>(breaks2,<span class="dv">3</span>)</span>
<span id="cb988-24"><a href="#cb988-24"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-25"><a href="#cb988-25"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> vari_pente), <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">bins =</span> <span class="dv">30</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-26"><a href="#cb988-26"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">median</span>(df<span class="op">$</span>vari_pente), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-27"><a href="#cb988-27"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">quantile</span>(df<span class="op">$</span>vari_pente, <span class="dt">probs =</span> <span class="fl">0.025</span>), </span>
<span id="cb988-28"><a href="#cb988-28"></a>             <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-29"><a href="#cb988-29"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">quantile</span>(df<span class="op">$</span>vari_pente, <span class="dt">probs =</span> <span class="fl">0.975</span>), </span>
<span id="cb988-30"><a href="#cb988-30"></a>             <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-31"><a href="#cb988-31"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Variance des pentes&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>)<span class="op">+</span></span>
<span id="cb988-32"><a href="#cb988-32"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> breaks2, <span class="dt">labels =</span> label2)</span>
<span id="cb988-33"><a href="#cb988-33"></a><span class="co"># Histogramme pour la corrélation</span></span>
<span id="cb988-34"><a href="#cb988-34"></a>breaks3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="fl">0.5</span>,<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="kw">median</span>(df<span class="op">$</span>corr_values))</span>
<span id="cb988-35"><a href="#cb988-35"></a>label3 &lt;-<span class="st"> </span><span class="kw">round</span>(breaks3,<span class="dv">3</span>)</span>
<span id="cb988-36"><a href="#cb988-36"></a>p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-37"><a href="#cb988-37"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> corr_values), <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">bins =</span> <span class="dv">30</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-38"><a href="#cb988-38"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">median</span>(df<span class="op">$</span>corr_values), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-39"><a href="#cb988-39"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">quantile</span>(df<span class="op">$</span>corr_values, <span class="dt">probs =</span> <span class="fl">0.025</span>), </span>
<span id="cb988-40"><a href="#cb988-40"></a>             <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-41"><a href="#cb988-41"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">quantile</span>(df<span class="op">$</span>corr_values, <span class="dt">probs =</span> <span class="fl">0.975</span>), </span>
<span id="cb988-42"><a href="#cb988-42"></a>             <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-43"><a href="#cb988-43"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Corrélation pentes/constantes&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb988-44"><a href="#cb988-44"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> breaks3, <span class="dt">labels =</span> label3)</span>
<span id="cb988-45"><a href="#cb988-45"></a><span class="kw">ggarrange</span>(p1,p2, p3, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/glmmvarboot-1.png" alt="Incertitude autour des paramètres de variance obtenue par bootstrap" width="95%" />
<p class="caption">
(#fig:glmmvarboot)Incertitude autour des paramètres de variance obtenue par bootstrap
</p>
</div>
<p>Nous constatons ainsi à la figure @ref(fig:glmmvarboot) que la variance des constantes aléatoires est significativement différente de zéro (cette valeur n’est pas dans l’intervalle de confiance à 95 % représenté par les lignes verticales bleues) et une médiane de 0,56 (ligne verticale rouge). Pour les pentes, zéro est également à la limite de l’intervalle de confiance et la distribution asymétrique et étalée nous indique que ce paramètre est fortement incertain dans le modèle. Enfin, la corrélation entre les pentes et les constantes est de loin le paramètre le plus incertain et son intervalle de confiance est franchement à cheval sur zéro, ce qui devrait nous amener à privilégier un modèle sans ce paramètre.</p>
<p>Pour terminer, nous pouvons calculer les R<sup>2</sup> marginal et conditionnel du modèle afin de mieux cerner le rôle joué par les effets fixes et les effets aléatoires.</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="#cb989-1"></a><span class="kw">r.squaredGLMM</span>(modele3)</span></code></pre></div>
<pre><code>##                    R2m        R2c
## theoretical 0.03413720 0.18360159
## delta       0.01419945 0.07636951</code></pre>
<p>Les valeurs des R<sup>2</sup> marginal et conditionnel du modèle sont similaires à ceux que nous avions obtenus avec seulement des constantes aléatoires dans la section précédente, signalant l’apport relativement faible des pentes aléatoires.</p>
</div>
<div id="sect09622" class="section level4">
<h4><span class="header-section-number">9.6.2.2</span> Analyse des effets aléatoires</h4>
<p>Pour analyser facilement les constantes et pentes aléatoires de chaque pays, nous pouvons représenter graphiquement leurs intervalles de confiances construits à partir des simulations tirées de la distribution a posteriori du modèle.</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="#cb991-1"></a><span class="co"># Simulations et extraction des effets aléatoires</span></span>
<span id="cb991-2"><a href="#cb991-2"></a><span class="kw">library</span>(merTools)</span>
<span id="cb991-3"><a href="#cb991-3"></a>simsRE &lt;-<span class="st"> </span><span class="kw">REsim</span>(modele3,<span class="dt">n.sims =</span> <span class="dv">1000</span>, <span class="dt">oddsRatio =</span> F)</span>
<span id="cb991-4"><a href="#cb991-4"></a><span class="co"># Calcul des intervalles de confiance</span></span>
<span id="cb991-5"><a href="#cb991-5"></a>simsRE<span class="op">$</span>lower &lt;-<span class="st"> </span>simsRE<span class="op">$</span>mean <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>simsRE<span class="op">$</span>sd</span>
<span id="cb991-6"><a href="#cb991-6"></a>simsRE<span class="op">$</span>upper &lt;-<span class="st"> </span>simsRE<span class="op">$</span>mean <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>simsRE<span class="op">$</span>sd</span>
<span id="cb991-7"><a href="#cb991-7"></a><span class="co"># Variable binaire pour la significativité</span></span>
<span id="cb991-8"><a href="#cb991-8"></a>simsRE<span class="op">$</span>sign &lt;-<span class="st"> </span><span class="kw">case_when</span>(</span>
<span id="cb991-9"><a href="#cb991-9"></a>  simsRE<span class="op">$</span>lower<span class="op">&lt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>simsRE<span class="op">$</span>upper<span class="op">&lt;</span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;inf&quot;</span>,</span>
<span id="cb991-10"><a href="#cb991-10"></a>  simsRE<span class="op">$</span>lower<span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>simsRE<span class="op">$</span>upper<span class="op">&gt;</span><span class="dv">0</span> <span class="op">~</span><span class="st"> &quot;sup&quot;</span>,</span>
<span id="cb991-11"><a href="#cb991-11"></a>  <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;not&quot;</span></span>
<span id="cb991-12"><a href="#cb991-12"></a>)</span>
<span id="cb991-13"><a href="#cb991-13"></a>df1 &lt;-<span class="st"> </span><span class="kw">subset</span>(simsRE, <span class="kw">grepl</span>(<span class="st">&quot;Intercept&quot;</span>,simsRE<span class="op">$</span>term,<span class="dt">fixed =</span> T))</span>
<span id="cb991-14"><a href="#cb991-14"></a>df2 &lt;-<span class="st"> </span><span class="kw">subset</span>(simsRE, <span class="kw">grepl</span>(<span class="st">&quot;Age2&quot;</span>,simsRE<span class="op">$</span>term,<span class="dt">fixed =</span> T))</span>
<span id="cb991-15"><a href="#cb991-15"></a><span class="co"># Représentation des intervalles de confiance</span></span>
<span id="cb991-16"><a href="#cb991-16"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df1) <span class="op">+</span><span class="st"> </span></span>
<span id="cb991-17"><a href="#cb991-17"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> lower, <span class="dt">xmax =</span> upper,</span>
<span id="cb991-18"><a href="#cb991-18"></a>                     <span class="dt">y =</span> <span class="kw">reorder</span>(groupID,mean)), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">height =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb991-19"><a href="#cb991-19"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean, <span class="dt">y =</span> <span class="kw">reorder</span>(groupID,mean),</span>
<span id="cb991-20"><a href="#cb991-20"></a>                 <span class="dt">color =</span> sign)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb991-21"><a href="#cb991-21"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;inf&quot;</span> =<span class="st"> &quot;#0077b6&quot;</span>, <span class="st">&quot;sup&quot;</span> =<span class="st"> &quot;#e63946&quot;</span>, <span class="st">&quot;not&quot;</span>=<span class="st">&quot;#000000&quot;</span>), </span>
<span id="cb991-22"><a href="#cb991-22"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;sign. &lt; 0&quot;</span>, <span class="st">&quot;non sign.&quot;</span>, <span class="st">&quot;sign. &gt; 0&quot;</span>)) <span class="op">+</span></span>
<span id="cb991-23"><a href="#cb991-23"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Constante aléatoire&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Pays&quot;</span>)</span>
<span id="cb991-24"><a href="#cb991-24"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df2) <span class="op">+</span><span class="st"> </span></span>
<span id="cb991-25"><a href="#cb991-25"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> lower, <span class="dt">xmax =</span> upper,</span>
<span id="cb991-26"><a href="#cb991-26"></a>                     <span class="dt">y =</span> <span class="kw">reorder</span>(groupID,mean)), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">height =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb991-27"><a href="#cb991-27"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean, <span class="dt">y =</span> <span class="kw">reorder</span>(groupID,mean),</span>
<span id="cb991-28"><a href="#cb991-28"></a>                 <span class="dt">color =</span> sign)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb991-29"><a href="#cb991-29"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;inf&quot;</span> =<span class="st"> &quot;#0077b6&quot;</span>, <span class="st">&quot;sup&quot;</span> =<span class="st"> &quot;#e63946&quot;</span>, <span class="st">&quot;not&quot;</span>=<span class="st">&quot;#000000&quot;</span>), </span>
<span id="cb991-30"><a href="#cb991-30"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;sign. &lt; 0&quot;</span>, <span class="st">&quot;non sign.&quot;</span>, <span class="st">&quot;sign. &gt; 0&quot;</span>)) <span class="op">+</span></span>
<span id="cb991-31"><a href="#cb991-31"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Pente aléatoire (âge)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Pays&quot;</span>)</span>
<span id="cb991-32"><a href="#cb991-32"></a><span class="kw">ggarrange</span>(p1,p2, <span class="dt">common.legend =</span> T, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/randomconstantes2b-1.png" alt="Constantes aléatoires estimées par pays (intervalles de confiance obtenus par simulations)" width="70%" />
<p class="caption">
(#fig:randomconstantes2b)Constantes aléatoires estimées par pays (intervalles de confiance obtenus par simulations)
</p>
</div>
<p>La figure @ref(fig:randomconstantes2b) nous permet ainsi de constater que l’effet des pays sur les pentes est presque toujours non significatif sauf pour le Danemark. Son effet négatif (-0,136) indique un renforcement de l’effet général lui-même négatif (-0,088). Une interprétation possible est qu’au Danemark l’utilisation du vélo est plus proportionnellement plus courante par les jeunes que dans le reste des pays de l’Europe.</p>
<p>Pour l’interprétation finale, il est nécessaire d’afficher les valeurs exactes de ces différents paramètres et dans notre cas de les convertir en rapport de cotes avec la fonction exponentielle. Pour les pentes aléatoires, il peut être plus facile d’interpréter la somme de l’effet fixe et de l’effet aléatoire.</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="#cb992-1"></a><span class="co"># Extraction des effets aléatoires obtenus par simulation</span></span>
<span id="cb992-2"><a href="#cb992-2"></a>mat &lt;-<span class="st"> </span>simsRE[<span class="kw">c</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;lower&quot;</span>,<span class="st">&quot;upper&quot;</span>)]</span>
<span id="cb992-3"><a href="#cb992-3"></a>mat<span class="op">$</span>Pays &lt;-<span class="st"> </span>simsRE<span class="op">$</span>groupID</span>
<span id="cb992-4"><a href="#cb992-4"></a>mat<span class="op">$</span>effet &lt;-<span class="st"> </span>simsRE<span class="op">$</span>term</span>
<span id="cb992-5"><a href="#cb992-5"></a><span class="co"># Séparation des pentes et des constantes</span></span>
<span id="cb992-6"><a href="#cb992-6"></a>df1 &lt;-<span class="st"> </span><span class="kw">subset</span>(mat, <span class="kw">grepl</span>(<span class="st">&quot;Intercept&quot;</span>,mat<span class="op">$</span>effet, <span class="dt">fixed =</span> <span class="ot">TRUE</span>))</span>
<span id="cb992-7"><a href="#cb992-7"></a>df2 &lt;-<span class="st"> </span><span class="kw">subset</span>(mat, <span class="kw">grepl</span>(<span class="st">&quot;Age2&quot;</span>,mat<span class="op">$</span>effet, <span class="dt">fixed =</span> <span class="ot">TRUE</span>))</span>
<span id="cb992-8"><a href="#cb992-8"></a><span class="co"># Conversion en rapports de cotes pour les pentes (+ effet fixe)</span></span>
<span id="cb992-9"><a href="#cb992-9"></a>df2<span class="op">$</span>RC &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">exp</span>(df2<span class="op">$</span>mean <span class="op">+</span><span class="st"> </span><span class="kw">fixef</span>(modele3)[[<span class="dv">3</span>]]),<span class="dv">3</span>)</span>
<span id="cb992-10"><a href="#cb992-10"></a>df2<span class="op">$</span>RC025 &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">exp</span>(df2<span class="op">$</span>lower <span class="op">+</span><span class="st"> </span><span class="kw">fixef</span>(modele3)[[<span class="dv">3</span>]]),<span class="dv">3</span>)</span>
<span id="cb992-11"><a href="#cb992-11"></a>df2<span class="op">$</span>RC975 &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">exp</span>(df2<span class="op">$</span>upper <span class="op">+</span><span class="st"> </span><span class="kw">fixef</span>(modele3)[[<span class="dv">3</span>]]),<span class="dv">3</span>)</span>
<span id="cb992-12"><a href="#cb992-12"></a><span class="kw">print</span>(<span class="kw">head</span>(df2[<span class="kw">c</span>(<span class="st">&quot;Pays&quot;</span>,<span class="st">&quot;RC&quot;</span>,<span class="st">&quot;RC025&quot;</span>,<span class="st">&quot;RC975&quot;</span>)],<span class="dv">10</span>))</span></code></pre></div>
<pre><code>##         Pays    RC RC025 RC975
## 27 Allemagne 0.835 0.744 0.937
## 28  Autriche 0.986 0.875 1.112
## 29  Belgique 0.895 0.797 1.005
## 30  Bulgarie 0.946 0.824 1.086
## 31   Croatie 0.905 0.802 1.020
## 32  Danemark 0.799 0.720 0.886
## 33   Espagne 0.920 0.796 1.063
## 34   Estonie 0.950 0.835 1.080
## 35  Finlande 0.865 0.774 0.967
## 36    France 0.897 0.783 1.029</code></pre>
<p>Nous constatons ainsi qu’au Danemark, les chances pour un individu d’utiliser le vélo sont réduites de 20 % à chaque augmentation de l’âge d’un écart-type, contre seulement 1,5 % en Autriche (non significatif pour ce dernier). Notons ici qu’un écart-type de la variable <code>Age</code> est de 11 ans. Nous pouvons à présent analyser les constantes.</p>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="#cb994-1"></a><span class="co"># Conversion en rapports de cotes pour les constantes</span></span>
<span id="cb994-2"><a href="#cb994-2"></a>df1<span class="op">$</span>RC &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">exp</span>(df1<span class="op">$</span>mean),<span class="dv">3</span>)</span>
<span id="cb994-3"><a href="#cb994-3"></a>df1<span class="op">$</span>RC025 &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">exp</span>(df1<span class="op">$</span>lower),<span class="dv">3</span>)</span>
<span id="cb994-4"><a href="#cb994-4"></a>df1<span class="op">$</span>RC975 &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">exp</span>(df1<span class="op">$</span>upper),<span class="dv">3</span>)</span>
<span id="cb994-5"><a href="#cb994-5"></a><span class="kw">print</span>(<span class="kw">head</span>(df1[<span class="kw">c</span>(<span class="st">&quot;Pays&quot;</span>,<span class="st">&quot;RC&quot;</span>,<span class="st">&quot;RC025&quot;</span>,<span class="st">&quot;RC975&quot;</span>)],<span class="dv">10</span>))</span></code></pre></div>
<pre><code>##         Pays    RC RC025 RC975
## 1  Allemagne 1.691 1.207 2.369
## 2   Autriche 1.312 0.925 1.860
## 3   Belgique 1.435 1.015 2.029
## 4   Bulgarie 0.547 0.375 0.799
## 5    Croatie 1.885 1.350 2.630
## 6   Danemark 4.087 2.937 5.686
## 7    Espagne 0.291 0.192 0.440
## 8    Estonie 1.131 0.798 1.602
## 9   Finlande 2.243 1.609 3.125
## 10    France 0.527 0.359 0.774</code></pre>
<p>En revanche, les chances pour un individu d’utiliser le vélo comme mode de transport pour son trajet le plus fréquent sont 4 fois supérieures à la moyenne européenne, contre seulement 1,3 fois en Autriche. Notez à nouveau que les intervalles de confiance pour ces pentes et ces constantes pourraient être estimés plus fiablement par <em>bootstrap</em>.</p>
</div>
<div id="sect09623" class="section level4">
<h4><span class="header-section-number">9.6.2.3</span> Diagnostic des effets aléatoires</h4>
<p>Pour rappel, dans un modèle GLMM, les effets aléatoires sont modélisés comme provenant de distributions normales. Nous devons donc vérifier qu’ils respectent cette condition d’application. La figure @ref(fig:diagbinomglmm1) (graphique quantile-quantile) nous permet de constater que les constantes suivent bien une distribution normale, ce qui ne semble pas vraiment être le cas pour les pentes. Considérant que leurs effets sont petits, il serait plus pertinent ici de les retirer du modèle.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/diagbinomglmm1-1.png" alt="Distribution normale univariée des constantes et pentes aléatoires" width="90%" />
<p class="caption">
(#fig:diagbinomglmm1)Distribution normale univariée des constantes et pentes aléatoires
</p>
</div>
<p>Considérant que ce modèle inclut une corrélation entre les constantes et les pentes aléatoires, il est également nécessaire de vérifier si elles suivent conjointement une distribution normale bivariée. La figure @ref(fig:diagbinomglmm2) semble indiquer que c’est le cas.</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="#cb996-1"></a>cor_mat &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(modele3)[[<span class="dv">1</span>]]</span>
<span id="cb996-2"><a href="#cb996-2"></a>re_effects &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">ranef</span>(modele3)<span class="op">$</span>Pays)</span>
<span id="cb996-3"><a href="#cb996-3"></a><span class="kw">names</span>(re_effects) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;constante&quot;</span>,<span class="st">&quot;pente&quot;</span>)</span>
<span id="cb996-4"><a href="#cb996-4"></a><span class="kw">library</span>(ellipse)</span>
<span id="cb996-5"><a href="#cb996-5"></a>levels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.75</span>,<span class="fl">0.95</span>)</span>
<span id="cb996-6"><a href="#cb996-6"></a>els &lt;-<span class="st"> </span><span class="kw">lapply</span>(levels, <span class="cf">function</span>(i){</span>
<span id="cb996-7"><a href="#cb996-7"></a>  el &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">ellipse</span>(cor_mat,<span class="dt">center =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">level =</span> i))</span>
<span id="cb996-8"><a href="#cb996-8"></a>  <span class="kw">names</span>(el) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>)</span>
<span id="cb996-9"><a href="#cb996-9"></a>  <span class="kw">return</span>(el)</span>
<span id="cb996-10"><a href="#cb996-10"></a>})</span>
<span id="cb996-11"><a href="#cb996-11"></a>ref_points &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">data.frame</span>(MASS<span class="op">::</span><span class="kw">mvrnorm</span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">mu =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">Sigma =</span> cor_mat)))</span>
<span id="cb996-12"><a href="#cb996-12"></a><span class="kw">names</span>(ref_points) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>)</span>
<span id="cb996-13"><a href="#cb996-13"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb996-14"><a href="#cb996-14"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y), <span class="dt">data =</span> ref_points, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">size =</span> <span class="fl">0.4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb996-15"><a href="#cb996-15"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> els[[<span class="dv">1</span>]], <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">color =</span> <span class="st">&quot;a&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb996-16"><a href="#cb996-16"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> els[[<span class="dv">2</span>]], <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">color =</span> <span class="st">&quot;b&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb996-17"><a href="#cb996-17"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> els[[<span class="dv">3</span>]], <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">color =</span> <span class="st">&quot;c&quot;</span>)) <span class="op">+</span></span>
<span id="cb996-18"><a href="#cb996-18"></a><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> els[[<span class="dv">4</span>]], <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">color =</span> <span class="st">&quot;d&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb996-19"><a href="#cb996-19"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> re_effects, <span class="kw">aes</span>(<span class="dt">x =</span> constante, <span class="dt">y =</span> pente))<span class="op">+</span></span>
<span id="cb996-20"><a href="#cb996-20"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>=<span class="st">&quot;#90e0ef&quot;</span>,</span>
<span id="cb996-21"><a href="#cb996-21"></a>                                <span class="st">&quot;b&quot;</span>=<span class="st">&quot;#00b4d8&quot;</span>,</span>
<span id="cb996-22"><a href="#cb996-22"></a>                                <span class="st">&quot;c&quot;</span>=<span class="st">&quot;#0077b6&quot;</span>,</span>
<span id="cb996-23"><a href="#cb996-23"></a>                                <span class="st">&quot;d&quot;</span>=<span class="st">&quot;#03045e&quot;</span>),</span>
<span id="cb996-24"><a href="#cb996-24"></a>                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;5 %&quot;</span>,<span class="st">&quot;25 %&quot;</span>,<span class="st">&quot;75 %&quot;</span>,<span class="st">&quot;95 %&quot;</span>))<span class="op">+</span></span>
<span id="cb996-25"><a href="#cb996-25"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Constantes&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Pentes&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;quantiles&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/diagbinomglmm2-1.png" alt="Distribution normale bivariée des constantes et pentes aléatoires" width="70%" />
<p class="caption">
(#fig:diagbinomglmm2)Distribution normale bivariée des constantes et pentes aléatoires
</p>
</div>
</div>
<div id="sect09624" class="section level4">
<h4><span class="header-section-number">9.6.2.4</span> Inférence pour les effets fixes</h4>
<p>Nous avions mentionné dans les sections précédentes que le calcul de valeurs de <em>p</em> pour les effets fixes fait l’objet de controverses pour les modèles GLMM. La méthode offrant le meilleur compromis entre rapidité de calcul et fiabilité est la méthode Satterthwaite implémentée dans le <em>package</em> <code>lmerTest</code>. Pour l’utiliser, il suffit de charger le <em>package</em> <code>lmerTest</code> après <code>lme4</code>, ce qui modifiera la fonction <code>summary</code> pour qu’elle utilise directement cette approche.</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="#cb997-1"></a><span class="kw">library</span>(lmerTest)</span>
<span id="cb997-2"><a href="#cb997-2"></a><span class="kw">round</span>(<span class="kw">summary</span>(modele3)<span class="op">$</span>coefficients,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##                               Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)                     -3.358      0.213 -15.756    0.000
## Sexehomme                        0.373      0.038   9.823    0.000
## Age2                            -0.088      0.028  -3.157    0.002
## Educationsecondaire              0.180      0.104   1.730    0.084
## Educationsecondaire inferieur    0.287      0.112   2.565    0.010
## Educationuniversite              0.130      0.107   1.214    0.225
## StatutEmploisans emploi          0.256      0.043   6.028    0.000
## Revenufaible                     0.071      0.072   0.983    0.326
## Revenumoyen                      0.038      0.065   0.588    0.557
## Revenusans reponse               0.204      0.103   1.983    0.047
## Revenutres eleve                -0.124      0.186  -0.669    0.504
## Revenutres faible                0.236      0.086   2.741    0.006
## Residencegrande ville            0.270      0.069   3.886    0.000
## Residencepetite-moyenne ville    0.276      0.062   4.477    0.000
## Residencezone rurale            -0.119      0.069  -1.720    0.085
## Duree2                          -0.019      0.019  -0.980    0.327
## ConsEnv                          0.102      0.009  10.967    0.000</code></pre>
<p>Les deux autres options envisageables sont : effectuer une analyse de type 3 ou calculer les intervalles de confiance par <em>bootstrap</em>. Cependant, elles requièrent beaucoup plus de temps de calcul. Par conséquent, elles ne sont pas présentées ici.</p>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="sect097" class="section level2">
<h2><span class="header-section-number">9.7</span> Quiz de révision du chapitre</h2>
<div id="quizz_classif" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_quizz_classif;
  window.onload = function() {
    quizz_quizz_classif = new Quiz('quizz_classif', ['1','4',['1', '2', '3', '4'],['1', '2', '3'],['1', '5'],'2',['2']]);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
GLMM est un acronyme signifiant :
</div>
<div>
Relisez au besoin la section @ref(sect0912)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>modèles Linéaires Généralisés à effets Mixtes</label>
</td>
<td>
<input type="radio" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>modèles Linéaires Gaussiens à effets Mixtes</label>
</td>
<td>
<input type="radio" name="q1" value="2"/>
</td>
</tr>
<tr>
<td>
<label>modèles Linéaire Généralisé Multinomial</label>
</td>
<td>
<input type="radio" name="q1" value="3"/>
</td>
</tr>
<tr>
<td>
<label>modèles Linéaire Généralisés Multiniveau</label>
</td>
<td>
<input type="radio" name="q1" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Les modèles GLMM comparativement aux GLM permettent de tenir compte de :
</div>
<div>
Relisez au besoin la section @ref(sect0911)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>la distribution spécifique de la variable Y</label>
</td>
<td>
<input type="radio" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>les distributions spécifiques des variables X</label>
</td>
<td>
<input type="radio" name="q2" value="2"/>
</td>
</tr>
<tr>
<td>
<label>l’hétéroscédasticité des résidus</label>
</td>
<td>
<input type="radio" name="q2" value="3"/>
</td>
</tr>
<tr>
<td>
<label>la non-indépendance des observations</label>
</td>
<td>
<input type="radio" name="q2" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un effet aléatoire se distingue d’un effet fixe car :
</div>
<div>
Relisez au besoin la section @ref(sect0912)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Un effet aléatoire n’est pas propre aux individus (unités d’observations), mais provient de facteurs externes</label>
</td>
<td>
<input type="checkbox" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Un effet aléatoire induit une forme de hiérarchie, de regroupement d’individus dans des groupes au seins desquels les observations ont plus tendances à se ressembler</label>
</td>
<td>
<input type="checkbox" name="q3" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Un effet aléatoire provient d’une autre population que les unités d’observations et peut donc être également échantillonné</label>
</td>
<td>
<input type="checkbox" name="q3" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Un effet aléatoire implique un partage de l’information dans son estimation comparativement à un effet fixe, la conséquence est notamment la réduction des tailles d’effet (shrinkage)</label>
</td>
<td>
<input type="checkbox" name="q3" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels sont les principaux types d’effets que l’on peut modéliser avec des effets aléatoires?
</div>
<div>
Relisez au besoin la section @ref(sect092)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Des constantes aléatoires, suggérant des écarts absolus entre les groupes</label>
</td>
<td>
<input type="checkbox" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Des pentes aléatoires, suggérant des écarts en termes d’effets pour certains prédicteurs en fonction des groupes</label>
</td>
<td>
<input type="checkbox" name="q4" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Des pentes et des constantes aléatoires</label>
</td>
<td>
<input type="checkbox" name="q4" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels indicateurs peuvent être utilisés pour analyser la part de la variance / déviance expliquée au différents niveaux d’un GLMM?
</div>
<div>
Relisez au besoin la section @ref(sect09223)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>L’ICC, soit le coefficient de corrélation intraclasse</label>
</td>
<td>
<input type="checkbox" name="q5" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Le BIC, soit le critère d’information Bayésien</label>
</td>
<td>
<input type="checkbox" name="q5" value="2"/>
</td>
</tr>
<tr>
<td>
<label>L’AIC</label>
</td>
<td>
<input type="checkbox" name="q5" value="3"/>
</td>
</tr>
<tr>
<td>
<label>La déviance expliquée</label>
</td>
<td>
<input type="checkbox" name="q5" value="4"/>
</td>
</tr>
<tr>
<td>
<label>Les R2 marginal et conditionnel</label>
</td>
<td>
<input type="checkbox" name="q5" value="5"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Toutes les variables catégorielles devraient être incluses dans un modèle comme des effets aléatoires.
</div>
<div>
Relisez au besoin la section @ref(sect0912)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q6" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q6" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Lors de l’estimation d’un effet aléatoire, le modèle estime exactement :
</div>
<div>
Relisez au besoin la section @ref(sect0921)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>k + 1 paramètres, soit le nombre de catégories plus un paramètre pour la variance de l’effet aléatoire en question</label>
</td>
<td>
<input type="checkbox" name="q7" value="1"/>
</td>
</tr>
<tr>
<td>
<label>un seul paramètre, la variance de la distribution normale associée à l’effet aléatoire en question</label>
</td>
<td>
<input type="checkbox" name="q7" value="2"/>
</td>
</tr>
<tr>
<td>
<label>k paramètre, soit le nombre de catégories pour l’effet aléatoire en question</label>
</td>
<td>
<input type="checkbox" name="q7" value="3"/>
</td>
</tr>
<tr>
<td>
<label>k-1 paramètre, soit le nombre de catégories moins un pour la catégorie de référence</label>
</td>
<td>
<input type="checkbox" name="q7" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<button type="button" onclick="showResults(quizz_quizz_classif);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:09-GLMM.Rmd-->
</div>
</div>
<div id="chap10" class="section level1">
<h1><span class="header-section-number">10</span> Régressions multiniveaux</h1>
<p>Dans le précédent chapitre, nous avons abordé les modèles à effets mixtes qui permettent d’introduire à la fois des effets fixes et aléatoires (GLMM). Dans ce chapitre, nous poursuivons sur cette voie avec une nouvelle extension des modèles GLM : les modèles multiniveaux. Ces modèles sont simplement une extension des modèles à effets mixtes et permettent de modéliser un phénomène avec une structure hiérarchique des données, tel que décrit dans le chapitre précédent.</p>
<div class="bloc_notes">
<p><strong>Rappel de la structure hiérarchique des données</strong></p>
<p><strong>Exemple à deux niveaux :</strong> il s’agit de modéliser un phénomène <span class="math inline">\(y_{ij}\)</span>, soit une variable dépendante <em>Y</em> pour un individu <em>i</em> (niveau 1) niché dans un groupe <em>j</em> (niveau 2). Par exemple, modéliser l’indice de masse corporelle (IMC) de 5000 individus résidant dans 100 quartiers différents.</p>
<p><strong>Exemple à trois niveaux :</strong> il s’agit de modéliser un phénomène <span class="math inline">\(y_{ijk}\)</span>, soit une variable dépendante <em>Y</em> pour un individu <em>i</em> (niveau 1), niché dans un groupe <em>j</em> (niveau 2) appartenant à un groupe <em>k</em> (niveau 3). Par exemple, modéliser les notes à un examen de mathématiques d’élèves (niveau 1) nichés dans des classes (niveau 2) nichées dans des écoles (niveau 3).</p>
</div>
<p>Nous avons largement décrit précédemment trois principaux types de modèles d’effets mixtes (GLMM) :</p>
<ul>
<li>Les GLMM avec constantes aléatoires qui permettent d’avoir une constante différente pour chacun des groupes (niveau 2).</li>
<li>Les GLMM avec pentes aléatoires qui permettent de faire varier une variable indépendante au niveau 1 (coefficient) en fonction des groupes au niveau 2.</li>
<li>Les GLMM avec constantes et pentes aléatoires.</li>
</ul>
<p>Les modèles multiniveaux se différencient des modèles à effets mixtes puisqu’ils permettent d’introduire des variables indépendantes mesurées aux niveaux supérieurs (2 et 3).</p>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons les <em>packages</em> suivants :</p>
<ul>
<li><code>lme4</code> pour en œuvre des modèles multiniveaux avec une variable dépendante continue.</li>
<li><code>performance</code> pour obtenir le coefficient intraclasse (ICC).</li>
<li><code>MuMIn</code> pour obtenir les pseudo R<sup>2</sup>.</li>
</ul>
</div>
<div id="sect101" class="section level2">
<h2><span class="header-section-number">10.1</span> Modèles multiniveaux : deux intérêts majeurs</h2>
<p>Les modèles multiniveaux ont deux principaux avantages : analyser la répartition de la variance entre les différents niveaux et introduire des variables explicatives aux différents niveaux du modèle.</p>
<div id="sect1011" class="section level3">
<h3><span class="header-section-number">10.1.1</span> Répartition de la variance entre les différents niveaux</h3>
<p>Les modèles multiniveaux permettent d’estimer comment se répartit la variance entre les différents niveaux du jeu de données. Dans les deux exemples de l’encadré précédent, ils permettraient de répondre aux questions suivantes :</p>
<ul>
<li>Quel niveau explique le plus l’IMC, le niveau individuel (niveau 1) ou le niveau contextuel (niveau 2)?</li>
<li>Comment se répartit la variance des notes à l’examen de mathématiques entre les trois niveaux? A-t-on plus de variance pour les individus (niveau 1) ou au sein des classes (niveau 2) ou entre les différentes écoles (niveau 3)?</li>
</ul>
</div>
<div id="sect1012" class="section level3">
<h3><span class="header-section-number">10.1.2</span> Estimation des coefficients aux différents niveaux</h3>
<p>Les modèles multiniveaux permettent d’estimer simultanément les coefficients de plusieurs variables indépendantes introduites à chacun des niveaux du modèle. Autrement dit, de voir comment les variables indépendantes introduites aux différents niveaux influencent la variable dépendante (<em>Y</em>) mesurée au niveau 1. Si nous reprenons l’exemple à trois niveaux (élèves/classes/écoles), plusieurs facteurs peuvent influencer la réussite ou la performance scolaire des élèves aux différents niveaux :</p>
<ul>
<li><strong>Variables indépendantes au niveau 1</strong> (élève) : âge, sexe, statut socioéconomique, langue maternelle autre que la langue d’enseignement…</li>
<li><strong>Variables indépendantes au niveau 2</strong> (classe) : nombre d’élèves par classe, programme spécialisé ou pas…</li>
<li><strong>Variables indépendantes au niveau 3</strong> (école) : indice de défavorisation de l’école, école publique ou privée, qualité des infrastructures de l’école (bâtiment, gymnase, cour d’école)…</li>
</ul>
<p>Dans la même veine, afin d’illustrer l’apport des modèles multiniveaux dans le champ de la géographie de la santé, Philibert et Apparicio <span class="citation">(<a href="#ref-philibert2007statistiques" role="doc-biblioref">2007</a>, 129)</span> signalent que « pour un modèle à deux niveaux, il s’agit de modéliser <span class="math inline">\(y_{ij}\)</span>, par exemple l’IMC d’un individu <em>i</em> (niveau 1) résidant dans un quartier <em>j</em> (niveau 2). Il est alors possible de mettre des variables explicatives tant au niveau 1 (âge, sexe, revenu, niveau d’éducation, etc.) qu’au niveau 2 (niveau de défavorisation sociale du quartier, offre de services et d’équipements sportifs et récréatifs, caractéristiques de l’environnement urbain, etc.). Dans cet exemple, nous pouvons voir comment la modélisation multiniveaux permet d’estimer simultanément les effets environnementaux et individuels de manière à distinguer la contribution de chacun des niveaux (ex. : l’effet du revenu des individus et celui de la défavorisation du quartier) dans l’explication des variations géographiques observées ».</p>
<div class="bloc_aller_loin">
<p><strong>Évaluer les effets de milieu avec des analyses multiniveaux</strong></p>
<p>En santé des populations et en études urbaines, les modèles multiniveaux sont largement mobilisés pour évaluer les effets de milieu (<em>neighbourhoods effects</em> ou <em>area effects</em> en anglais).</p>
<p>Atkinson et Kintrea <span class="citation">(<a href="#ref-atkinson2001disentangling" role="doc-biblioref">2001</a>, 2278)</span> définissent les « effets de milieu comme le changement net dans les potentialités de l’existence (<em>life chances</em>) attribuable au fait de vivre dans un quartier (ou une zone) plutôt qu’un autre » [traduction libre]. Les effets de milieu peuvent être positifs ou négatifs et concerner aussi bien les enfants que les adultes.</p>
<p>Les analyses multiniveaux sont particulièrement adaptées à l’évaluation des effets de milieu. En effet, plusieurs phénomènes — état de santé, comportement ou choix individuels — peuvent être influencés à la fois par des caractéristiques individuelles (âge, sexe, niveau de revenu, niveau d’éducation, etc.) et par des caractéristiques contextuelles (caractéristiques du quartier).</p>
<p>Avec un modèle multiniveau, une fois contrôlées les caractéristiques individuelles (variables indépendantes mesurées au niveau 1), il est alors possible d’évaluer l’effet des caractéristiques du quartier (variables indépendantes mesurées au niveau 2) sur un phénomène <span class="math inline">\(y_{ij}\)</span> mesuré pour un individu <em>i</em> résidant dans un quartier <em>j</em>.</p>
</div>
</div>
</div>
<div id="sect102" class="section level2">
<h2><span class="header-section-number">10.2</span> Différents types de modèles multiniveaux</h2>
<div id="sect1021" class="section level3">
<h3><span class="header-section-number">10.2.1</span> Description du jeu de données utilisé</h3>
<p>Dans le cadre de cette section, nous présentons uniquement les modèles à deux niveaux, soit celui pour modéliser un phénomène <span class="math inline">\(y_{ij}\)</span>. Pour ce faire, nous utilisons des données tirées d’une étude de Pham et al. <span class="citation">(<a href="#ref-apparicio2017disentangling" role="doc-biblioref">2017</a>)</span>. Dans cet article, les auteurs souhaitent évaluer les effets des caractéristiques de la forme urbaine et des caractéristiques socioéconomiques sur la couverture des arbres de rue, et ce, à partir d’un modèle multiniveau. Ils disposent ainsi d’une structure hiérarchique de données avec deux niveaux : les tronçons de rue (niveau 1, n = 10 814) inclus dans un et un seul secteur de recensement (niveau 2, n = 312). La variable dépendante (<span class="math inline">\(y_{ij}\)</span>) est le pourcentage de la superficie du tronçon de rue qui est couverte par des arbres, calculé à partir d’images satellites à haute résolution (Quickbird, 60 cm, septembre 2008). L’ensemble des variables utilisées pour les modèles sont reportées au tableau @ref(tab:titimulti).</p>
<p>Sept variables indépendantes relatives à la forme urbaine sont mesurées pour les tronçons de rue, soit la largeur et la longueur de la rue, l’âge médian des bâtiments (introduit également au carré pour vérifier l’existence d’un effet curvilinéaire; voir la section @ref(sect07511)), les pourcentages de bâtiments résidentiels, de duplex et de triplex, le nombre de bâtiments et finalement la distance moyenne entre le bâtiment et la rue. Les variables indépendantes pour les 312 secteurs de recensement (niveau 2) sont extraites du recensement canadien de 2006 (tableau @ref(tab:titimulti)).</p>
<table>
<caption>
(#tab:titimulti)Statistiques descriptives pour les variables des modèles multiniveaux
</caption>
<thead>
<tr>
<th style="text-align:left;">
Nom
</th>
<th style="text-align:left;">
Intitulé
</th>
<th style="text-align:center;">
Type
</th>
<th style="text-align:center;">
Niveau
</th>
<th style="text-align:right;">
Moy.
</th>
<th style="text-align:right;">
Écart type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
PCTArb
</td>
<td style="text-align:left;">
Arbres sur le tronçon de rue (%)
</td>
<td style="text-align:center;">
VD
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:right;">
7,2
</td>
<td style="text-align:right;">
10,7
</td>
</tr>
<tr>
<td style="text-align:left;">
Width
</td>
<td style="text-align:left;">
Largeur des rues
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:right;">
16,0
</td>
<td style="text-align:right;">
7,3
</td>
</tr>
<tr>
<td style="text-align:left;">
Length
</td>
<td style="text-align:left;">
Longueur de rues
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:right;">
136,0
</td>
<td style="text-align:right;">
87,8
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMed
</td>
<td style="text-align:left;">
Age médian des bâtiments
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:right;">
1 952,7
</td>
<td style="text-align:right;">
28,3
</td>
</tr>
<tr>
<td style="text-align:left;">
ResiPCT
</td>
<td style="text-align:left;">
Bâtiments résidentiels (%)
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:right;">
83,5
</td>
<td style="text-align:right;">
28,0
</td>
</tr>
<tr>
<td style="text-align:left;">
DuTriPct
</td>
<td style="text-align:left;">
Duplex ou triplex (%)
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:right;">
41,8
</td>
<td style="text-align:right;">
39,3
</td>
</tr>
<tr>
<td style="text-align:left;">
NoLog
</td>
<td style="text-align:left;">
Nombre de bâtiments
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:right;">
14,0
</td>
<td style="text-align:right;">
14,4
</td>
</tr>
<tr>
<td style="text-align:left;">
Setback
</td>
<td style="text-align:left;">
Distance entre le bâtiment et la rue
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:right;">
7,2
</td>
<td style="text-align:right;">
4,3
</td>
</tr>
<tr>
<td style="text-align:left;">
ValLog
</td>
<td style="text-align:left;">
Valeur moyenne des logements (milliers de dollars)
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:right;">
267,6
</td>
<td style="text-align:right;">
80,0
</td>
</tr>
<tr>
<td style="text-align:left;">
UDipPCT
</td>
<td style="text-align:left;">
Diplômés universitaires (%)
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:right;">
16,9
</td>
<td style="text-align:right;">
9,6
</td>
</tr>
<tr>
<td style="text-align:left;">
PCTFRAVI
</td>
<td style="text-align:left;">
Personnes à faible revenu (%)
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:right;">
30,3
</td>
<td style="text-align:right;">
11,5
</td>
</tr>
<tr>
<td style="text-align:left;">
PCTIMGRE
</td>
<td style="text-align:left;">
Immigrants récents (%)
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:right;">
10,0
</td>
<td style="text-align:right;">
7,3
</td>
</tr>
<tr>
<td style="text-align:left;">
AvecEnf
</td>
<td style="text-align:left;">
Ménages avec enfants (%)
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:right;">
34,8
</td>
<td style="text-align:right;">
12,6
</td>
</tr>
<tr>
<td style="text-align:left;">
FranPCT
</td>
<td style="text-align:left;">
Langue maternelle française (%)
</td>
<td style="text-align:center;">
VI
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:right;">
66,9
</td>
<td style="text-align:right;">
24,1
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect1022" class="section level3">
<h3><span class="header-section-number">10.2.2</span> Démarche classique pour les modèles multiniveaux</h3>
<p>La démarche habituelle en analyse multiniveau est de réaliser plusieurs modèles, allant du plus simple au plus complexe. Cette stratégie permet habituellement de bien cerner la répartition de la variance entre les différents niveaux et l’apport des variables explicatives introduites aux différents niveaux. De la sorte, cinq types de modèles peuvent être construits :</p>
<ol style="list-style-type: decimal">
<li>Le modèle vide (appelé aussi modèle inconditionnel) qui comprend des constantes aléatoires au niveau 2, mais aucune variable explicative.</li>
<li>Le modèle avec uniquement les variables indépendantes au niveau 1 et des constantes aléatoires au niveau 2.</li>
<li>Le modèle complet avec les variables indépendantes aux deux niveaux et des constantes aléatoires.</li>
<li>Le modèle complet avec les variables indépendantes aux deux niveaux, incluant une interaction entre une variable indépendante mesurée au niveau 1 et une autre mesurée au niveau 2.</li>
<li>Le modèle avec les variables indépendantes aux deux niveaux et des constantes et pentes aléatoires.</li>
</ol>
<p>Dans les sous-sections suivantes, nous détaillons chacun de ces cinq modèles en prenant soin de montrer les similitudes qu’ils partagent avec les modèles à effets mixtes vus précédemment. Notez d’emblée que les trois premiers modèles sont les plus fréquemment utilisés.</p>
<div id="sect10221" class="section level4">
<h4><span class="header-section-number">10.2.2.1</span> Modèle vide</h4>
<p>Comme son nom l’indique, le modèle vide ne comprend aucune variable explicative. Il consiste simplement à faire varier la constante du niveau 1 avec des effets aléatoires au niveau 2, ce qui explique qu’il est souvent comparé à une ANOVA avec des effets aléatoires. En d’autres termes, ce modèle correspond à un GLMM avec constantes aléatoires dans lequel aucune variable indépendante n’est incluse au niveau 1. D’ailleurs, si vous comparez l’équation @ref(eq:multiniveauModeleVide) avec l’équation @ref(eq:glmm2) au chapitre précédent, vous constaterez que seul le paramètre <span class="math inline">\(\beta_1 x_1\)</span> a été ôté et qu’il comprend aussi deux variances : l’une fixe au niveau 1 (<span class="math inline">\(\sigma_e\)</span>) et l’autre aléatoire (stochastique) au niveau 2 (<span class="math inline">\(\sigma_{\upsilon}\)</span>).</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma_e)\\
&amp;g(\mu) = \beta_0 + \upsilon \\
&amp;\upsilon \sim Normal(0, \sigma_{\upsilon}) \\
&amp;g(x) = x
\end{aligned}
(\#eq:multiniveauModeleVide)
\end{equation}\]</span>
</p>
<p><strong>Quel est alors l’intérêt de réaliser un modèle si simple?</strong> À partir des deux variances, il est possible de calculer le <strong>coefficient de corrélation intraclasse</strong> (<em>intraclass-correlation</em> (ICC) en anglais) qui est le rapport entre la variance aléatoire et la somme des variances des deux niveaux, soit fixe et aléatoire (équation @ref(eq:multiniveauIcc)). Ce coefficient varie ainsi de 0 à 1 et indique la proportion de la variance de la variable dépendante qui est imputable au niveau 2. Tous(tes) les auteur(e)s s’entendent sur le fait qu’il est impératif de commencer une analyse de multiniveau en calculant ce modèle vide qui nous informe de la répartition de la variance entre les deux niveaux <span class="citation">(Raudenbush et Bryk <a href="#ref-raudenbush2002hierarchical" role="doc-biblioref">2002</a>; Gelman et Hill <a href="#ref-gelman2006data" role="doc-biblioref">2006</a>; Tabachnick, Fidell et Ullman <a href="#ref-tabachnick2007" role="doc-biblioref">2007</a>; Bressoux <a href="#ref-bressoux2010" role="doc-biblioref">2010</a>)</span>. Nous pourrons ensuite analyser l’évolution de ce coefficient dans les modèles subséquents.</p>

<p><span class="math display">\[\begin{equation}
\rho = \frac{\sigma_{\upsilon}}{\sigma_{\upsilon} + \sigma_{e}}
(\#eq:multiniveauIcc)
\end{equation}\]</span>
</p>
<p>Les résultats du modèle vide (inconditionnel) à partir des données de Pham et al. <span class="citation">(<a href="#ref-apparicio2017disentangling" role="doc-biblioref">2017</a>)</span> sont présentés au tableau @ref(tab:TableauModeleVide). La variance du niveau 1 est de 92,93 contre 19,82 au niveau 2. Le coefficient de corrélation intraclasse vaut alors : <span class="math inline">\(\mbox{19,82} / \mbox{(19,82} + \mbox{92,93}) = \mbox{0,1758}\)</span>. Cela signifie que 18 % de la variance de la variable dépendante sont imputables au niveau 2 (des secteurs de recensement) et 82 % au niveau 1 (des tronçons). Nous verrons comment évolue ce coefficient dans les modèles subséquents.</p>
<table>
<caption>
(#tab:TableauModeleVide)Résultats du modèle vide (modèle 1)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Paramètre
</th>
<th style="text-align:right;">
Coefficient
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Effets fixes (niveau 1)
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
7,337
</td>
<td style="text-align:right;">
0,277
</td>
<td style="text-align:right;">
314,918
</td>
</tr>
<tr>
<td style="text-align:left;">
Répartition de la variance
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (niveau 1)
</td>
<td style="text-align:right;">
19,818
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (niveau 2)
</td>
<td style="text-align:right;">
92,925
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Coefficient de corrélation intraclasse
</td>
<td style="text-align:right;">
0,176
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Qualité d’ajustement du modèle
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:right;">
80 305,219
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
R<sup>2</sup> marginal
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
R<sup>2</sup> conditionnel
</td>
<td style="text-align:right;">
0,176
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect10222" class="section level4">
<h4><span class="header-section-number">10.2.2.2</span> Modèle avec les variables indépendantes du niveau 1</h4>
<p>Dans ce second modèle, nous introduisons uniquement les variables explicatives au niveau 1. Par conséquent, ce modèle est tout simplement un modèle à effets mixtes (GLMM) avec des constantes aléatoires largement décrit à la section @ref(sect0921)). Si vous comparez l’équation du modèle vide (équation @ref(eq:multiniveauIcc)) avec l’équation de ce modèle (équation @ref(eq:multiniveauModele2)), vous constaterez que le paramètre <span class="math inline">\(\beta_1 x_1\)</span> a été ajouté. Il correspond au coefficient pour la variable indépendante <span class="math inline">\(X_1\)</span> mesurée au niveau 1 (effet fixe). Nous pourrions alors ajouter d’autres paramètres pour les autres variables indépendantes du modèle, soit <span class="math inline">\(\beta_1 x_1 + \beta_2 x_2+ \ldots + \beta_k x_k\)</span> (<span class="math inline">\(k\)</span> étant le nombre de variables explicatives mesurées au niveau 1, effets fixes).</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma_e)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \upsilon \\
&amp;\upsilon \sim Normal(0, \sigma_{\upsilon})) \\
&amp;g(x) = x
\end{aligned}
(\#eq:multiniveauModele2)
\end{equation}\]</span>
</p>
<p>Les résultats du second modèle sont présentés au tableau @ref(tab:TableauModele2).</p>
<p><strong>La répartition de la variance entre les deux niveaux</strong>. La variance du niveau 1 est désormais de 15,263 contre 80,317 au niveau 2, ce qui permet d’obtenir un coefficient de corrélation intraclasse de 0,1597. Cela signifie que de 16 % de la variance de la variable dépendante sont imputables au niveau 2 (des secteurs de recensement), une fois contrôlées les caractéristiques des tronçons.</p>
<p><strong>La qualité d’ajustement du modèle</strong>. Dans le chapitre précédent sur les GLMM, nous avons largement décrit plusieurs mesures de la qualité d’ajustement du modèle, notamment l’AIC et les R<sup>2</sup> marginal et conditionnel. À titre de rappel, voici comment interpréter ces mesures :</p>
<ul>
<li><p>Plus la valeur de l’AIC est faible, mieux le modèle est ajusté. En comparant les valeurs d’AIC du modèle vide et du modèle avec les variables explicatives du niveau 1 (80 305 <em>versus</em> 78 785), nous constatons, sans surprise, que ce dernier modèle est plus performant.</p></li>
<li><p>Le R<sup>2</sup> marginal indique la proportion de la variance expliquée uniquement si les effets fixes sont pris en compte (ici, 0,129). Quant au R<sup>2</sup> conditionnel, il indique la proportion de la variance expliquée à la fois par les effets fixes et aléatoires (ici, 0,268). L’écart important entre les deux R<sup>2</sup> signale que les secteurs de recensement (effets aléatoires, niveau 2) jouent un rôle important dans le modèle.</p></li>
</ul>
<p><strong>Quelles informations peut-on tirer des coefficients de régression?</strong>
Les variables indépendantes relatives à la forme urbaine les plus importantes sont : le pourcentage de bâtiments résidentiels (<code>ResiPCT</code>), la largeur de la rue (<code>Width</code>) et le nombre de bâtiments (<code>NoLog</code>). Aussi, la distance entre le bâtiment et la rue (<code>Setback</code>) est associée positivement avec la variable dépendante. En effet, à chaque ajout d’un mètre de la distance moyenne entre les bâtiments et le tronçon de rue, la couverture des arbres sur le tronçon augmente de 0,202 point de pourcentage, toutes choses étant égales par ailleurs.</p>
<table>
<caption>
(#tab:TableauModele2)Résultats du modèle avec les variables indépendantes au niveau 1 (modèle 2)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Paramètre
</th>
<th style="text-align:right;">
Coefficient
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Effets fixes (niveau 1)
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
-1 028,618
</td>
<td style="text-align:right;">
179,736
</td>
<td style="text-align:right;">
10 799,64
</td>
</tr>
<tr>
<td style="text-align:left;">
Width
</td>
<td style="text-align:right;">
-0,129
</td>
<td style="text-align:right;">
0,013
</td>
<td style="text-align:right;">
10 754,96
</td>
</tr>
<tr>
<td style="text-align:left;">
Length
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
10 733,36
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMed
</td>
<td style="text-align:right;">
1,103
</td>
<td style="text-align:right;">
0,186
</td>
<td style="text-align:right;">
10 799,74
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMed2
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
10 799,55
</td>
</tr>
<tr>
<td style="text-align:left;">
ResiPCT
</td>
<td style="text-align:right;">
0,047
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
10 804,92
</td>
</tr>
<tr>
<td style="text-align:left;">
DuTriPct
</td>
<td style="text-align:right;">
-0,013
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
10 703,70
</td>
</tr>
<tr>
<td style="text-align:left;">
NoLog
</td>
<td style="text-align:right;">
0,147
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
10 797,85
</td>
</tr>
<tr>
<td style="text-align:left;">
Setback
</td>
<td style="text-align:right;">
0,202
</td>
<td style="text-align:right;">
0,023
</td>
<td style="text-align:right;">
10 797,86
</td>
</tr>
<tr>
<td style="text-align:left;">
Répartition de la variance
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (niveau 1)
</td>
<td style="text-align:right;">
15,263
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (niveau 2)
</td>
<td style="text-align:right;">
80,317
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Coefficient de corrélation intraclasse
</td>
<td style="text-align:right;">
0,160
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Qualité d’ajustement du modèle
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:right;">
78 785,827
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
R<sup>2</sup> marginal
</td>
<td style="text-align:right;">
0,129
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
R<sup>2</sup> conditionnel
</td>
<td style="text-align:right;">
0,268
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
<p>Remarquez la valeur de la constante : −1028,618. À titre de rappel, la constante est la valeur que prend la variable dépendante quand toutes les variables indépendantes sont égales à 0. Or, il est impossible qu’elles soient toutes égales à zéro.</p>
<div class="bloc_astuce">
<p><strong>Centrage des variables quantitatives mesurées au niveau 1</strong></p>
<p>En analyse multiniveau, il est très courant et souvent recommandé de centrer les variables explicatives quantitatives au niveau 1. Deux options sont alors possibles :</p>
<ol style="list-style-type: decimal">
<li>Pour une variable indépendante donnée, les observations sont centrées sur leur moyenne générale, c’est-à-dire la moyenne de l’ensemble des observations du jeu de données, soit <span class="math inline">\(X_{ij} - \bar{X}\)</span>. Dans ce cas, la constante est donc la valeur que prend la variable <span class="math inline">\(Y\)</span> quand toutes les variables indépendantes sont égales à leur moyenne respective.</li>
<li>Chaque observation est centrée sur la moyenne de son groupe respectif, soit <span class="math inline">\(X_{ij} - \bar{X}_{.j}\)</span>.</li>
</ol>
<p>Tel que signalé par Bressoux <span class="citation">(<a href="#ref-bressoux2010" role="doc-biblioref">2010</a>, 328)</span>, « dans le premier cas, la variance des pentes sera estimée pour l’individu moyen dans la distribution générale, tandis que dans le second elle est estimée pour l’individu moyen de chaque groupe ».</p>
<p>Autrement dit, comparativement à un modèle sans centrage, les valeurs des coefficients pour les variables indépendantes sont les mêmes dans le premier cas (seule la valeur de la constante va changer) tandis qu’elles sont différentes dans le second cas.</p>
<p>Attention, il ne faut pas appliquer de centrage sur une variable qualitative, qu’elle soit dichotomique, nominale ou ordinale.</p>
<p><strong>Pourquoi la pratique du centrage en analyse multiniveau est si courante?</strong></p>
<p>Dans la plupart des livres sur les régressions multiniveaux, le centrage est recommandé, notamment dans l’ouvrage classique de Raudenbush et Bryk <span class="citation">(<a href="#ref-raudenbush2002hierarchical" role="doc-biblioref">2002</a>)</span>. Rappelons que ces modèles sont largement utilisés en éducation avec une structure hiérarchique classique élève/école/classe. Nous nous intéressons alors à l’individu moyen (l’élève), ce qui explique que le centrage est habituellement appliqué. Par exemple, ne pas centrer l’âge des élèves fait que la constante qui est obtenue est peu interprétable : difficile d’évaluer la note moyenne à un examen quand la variable <em>âge de l’élève</em> a la valeur de 0, tout comme les autres variables explicatives quantitatives relatives à l’élève.</p>
<p><strong>Centrage et réduction de l’ensemble des variables du modèle</strong></p>
<p>Il est à noter que certains auteurs centrent et réduisent l’ensemble des variables du modèle. À titre de rappel, le centrage consiste à soustraire à chaque valeur la moyenne de la variable; la réduction, à la diviser par l’écart-type de la variable (section @ref(sect02552)). Pour chaque variable, la moyenne est alors égale à 0 et l’écart-type à 1. Les coefficients s’interprètent alors en termes d’augmentation d’une unité d’écart-type tant pour la VI que la VD. Ils correspondent alors à des coefficients de régression standardisés (abordés dans la section @ref(sect0742)). Ce processus de centrage et de réduction des variables peut être motivé par des problèmes de convergence du modèle (lorsque l’algorithme d’optimisation n’arrive pas à trouver une solution pour produire les coefficients).</p>
</div>
<p>Par conséquent, nous vous proposons de centrer les variables du niveau 1 de notre jeu de données. Si vous comparez les tableaux @ref(tab:TableauModele2) et @ref(tab:TableauModele2b), vous constaterez que les valeurs relatives aux coefficients, aux mesures de la répartition de la variance et à la qualité d’ajustement du modèle sont les mêmes. Seule la valeur de la constante change : elle passe de −1028,618 à 7,228. Elle s’interprète désormais de la façon suivante : si toutes les variables explicatives sont égales à leurs moyennes respectives, alors le pourcentage de la superficie du tronçon couverte par des arbres est égal à 7,228 %.</p>
<table>
<caption>
(#tab:TableauModele2b)Résultats du modèle avec les variables indépendantes centrées au niveau 1 (modèle 2)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Paramètre
</th>
<th style="text-align:right;">
Coefficient
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Effets fixes (niveau 1)
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
7,228
</td>
<td style="text-align:right;">
0,248
</td>
<td style="text-align:right;">
318,313
</td>
</tr>
<tr>
<td style="text-align:left;">
Width.c
</td>
<td style="text-align:right;">
-0,129
</td>
<td style="text-align:right;">
0,013
</td>
<td style="text-align:right;">
10 754,961
</td>
</tr>
<tr>
<td style="text-align:left;">
Length.c
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
10 733,361
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMed.c
</td>
<td style="text-align:right;">
1,103
</td>
<td style="text-align:right;">
0,186
</td>
<td style="text-align:right;">
10 801,399
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMed2.c
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
10 801,243
</td>
</tr>
<tr>
<td style="text-align:left;">
ResiPCT.c
</td>
<td style="text-align:right;">
0,047
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
10 804,923
</td>
</tr>
<tr>
<td style="text-align:left;">
DuTriPct.c
</td>
<td style="text-align:right;">
-0,013
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
10 703,746
</td>
</tr>
<tr>
<td style="text-align:left;">
NoLog.c
</td>
<td style="text-align:right;">
0,147
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
10 797,848
</td>
</tr>
<tr>
<td style="text-align:left;">
Setback.c
</td>
<td style="text-align:right;">
0,202
</td>
<td style="text-align:right;">
0,023
</td>
<td style="text-align:right;">
10 797,856
</td>
</tr>
<tr>
<td style="text-align:left;">
Répartition de la variance
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (niveau 1)
</td>
<td style="text-align:right;">
15,263
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (niveau 2)
</td>
<td style="text-align:right;">
80,317
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Coefficient de corrélation intraclasse
</td>
<td style="text-align:right;">
0,160
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Qualité d’ajustement du modèle
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:right;">
78 785,827
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
R<sup>2</sup> marginal
</td>
<td style="text-align:right;">
0,129
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
R<sup>2</sup> conditionnel
</td>
<td style="text-align:right;">
0,268
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect10223" class="section level4">
<h4><span class="header-section-number">10.2.2.3</span> Modèle complet avec les variables indépendantes aux niveaux 1 et 2</h4>
<p>Le troisième type de modèle consiste à introduire à la fois les variables explicatives mesurées au niveau 1 et au niveau 2 (équation @ref(eq:multiniveauModele3)). Il est communément appelé le modèle complet. Les variables explicatives du niveau 2 sont aussi considérées comme des effets fixes.</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma_e)\\
&amp;g(\mu)  = \underbrace{\beta_0 + \beta_1 x_1}_{\mbox{effets fixes (niveau 1)}}+ \underbrace{\beta_2 z_2}_{\mbox{effets fixes (niveau 2)}}+\epsilon \\
&amp;\upsilon \sim Normal(0, \sigma_{\upsilon}) \\
&amp;g(x) = x
\end{aligned}
(\#eq:multiniveauModele3)
\end{equation}\]</span>
</p>
<p>Les résultats du troisième modèle sont présentés au tableau @ref(tab:TableauModele3). Ce modèle permet d’évaluer les effets des caractéristiques socioéconomiques (mesurés au niveau des secteurs de recensement) sur la couverture des arbres des îlots, une fois contrôlées les caractéristiques de la forme urbaine des tronçons. Rappelons, que dans ce modèle, les constantes sont aléatoires et les variables indépendantes au niveau 1 sont centrées.</p>
<p><strong>Quelles informations peut-on tirer des coefficients de régression du niveau 2?</strong>
D’emblée, deux caractéristiques n’ont pas d’effet significatif sur la variable dépendante, soit les pourcentages de diplômés universitaires et de ménages avec enfants. Par contre, toutes choses étant égales par ailleurs, la valeur moyenne des logements et le pourcentage d’immigrants récents sont associés à une augmentation de la couverture végétale. À l’inverse, le pourcentage de personnes à faible revenu est associé à une diminution de la couverture végétale.</p>
<table>
<caption>
(#tab:TableauModele3)Résultats du modèle avec les variables indépendantes aux niveaux 1 et 2 (modèle 3)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Paramètre
</th>
<th style="text-align:right;">
Coefficient
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Effets fixes (niveau 1 : tronçons)
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
-0,518
</td>
<td style="text-align:right;">
3,227
</td>
<td style="text-align:right;">
313,586
</td>
</tr>
<tr>
<td style="text-align:left;">
Width.c
</td>
<td style="text-align:right;">
-0,132
</td>
<td style="text-align:right;">
0,013
</td>
<td style="text-align:right;">
10 762,184
</td>
</tr>
<tr>
<td style="text-align:left;">
Length.c
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
10 728,713
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMed.c
</td>
<td style="text-align:right;">
1,097
</td>
<td style="text-align:right;">
0,185
</td>
<td style="text-align:right;">
10 783,965
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMed2.c
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
10 782,352
</td>
</tr>
<tr>
<td style="text-align:left;">
ResiPCT.c
</td>
<td style="text-align:right;">
0,046
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
10 778,050
</td>
</tr>
<tr>
<td style="text-align:left;">
DuTriPct.c
</td>
<td style="text-align:right;">
-0,013
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
10 608,724
</td>
</tr>
<tr>
<td style="text-align:left;">
NoLog.c
</td>
<td style="text-align:right;">
0,148
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
10 793,143
</td>
</tr>
<tr>
<td style="text-align:left;">
Setback.c
</td>
<td style="text-align:right;">
0,194
</td>
<td style="text-align:right;">
0,023
</td>
<td style="text-align:right;">
10 793,303
</td>
</tr>
<tr>
<td style="text-align:left;">
Effets fixes (niveau 2 : secteurs de recensement)
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ValLog
</td>
<td style="text-align:right;">
0,016
</td>
<td style="text-align:right;">
0,004
</td>
<td style="text-align:right;">
312,695
</td>
</tr>
<tr>
<td style="text-align:left;">
UDipPCT
</td>
<td style="text-align:right;">
0,014
</td>
<td style="text-align:right;">
0,035
</td>
<td style="text-align:right;">
329,191
</td>
</tr>
<tr>
<td style="text-align:left;">
PCTFRAVI
</td>
<td style="text-align:right;">
-0,088
</td>
<td style="text-align:right;">
0,030
</td>
<td style="text-align:right;">
328,151
</td>
</tr>
<tr>
<td style="text-align:left;">
PCTIMGRE
</td>
<td style="text-align:right;">
0,237
</td>
<td style="text-align:right;">
0,049
</td>
<td style="text-align:right;">
321,723
</td>
</tr>
<tr>
<td style="text-align:left;">
AvecEnf
</td>
<td style="text-align:right;">
0,001
</td>
<td style="text-align:right;">
0,032
</td>
<td style="text-align:right;">
314,079
</td>
</tr>
<tr>
<td style="text-align:left;">
FranPCT
</td>
<td style="text-align:right;">
0,052
</td>
<td style="text-align:right;">
0,016
</td>
<td style="text-align:right;">
316,295
</td>
</tr>
<tr>
<td style="text-align:left;">
Répartition de la variance
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (niveau 1)
</td>
<td style="text-align:right;">
12,121
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (niveau 2)
</td>
<td style="text-align:right;">
80,347
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Coefficient de corrélation intraclasse
</td>
<td style="text-align:right;">
0,131
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Qualité d’ajustement du modèle
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:right;">
78 776,845
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
R<sup>2</sup> marginal
</td>
<td style="text-align:right;">
0,160
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
R<sup>2</sup> conditionnel
</td>
<td style="text-align:right;">
0,270
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect10224" class="section level4">
<h4><span class="header-section-number">10.2.2.4</span> Modèle avec une interaction entre deux niveaux</h4>
<p>Dans la section @ref(sect0754), nous avons vu comment introduire des variables d’interaction dans une régression linéaire multiple, soit entre deux variables continues (section @ref(sect07541)), soit entre une variable continue et une variable dichotomique (section @ref(sect07542)), soit entre deux variables dichotomiques (section @ref(sect07543)). En analyse multiniveau, il peut être pertinent d’introduire une interaction entre une variable mesurée au niveau 1 et une autre mesurée au niveau 2 (équation @ref(eq:multiniveauModele4)).</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma_e)\\
&amp;g(\mu)  = \underbrace{\beta_0 + \beta_1 x_1}_{\mbox{effets fixes (niv. 1)}}+ \underbrace{\beta_2 z_2}_{\mbox{effets fixes (niv. 2)}}+ \underbrace{\beta_3 (x_1 \times z_2)}_{\mbox{interaction (niv. 1 et 2)}}+ \epsilon \\
&amp;\upsilon \sim Normal(0, \sigma_{\upsilon})) \\
&amp;g(x) = x
\end{aligned}
(\#eq:multiniveauModele4)
\end{equation}\]</span>
</p>
<p>Dans le tableau @ref(tab:TableauModele4), nous introduisons une variable d’interaction entre la <em>distance entre le bâtiment et la rue</em> (<code>Setback.c</code>) et le <em>pourcentage de personnes à faible revenu</em> (<code>PCTFRAVI</code>). On constate alors que <code>PCTFRAVI</code> est associé négativement avec la variable dépendante (<span class="math inline">\(\beta =\)</span> −0,079, <em>t</em> = −2,684). Toutefois, lorsqu’elle est mise en interaction avec la variable <code>Setback.c</code>, cette variable est significative et positive (<span class="math inline">\(\beta =\)</span> 0,008, <em>t</em> = 4,591).</p>
<table>
<caption>
(#tab:TableauModele4)Résultats du modèle avec une variable d’interaction entre les deux niveaux 1 et 2 (modèle 4)
</caption>
<thead>
<tr>
<th style="text-align:left;">
Paramètre
</th>
<th style="text-align:right;">
Coefficient
</th>
<th style="text-align:right;">
Erreur type
</th>
<th style="text-align:right;">
Valeur de T
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Effets fixes (niveau 1 : tronçons)
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Constante
</td>
<td style="text-align:right;">
-0,009
</td>
<td style="text-align:right;">
3,198
</td>
<td style="text-align:right;">
313,170
</td>
</tr>
<tr>
<td style="text-align:left;">
Width.c
</td>
<td style="text-align:right;">
-0,136
</td>
<td style="text-align:right;">
0,013
</td>
<td style="text-align:right;">
10 763,142
</td>
</tr>
<tr>
<td style="text-align:left;">
Length.c
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
10 730,154
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMed.c
</td>
<td style="text-align:right;">
1,092
</td>
<td style="text-align:right;">
0,185
</td>
<td style="text-align:right;">
10 781,041
</td>
</tr>
<tr>
<td style="text-align:left;">
AgeMed2.c
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
0,000
</td>
<td style="text-align:right;">
10 779,196
</td>
</tr>
<tr>
<td style="text-align:left;">
ResiPCT.c
</td>
<td style="text-align:right;">
0,046
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
10 778,148
</td>
</tr>
<tr>
<td style="text-align:left;">
DuTriPct.c
</td>
<td style="text-align:right;">
-0,013
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
10 592,140
</td>
</tr>
<tr>
<td style="text-align:left;">
NoLog.c
</td>
<td style="text-align:right;">
0,145
</td>
<td style="text-align:right;">
0,011
</td>
<td style="text-align:right;">
10 793,158
</td>
</tr>
<tr>
<td style="text-align:left;">
Setback.c
</td>
<td style="text-align:right;">
0,003
</td>
<td style="text-align:right;">
0,048
</td>
<td style="text-align:right;">
10 757,245
</td>
</tr>
<tr>
<td style="text-align:left;">
Effets fixes (niveau 2 : secteurs de recensement)
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ValLog
</td>
<td style="text-align:right;">
0,016
</td>
<td style="text-align:right;">
0,004
</td>
<td style="text-align:right;">
311,944
</td>
</tr>
<tr>
<td style="text-align:left;">
UDipPCT
</td>
<td style="text-align:right;">
0,009
</td>
<td style="text-align:right;">
0,035
</td>
<td style="text-align:right;">
328,840
</td>
</tr>
<tr>
<td style="text-align:left;">
PCTFRAVI
</td>
<td style="text-align:right;">
-0,079
</td>
<td style="text-align:right;">
0,029
</td>
<td style="text-align:right;">
332,194
</td>
</tr>
<tr>
<td style="text-align:left;">
PCTIMGRE
</td>
<td style="text-align:right;">
0,219
</td>
<td style="text-align:right;">
0,048
</td>
<td style="text-align:right;">
326,135
</td>
</tr>
<tr>
<td style="text-align:left;">
AvecEnf
</td>
<td style="text-align:right;">
-0,007
</td>
<td style="text-align:right;">
0,032
</td>
<td style="text-align:right;">
313,551
</td>
</tr>
<tr>
<td style="text-align:left;">
FranPCT
</td>
<td style="text-align:right;">
0,050
</td>
<td style="text-align:right;">
0,016
</td>
<td style="text-align:right;">
316,142
</td>
</tr>
<tr>
<td style="text-align:left;">
Variable d’interaction (niv. 1 et 2)
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Setback X PCTFRAVI
</td>
<td style="text-align:right;">
0,008
</td>
<td style="text-align:right;">
0,002
</td>
<td style="text-align:right;">
10 470,185
</td>
</tr>
<tr>
<td style="text-align:left;">
Répartition de la variance
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (niveau 1)
</td>
<td style="text-align:right;">
11,829
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Variance (niveau 2)
</td>
<td style="text-align:right;">
80,239
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Coefficient de corrélation intraclasse
</td>
<td style="text-align:right;">
0,128
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Qualité d’ajustement du modèle
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:right;">
78 768,659
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
R<sup>2</sup> marginal
</td>
<td style="text-align:right;">
0,163
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
R<sup>2</sup> conditionnel
</td>
<td style="text-align:right;">
0,270
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="sect103" class="section level2">
<h2><span class="header-section-number">10.3</span> Conditions d’application des régressions multiniveaux</h2>
<p>Puisque les modèles multiniveaux sont une extension des modèles à effets mixtes (GLMM), nous retrouvons globalement les mêmes conditions d’application (voir la section @ref(sect093)), dont les principales sont :</p>
<ol style="list-style-type: decimal">
<li>l’absence de multicolinéarité excessive,</li>
<li>la normalité des résidus,</li>
<li>l’absence d’observations trop influentes dans le modèle.</li>
</ol>
<p><strong>Combien de groupes au niveau 2?</strong> Dans la section @ref(sect093), nous avons vu que dans un modèle GLMM, plusieurs auteur(e)s, notamment Gelman et Hill
<span class="citation">(<a href="#ref-gelman2006data" role="doc-biblioref">2006</a>)</span>, préconisent un minimum de cinq groupes dans un modèle à effets mixtes. Toutefois, dans un modèle complet d’une régression multiniveau, nous introduisons aussi des variables indépendantes au niveau 2. Par conséquent, le nombre de groupes doit être augmenté significativement, et ce, idéalement proportionnellement au nombre des variables indépendantes ajoutées au niveau 2. En ce sens, Bressoux <span class="citation">(<a href="#ref-bressoux2010" role="doc-biblioref">2010</a>, 325)</span> conseille d’avoir au moins 10 groupes pour chaque variable indépendante mesurée au niveau 2. Toujours selon Bressoux <span class="citation">(<a href="#ref-bressoux2010" role="doc-biblioref">2010</a>, 325)</span>, certains auteurs recommandent même 20 groupes par variable indépendante au niveau 2. En conséquence, bien qu’aucune règle de pouce soit clairement admise, il est clair qu’un modèle complet multiniveau nécessite un nombre de groupes conséquent.</p>
</div>
<div id="sect104" class="section level2">
<h2><span class="header-section-number">10.4</span> Mise en œuvre dans R</h2>
<p>Pour mettre en œuvre des modèles multiniveaux avec une variable dépendante continue, nous utilisons la fonction <code>lmer</code> du <em>package</em> <code>lme4</code>. Pour d’autres distributions, nous pouvons utiliser la fonction <code>glmer</code> implémentant différentes familles de modèles GLM, notamment binomiale (modèle multiniveau logistique), gaussien, gamma, inverse gaussien, poisson, quasi-poisson, etc. Comme pour les modèles GLMM, lorsque d’autres distributions sont nécessaires, il est possible d’utiliser le <em>package</em> <code>gamlss</code>.</p>
<div id="sect1041" class="section level3">
<h3><span class="header-section-number">10.4.1</span> Le modèle vide</h3>
<p>Dans le code R ci-dessous, la syntaxe <code>lmer(PCTArb ~ 1 + (1| SRNOM),  data = Multiniveau)</code> permet de construire le modèle vide avec la variable indépendante <code>PCTArb</code> et <code>SRNOM</code> comme variable définissant les groupes au niveau 2, soit les 312 secteurs de recensement. À titre de rappel, le modèle vide ne comprend aucune variable indépendante.</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="#cb999-1"></a><span class="kw">library</span>(<span class="st">&quot;lme4&quot;</span>)</span>
<span id="cb999-2"><a href="#cb999-2"></a><span class="kw">library</span>(<span class="st">&quot;MuMIn&quot;</span>)</span>
<span id="cb999-3"><a href="#cb999-3"></a><span class="co"># chargement du jeu de données</span></span>
<span id="cb999-4"><a href="#cb999-4"></a><span class="kw">load</span>(<span class="st">&quot;data/multiniveau/dataArbres.RData&quot;</span>)</span>
<span id="cb999-5"><a href="#cb999-5"></a></span>
<span id="cb999-6"><a href="#cb999-6"></a><span class="co"># MODÈLE 1 : modèle vide (sans prédicteurs)</span></span>
<span id="cb999-7"><a href="#cb999-7"></a><span class="co">#------------------------------------------------------</span></span>
<span id="cb999-8"><a href="#cb999-8"></a><span class="co"># Écrire Y ~ 1 signifie que le modèle est vide</span></span>
<span id="cb999-9"><a href="#cb999-9"></a><span class="co"># 1| SRNOM : signifie que l&#39;on fait varier la constante avec la variable SRNOM</span></span>
<span id="cb999-10"><a href="#cb999-10"></a>Modele1 &lt;-<span class="st"> </span><span class="kw">lmer</span>(PCTArb <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span><span class="st"> </span>SRNOM),  <span class="dt">data =</span> Multiniveau)</span>
<span id="cb999-11"><a href="#cb999-11"></a></span>
<span id="cb999-12"><a href="#cb999-12"></a><span class="co"># Nombre de groupes</span></span>
<span id="cb999-13"><a href="#cb999-13"></a><span class="kw">cat</span>(<span class="st">&quot;nombre de groupes =&quot;</span>, <span class="kw">length</span>(<span class="kw">unique</span>(Multiniveau<span class="op">$</span>SRNOM)))</span></code></pre></div>
<pre><code>## nombre de groupes = 312</code></pre>
<p>La fonction <code>summary(Modele1)</code> permet d’afficher les résultats du modèle. Dans la section intitulée <code>Random effects</code>, la variance pour le niveau 2 (<code>SRNOM (Intercept)</code>) est de 19,82 contre 92,93 pour le niveau 1 (<code>Residual</code>). Le coefficient de corrélation intraclasse (ICC) est donc égal à <span class="math inline">\(\mbox{19,82 / (19,82+92,93)} \times \mbox{100 = 17,58}\)</span>%.</p>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="#cb1001-1"></a><span class="co"># Résultats du modèle</span></span>
<span id="cb1001-2"><a href="#cb1001-2"></a><span class="kw">summary</span>(Modele1)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: PCTArb ~ 1 + (1 | SRNOM)
##    Data: Multiniveau
## 
## REML criterion at convergence: 80299.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.9413 -0.5295 -0.2235  0.2175  8.4695 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  SRNOM    (Intercept) 19.82    4.452   
##  Residual             92.93    9.640   
## Number of obs: 10814, groups:  SRNOM, 312
## 
## Fixed effects:
##             Estimate Std. Error       df t value Pr(&gt;|t|)    
## (Intercept)   7.3373     0.2772 314.9183   26.47   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Notez qu’il est possible d’obtenir directement la valeur de l’ICC avec la fonction <code>icc(Modele1)</code> du <em>package</em> <code>performance</code> et les statistiques d’ajustement du modèle avec les fonctions <code>logLik</code>, <code>AIC</code> et <code>BIC</code>.</p>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1003-1"><a href="#cb1003-1"></a><span class="co"># Calcul de l&#39;ICC (coefficient intraclasse)</span></span>
<span id="cb1003-2"><a href="#cb1003-2"></a>performance<span class="op">::</span><span class="kw">icc</span>(Modele1)</span></code></pre></div>
<pre><code>## # Intraclass Correlation Coefficient
## 
##      Adjusted ICC: 0.176
##   Conditional ICC: 0.176</code></pre>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1005-1"><a href="#cb1005-1"></a>ICC1 &lt;-<span class="st"> </span>performance<span class="op">::</span><span class="kw">icc</span>(Modele1)</span>
<span id="cb1005-2"><a href="#cb1005-2"></a><span class="kw">cat</span>(<span class="st">&quot;Part de la variance de la variable dépendante imputable au niveau 2 : &quot;</span>, </span>
<span id="cb1005-3"><a href="#cb1005-3"></a>    <span class="kw">round</span>(ICC1<span class="op">$</span>ICC_adjusted<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;%&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## Part de la variance de la variable dépendante imputable au niveau 2 : 17.58%</code></pre>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="#cb1007-1"></a><span class="co"># Qualité d&#39;ajustement du modèle</span></span>
<span id="cb1007-2"><a href="#cb1007-2"></a><span class="kw">cat</span>(<span class="st">&quot;Statistiques d&#39;ajustement du modèle :&quot;</span>,</span>
<span id="cb1007-3"><a href="#cb1007-3"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">-2 Log V = &quot;</span>, <span class="dv">-2</span><span class="op">*</span><span class="kw">logLik</span>(Modele1),</span>
<span id="cb1007-4"><a href="#cb1007-4"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">AIC =&quot;</span>, <span class="kw">AIC</span>(Modele1), </span>
<span id="cb1007-5"><a href="#cb1007-5"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">BIC =&quot;</span>, <span class="kw">BIC</span>(Modele1))</span></code></pre></div>
<pre><code>## Statistiques d&#39;ajustement du modèle : 
## -2 Log V =  80299.22 
## AIC = 80305.22 
## BIC = 80327.08</code></pre>
</div>
<div id="sect1042" class="section level3">
<h3><span class="header-section-number">10.4.2</span> Modèle avec les variables indépendantes du niveau 1</h3>
<p>Le second modèle consiste à introduire les variables indépendantes mesurées pour les tronçons de rue (niveau 1). Notez comment sont centrées préalablement les variables explicatives.</p>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="#cb1009-1"></a><span class="co"># Centrage des variables indépendantes</span></span>
<span id="cb1009-2"><a href="#cb1009-2"></a>VINiv1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Width&quot;</span>,<span class="st">&quot;Length&quot;</span>,<span class="st">&quot;AgeMed&quot;</span>,<span class="st">&quot;AgeMed2&quot;</span>,<span class="st">&quot;ResiPCT&quot;</span>,<span class="st">&quot;DuTriPct&quot;</span>,<span class="st">&quot;NoLog&quot;</span>,<span class="st">&quot;Setback&quot;</span>)</span>
<span id="cb1009-3"><a href="#cb1009-3"></a><span class="cf">for</span> (e <span class="cf">in</span> VINiv1){</span>
<span id="cb1009-4"><a href="#cb1009-4"></a>  e.c &lt;-<span class="st"> </span><span class="kw">paste</span>(e, <span class="st">&quot;.c&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb1009-5"><a href="#cb1009-5"></a>  Multiniveau[[e.c]] &lt;-<span class="st"> </span>Multiniveau[[e]] <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Multiniveau[[e]])</span>
<span id="cb1009-6"><a href="#cb1009-6"></a>}</span>
<span id="cb1009-7"><a href="#cb1009-7"></a></span>
<span id="cb1009-8"><a href="#cb1009-8"></a><span class="co"># MODÈLE 2 : modèle avec les prédicteurs au niveau 1 (rues) </span></span>
<span id="cb1009-9"><a href="#cb1009-9"></a><span class="co"># ------------------------------------------------------</span></span>
<span id="cb1009-10"><a href="#cb1009-10"></a>Modele2 &lt;-<span class="st"> </span><span class="kw">lmer</span>(PCTArb <span class="op">~</span></span>
<span id="cb1009-11"><a href="#cb1009-11"></a><span class="st">                  </span><span class="co"># Variables indépendantes au niveau 1</span></span>
<span id="cb1009-12"><a href="#cb1009-12"></a><span class="st">                   </span>Width.c<span class="op">+</span>Length.c<span class="op">+</span>AgeMed.c<span class="op">+</span>AgeMed2.c<span class="op">+</span>ResiPCT.c<span class="op">+</span>DuTriPct.c<span class="op">+</span>NoLog.c<span class="op">+</span>Setback.c<span class="op">+</span></span>
<span id="cb1009-13"><a href="#cb1009-13"></a><span class="st">                   </span>(<span class="dv">1</span><span class="op">|</span><span class="st"> </span>SRNOM), <span class="dt">data =</span> Multiniveau)</span>
<span id="cb1009-14"><a href="#cb1009-14"></a></span>
<span id="cb1009-15"><a href="#cb1009-15"></a><span class="co"># Résultats du modèle</span></span>
<span id="cb1009-16"><a href="#cb1009-16"></a><span class="kw">summary</span>(Modele2)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: PCTArb ~ Width.c + Length.c + AgeMed.c + AgeMed2.c + ResiPCT.c +  
##     DuTriPct.c + NoLog.c + Setback.c + (1 | SRNOM)
##    Data: Multiniveau
## 
## REML criterion at convergence: 78763.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.9065 -0.5536 -0.1941  0.2569  9.4205 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  SRNOM    (Intercept) 15.26    3.907   
##  Residual             80.32    8.962   
## Number of obs: 10814, groups:  SRNOM, 312
## 
## Fixed effects:
##               Estimate Std. Error         df t value Pr(&gt;|t|)    
## (Intercept)  7.228e+00  2.479e-01  3.183e+02  29.151  &lt; 2e-16 ***
## Width.c     -1.292e-01  1.272e-02  1.075e+04 -10.160  &lt; 2e-16 ***
## Length.c     1.085e-02  1.717e-03  1.073e+04   6.322 2.69e-10 ***
## AgeMed.c     1.103e+00  1.856e-01  1.080e+04   5.946 2.83e-09 ***
## AgeMed2.c   -2.950e-04  4.791e-05  1.080e+04  -6.158 7.62e-10 ***
## ResiPCT.c    4.699e-02  3.466e-03  1.080e+04  13.558  &lt; 2e-16 ***
## DuTriPct.c  -1.299e-02  2.683e-03  1.070e+04  -4.842 1.30e-06 ***
## NoLog.c      1.473e-01  1.057e-02  1.080e+04  13.938  &lt; 2e-16 ***
## Setback.c    2.018e-01  2.295e-02  1.080e+04   8.792  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##            (Intr) Wdth.c Lngth. AgMd.c AgMd2. RsPCT. DTrPc. NoLg.c
## Width.c    -0.003                                                 
## Length.c    0.011 -0.216                                          
## AgeMed.c    0.000  0.010 -0.014                                   
## AgeMed2.c   0.002 -0.011  0.013 -1.000                            
## ResiPCT.c   0.056  0.095  0.208  0.023 -0.024                     
## DuTriPct.c -0.010  0.022  0.086 -0.074  0.077  0.025              
## NoLog.c    -0.030  0.156 -0.785 -0.008  0.009 -0.269 -0.127       
## Setback.c   0.048 -0.018 -0.146  0.007 -0.008 -0.014  0.035  0.038
## fit warnings:
## Some predictor variables are on very different scales: consider rescaling</code></pre>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1011-1"><a href="#cb1011-1"></a><span class="co"># Calcul de l&#39;ICC (coefficient intraclasse)</span></span>
<span id="cb1011-2"><a href="#cb1011-2"></a>performance<span class="op">::</span><span class="kw">icc</span>(Modele2)</span></code></pre></div>
<pre><code>## # Intraclass Correlation Coefficient
## 
##      Adjusted ICC: 0.160
##   Conditional ICC: 0.139</code></pre>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1013-1"><a href="#cb1013-1"></a>ICC2 &lt;-<span class="st"> </span>performance<span class="op">::</span><span class="kw">icc</span>(Modele2)</span>
<span id="cb1013-2"><a href="#cb1013-2"></a><span class="kw">cat</span>(<span class="st">&quot;Part de la variance de la variable dépendante &quot;</span>,</span>
<span id="cb1013-3"><a href="#cb1013-3"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">imputable au niveau 2 : &quot;</span>, <span class="kw">round</span>(ICC2<span class="op">$</span>ICC_adjusted<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;%&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## Part de la variance de la variable dépendante 
## imputable au niveau 2 : 15.97%</code></pre>
<div class="sourceCode" id="cb1015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1015-1"><a href="#cb1015-1"></a><span class="co"># Calcul des R2 conditionnel et marginal avec les fonctions</span></span>
<span id="cb1015-2"><a href="#cb1015-2"></a><span class="co"># r.squaredGLMM ou r2_nakagawa du package performance</span></span>
<span id="cb1015-3"><a href="#cb1015-3"></a><span class="kw">r.squaredGLMM</span>(Modele2)</span></code></pre></div>
<pre><code>##            R2m       R2c
## [1,] 0.1292872 0.2683329</code></pre>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="#cb1017-1"></a><span class="kw">r2_nakagawa</span>(Modele2)</span></code></pre></div>
<pre><code>## # R2 for Mixed Models
## 
##   Conditional R2: 0.268
##      Marginal R2: 0.129</code></pre>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="#cb1019-1"></a><span class="co"># Qualité d&#39;ajustement du modèle</span></span>
<span id="cb1019-2"><a href="#cb1019-2"></a><span class="kw">cat</span>(<span class="st">&quot;Statistiques d&#39;ajustement du modèle&quot;</span>,</span>
<span id="cb1019-3"><a href="#cb1019-3"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">-2 Log L = &quot;</span>, <span class="dv">-2</span><span class="op">*</span><span class="kw">logLik</span>(Modele2),</span>
<span id="cb1019-4"><a href="#cb1019-4"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">AIC =&quot;</span>, <span class="kw">AIC</span>(Modele2), </span>
<span id="cb1019-5"><a href="#cb1019-5"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">BIC =&quot;</span>, <span class="kw">BIC</span>(Modele2))</span></code></pre></div>
<pre><code>## Statistiques d&#39;ajustement du modèle 
## -2 Log L =  78763.83 
## AIC = 78785.83 
## BIC = 78866</code></pre>
</div>
<div id="sect1043" class="section level3">
<h3><span class="header-section-number">10.4.3</span> Modèle avec les variables indépendantes aux niveaux 1 et 2</h3>
<p>Le troisième modèle comprend à la fois les variables indépendantes mesurées aux deux niveaux (tronçons et secteurs de recensement).</p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1021-1"><a href="#cb1021-1"></a><span class="co"># MODÈLE 3 : modèle complet avec les prédicteurs aux niveaux 1 et 2</span></span>
<span id="cb1021-2"><a href="#cb1021-2"></a><span class="co"># ------------------------------------------------------</span></span>
<span id="cb1021-3"><a href="#cb1021-3"></a>Modele3 &lt;-<span class="st"> </span><span class="kw">lmer</span>(PCTArb <span class="op">~</span></span>
<span id="cb1021-4"><a href="#cb1021-4"></a><span class="st">                  </span><span class="co"># Variables indépendantes au niveau 1</span></span>
<span id="cb1021-5"><a href="#cb1021-5"></a><span class="st">                   </span>Width.c<span class="op">+</span>Length.c<span class="op">+</span>AgeMed.c<span class="op">+</span>AgeMed2.c<span class="op">+</span>ResiPCT.c<span class="op">+</span>DuTriPct.c<span class="op">+</span>NoLog.c<span class="op">+</span>Setback.c<span class="op">+</span></span>
<span id="cb1021-6"><a href="#cb1021-6"></a><span class="st">                  </span><span class="co"># Variables indépendantes au niveau 2</span></span>
<span id="cb1021-7"><a href="#cb1021-7"></a><span class="st">                  </span>ValLog<span class="op">+</span>UDipPCT<span class="op">+</span>PCTFRAVI<span class="op">+</span>PCTIMGRE<span class="op">+</span>AvecEnf<span class="op">+</span>FranPCT<span class="op">+</span></span>
<span id="cb1021-8"><a href="#cb1021-8"></a><span class="st">                  </span>(<span class="dv">1</span><span class="op">|</span><span class="st"> </span>SRNOM), <span class="dt">data =</span> Multiniveau)</span>
<span id="cb1021-9"><a href="#cb1021-9"></a></span>
<span id="cb1021-10"><a href="#cb1021-10"></a><span class="co"># Résultats du modèle</span></span>
<span id="cb1021-11"><a href="#cb1021-11"></a><span class="kw">summary</span>(Modele3)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: PCTArb ~ Width.c + Length.c + AgeMed.c + AgeMed2.c + ResiPCT.c +  
##     DuTriPct.c + NoLog.c + Setback.c + ValLog + UDipPCT + PCTFRAVI +  
##     PCTIMGRE + AvecEnf + FranPCT + (1 | SRNOM)
##    Data: Multiniveau
## 
## REML criterion at convergence: 78742.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.0461 -0.5558 -0.1939  0.2622  9.4190 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  SRNOM    (Intercept) 12.12    3.482   
##  Residual             80.35    8.964   
## Number of obs: 10814, groups:  SRNOM, 312
## 
## Fixed effects:
##               Estimate Std. Error         df t value Pr(&gt;|t|)    
## (Intercept) -5.175e-01  3.227e+00  3.136e+02  -0.160  0.87271    
## Width.c     -1.319e-01  1.271e-02  1.076e+04 -10.375  &lt; 2e-16 ***
## Length.c     1.076e-02  1.717e-03  1.073e+04   6.265 3.87e-10 ***
## AgeMed.c     1.097e+00  1.854e-01  1.078e+04   5.920 3.31e-09 ***
## AgeMed2.c   -2.936e-04  4.785e-05  1.078e+04  -6.136 8.75e-10 ***
## ResiPCT.c    4.649e-02  3.482e-03  1.078e+04  13.352  &lt; 2e-16 ***
## DuTriPct.c  -1.268e-02  2.677e-03  1.061e+04  -4.737 2.20e-06 ***
## NoLog.c      1.478e-01  1.057e-02  1.079e+04  13.985  &lt; 2e-16 ***
## Setback.c    1.944e-01  2.307e-02  1.079e+04   8.428  &lt; 2e-16 ***
## ValLog       1.591e-02  3.856e-03  3.127e+02   4.126 4.75e-05 ***
## UDipPCT      1.405e-02  3.546e-02  3.292e+02   0.396  0.69221    
## PCTFRAVI    -8.837e-02  2.958e-02  3.282e+02  -2.988  0.00302 ** 
## PCTIMGRE     2.367e-01  4.860e-02  3.217e+02   4.870 1.76e-06 ***
## AvecEnf      5.778e-04  3.226e-02  3.141e+02   0.018  0.98572    
## FranPCT      5.213e-02  1.638e-02  3.163e+02   3.183  0.00160 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## fit warnings:
## Some predictor variables are on very different scales: consider rescaling</code></pre>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="#cb1023-1"></a><span class="co"># Qualité d&#39;ajustement du modèle</span></span>
<span id="cb1023-2"><a href="#cb1023-2"></a><span class="kw">cat</span>(<span class="st">&quot;Statistiques d&#39;ajustement du modèle&quot;</span>,</span>
<span id="cb1023-3"><a href="#cb1023-3"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">-2 Log L = &quot;</span>, <span class="dv">-2</span><span class="op">*</span><span class="kw">logLik</span>(Modele3),</span>
<span id="cb1023-4"><a href="#cb1023-4"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">AIC =&quot;</span>, <span class="kw">AIC</span>(Modele3), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">BIC =&quot;</span>, <span class="kw">BIC</span>(Modele3))</span></code></pre></div>
<pre><code>## Statistiques d&#39;ajustement du modèle 
## -2 Log L =  78742.85 
## AIC = 78776.85 
## BIC = 78900.75</code></pre>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="#cb1025-1"></a><span class="co"># Calcul de l&#39;ICC (coefficient intraclasse)</span></span>
<span id="cb1025-2"><a href="#cb1025-2"></a>performance<span class="op">::</span><span class="kw">icc</span>(Modele3)</span></code></pre></div>
<pre><code>## # Intraclass Correlation Coefficient
## 
##      Adjusted ICC: 0.131
##   Conditional ICC: 0.110</code></pre>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="#cb1027-1"></a>ICC3 &lt;-<span class="st"> </span>performance<span class="op">::</span><span class="kw">icc</span>(Modele3)</span>
<span id="cb1027-2"><a href="#cb1027-2"></a><span class="kw">cat</span>(<span class="st">&quot;Part de la variance de la variable dépendante &quot;</span>,</span>
<span id="cb1027-3"><a href="#cb1027-3"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">imputable au niveau 2 : &quot;</span>, <span class="kw">round</span>(ICC3<span class="op">$</span>ICC_adjusted<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;%&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## Part de la variance de la variable dépendante 
## imputable au niveau 2 : 13.11%</code></pre>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="#cb1029-1"></a><span class="co"># Calcul des R2 conditionnel et marginal avec les fonctions</span></span>
<span id="cb1029-2"><a href="#cb1029-2"></a><span class="co"># r.squaredGLMM ou r2_nakagawa du package performance</span></span>
<span id="cb1029-3"><a href="#cb1029-3"></a><span class="kw">r.squaredGLMM</span>(Modele3)</span></code></pre></div>
<pre><code>##            R2m      R2c
## [1,] 0.1598477 0.269979</code></pre>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="#cb1031-1"></a><span class="kw">r2_nakagawa</span>(Modele3)</span></code></pre></div>
<pre><code>## # R2 for Mixed Models
## 
##   Conditional R2: 0.270
##      Marginal R2: 0.160</code></pre>
</div>
<div id="sect10414" class="section level3">
<h3><span class="header-section-number">10.4.4</span> Modèle complet avec une interaction</h3>
<p>Le quatrième modèle consiste à ajouter au modèle complet une interaction entre deux variables des deux niveaux.</p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="#cb1033-1"></a><span class="co"># Variance d&#39;interaction</span></span>
<span id="cb1033-2"><a href="#cb1033-2"></a>Multiniveau<span class="op">$</span>PCTFRAVI_Setback &lt;-<span class="st">  </span>Multiniveau<span class="op">$</span>PCTFRAVI <span class="op">*</span><span class="st"> </span>Multiniveau<span class="op">$</span>Setback.c</span>
<span id="cb1033-3"><a href="#cb1033-3"></a></span>
<span id="cb1033-4"><a href="#cb1033-4"></a><span class="co"># MODÈLE 4 : interaction aux deux niveaux</span></span>
<span id="cb1033-5"><a href="#cb1033-5"></a><span class="co"># ------------------------------------------------------</span></span>
<span id="cb1033-6"><a href="#cb1033-6"></a>Modele4 &lt;-<span class="st"> </span><span class="kw">lmer</span>(PCTArb <span class="op">~</span></span>
<span id="cb1033-7"><a href="#cb1033-7"></a><span class="st">                  </span><span class="co"># Variables indépendantes au niveau 1</span></span>
<span id="cb1033-8"><a href="#cb1033-8"></a><span class="st">                   </span>Width.c<span class="op">+</span>Length.c<span class="op">+</span>AgeMed.c<span class="op">+</span>AgeMed2.c<span class="op">+</span>ResiPCT.c<span class="op">+</span>DuTriPct.c<span class="op">+</span>NoLog.c<span class="op">+</span>Setback.c<span class="op">+</span></span>
<span id="cb1033-9"><a href="#cb1033-9"></a><span class="st">                  </span><span class="co"># Variables indépendantes au niveau 2</span></span>
<span id="cb1033-10"><a href="#cb1033-10"></a><span class="st">                  </span>ValLog<span class="op">+</span>UDipPCT<span class="op">+</span>PCTFRAVI<span class="op">+</span>PCTIMGRE<span class="op">+</span>AvecEnf<span class="op">+</span>FranPCT<span class="op">+</span></span>
<span id="cb1033-11"><a href="#cb1033-11"></a><span class="st">                  </span><span class="co"># Variable d&#39;interaction</span></span>
<span id="cb1033-12"><a href="#cb1033-12"></a><span class="st">                  </span>PCTFRAVI_Setback<span class="op">+</span></span>
<span id="cb1033-13"><a href="#cb1033-13"></a>(<span class="dv">1</span><span class="op">|</span><span class="st"> </span>SRNOM), <span class="dt">data =</span> Multiniveau)</span>
<span id="cb1033-14"><a href="#cb1033-14"></a></span>
<span id="cb1033-15"><a href="#cb1033-15"></a><span class="co"># Résultats du modèle</span></span>
<span id="cb1033-16"><a href="#cb1033-16"></a><span class="kw">summary</span>(Modele4)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: PCTArb ~ Width.c + Length.c + AgeMed.c + AgeMed2.c + ResiPCT.c +  
##     DuTriPct.c + NoLog.c + Setback.c + ValLog + UDipPCT + PCTFRAVI +  
##     PCTIMGRE + AvecEnf + FranPCT + PCTFRAVI_Setback + (1 | SRNOM)
##    Data: Multiniveau
## 
## REML criterion at convergence: 78732.7
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.0148 -0.5568 -0.1922  0.2598  9.4261 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  SRNOM    (Intercept) 11.83    3.439   
##  Residual             80.24    8.958   
## Number of obs: 10814, groups:  SRNOM, 312
## 
## Fixed effects:
##                    Estimate Std. Error         df t value Pr(&gt;|t|)    
## (Intercept)      -9.484e-03  3.198e+00  3.132e+02  -0.003  0.99764    
## Width.c          -1.357e-01  1.273e-02  1.076e+04 -10.660  &lt; 2e-16 ***
## Length.c          1.079e-02  1.716e-03  1.073e+04   6.289 3.32e-10 ***
## AgeMed.c          1.092e+00  1.852e-01  1.078e+04   5.894 3.88e-09 ***
## AgeMed2.c        -2.923e-04  4.780e-05  1.078e+04  -6.114 1.00e-09 ***
## ResiPCT.c         4.608e-02  3.480e-03  1.078e+04  13.239  &lt; 2e-16 ***
## DuTriPct.c       -1.268e-02  2.674e-03  1.059e+04  -4.742 2.14e-06 ***
## NoLog.c           1.454e-01  1.057e-02  1.079e+04  13.747  &lt; 2e-16 ***
## Setback.c         3.443e-03  4.759e-02  1.076e+04   0.072  0.94233    
## ValLog            1.582e-02  3.820e-03  3.119e+02   4.141 4.46e-05 ***
## UDipPCT           9.404e-03  3.515e-02  3.288e+02   0.268  0.78920    
## PCTFRAVI         -7.883e-02  2.937e-02  3.322e+02  -2.684  0.00764 ** 
## PCTIMGRE          2.194e-01  4.829e-02  3.261e+02   4.543 7.82e-06 ***
## AvecEnf          -7.063e-03  3.199e-02  3.136e+02  -0.221  0.82542    
## FranPCT           4.987e-02  1.623e-02  3.161e+02   3.072  0.00231 ** 
## PCTFRAVI_Setback  8.169e-03  1.779e-03  1.047e+04   4.591 4.46e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## fit warnings:
## Some predictor variables are on very different scales: consider rescaling</code></pre>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="#cb1035-1"></a><span class="co"># Qualité d&#39;ajustement du modèle</span></span>
<span id="cb1035-2"><a href="#cb1035-2"></a><span class="kw">cat</span>(<span class="st">&quot;Statistiques d&#39;ajustement du modèle&quot;</span>,</span>
<span id="cb1035-3"><a href="#cb1035-3"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">-2 Log L = &quot;</span>, <span class="dv">-2</span><span class="op">*</span><span class="kw">logLik</span>(Modele4),</span>
<span id="cb1035-4"><a href="#cb1035-4"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">AIC =&quot;</span>, <span class="kw">AIC</span>(Modele3), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">BIC =&quot;</span>, <span class="kw">BIC</span>(Modele4))</span></code></pre></div>
<pre><code>## Statistiques d&#39;ajustement du modèle 
## -2 Log L =  78732.66 
## AIC = 78776.85 
## BIC = 78899.85</code></pre>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="#cb1037-1"></a><span class="co"># Calcul de l&#39;ICC (coefficient intraclasse)</span></span>
<span id="cb1037-2"><a href="#cb1037-2"></a>performance<span class="op">::</span><span class="kw">icc</span>(Modele4)</span></code></pre></div>
<pre><code>## # Intraclass Correlation Coefficient
## 
##      Adjusted ICC: 0.128
##   Conditional ICC: 0.108</code></pre>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="#cb1039-1"></a>ICC4 &lt;-<span class="st"> </span>performance<span class="op">::</span><span class="kw">icc</span>(Modele4)</span>
<span id="cb1039-2"><a href="#cb1039-2"></a><span class="kw">cat</span>(<span class="st">&quot;Part de la variance de la variable dépendante &quot;</span>,</span>
<span id="cb1039-3"><a href="#cb1039-3"></a>    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">imputable au niveau 2 : &quot;</span>, <span class="kw">round</span>(ICC4<span class="op">$</span>ICC_adjusted<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;%&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## Part de la variance de la variable dépendante 
## imputable au niveau 2 : 12.85%</code></pre>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1041-1"><a href="#cb1041-1"></a><span class="co"># Calcul des R2 conditionnel et marginal avec les fonctions</span></span>
<span id="cb1041-2"><a href="#cb1041-2"></a><span class="co"># r.squaredGLMM ou r2_nakagawa du package performance</span></span>
<span id="cb1041-3"><a href="#cb1041-3"></a><span class="kw">r.squaredGLMM</span>(Modele4)</span></code></pre></div>
<pre><code>##            R2m      R2c
## [1,] 0.1628372 0.270394</code></pre>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="#cb1043-1"></a><span class="kw">r2_nakagawa</span>(Modele4)</span></code></pre></div>
<pre><code>## # R2 for Mixed Models
## 
##   Conditional R2: 0.270
##      Marginal R2: 0.163</code></pre>
</div>
<div id="sect1045" class="section level3">
<h3><span class="header-section-number">10.4.5</span> Comparaison des quatre modèles</h3>
<p>Pour comparer les modèles, nous utilisons habituellement les statistiques d’ajustement du modèle vues plus haut, soit le maximum de vraisemblance (<em>−2 Log-likelihood</em>), l’AIC, l’ICC et les R<sup>2</sup> marginal et conditionnel.</p>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="#cb1045-1"></a>c_logLik &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">logLik</span>(Modele1),<span class="kw">logLik</span>(Modele2),<span class="kw">logLik</span>(Modele3),<span class="kw">logLik</span>(Modele4))</span>
<span id="cb1045-2"><a href="#cb1045-2"></a>ICC &lt;-<span class="st"> </span><span class="kw">c</span>(performance<span class="op">::</span><span class="kw">icc</span>(Modele1)<span class="op">$</span>ICC_adjusted,</span>
<span id="cb1045-3"><a href="#cb1045-3"></a>         performance<span class="op">::</span><span class="kw">icc</span>(Modele2)<span class="op">$</span>ICC_adjusted,</span>
<span id="cb1045-4"><a href="#cb1045-4"></a>         performance<span class="op">::</span><span class="kw">icc</span>(Modele3)<span class="op">$</span>ICC_adjusted,</span>
<span id="cb1045-5"><a href="#cb1045-5"></a>         performance<span class="op">::</span><span class="kw">icc</span>(Modele4)<span class="op">$</span>ICC_adjusted)</span>
<span id="cb1045-6"><a href="#cb1045-6"></a></span>
<span id="cb1045-7"><a href="#cb1045-7"></a>R2m &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">r.squaredGLMM</span>(Modele1)[<span class="dv">1</span>],</span>
<span id="cb1045-8"><a href="#cb1045-8"></a>         <span class="kw">r.squaredGLMM</span>(Modele2)[<span class="dv">1</span>],</span>
<span id="cb1045-9"><a href="#cb1045-9"></a>         <span class="kw">r.squaredGLMM</span>(Modele3)[<span class="dv">1</span>],</span>
<span id="cb1045-10"><a href="#cb1045-10"></a>         <span class="kw">r.squaredGLMM</span>(Modele4)[<span class="dv">1</span>])</span>
<span id="cb1045-11"><a href="#cb1045-11"></a></span>
<span id="cb1045-12"><a href="#cb1045-12"></a>R2c &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">r.squaredGLMM</span>(Modele1)[<span class="dv">2</span>],</span>
<span id="cb1045-13"><a href="#cb1045-13"></a>         <span class="kw">r.squaredGLMM</span>(Modele2)[<span class="dv">2</span>],</span>
<span id="cb1045-14"><a href="#cb1045-14"></a>         <span class="kw">r.squaredGLMM</span>(Modele3)[<span class="dv">2</span>],</span>
<span id="cb1045-15"><a href="#cb1045-15"></a>         <span class="kw">r.squaredGLMM</span>(Modele4)[<span class="dv">2</span>])</span>
<span id="cb1045-16"><a href="#cb1045-16"></a></span>
<span id="cb1045-17"><a href="#cb1045-17"></a><span class="kw">print</span>(<span class="kw">data.frame</span>(</span>
<span id="cb1045-18"><a href="#cb1045-18"></a>            <span class="dt">Modele =</span> <span class="kw">c</span>(<span class="st">&quot;Modèle 1 (vide)&quot;</span>, </span>
<span id="cb1045-19"><a href="#cb1045-19"></a>                       <span class="st">&quot;Modèle 2 (VI : niv. 1)&quot;</span>, </span>
<span id="cb1045-20"><a href="#cb1045-20"></a>                       <span class="st">&quot;Modèle 3 (VI : niv. 1 et 2)&quot;</span>,</span>
<span id="cb1045-21"><a href="#cb1045-21"></a>                       <span class="st">&quot;Modèle 4 (interaction niv. 1 et 2&quot;</span>),</span>
<span id="cb1045-22"><a href="#cb1045-22"></a>            <span class="dt">dl =</span> <span class="kw">AIC</span>(Modele1, Modele2, Modele3, Modele4)<span class="op">$</span>df,</span>
<span id="cb1045-23"><a href="#cb1045-23"></a>            <span class="dt">Moins2LogLik =</span> <span class="kw">round</span>(<span class="op">-</span><span class="dv">2</span><span class="op">*</span>c_logLik,<span class="dv">0</span>),</span>
<span id="cb1045-24"><a href="#cb1045-24"></a>            <span class="dt">AIC =</span> <span class="kw">round</span>(<span class="kw">AIC</span>(Modele1, Modele2, Modele3, Modele4)<span class="op">$</span>AIC,<span class="dv">0</span>),</span>
<span id="cb1045-25"><a href="#cb1045-25"></a>            <span class="dt">ICC =</span> <span class="kw">round</span>(ICC,<span class="dv">4</span>),</span>
<span id="cb1045-26"><a href="#cb1045-26"></a>            <span class="dt">R2marg =</span> <span class="kw">round</span>(R2m,<span class="dv">3</span>),</span>
<span id="cb1045-27"><a href="#cb1045-27"></a>            <span class="dt">R2cond =</span> <span class="kw">round</span>(R2c,<span class="dv">3</span>)</span>
<span id="cb1045-28"><a href="#cb1045-28"></a>))</span></code></pre></div>
<pre><code>##                              Modele dl Moins2LogLik   AIC    ICC R2marg R2cond
## 1                   Modèle 1 (vide)  3        80299 80305 0.1758  0.000  0.176
## 2            Modèle 2 (VI : niv. 1) 11        78764 78786 0.1597  0.129  0.268
## 3       Modèle 3 (VI : niv. 1 et 2) 17        78743 78777 0.1311  0.160  0.270
## 4 Modèle 4 (interaction niv. 1 et 2 18        78733 78769 0.1285  0.163  0.270</code></pre>
<p>Vous constaterez ci-dessus que les valeurs d’AIC et de -2 log de vraisemblance diminuent des modèles 1 à 4, signalant une amélioration progressive des modèles. Cela se traduit aussi par une augmentation du R<sup>2</sup> conditionnel incluant à la fois les effets fixes et aléatoires. Sans surprise, la valeur du coefficient de corrélation intraclasse diminue du modèle vide au modèle complet : plus nous ajoutons de variables dépendantes, plus la capacité explicative du niveau 2 diminue.</p>
<p>Il est également judicieux de vérifier si un modèle est significativement différent du modèle précédent avec la fonction <code>anova</code> qui compare les différences de leurs déviances. En guise d’exemple, la différence de déviance de 59 (<span class="math inline">\(\mbox{78 625}-\mbox{78 684}=\mbox{59}\)</span>) entre les modèles 3 et 2 (modèle complet <em>versus</em> modèle GLMM) avec six degrés de liberté – puisque le modèle 3 inclut six variables indépendantes de plus que le précédent (<span class="math inline">\(\mbox{17}-\mbox{11}=\mbox{6}\)</span>) – est significative (<em>p</em> &lt; 0,001). Cela indique que le modèle 3 est plus performant que le précédent.</p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="#cb1047-1"></a><span class="kw">anova</span>(Modele1, Modele2, Modele3, Modele4)</span></code></pre></div>
<pre><code>## Data: Multiniveau
## Models:
## Modele1: PCTArb ~ 1 + (1 | SRNOM)
## Modele2: PCTArb ~ Width.c + Length.c + AgeMed.c + AgeMed2.c + ResiPCT.c + 
## Modele2:     DuTriPct.c + NoLog.c + Setback.c + (1 | SRNOM)
## Modele3: PCTArb ~ Width.c + Length.c + AgeMed.c + AgeMed2.c + ResiPCT.c + 
## Modele3:     DuTriPct.c + NoLog.c + Setback.c + ValLog + UDipPCT + PCTFRAVI + 
## Modele3:     PCTIMGRE + AvecEnf + FranPCT + (1 | SRNOM)
## Modele4: PCTArb ~ Width.c + Length.c + AgeMed.c + AgeMed2.c + ResiPCT.c + 
## Modele4:     DuTriPct.c + NoLog.c + Setback.c + ValLog + UDipPCT + PCTFRAVI + 
## Modele4:     PCTIMGRE + AvecEnf + FranPCT + PCTFRAVI_Setback + (1 | SRNOM)
##         npar   AIC   BIC logLik deviance    Chisq Df Pr(&gt;Chisq)    
## Modele1    3 80304 80326 -40149    80298                           
## Modele2   11 78706 78786 -39342    78684 1614.351  8  &lt; 2.2e-16 ***
## Modele3   17 78659 78783 -39313    78625   59.131  6  6.758e-11 ***
## Modele4   18 78640 78771 -39302    78604   21.166  1  4.213e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="sect105" class="section level2">
<h2><span class="header-section-number">10.5</span> Quiz de révision du chapitre</h2>
<div id="Chapitre10_Multiniveau" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_Chapitre10_Multiniveau;
  window.onload = function() {
    quizz_Chapitre10_Multiniveau = new Quiz('Chapitre10_Multiniveau', [['1', '2'],'1','1','2','1','1']);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels sont les deux intérêts majeurs des modèles multiniveaux?
</div>
<div>
Relisez au besoin la section @ref(sect101).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Analyser la répartition de la variance entre les différents niveaux</label>
</td>
<td>
<input type="checkbox" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Introduire des variables explicatives aux différents niveaux du modèle</label>
</td>
<td>
<input type="checkbox" name="q1" value="2"/>
</td>
</tr>
<tr>
<td>
<label>construire des splines</label>
</td>
<td>
<input type="checkbox" name="q1" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le modèle vide comprend :
</div>
<div>
Relisez au besoin la section @ref(sect10221).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>aucune variable explicative</label>
</td>
<td>
<input type="radio" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>plusieurs variables explicatives aux niveaux 1 et 2</label>
</td>
<td>
<input type="radio" name="q2" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un modèle avec uniquement les variables indépendantes du niveau 1 est un modèle à effets mixtes (GLMM).
</div>
<div>
Relisez au besoin la section @ref(sect10222).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q3" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quelle mesure permet d’analyser la répartition de la variance entre les deux niveaux?
</div>
<div>
Relisez au besoin la section @ref(sect10221).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Coefficients de régression</label>
</td>
<td>
<input type="radio" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Coefficient de corrélation intraclasse</label>
</td>
<td>
<input type="radio" name="q4" value="2"/>
</td>
</tr>
<tr>
<td>
<label>AIC</label>
</td>
<td>
<input type="radio" name="q4" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un modèle complet comprend des variables explicatives aux deux niveaux.
</div>
<div>
Relisez au besoin la section @ref(sect10223).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q5" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q5" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Est-ce possible d’introduire une interaction entre une variable mesurée au niveau 1 et une autre mesurée au niveau 2?
</div>
<div>
Relisez au besoin la section @ref(sect10224).
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q6" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q6" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<button type="button" onclick="showResults(quizz_Chapitre10_Multiniveau);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:10-Multiniveau.Rmd-->
</div>
</div>
<div id="chap11" class="section level1">
<h1><span class="header-section-number">11</span> Modèles généralisés additifs</h1>
<div class="bloc_attention">
<p>Ce chapitre n’a pas encore fait l’objet d’une révision linguistique. Il comprend certainement plusieurs coquilles… Une version révisée sera mise à jour prochainement.</p>
</div>
<p>Dans les précédents chapitres, nous avons eu l’occasion d’explorer toute une panoplie de modèles : régressions linéaires, modèles généralisés, modèles généralisés à effets mixtes et les modèles multiniveaux. Dans ce chapitre, nous abordons une nouvelle extension dans le monde des régressions : les modèles généralisés additifs (<em>Generalized additive model</em> en anglais — GAM). Cette extension a pour but de permettre de modéliser des relations non linéaires entre les variables indépendantes et la variable dépendante.</p>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons principalement les <em>packages</em> suivants :</p>
<ul>
<li>Pour créer des graphiques :
<ul>
<li><code>ggplot2</code> le seul, l’unique!</li>
<li><code>ggpubr</code> pour combiner des graphiques et réaliser des diagrammes.</li>
<li><code>metR</code> pour placer des étiquettes sur des isolignes.</li>
</ul></li>
<li>Pour jouer avec des <em>splines</em> :
<ul>
<li><code>splines2</code> pour construire les fonctions de base de nombreuses <em>splines</em>.</li>
<li><code>segmented</code> pour ajuster des modèles avec des coefficients variant par segment.</li>
</ul></li>
<li>Pour ajuster des modèles GAM :
<ul>
<li><code>mgcv</code>, le <em>package</em> de référence pour ajuster des GAM dans R!</li>
<li><code>gamlss</code>, un second <em>package</em> très flexible pour ajuster des GAM.</li>
<li><code>gamlss.add</code>, une extension de <strong>gamlss</strong> ajoutant des distributions supplémentaires.</li>
</ul></li>
<li>Pour analyser des modèles GAM :
<ul>
<li><code>itsadug</code> pour notamment extraire certains résultats d’un GAM.</li>
<li><code>mixedup</code> pour notamment extraire les effets aléatoires d’un GAM.</li>
<li><code>DHARMa</code> pour le diagnostic des résidus simulés.</li>
</ul></li>
</ul>
</div>
<div id="sect111" class="section level2">
<h2><span class="header-section-number">11.1</span> Introduction</h2>
<p>Puisque les modèles GAM sont une extension des modèles GLM, ils peuvent s’appliquer à des modèles pour des variables indépendantes qualitatives, de comptage ou continues. Nous l’appliquons ici, à titre d’illustration, à une variable indépendante continue. Pour rappel, la formule décrivant un modèle linéaire généralisé (GLM) utilisant une distribution normale et une fonction de lien identitaire est la suivante :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \beta X\\
&amp;g(x) = x
\end{aligned}
(\#eq:glm1B)
\end{equation}\]</span>
</p>
<p>Les coefficients <span class="math inline">\(\beta\)</span> permettent de quantifier l’effet des variables indépendantes (<em>X</em>) sur la moyenne (l’espérance) (<span class="math inline">\(\mu\)</span>) de la variable dépendante (<em>Y</em>). Un coefficient <span class="math inline">\(\beta_k\)</span> négatif indique que si la variable <span class="math inline">\(X_k\)</span> augmente, alors la variable <em>Y</em> tend à diminuer et inversement, si le coefficient est positif. L’inconvénient de cette formulation est que le modèle est capable de capter uniquement des relations linéaires entre ces variables. Or, il existe de nombreuses situations dans lesquelles une variable indépendante aura un lien non linéaire avec une variable dépendante; voici quelques exemples :</p>
<ul>
<li>Si nous mesurons le niveau de bruit émis par une source sonore (variable dépendante) à plusieurs endroits et que nous tentons de prédire l’intensité sonore en fonction de la distance à la source (variable indépendante), nous pouvons nous attendre à observer une relation non linéaire entre les deux. En effet, le son étant une énergie se dispersant selon une sphère dans l’espace, son intensité est inversement proportionnelle au carré de la distance avec la source sonore.</li>
<li>La concentration de la pollution atmosphérique en ville suit généralement des patrons temporels et spatiaux influencés directement par la météorologie et les activités humaines. Autrement dit, il serait absurde d’introduire l’espace de façon linéaire (avec un gradient nord-sud ou est-ouest), ou le moment de la journée de façon linéaire (comme si la pollution augmentait du matin au soir ou inversement). En guise d’exemple, la figure @ref(fig:figgam1), tirée de <span class="citation">Gelb et Apparicio (<a href="#ref-2020_3" role="doc-biblioref">2020</a>)</span>, illustre bien ces variations temporelles pour deux polluants (le dioxyde d’azote et l’azote).</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/gam/no2_03_patterns.PNG" alt="Patron journalier du NO~2~ et de l'O~3~ à Paris" width="75%" />
<p class="caption">
(#fig:figgam1)Patron journalier du NO<sub>2</sub> et de l’O<sub>3</sub> à Paris
</p>
</div>
<div id="sect1111" class="section level3">
<h3><span class="header-section-number">11.1.1</span> Non linéarité fonctionnelle</h3>
<p>Il existe de nombreuses façons d’introduire des relations non linéaires dans un modèle. La première et la plus simple à mettre en oeuvre est de transformer la variable indépendante à l’aide d’une fonction inverse, exponentielle, logarithmique ou autre.</p>
<p>Prenons un premier exemple avec une variable <em>Y</em> que nous tentons de prédire avec une variable <em>X</em>, présenté à la figure @ref(fig:figgam2). Si nous ajustons une droite de régression à ces données (en bleu), nous constatons que l’augmentation de <em>X</em> est associée avec une augmentation de <em>Y</em>. Cependant, la droite de régression est très éloignée des données et ne capte qu’une petite partie de la relation. Une lecture attentive permet de constater que l’effet de <em>X</em> sur <em>Y</em> augmente de plus en plus rapidement à mesure que <em>X</em> augmente. Cette forme est caractéristique d’une relation exponentielle. Nous pouvons donc transformer la variable <em>X</em> avec la fonction exponentielle afin d’obtenir un meilleur ajustement (en rouge).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam2-1.png" alt="Relation non linéaire exponentielle" width="50%" />
<p class="caption">
(#fig:figgam2)Relation non linéaire exponentielle
</p>
</div>
<p>La figure @ref(fig:figgam3) illustre trois autres situations avec les fonctions logarithmique, logistique inverse et racine carrée. Cette approche peut donner des résultats intéressants si vous disposez d’une bonne justification théorique sur la forme attendue de la relation entre <em>X</em> et <em>Y</em>.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam3-1.png" alt="Autres Relations non linéaires" width="75%" />
<p class="caption">
(#fig:figgam3)Autres Relations non linéaires
</p>
</div>
<p>Il existe également des cas de figure dans lesquels aucune fonction ne donne de résultats pertinents, tel qu’illustré à la figure @ref(fig:figgam4). Nous constatons facilement qu’aucune des fonctions proposées n’est capable de bien capter la relation entre les deux variables. Puisque cette relation est complexe, il convient alors d’utiliser une autre stratégie pour la modéliser.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam4-1.png" alt="Relation non linéaire plus complexe" width="75%" />
<p class="caption">
(#fig:figgam4)Relation non linéaire plus complexe
</p>
</div>
</div>
<div id="sect1112" class="section level3">
<h3><span class="header-section-number">11.1.2</span> Non linéarité avec des polynomiales</h3>
<p>Nous avions vu dans le chapitre sur la régression simple (section @ref(sect07511)) qu’il est possible d’utiliser des polynomiales pour ajuster des relations non linéaires. Pour rappel, il s’agit simplement d’ajouter à un modèle la variable <em>X</em> à différents exposants (<span class="math inline">\(X+X^2+\dots+X^k\)</span>). Chaque exposant supplémentaire (chaque ordre supplémentaire) permet au modèle d’ajuster une relation plus complexe. Rien de tel qu’un graphique pour illustrer le tout (figure @ref(fig:figgam5)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam5-1.png" alt="Visualisation de plusieurs polynomiales" width="70%" />
<p class="caption">
(#fig:figgam5)Visualisation de plusieurs polynomiales
</p>
</div>
<p>L’enjeu est de sélectionner le bon nombre de degrés de la polynomiale pour le modèle. Chaque degré supplémentaire constitue une nouvelle variable dans le modèle et donc un paramètre supplémentaire. Un trop faible nombre de degrés produit des courbes trop simplistes alors qu’un nombre trop élevé conduit à un surajustement (<em>overfitting</em> en anglais) du modèle. La figure @ref(fig:figgam6) illustre ces deux situations.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam6-1.png" alt="Sur et sous-ajustement d'une polynomiale" width="70%" />
<p class="caption">
(#fig:figgam6)Sur et sous-ajustement d’une polynomiale
</p>
</div>
<p>Un des problèmes inhérents à l’approche des polynomiales est la difficulté d’interprétation. En effet, les coefficients ne sont pas directement interprétables et seule une figure représentant les prédictions du modèle permet d’avoir une idée de l’impact de la variable <em>X</em> sur la variable <em>Y</em>.</p>
</div>
<div id="sect1113" class="section level3">
<h3><span class="header-section-number">11.1.3</span> Non linéarité par segments</h3>
<p>Un compromis intéressant offrant une interprétation simple et une relation potentiellement complexe consiste à découper la variable <em>X</em> en segments, puis d’ajuster un coefficient pour chacun de ces segments. Nous obtenons ainsi une ligne brisée et des coefficients faciles à interpréter (figure @ref(fig:figgam7)). Nous ne présentons pas d’exemple d’application dans R, mais sachez que le <em>package</em> <code>segmented</code> permets d’ajuster ce type de modèle.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam7-1.png" alt="Régression par segment" width="70%" />
<p class="caption">
(#fig:figgam7)Régression par segment
</p>
</div>
<p>L’enjeu est alors de déterminer le nombre de points et la localisation de points de rupture. L’inconvénient majeur de cette approche est qu’en réalité, peu de phénomènes sont marqués par des ruptures très nettes.</p>
<p>À la figure @ref(fig:figgam7), nous avons divisé la variable <em>X</em> en trois segments (<span class="math inline">\(k_1\)</span>, <span class="math inline">\(k_2\)</span> et <span class="math inline">\(k_3\)</span>), définis respectivement avec les intervalles suivants : [0,00-0,22], [0,22-0,41] et [0,41-1,00]. Concrètement, cela revient à diviser la variable <em>X</em> en trois nouvelles variables <span class="math inline">\(X_{k1}\)</span>, <span class="math inline">\(X_{k2}\)</span>, et <span class="math inline">\(X_{k3}\)</span>. La valeur de <span class="math inline">\(X_{ik}\)</span> est égale à <span class="math inline">\(x_i\)</span> si <span class="math inline">\(x_i\)</span> se trouve dans l’intervalle propre à <em>k</em>, et 0 autrement. Ici, nous obtenons trois coefficients :</p>
<ul>
<li>le premier est positif, une augmentation de <em>X</em> sur le premier segment est associée à une augmentation de <em>Y</em>;</li>
<li>le second est négatif, une augmentation de <em>X</em> sur le second segment est associée à une diminution de <em>Y</em>;</li>
<li>le troisième est aussi négatif, une augmentation de <em>X</em> sur le troisième segment est associée à une diminution de <em>Y</em>, mais moins forte que pour le second segment.</li>
</ul>
</div>
<div id="sect1114" class="section level3">
<h3><span class="header-section-number">11.1.4</span> Non linéarité avec des <em>splines</em></h3>
<p>La dernière approche, et certainement la plus flexible, est d’utiliser ce que l’on appelle une <em>spline</em> pour capter des relations non linéaires. Une <em>spline</em> est une fonction créant des variables supplémentaires à partir d’une variable <em>X</em> et d’une fonction de base. Ces variables supplémentaires appelées bases (<em>basis</em> en anglais) sont ajoutées au modèle; la sommation de leurs valeurs multipliées par leurs coefficients permet de capter les relations non linéaires entre une variable dépendante et une variable indépendante. Le nombre de bases, ainsi que leur localisation (plus souvent appelé nœuds) permettent de contrôler la complexité de la fonction non linéaire.</p>
<p>Prenons un premier exemple simple avec une fonction de base triangulaire (<em>tent basis</em> en anglais). Nous créons ici une <em>spline</em> avec sept nœuds répartis équitablement sur l’intervalle de valeurs de la variable <em>X</em>. Les sept bases qui en résultent sont présentées à la figure @ref(fig:figgam8). Dans cette figure, chaque sommet d’un triangle correspond à un nœud et chaque triangle correspond à une base.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam8-1.png" alt="Bases de la spline triangulaire" width="70%" />
<p class="caption">
(#fig:figgam8)Bases de la spline triangulaire
</p>
</div>
<p>En ajoutant ces bases dans notre modèle de régression, nous pouvons ajuster un coefficient pour chacune et le représenter en multipliant ces bases par les coefficients obtenus avec une simple régression linéaire (figure @ref(fig:figgam9)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam9-1.png" alt="Spline triangulaire multipliée par ces coefficients" width="70%" />
<p class="caption">
(#fig:figgam9)Spline triangulaire multipliée par ces coefficients
</p>
</div>
<p>Nous remarquons ainsi que les bases correspondant à des valeurs plus fortes de <em>Y</em> ont reçu des coefficients plus élevés. Pour reconstituer la fonction non linéaire, il suffit d’additionner ces bases multipliées par leurs coefficients, soit la ligne bleue à la figure @ref(fig:figgam10).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam10-1.png" alt="Spline triangulaire" width="70%" />
<p class="caption">
(#fig:figgam10)Spline triangulaire
</p>
</div>
<p>La fonction de base triangulaire est intéressante pour présenter la logique qui sous-tend les <em>splines</em>, mais elle est rarement utilisée en pratique. On lui préfère généralement d’autre formes donnant des résultats plus lisses comme les <em>B-spline</em> quadratiques, <em>B-spline</em> cubiques, <em>M-spline</em>, <em>Duchon spline</em>, etc.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam11-1.png" alt="Comparaison de différentes bases" width="75%" />
<p class="caption">
(#fig:figgam11)Comparaison de différentes bases
</p>
</div>
<p>Les approches que nous venons de décrire sont regroupées sous l’appellation de modèles additifs. Dans les prochaines sous-sections, nous nous concentrons davantage sur les <em>splines</em> du fait de leur plus grande flexibilité.</p>
</div>
</div>
<div id="sect112" class="section level2">
<h2><span class="header-section-number">11.2</span> <em>Spline</em> de régression et <em>spline</em> de lissage</h2>
<p>Dans les exemples précédents, nous avons vu que la construction d’une <em>spline</em> nécessite d’effectuer deux choix importants : le nombre de nœuds et leur localisation. Un trop grand nombre de nœuds conduit à un surajustement du modèle alors qu’un trop faible nombre de nœuds conduit à un sous-ajustement. Lorsque ces choix sont effectués par l’utilisateur et que les bases sont ajoutées manuellement dans le modèle tel que décrit précédemment, nous parlons alors de <strong>splines de régression</strong> (<em>Regression Spline</em> en anglais).</p>
<p>Une approche a été proposée pour faciliter le choix du nombre de nœuds il s’agit de <strong>splines de lissage</strong> (<em>smoothing spline</em> en anglais). L’idée derrière cette approche est d’introduire dans le modèle une pénalisation associée avec le nombre de nœuds (ou degré de liberté) de la <em>spline</em>, dans un souci de parcimonie : chaque noeud supplémentaire doit suffisamment contribuer au modèle pour être conservé. Il n’est pas nécessaire ici de rentrer dans le détail mathématique de cette pénalisation qui est un peu complexe. Retenez simplement qu’elle dépend d’un paramètre appelé <span class="math inline">\(\lambda\)</span> :</p>
<ul>
<li>plus <span class="math inline">\(\lambda\)</span> tend vers 0, plus la pénalisation est faible et plus la <em>spline</em> de lissage devient une simple <em>spline</em> de régression;</li>
<li>à l’inverse, plus elle est forte, plus la pénalité est importante, au point que la <em>spline</em> peut se résumer à une simple ligne droite.</li>
</ul>
<p>Cela est illustré à la figure @ref(fig:figgam12) comprenant trois <em>splines</em> avec 20 nœuds et des valeurs <span class="math inline">\(\lambda\)</span> différentes contrôlant la force de la pénalité.</p>
<p>Bien évidemment, nous constatons qu’avec la <em>spline</em> de régression (non pénalisée), 20 nœuds conduisent à un fort surajustement du modèle. En revanche, les <em>splines</em> de lissage (pénalisées) permettent de corriger ce problème de surajustement. Toutefois, une valeur trop importante de <span class="math inline">\(\lambda\)</span> conduit à un sous-ajustement du modèle (ici <span class="math inline">\(\lambda = 3\)</span> et <span class="math inline">\(\lambda = 100\)</span>, lignes verte et bleue).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam12-1.png" alt="Pénalisation des splines" width="70%" />
<p class="caption">
(#fig:figgam12)Pénalisation des splines
</p>
</div>
<p>Avec les <em>splines</em> de lissage, l’enjeu est alors de sélectionner une valeur optimale de <span class="math inline">\(\lambda\)</span>. Le plus souvent, les <em>packages</em> R <strong>estiment eux-mêmes</strong> ce paramètre à partir des données utilisées dans le modèle. Toutefois, gardez en mémoire que vous pouvez modifier ce paramètre. Mentionnons également que les <em>splines</em> de lissage peuvent être reparamétrées dans un modèle pour être intégrées comme des effets aléatoires. Dans ce cas-ci, <span class="math inline">\(\lambda\)</span> est remplacé par un simple paramètre de variance directement estimé dans le modèle <span class="citation">(Wood <a href="#ref-wood2004stable" role="doc-biblioref">2004</a>)</span>.</p>
</div>
<div id="sect113" class="section level2">
<h2><span class="header-section-number">11.3</span> Interprétation d’une <em>spline</em></h2>
<p>L’interprétation d’une <em>spline</em> se fait à l’aide de graphiques. En effet, puisqu’elle est composée d’un ensemble de coefficients appliqués à des bases, il est difficile d’interpréter directement ces derniers. Nous préférons alors représenter la fonction obtenue à l’aide d’un graphique, illustrant son <strong>effet marginal</strong>. Ce graphique est construit en trois étapes :</p>
<ol style="list-style-type: decimal">
<li>créer un jeu de données fictif dans lequel l’ensemble des variables indépendantes sont fixées à leurs moyennes respectives, sauf la variable pour laquelle nous souhaitons représenter la <em>spline</em>. Pour cette dernière, un ensemble de valeurs allant de son minimum à son maximum est utilisé;</li>
<li>utiliser le modèle pour prédire les valeurs attendues de la variable dépendante pour chacune des observations fictives ainsi créées;</li>
<li>afficher les prédictions obtenues dans un graphique.</li>
</ol>
<p>Notez ici qu’un graphique des effets marginaux se base sur les prédictions du modèle. Si un modèle est mal ajusté, les prédictions ne seront pas fiables et il sera inutile d’interpréter la <em>spline</em> obtenue.</p>
<p>Il est aussi possible dans le cas des <em>splines</em> de lissage, d’interpréter les <em>estimated degrees of freedom</em> (EDF) qui constituent une approximation du nombre de noeuds de la <em>spline</em>. S’ils ne nous renseignent pas sur la forme de la <em>spline</em>, ils nous indiquent son niveau de complexité. Une <em>spline</em> avec un EDF de 1 est en réalité un simple terme linéaire. Plus l’EDF augmente, plus la <em>spline</em> est complexe.</p>
</div>
<div id="sect114" class="section level2">
<h2><span class="header-section-number">11.4</span> Multicolinéarité non linéaire</h2>
<p>Lorsque des <em>splines</em> sont ajoutées dans un modèle, il est nécessaire de vérifier si ces dernières ne posent pas un problème de multicolinéarité. Cependant, le VIF ne peut plus être utilisé du fait de la non-linéarité des relations modélisées. Il est alors nécessaire d’utiliser une autre mesure : la <em>concurvité</em> (<em>concurvity</em>) permettant de mesurer sur une échelle allant de 0 à 1 à quel point deux <em>splines</em> ont en réalité capturé le même effet et se substituent l’une à l’autre. Une valeur de 0 indique une absence totale de concurvité alors qu’une valeur de 1 indique que deux <em>splines</em> sont rigoureusement identiques (modèle non identifiable).</p>
</div>
<div id="sect115" class="section level2">
<h2><span class="header-section-number">11.5</span> Aller plus loin avec les <em>splines</em></h2>
<p>Jusqu’ici nous avons seulement présenté le cas le plus simple pour lequel une <em>spline</em> est construite à partir d’une seule variable dépendante continue, mais elles peuvent être utilisées dans de nombreux autres contextes et ont une incroyable flexibilité. Nous détaillons ici trois exemples fréquents : les <em>splines</em> cycliques, les <em>splines</em> variant par groupe et les splines multivariées. Pour une description complète des effets non linéaires possibles avec <strong>mgcv</strong>, n’hésitez pas à consulter sa <a href="https://stat.ethz.ch/R-manual/R-patched/library/mgcv/html/smooth.terms.html">documentation</a>.</p>
<table>
<caption>
(#tab:exemplesplines)Exemples de splines avancées
</caption>
<thead>
<tr>
<th>
Type
</th>
<th>
Code
</th>
<th>
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
spline cyclique
</td>
<td>
<code>s(x, bs = 'cc')</code>
</td>
<td>
Une spline cyclique doit être utilisée si le 0 de la variable X correspond également à sa valeur maximum. Un bon exemple est le temps dans une journée car 24 h est équivalent à 0 h
</td>
</tr>
<tr>
<td>
spline variant par groupe
</td>
<td>
<code>s(x, by = x2)</code>
</td>
<td>
Une spline variant par groupe permet d’ajuster une spline à une variable X1 différente pour chaque groupe identifié par une variable qualitative X2
</td>
</tr>
<tr>
<td>
spline bivariée
</td>
<td>
<code>s(x1,x2)</code>
</td>
<td>
Une spline bivariée pour modéliser l’interaction non linéaire deux variables X1 et X2 s’exprimant dans la même unité (typiquement des coordonnées géographiques carthésienne)
</td>
</tr>
<tr>
<td>
spline d’interaction complète
</td>
<td>
<code>te(x1,x2)</code>
</td>
<td>
Une spline d’interaction permet de modéliser l’interaction non linéaire de deux variables continues pouvant s’exprimer dans des unités différentes, elle combine les effets spécifique de chacune de des deux variables et leur interaction
</td>
</tr>
<tr>
<td>
spline d’interaction partielle
</td>
<td>
<code>s(x1) + s(x2) + ti(x1,x2)</code>
</td>
<td>
Une spline d’interaction partielle permet de distinguer les effets non linéaires individuels de deux variables de leur interaction non linéaire
</td>
</tr>
</tbody>
</table>
<div id="sect1151" class="section level3">
<h3><span class="header-section-number">11.5.1</span> <em>Splines</em> cycliques</h3>
<p>Une <em>spline</em> cyclique est une extension d’une <em>spline</em> classique dont les bases aux extrémités sont spécifiées de telle sorte que la valeur au départ de la <em>spline</em> soit la même que celle à la fin de la <em>spline</em>. Ceci permet à la <em>spline</em> de former une boucle ce qui est particulièrement intéressant pour des variables dont le 0 et la valeur maximale correspondent en réalité à la même valeur. L’exemple le plus parlant est certainement le cas d’une variable représentant la mesure d’un angle en degrés. Les valeurs de 0 et 360 sont identiques et les valeurs 350 et 10 sont toutes les deux à une distance de 10 degrés de 0. Un autre exemple possible serait de considérer l’heure comme une variable continue; dans ce cas, 24 h et 0 h signifient la même chose.</p>
<p>Prenons un exemple concret. Nous souhaitons modéliser la concentration de dioxyde d’azote (NO<sub>2</sub>) à Paris, mesurée par un ensemble de stations fixes. Nous pourrions nous attendre à ce que le NO<sub>2</sub> suive chaque jour un certain patron. Concrètement, à proximité d’axes routiers majeurs, nous nous attendrions à observer des pics suivant les flux pendulaires. À la figure @ref(fig:figgam13), nous retrouvons bien les deux pics attendus correspondant aux heures de pointe du matin et du soir. Aussi, tel qu’indiqué par la ligne rouge, la valeur prédite par la <em>spline</em> est la même à 24 h et à 0 h.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam13-1.png" alt="Spline cyclique pour modéliser la concentration de NO2" width="70%" />
<p class="caption">
(#fig:figgam13)Spline cyclique pour modéliser la concentration de NO2
</p>
</div>
</div>
<div id="sect1152" class="section level3">
<h3><span class="header-section-number">11.5.2</span> Splines par groupe</h3>
<p>Tel qu’abordé dans les chapitres précédents, il arrive régulièrement que les observations appartiennent à différents groupes. Dans ce cas de figure, nous pouvons être amené à vérifier si la relation décrite par une <em>spline</em> est identique pour chacun des groupes d’observations. Il s’agit alors d’ajuster une <em>spline</em> différente par groupe. Dans l’exemple précédent, chaque valeur de NO<sub>2</sub> a été mesurée par une station fixe de mesure spécifique. Compte tenu du fait que l’environnement autour de chaque station est particulier, nous pourrions s’attendre à ce que les valeurs de NO<sup>2</sup> ne présentent pas exactement les mêmes patrons journaliers pour chaque station.</p>
<p>À la figure @ref(fig:figgam14), il est possible de constater que le NO<sub>2</sub> suit globalement le même patron temporel pour l’ensemble des stations à l’exception de trois d’entres-elles. Il s’agit en réalité de stations situées dans des secteurs ruraux de la région parisienne et donc moins impactées par le trafic routier.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam14-1.png" alt="Spline cyclique variant par groupe" width="70%" />
<p class="caption">
(#fig:figgam14)Spline cyclique variant par groupe
</p>
</div>
</div>
<div id="sect1153" class="section level3">
<h3><span class="header-section-number">11.5.3</span> <em>Splines</em> multivariées et <em>splines</em> d’interaction</h3>
<p>Jusqu’ici nous n’avons considéré que des <em>splines</em> ne s’appliquant qu’à une seule variable indépendante; cependant, il est possible de construire des splines multivariées s’ajustant simultanément sur plusieurs variables indépendantes. L’objectif est alors de modéliser les potentielles interactions non linéaires entre les variables indépendantes combinées dans une même <em>spline</em>. Prenons un exemple concret, dans la section sur les modèles GLM, nous avions modélisé la couverture des aires de diffusion (AD) à Montréal par des îlots de chaleur. Parmi les variables indépendantes, nous avions notamment utilisé la distance au centre-ville ainsi que la part de la surface végétalisée des AD. Nous pourrions formuler l’hypothèse que ces deux variables impactent conjointement et de façon non linéaire la proportion de la surface d’îlot de chaleur dans chaque AD. Pour représenter une <em>spline</em> sur plusieurs dimensions, nous utilisons alors une carte de chaleur dont la couleur représente la valeur de la variable dépendante prédite en fonction des deux variables indépendantes.</p>
<p>Il est important de distinguer la <em>spline</em> d’<strong>interaction</strong> et la spline <strong>multivariée</strong>. La première est utilisée lorsque les variables indépendantes introduites dans la spline ne sont pas exprimées sur la même échelle et n’évoluent pas conjointement. L’exemple donné ci-dessus avec les variables de végétation et de distance au centre-ville est un exemple de <em>spline</em> d’interaction, la première variable étant exprimée en pourcentage et l’autre en mètres. De plus, ces deux variables ne sont pas conjointes, mais bien distinctes l’une de l’autre. Un cas typique où une <em>spline</em> multivariée serait à privilégier est le cas de l’ajout des coordonnées spatiales dans le modèle. L’emplacement des AD est mesuré par deux variables (coordonnées spatiales X et Y) toutes les deux exprimées en mètres évoluant conjointement, au sens où les coordonnées X n’interagissent pas avec les coordonnées Y, mais forment à elles deux un espace propre. Au-delà de la problématique de l’échelle des données, il est important de retenir que les <em>splines</em> d’interactions tendent à être davantage pénalisées que les splines <em>multivariées</em>.</p>
<p>La <em>spline</em> d’interaction représentée à la figure @ref(fig:figgam15) indique que les AD avec la plus grande proportion de leur surface couverte par des îlots de chaleur sont situés à moins de 25 kilomètres du centre-ville, au-delà de cette distance, cette proportion chute en bas de 0,1, soit 10 % de la surface de l’AD. En revanche, à proximité du centre-ville (moins d’un kilomètre), même les AD disposant d’un fort pourcentage de surface végétalisée sont tout de même marquées par un fort pourcentage de surface couverte par des îlots de chaleur.</p>
<p>Les <em>splines</em> bivariées sont fréquemment utilisées pour capturer un potentiel patron spatial dans les données. En effet, si nous disposons des coordonnées spatiales de chaque observation (<em>x,y</em>), il est possible d’ajuster une <em>spline</em> bivariée sur ces coordonnées qui contrôlera ainsi l’effet de l’espace.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam15-1.png" alt="Spline d'interaction bivariée" width="70%" />
<p class="caption">
(#fig:figgam15)Spline d’interaction bivariée
</p>
</div>
<p>Il n’y a pas de limite théorique au nombre de variables qui peuvent être ajoutées dans une <em>spline</em> d’interaction ou multivariée. Notez cependant que plus le nombre de dimensions augmente, plus la fonction à estimer est complexe et plus le volume de données nécessaire est grand et doit couvrir densément l’ensemble de l’espace d’échantillonnage multidimensionnel.</p>
</div>
</div>
<div id="sect116" class="section level2">
<h2><span class="header-section-number">11.6</span> Mise en oeuvre dans R</h2>
<p>Il est possible d’ajuster des <em>splines</em> de régression dans n’importe quel <em>package</em> permettant d’ajuster des coefficients pour un modèle de régression. Il suffit de construire les bases des <em>splines</em> en amont à l’aide du <em>package</em> <code>splines2</code> et de les ajouter directement dans l’équation de régression.
En revanche, il est nécessaire d’utiliser des <em>packages</em> spécialisés pour ajuster des <em>splines</em> de lissage. Parmi ceux-ci, <code>mgcv</code> est probablement le plus populaire du fait de sa (très) grande flexibilité, suivi des <em>packages</em> <code>gamlss</code>, <code>gam</code> et <code>VGAM.</code> Nous comparons ici les deux approches. Nous allons tenter d’améliorer le modèle que nous avions ajusté pour prédire le pourcentage de surface couverte par des îlots de chaleur dans les aires de diffusion de Montréal, dans une perspective d’équité environnementale. Pour rappel, la variable dépendante est exprimée en pourcentage et nous utilisons une distribution <em>beta</em> pour la modéliser.</p>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1049-1"><a href="#cb1049-1"></a><span class="kw">library</span>(mgcv)</span>
<span id="cb1049-2"><a href="#cb1049-2"></a><span class="co"># Chargement des données</span></span>
<span id="cb1049-3"><a href="#cb1049-3"></a>dataset &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/gam/data_chaleur.csv&quot;</span>,<span class="dt">fileEncoding =</span> <span class="st">&quot;utf8&quot;</span>)</span>
<span id="cb1049-4"><a href="#cb1049-4"></a><span class="co"># Ajustement du modèle de base</span></span>
<span id="cb1049-5"><a href="#cb1049-5"></a>refmodel &lt;-<span class="st"> </span><span class="kw">gam</span>(hot <span class="op">~</span></span>
<span id="cb1049-6"><a href="#cb1049-6"></a><span class="st">          </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb1049-7"><a href="#cb1049-7"></a><span class="st">          </span><span class="kw">poly</span>(prt_veg, <span class="dt">degree =</span> <span class="dv">2</span>)  <span class="op">+</span><span class="st"> </span>Arrond,</span>
<span id="cb1049-8"><a href="#cb1049-8"></a>        <span class="dt">data =</span> dataset, <span class="dt">family =</span> <span class="kw">betar</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>Dans notre première analyse de ces données, nous avions ajusté une polynomiale d’ordre 2 pour représenter un potentiel impact non linéaire de la végétation sur les îlots de chaleur. Nous allons à présent remplacer ce terme par une <em>spline</em> de régression en sélectionnant quatre nœuds.</p>
<div class="sourceCode" id="cb1050"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1050-1"><a href="#cb1050-1"></a><span class="kw">library</span>(splines2)</span>
<span id="cb1050-2"><a href="#cb1050-2"></a><span class="co"># Création des bases de la spline</span></span>
<span id="cb1050-3"><a href="#cb1050-3"></a>basis &lt;-<span class="st"> </span><span class="kw">bSpline</span>(<span class="dt">x =</span> dataset<span class="op">$</span>prt_veg, <span class="dt">df =</span><span class="dv">4</span>, <span class="dt">intercept =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1050-4"><a href="#cb1050-4"></a><span class="co"># Ajouter les bases au DataFrame</span></span>
<span id="cb1050-5"><a href="#cb1050-5"></a>basisdf &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(basis)</span>
<span id="cb1050-6"><a href="#cb1050-6"></a><span class="kw">names</span>(basisdf) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;spline&#39;</span>,<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(basisdf),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb1050-7"><a href="#cb1050-7"></a>dataset &lt;-<span class="st"> </span><span class="kw">cbind</span>(dataset, basisdf)</span>
<span id="cb1050-8"><a href="#cb1050-8"></a><span class="co"># Ajuster le modèle</span></span>
<span id="cb1050-9"><a href="#cb1050-9"></a>model0 &lt;-<span class="st"> </span><span class="kw">gam</span>(hot <span class="op">~</span></span>
<span id="cb1050-10"><a href="#cb1050-10"></a><span class="st">          </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb1050-11"><a href="#cb1050-11"></a><span class="st">          </span>spline1 <span class="op">+</span><span class="st"> </span>spline2 <span class="op">+</span><span class="st"> </span>spline3 <span class="op">+</span><span class="st"> </span>spline4 <span class="op">+</span><span class="st"> </span>Arrond,</span>
<span id="cb1050-12"><a href="#cb1050-12"></a>        <span class="dt">data =</span> dataset, <span class="dt">family =</span> <span class="kw">betar</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>Nous pouvons à présent ajuster une <em>spline</em> de lissage et laisser <code>mgcv</code> déterminer son niveau de complexité.</p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="#cb1051-1"></a><span class="co"># Ajustement du modèle avec une spline simple</span></span>
<span id="cb1051-2"><a href="#cb1051-2"></a>model1 &lt;-<span class="st"> </span><span class="kw">gam</span>(hot <span class="op">~</span></span>
<span id="cb1051-3"><a href="#cb1051-3"></a><span class="st">          </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb1051-4"><a href="#cb1051-4"></a><span class="st">          </span><span class="kw">s</span>(prt_veg)  <span class="op">+</span><span class="st"> </span>Arrond,</span>
<span id="cb1051-5"><a href="#cb1051-5"></a>        <span class="dt">data =</span> dataset, <span class="dt">family =</span> <span class="kw">betar</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>Notez ici que la syntaxe à employer est très simple, il suffit de spécifier <code>s(prt_veg)</code> pour indiquer à la fonction <code>gam</code> que vous souhaitez ajuster une <em>spline</em> pour la variable <code>prt_veg</code>. Nous pouvons à présent comparer l’ajustement des deux modèles en utilisant la mesure AIC.</p>
<div class="sourceCode" id="cb1052"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="#cb1052-1"></a><span class="co"># Comparaison des AIC</span></span>
<span id="cb1052-2"><a href="#cb1052-2"></a><span class="kw">AIC</span>(refmodel, model0, model1)</span></code></pre></div>
<pre><code>##                df       AIC
## refmodel 40.00000 -6399.784
## model0   42.00000 -6419.630
## model1   44.61065 -6417.562</code></pre>
<p>Nous constatons que la valeur d’AIC du second modèle est plus réduite, indiquant un meilleur ajustement du modèle avec une <em>spline</em> de régression. Notons cependant que la différence avec la <em>spline</em> de lissage est anecdotique (deux points d’AIC) et que nous connaissions a priori le bon nombre de nœuds à utiliser. Pour des relations plus complexes, les <em>splines</em> de lissage ont tendance à nettement mieux performer. Voyons à présent comment représenter ces trois termes non linéaires.</p>
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1054-1"><a href="#cb1054-1"></a><span class="co"># Création d&#39;un DataFrame de prédiction dans lequel seule</span></span>
<span id="cb1054-2"><a href="#cb1054-2"></a><span class="co"># la variable prt_veg varie.</span></span>
<span id="cb1054-3"><a href="#cb1054-3"></a>dfpred &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1054-4"><a href="#cb1054-4"></a>  <span class="dt">prt_veg =</span> <span class="kw">seq</span>(<span class="kw">min</span>(dataset<span class="op">$</span>prt_veg), <span class="kw">max</span>(dataset<span class="op">$</span>prt_veg), <span class="fl">0.5</span>),</span>
<span id="cb1054-5"><a href="#cb1054-5"></a>  <span class="dt">A65Pct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>A65Pct),</span>
<span id="cb1054-6"><a href="#cb1054-6"></a>  <span class="dt">A014Pct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>A014Pct),</span>
<span id="cb1054-7"><a href="#cb1054-7"></a>  <span class="dt">PopFRPct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>PopFRPct),</span>
<span id="cb1054-8"><a href="#cb1054-8"></a>  <span class="dt">PopMVPct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>PopMVPct),</span>
<span id="cb1054-9"><a href="#cb1054-9"></a>  <span class="dt">Arrond =</span> <span class="st">&quot;Verdun&quot;</span></span>
<span id="cb1054-10"><a href="#cb1054-10"></a>)</span>
<span id="cb1054-11"><a href="#cb1054-11"></a></span>
<span id="cb1054-12"><a href="#cb1054-12"></a><span class="co"># Recréation des bases de la spline de régression</span></span>
<span id="cb1054-13"><a href="#cb1054-13"></a><span class="co"># pour les nouvelles observations</span></span>
<span id="cb1054-14"><a href="#cb1054-14"></a>nvl_bases &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">predict</span>(basis,<span class="dt">newx =</span> dfpred<span class="op">$</span>prt_veg))</span>
<span id="cb1054-15"><a href="#cb1054-15"></a><span class="kw">names</span>(nvl_bases) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;spline&#39;</span>,<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(basisdf),<span class="dt">sep=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb1054-16"><a href="#cb1054-16"></a>dfpred &lt;-<span class="st"> </span><span class="kw">cbind</span>(dfpred, nvl_bases)</span>
<span id="cb1054-17"><a href="#cb1054-17"></a></span>
<span id="cb1054-18"><a href="#cb1054-18"></a><span class="co"># Définition de la fonction inv.logit, soit l&#39;inverse de la fonction </span></span>
<span id="cb1054-19"><a href="#cb1054-19"></a><span class="co"># de lien du modèle pour retrouver les prédictions dans l&#39;échelle </span></span>
<span id="cb1054-20"><a href="#cb1054-20"></a><span class="co"># originales des données</span></span>
<span id="cb1054-21"><a href="#cb1054-21"></a>inv.logit &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">exp</span>(x)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(x))}</span>
<span id="cb1054-22"><a href="#cb1054-22"></a></span>
<span id="cb1054-23"><a href="#cb1054-23"></a><span class="co"># Utilisation des deux modèles pour effectuer les prédictions</span></span>
<span id="cb1054-24"><a href="#cb1054-24"></a>predref &lt;-<span class="st"> </span><span class="kw">predict</span>(refmodel, <span class="dt">newdata =</span> dfpred, <span class="dt">type =</span> <span class="st">&#39;link&#39;</span>, <span class="dt">se.fit =</span> T)</span>
<span id="cb1054-25"><a href="#cb1054-25"></a>predmod0 &lt;-<span class="st"> </span><span class="kw">predict</span>(model0, <span class="dt">newdata =</span> dfpred, <span class="dt">type =</span> <span class="st">&#39;link&#39;</span>, <span class="dt">se.fit =</span> T)</span>
<span id="cb1054-26"><a href="#cb1054-26"></a>predmod1 &lt;-<span class="st"> </span><span class="kw">predict</span>(model1, <span class="dt">newdata =</span> dfpred, <span class="dt">type =</span> <span class="st">&#39;link&#39;</span>, <span class="dt">se.fit =</span> T)</span>
<span id="cb1054-27"><a href="#cb1054-27"></a></span>
<span id="cb1054-28"><a href="#cb1054-28"></a><span class="co"># Calcul de la valeur prédite et construction des intervalles de confiance</span></span>
<span id="cb1054-29"><a href="#cb1054-29"></a>dfpred<span class="op">$</span>polypred &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(predref<span class="op">$</span>fit)</span>
<span id="cb1054-30"><a href="#cb1054-30"></a>dfpred<span class="op">$</span>poly025 &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(predref<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>predref<span class="op">$</span>se.fit)</span>
<span id="cb1054-31"><a href="#cb1054-31"></a>dfpred<span class="op">$</span>poly975 &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(predref<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>predref<span class="op">$</span>se.fit)</span>
<span id="cb1054-32"><a href="#cb1054-32"></a></span>
<span id="cb1054-33"><a href="#cb1054-33"></a>dfpred<span class="op">$</span>regsplinepred &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(predmod0<span class="op">$</span>fit)</span>
<span id="cb1054-34"><a href="#cb1054-34"></a>dfpred<span class="op">$</span>regspline025 &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(predmod0<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>predmod0<span class="op">$</span>se.fit)</span>
<span id="cb1054-35"><a href="#cb1054-35"></a>dfpred<span class="op">$</span>regspline975 &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(predmod0<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>predmod0<span class="op">$</span>se.fit)</span>
<span id="cb1054-36"><a href="#cb1054-36"></a></span>
<span id="cb1054-37"><a href="#cb1054-37"></a>dfpred<span class="op">$</span>splinepred &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(predmod1<span class="op">$</span>fit)</span>
<span id="cb1054-38"><a href="#cb1054-38"></a>dfpred<span class="op">$</span>spline025 &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(predmod1<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>predmod1<span class="op">$</span>se.fit)</span>
<span id="cb1054-39"><a href="#cb1054-39"></a>dfpred<span class="op">$</span>spline975 &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(predmod1<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>predmod1<span class="op">$</span>se.fit)</span>
<span id="cb1054-40"><a href="#cb1054-40"></a></span>
<span id="cb1054-41"><a href="#cb1054-41"></a><span class="co"># Créer un graphique pour afficher les résultats</span></span>
<span id="cb1054-42"><a href="#cb1054-42"></a><span class="kw">ggplot</span>(dfpred) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1054-43"><a href="#cb1054-43"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg, <span class="dt">ymin =</span> poly025, <span class="dt">ymax =</span> poly975),</span>
<span id="cb1054-44"><a href="#cb1054-44"></a>              <span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">color =</span> <span class="st">&#39;grey&#39;</span>) <span class="op">+</span></span>
<span id="cb1054-45"><a href="#cb1054-45"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg, <span class="dt">ymin =</span> spline025, <span class="dt">ymax =</span> spline975),</span>
<span id="cb1054-46"><a href="#cb1054-46"></a>              <span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">color =</span> <span class="st">&#39;grey&#39;</span>) <span class="op">+</span></span>
<span id="cb1054-47"><a href="#cb1054-47"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prt_veg, <span class="dt">ymin =</span> regspline025, <span class="dt">ymax =</span> regspline975),</span>
<span id="cb1054-48"><a href="#cb1054-48"></a>              <span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">color =</span> <span class="st">&#39;grey&#39;</span>) <span class="op">+</span></span>
<span id="cb1054-49"><a href="#cb1054-49"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> polypred, <span class="dt">x =</span> prt_veg, <span class="dt">color =</span> <span class="st">&#39;polynomiale&#39;</span>),</span>
<span id="cb1054-50"><a href="#cb1054-50"></a>            <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1054-51"><a href="#cb1054-51"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> regsplinepred, <span class="dt">x =</span> prt_veg, <span class="dt">color =</span> <span class="st">&#39;spline de régression&#39;</span>),</span>
<span id="cb1054-52"><a href="#cb1054-52"></a>            <span class="dt">size =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb1054-53"><a href="#cb1054-53"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> splinepred, <span class="dt">x =</span> prt_veg, <span class="dt">color =</span> <span class="st">&#39;spline de lissage&#39;</span>),</span>
<span id="cb1054-54"><a href="#cb1054-54"></a>            <span class="dt">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam16-1.png" alt="Comparaison d'une spline et d'une polynomiale" width="75%" />
<p class="caption">
(#fig:figgam16)Comparaison d’une spline et d’une polynomiale
</p>
</div>
<p>Nous constatons que les trois termes renvoient des prédictions très similaires et qu’une légère différence n’est observable que pour les secteurs avec les plus hauts niveaux de végétation (supérieurs à 75 %).</p>
<p>Jusqu’ici, nous utilisions l’arrondissement dans lequel est comprise chaque aire de diffusion comme une variable nominale afin de capturer la dimension spatiale du jeu de données. Puisque nous avons abordé la notion de <em>splines</em> bivariées, il serait certainement plus efficace d’en construire une à partir des coordonnées géographiques (x,y) des centroïdes des aires de diffusion. En effet, il est plus probable que la distribution des îlots de chaleur suive un patron spatial continu sur le territoire plutôt que les délimitations arbitraires des arrondissements.</p>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1055-1"><a href="#cb1055-1"></a><span class="co"># Ajustement du modèle avec une spline bivariée pour l&#39;espace</span></span>
<span id="cb1055-2"><a href="#cb1055-2"></a>model2 &lt;-<span class="st"> </span><span class="kw">gam</span>(hot <span class="op">~</span></span>
<span id="cb1055-3"><a href="#cb1055-3"></a><span class="st">          </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb1055-4"><a href="#cb1055-4"></a><span class="st">          </span><span class="kw">s</span>(prt_veg)  <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(X,Y),</span>
<span id="cb1055-5"><a href="#cb1055-5"></a>        <span class="dt">data =</span> dataset, <span class="dt">family =</span> <span class="kw">betar</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>Notez ici que l’expression <code>s(X,Y)</code> permet de créer une <em>spline</em> bivariée à partir des coordonnées (<em>X,Y</em>), soit deux colonnes présentes dans le jeu de données. Ces coordonnées sont exprimées toutes deux en mètres et n’interagissent pas ensemble au sens strict, nous devons donc ajuster une <em>spline</em> bivariée. Si vous avez besoin d’ajuster une <em>spline</em> d’interaction (notamment quand les variables sont dans des unités différentes), il est nécessaire d’utiliser une autre syntaxe <code>te(X,Y)</code> ou <code>t2(X,Y)</code> faisant appel à une structure mathématique légèrement différente, soit des <em>tensor product smooths</em>.</p>
<p>Puisque notre modèle intègre deux <em>splines</em>, nous devons nous assurer que nous n’avons pas de problème de concurvité, ce que nous pouvons faire avec la fonction <code>concurvity</code> du <em>package</em> <code>mgcv</code>.</p>
<div class="sourceCode" id="cb1056"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1056-1"><a href="#cb1056-1"></a>values &lt;-<span class="st"> </span><span class="kw">concurvity</span>(model2, <span class="dt">full =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1056-2"><a href="#cb1056-2"></a></span>
<span id="cb1056-3"><a href="#cb1056-3"></a><span class="co"># Worst, estimation pessimiste de la concurvité</span></span>
<span id="cb1056-4"><a href="#cb1056-4"></a><span class="kw">round</span>(values<span class="op">$</span>worst,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##            para s(prt_veg) s(X,Y)
## para          1      0.000  0.000
## s(prt_veg)    0      1.000  0.458
## s(X,Y)        0      0.458  1.000</code></pre>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1058-1"><a href="#cb1058-1"></a><span class="co"># Observed, estimation optimiste de la concurvité</span></span>
<span id="cb1058-2"><a href="#cb1058-2"></a><span class="kw">round</span>(values<span class="op">$</span>observed,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##            para s(prt_veg) s(X,Y)
## para          1      0.000  0.000
## s(prt_veg)    0      1.000  0.154
## s(X,Y)        0      0.403  1.000</code></pre>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="#cb1060-1"></a><span class="co"># Estimate, estimation entre deux de la concurvité</span></span>
<span id="cb1060-2"><a href="#cb1060-2"></a><span class="kw">round</span>(values<span class="op">$</span>estimate,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##            para s(prt_veg) s(X,Y)
## para          1      0.000  0.000
## s(prt_veg)    0      1.000  0.142
## s(X,Y)        0      0.358  1.000</code></pre>
<p>Nous pouvons ainsi constater des niveaux de concurvité tout à fait acceptables dans notre modèle. Des valeurs supérieures à 0,8 devraient être considérées comme alarmantes, surtout si elles sont reportées pour <code>observed</code> et <code>estimate</code>.</p>
<p>Voyons désormais, le résumé d’un modèle GAM tel que présenté dans R.</p>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="#cb1062-1"></a><span class="kw">summary</span>(model2)</span></code></pre></div>
<pre><code>## 
## Family: Beta regression(15.469) 
## Link function: logit 
## 
## Formula:
## hot ~ A65Pct + A014Pct + PopFRPct + PopMVPct + s(prt_veg) + s(X, 
##     Y)
## 
## Parametric coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -0.6050031  0.0645191  -9.377  &lt; 2e-16 ***
## A65Pct       0.0027671  0.0014072   1.966   0.0493 *  
## A014Pct     -0.0019040  0.0027674  -0.688   0.4914    
## PopFRPct     0.0095992  0.0014323   6.702 2.06e-11 ***
## PopMVPct     0.0010113  0.0008159   1.239   0.2152    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##              edf Ref.df Chi.sq p-value    
## s(prt_veg)  6.38  7.565   6731  &lt;2e-16 ***
## s(X,Y)     27.10 28.764   1349  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.891   Deviance explained = 90.8%
## -REML = -3234.3  Scale est. = 1         n = 3157</code></pre>
<p>La première partie du résumé comprend les résultats pour les effets fixes et linéaires du modèle. Ils s’interprètent comme pour ceux d’un GLM classique. La seconde partie présente les résultats pour les termes non linéaires. La valeur de <em>p</em> permet de déterminer si la <em>spline</em> a ou non un effet différent de 0. Une valeur non significative indique que la <em>spline</em> ne contribue pas au modèle. Les colonnes <em>edf</em> et <em>Ref.df</em> indiquent la complexité de la <em>spline</em> et peuvent être considérées comme une approximation du nombre de nœuds. Dans notre cas, la <em>spline</em> spatiale (<code>s(X,Y)</code>) est environ 5 fois plus complexe que la <em>spline</em> ajustée pour la végétation (<code>s(prt_veg)</code>). Cela n’est pas surprenant puisque la dimension spatiale (<em>spline</em> bivariée) du phénomène est certainement plus complexe que l’impact de la végétation. Notez ici que des valeurs <em>edf</em> et <em>Ref.df</em> proche de 1 signaleraient que l’impact d’un prédicteur est essentiellement linéaire et qu’il n’est pas nécessaire de recourir une <em>spline</em> pour cette variable.</p>
<p>La dernière partie du résumé comprend deux indicateurs de qualité d’ajustement, soit le R<sup>2</sup> ajusté et la part de la déviance expliquée.</p>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1064-1"><a href="#cb1064-1"></a><span class="kw">AIC</span>(refmodel, model1, model2)</span></code></pre></div>
<pre><code>##                df       AIC
## refmodel 40.00000 -6399.784
## model1   44.61065 -6417.562
## model2   40.06053 -6596.884</code></pre>
<p>Nous pouvons constater que le fait d’introduire la <em>spline</em> spatiale dans le modèle contribue à réduire encore la valeur de l’AIC et donc à améliorer le modèle. À ce stade, nous pourrions tenter de forcer la <em>spline</em> à être plus complexe en augmentant le nombre de nœuds.</p>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1066-1"><a href="#cb1066-1"></a><span class="co"># Augmentation de la complexité de la spline spatiale</span></span>
<span id="cb1066-2"><a href="#cb1066-2"></a>model3 &lt;-<span class="st"> </span><span class="kw">gam</span>(hot <span class="op">~</span></span>
<span id="cb1066-3"><a href="#cb1066-3"></a><span class="st">          </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb1066-4"><a href="#cb1066-4"></a><span class="st">          </span><span class="kw">s</span>(prt_veg)  <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(X,Y,<span class="dt">k =</span> <span class="dv">40</span>),</span>
<span id="cb1066-5"><a href="#cb1066-5"></a>        <span class="dt">data =</span> dataset, <span class="dt">family =</span> <span class="kw">betar</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb1066-6"><a href="#cb1066-6"></a></span>
<span id="cb1066-7"><a href="#cb1066-7"></a><span class="kw">AIC</span>(refmodel, model1, model2, model3)</span></code></pre></div>
<pre><code>##                df       AIC
## refmodel 40.00000 -6399.784
## model1   44.61065 -6417.562
## model2   40.06053 -6596.884
## model3   48.28633 -6639.955</code></pre>
<p>Cela a pour effet d’améliorer de nouveau le modèle. Pour vérifier si l’augmentation du nombre nœuds est judicieuse, il est possible de représenter le résultat des deux <em>splines</em> précédentes. Pour ce faire, nous proposons de calculer les valeurs prédites de la <em>spline</em> pour chaque localisation dans notre terrain d’étude, en le découpant préalablement en pixels de 100 de côté. Pour cette prédiction, nous maintenons toutes les autres variables à leur moyenne respective afin d’évaluer uniquement l’effet de la <em>spline</em> spatiale.</p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1068-1"><a href="#cb1068-1"></a><span class="kw">library</span>(viridis)</span>
<span id="cb1068-2"><a href="#cb1068-2"></a><span class="kw">library</span>(metR) <span class="co"># pour placer des étiquettes sur les isolignes</span></span>
<span id="cb1068-3"><a href="#cb1068-3"></a></span>
<span id="cb1068-4"><a href="#cb1068-4"></a><span class="co"># Création d&#39;un DataFrame fictif pour les prédictions</span></span>
<span id="cb1068-5"><a href="#cb1068-5"></a>dfpred &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(</span>
<span id="cb1068-6"><a href="#cb1068-6"></a>  <span class="dt">prt_veg =</span><span class="kw">mean</span>(dataset<span class="op">$</span>prt_veg),</span>
<span id="cb1068-7"><a href="#cb1068-7"></a>  <span class="dt">A65Pct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>A65Pct),</span>
<span id="cb1068-8"><a href="#cb1068-8"></a>  <span class="dt">A014Pct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>A014Pct),</span>
<span id="cb1068-9"><a href="#cb1068-9"></a>  <span class="dt">PopFRPct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>PopFRPct),</span>
<span id="cb1068-10"><a href="#cb1068-10"></a>  <span class="dt">PopMVPct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>PopMVPct),</span>
<span id="cb1068-11"><a href="#cb1068-11"></a>  <span class="dt">X =</span> <span class="kw">seq</span>(<span class="kw">min</span>(dataset<span class="op">$</span>X),<span class="kw">max</span>(dataset<span class="op">$</span>X),<span class="dv">100</span>),</span>
<span id="cb1068-12"><a href="#cb1068-12"></a>  <span class="dt">Y =</span> <span class="kw">seq</span>(<span class="kw">min</span>(dataset<span class="op">$</span>Y),<span class="kw">max</span>(dataset<span class="op">$</span>Y),<span class="dv">100</span>)</span>
<span id="cb1068-13"><a href="#cb1068-13"></a>)</span>
<span id="cb1068-14"><a href="#cb1068-14"></a></span>
<span id="cb1068-15"><a href="#cb1068-15"></a>dfpred<span class="op">$</span>predicted1 &lt;-<span class="st"> </span><span class="kw">predict</span>(model2, <span class="dt">newdata =</span> dfpred, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>)</span>
<span id="cb1068-16"><a href="#cb1068-16"></a>dfpred<span class="op">$</span>predicted2 &lt;-<span class="st"> </span><span class="kw">predict</span>(model3, <span class="dt">newdata =</span> dfpred, <span class="dt">type =</span> <span class="st">&#39;response&#39;</span>)</span>
<span id="cb1068-17"><a href="#cb1068-17"></a></span>
<span id="cb1068-18"><a href="#cb1068-18"></a><span class="co"># Centrage des prédictions</span></span>
<span id="cb1068-19"><a href="#cb1068-19"></a>dfpred<span class="op">$</span>predicted1 &lt;-<span class="st"> </span>dfpred<span class="op">$</span>predicted1 <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(dfpred<span class="op">$</span>predicted1)</span>
<span id="cb1068-20"><a href="#cb1068-20"></a>dfpred<span class="op">$</span>predicted2 &lt;-<span class="st"> </span>dfpred<span class="op">$</span>predicted2 <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(dfpred<span class="op">$</span>predicted2)</span>
<span id="cb1068-21"><a href="#cb1068-21"></a></span>
<span id="cb1068-22"><a href="#cb1068-22"></a><span class="co"># Représentation des splines</span></span>
<span id="cb1068-23"><a href="#cb1068-23"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dfpred) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1068-24"><a href="#cb1068-24"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y, <span class="dt">fill =</span> predicted1)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1068-25"><a href="#cb1068-25"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y),</span>
<span id="cb1068-26"><a href="#cb1068-26"></a>             <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb1068-27"><a href="#cb1068-27"></a>             <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">data =</span> dataset)<span class="op">+</span></span>
<span id="cb1068-28"><a href="#cb1068-28"></a><span class="st">  </span><span class="kw">geom_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y, <span class="dt">z =</span> predicted1),<span class="dt">binwidth =</span> <span class="fl">0.1</span>, </span>
<span id="cb1068-29"><a href="#cb1068-29"></a>               <span class="dt">color =</span> <span class="st">&#39;white&#39;</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1068-30"><a href="#cb1068-30"></a><span class="st">  </span><span class="kw">geom_text_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y, <span class="dt">z =</span> predicted1), </span>
<span id="cb1068-31"><a href="#cb1068-31"></a>                    <span class="dt">color =</span> <span class="st">&#39;white&#39;</span>, <span class="dt">binwidth =</span> <span class="fl">0.1</span>)<span class="op">+</span></span>
<span id="cb1068-32"><a href="#cb1068-32"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>() <span class="op">+</span></span>
<span id="cb1068-33"><a href="#cb1068-33"></a><span class="st">  </span><span class="kw">coord_cartesian</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1068-34"><a href="#cb1068-34"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title=</span> <span class="kw">element_blank</span>(),</span>
<span id="cb1068-35"><a href="#cb1068-35"></a>        <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb1068-36"><a href="#cb1068-36"></a>        <span class="dt">axis.ticks =</span>  <span class="kw">element_blank</span>()</span>
<span id="cb1068-37"><a href="#cb1068-37"></a>        ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1068-38"><a href="#cb1068-38"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&#39;spline de base&#39;</span>, <span class="dt">fill =</span> <span class="st">&quot;prédictions&quot;</span>)</span>
<span id="cb1068-39"><a href="#cb1068-39"></a></span>
<span id="cb1068-40"><a href="#cb1068-40"></a>plot2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dfpred) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1068-41"><a href="#cb1068-41"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y, <span class="dt">fill =</span> predicted2)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1068-42"><a href="#cb1068-42"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y),</span>
<span id="cb1068-43"><a href="#cb1068-43"></a>             <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb1068-44"><a href="#cb1068-44"></a>             <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">data =</span> dataset)<span class="op">+</span></span>
<span id="cb1068-45"><a href="#cb1068-45"></a><span class="st">  </span><span class="kw">geom_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y, <span class="dt">z =</span> predicted2),</span>
<span id="cb1068-46"><a href="#cb1068-46"></a>               <span class="dt">binwidth =</span> <span class="fl">0.1</span>, <span class="dt">color =</span> <span class="st">&#39;white&#39;</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1068-47"><a href="#cb1068-47"></a><span class="st">  </span><span class="kw">geom_text_contour</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y, <span class="dt">z =</span> predicted2), <span class="dt">color =</span> <span class="st">&#39;white&#39;</span>, <span class="dt">binwidth =</span> <span class="fl">0.1</span>)<span class="op">+</span></span>
<span id="cb1068-48"><a href="#cb1068-48"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>() <span class="op">+</span></span>
<span id="cb1068-49"><a href="#cb1068-49"></a><span class="st">  </span><span class="kw">coord_cartesian</span>()<span class="op">+</span><span class="st"> </span></span>
<span id="cb1068-50"><a href="#cb1068-50"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title=</span> <span class="kw">element_blank</span>(),</span>
<span id="cb1068-51"><a href="#cb1068-51"></a>        <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb1068-52"><a href="#cb1068-52"></a>        <span class="dt">axis.ticks =</span>  <span class="kw">element_blank</span>()</span>
<span id="cb1068-53"><a href="#cb1068-53"></a>        ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1068-54"><a href="#cb1068-54"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&#39;spline plus complexe&#39;</span>, <span class="dt">fill =</span> <span class="st">&quot;prédictions&quot;</span>)</span>
<span id="cb1068-55"><a href="#cb1068-55"></a></span>
<span id="cb1068-56"><a href="#cb1068-56"></a><span class="kw">ggarrange</span>(plot1, plot2, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">common.legend =</span> <span class="ot">TRUE</span>, <span class="dt">legend =</span> <span class="st">&#39;bottom&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/figgam17-1.png" alt="Comparaison de deux splines spatiales" width="100%" />
<p class="caption">
(#fig:figgam17)Comparaison de deux splines spatiales
</p>
</div>
<p>Or, il s’avère que les deux <em>splines</em> spatiales sont très similaires (figures @ref(fig:figgam17)). Par conséquent, il est vraisemblablement plus pertinent de conserver la plus simple des deux. Notez que le Mont-Royal, compris dans le cercle central avec une isoligne à 0, est caractérisé par des valeurs plus faibles d’îlots de chaleur alors que les quartiers centraux situés un peu plus au Nord sont au contraire marqués par des pourcentages d’îlots de chaleur supérieurs de 20 points de pourcentage en moyenne.</p>
</div>
<div id="sect117" class="section level2">
<h2><span class="header-section-number">11.7</span> GAMM</h2>
<p>Bien entendu, il est possible de combiner les modèles généralisés additifs (GAM) avec les modèles à effet mixtes (GLMM) abordés dans les sections précédentes. Ces modèles généralisés additifs à effets mixtes (GAMM) peuvent facilement être mis en œuvre avec <strong>mgcv</strong>.</p>
<div id="sect1171" class="section level4">
<h4><span class="header-section-number">11.7.0.1</span> GAMM et interceptes aléatoires</h4>
<p>Pour définir des constantes aléatoires, il suffit d’utiliser la notation <code>s(var, bs = 're')</code> avec <code>var</code> une variable nominale. Reprenons l’exemple précédent, mais avec cette fois-ci les arrondissements comme un intercepte aléatoire.</p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="#cb1069-1"></a>dataset<span class="op">$</span>Arrond &lt;-<span class="st"> </span><span class="kw">as.factor</span>(dataset<span class="op">$</span>Arrond)</span>
<span id="cb1069-2"><a href="#cb1069-2"></a>model4 &lt;-<span class="st"> </span><span class="kw">gam</span>(hot <span class="op">~</span></span>
<span id="cb1069-3"><a href="#cb1069-3"></a><span class="st">          </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb1069-4"><a href="#cb1069-4"></a><span class="st">          </span><span class="kw">s</span>(prt_veg)  <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(Arrond, <span class="dt">bs =</span> <span class="st">&quot;re&quot;</span>),</span>
<span id="cb1069-5"><a href="#cb1069-5"></a>        <span class="dt">data =</span> dataset, <span class="dt">family =</span> <span class="kw">betar</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>L’enjeu est ensuite d’extraire la variance propre à cet effet aléatoire ainsi que les valeurs des interceptes pour chaque arrondissement.</p>
<div class="sourceCode" id="cb1070"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1070-1"><a href="#cb1070-1"></a><span class="kw">gam.vcomp</span>(model4)</span></code></pre></div>
<pre><code>## 
## Standard deviations and 0.95 confidence intervals:
## 
##                std.dev       lower      upper
## s(prt_veg) 0.007047166 0.003785275 0.01311993
## s(Arrond)  0.393539474 0.302707198 0.51162747
## 
## Rank: 2/2</code></pre>
<p>Nous constatons donc que l’écart-type de l’effet aléatoire des arrondissements est de 0.39, ce qui signifie que les effets de chaque arrondissement seront compris à 95 % entre -1,17 et 1,17 (<code>1.17 = 3*0.39</code>) sur l’échelle du prédicteur linéaire. En effet, rappelons que les effets aléatoires sont modélisés comme des distributions normales et que 95 % de la densité d’une distribution normale se situe entre -3 et +3 écarts-types. Pour extraire les interceptes spécifiques de chaque arrondissement, nous pouvons utiliser la fonction <code>get_random</code> du <em>package</em> <code>itsadug.</code></p>
<div class="sourceCode" id="cb1072"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1072-1"><a href="#cb1072-1"></a><span class="kw">library</span>(itsadug)</span>
<span id="cb1072-2"><a href="#cb1072-2"></a>values &lt;-<span class="st"> </span><span class="kw">get_random</span>(model4)[[<span class="dv">1</span>]]</span>
<span id="cb1072-3"><a href="#cb1072-3"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1072-4"><a href="#cb1072-4"></a>  <span class="dt">ri =</span> <span class="kw">as.numeric</span>(values),</span>
<span id="cb1072-5"><a href="#cb1072-5"></a>  <span class="dt">arrond =</span> <span class="kw">names</span>(values)</span>
<span id="cb1072-6"><a href="#cb1072-6"></a>)</span>
<span id="cb1072-7"><a href="#cb1072-7"></a></span>
<span id="cb1072-8"><a href="#cb1072-8"></a><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1072-9"><a href="#cb1072-9"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ri, <span class="dt">y =</span> <span class="kw">reorder</span>(arrond, ri))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1072-10"><a href="#cb1072-10"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1072-11"><a href="#cb1072-11"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Arrondissement&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;intercepte aléatoire&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/randomconstGAM-1.png" alt="Constantes aléatoires pour les arrondissements" width="2100" />
<p class="caption">
(#fig:randomconstGAM)Constantes aléatoires pour les arrondissements
</p>
</div>
<p>Nous constatons ainsi à la figure @ref(fig:randomconstGAM) que pour une partie des arrondissements, la densité d’îlot de chaleur est systématiquement supérieure à la moyenne régionale représentée ici par la ligne rouge (0 = effet moyen pour tous les arrondissements). Il convient alors d’améliorer ce graphique en ajoutant le niveau d’incertitude associé à chaque intercepte. Pour ce faire, nous utilisons la fonction <code>extract_random_effects</code> du <em>package</em> <code>mixedup.</code> Notez que ce <em>package</em> n’est actuellement pas disponible sur CRAN et doit être téléchargé sur <strong>github</strong> avec la commande suivante :</p>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1073-1"><a href="#cb1073-1"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&#39;m-clark/mixedup&#39;</span>)</span></code></pre></div>
<p>Avec la version 4.0.1 de R, nous avons rencontré des difficultés pour installer <code>mixedup</code>. Nous avons donc simplement récupéré le code source de la fonction et l’avons enregistré dans un fichier de code séparé que nous appelons ici.</p>
<div class="sourceCode" id="cb1074"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1074-1"><a href="#cb1074-1"></a><span class="kw">source</span>(<span class="st">&quot;code_complementaire/gam_functions.R&quot;</span>)</span></code></pre></div>
<p>Nous pouvons ensuite procéder à l’extraction des effets aléatoires et les représenter à nouveau (figure @ref(fig:randomconstGAM2)).</p>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1075-1"><a href="#cb1075-1"></a>df_re &lt;-<span class="st"> </span><span class="kw">extract_random_effects.gam</span>(model4, <span class="dt">re =</span> <span class="st">&quot;Arrond&quot;</span>)</span>
<span id="cb1075-2"><a href="#cb1075-2"></a></span>
<span id="cb1075-3"><a href="#cb1075-3"></a><span class="kw">ggplot</span>(df_re) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1075-4"><a href="#cb1075-4"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> lower_<span class="fl">2.5</span>, <span class="dt">xmax =</span> upper_<span class="fl">97.5</span>, <span class="dt">y =</span> <span class="kw">reorder</span>(group, value))) <span class="op">+</span></span>
<span id="cb1075-5"><a href="#cb1075-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="kw">reorder</span>(group, value))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1075-6"><a href="#cb1075-6"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1075-7"><a href="#cb1075-7"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Arrondissement&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Intercepte aléatoire&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/randomconstGAM2-1.png" alt="Constantes aléatoires pour les arrondissements avec intervalle de confiance" width="2100" />
<p class="caption">
(#fig:randomconstGAM2)Constantes aléatoires pour les arrondissements avec intervalle de confiance
</p>
</div>
<p>Cela permet de distinguer quels écarts sont significativement différents de 0 au seuil de 95 %. À titre de rappel, pour être significatif à ce seuil, un intervalle représenté par une ligne noire horizontale ne doit pas intersecter la ligne rouge verticale. Puisque nous utilisons ici la distribution <em>beta</em> et une fonction de lien logistique, nous devons utiliser des prédictions pour simplifier l’interprétation des coefficients. Nous allons ici fixer toutes les variables à leur moyenne respective sauf l’arrondissement et calculer les prédictions dans l’échelle originale (0 à 1).</p>
<div class="sourceCode" id="cb1076"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1076-1"><a href="#cb1076-1"></a>dfpred &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1076-2"><a href="#cb1076-2"></a>  <span class="dt">A65Pct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>A65Pct),</span>
<span id="cb1076-3"><a href="#cb1076-3"></a>  <span class="dt">A014Pct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>A014Pct),</span>
<span id="cb1076-4"><a href="#cb1076-4"></a>  <span class="dt">PopFRPct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>PopFRPct),</span>
<span id="cb1076-5"><a href="#cb1076-5"></a>  <span class="dt">PopMVPct =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>PopMVPct),</span>
<span id="cb1076-6"><a href="#cb1076-6"></a>  <span class="dt">prt_veg =</span> <span class="kw">mean</span>(dataset<span class="op">$</span>prt_veg),</span>
<span id="cb1076-7"><a href="#cb1076-7"></a>  <span class="dt">Arrond =</span> <span class="kw">as.character</span>(<span class="kw">unique</span>(dataset<span class="op">$</span>Arrond))</span>
<span id="cb1076-8"><a href="#cb1076-8"></a>)</span>
<span id="cb1076-9"><a href="#cb1076-9"></a></span>
<span id="cb1076-10"><a href="#cb1076-10"></a><span class="co"># Calculer les prédictions pour le prédicteur linéaire</span></span>
<span id="cb1076-11"><a href="#cb1076-11"></a>dfpred<span class="op">$</span>preds &lt;-<span class="st"> </span><span class="kw">predict</span>(model4, <span class="dt">newdata =</span> dfpred, <span class="dt">type =</span> <span class="st">&quot;link&quot;</span>)</span>
<span id="cb1076-12"><a href="#cb1076-12"></a></span>
<span id="cb1076-13"><a href="#cb1076-13"></a><span class="co"># Calculer l&#39;intervalle de confiance en utilisant les valeurs</span></span>
<span id="cb1076-14"><a href="#cb1076-14"></a><span class="co"># extraites avec extract_random_effects</span></span>
<span id="cb1076-15"><a href="#cb1076-15"></a>dfpred &lt;-<span class="st"> </span>dfpred[<span class="kw">order</span>(dfpred<span class="op">$</span>Arrond),]</span>
<span id="cb1076-16"><a href="#cb1076-16"></a>df_re &lt;-<span class="st"> </span>df_re[<span class="kw">order</span>(df_re<span class="op">$</span>group),]</span>
<span id="cb1076-17"><a href="#cb1076-17"></a></span>
<span id="cb1076-18"><a href="#cb1076-18"></a>dfpred<span class="op">$</span>lower &lt;-<span class="st"> </span>dfpred<span class="op">$</span>preds <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>df_re<span class="op">$</span>se</span>
<span id="cb1076-19"><a href="#cb1076-19"></a>dfpred<span class="op">$</span>upper &lt;-<span class="st"> </span>dfpred<span class="op">$</span>preds <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>df_re<span class="op">$</span>se</span>
<span id="cb1076-20"><a href="#cb1076-20"></a></span>
<span id="cb1076-21"><a href="#cb1076-21"></a><span class="co"># Il nous reste juste à reconvertir le tout dans l&#39;unité d&#39;origine</span></span>
<span id="cb1076-22"><a href="#cb1076-22"></a><span class="co"># en utilisant l&#39;inverse de la fonction logistique</span></span>
<span id="cb1076-23"><a href="#cb1076-23"></a>inv.logit &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="kw">exp</span>(x)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(x))}</span>
<span id="cb1076-24"><a href="#cb1076-24"></a></span>
<span id="cb1076-25"><a href="#cb1076-25"></a>dfpred<span class="op">$</span>lower &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(dfpred<span class="op">$</span>lower)</span>
<span id="cb1076-26"><a href="#cb1076-26"></a>dfpred<span class="op">$</span>upper &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(dfpred<span class="op">$</span>upper)</span>
<span id="cb1076-27"><a href="#cb1076-27"></a>dfpred<span class="op">$</span>preds &lt;-<span class="st"> </span><span class="kw">inv.logit</span>(dfpred<span class="op">$</span>preds)</span>
<span id="cb1076-28"><a href="#cb1076-28"></a></span>
<span id="cb1076-29"><a href="#cb1076-29"></a><span class="kw">ggplot</span>(dfpred) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1076-30"><a href="#cb1076-30"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> lower, <span class="dt">xmax =</span> upper, <span class="dt">y =</span> <span class="kw">reorder</span>(Arrond, preds))) <span class="op">+</span></span>
<span id="cb1076-31"><a href="#cb1076-31"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> preds, <span class="dt">y =</span> <span class="kw">reorder</span>(Arrond, preds))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1076-32"><a href="#cb1076-32"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">mean</span>(dfpred<span class="op">$</span>preds), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1076-33"><a href="#cb1076-33"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Arrondissement&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;intercepte aléatoire&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/randomconstGAM3-1.png" alt="Prédictions pour les différents arrondissements pour une AD fictive moyenne" width="2100" />
<p class="caption">
(#fig:randomconstGAM3)Prédictions pour les différents arrondissements pour une AD fictive moyenne
</p>
</div>
<p>Nous constatons ainsi à la figure @ref(fig:randomconstGAM3) que, pour une hypothétique aire de diffusion moyenne, la différence de densité d’îlot de chaleur peut être de 0,32 (32 % de la surface de l’AD) entre les arrondissements Verdun et Dollard-des-Ormeaux.</p>
</div>
<div id="sect1172" class="section level4">
<h4><span class="header-section-number">11.7.0.2</span> GAMM et coefficients aléatoires</h4>
<p>En plus des interceptes aléatoires, il est aussi possible de définir des coefficients aléatoires. Reprenons notre exemple et tentons de faire varier l’effet de la variable <code>PopFRPct</code> en fonction de l’arrondissement.</p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1077-1"><a href="#cb1077-1"></a>model5 &lt;-<span class="st"> </span><span class="kw">gam</span>(hot <span class="op">~</span></span>
<span id="cb1077-2"><a href="#cb1077-2"></a><span class="st">          </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct <span class="op">+</span></span>
<span id="cb1077-3"><a href="#cb1077-3"></a><span class="st">          </span><span class="kw">s</span>(prt_veg)  <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(Arrond, <span class="dt">bs =</span> <span class="st">&quot;re&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1077-4"><a href="#cb1077-4"></a><span class="st">          </span><span class="kw">s</span>(PopFRPct, Arrond, <span class="dt">bs =</span> <span class="st">&quot;re&quot;</span>),</span>
<span id="cb1077-5"><a href="#cb1077-5"></a>        <span class="dt">data =</span> dataset, <span class="dt">family =</span> <span class="kw">betar</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>Notez ici une distinction importante! Le modèle n’assume aucune corrélation entre les coefficients aléatoires pour la variable <code>PopFRPct</code> et pour les constantes aléatoires. Il est assumé que ces deux effets proviennent de deux distributions normales distinctes. En d’autres termes, le modèle ne dispose pas des paramètres nécessaires pour vérifier si les arrondissements avec les constantes les plus fortes (avec des densités supérieures d’îlot de chaleur) sont aussi des arrondissements dans lesquels l’effet de la variable <code>PopFRPct</code> est plus prononcé (et vice-versa). Pour plus d’informations sur cette distinction, référez-vous à la section @ref(sect0924).</p>
<div class="sourceCode" id="cb1078"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1078-1"><a href="#cb1078-1"></a><span class="kw">AIC</span>(model4, model5)</span></code></pre></div>
<pre><code>##              df       AIC
## model4 41.54635 -6421.791
## model5 56.84734 -6466.726</code></pre>
<p>Ce dernier modèle présente une valeur d’<em>AIC</em> plus faible et serait donc ainsi mieux ajusté que notre modèle avec seulement un intercepte aléatoire. Nous pouvons donc extraire les coefficients aléatoires et les représenter à la figure @ref(fig:randomconstcoefGAM).</p>
<div class="sourceCode" id="cb1080"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1080-1"><a href="#cb1080-1"></a>df_re &lt;-<span class="st"> </span><span class="kw">extract_random_effects.gam</span>(model5)</span>
<span id="cb1080-2"><a href="#cb1080-2"></a>df_re &lt;-<span class="st"> </span><span class="kw">subset</span>(df_re, df_re<span class="op">$</span>effect <span class="op">==</span><span class="st"> &#39;PopFRPct&#39;</span>)</span>
<span id="cb1080-3"><a href="#cb1080-3"></a></span>
<span id="cb1080-4"><a href="#cb1080-4"></a><span class="kw">ggplot</span>(df_re) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1080-5"><a href="#cb1080-5"></a><span class="st">  </span><span class="kw">geom_errorbarh</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> lower_<span class="fl">2.5</span>, <span class="dt">xmax =</span> upper_<span class="fl">97.5</span>, <span class="dt">y =</span> <span class="kw">reorder</span>(group, value))) <span class="op">+</span></span>
<span id="cb1080-6"><a href="#cb1080-6"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="kw">reorder</span>(group, value))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1080-7"><a href="#cb1080-7"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1080-8"><a href="#cb1080-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Arrondissement&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;coefficient aléatoire&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/randomconstcoefGAM-1.png" alt="Pentes et constantes aléatoires pour les arrondissements" width="2100" />
<p class="caption">
(#fig:randomconstcoefGAM)Pentes et constantes aléatoires pour les arrondissements
</p>
</div>
<p>Nous constatons notamment que seuls trois arrondissements ont des coefficients aléatoires significativement différents de 0. Ainsi, pour les arrondissements Anjou et Plateau-Mont-Royal, les coefficients aléatoires sont respectivement de -0,013 et -0,015, et viennent donc se retrancher à la valeur moyenne régionale de 0,0154 qui atteint alors presque 0. Du point de vue de l’interprétation, nous pouvons en conclure que le groupe des personnes à faible revenu ne subit pas de surexposition aux îlots de chaleur à l’échelle des AD dans ces arrondissements.</p>
<p>En revanche, dans l’arrondissement Mercier-Hochelaga-Maisonneuve, la situation est à l’inverse plus systématiquement en défaveur des populations à faible revenu, avec une taille d’effet prêt de deux fois supérieure à la moyenne régionale. En effet, l’effet moyen régional (coefficient fixe) est de 0,0154 auquel vient se rajouter l’effet spécifique (coefficient aléatoire) de Mercier-Hochelaga-Maisonneuve, soit 0,011, pour un effet total de 0,0264</p>
<div class="bloc_aller_loin">
<p><strong>Des effets aléatoires plus complexes dans les GAMM</strong></p>
<p>Il est possible de spécifier des GAMM avec des effets aléatoires plus complexes autorisant par exemple des corrélations entre les différents effets / niveaux. Il faut pour cela utiliser la fonction <code>gamm</code> de <code>mgcv</code> ou la fonction <code>gamm4</code> du <em>package</em> <code>gamm4.</code> La première offre plus de flexibilité, mais la seconde est plus facile à utiliser et doit être privilégiée quand un modèle comporte un très grand nombre de groupes dans un effet aléatoire, ou lorsque la distribution du modèle n’est pas gaussienne. La fonction <code>gamm</code> permet d’ajuster des modèles non gaussiens, mais elle utilise une approche appelée <em>PQL</em> (<em>Penalized Quasi-Likelihood</em> en anglais) connue pour être moins stable et moins précise.</p>
<p>Cependant, dans l’exemple de cette section, nous utilisons un modèle GAMM avec une distribution <em>beta</em>, ce qui n’est actuellement pas supporté par les fonctions <code>gamm</code> et <code>gamm4</code>. Pour un modèle GAMM plus complexe utilisant une distribution <em>beta</em>, il serait nécessaire d’utiliser le <em>package</em> <code>gamlss</code>, mais ce dernier utilise aussi une approche de type PQL. Nous montrons tout de même ici comment ajouter un modèle qui inclurait une corrélation entre les deux effets aléatoires de l’exemple précédent. Notez ici que le terme <code>re</code> apparaissant dans la formule permet de spécifier un effet aléatoire en utilisant la syntaxe du <em>package</em> <code>nlme.</code> Plus spécifiquement, <code>gamlss</code> fait un pont avec <code>nlme</code> et utilise son algorithme d’ajustement au sein de ces propres routines. De même, le terme <code>pb</code> permet de spécifier une <em>spline</em> de lissage dans le même esprit que <code>mgcv.</code> Il est également possible d’utiliser le terme <code>ga</code> faisant le lien avec <code>mgcv</code> et de profiter de sa flexibilité dans <code>gamlss</code>.</p>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1081-1"><a href="#cb1081-1"></a><span class="kw">library</span>(gamlss)</span>
<span id="cb1081-2"><a href="#cb1081-2"></a><span class="kw">library</span>(gamlss.add)</span>
<span id="cb1081-3"><a href="#cb1081-3"></a></span>
<span id="cb1081-4"><a href="#cb1081-4"></a>model6 &lt;-<span class="st"> </span><span class="kw">gamlss</span>(hot <span class="op">~</span></span>
<span id="cb1081-5"><a href="#cb1081-5"></a><span class="st">          </span><span class="kw">pb</span>(prt_veg) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1081-6"><a href="#cb1081-6"></a><span class="st">          </span><span class="kw">re</span>(<span class="dt">fixed =</span> <span class="op">~</span><span class="st"> </span>A65Pct <span class="op">+</span><span class="st"> </span>A014Pct <span class="op">+</span><span class="st"> </span>PopFRPct <span class="op">+</span><span class="st"> </span>PopMVPct, </span>
<span id="cb1081-7"><a href="#cb1081-7"></a>             <span class="dt">random =</span> <span class="op">~</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>PopFRPct)<span class="op">|</span>Arrond),</span>
<span id="cb1081-8"><a href="#cb1081-8"></a>        <span class="dt">data =</span> dataset, <span class="dt">family =</span> <span class="kw">BE</span>(<span class="dt">mu.link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>Nous pouvons ensuite accéder à la partie du modèle qui nous intéresse, soit celle concernant les effets aléatoires.</p>
<div class="sourceCode" id="cb1082"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1082-1"><a href="#cb1082-1"></a>randomPart &lt;-<span class="st"> </span>model6<span class="op">$</span>mu.coefSmo[[<span class="dv">2</span>]]</span>
<span id="cb1082-2"><a href="#cb1082-2"></a><span class="kw">print</span>(randomPart)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: Data 
##   Log-likelihood: -2964.494
##   Fixed: fix.formula 
##  (Intercept)       A65Pct      A014Pct     PopFRPct     PopMVPct 
## -0.060862832 -0.001945204 -0.010139278  0.017259606 -0.002599745 
## 
## Random effects:
##  Formula: ~(1 + PopFRPct) | Arrond
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev     Corr  
## (Intercept) 0.47298363 (Intr)
## PopFRPct    0.01078909 -0.646
## Residual    0.99888012       
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~W.var 
## Number of Observations: 3157
## Number of Groups: 33</code></pre>
<p>À lecture de la partie du résumé consacrée aux résultats pour les effets aléatoires, nous constatons que la corrélation entre les interceptes aléatoires et les coefficients aléatoires est de -0,65. Cela signifie que pour les arrondissements avec des interceptes élevés (plus grande proportion d’îlots de chaleur), l’effet de la variable <code>PopFRPct</code> tend à être plus faible. Autrement dit, dans les arrondissements avec beaucoup d’îlots de chaleur, les personnes à faible revenu ont tendance à être moins exposées, tel qu’illustré à la figure @ref(fig:corrrandom).</p>
<div class="sourceCode" id="cb1084"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1084-1"><a href="#cb1084-1"></a>df &lt;-<span class="st"> </span><span class="kw">ranef</span>(randomPart)</span>
<span id="cb1084-2"><a href="#cb1084-2"></a>df<span class="op">$</span>arrond &lt;-<span class="st"> </span><span class="kw">rownames</span>(df)</span>
<span id="cb1084-3"><a href="#cb1084-3"></a><span class="kw">names</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Intercept&#39;</span>, <span class="st">&#39;PopFRPct&#39;</span>, <span class="st">&#39;Arrondissement&#39;</span>)</span>
<span id="cb1084-4"><a href="#cb1084-4"></a></span>
<span id="cb1084-5"><a href="#cb1084-5"></a><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1084-6"><a href="#cb1084-6"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb1084-7"><a href="#cb1084-7"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb1084-8"><a href="#cb1084-8"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Intercept, <span class="dt">y =</span> PopFRPct))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/corrrandom-1.png" alt="Relation entre les effets aléatoires des arrondissements et la variable population à faible revenu" width="75%"  />
<p class="caption">
(#fig:corrrandom)Relation entre les effets aléatoires des arrondissements et la variable population à faible revenu
</p>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="sect118" class="section level2">
<h2><span class="header-section-number">11.8</span> Quiz de révision du chapitre</h2>
<div id="quizz_classif" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_quizz_classif;
  window.onload = function() {
    quizz_quizz_classif = new Quiz('quizz_classif', ['2','3','3','1',['1', '2', '3'],'2','1',['1', '3']]);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Que signifie l’acronyme GAM:
</div>
<div>
Relisez l’introduction du chapitre @ref(chap11)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Gaussian Asymetric Model</label>
</td>
<td>
<input type="radio" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Generalized Additive Model</label>
</td>
<td>
<input type="radio" name="q1" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Gaussian Asynchronus Model</label>
</td>
<td>
<input type="radio" name="q1" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Generalized Asymetric Model</label>
</td>
<td>
<input type="radio" name="q1" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quel est l’intérêt d’un modèle GAM comparativement à un modèle GLM?
</div>
<div>
Relisez au besoin la section @ref(sect111)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>la possibilité d’ajuster n’importe quelle distribution dans le modèle</label>
</td>
<td>
<input type="radio" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>la possibilité de tenir compte de structure de corrélation entre les observations</label>
</td>
<td>
<input type="radio" name="q2" value="2"/>
</td>
</tr>
<tr>
<td>
<label>l’ajout de termes non-linéaire pour les prédicteurs</label>
</td>
<td>
<input type="radio" name="q2" value="3"/>
</td>
</tr>
<tr>
<td>
<label>la transformation de la variable Y pour quelle se rapproche d’une distribution normale</label>
</td>
<td>
<input type="radio" name="q2" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Une spline ajustée sur une variable X dans un GAM est construite comme :
</div>
<div>
Relisez au besoin la section @ref(sect1114)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>un ensemble de coefficients ajustés à différentes sections de la variable X identifiés par des points de ruptures</label>
</td>
<td>
<input type="radio" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>la somme d’un ensemble de polynomiales de X multipliées par des coefficients ajustés par le modèle</label>
</td>
<td>
<input type="radio" name="q3" value="2"/>
</td>
</tr>
<tr>
<td>
<label>la somme d’un ensemble de fonctions de bases appliquées à X et multipliées par des coefficients ajustés par le modèle</label>
</td>
<td>
<input type="radio" name="q3" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le degré de complexité d’une spline est contrôlé par :
</div>
<div>
Relisez au besoin la section @ref(sect1114)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>le nombre de noeuds de la spline</label>
</td>
<td>
<input type="radio" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>le nombre de variables X sur lesquelles la spline est ajustée</label>
</td>
<td>
<input type="radio" name="q4" value="2"/>
</td>
</tr>
<tr>
<td>
<label>le type de fonction de base de la spline</label>
</td>
<td>
<input type="radio" name="q4" value="3"/>
</td>
</tr>
<tr>
<td>
<label>la distribution du modèle</label>
</td>
<td>
<input type="radio" name="q4" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le nombre de noeud d’une spline peut être :
</div>
<div>
Relisez au besoin la section @ref(sect113)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>défini manuellement, on parle alors de spline de régression</label>
</td>
<td>
<input type="checkbox" name="q5" value="1"/>
</td>
</tr>
<tr>
<td>
<label>déterminé par une approche automatique appelée pénalisation de la vraisemblance, on parle alors de spline de lissage</label>
</td>
<td>
<input type="checkbox" name="q5" value="2"/>
</td>
</tr>
<tr>
<td>
<label>déterminé automatiquement en re-paramétrisant la spline comme un effet aléatoire, on parle alors de spline de lissage</label>
</td>
<td>
<input type="checkbox" name="q5" value="3"/>
</td>
</tr>
<tr>
<td>
<label>déterminé de façon itérative en ajoutant un noeud à chaque fois et en comparant le R2 de Nagelkerke</label>
</td>
<td>
<input type="checkbox" name="q5" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Une spline bivariée est un autre nom pour une spline d’interaction.
</div>
<div>
Relisez au besoin la section @ref(sect115)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q6" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q6" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Une spline peut être ajustée sur plus que deux variables X simultanément.
</div>
<div>
Relisez au besoin la section @ref(sect115)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q7" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q7" value="2"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour interpréter les résultats d’une spline, il est possible de :
</div>
<div>
Relisez au besoin la section @ref(sect114)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>observer le nombre de degrés de liberté (estimated degree of freedom) de cette dernière pour se faire une idée de son degré de complexité</label>
</td>
<td>
<input type="checkbox" name="q8" value="1"/>
</td>
</tr>
<tr>
<td>
<label>représenter graphiquement les fonctions de bases utilisées par la spline</label>
</td>
<td>
<input type="checkbox" name="q8" value="2"/>
</td>
</tr>
<tr>
<td>
<label>représenter les prédictions du modèle “toutes choses égales par ailleurs” afin d’obtenir les effets marginaux des termes non linéaires</label>
</td>
<td>
<input type="checkbox" name="q8" value="3"/>
</td>
</tr>
<tr>
<td>
<label>wxtraire les coefficients de la spline et les interpréter de façon classique</label>
</td>
<td>
<input type="checkbox" name="q8" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<button type="button" onclick="showResults(quizz_quizz_classif);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:11-GAM.Rmd-->
</div>
</div>
<div id="chap13" class="section level1">
<h1><span class="header-section-number">12</span> Méthodes de classification non supervisée</h1>
<div class="bloc_attention">
<p>Ce chapitre n’a pas encore fait l’objet d’une révision linguistique. Il comprend certainement plusieurs coquilles… Une version révisée sera mise à jour prochainement.</p>
</div>
<p>Dans le cadre de ce chapitre, nous présentons les méthodes les plus utilisées en sciences sociales pour explorer la présence de groupes homogènes au sein d’un jeu de données, soit les méthodes de classification non supervisée. Le qualificatif <em>non supervisé</em> signifie que ces classes/groupes ne sont pas connues a priori et doivent être identifiées à partir des données. Autrement dit, nous cherchons à regrouper les observations partageant des caractéristiques similaires sur la base de plusieurs variables. Ces méthodes descriptives et exploratoires multivariées peuvent être vues comme une façon de réduire le nombre d’observations d’un jeu de données à un ensemble d’observations synthétiques, représentant le mieux possible la population à l’étude.</p>
<div class="bloc_package">
<p>Dans ce chapitre, nous utilisons les <em>packages</em> suivants :</p>
<ul>
<li>Pour créer des graphiques :
<ul>
<li><code>ggplot2</code> le seul, l’unique!</li>
<li><code>ggpubr</code> pour combiner des graphiques et réaliser des diagrammes.</li>
</ul></li>
<li>Outils généraux pour faciliter les classifications :
<ul>
<li><code>clusterCrit</code> pour calculer des indicateurs de qualité de classification.</li>
<li><code>NbClust</code> pour trouver le bon nombre de groupe dans une classification.</li>
<li><code>cluster</code> pour appliquer la méthode GAP.</li>
<li><code>proxy</code> pour calculer plusieurs types de distances.</li>
<li><code>Gmedian</code> pour calculer le k-medians.</li>
<li><code>geocmeans</code> pour explorer les résultats de classifications floues.</li>
</ul></li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="bloc_objectif">
<p><strong>Pourquoi recourir à des méthodes de classification non supervisée en sciences sociales?</strong></p>
<p>Les méthodes de classification sont très utilisées en sciences sociales. Elles visent à d’identifier des groupes cohérents au sein d’un ensemble d’observations sur la base de plusieurs variables (figure @ref(fig:ClassifNonNSuperv)). Ces groupes peuvent ensuite être analysés et nous renseigner sur les caractéristiques communes partagées par les individus qui les composent.</p>
<div class="figure" style="text-align: center">
<img src="images/classification/ClassifNonNSuperv.png" alt="Principe de base des méthodes de classification non supervisée" width="40%" />
<p class="caption">
(#fig:ClassifNonNSuperv)Principe de base des méthodes de classification non supervisée
</p>
</div>
<p>Un exemple classique est l’identification de profils d’individus ayant répondu à un sondage, en fonction de plusieurs caractéristiques (par exemple, l’âge, le sexe, la situation de famille, le revenu, etc.). En identifiant ces groupes homogènes, il est ensuite possible d’explorer les associations entre ces profils et d’autres variables.</p>
<p>Un second exemple serait de regrouper les secteurs d’une ville selon leurs caractéristiques environnementales (végétation, niveau de bruit, pollution atmosphérique, etc.) et socioéconomiques (revenu médian des ménages, pourcentages d’immigrants, de personnes à faible scolarité, taux de chômage, etc.).</p>
</div>
<div id="sect131" class="section level2">
<h2><span class="header-section-number">12.1</span> Méthodes de classification : un aperçu</h2>
<p>Il existe une multitude de méthodes de classification généralement regroupées dans plusieurs familles imbriquées à partir de deux distinctions importantes.</p>
<p>La première distinction vise à séparer les méthodes <strong>supervisées</strong> et <strong>non supervisées</strong>. Pour les premières, les catégories/groupes/classes des observations sont connues à l’avance. L’enjeu n’est pas de trouver les catégories puisqu’elles sont connues, mais <strong>de déterminer des règles ou un modèle permettant d’attribuer des observations à ces catégories</strong>. Parmi les méthodes de classification supervisée, les plus connues sont les forêts d’arbres décisionnels, les réseaux de neurones artificiels ou encore l’analyse factorielle discriminante. Nous n’abordons pas ces méthodes dans ce chapitre dédié uniquement aux méthodes de classification non supervisée. Pour ces dernières, les catégories ne sont pas connues à l’avance et l’enjeu est de <strong>faire ressortir les structures des groupes propres aux données</strong>. Ainsi, les méthodes de classification non supervisée « relèvent de la statistique exploratoire multidimensionnelle et permettent de classifier automatiquement les observations sans connaissance a priori sur la nature des classes présentes dans le jeu de données; les plus connues sont sans conteste les algorithmes de classification ascendante hiérarchique (CAH) et <em>k-means</em> (k-moyennes) » <span class="citation">(Gelb et Apparicio <a href="#ref-2021_4" role="doc-biblioref">2021</a><a href="#ref-2021_4" role="doc-biblioref">b</a>, 1)</span>. Notez également qu’à la frontière entre ces deux familles se situent les méthodes de classification semi-supervisée. Il s’agit de cas spécifiques où des informations partielles sont connues sur les groupes à détecter : seulement le groupe final de certaines observations est connu, certaines observations sont supposées appartenir à un même groupe même s’il est indéfini en lui-même <span class="citation">(Bair <a href="#ref-bair2013semi" role="doc-biblioref">2013</a>)</span>.</p>
<p>La seconde distinction vise à séparer les méthodes <strong>strictes</strong> et <strong>floues</strong>. Les premières ont pour objectif d’assigner chaque observation à une et une seule catégorie, alors que les secondes décrivent le degré d’appartenance de chaque observation à chaque catégorie. Autrement dit, « dans une classification stricte, chaque observation appartient à une seule classe. Mathématiquement parlant, l’appartenance à une classe donnée est binaire (0 ou 1) tandis que dans une classification floue, chaque observation a une probabilité d’appartenance variant de 0 à 1 à chacune des classes » <span class="citation">(Gelb et Apparicio <a href="#ref-2021_4" role="doc-biblioref">2021</a><a href="#ref-2021_4" role="doc-biblioref">b</a>, 1)</span>. Bien entendu, pour chaque observation, la somme des degrés d’appartenance à chacune des classes sera égale à 1 (figure @ref(fig:floueVSstrict)). En termes de données, cela signifie que pour les méthodes strictes, le groupe d’appartenance d’une observation sera contenu dans une seule variable nominale (une colonne d’un <em>DataFrame</em>). Pour les méthodes floues, il est nécessaire de disposer d’autant de variables continues (plusieurs colonnes numériques d’un <em>DataFrame</em>), soit une par groupe, dans lequel sera enregistré le degré d’appartenance de chaque observation à chacun des groupes. Parmi les méthodes de classification supervisée floue, notez que nous avons déjà abordé la régression logistique multinomiale dans le chapitre sur les GLM (section @ref(sect0824)).</p>
<div class="figure" style="text-align: center">
<img src="images/classification/floueVSstricte.png" alt="Classifications stricte et floue" width="40%" />
<p class="caption">
(#fig:floueVSstrict)Classifications stricte et floue
</p>
</div>
<p>En résumé, le croisement de ces deux distinctions permet de ainsi de différencier les méthodes <strong>supervisées strictes</strong>, <strong>supervisées floues</strong>, <strong>non supervisées strictes</strong> et <strong>non supervisées floues</strong> (figure @ref(fig:methoClassif)), auxquelles s’ajoutent les méthodes semi-supervisées discutées brièvement.</p>
<div class="figure" style="text-align: center">
<img src="images/classification/syntheseClassif.png" alt="Synthèse des principales méthodes de classification (Gelb et Apparicio 2021)" width="60%" />
<p class="caption">
(#fig:methoClassif)Synthèse des principales méthodes de classification (Gelb et Apparicio 2021)
</p>
</div>
<p>Dans ce chapitre, nous décrivons les trois méthodes de classification non supervisée les plus utilisées et faciles à mettre en œuvre : la classification ascendante hiérarchique, les nuées dynamiques strictes (<em>k-means</em> et <em>k-median</em>) et nuées dynamiques floues (<em>c-means</em> et <em>c-median</em>).</p>
</div>
<div id="sect132" class="section level2">
<h2><span class="header-section-number">12.2</span> Notions essentielles en classification</h2>
<p>Avant de décrire différentes méthodes de classification non supervisées, il convient de définir deux notions centrales, soit la <strong>distance</strong> et l’<strong>inertie</strong>.</p>
<div id="sect1321" class="section level3">
<h3><span class="header-section-number">12.2.1</span> Distance</h3>
<p>La distance en analyse de données est définie comme une fonction (<em>d</em>) permettant de déterminer à quel point deux observations sont semblables ou différentes l’une de l’autre. Elle doit respecter les conditions suivantes :</p>
<ul>
<li><strong>la non-négativité</strong> : la distance minimale entre deux objets est égale à 0; <span class="math inline">\(d(x,y) \geq 0\)</span>.</li>
<li><strong>le principe d’identité des indiscernables</strong> : la distance entre deux objets <span class="math inline">\(x\)</span> et <span class="math inline">\(y\)</span> est égale à 0, si <span class="math inline">\(x = y\)</span>; <span class="math inline">\(d(x,y)=0\text{ si et seulement si }x=y\)</span>.</li>
<li><strong>la symétrie</strong> : la distance entre <span class="math inline">\(x\)</span> et <span class="math inline">\(y\)</span> est la même qu’entre <span class="math inline">\(y\)</span> et <span class="math inline">\(x\)</span>; <span class="math inline">\(d(x,y) = d(y,x)\)</span>.</li>
<li><strong>le triangle d’inégalité</strong> : passer d’un point <span class="math inline">\(x\)</span> à un point <span class="math inline">\(z\)</span> est toujours plus court ou égal que de passer par <span class="math inline">\(y\)</span> entre <span class="math inline">\(x\)</span> et <span class="math inline">\(z\)</span>; <span class="math inline">\(d(x,z)\leq d(x,y)+d(y,z)\)</span>.</li>
</ul>
<p>Il existe un grand nombre de types de distance qui peuvent être utilisés pour déterminer le degré de (dis)similarité entre les observations. Nous présentons ici les six types les plus fréquemment utilisés en sciences sociales, mais retenez qu’il en existe bien d’autres.</p>
<div id="sect13211" class="section level4">
<h4><span class="header-section-number">12.2.1.1</span> Distance euclidienne</h4>
<p>Il s’agit vraisemblablement de la distance la plus couramment utilisée, soit la longueur de la ligne droite la plus courte entre les deux objets considérés. Pour la représenter, admettons que nous nous intéressons à trois classes d’étudiant(e)s A, B et C pour lesquelles nous avons calculé la moyenne de leurs notes dans les cours de méthodes quantitatives et qualitatives. Ces deux variables sont mesurées dans la même unité et varient de 0 à 100. Le nuage de points à la figure @ref(fig:dist0) illustre cette situation avec des données fictives.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/dist0-1.png" alt="Situation de base pour le calcul de distance" width="60%" />
<p class="caption">
(#fig:dist0)Situation de base pour le calcul de distance
</p>
</div>
<p>Les distances euclidiennes entre les classes B et C et les classes C et A sont représentées par les lignes noires à la figure @ref(fig:dist1). Nous pouvons constater que la distance entre les classes C et B est plus petite que celle entre les classes A et C, ce qui signale que les deux premières se ressemblent davantage.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/dist1-1.png" alt="Représentation de la distance euclidienne" width="60%" />
<p class="caption">
(#fig:dist1)Représentation de la distance euclidienne
</p>
</div>
<p>La formule de la distance euclidienne (équation @ref(eq:euclideandist)) est simplement la racine carrée de la somme des écarts au carré pour chacune des variables décrivant les observations <em>a</em> et <em>b</em>.</p>

<p><span class="math display">\[\begin{equation}  
d(a,b) = \sqrt{\sum{}^v_{i=1}(a_i-b_i)^2}
(\#eq:euclideandist)
\end{equation}\]</span>
</p>
<p>Avec <em>v</em> le nombre de variables décrivant les observations <em>a</em> et <em>b</em>.</p>
<p>Nous pouvons facilement calculer la distance euclidienne pour notre jeu de données :</p>
<ul>
<li><span class="math inline">\(d(A,B)=\sqrt{(\mbox{85}-\mbox{80})^2+(\mbox{80}-\mbox{77})^2} = \mbox{5,83}\)</span></li>
<li><span class="math inline">\(d(B,C)=\sqrt{(\mbox{80}-\mbox{83})^2+(\mbox{79}-\mbox{77})^2} = \mbox{3,60}\)</span></li>
</ul>
<div class="bloc_attention">
<p><strong>Distance et unité de mesure </strong></p>
<p>Il est très important de garder à l’esprit que la distance entre deux observations dépend directement des unités de mesure utilisées. Cela est très souvent problématique, car il est rare que toutes les variables utilisées pour décrire des observations soient mesurées dans la même unité. Ainsi, une variable dont les valeurs numériques seraient plus grandes risquerait de déséquilibrer les calculs de distance. À titre d’exemple, une variable mesurée en mètres plutôt qu’en kilomètres produirait des distances euclidiennes 1000 fois plus grandes.</p>
<p>Il est donc nécessaire de standardiser les variables utilisées avant de calculer des distances. Cette opération permet de transformer les variables originales vers une échelle commune. Plusieurs types de transformations peuvent être utilisés tels que décrits à la section @ref(sect02552) :</p>
<ul>
<li><strong>Le centrage et la réduction</strong> qui consistent à soustraire à chaque valeur sa moyenne, puis à la diviser par son écart-type. La nouvelle variable obtenue s’exprime alors en écart-type (appelé aussi score-z). La formule de la transformation est <span class="math inline">\(f(x) = \frac{x - \bar{x}}{\sigma_x}\)</span>, avec <span class="math inline">\(\bar{x}\)</span> la moyenne de <span class="math inline">\(x\)</span> et <span class="math inline">\(\sigma_x\)</span> l’écart-type de <span class="math inline">\(x\)</span>.</li>
<li><strong>La transformation sur une mise à l’échelle de 0 à 1</strong> qui permet de modifier l’étendue d’une variable afin que sa valeur maximale soit de 1 et sa valeur minimale soit de 0. La formule de cette transformation est <span class="math inline">\(f(x) = \frac{x-min(x)}{max(x)-min(x)}\)</span>.</li>
<li><strong>La transformation en rangs</strong> qui consiste à remplacer les valeurs d’une variable par leurs rangs. La valeur la plus faible est remplacée par 1, et la plus forte par <em>n</em> (nombre d’observations). Notez que cette transformation modifie la distribution de la variable originale contrairement aux deux transformations précédentes. Cette propriété peut être désirable si les écarts absolus entre les valeurs ont peu d’importance, si la variable n’a pas été mesurée avec précision ou encore si des valeurs extrêmes sont présentes.</li>
<li><strong>La transformation en percentiles</strong> qui consiste à remplacer les valeurs d’une variable par leur percentile correspondant. Elle peut être vue comme une standardisation de la transformation en rangs, car elle ne dépend pas du nombre d’observations.</li>
</ul>
<p>La figure @ref(fig:impactTransform) montre l’impact de ces transformations sur l’histogramme d’une variable.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/impactTransform-1.png" alt="Impacts de différentes transformations sur la distribution d'une variable" width="80%" />
<p class="caption">
(#fig:impactTransform)Impacts de différentes transformations sur la distribution d’une variable
</p>
</div>
</div>
</div>
<div id="sect13212" class="section level4">
<h4><span class="header-section-number">12.2.1.2</span> Distance de Manhattan</h4>
<p>Cette seconde distance est également couramment utilisée. Elle doit son nom au réseau de rue de l’île de Manhattan qui suit un plan quadrillé. La distance de Manhattan correspond à la somme des écarts absolus entre les valeurs des différentes variables décrivant les observations (équation @ref(eq:manhattandist)). La figure @ref(fig:dist2) illustre que la distance Manhattan (lignes noires) représente les deux côtés opposés de l’hypoténuse d’un triangle rectangle; l’hypoténuse représentant quant à lui la distance euclidienne.</p>

<p><span class="math display">\[\begin{equation}  
d(a,b) = \sum{}^v_{i=1}(|a_i-b_i|)
(\#eq:manhattandist)
\end{equation}\]</span>
</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/dist2-1.png" alt="Représentation de la distance de Manhattan" width="60%" />
<p class="caption">
(#fig:dist2)Représentation de la distance de Manhattan
</p>
</div>
<p>La distance de Manhattan doit être privilégiée à la distance euclidienne lorsque les données considérées ont un très grand nombre de dimensions (variables). En effet, lorsque le nombre de variables est important (supérieur à 30), la distance euclidienne tend à être grande pour toutes les paires d’observations et à moins bien discriminer les observations proches et lointaines les unes des autres. Du fait de sa nature additive, la distance de Manhattan est moins sujette à ce problème <span class="citation">(Aggarwal, Hinneburg et Keim <a href="#ref-aggarwal2001surprising" role="doc-biblioref">2001</a>)</span>.</p>
<p>Calculons la distance de Manhattan pour nos deux paires d’observations :</p>
<ul>
<li><span class="math inline">\(d(A,B)=|85-80|+|80-77| = 8\)</span></li>
<li><span class="math inline">\(d(B,C)=|80-83|+|79-77| = 5\)</span></li>
</ul>
<div style="page-break-after: always;"></div>
</div>
<div id="sect13213" class="section level4">
<h4><span class="header-section-number">12.2.1.3</span> Distance du khi-deux</h4>
<p>La distance du khi-deux est basée sur le test du khi-deux (chapitre @ref(chap05)) et est généralement utilisée pour calculer la distance entre deux histogrammes, deux images ou deux ensembles de mots. Plus précisément, elle permet de mesure la distance entre deux observations A et B, pour lesquels nous disposons d’un ensemble de variables étant toutes des variables de comptage.</p>
<p>Prenons un exemple concret en générant trois histogrammes A, B et C sur l’intervalle [0,50] à partir d’une distribution normale, log-normale et gamma, puis comptons le nombre de valeurs de chaque unité (1,2,3,4, etc.). Ces histogrammes sont représentés à la figure @ref(fig:dist3).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/dist3-1.png" alt="Trois histogrammes pour illustrer le calcul de la distance du chi-deux" width="75%" />
<p class="caption">
(#fig:dist3)Trois histogrammes pour illustrer le calcul de la distance du chi-deux
</p>
</div>
<p>Nous pouvons calculer les distances du khi-deux entre les paires d’histogrammes (tableau @ref(tab:tabdist3)). Nous pouvons ainsi constater que les histogrammes B et C sont les plus semblables.</p>
<table>
<caption>
(#tab:tabdist3)Distance du khi-deux entre trois histogrammes
</caption>
<thead>
<tr>
<th style="text-align:left;">
Histogrammes
</th>
<th style="text-align:right;">
Distance du khi-deux
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A-B
</td>
<td style="text-align:right;">
284,8375
</td>
</tr>
<tr>
<td style="text-align:left;">
A-C
</td>
<td style="text-align:right;">
376,7862
</td>
</tr>
<tr>
<td style="text-align:left;">
B-C
</td>
<td style="text-align:right;">
219,5133
</td>
</tr>
</tbody>
</table>
<p>La formule de cette distance est la suivante :</p>

<p><span class="math display">\[\begin{equation}  
d_{\chi^2}(a,b) = \frac{1}{2}\sum^n_{i=1}\frac{(a_i-b_i)^2}{(a_i+b_i)}
(\#eq:chi2dist)
\end{equation}\]</span>
</p>
<p>Avec <span class="math inline">\(a_i\)</span> et <span class="math inline">\(b_i\)</span> les comptages pour les histogrammes. Notez que si <span class="math inline">\(a_i\)</span> et <span class="math inline">\(b_i\)</span> valent tous les deux 0, il faut retirer ces valeurs avant le calcul, car cela provoquerait une division par 0.</p>
<p>À première vue, cette distance peut paraître moins utile que les deux précédentes. Pourtant, de nombreuses données sont collectées comme des histogrammes. Un premier exemple serait des images que nous pouvons représenter sous forme de trois histogrammes, un pour chaque canal de couleur (rouge, vert et bleu). Un second exemple serait des données sonores, souvent synthétisées sous forme d’histogrammes des fréquences sonores enregistrées (octaves ou tiers d’octaves). Un dernier exemple pourrait être le nombre d’accidents de la route enregistré à diverses intersections d’une ville chaque heure. Dans ce contexte, un histogramme serait formé par intersection avec les heures de la journée comme limites des bandes et le nombre d’accidents comme hauteur des bandes.</p>
</div>
<div id="sect13214" class="section level4">
<h4><span class="header-section-number">12.2.1.4</span> Distance de Mahalanobis</h4>
<p>Proposée dans les années 1930 par le statisticien indien Prasanta Chandra Mahalanobis <span class="citation">(<a href="#ref-chandra1936generalised" role="doc-biblioref">1936</a>)</span>, cette distance se base sur la matrice de covariance des variables analysées. Plus spécifiquement, elle est utilisée pour calculer la distance entre un point et une distribution normale multivariée. Elle permet notamment de tenir compte du fait que certaines variables sont corrélées et ainsi d’éviter de surestimer les distances entre des observations dans des jeux de données comprenant des variables corrélées entre elles.</p>
<p>La formule permettant de calculer cette distance est la suivante :</p>

<p><span class="math display">\[\begin{equation}  
d(a,b) = \sqrt{(a-b)^TS^{-1}(a-b)}
(\#eq:mahalanobis)
\end{equation}\]</span>
</p>
<p>avec <em>S</em> étant la matrice de covariance.</p>
</div>
<div id="sect13215" class="section level4">
<h4><span class="header-section-number">12.2.1.5</span> Distance de Hamming</h4>
<p>Cette distance est utilisée quand les écarts entre les variables de deux observations sont uniquement binaires. Un bon exemple serait un jeu de données ne comprenant que des variables qualitatives, pouvant avoir une valeur identique pour deux observations (distance = 0) ou différente (distance = 1). La distance de Hamming est la simple addition de ces écarts.</p>
<p>Prenons un exemple très simple en prenant trois maisons pour lesquelles nous connaissons cinq caractéristiques @ref(tab:tabdist4)).</p>
<table>
<caption>
(#tab:tabdist4)Exemple de données pour la distance de Hamming
</caption>
<thead>
<tr>
<th style="text-align:left;">
couleur
</th>
<th style="text-align:left;">
jardin
</th>
<th style="text-align:left;">
garage
</th>
<th style="text-align:left;">
cheminée
</th>
<th style="text-align:left;">
sous-sol
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
blanc
</td>
<td style="text-align:left;">
non
</td>
<td style="text-align:left;">
oui
</td>
<td style="text-align:left;">
oui
</td>
<td style="text-align:left;">
non
</td>
</tr>
<tr>
<td style="text-align:left;">
blanc
</td>
<td style="text-align:left;">
non
</td>
<td style="text-align:left;">
non
</td>
<td style="text-align:left;">
oui
</td>
<td style="text-align:left;">
non
</td>
</tr>
<tr>
<td style="text-align:left;">
rouge
</td>
<td style="text-align:left;">
oui
</td>
<td style="text-align:left;">
oui
</td>
<td style="text-align:left;">
non
</td>
<td style="text-align:left;">
oui
</td>
</tr>
</tbody>
</table>
<p>Nous pouvons utiliser la distance de Hamming pour estimer le niveau de dissimilarité entre ces différentes maisons et l’organiser dans une matrice de distances. À la lecture du tableau @ref(tab:tabdist5)), les maisons 2 et 3 sont les plus dissimilaires (distance de Hamming = 5), et les maisons 1 et 2 les plus similaires (distance de Hamming = 1).</p>
<table>
<caption>
(#tab:tabdist5)Distance de Hamming entre les maisons
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
maison 1
</th>
<th style="text-align:center;">
maison 2
</th>
<th style="text-align:center;">
maison 3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
maison 1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
maison 2
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
maison 3
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0
</td>
</tr>
</tbody>
</table>
</div>
<div id="sect13216" class="section level4">
<h4><span class="header-section-number">12.2.1.6</span> Distance de Gower</h4>
<p>La distance de Gower <span class="citation">(<a href="#ref-gower1971general" role="doc-biblioref">1971</a>)</span> peut être utilisée pour mesurer la distance entre deux observations lorsque les données sont à la fois qualitatives et quantitatives. Cette distance est comprise dans un intervalle de 0 à 1, 0 signifiant que les deux observations sont identiques et 1 que les observations sont radicalement différentes.</p>
<p>Elle se calcule de la façon suivante :</p>

<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;d(a,b) = 1-\frac{1}{p}\sum^p_{j=1}s_{12j}\\
&amp;\left\{\begin{array}{c}
s_{xyj} = 1 \text{ si } x_j = y_j \text{, 0 autrement pour une variable qualitative} \\
s_{xyj} =  1 - \frac{|x_j-y_j|}{max(j)-min(j)} \text{ pour une variable quantitative}
\end{array}\right.
\end{aligned}
(\#eq:gower)
\end{equation}\]</span>
</p>
<p>avec :</p>
<ul>
<li><em>p</em> le nombre de variables</li>
<li><em>x</em> et <em>y</em> deux observations</li>
<li><em>j</em> une variable.</li>
</ul>
<p>Autrement dit, si la valeur d’une variable qualitative diffère entre deux observations, la distance entre ces deux observations augmente de <span class="math inline">\(1/p\)</span>. Pour une variable quantitative, la distance augmente selon la différence absolue entre les valeurs de la variable divisée par l’étendue totale de la variable, le tout à nouveau divisé par <em>p</em>.</p>
<p>Si cette mesure semble intéressante puisqu’elle permet de combiner des variables quantitatives et qualitatives, elle souffre de deux limites importantes :</p>
<ul>
<li>Elle ne prend pas en compte le fait que certaines modalités des variables qualitatives sont moins fréquentes ni que certaines combinaisons sont également moins fréquentes.</li>
<li>Les variables qualitatives tendent à affecter bien plus la distance que les variables quantitatives. En effet, pour obtenir un écart de 1 sur une variable quantitative, il faut que les deux valeurs soient respectivement le maximum et le minimum de cette variable.</li>
</ul>
<div class="bloc_aller_loin">
<p><strong>D’autres distances pour des données mixtes</strong></p>
<p>Il existe bien d’autres distances qui peuvent être utilisées dans le cas de données mixtes. Le <em>package</em> <code>kmed</code> en implémente cinq (auxquelles s’ajoute la distance de Gower) dans sa fonction <code>distmix</code> : les distances de Wishart, dePodani, d’Huang, d’Harikumar et d’Ahmad. Ces différentes distances ont toutes leurs avantages et défauts respectifs; pour plus d’information, référez-vous à la documentation de la fonction <code>distmix</code>.</p>
</div>
</div>
<div id="sect13217" class="section level4">
<h4><span class="header-section-number">12.2.1.7</span> Distance du Phi<sup>2</sup></h4>
<p>La distance du <span class="math inline">\(\Phi^2\)</span> (Phi<sup>2</sup>) est une variante de la distance du <span class="math inline">\(\chi^2\)</span>. Il s’agit donc d’une distance à utiliser lorsque les données à analyser sont uniquement qualitatives. Elle calcule la distance entre deux observations en additionnant les différences entre les valeurs de chaque variable (1 si différentes, 0 si identiques, pour chaque variable), divisées respectivement par la fréquence totale d’occurrences de chaque modalité dans le jeu de données. En d’autres termes, cette distance tient compte du fait que certaines valeurs pour des variables qualitatives peuvent être observées plus fréquemment que d’autres et qu’une distance plus grande devrait être obtenue entre deux observations si l’une des deux présente des modalités rares comparativement au reste du jeu de données.</p>
<p>Elle peut être calculée de la façon suivante :</p>

<p><span class="math display">\[\begin{equation}
d_{\Phi^2}(i,j) = \frac{1}{Q}\sum_k\frac{(\delta_{ik} - \delta_{jk})^2}{f_k}
(\#eq:phidist)
\end{equation}\]</span>
</p>
<p>avec :</p>
<ul>
<li><em>i</em> et <em>j</em> deux observations</li>
<li><em>k</em> une modalité d’une variable qualitative</li>
<li><em>Q</em> le nombre total de modalités des variables qualitatives</li>
<li><span class="math inline">\(\delta_{ik} = 1\)</span> si l’observation i a la modalité <em>k</em>, 0 sinon</li>
<li><span class="math inline">\(f_k\)</span> la fréquence de la modalité <em>k</em> dans le jeu de données.</li>
</ul>
<p>La distance du <sup>2</sup> est très utile pour analyser les résultats de questionnaires.</p>
</div>
</div>
<div id="sect1322" class="section level3">
<h3><span class="header-section-number">12.2.2</span> Inertie</h3>
<p>Une notion importante à saisir dans le cadre des méthodes de classification non supervisées est celui de l’<strong>inertie</strong> d’un jeu de données. Il est proche de la notion de variance qui a été présenté dans le chapitre sur la statistique univariée (section @ref(sect0253)).</p>
<p>L’inertie est une quantité permettant de décrire la dispersion des observations d’un jeu de données. Cette mesure dépend à la fois des données (nombres d’observations et de variables, échelle des variables) et de la mesure de distance retenue entre deux observations. Plus spécifiquement, l’inertie correspond à la somme des distances entre chaque observation et le centre du jeu de données.</p>

<p><span class="math display">\[\begin{equation}  
inertie= \sum{}^n_{i=1} d(c,x_i)
(\#eq:inertia)
\end{equation}\]</span>
</p>
<p>avec <em>c</em> le centre du jeu de données, <em>n</em> le nombre d’observations, <em>x</em> une observation et <em>d</em> la fonction calculant la distance entre deux observations.</p>
<p>L’enjeu est de définir <em>c</em>, dans un contexte où la distance euclidienne est utilisée, il s’agit simplement d’une observation fictive dont les coordonnées sont les moyennes des différentes variables du jeu de données. Dans le cas d’autres distances, il peut s’agir de l’observation minimisant la distance à toutes les autres observations.</p>
<p>Pour bien visualiser la notion d’inertie, prenons une fois encore du jeu de données IRIS comme exemple. Admettons que nous ne nous intéressons qu’à deux variables de ce jeu de données : <code>sepal.Length</code> et <code>sepal.Width</code>. Nous pouvons représenter l’inertie totale du jeu de données à la figure @ref(fig:dist6).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/dist6-1.png" alt="Représentation de l'inertie du jeu de données IRIS" width="75%" />
<p class="caption">
(#fig:dist6)Représentation de l’inertie du jeu de données IRIS
</p>
</div>
<p>Chaque ligne bleue représente la contribution de chaque point à l’inertie totale du jeu de données. Pour chaque IRIS, nous connaissons son espèce (Setosa, Versicolor ou Virginica). Nous pouvons donc attribuer chaque point de ce jeu de données à un groupe (une espèce dans notre cas). Il devient alors possible de calculer l’inertie de chacun des sous-groupes de notre jeu de données. Pour cela, nous devons calculer le centre de chaque groupe (généralement les moyennes des variables des observations au sein d’un groupe) et ensuite calculer l’inertie entre chaque observation et le centre de son groupe. Nous représentons cette situation à la figure @ref(fig:dist7).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/dist7-1.png" alt="Représentation de l'inertie par groupe pour le jeu de données IRIS" width="75%" />
<p class="caption">
(#fig:dist7)Représentation de l’inertie par groupe pour le jeu de données IRIS
</p>
</div>
<p>Cette inertie propre aux groupes est toujours inférieure ou égale à l’inertie totale du jeu de données. Il s’agit en réalité de l’inertie que la structure de groupe n’est pas en mesure d’expliquer. En utilisant ces concepts, il est possible de calculer la part de l’inertie totale expliquée par les groupes (équation @ref(eq:explainedinertia)) :</p>

<p><span class="math display">\[\begin{equation}  
\text{inertie expliquée} = 1-\frac{\text{inertie totale}}{\text{inertie restante}}
(\#eq:explainedinertia)
\end{equation}\]</span>
</p>
<p>Cette valeur nous renseigne sur la capacité d’une classification à bien réduire l’inertie totale d’un jeu de données. Elle est comprise entre 0 et 1. Si l’inertie expliquée est à 0, c’est que la classification n’explique absolument aucune part de l’inertie totale. Si l’inertie expliquée est à 1, la classification utilisée explique l’intégralité de l’inertie, ce qui en pratique n’est atteignable que si le nombre de groupes de la classification est égal au nombre d’observations. En d’autres termes, chaque observation est attribuée à un groupe dont elle est la seule représentante. Un telle situation n’a aucun intérêt puisque l’objectif d’une classification est bien de réduire la complexité d’un jeu de données en regroupant les observations.</p>
</div>
</div>
<div id="sect133" class="section level2">
<h2><span class="header-section-number">12.3</span> Classification ascendante hiérarchique</h2>
<p>La classification ascendante hiérarchique (CAH) est un algorithme de classification non supervisée dont l’objectif est de créer un arbre de classification des observations. Cet arbre est ensuite utilisé pour déterminer le nombre de groupes à former et à quel groupe appartient chaque observation.</p>
<div id="sect1331" class="section level3">
<h3><span class="header-section-number">12.3.1</span> Fonctionnement de l’algorithme</h3>
<p>La classification ascendante hiérarchique est un algorithme permettant de regrouper les observations d’un jeu de données de façon itérative. À chaque itération, deux observations similaires sont agrégées en un groupe représenté par le point central entre les deux observations. Le processus est ensuite répété en considérant le nouveau point comme une observation jusqu’à ce que toutes les observations soient fusionnées en un seul groupe.</p>
<p>Ces regroupements successifs créent un arbre de classification appelé dendrogramme. La racine de cet arbre est le groupe unique fusionnant toutes les observations, et ses branches correspondent aux différentes agrégrations effectuées jusqu’aux observations individuelles. Cet arbre peut être vu comme une hiérarchie de classification. Chaque niveau de l’arbre est un regroupement de plus en plus généraliste au fur et à mesure que nous nous approchons de sa racine.</p>
<p>Pour appliquer cette méthode, il est nécessaire de sélectionner une <strong>fonction de distance</strong> pour mesurer la dissimilarité ou la ressemblance entre deux observations. L’algorithme fonctionne avec n’importe quelle fonction de distance ce qui permet de l’appliquer aussi bien à des données qualitatives que quantitatives. En effet, l’opération de regroupement des observations se base sur une matrice de distance, soit un tableau de taille <em>n x n</em> indiquant pour chaque paire d’observations leur degré de dissimilarité. La figure @ref(fig:tablvsmat)) illustre cette transformation en appliquant la distance du <span class="math inline">\(\Phi^2\)</span> à un jeu de données comprenant cinq observations et 5 variables qualitatives.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/tablvsmat-1.png" alt="Du tableau de données à la matrice de distance" width="100%" />
<p class="caption">
(#fig:tablvsmat)Du tableau de données à la matrice de distance
</p>
</div>
<p>En plus de la fonction de distance, il est également nécessaire de sélectionner un <strong>critère d’agrégation</strong>, soit la règle permettant de décider à chaque itération quelles observations doivent être regroupées. Les méthodes les plus courantes sont :</p>
<ul>
<li>Le critère de Ward <span class="citation">(<a href="#ref-ward1963hierarchical" role="doc-biblioref">1963</a>)</span> : cette méthode consiste à agréger à chaque itération les deux observations permettant de minimiser la variance (ou inertie) intra-groupe, ce qui revient à maximiser l’inertie inter-groupe (autrement dit, à rendre les groupes les plus homogènes possibles et les plus dissemblables entre eux). Ainsi, l’enjeu est de fusionner les deux observations permettant d’avoir les groupes les plus dissimilaires possible après fusion.</li>
<li>Le lien complet : à chaque itération, les deux groupes d’observations associés sont ceux pour lesquels la distance maximale entre les observations les composants est la plus petite parmi tous les groupes.</li>
<li>Le lien simple : à chaque itération, les deux groupes d’observations associés sont ceux pour lesquels la distance minimum entre les observations les composants est la plus petite parmi tous les groupes.</li>
</ul>
<p>La plus utilisée est de loin la méthode de Ward. La méthode du lien complet produit généralement des résultats similaires. En revanche, la méthode du lien simple peut produire des groupes non sphériques (non centrés sur leur moyenne) plus difficle à interpréter.</p>
<p>Prenons un instant pour visualiser cet algorithme (figure @ref(fig:animhclust)). Cette animation a été réalisée par David Sheehan et est également accessible sur son <a href="https://dashee87.github.io/data%20science/general/Clustering-with-Scikit-with-GIFs/">blog</a>. Elle présente bien le processus d’agglomération de la classification ascendante hiérarchique et la construction progressive du dendrogramme.</p>
<div class="figure" style="text-align: center">
<img src="images/classification/CAH.gif" alt="Principe de fonctionnement de la classification ascendante hiérarchique (auteur : David Sheehan)" width="75%" />
<p class="caption">
(#fig:animhclust)Principe de fonctionnement de la classification ascendante hiérarchique (auteur : David Sheehan)
</p>
</div>
</div>
<div id="sect1332" class="section level3">
<h3><span class="header-section-number">12.3.2</span> Choisir le bon nombre de groupes</h3>
<p>Une fois que l’algorithme a été appliqué aux données et le dendrogramme obtenu, il faut encore choisir le nombre optimal de groupes pour la classification finale. Chaque embranchement du dendrogramme constitue une classification possible, allant de la plus complexe (chaque observation appartient à un groupe formé d’elle seule) à la plus simple (toutes les observations appartiennent au même groupe). Si le nombre de groupes n’est pas connu à l’avance et qu’aucune forte justification théorique n’existe, il est possible d’utiliser plusieurs techniques pour déterminer un nombre de groupes judicieux à partir des données. Nous en présentons ici trois, mais il convient de ne pas s’en tenir uniquement à ses critères arbitraires. Il est important d’explorer les résultats de la classification obtenue pour plusieurs valeurs de <em>k</em> candidates et de tenir compte de la qualité des informations qu’elles fournissent. Au final, il est pertinent de retenir la classification dont les résultats offrent l’interprétation la plus claire avec un nombre de groupes réduit (principe de parcimonie).</p>
<div id="sect13321" class="section level4">
<h4><span class="header-section-number">12.3.2.1</span> Méthode du coude</h4>
<p>Cette première approche est la plus simple à mettre en oeuvre. Il s’agit simplement de produire plusieurs classifications à partir du dendrogramme avec différentes valeurs de <em>k</em> (nombre de groupes) et de calculer à chaque fois la part de l’inertie expliquée. Chaque groupe supplémentaire ne peut qu’améliorer l’inertie expliquée, car pour rappel, si <span class="math inline">\(k=n\)</span>, alors nous expliquons 100 % de l’inertie totale. L’objectif est de déterminer à quel moment l’ajout d’un groupe supplémentaire ne contribue que de façon marginale à améliorer l’inertie expliquée. Si nous représentons les valeurs d’inertie expliquée pour les différentes valeurs de <em>k</em> dans un graphique, une rupture (un coude) indiquerait ce point au-delà duquel les groupes supplémentaires ne captent finalement que du bruit et non plus de l’information.</p>
<p>Si nous reprenons l’exemple du jeu de données iris, nous pouvons créer ce graphique avec <em>k</em> allant de 2 à 10 (figure @ref(fig:kmeans2)). Un premier coude très net est observable pour <span class="math inline">\(k = 3\)</span> et un second plus faible, mais tout de même marqué pour <span class="math inline">\(k = 4\)</span>.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeans2-1.png" alt="Méthode du coude" width="75%" />
<p class="caption">
(#fig:kmeans2)Méthode du coude
</p>
</div>
<div class="bloc_notes">
<p><strong>Inertie expliquée et centre de groupe</strong></p>
<p>Pour calculer l’inertie expliquée, il est nécessaire de pouvoir déterminer pour chaque groupe son centre (ou centroïde). Lorsque la distance euclidienne est utilisée, il s’agit simplement de calculer pour chaque groupe la valeur moyenne des différentes colonnes des observations de ce groupe. Cependant, lorsque d’autres distances sont utilisées, il peut être plus difficile de déterminer le centre d’un groupe. Avec la distance de Manhattan, il est par exemple recommandé d’utiliser la médiane des colonnes plutôt que la moyenne. Pour la distance de Hamming, la moyenne peut aussi être utilisée, car elle représente pour cette distance la fréquence d’occurrence des différentes modalités des variables qualitatives. Pour d’autres distances plus complexes, il est préférable de définir le centre d’un groupe comme le point de ce groupe minimisant les distances à tous les autres points du groupe. Il s’agit du médioïde du groupe.</p>
</div>
</div>
<div id="sect13322" class="section level4">
<h4><span class="header-section-number">12.3.2.2</span> Indicateur de silhouette</h4>
<p>Si un coude net ne s’observe pas pour la méthode précédente, il est possible d’utiliser l’indicateur de silhouette. Il permet de mesurer pour une classification à quel point une observation est similaire à celles dans son propre groupe (cohésion) comparativement aux observations des autres groupes. Elle se calcule de la façon suivante :</p>

<p><span class="math display">\[\begin{equation}  
\begin{aligned}
s(i) &amp;= \frac{b(i)-a(i)}{\max \{a(i), b(i)\}} \\
a(i) &amp;= \frac{1}{|C_i|-1}\sum_{j \in C_i,i \neq j}d(i,j) \\
b(i) &amp;= min_{i \neq j}\frac{1}{|C_j|}\sum_{j \in C_j}d(i,j)
\end{aligned}
(\#eq:silhouetteidx)
\end{equation}\]</span>
</p>
<p>avec :</p>
<ul>
<li><span class="math inline">\(s(i)\)</span> la valeur de l’indice de silhouette pour l’observation <em>i</em>,</li>
<li><span class="math inline">\(a(i)\)</span> la distance moyenne entre l’observation <em>i</em> et son groupe <span class="math inline">\(C_i\)</span>,</li>
<li><span class="math inline">\(b(i)\)</span> la distance minimale entre l’observation <em>i</em> et le centre de chaque autre groupe <span class="math inline">\(C_j\)</span>.</li>
</ul>
<p>La valeur totale de l’indice est simplement la moyenne des valeurs moyennes des indices de silhouette au sein de chaque groupe. Une valeur plus élevée indique une meilleure classification. Il est nécessaire de déterminer le centre des groupes pour calculer cet indicateur ce qui peut être un exercice difficile quand une distance autre que la distance euclidienne est utilisée, référez-vous à la note de la section précédente pour plus d’informations. L’indice de silhouette semble indiquer que seulement trois groupes serait un choix optimal, soit la valeur la plus haute (figure @ref(fig:kmeans3)).</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeans3-1.png" alt="Méthode de l'indice de silhouette" width="75%" />
<p class="caption">
(#fig:kmeans3)Méthode de l’indice de silhouette
</p>
</div>
</div>
<div id="sect13323" class="section level4">
<h4><span class="header-section-number">12.3.2.3</span> Méthode GAP</h4>
<p>Cette méthode, proposée par <span class="citation">Tibshirani, Walther et Hastie (<a href="#ref-tibshirani2001estimating" role="doc-biblioref">2001</a>)</span>, consiste à comparer l’inertie intra-groupe (inexpliquée) avec l’inertie observée pour un jeu de données généré aléatoirement (distribution uniforme des valeurs entre le minimum et le maximum de chaque variable) pour différentes valeurs successives de <em>k</em>. Une fois ces calculs effectués, l’objectif est de trouver la valeur de <em>k</em> tel que la valeur de GAP à <em>k+1</em> n’est pas plus grande qu’un écart type pour GAP à <em>k+1</em>.</p>
<p>La statistique GAP est calculée ainsi :</p>

<p><span class="math display">\[\begin{equation}  
\begin{aligned}
GAP(k) = \frac{1}{\text{nsim}} \sum^{\text{nsim}}_{\text{sim} = 1} log(W_{ksim}) - log(W_k)
\end{aligned}
(\#eq:gapidx)
\end{equation}\]</span>
</p>
<p>avec :</p>
<ul>
<li><span class="math inline">\(W_k\)</span> l’inertie non expliquée (intra-groupe)</li>
<li><span class="math inline">\(W_{ksim}\)</span> l’inertie non expliquée (intra-groupe) obtenue pour un jeu de données simulé</li>
<li><em>k</em> le nombre de groupes</li>
</ul>
<p>L’idée est qu’une bonne classification doit produire des résultats plus structurés que ce que nous pourrions attendre du hasard. Chaque groupe supplémentaire permet de réduire l’inertie, mais lorsque l’ajout d’un groupe ne permet pas un gain significatif comparativement au hasard, alors l’ajout de ce groupe ne se justifie pas. À nouveau, il est possible de visualiser la situation avec un simple graphique (figure @ref(fig:kmeans4)). Selon cette méthode, il faudrait sélectionner 4 groupes car, il s’agit de la première valeur de <em>k</em> validant le critère de cette méthode. La seconde valeur retenue par cette méthode est 6.</p>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeans4-1.png" alt="Méthode GAP" width="75%" />
<p class="caption">
(#fig:kmeans4)Méthode GAP
</p>
</div>
</div>
</div>
<div id="sect1333" class="section level3">
<h3><span class="header-section-number">12.3.3</span> Limites de la classification ascendante hiérarchique</h3>
<p>Bien que très flexible (choix de la fonction de distance et du critère d’agrégation), la CAH fait face à un enjeu majeur : la vitesse d’exécution et la consommation de mémoire lorsque des grands jeux de données sont utilisés. En effet, il est nécessaire de calculer à chaque étape une matrice de distance entre les groupes. Si un jeu de données comprend 1 000 observations, cette matrice comprend donc 1 000 x 1 000 cases soit un million de distances. Même en divisant ce nombre par deux (les éléments de la matrice sont symétriques, donc <span class="math inline">\(d(ij) = d(ji)\)</span>) ce nombre augmente avec le carré du nombre d’observations. Pour de grands jeux de données, elle peut donc échouer à cause des limites de l’ordinateur utilisé. Il existe des versions plus performantes de l’algorithme réduisant cette limite, mais il convient de la garder en mémoire. Quand un très grand jeu de données doit être analysé, les méthodes des nuées dynamiques sont une alternative à considérer.</p>
</div>
<div id="sect1334" class="section level3">
<h3><span class="header-section-number">12.3.4</span> Mise en oeuvre dans R</h3>
<p>Nous proposons ici un exemple issu d’un article portant sur les parcs urbains de Montréal <span class="citation">(Apparicio et al. <a href="#ref-apparicio2010accessibilite" role="doc-biblioref">2010</a>)</span>, dont l’objectif était notamment de classifier ces parcs en fonction de leur superficie et des équipements qu’ils comprennent, et ce, en utilisant la classification ascendante hiérarchique. Nous proposons ici de reproduire l’étape de classification effectuée dans cet article. La base de données comporte 653 parcs pour lesquels la présence de 18 équipements est codée comme un ensemble de variables binaires (0 signifiant absence et 1 présence). Nous disposons également de la taille de ces parcs, recodée en cinq catégories : moins d’un hectare, de 1 à 5 hectares, de 5 à 10 hectares, de 10 à 20 hectares et 20 hectares et plus. Le tableau @ref(tab:exampleHclust1DF) indique le nombre d’équipements recensés dans les parcs.</p>
<table>
<caption>
(#tab:exampleHclust1DF)Équipements recensés dans les différents parcs de Montréal
</caption>
<thead>
<tr>
<th style="text-align:left;">
Équipements
</th>
<th style="text-align:right;">
N
</th>
</tr>
</thead>
<tbody>
<tr grouplength="3">
<td colspan="2" style="border-bottom: 1px solid;">
<strong>Équipements pour les 0 à 4 ans</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Aire de jeux
</td>
<td style="text-align:right;">
601
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Pataugeoire
</td>
<td style="text-align:right;">
161
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Jeux d’eau
</td>
<td style="text-align:right;">
28
</td>
</tr>
<tr grouplength="7">
<td colspan="2" style="border-bottom: 1px solid;">
<strong>Terrains de sport</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Baseball
</td>
<td style="text-align:right;">
188
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Football (soccer)
</td>
<td style="text-align:right;">
169
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Basketball
</td>
<td style="text-align:right;">
144
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Tennis
</td>
<td style="text-align:right;">
125
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Football américain
</td>
<td style="text-align:right;">
36
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Volleyball
</td>
<td style="text-align:right;">
24
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Athlétisme
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr grouplength="4">
<td colspan="2" style="border-bottom: 1px solid;">
<strong>Équipements d’hiver</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Patinoire extérieure
</td>
<td style="text-align:right;">
241
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Glissade
</td>
<td style="text-align:right;">
30
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Piste de ski de fond
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Piste de raquette
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr grouplength="2">
<td colspan="2" style="border-bottom: 1px solid;">
<strong>Équipements spécialisés</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Parc de planches à roulettes
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Patins à roues alignées
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr grouplength="2">
<td colspan="2" style="border-bottom: 1px solid;">
<strong>Autres équipements</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Piscine intérieure
</td>
<td style="text-align:right;">
92
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Randonnée
</td>
<td style="text-align:right;">
15
</td>
</tr>
</tbody>
</table>
<p>Puisque notre jeu de données ne comporte que des variables qualitatives, nous allons utiliser la distance du <span class="math inline">\(\Phi^2\)</span> pour construire notre matrice de distance entre les parcs. Notons que dans l’article original la distance euclidienne au carrée avait été utilisée, nous n’obtiendrons probablement pas les mêmes résultats, car la distance du <span class="math inline">\(\Phi^2\)</span> tient compte des fréquences d’occurrence des modalités des variables qualitatives.</p>
<div id="sect13341" class="section level4">
<h4><span class="header-section-number">12.3.4.1</span> Calcul de la matrice de distance</h4>
<p>La première étape consiste donc à charger notre jeu de données et à calculer la matrice de distance.</p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="#cb1085-1"></a><span class="co"># chargement du jeu de données et sélection des colonnes pour l&#39;analyse</span></span>
<span id="cb1085-2"><a href="#cb1085-2"></a>parcs &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/classification/Parcs.txt&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1085-3"><a href="#cb1085-3"></a>X &lt;-<span class="st"> </span>parcs[<span class="kw">c</span>(<span class="dv">5</span><span class="op">:</span><span class="dv">22</span>, <span class="dv">27</span>)]</span></code></pre></div>
<p>Pour calculer la distance du <span class="math inline">\(\Phi^2\)</span>, nous utilisons la fonction <code>dist</code> du <em>package</em> <code>proxy</code> avec le paramètre <code>method = "Phi-squared"</code>. Elle requiert que l’ensemble des variables catégorielles soient converties en variables binaires. Pour cela, nous pouvons utiliser la fonction <code>dummy_cols</code> du <em>package</em> <code>fastDummies</code></p>
<div class="sourceCode" id="cb1086"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1086-1"><a href="#cb1086-1"></a><span class="kw">library</span>(fastDummies)</span>
<span id="cb1086-2"><a href="#cb1086-2"></a><span class="kw">library</span>(proxy)</span>
<span id="cb1086-3"><a href="#cb1086-3"></a></span>
<span id="cb1086-4"><a href="#cb1086-4"></a>X &lt;-<span class="st"> </span><span class="kw">dummy_cols</span>(X,<span class="dt">select_columns =</span> <span class="st">&quot;HaTypo&quot;</span>,<span class="dt">remove_selected_columns =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1086-5"><a href="#cb1086-5"></a>parc_distances &lt;-<span class="st"> </span><span class="kw">dist</span>(<span class="kw">as.matrix</span>(X), <span class="dt">method =</span> <span class="st">&quot;Phi-squared&quot;</span>)</span></code></pre></div>
</div>
<div id="sect13342" class="section level4">
<h4><span class="header-section-number">12.3.4.2</span> Application de l’algorithme de classification ascendante hiérarchique</h4>
<p>Une fois la matrice obtenue, il ne reste plus qu’à appliquer la fonction <code>hclust</code> disponible de base dans R pour obtenir le dendrogramme. Comme dans l’article, nous utilisons le critère d’agrégation de Ward pour la création des groupes.</p>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="#cb1087-1"></a>dendogramme_parcs &lt;-<span class="st"> </span><span class="kw">hclust</span>(parc_distances, <span class="dt">method =</span> <span class="st">&quot;ward.D&quot;</span>)</span></code></pre></div>
<p>Puisque nous n’utilisons pas la distance euclidienne, nous optons ici pour l’indice de silhouette pour déterminer le nombre adéquat de groupes à former. Nous testons toutes les valeurs comprises entre 2 et 10.</p>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1088-1"><a href="#cb1088-1"></a><span class="kw">library</span>(cluster)</span>
<span id="cb1088-2"><a href="#cb1088-2"></a>ks &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb1088-3"><a href="#cb1088-3"></a></span>
<span id="cb1088-4"><a href="#cb1088-4"></a><span class="co"># Calcul des indices de Silhouette pour les différentes valeurs de k</span></span>
<span id="cb1088-5"><a href="#cb1088-5"></a>values &lt;-<span class="st"> </span><span class="kw">sapply</span>(ks, <span class="cf">function</span>(k){</span>
<span id="cb1088-6"><a href="#cb1088-6"></a>  <span class="co"># découpage du dendrogramme</span></span>
<span id="cb1088-7"><a href="#cb1088-7"></a>  groupes &lt;-<span class="st"> </span><span class="kw">cutree</span>(dendogramme_parcs, <span class="dt">k =</span> k)</span>
<span id="cb1088-8"><a href="#cb1088-8"></a>  <span class="co"># calcul des valeurs de silhouette</span></span>
<span id="cb1088-9"><a href="#cb1088-9"></a>  sil &lt;-<span class="st"> </span><span class="kw">silhouette</span>(groupes, <span class="dt">dist =</span> parc_distances)</span>
<span id="cb1088-10"><a href="#cb1088-10"></a>  <span class="co"># extraction de l&#39;indice global (moyenne des moyennes)</span></span>
<span id="cb1088-11"><a href="#cb1088-11"></a>  idx &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">summary</span>(sil)<span class="op">$</span>clus.avg.widths)</span>
<span id="cb1088-12"><a href="#cb1088-12"></a>  <span class="kw">return</span>(idx)</span>
<span id="cb1088-13"><a href="#cb1088-13"></a>})</span>
<span id="cb1088-14"><a href="#cb1088-14"></a></span>
<span id="cb1088-15"><a href="#cb1088-15"></a><span class="co"># Création d&#39;un graphique avec les résultats</span></span>
<span id="cb1088-16"><a href="#cb1088-16"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">k =</span> ks,  <span class="dt">silhouette =</span> values)</span>
<span id="cb1088-17"><a href="#cb1088-17"></a><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1088-18"><a href="#cb1088-18"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> silhouette)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1088-19"><a href="#cb1088-19"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> silhouette), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1088-20"><a href="#cb1088-20"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;nombre de groupes&quot;</span>, <span class="dt">y=</span><span class="st">&quot;indice global de silhouette&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/exampleHclust4-1.png" alt="Valeur de l'indice de silhouette pour différents nombres de groupes" width="75%" />
<p class="caption">
(#fig:exampleHclust4)Valeur de l’indice de silhouette pour différents nombres de groupes
</p>
</div>
<p>Si nous écartons d’emblée les résultats pour k = 2 et k = 3 (trop peu de groupes pour l’interprétation), nous constatons que la solution optimale selon ce critère serait k = 5. Dans l’article original, la solution k = 6 avait été retenue en examinant le dendrogramme. Comparons les résultats pour k = 5 et k = 6.</p>
<div class="sourceCode" id="cb1089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1089-1"><a href="#cb1089-1"></a>resk5 &lt;-<span class="st"> </span><span class="kw">cutree</span>(dendogramme_parcs, <span class="dt">k =</span> <span class="dv">5</span>)</span>
<span id="cb1089-2"><a href="#cb1089-2"></a>resk6 &lt;-<span class="st"> </span><span class="kw">cutree</span>(dendogramme_parcs, <span class="dt">k =</span> <span class="dv">6</span>)</span>
<span id="cb1089-3"><a href="#cb1089-3"></a>sil5 &lt;-<span class="st"> </span><span class="kw">silhouette</span>(resk5, <span class="dt">dist =</span> parc_distances)</span>
<span id="cb1089-4"><a href="#cb1089-4"></a>sil6 &lt;-<span class="st"> </span><span class="kw">silhouette</span>(resk6, <span class="dt">dist =</span> parc_distances)</span>
<span id="cb1089-5"><a href="#cb1089-5"></a></span>
<span id="cb1089-6"><a href="#cb1089-6"></a><span class="co"># résumé pour l&#39;indice de Silhouette pour k = 5</span></span>
<span id="cb1089-7"><a href="#cb1089-7"></a><span class="kw">summary</span>(sil5)</span></code></pre></div>
<pre><code>## Silhouette of 693 units in 5 clusters from silhouette.default(x = resk5, dist = parc_distances) :
##  Cluster sizes and average silhouette widths:
##         116         212         246          84          35 
##  0.07029553  1.00000000 -0.11827930 -0.19969707  1.00000000 
## Individual silhouette widths:
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -0.62041 -0.08502  0.09814  0.30200  1.00000  1.00000</code></pre>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="#cb1091-1"></a><span class="co"># résumé pour l&#39;indice de Silhouette pour k = 6</span></span>
<span id="cb1091-2"><a href="#cb1091-2"></a><span class="kw">summary</span>(sil6)</span></code></pre></div>
<pre><code>## Silhouette of 693 units in 6 clusters from silhouette.default(x = resk6, dist = parc_distances) :
##  Cluster sizes and average silhouette widths:
##         116         212         197          49          84          35 
##  0.05906553  1.00000000 -0.10289391  0.07935325 -0.19969707  1.00000000 
## Individual silhouette widths:
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -0.62041 -0.06414  0.10998  0.31846  1.00000  1.00000</code></pre>
<p>Nous constatons que le groupe supplémentaire vient séparer le groupe trois comprenant 246 parcs dans la solution avec k = 5. Ce dernier ne comprend plus que 197 parcs pour la solution k = 6 et le nouveau groupe en compte 49. Ce nouveau groupe à un indice de silhouette moyen relativement faible (0,079), et le fait de découper le groupe trois améliore très peu sa propre valeur (passant de -0,12 à -0,10). Nous retenons cependant ici la solution avec k = 6 afin de tenter de reproduire les résultats de l’article.</p>
</div>
<div id="sect13343" class="section level4">
<h4><span class="header-section-number">12.3.4.3</span> Interprétation des résultats</h4>
<p>La dernière étape consiste à identifier les groupes obtenus et leur attribuer un intitulé en fonction de leurs caractéristiques. Dans notre cas, la classification ne comporte que des variables binaires, nous pouvons donc calculer le pourcentage de valeurs à 1 (présence d’un équipement) dans chacun des groupes.</p>
<div class="sourceCode" id="cb1093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1093-1"><a href="#cb1093-1"></a><span class="co"># calcul du nombre de fois où chaque modalité est observée dans un groupe</span></span>
<span id="cb1093-2"><a href="#cb1093-2"></a>X<span class="op">$</span>groupe &lt;-<span class="st"> </span>resk6</span>
<span id="cb1093-3"><a href="#cb1093-3"></a>df_groupes &lt;-<span class="st"> </span>X <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1093-4"><a href="#cb1093-4"></a><span class="st">  </span><span class="kw">group_by</span>(groupe) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(<span class="dt">.funs =</span> sum)</span>
<span id="cb1093-5"><a href="#cb1093-5"></a></span>
<span id="cb1093-6"><a href="#cb1093-6"></a><span class="co"># calcul du nombre d&#39;observations par groupe</span></span>
<span id="cb1093-7"><a href="#cb1093-7"></a>nb_gp &lt;-<span class="st"> </span><span class="kw">table</span>(resk6)</span>
<span id="cb1093-8"><a href="#cb1093-8"></a>groupe_ratios &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">as.matrix</span>(df_groupes)[,<span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(df_groupes)] <span class="op">/</span><span class="st"> </span><span class="kw">as.vector</span>(nb_gp),<span class="dv">1</span>)</span>
<span id="cb1093-9"><a href="#cb1093-9"></a>groupe_ratios &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(groupe_ratios))</span>
<span id="cb1093-10"><a href="#cb1093-10"></a><span class="kw">names</span>(groupe_ratios) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;groupe &quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(groupe_ratios))</span>
<span id="cb1093-11"><a href="#cb1093-11"></a></span>
<span id="cb1093-12"><a href="#cb1093-12"></a><span class="co"># calcul du nombre moyen d&#39;équipements par catégorie par parc</span></span>
<span id="cb1093-13"><a href="#cb1093-13"></a>equip_class &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1093-14"><a href="#cb1093-14"></a>  <span class="kw">c</span>(<span class="st">&quot;AIRE_JEUX&quot;</span>, <span class="st">&quot;JEUX_EAU&quot;</span>, <span class="st">&quot;PATAUGEOIRE&quot;</span>),</span>
<span id="cb1093-15"><a href="#cb1093-15"></a>  <span class="kw">c</span>(<span class="st">&quot;ATHLETISME&quot;</span>, <span class="st">&quot;BASEBALL_S&quot;</span>, <span class="st">&quot;BASKETBALL&quot;</span>, <span class="st">&quot;FOOTBALL&quot;</span>, <span class="st">&quot;SOCCER&quot;</span>, <span class="st">&quot;TENNIS&quot;</span>, <span class="st">&quot;VOLLEY_BALL&quot;</span>),</span>
<span id="cb1093-16"><a href="#cb1093-16"></a>  <span class="kw">c</span>(<span class="st">&quot;TOBBOGAN_G&quot;</span>, <span class="st">&quot;PATINOIRE_E&quot;</span>, <span class="st">&quot;RAQUETTES&quot;</span>, <span class="st">&quot;SKI_FOND&quot;</span>),</span>
<span id="cb1093-17"><a href="#cb1093-17"></a>  <span class="kw">c</span>(<span class="st">&quot;PATIN_ROUE&quot;</span>, <span class="st">&quot;ROULI_ROUL&quot;</span>),</span>
<span id="cb1093-18"><a href="#cb1093-18"></a>  <span class="kw">c</span>(<span class="st">&quot;PISC_EXT&quot;</span>, <span class="st">&quot;RANDONNEE&quot;</span>)</span>
<span id="cb1093-19"><a href="#cb1093-19"></a>)</span>
<span id="cb1093-20"><a href="#cb1093-20"></a></span>
<span id="cb1093-21"><a href="#cb1093-21"></a>class_compte &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">sapply</span>(equip_class, <span class="cf">function</span>(equip){</span>
<span id="cb1093-22"><a href="#cb1093-22"></a>  <span class="kw">rowSums</span>(X[equip])</span>
<span id="cb1093-23"><a href="#cb1093-23"></a>}))</span>
<span id="cb1093-24"><a href="#cb1093-24"></a><span class="kw">names</span>(class_compte) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;enfants&quot;</span>, <span class="st">&quot;terrain_sport&quot;</span>, <span class="st">&quot;hiver&quot;</span>, <span class="st">&quot;specialise&quot;</span>, <span class="st">&quot;autre&quot;</span>)</span>
<span id="cb1093-25"><a href="#cb1093-25"></a>class_compte<span class="op">$</span>groupe &lt;-<span class="st"> </span>resk6</span>
<span id="cb1093-26"><a href="#cb1093-26"></a>df_class_equip &lt;-<span class="st"> </span>class_compte <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1093-27"><a href="#cb1093-27"></a><span class="st">  </span><span class="kw">group_by</span>(groupe) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1093-28"><a href="#cb1093-28"></a><span class="st">  </span><span class="kw">summarise_all</span>(mean)</span>
<span id="cb1093-29"><a href="#cb1093-29"></a></span>
<span id="cb1093-30"><a href="#cb1093-30"></a>df_class_equip &lt;-<span class="st"> </span><span class="kw">t</span>(df_class_equip[<span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(df_class_equip)])</span>
<span id="cb1093-31"><a href="#cb1093-31"></a><span class="kw">colnames</span>(df_class_equip) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;groupe &quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(df_class_equip))</span>
<span id="cb1093-32"><a href="#cb1093-32"></a></span>
<span id="cb1093-33"><a href="#cb1093-33"></a><span class="co"># comptage du nombre moyen total d&#39;équipements</span></span>
<span id="cb1093-34"><a href="#cb1093-34"></a>df_equip_tot &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1093-35"><a href="#cb1093-35"></a>  <span class="dt">nb =</span> <span class="kw">rowSums</span>(X[<span class="dv">1</span><span class="op">:</span><span class="dv">18</span>]),</span>
<span id="cb1093-36"><a href="#cb1093-36"></a>  <span class="dt">groupe =</span> resk6</span>
<span id="cb1093-37"><a href="#cb1093-37"></a>)</span>
<span id="cb1093-38"><a href="#cb1093-38"></a>df_equip_tot_mean &lt;-<span class="st"> </span>df_equip_tot <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1093-39"><a href="#cb1093-39"></a><span class="st">  </span><span class="kw">group_by</span>(groupe) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1093-40"><a href="#cb1093-40"></a><span class="st">  </span><span class="kw">summarize_all</span>(mean)</span>
<span id="cb1093-41"><a href="#cb1093-41"></a></span>
<span id="cb1093-42"><a href="#cb1093-42"></a><span class="co"># mise dans l&#39;ordre de la première partie du tableau</span></span>
<span id="cb1093-43"><a href="#cb1093-43"></a>all_types &lt;-<span class="st"> </span><span class="kw">do.call</span>(c,equip_class)</span>
<span id="cb1093-44"><a href="#cb1093-44"></a>idxs &lt;-<span class="st"> </span><span class="kw">match</span>(all_types,<span class="kw">row.names</span>(groupe_ratios[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(all_types),]))</span>
<span id="cb1093-45"><a href="#cb1093-45"></a>groupe_ratios &lt;-<span class="st"> </span><span class="kw">rbind</span>(groupe_ratios[idxs,],</span>
<span id="cb1093-46"><a href="#cb1093-46"></a>                       groupe_ratios[(<span class="kw">length</span>(all_types)<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">nrow</span>(groupe_ratios),])</span>
<span id="cb1093-47"><a href="#cb1093-47"></a></span>
<span id="cb1093-48"><a href="#cb1093-48"></a><span class="co"># combinaison des deux tableaux</span></span>
<span id="cb1093-49"><a href="#cb1093-49"></a>groupe_ratios &lt;-<span class="st"> </span><span class="kw">rbind</span>(groupe_ratios, df_class_equip, df_equip_tot_mean<span class="op">$</span>nb, <span class="kw">as.integer</span>(nb_gp))</span></code></pre></div>
<p>Il est ensuite possible d’afficher le tableau obtenu pour l’interpréter. Les résultats sont ici rapportés au tableau @ref(tab:exampleHclust7).</p>
<table>
<caption>
(#tab:exampleHclust7)Caractéristiques des groupes obtenus lors de la CAH
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
groupe 1
</th>
<th style="text-align:right;">
groupe 2
</th>
<th style="text-align:right;">
groupe 3
</th>
<th style="text-align:right;">
groupe 4
</th>
<th style="text-align:right;">
groupe 5
</th>
<th style="text-align:right;">
groupe 6
</th>
</tr>
</thead>
<tbody>
<tr grouplength="3">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Équipements pour les 0 à 4 ans (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Aire de jeux
</td>
<td style="text-align:right;">
69,8
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
83,2
</td>
<td style="text-align:right;">
71,4
</td>
<td style="text-align:right;">
88,1
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Jeux d’eau
</td>
<td style="text-align:right;">
7,8
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2,5
</td>
<td style="text-align:right;">
18,4
</td>
<td style="text-align:right;">
6,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Pataugeoire
</td>
<td style="text-align:right;">
36,2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
47,2
</td>
<td style="text-align:right;">
2,0
</td>
<td style="text-align:right;">
29,8
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr grouplength="7">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Terrains de sport (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Athlétisme
</td>
<td style="text-align:right;">
12,1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2,0
</td>
<td style="text-align:right;">
2,0
</td>
<td style="text-align:right;">
1,2
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Baseball
</td>
<td style="text-align:right;">
62,1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
50,8
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
19,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Basketball
</td>
<td style="text-align:right;">
37,9
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
36,0
</td>
<td style="text-align:right;">
16,3
</td>
<td style="text-align:right;">
21,4
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Football américain
</td>
<td style="text-align:right;">
15,5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7,1
</td>
<td style="text-align:right;">
8,2
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Football (soccer)
</td>
<td style="text-align:right;">
52,6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
29,9
</td>
<td style="text-align:right;">
87,8
</td>
<td style="text-align:right;">
7,1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Tennis
</td>
<td style="text-align:right;">
38,8
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
32,5
</td>
<td style="text-align:right;">
8,2
</td>
<td style="text-align:right;">
14,3
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Volleyball
</td>
<td style="text-align:right;">
7,8
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4,6
</td>
<td style="text-align:right;">
12,2
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr grouplength="4">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Équipements d’hiver (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Glissade
</td>
<td style="text-align:right;">
19,8
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3,0
</td>
<td style="text-align:right;">
2,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Patinoire
</td>
<td style="text-align:right;">
58,6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
59,4
</td>
<td style="text-align:right;">
34,7
</td>
<td style="text-align:right;">
46,4
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Piste de ski de fond
</td>
<td style="text-align:right;">
7,8
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Raquettes
</td>
<td style="text-align:right;">
12,1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr grouplength="2">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Équipements spécialisés (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Parc de planches à roulettes
</td>
<td style="text-align:right;">
6,0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0,5
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Patins à roues alignées
</td>
<td style="text-align:right;">
8,6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4,1
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr grouplength="2">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Autres équipements (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Piscine extérieure
</td>
<td style="text-align:right;">
27,6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
27,4
</td>
<td style="text-align:right;">
4,1
</td>
<td style="text-align:right;">
4,8
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Randonnée
</td>
<td style="text-align:right;">
12,9
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr grouplength="5">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Superficie (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Moins d’un hectare
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
100,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
1 à 5 hectares
</td>
<td style="text-align:right;">
5,2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
98,5
</td>
<td style="text-align:right;">
100,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
5 à 10 hectares
</td>
<td style="text-align:right;">
61,2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
10 à 20 hectares
</td>
<td style="text-align:right;">
17,2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
20 hectares et plus
</td>
<td style="text-align:right;">
16,4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0,5
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr grouplength="6">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Nombre moyen d’équipement du type</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Équipements pour les 0 à 4 ans
</td>
<td style="text-align:right;">
1,1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1,3
</td>
<td style="text-align:right;">
0,9
</td>
<td style="text-align:right;">
1,2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Terrains de sport
</td>
<td style="text-align:right;">
2,3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1,6
</td>
<td style="text-align:right;">
1,3
</td>
<td style="text-align:right;">
0,6
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Équipements d’hiver
</td>
<td style="text-align:right;">
1,0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0,6
</td>
<td style="text-align:right;">
0,4
</td>
<td style="text-align:right;">
0,5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Équipements spécialisés
</td>
<td style="text-align:right;">
0,1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Autres équipements
</td>
<td style="text-align:right;">
0,4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0,3
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Tous les équipements
</td>
<td style="text-align:right;">
4,9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3,9
</td>
<td style="text-align:right;">
2,7
</td>
<td style="text-align:right;">
2,4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr grouplength="1">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Nombre d’observations par groupe</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
</td>
<td style="text-align:right;">
116,0
</td>
<td style="text-align:right;">
212
</td>
<td style="text-align:right;">
197,0
</td>
<td style="text-align:right;">
49,0
</td>
<td style="text-align:right;">
84,0
</td>
<td style="text-align:right;">
35
</td>
</tr>
</tbody>
</table>
<ul>
<li>Le premier groupe correspond à de grands parcs (superficie généralement comprise entre 5 et plus de 20 hectares), il comporte 104 observations. Ces grands parcs sont en moyenne équipés de deux terrains de sport et d’un équipement d’hiver. Il s’agit vraisemblablement des grands parcs identifiés dans l’article original, dans lesquels se retrouvent également les parcs à vocation métropolitaine.</li>
<li>Le second groupe (225 parcs) correspond à de très petits parcs (moins d’un hectare) comportant chacun une aire de jeu, mais presque aucun autre équipement. Il s’agit clairement de la classe A (Très petit parc (moins d’un hectare) avec une aire de jeux) identifiée dans l’article original.</li>
<li>Le troisième groupe (141 parcs) correspond à des petits parcs (entre 1 et 5 hectares), souvent équipés d’une piscine extérieure (28,4 % des cas), et en moyenne de deux terrains de sports (essentiellement des terrains de tennis et de soccer). Ces parcs comprennent en moyenne plus de 4 équipements et doivent donc correspondre à la classe D dans l’article original (Petit parc (1 à 5 ha) avec en moyenne six équipements, dont une patinoire et une piscine).</li>
<li>Le quatrième groupe (71 parcs) correspond à de très petits parcs (moins d’un hectare) avec en moyenne plus de trois équipements, dont une pataugeoire et une aire de jeux. Il s’agit vraisemblablement d’un sous-groupe au sein de la classe A identifiée dans l’article original.</li>
<li>Le cinquième groupe (81 parcs) correspond à des petits parcs et quelques grands parcs, il est caractérisé par une présence plus marquée de pataugeoires (84 %) et a le plus haut taux d’infrastructure de patins à routes alignées. Il comprend en moyenne plus de trois équipements.</li>
<li>Le dernier groupe (71 parcs) comprend des petits parcs (entre 1 et 5 hectares) qui ressemblent aux parcs du groupe 2 mais tendent à disposer en plus d’un terrain de sport (baseball ou basketball).</li>
</ul>
<p>Considérant les différences minimes entre certains des groupes que nous avons obtenus, il est clair que retenir seulement trois ou cinq groupes aurait été préférable. Notez également l’importance du choix de la distance, car nous obtenons des résultats sensiblement différents de ceux de l’article original en ayant opté pour la distance du <span class="math inline">\(\Phi^2\)</span> plutôt que la distance euclidienne au carré.</p>
</div>
<div id="sect13344" class="section level4">
<h4><span class="header-section-number">12.3.4.4</span> Utilisation de la matrice de distance eucidienne au carré</h4>
<p>Pour obtenir des résultats plus proches de deux de l’article original, nous pouvons reprendre notre analyse et utiliser cette fois-ci une distance euclidienne au carré.</p>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1094-1"><a href="#cb1094-1"></a>X<span class="op">$</span>groupe &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb1094-2"><a href="#cb1094-2"></a><span class="co"># calcule de la matrice de distance</span></span>
<span id="cb1094-3"><a href="#cb1094-3"></a>parc_distances_euc &lt;-<span class="st"> </span><span class="kw">dist</span>(<span class="kw">as.matrix</span>(X), <span class="dt">method =</span> <span class="st">&quot;Euclidean&quot;</span>)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb1094-4"><a href="#cb1094-4"></a></span>
<span id="cb1094-5"><a href="#cb1094-5"></a><span class="co"># Application de la CAH</span></span>
<span id="cb1094-6"><a href="#cb1094-6"></a>dendogramme_parcs_euc &lt;-<span class="st"> </span><span class="kw">hclust</span>(parc_distances_euc, <span class="dt">method =</span> <span class="st">&quot;ward.D&quot;</span>)</span>
<span id="cb1094-7"><a href="#cb1094-7"></a></span>
<span id="cb1094-8"><a href="#cb1094-8"></a><span class="co"># calcul de l&#39;indice de Silhouette</span></span>
<span id="cb1094-9"><a href="#cb1094-9"></a>ks &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb1094-10"><a href="#cb1094-10"></a>values &lt;-<span class="st"> </span><span class="kw">sapply</span>(ks, <span class="cf">function</span>(k){</span>
<span id="cb1094-11"><a href="#cb1094-11"></a>  <span class="co"># découpage du dendrogramme</span></span>
<span id="cb1094-12"><a href="#cb1094-12"></a>  groupes &lt;-<span class="st"> </span><span class="kw">cutree</span>(dendogramme_parcs_euc, <span class="dt">k =</span> k)</span>
<span id="cb1094-13"><a href="#cb1094-13"></a>  <span class="co"># calcul des valeurs de silhouette</span></span>
<span id="cb1094-14"><a href="#cb1094-14"></a>  sil &lt;-<span class="st"> </span><span class="kw">silhouette</span>(groupes, <span class="dt">dist =</span> parc_distances_euc)</span>
<span id="cb1094-15"><a href="#cb1094-15"></a>  <span class="co"># extraction de l&#39;indice global (moyenne des moyennes)</span></span>
<span id="cb1094-16"><a href="#cb1094-16"></a>  idx &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">summary</span>(sil)<span class="op">$</span>clus.avg.widths)</span>
<span id="cb1094-17"><a href="#cb1094-17"></a>  <span class="kw">return</span>(idx)</span>
<span id="cb1094-18"><a href="#cb1094-18"></a>})</span>
<span id="cb1094-19"><a href="#cb1094-19"></a></span>
<span id="cb1094-20"><a href="#cb1094-20"></a><span class="co"># création d&#39;un graphique avec les résultats</span></span>
<span id="cb1094-21"><a href="#cb1094-21"></a></span>
<span id="cb1094-22"><a href="#cb1094-22"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1094-23"><a href="#cb1094-23"></a>  <span class="dt">k =</span> ks,</span>
<span id="cb1094-24"><a href="#cb1094-24"></a>  <span class="dt">silhouette =</span> values</span>
<span id="cb1094-25"><a href="#cb1094-25"></a>)</span>
<span id="cb1094-26"><a href="#cb1094-26"></a></span>
<span id="cb1094-27"><a href="#cb1094-27"></a><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1094-28"><a href="#cb1094-28"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> silhouette)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1094-29"><a href="#cb1094-29"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> silhouette), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1094-30"><a href="#cb1094-30"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;nombre de groupes&quot;</span>, <span class="dt">y=</span><span class="st">&quot;indice global de silhouette&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/exampleHclust8-1.png" alt="Valeur de l'indice de silhouette pour différents nombres de groupes (distance euclidienne au carré)" width="75%" />
<p class="caption">
(#fig:exampleHclust8)Valeur de l’indice de silhouette pour différents nombres de groupes (distance euclidienne au carré)
</p>
</div>
<p>Nous pouvons constater cette fois-ci que quatre groupes serait probablement le meilleur choix et qu’au-delà de ce nombre, l’indice global de silhouette ne faire que diminuer. Tentons cependant de reproduire les résultats de l’article avec k = 6.</p>
<div class="sourceCode" id="cb1095"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1095-1"><a href="#cb1095-1"></a>resk6 &lt;-<span class="st"> </span><span class="kw">cutree</span>(dendogramme_parcs_euc, <span class="dt">k =</span> <span class="dv">6</span>)</span>
<span id="cb1095-2"><a href="#cb1095-2"></a></span>
<span id="cb1095-3"><a href="#cb1095-3"></a><span class="co"># calcul du nombre de fois ou chaque modalité est observée dans un groupe</span></span>
<span id="cb1095-4"><a href="#cb1095-4"></a>X<span class="op">$</span>groupe &lt;-<span class="st"> </span>resk6</span>
<span id="cb1095-5"><a href="#cb1095-5"></a>df_groupes &lt;-<span class="st"> </span>X <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1095-6"><a href="#cb1095-6"></a><span class="st">  </span><span class="kw">group_by</span>(groupe) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(<span class="dt">.funs =</span> sum)</span>
<span id="cb1095-7"><a href="#cb1095-7"></a></span>
<span id="cb1095-8"><a href="#cb1095-8"></a><span class="co"># calcul du nombre d&#39;observations par groupe</span></span>
<span id="cb1095-9"><a href="#cb1095-9"></a>nb_gp &lt;-<span class="st"> </span><span class="kw">table</span>(resk6)</span>
<span id="cb1095-10"><a href="#cb1095-10"></a></span>
<span id="cb1095-11"><a href="#cb1095-11"></a>groupe_ratios &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">as.matrix</span>(df_groupes)[,<span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(df_groupes)] <span class="op">/</span><span class="st"> </span><span class="kw">as.vector</span>(nb_gp),<span class="dv">1</span>)</span>
<span id="cb1095-12"><a href="#cb1095-12"></a>groupe_ratios &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(groupe_ratios))</span>
<span id="cb1095-13"><a href="#cb1095-13"></a><span class="kw">names</span>(groupe_ratios) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;groupe &quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(groupe_ratios))</span>
<span id="cb1095-14"><a href="#cb1095-14"></a></span>
<span id="cb1095-15"><a href="#cb1095-15"></a><span class="co"># calcul du nombre moyen d&#39;équipements par catégorie par parc</span></span>
<span id="cb1095-16"><a href="#cb1095-16"></a>equip_class &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb1095-17"><a href="#cb1095-17"></a>  <span class="kw">c</span>(<span class="st">&quot;AIRE_JEUX&quot;</span>, <span class="st">&quot;JEUX_EAU&quot;</span>, <span class="st">&quot;PATAUGEOIRE&quot;</span>),</span>
<span id="cb1095-18"><a href="#cb1095-18"></a>  <span class="kw">c</span>(<span class="st">&quot;ATHLETISME&quot;</span>, <span class="st">&quot;BASEBALL_S&quot;</span>, <span class="st">&quot;BASKETBALL&quot;</span>, <span class="st">&quot;FOOTBALL&quot;</span>, <span class="st">&quot;SOCCER&quot;</span>, <span class="st">&quot;TENNIS&quot;</span>, <span class="st">&quot;VOLLEY_BALL&quot;</span>),</span>
<span id="cb1095-19"><a href="#cb1095-19"></a>  <span class="kw">c</span>(<span class="st">&quot;TOBBOGAN_G&quot;</span>, <span class="st">&quot;PATINOIRE_E&quot;</span>, <span class="st">&quot;RAQUETTES&quot;</span>, <span class="st">&quot;SKI_FOND&quot;</span>),</span>
<span id="cb1095-20"><a href="#cb1095-20"></a>  <span class="kw">c</span>(<span class="st">&quot;PATIN_ROUE&quot;</span>, <span class="st">&quot;ROULI_ROUL&quot;</span>),</span>
<span id="cb1095-21"><a href="#cb1095-21"></a>  <span class="kw">c</span>(<span class="st">&quot;PISC_EXT&quot;</span>, <span class="st">&quot;RANDONNEE&quot;</span>)</span>
<span id="cb1095-22"><a href="#cb1095-22"></a>)</span>
<span id="cb1095-23"><a href="#cb1095-23"></a></span>
<span id="cb1095-24"><a href="#cb1095-24"></a>class_compte &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">sapply</span>(equip_class, <span class="cf">function</span>(equip){</span>
<span id="cb1095-25"><a href="#cb1095-25"></a>  <span class="kw">rowSums</span>(X[equip])</span>
<span id="cb1095-26"><a href="#cb1095-26"></a>}))</span>
<span id="cb1095-27"><a href="#cb1095-27"></a><span class="kw">names</span>(class_compte) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;enfants&quot;</span>, <span class="st">&quot;terrain_sport&quot;</span>, <span class="st">&quot;hiver&quot;</span>, <span class="st">&quot;specialise&quot;</span>, <span class="st">&quot;autre&quot;</span>)</span>
<span id="cb1095-28"><a href="#cb1095-28"></a>class_compte<span class="op">$</span>groupe &lt;-<span class="st"> </span>resk6</span>
<span id="cb1095-29"><a href="#cb1095-29"></a>df_class_equip &lt;-<span class="st"> </span>class_compte <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1095-30"><a href="#cb1095-30"></a><span class="st">  </span><span class="kw">group_by</span>(groupe) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1095-31"><a href="#cb1095-31"></a><span class="st">  </span><span class="kw">summarise_all</span>(mean)</span>
<span id="cb1095-32"><a href="#cb1095-32"></a></span>
<span id="cb1095-33"><a href="#cb1095-33"></a>df_class_equip &lt;-<span class="st"> </span><span class="kw">t</span>(df_class_equip[<span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(df_class_equip)])</span>
<span id="cb1095-34"><a href="#cb1095-34"></a><span class="kw">colnames</span>(df_class_equip) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;groupe &quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(df_class_equip))</span>
<span id="cb1095-35"><a href="#cb1095-35"></a></span>
<span id="cb1095-36"><a href="#cb1095-36"></a><span class="co"># comptage du nombre moyen d&#39;équipements</span></span>
<span id="cb1095-37"><a href="#cb1095-37"></a>df_equip_tot &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1095-38"><a href="#cb1095-38"></a>  <span class="dt">nb =</span> <span class="kw">rowSums</span>(X[<span class="dv">1</span><span class="op">:</span><span class="dv">18</span>]),</span>
<span id="cb1095-39"><a href="#cb1095-39"></a>  <span class="dt">groupe =</span> resk6</span>
<span id="cb1095-40"><a href="#cb1095-40"></a>)</span>
<span id="cb1095-41"><a href="#cb1095-41"></a>df_equip_tot_mean &lt;-<span class="st"> </span>df_equip_tot <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1095-42"><a href="#cb1095-42"></a><span class="st">  </span><span class="kw">group_by</span>(groupe) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1095-43"><a href="#cb1095-43"></a><span class="st">  </span><span class="kw">summarize_all</span>(mean)</span>
<span id="cb1095-44"><a href="#cb1095-44"></a></span>
<span id="cb1095-45"><a href="#cb1095-45"></a><span class="co"># mise dans l&#39;ordre de la première partie du tableau</span></span>
<span id="cb1095-46"><a href="#cb1095-46"></a>all_types &lt;-<span class="st"> </span><span class="kw">do.call</span>(c,equip_class)</span>
<span id="cb1095-47"><a href="#cb1095-47"></a>idxs &lt;-<span class="st"> </span><span class="kw">match</span>(all_types,<span class="kw">row.names</span>(groupe_ratios[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(all_types),]))</span>
<span id="cb1095-48"><a href="#cb1095-48"></a>groupe_ratios &lt;-<span class="st"> </span><span class="kw">rbind</span>(groupe_ratios[idxs,],</span>
<span id="cb1095-49"><a href="#cb1095-49"></a>                       groupe_ratios[(<span class="kw">length</span>(all_types)<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span><span class="kw">nrow</span>(groupe_ratios),])</span>
<span id="cb1095-50"><a href="#cb1095-50"></a></span>
<span id="cb1095-51"><a href="#cb1095-51"></a><span class="co"># combinaison des deux tableaux</span></span>
<span id="cb1095-52"><a href="#cb1095-52"></a>groupe_ratios &lt;-<span class="st"> </span><span class="kw">rbind</span>(groupe_ratios, df_class_equip, df_equip_tot_mean<span class="op">$</span>nb, <span class="kw">as.integer</span>(nb_gp))</span></code></pre></div>
<p>Recréons le tableau final des résultats au tableau @ref(tab:exampleHclust10). Si vous comparez ce tableau avec celui de l’article original, vous verrez que notre groupe 3 correspond exactement à la classe A et que notre groupe 5 correspond exactement à la classe F. Pour les autres groupes, nous pouvons observer de légères variations, ce qui correspond vraisemblablement à des divergences d’implémentation des algorithmes entre le logiciel utilisé pour l’article (SAS) et R.</p>
<table>
<caption>
(#tab:exampleHclust10)Caractéristiques des groupes obtenus lors de la CAH (distance euclidienne au carré)
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
groupe 1
</th>
<th style="text-align:right;">
groupe 2
</th>
<th style="text-align:right;">
groupe 3
</th>
<th style="text-align:right;">
groupe 4
</th>
<th style="text-align:right;">
groupe 5
</th>
<th style="text-align:right;">
groupe 6
</th>
</tr>
</thead>
<tbody>
<tr grouplength="3">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Équipements pour les 0 à 4 ans (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Aire de jeux
</td>
<td style="text-align:right;">
79,6
</td>
<td style="text-align:right;">
74,2
</td>
<td style="text-align:right;">
96,6
</td>
<td style="text-align:right;">
100,0
</td>
<td style="text-align:right;">
20,0
</td>
<td style="text-align:right;">
79,3
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Jeux d’eau
</td>
<td style="text-align:right;">
11,1
</td>
<td style="text-align:right;">
3,0
</td>
<td style="text-align:right;">
1,7
</td>
<td style="text-align:right;">
5,1
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
5,9
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Pataugeoire
</td>
<td style="text-align:right;">
59,3
</td>
<td style="text-align:right;">
42,4
</td>
<td style="text-align:right;">
8,4
</td>
<td style="text-align:right;">
61,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
19,7
</td>
</tr>
<tr grouplength="7">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Terrains de sport (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Athlétisme
</td>
<td style="text-align:right;">
13,0
</td>
<td style="text-align:right;">
15,2
</td>
<td style="text-align:right;">
0,3
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
1,0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Baseball
</td>
<td style="text-align:right;">
88,9
</td>
<td style="text-align:right;">
63,6
</td>
<td style="text-align:right;">
5,4
</td>
<td style="text-align:right;">
89,8
</td>
<td style="text-align:right;">
6,7
</td>
<td style="text-align:right;">
13,8
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Basketball
</td>
<td style="text-align:right;">
83,3
</td>
<td style="text-align:right;">
30,3
</td>
<td style="text-align:right;">
6,1
</td>
<td style="text-align:right;">
35,6
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
18,2
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Football américain
</td>
<td style="text-align:right;">
31,5
</td>
<td style="text-align:right;">
12,1
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
10,2
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
2,5
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Football (soccer)
</td>
<td style="text-align:right;">
75,9
</td>
<td style="text-align:right;">
57,6
</td>
<td style="text-align:right;">
2,0
</td>
<td style="text-align:right;">
27,1
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
33,5
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Tennis
</td>
<td style="text-align:right;">
90,7
</td>
<td style="text-align:right;">
19,7
</td>
<td style="text-align:right;">
4,1
</td>
<td style="text-align:right;">
35,6
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
14,8
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Volleyball
</td>
<td style="text-align:right;">
20,4
</td>
<td style="text-align:right;">
3,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
1,7
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
4,9
</td>
</tr>
<tr grouplength="4">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Équipements d’hiver (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Glissade
</td>
<td style="text-align:right;">
14,8
</td>
<td style="text-align:right;">
16,7
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
1,7
</td>
<td style="text-align:right;">
33,3
</td>
<td style="text-align:right;">
2,5
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Patinoire
</td>
<td style="text-align:right;">
87,0
</td>
<td style="text-align:right;">
57,6
</td>
<td style="text-align:right;">
13,2
</td>
<td style="text-align:right;">
86,4
</td>
<td style="text-align:right;">
26,7
</td>
<td style="text-align:right;">
30,5
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Piste de ski de fond
</td>
<td style="text-align:right;">
1,9
</td>
<td style="text-align:right;">
1,5
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
46,7
</td>
<td style="text-align:right;">
0,0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Raquettes
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
1,5
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
86,7
</td>
<td style="text-align:right;">
0,0
</td>
</tr>
<tr grouplength="2">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Équipements spécialisés (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Parc de planches à roulettes
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
1,7
</td>
<td style="text-align:right;">
46,7
</td>
<td style="text-align:right;">
0,0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Patins à roues alignées
</td>
<td style="text-align:right;">
16,7
</td>
<td style="text-align:right;">
7,6
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
5,1
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,5
</td>
</tr>
<tr grouplength="2">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Autres équipements (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Piscine extérieure
</td>
<td style="text-align:right;">
75,9
</td>
<td style="text-align:right;">
16,7
</td>
<td style="text-align:right;">
1,4
</td>
<td style="text-align:right;">
11,9
</td>
<td style="text-align:right;">
6,7
</td>
<td style="text-align:right;">
13,8
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Randonnée
</td>
<td style="text-align:right;">
1,9
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
93,3
</td>
<td style="text-align:right;">
0,0
</td>
</tr>
<tr grouplength="5">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Superficie (%)</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Moins d’un hectare
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
100,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
1 à 5 hectares
</td>
<td style="text-align:right;">
42,6
</td>
<td style="text-align:right;">
1,5
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
98,3
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
99,5
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
5 à 10 hectares
</td>
<td style="text-align:right;">
46,3
</td>
<td style="text-align:right;">
69,7
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
10 à 20 hectares
</td>
<td style="text-align:right;">
1,9
</td>
<td style="text-align:right;">
27,3
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
13,3
</td>
<td style="text-align:right;">
0,5
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
20 hectares et plus
</td>
<td style="text-align:right;">
9,3
</td>
<td style="text-align:right;">
1,5
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
1,7
</td>
<td style="text-align:right;">
86,7
</td>
<td style="text-align:right;">
0,0
</td>
</tr>
<tr grouplength="6">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Nombre moyen d’équipement du type</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Équipements pour les 0 à 4 ans
</td>
<td style="text-align:right;">
1,5
</td>
<td style="text-align:right;">
1,2
</td>
<td style="text-align:right;">
1,1
</td>
<td style="text-align:right;">
1,7
</td>
<td style="text-align:right;">
0,2
</td>
<td style="text-align:right;">
1,0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Terrains de sport
</td>
<td style="text-align:right;">
4,0
</td>
<td style="text-align:right;">
2,0
</td>
<td style="text-align:right;">
0,2
</td>
<td style="text-align:right;">
2,0
</td>
<td style="text-align:right;">
0,1
</td>
<td style="text-align:right;">
0,9
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Équipements d’hiver
</td>
<td style="text-align:right;">
1,0
</td>
<td style="text-align:right;">
0,8
</td>
<td style="text-align:right;">
0,1
</td>
<td style="text-align:right;">
0,9
</td>
<td style="text-align:right;">
1,9
</td>
<td style="text-align:right;">
0,3
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Équipements spécialisés
</td>
<td style="text-align:right;">
0,2
</td>
<td style="text-align:right;">
0,1
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,1
</td>
<td style="text-align:right;">
0,5
</td>
<td style="text-align:right;">
0,0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Autres équipements
</td>
<td style="text-align:right;">
0,8
</td>
<td style="text-align:right;">
0,2
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
0,1
</td>
<td style="text-align:right;">
1,0
</td>
<td style="text-align:right;">
0,1
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Tous les équipements
</td>
<td style="text-align:right;">
7,5
</td>
<td style="text-align:right;">
4,2
</td>
<td style="text-align:right;">
1,4
</td>
<td style="text-align:right;">
4,7
</td>
<td style="text-align:right;">
3,7
</td>
<td style="text-align:right;">
2,4
</td>
</tr>
<tr grouplength="1">
<td colspan="7" style="border-bottom: 1px solid;">
<strong>Nombre d’observations par groupe</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
</td>
<td style="text-align:right;">
54,0
</td>
<td style="text-align:right;">
66,0
</td>
<td style="text-align:right;">
296,0
</td>
<td style="text-align:right;">
59,0
</td>
<td style="text-align:right;">
15,0
</td>
<td style="text-align:right;">
203,0
</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="sect134" class="section level2">
<h2><span class="header-section-number">12.4</span> Nuées dynamiques</h2>
<p>Les méthodes des nuées dynamiques regroupent plusieurs algorithmes tous plus ou moins liés avec l’algorithme le plus connu : <em>k-means</em> originalement proposé par James MacQueen <span class="citation">(<a href="#ref-macqueen1967" role="doc-biblioref">1967</a>)</span>. Nous présentons également ici plusieurs variantes du <em>k-means</em>, soit le <em>k-medians</em>, le <em>k-medioids</em>, le <em>c-means</em> et le <em>c-medians</em>.</p>
<div id="sect1341" class="section level3">
<h3><span class="header-section-number">12.4.1</span> <em>K-means</em></h3>
<div id="sect13411" class="section level4">
<h4><span class="header-section-number">12.4.1.1</span> Fonctionnement de l’algorithme</h4>
<p>Nous commençons ici par détailler le fonctionnement de cet algorithme afin de mieux le cerner. D’emblée, cet algorithme nécessite que certains éléments soient définis d’avance :</p>
<ul>
<li>Une matrice de données <em>X</em> comportant <em>n</em> lignes (nombre d’observations) et <em>p</em> colonnes (nombre de variables). Chaque variable de cette matrice doit être quantitative et continue et de préférence dans une échelle standardisée (par exemple des variables centrées réduites).</li>
<li>Le nombre de groupes à identifier <em>k</em> doit être choisi par l’utilisateur ou l’utilisatrice.</li>
<li>La distance <em>d</em> à utiliser entre les observations.</li>
</ul>
<p>Le fonctionnement classique du <em>k-means</em> est le suivant :</p>
<ol style="list-style-type: decimal">
<li>Définir <em>k</em> centres de groupes de façon aléatoire.</li>
<li>Déterminer pour chaque observation le centre de son groupe le plus proche en utilisant la fonction de distance.</li>
<li>pour chacun des groupes ainsi formés, recalculer le centre du groupe en calculant le centroïde (moyennes le plus souvent) des observations appartenant à ce groupe.</li>
<li>Répéter l’opération 2 avec les nouveaux centres.</li>
<li>Calculer l’inertie expliquée par la nouvelle classification.</li>
<li>Comparer cette inertie expliquée avec celle obtenue lors de l’itération précédente.</li>
<li>Si la variation entre les deux valeurs est supérieure à une certaine limite, reprendre à l’étape 2</li>
<li>Sinon, l’algorithme prend fin.</li>
</ol>
<p>Ainsi, l’algorithme <em>k-means</em> part d’une première classification obtenue aléatoirement et va ensuite la raffiner jusqu’au point où l’amélioration de la classification devient négligeable. Du fait de ce point de départ aléatoire, cet algorithme est dit heuristique, car deux exécutions risquent de ne pas donner exactement le même résultat. Par conséquent, en relaçant l’algorithme, vous pourriez obtenir des résultats légèrement différents, avec par exemple des groupes similaires, mais obtenus dans un autre ordre, le groupe 1 étant devenu le groupe 3 et vice-versa. Il est aussi possible d’obtenir des résultats radicalement différents d’une tentative à l’autre, ce qui signifie que les groupes formés sont très instables et ne sont pas représentatifs de la population étudiée.</p>
<div class="bloc_astuce">
<p><strong>Réplicabilité des résultats dans R</strong></p>
<p>Lorsqu’une méthode heuristique ou faisant appel au hasard est utilisée dans R, il est nécessaire de s’assurer que les résultats sont reproductibles. Cela permettra notamment de relancer le même code et de réobtenir exactement les mêmes résultats. L’idée étant de figer le hasard.</p>
<p>Ultimement, un programme informatique est incapable de générer un résultat véritablement aléatoire, car il ne fait que suivre une suite d’opérations prédéterminées. Pour générer des résultats qui ressemblent au hasard, des algorithmes ont été proposés, partant d’une configuration initiale et appliquant une série d’opérations complexes permettant de générer des nombres semblant se distribuer aléatoirement. Si nous connaissons le point de départ de la suite d’opération et que nous réappliquons ces dernières, alors nous sommes certains d’obtenir le même résultat. Il est possible dans R de définir un <em>état initial de hasard</em> à l’aide de la fonction <code>set.seed</code>. Avec ce point de départ défini, nous sommes certains d’obtenir les mêmes résultats en relançant les mêmes opérations.</p>
<p>Prenons un exemple concret en sélectionnant aléatoire 3 chiffres dans un vecteur allant de 1 à 10.</p>
<div class="sourceCode" id="cb1096"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1096-1"><a href="#cb1096-1"></a>vec &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb1096-2"><a href="#cb1096-2"></a></span>
<span id="cb1096-3"><a href="#cb1096-3"></a><span class="co"># prenons un premier échantillon</span></span>
<span id="cb1096-4"><a href="#cb1096-4"></a><span class="kw">sample</span>(vec, <span class="dt">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 4 9 3</code></pre>
<div class="sourceCode" id="cb1098"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1098-1"><a href="#cb1098-1"></a><span class="co"># et un second échantillon </span></span>
<span id="cb1098-2"><a href="#cb1098-2"></a><span class="kw">sample</span>(vec, <span class="dt">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1]  6 10  8</code></pre>
<p>Nous obtenons bien deux échantillons différents. Recommençons en utilisant la fonction <code>set.seed</code> pour obtenir cette fois-ci des résultats identiques.</p>
<div class="sourceCode" id="cb1100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1100-1"><a href="#cb1100-1"></a>vec &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb1100-2"><a href="#cb1100-2"></a></span>
<span id="cb1100-3"><a href="#cb1100-3"></a><span class="co"># prenons un premier échantillon</span></span>
<span id="cb1100-4"><a href="#cb1100-4"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1100-5"><a href="#cb1100-5"></a><span class="kw">sample</span>(vec, <span class="dt">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1]  3 10  2</code></pre>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1102-1"><a href="#cb1102-1"></a><span class="co"># et un second échantillon </span></span>
<span id="cb1102-2"><a href="#cb1102-2"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1102-3"><a href="#cb1102-3"></a><span class="kw">sample</span>(vec, <span class="dt">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1]  3 10  2</code></pre>
<div class="sourceCode" id="cb1104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1104-1"><a href="#cb1104-1"></a><span class="co"># prenons un troisème échantillon</span></span>
<span id="cb1104-2"><a href="#cb1104-2"></a><span class="kw">set.seed</span>(<span class="dv">4568997</span>)</span>
<span id="cb1104-3"><a href="#cb1104-3"></a><span class="kw">sample</span>(vec, <span class="dt">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 5 6 7</code></pre>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1106-1"><a href="#cb1106-1"></a><span class="co"># et un quatrième échantillon </span></span>
<span id="cb1106-2"><a href="#cb1106-2"></a><span class="kw">set.seed</span>(<span class="dv">4568997</span>)</span>
<span id="cb1106-3"><a href="#cb1106-3"></a><span class="kw">sample</span>(vec, <span class="dt">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 5 6 7</code></pre>
<p>Vous pourrez constater que nous utilisons cette fonction plusieurs fois au cours de cette section. Cela nous permet de nous assurer que les résultats obtenus ne changent pas entre le moment où nous écrivons le livre et le moment où nous le formatons. Sinon, le texte pourrait ne plus être en phase avec les images ou les tableaux.</p>
</div>
<p>Pour mieux comprendre le fonctionnement du <em>k-means</em>, nous proposons ici une visualisation de ses différentes itérations.</p>
<div class="figure" style="text-align: center">
<img src="images/classification/kmeansGif.gif" alt="Classifications stricte et floue" width="80%" />
<p class="caption">
(#fig:kmeansA)Classifications stricte et floue
</p>
</div>
<p>Nous pouvons constater que pour ce jeu de données relativement simple, l’algorithme converge très rapidement et que sa solution varie peu au-delà de la troisième itération. Si vous utilisez la version HTLM du livre, la figure @ref(fig:kmeansA)) devrait être animée et illustrer pourquoi le <em>k-means</em> est aussi appelé algorithme de nuées dynamiques.</p>
<div class="bloc_notes">
<p><strong>Centre de groupe et k-means</strong></p>
<p>À nouveau, puisque chaque itération du <em>k-means</em> nécessite de recalculer les centres des groupes formés, des problèmes peuvent être rencontrés avec certainS typeS de distance. C’est pourquoi il est recommandé d’utiliser la distance euclidienne avec le <em>k-means</em> original. Si des distances plus complexes doivent être utilisées, il est préférable d’utiliser la classification ascendante hiérarchique.</p>
</div>
</div>
<div id="sect13412" class="section level4">
<h4><span class="header-section-number">12.4.1.2</span> Choisir le nombre optimal de groupes</h4>
<p>Comme pour la CAH, le principal enjeu avec le <em>k-means</em> est de déterminer le nombre idéal de groupes pour effectuer la classification. Si ce nombre n’est pas connu à l’avance et qu’aucune forte justification théorique n’existe, il est possible d’utiliser les mêmes techniques que pour la CAH soit la méthode du coude, l’indicateur de silhouette ou la méthode GAP.</p>
</div>
</div>
<div id="sect1342" class="section level3">
<h3><span class="header-section-number">12.4.2</span> K-médianes</h3>
<p>Le <em>k-medians</em> est une version alternative du <em>k-means</em>. Contrairement au <em>k-means</em> privilégiant la distance euclidienne, le <em>k-medians</em> est à utiliser en priorité avec une distance de Manhattan. En effet, le centre d’un groupe n’est pas déterminé comme la moyenne des variables des observations appartenant à ce groupe (<em>k-means</em>), mais comme la médiane pour chaque variable (<em>k-medians</em>). En dehors de ces deux spécificités, il reprend le fonctionnement décrit plus haut pour le <em>k-means</em>. Il est particulièrement pertinent de l’utiliser quand un jeu de données comprend un très grand nombre de colonnes, car dans ce contexte, la distance euclidienne peine à représenter les différences entre les observations. De plus, l’utilisation de la médiane le rend moins sensible aux valeurs extrêmes.</p>
</div>
<div id="sect1343" class="section level3">
<h3><span class="header-section-number">12.4.3</span> K-médioïde</h3>
<p>Le <em>k-médioïde</em> est également une version alternative au <em>k-means</em>. Le <em>k-means</em> crée des groupes en cherchant les centres de ces groupes dans l’espace multidimensionnel des données. Ces centres de groupes peuvent très bien ne pas correspondre à un point du jeu de données, au même titre que la moyenne d’une variable ne coïncide que rarement avec une observation réelle de cette variable. Pour le <em>k-médioïde</em>, les groupes sont formés en cherchant les centres de ces groupes <strong>parmi</strong> les observations du jeu de données. Ainsi, chaque groupe est centré sur une observation réelle, la plus similaire à l’ensemble des observations du groupe.</p>
<p>L’algorithme effectue les opérations suivantes :</p>
<ol style="list-style-type: decimal">
<li>Sélectionner aléatoirement <em>k</em> observations du jeu de données, elles constituent les centres des groupes initiaux.</li>
<li>Attribuer chaque observation au centre du groupe le plus proche.</li>
<li>tant que la nouvelle solution est plus efficace, effectuer les opérations suivantes :</li>
</ol>
<ul>
<li>pour chaque centre <em>m</em> et pour chaque observation <em>o</em>,
<ul>
<li>considérer l’inversion de <em>m</em> et <em>o</em></li>
<li>si cette permutation est meilleure que les précédentes, la conserver en mémoire</li>
<li>effectuer la meilleure permutation retenue si elle améliore la classification, sinon l’algorithme prend fin.</li>
</ul></li>
</ul>
<p>Le <em>k-médioïde</em> est moins utilisé que le <em>k-means</em>, mais est plus performant quand des distances autres que la distance euclidienne doivent être utilisées ou encore que des valeurs aberrantes/extrêmes sont présentes dans les données.</p>
</div>
<div id="sect1344" class="section level3">
<h3><span class="header-section-number">12.4.4</span> Mise en oeuvre dans R</h3>
<p>Pour cet exemple, nous proposons d’utiliser le jeu de données spatiales <code>LyonIris</code> du <em>package</em> <code>geocmeans</code>. Ce jeu de données spatiales pour l’agglomération lyonnaise (France) comprend dix variables, dont quatre environnementales (EN) et six socioéconomiques (SE), pour les îlots regroupés pour l’information statistique (IRIS) de l’agglomération lyonnaise (tableau @ref(tab:datageocmeans) et figure @ref(fig:datacartoacp)). Nous proposons de réaliser une analyse similaire à celle de l’article de <span class="citation">Gelb et Apparicio (<a href="#ref-2021_4" role="doc-biblioref">2021</a><a href="#ref-2021_4" role="doc-biblioref">b</a>)</span>, soit de classer les IRIS de Lyon selon ces caractéristiques pour déterminer si certains groupes d’IRIS combinent des situations désavantageuses sur les plans sociaux et environnementaux, dans une perspective d’équité environnementale.</p>
<table>
<caption>
(#tab:datageocmeans)Statistiques descriptives du jeu de données LyonIris
</caption>
<thead>
<tr>
<th style="text-align:left;">
Nom
</th>
<th style="text-align:left;">
Intitulé
</th>
<th style="text-align:center;">
Type
</th>
<th style="text-align:right;">
Moy.
</th>
<th style="text-align:right;">
E.-T.
</th>
<th style="text-align:right;">
Min.
</th>
<th style="text-align:right;">
Max.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Lden
</td>
<td style="text-align:left;">
Bruit routier (Lden dB(A))
</td>
<td style="text-align:center;">
EN
</td>
<td style="text-align:right;">
55,6
</td>
<td style="text-align:right;">
4,9
</td>
<td style="text-align:right;">
33,9
</td>
<td style="text-align:right;">
71,7
</td>
</tr>
<tr>
<td style="text-align:left;">
NO2
</td>
<td style="text-align:left;">
Dioxyde d’azote (ug/m<sup>3</sup>)
</td>
<td style="text-align:center;">
EN
</td>
<td style="text-align:right;">
28,7
</td>
<td style="text-align:right;">
7,9
</td>
<td style="text-align:right;">
12,0
</td>
<td style="text-align:right;">
60,2
</td>
</tr>
<tr>
<td style="text-align:left;">
PM25
</td>
<td style="text-align:left;">
Particules fines (PM<span class="math inline">\(_{2,5}\)</span>)
</td>
<td style="text-align:center;">
EN
</td>
<td style="text-align:right;">
16,8
</td>
<td style="text-align:right;">
2,1
</td>
<td style="text-align:right;">
11,3
</td>
<td style="text-align:right;">
21,9
</td>
</tr>
<tr>
<td style="text-align:left;">
VegHautPrt
</td>
<td style="text-align:left;">
Canopée (%)
</td>
<td style="text-align:center;">
EN
</td>
<td style="text-align:right;">
18,7
</td>
<td style="text-align:right;">
10,1
</td>
<td style="text-align:right;">
1,7
</td>
<td style="text-align:right;">
53,8
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct0_14
</td>
<td style="text-align:left;">
Moins de 15 ans (%)
</td>
<td style="text-align:center;">
SE
</td>
<td style="text-align:right;">
18,5
</td>
<td style="text-align:right;">
5,7
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
54,0
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_65
</td>
<td style="text-align:left;">
65 ans et plus (%)
</td>
<td style="text-align:center;">
SE
</td>
<td style="text-align:right;">
16,2
</td>
<td style="text-align:right;">
5,9
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
45,1
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_Img
</td>
<td style="text-align:left;">
Immigrants (%)
</td>
<td style="text-align:center;">
SE
</td>
<td style="text-align:right;">
14,5
</td>
<td style="text-align:right;">
9,1
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
59,8
</td>
</tr>
<tr>
<td style="text-align:left;">
TxChom1564
</td>
<td style="text-align:left;">
Taux de chômage
</td>
<td style="text-align:center;">
SE
</td>
<td style="text-align:right;">
14,8
</td>
<td style="text-align:right;">
8,1
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
98,8
</td>
</tr>
<tr>
<td style="text-align:left;">
Pct_brevet
</td>
<td style="text-align:left;">
Personnes à faible scolarité (%)
</td>
<td style="text-align:center;">
SE
</td>
<td style="text-align:right;">
23,5
</td>
<td style="text-align:right;">
12,6
</td>
<td style="text-align:right;">
0,0
</td>
<td style="text-align:right;">
100,0
</td>
</tr>
<tr>
<td style="text-align:left;">
NivVieMed
</td>
<td style="text-align:left;">
Médiane du niveau de vie (Euros)
</td>
<td style="text-align:center;">
SE
</td>
<td style="text-align:right;">
21 804,5
</td>
<td style="text-align:right;">
4 922,5
</td>
<td style="text-align:right;">
11 324,0
</td>
<td style="text-align:right;">
38 707,0
</td>
</tr>
</tbody>
</table>
<div id="sect13441" class="section level4">
<h4><span class="header-section-number">12.4.4.1</span> Préparation des données</h4>
<p>La première étape consiste donc à charger les données et à les préparer pour l’analyse. Toutes les variables que nous utilisons sont des variables continues. Cependant, elles ne sont pas exprimées dans la même échelle, nous proposons donc de les standardiser ici en les centrant (moyenne = 0) et en les réduisant (écart-type = 1). Cette opération peut être effectuée simplement dans R en utilisant la fonction <code>scale</code>.</p>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1108-1"><a href="#cb1108-1"></a><span class="co"># Chargement des données</span></span>
<span id="cb1108-2"><a href="#cb1108-2"></a><span class="kw">library</span>(geocmeans)</span>
<span id="cb1108-3"><a href="#cb1108-3"></a><span class="kw">data</span>(LyonIris)</span>
<span id="cb1108-4"><a href="#cb1108-4"></a></span>
<span id="cb1108-5"><a href="#cb1108-5"></a><span class="co"># NB : LyonIris est un objet spatial, il faut donc extraire uniquement son DataFrame</span></span>
<span id="cb1108-6"><a href="#cb1108-6"></a>X &lt;-<span class="st"> </span>LyonIris<span class="op">@</span>data[<span class="kw">c</span>(<span class="st">&quot;Lden&quot;</span>,<span class="st">&quot;NO2&quot;</span>,<span class="st">&quot;PM25&quot;</span>,<span class="st">&quot;VegHautPrt&quot;</span>,<span class="st">&quot;Pct0_14&quot;</span>,<span class="st">&quot;Pct_65&quot;</span>,<span class="st">&quot;Pct_Img&quot;</span>,</span>
<span id="cb1108-7"><a href="#cb1108-7"></a>                     <span class="st">&quot;TxChom1564&quot;</span>,<span class="st">&quot;Pct_brevet&quot;</span>,<span class="st">&quot;NivVieMed&quot;</span>)]</span>
<span id="cb1108-8"><a href="#cb1108-8"></a></span>
<span id="cb1108-9"><a href="#cb1108-9"></a><span class="co"># Centrage et réduction de chaque colonne du DataFrame</span></span>
<span id="cb1108-10"><a href="#cb1108-10"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="kw">names</span>(X)){</span>
<span id="cb1108-11"><a href="#cb1108-11"></a>  X[[col]] &lt;-<span class="st"> </span><span class="kw">scale</span>(X[[col]], <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1108-12"><a href="#cb1108-12"></a>}</span></code></pre></div>
</div>
<div id="sect13442" class="section level4">
<h4><span class="header-section-number">12.4.4.2</span> Choix du nombre de groupes optimal</h4>
<p>La seconde étape consiste à déterminer le nombre de groupes optimal. Pour cela, nous allons comparer les résultats des trois méthodes proposées : la méthode du coude, l’indice de silhouette et la méthode GAP. Pour chaque méthode, nous testons les nombres de groupes de 2 à 10.</p>
<div id="sect134421" class="section level5">
<h5><span class="header-section-number">12.4.4.2.1</span> Méthode du coude</h5>
<p>Commençons par appliquer la méthode du coude. Nous calculons donc l’inertie expliquée par la classification pour différentes valeurs de <em>k</em> (nombre de groupes) avant de construire la figure @ref(fig:kmeansC).</p>
<div class="sourceCode" id="cb1109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1109-1"><a href="#cb1109-1"></a>ks &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb1109-2"><a href="#cb1109-2"></a></span>
<span id="cb1109-3"><a href="#cb1109-3"></a><span class="co">## ---- Méthode du coude ---- ##</span></span>
<span id="cb1109-4"><a href="#cb1109-4"></a>inertie_exps &lt;-<span class="st"> </span><span class="kw">sapply</span>(ks, <span class="cf">function</span>(k){</span>
<span id="cb1109-5"><a href="#cb1109-5"></a>  <span class="co"># calcul du kmeans avec k</span></span>
<span id="cb1109-6"><a href="#cb1109-6"></a>  resultat &lt;-<span class="st"> </span><span class="kw">kmeans</span>(X, <span class="dt">centers =</span> k)</span>
<span id="cb1109-7"><a href="#cb1109-7"></a>  <span class="co"># calcul de l&#39;inertie expliquée (1 - inertie intragroupe / inertie totale)</span></span>
<span id="cb1109-8"><a href="#cb1109-8"></a>  inertie_exp &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">-</span>(<span class="kw">sum</span>(resultat<span class="op">$</span>withinss) <span class="op">/</span><span class="st"> </span>resultat<span class="op">$</span>totss)</span>
<span id="cb1109-9"><a href="#cb1109-9"></a>  <span class="kw">return</span>(inertie_exp)</span>
<span id="cb1109-10"><a href="#cb1109-10"></a>})</span>
<span id="cb1109-11"><a href="#cb1109-11"></a></span>
<span id="cb1109-12"><a href="#cb1109-12"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1109-13"><a href="#cb1109-13"></a>  <span class="dt">k =</span> ks,</span>
<span id="cb1109-14"><a href="#cb1109-14"></a>  <span class="dt">inertie_exp =</span> inertie_exps</span>
<span id="cb1109-15"><a href="#cb1109-15"></a>)</span>
<span id="cb1109-16"><a href="#cb1109-16"></a></span>
<span id="cb1109-17"><a href="#cb1109-17"></a><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1109-18"><a href="#cb1109-18"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> inertie_exp)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1109-19"><a href="#cb1109-19"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> inertie_exp), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1109-20"><a href="#cb1109-20"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;nombre de groupes&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;inertie expliquée (%)&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeansC-1.png" alt="Inertie expliquée pour différents nombres de groupes pour le k-means" width="75%" />
<p class="caption">
(#fig:kmeansC)Inertie expliquée pour différents nombres de groupes pour le k-means
</p>
</div>
<p>Dans l’article original, quatre groupes avaient été retenus. Nous pouvons constater ici qu’un coude fort se situe à k = 3 et qu’au-delà de cette limite, l’ajout d’un groupe supplémentaire contribue à expliquer une plus petite partie de l’inertie supplémentaire comparativement au précédent.</p>
</div>
<div id="sect134422" class="section level5">
<h5><span class="header-section-number">12.4.4.2.2</span> Indice de silhouette</h5>
<p>Poursuivons avec l’indice de silhouette calculé de nouveau avec des valeurs de <em>k</em> allant de 2 à 10. Notez que nous devons au préalable créer une matrice de distances entre les observations du jeu de données pour construire notre indice de silhouette. Puisque nous utilisons l’algorithme <em>k-means</em>, nous utilisons la distance euclidienne.</p>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="#cb1110-1"></a>ks &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb1110-2"><a href="#cb1110-2"></a></span>
<span id="cb1110-3"><a href="#cb1110-3"></a><span class="co"># calcul d&#39;une matrice de distance euclidienne entre les observations</span></span>
<span id="cb1110-4"><a href="#cb1110-4"></a>dist_mat &lt;-<span class="st"> </span><span class="kw">dist</span>(X, <span class="dt">method =</span> <span class="st">&quot;euclidean&quot;</span>)</span>
<span id="cb1110-5"><a href="#cb1110-5"></a></span>
<span id="cb1110-6"><a href="#cb1110-6"></a><span class="co">## ---- indice de silhouette ---- ##</span></span>
<span id="cb1110-7"><a href="#cb1110-7"></a>values &lt;-<span class="st"> </span><span class="kw">sapply</span>(ks, <span class="cf">function</span>(k){</span>
<span id="cb1110-8"><a href="#cb1110-8"></a>  resultat &lt;-<span class="st"> </span><span class="kw">kmeans</span>(X,<span class="dt">centers =</span> k)</span>
<span id="cb1110-9"><a href="#cb1110-9"></a>  groupes &lt;-<span class="st"> </span>resultat<span class="op">$</span>cluster</span>
<span id="cb1110-10"><a href="#cb1110-10"></a>  <span class="co"># calcul des valeurs de silhouette</span></span>
<span id="cb1110-11"><a href="#cb1110-11"></a>  sil &lt;-<span class="st"> </span><span class="kw">silhouette</span>(groupes, <span class="dt">dist =</span> dist_mat)</span>
<span id="cb1110-12"><a href="#cb1110-12"></a>  <span class="co"># extraction de l&#39;indice global (moyenne des moyennes)</span></span>
<span id="cb1110-13"><a href="#cb1110-13"></a>  idx &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">summary</span>(sil)<span class="op">$</span>clus.avg.widths)</span>
<span id="cb1110-14"><a href="#cb1110-14"></a>  <span class="kw">return</span>(idx)</span>
<span id="cb1110-15"><a href="#cb1110-15"></a>})</span>
<span id="cb1110-16"><a href="#cb1110-16"></a></span>
<span id="cb1110-17"><a href="#cb1110-17"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1110-18"><a href="#cb1110-18"></a>  <span class="dt">k =</span> ks,</span>
<span id="cb1110-19"><a href="#cb1110-19"></a>  <span class="dt">silhouette =</span> values</span>
<span id="cb1110-20"><a href="#cb1110-20"></a>)</span>
<span id="cb1110-21"><a href="#cb1110-21"></a></span>
<span id="cb1110-22"><a href="#cb1110-22"></a><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1110-23"><a href="#cb1110-23"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> silhouette)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1110-24"><a href="#cb1110-24"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> silhouette), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1110-25"><a href="#cb1110-25"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;nombre de groupes&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Indice de silhouette&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeansD-1.png" alt="Indice de silhouette pour différents nombres de groupes pour le k-means" width="75%" />
<p class="caption">
(#fig:kmeansD)Indice de silhouette pour différents nombres de groupes pour le k-means
</p>
</div>
<p>À nouveau, la figure @ref(fig:kmeansD) indique que le nombre de groupes optimal serait trois selon l’indice de Silhouette.</p>
</div>
<div id="sect134423" class="section level5">
<h5><span class="header-section-number">12.4.4.2.3</span> Méthode GAP</h5>
<p>Pour appliquer la méthode GAP, nous proposons d’utiliser la fonction <code>clusGap</code> du <em>package</em> <code>NbClust</code>. Pour l’utiliser, il est nécessaire de définir une fonction renvoyant pour le nombre de groupes <em>k</em> et le jeu de données <em>x</em> une liste comprenant un vecteur attribuant chaque observation à chaque groupe. Il est possible de considérer ce type de fonction comme un « adaptateur ».</p>
<div class="sourceCode" id="cb1111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1111-1"><a href="#cb1111-1"></a><span class="kw">library</span>(NbClust)</span>
<span id="cb1111-2"><a href="#cb1111-2"></a></span>
<span id="cb1111-3"><a href="#cb1111-3"></a><span class="co"># définition de la fonction adaptateur</span></span>
<span id="cb1111-4"><a href="#cb1111-4"></a>adaptor &lt;-<span class="st"> </span><span class="cf">function</span>(x,k){</span>
<span id="cb1111-5"><a href="#cb1111-5"></a>  clust &lt;-<span class="st"> </span><span class="kw">kmeans</span>(x,k)</span>
<span id="cb1111-6"><a href="#cb1111-6"></a>  <span class="kw">return</span>(<span class="kw">list</span>(</span>
<span id="cb1111-7"><a href="#cb1111-7"></a>    <span class="st">&quot;cluster&quot;</span> =<span class="st"> </span>clust<span class="op">$</span>cluster</span>
<span id="cb1111-8"><a href="#cb1111-8"></a>  ))</span>
<span id="cb1111-9"><a href="#cb1111-9"></a>}</span>
<span id="cb1111-10"><a href="#cb1111-10"></a></span>
<span id="cb1111-11"><a href="#cb1111-11"></a><span class="co"># calcul de la méthode GAP</span></span>
<span id="cb1111-12"><a href="#cb1111-12"></a>vals &lt;-<span class="st"> </span><span class="kw">clusGap</span>(X, adaptor, <span class="dt">K.max =</span> <span class="dv">10</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1111-13"><a href="#cb1111-13"></a>tab &lt;-<span class="st"> </span><span class="kw">data.frame</span>(vals<span class="op">$</span>Tab)</span>
<span id="cb1111-14"><a href="#cb1111-14"></a>tab<span class="op">$</span>k &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(tab)</span>
<span id="cb1111-15"><a href="#cb1111-15"></a></span>
<span id="cb1111-16"><a href="#cb1111-16"></a><span class="co"># détermination des valeurs de k retenues par la méthode (1ere et 2e)</span></span>
<span id="cb1111-17"><a href="#cb1111-17"></a>is_valid &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">2</span><span class="op">:</span><span class="kw">nrow</span>(tab), <span class="cf">function</span>(i){</span>
<span id="cb1111-18"><a href="#cb1111-18"></a>  tab[i<span class="dv">-1</span>,<span class="st">&quot;gap&quot;</span>] <span class="op">&gt;=</span><span class="st"> </span>(tab[i,<span class="st">&quot;gap&quot;</span>] <span class="op">-</span><span class="st"> </span>tab[i,<span class="st">&quot;SE.sim&quot;</span>])</span>
<span id="cb1111-19"><a href="#cb1111-19"></a>})</span>
<span id="cb1111-20"><a href="#cb1111-20"></a>valids &lt;-<span class="st"> </span><span class="kw">subset</span>(tab,is_valid)[<span class="dv">1</span>,]</span>
<span id="cb1111-21"><a href="#cb1111-21"></a>valids2 &lt;-<span class="st"> </span><span class="kw">subset</span>(tab,is_valid)[<span class="dv">2</span>,]</span>
<span id="cb1111-22"><a href="#cb1111-22"></a></span>
<span id="cb1111-23"><a href="#cb1111-23"></a><span class="co"># réalisation du graphique</span></span>
<span id="cb1111-24"><a href="#cb1111-24"></a><span class="kw">ggplot</span>(tab) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1111-25"><a href="#cb1111-25"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> gap)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1111-26"><a href="#cb1111-26"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">x =</span> valids<span class="op">$</span>k, <span class="dt">xend =</span> valids<span class="op">$</span>k, <span class="dt">y =</span> <span class="kw">min</span>(tab<span class="op">$</span>gap), <span class="dt">yend =</span> valids<span class="op">$</span>gap, </span>
<span id="cb1111-27"><a href="#cb1111-27"></a>               <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></span>
<span id="cb1111-28"><a href="#cb1111-28"></a><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">x =</span> valids2<span class="op">$</span>k, <span class="dt">xend =</span> valids2<span class="op">$</span>k, <span class="dt">y =</span> <span class="kw">min</span>(tab<span class="op">$</span>gap), <span class="dt">yend =</span> valids2<span class="op">$</span>gap, </span>
<span id="cb1111-29"><a href="#cb1111-29"></a>               <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></span>
<span id="cb1111-30"><a href="#cb1111-30"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> gap), <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1111-31"><a href="#cb1111-31"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1111-32"><a href="#cb1111-32"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;nombre de groupes&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;GAP&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeansE-1.png" alt="Méthode GAP pour différents nombres de groupes pour le k-means" width="75%" />
<p class="caption">
(#fig:kmeansE)Méthode GAP pour différents nombres de groupes pour le k-means
</p>
</div>
<p>La figure @ref(fig:kmeansE) indique également que le nombre de groupes à retenir serait trois. Nous retenons cependant quatre groupes pour pouvoir plus facilement comparer nos résultats avec ceux de l’article original.</p>
</div>
</div>
<div id="sect13443" class="section level4">
<h4><span class="header-section-number">12.4.4.3</span> Application l’algorithme du <em>k-means</em></h4>
<p>Maintenant que nous avons choisi le nombre de groupes à former, nous pouvons simplement appliquer la fonction <code>kmeans</code> présente de base dans R.</p>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1112-1"><a href="#cb1112-1"></a><span class="kw">set.seed</span>(<span class="dv">145</span>)</span>
<span id="cb1112-2"><a href="#cb1112-2"></a>resultats &lt;-<span class="st"> </span><span class="kw">kmeans</span>(X, <span class="dt">centers =</span> <span class="dv">4</span>)</span></code></pre></div>
</div>
<div id="sect13444" class="section level4">
<h4><span class="header-section-number">12.4.4.4</span> Interprétation les résultats</h4>
<p>Une fois les groupes obtenus, l’étape la plus importante est de parvenir à interpréter ces groupes. Pour cela, il est nécessaire d’explorer en profondeur ces groupes au travers des variables utilisées pour les constituer. Dans notre cas, le jeu de données <code>LyonIris</code> est spatialisé, nous pouvons donc commencer par cartographier les groupes.</p>
<div class="sourceCode" id="cb1113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1113-1"><a href="#cb1113-1"></a><span class="kw">library</span>(tmap)</span>
<span id="cb1113-2"><a href="#cb1113-2"></a>LyonIris<span class="op">$</span>groupes &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;groupe&quot;</span>, resultats<span class="op">$</span>cluster, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb1113-3"><a href="#cb1113-3"></a></span>
<span id="cb1113-4"><a href="#cb1113-4"></a><span class="kw">tm_shape</span>(LyonIris) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1113-5"><a href="#cb1113-5"></a><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="st">&quot;groupes&quot;</span>, <span class="dt">palette =</span></span>
<span id="cb1113-6"><a href="#cb1113-6"></a>                <span class="kw">c</span>(<span class="st">&quot;#EFBE89&quot;</span>, <span class="st">&quot;#4A6A9F&quot;</span>, <span class="st">&quot;#7DB47C&quot;</span>, <span class="st">&quot;#FAF29C&quot;</span>),<span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeansG-1.png" alt="Cartographie des groupes obtenus avec la méthode du k-means" width="75%" />
<p class="caption">
(#fig:kmeansG)Cartographie des groupes obtenus avec la méthode du k-means
</p>
</div>
<p>Il est ainsi possible de constater que le groupe 3 forme un ensemble assez compact d’IRIS au centre de Lyon. Le groupe 4 correspond quant à lui à des IRIS situés en périphérie plutôt éloignée, essentiellement à l’Ouest. Le groupe 1 correspond à une périphérie proche du groupe 2 apparaît comme un ensemble d’enclaves dispersées.</p>
<p>Pour distinguer rapidement les profils des différents groupes, il est possible d’utiliser un graphique en radar. La construction d’un tel graphique peut être un peu fastidieuse dans R, cependant le <em>package</em> <code>geocmeans</code> propose une fonction assez pratique : <code>spiderPlots</code>.</p>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="#cb1114-1"></a><span class="kw">library</span>(geocmeans)</span>
<span id="cb1114-2"><a href="#cb1114-2"></a></span>
<span id="cb1114-3"><a href="#cb1114-3"></a><span class="co"># création d&#39;une matrice d&#39;appartenance binaire des groupes</span></span>
<span id="cb1114-4"><a href="#cb1114-4"></a>matrice_gp &lt;-<span class="st"> </span>fastDummies<span class="op">::</span><span class="kw">dummy_cols</span>(resultats<span class="op">$</span>cluster, <span class="dt">remove_selected_columns =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1114-5"><a href="#cb1114-5"></a></span>
<span id="cb1114-6"><a href="#cb1114-6"></a><span class="co"># réalisation du graphique</span></span>
<span id="cb1114-7"><a href="#cb1114-7"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="dt">mai =</span> <span class="kw">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>))</span>
<span id="cb1114-8"><a href="#cb1114-8"></a>plots &lt;-<span class="st"> </span><span class="kw">spiderPlots</span>(X, matrice_gp, </span>
<span id="cb1114-9"><a href="#cb1114-9"></a>                     <span class="dt">chartcolors =</span> <span class="kw">c</span>(<span class="st">&quot;#EFBE89&quot;</span>, <span class="st">&quot;#4A6A9F&quot;</span>, <span class="st">&quot;#7DB47C&quot;</span>, <span class="st">&quot;#FAF29C&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeansH-1.png" alt="Graphiques en radar pour les groupes issus du k-means" width="90%" />
<p class="caption">
(#fig:kmeansH)Graphiques en radar pour les groupes issus du k-means
</p>
</div>
<p>Il est ainsi possible de constater à la figure @ref(fig:kmeansH) que le groupe 3 est caractérisé par un niveau de vie élevé, mais par des niveaux de concentration de pollution atmosphérique plus élevés également. Le groupe 4 en revanche est caractérisé par un important couvert végétal, un niveau de vie médian élevé et une plus forte proportion de personnes de plus de 65 ans. le groupe 1 est quant à lui marqué par des niveaux sonores plus élevés. Enfin, le groupe 2 se caractérise par une plus grande proportion de population ayant obtenu comme diplôme le plus élevé le brevet des collèges, d’immigrant, de jeune de moins de 15 ans et un taux de chômage plus élevé.</p>
<p>Notez que ces graphiques nous permettent rapidement de nous faire une idée des caractéristiques des groupes, mais uniquement sur une échelle relative. En effet, ils ne nous indiquent à aucun moment la taille des écarts entre les groupes. Pour cela, il est nécessaire de réaliser des graphiques en violon pour chaque variable. Pour ce type de graphique, il est préférable d’utiliser les données originales non transformées pour pouvoir mieux appréhender si les différences entre les groupes sont importantes ou négligeables.</p>
<div class="sourceCode" id="cb1115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1115-1"><a href="#cb1115-1"></a>X2 &lt;-<span class="st"> </span>LyonIris<span class="op">@</span>data[<span class="kw">c</span>(<span class="st">&quot;Lden&quot;</span>,<span class="st">&quot;NO2&quot;</span>,<span class="st">&quot;PM25&quot;</span>,<span class="st">&quot;VegHautPrt&quot;</span>,<span class="st">&quot;Pct0_14&quot;</span>,<span class="st">&quot;Pct_65&quot;</span>,<span class="st">&quot;Pct_Img&quot;</span>,</span>
<span id="cb1115-2"><a href="#cb1115-2"></a>                      <span class="st">&quot;TxChom1564&quot;</span>,<span class="st">&quot;Pct_brevet&quot;</span>,<span class="st">&quot;NivVieMed&quot;</span>)]</span>
<span id="cb1115-3"><a href="#cb1115-3"></a></span>
<span id="cb1115-4"><a href="#cb1115-4"></a>plots &lt;-<span class="st"> </span><span class="kw">violinPlots</span>(X2, <span class="kw">as.character</span>(resultats<span class="op">$</span>cluster))</span>
<span id="cb1115-5"><a href="#cb1115-5"></a><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> plots, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">5</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeansI-1.png" alt="Graphiques en violon pour les groupes issus du k-means" width="100%" />
<p class="caption">
(#fig:kmeansI)Graphiques en violon pour les groupes issus du k-means
</p>
</div>
<p>Il est également recommandé de calculer des statistiques descriptives par groupes et de les rapporter dans un tableau.</p>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1116-1"><a href="#cb1116-1"></a><span class="co"># obtention d&#39;un tableau par groupe</span></span>
<span id="cb1116-2"><a href="#cb1116-2"></a>tableaux &lt;-<span class="st"> </span><span class="kw">summarizeClusters</span>(X2, matrice_gp, <span class="dt">dec =</span> <span class="dv">1</span>, <span class="dt">silent =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1116-3"><a href="#cb1116-3"></a></span>
<span id="cb1116-4"><a href="#cb1116-4"></a><span class="co"># concaténation des tableaux</span></span>
<span id="cb1116-5"><a href="#cb1116-5"></a>tableau_tot &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, tableaux)</span></code></pre></div>
<table>
<caption>
(#tab:kmeansK)Statistiques descriptives de quatre groupes obtenus
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Lden
</th>
<th style="text-align:right;">
NO2
</th>
<th style="text-align:right;">
PM25
</th>
<th style="text-align:right;">
VegHautPrt
</th>
<th style="text-align:right;">
Pct014
</th>
<th style="text-align:right;">
Pct65
</th>
<th style="text-align:right;">
PctImg
</th>
<th style="text-align:right;">
TxChom1564
</th>
<th style="text-align:right;">
Pctbrevet
</th>
<th style="text-align:right;">
NivVieMed
</th>
</tr>
</thead>
<tbody>
<tr grouplength="9">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>groupe 1</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q5
</td>
<td style="text-align:right;">
53.8
</td>
<td style="text-align:right;">
25.1
</td>
<td style="text-align:right;">
15.6
</td>
<td style="text-align:right;">
6.6
</td>
<td style="text-align:right;">
12.3
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
8.1
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
17.5
</td>
<td style="text-align:right;">
15845.4
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q10
</td>
<td style="text-align:right;">
54.4
</td>
<td style="text-align:right;">
26.4
</td>
<td style="text-align:right;">
15.9
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
13.9
</td>
<td style="text-align:right;">
11.4
</td>
<td style="text-align:right;">
9.2
</td>
<td style="text-align:right;">
9.8
</td>
<td style="text-align:right;">
18.2
</td>
<td style="text-align:right;">
16988.2
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q25
</td>
<td style="text-align:right;">
56.3
</td>
<td style="text-align:right;">
29.3
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
10.9
</td>
<td style="text-align:right;">
16.3
</td>
<td style="text-align:right;">
13.6
</td>
<td style="text-align:right;">
11.6
</td>
<td style="text-align:right;">
11.5
</td>
<td style="text-align:right;">
20.8
</td>
<td style="text-align:right;">
18454
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q50
</td>
<td style="text-align:right;">
58.9
</td>
<td style="text-align:right;">
32.3
</td>
<td style="text-align:right;">
18.2
</td>
<td style="text-align:right;">
15.1
</td>
<td style="text-align:right;">
18.2
</td>
<td style="text-align:right;">
16.6
</td>
<td style="text-align:right;">
15.9
</td>
<td style="text-align:right;">
13.6
</td>
<td style="text-align:right;">
24.1
</td>
<td style="text-align:right;">
19559
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q75
</td>
<td style="text-align:right;">
62.5
</td>
<td style="text-align:right;">
36.4
</td>
<td style="text-align:right;">
18.7
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
20.5
</td>
<td style="text-align:right;">
19.5
</td>
<td style="text-align:right;">
18.6
</td>
<td style="text-align:right;">
16.9
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
21509
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q90
</td>
<td style="text-align:right;">
64.5
</td>
<td style="text-align:right;">
39.2
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
22.3
</td>
<td style="text-align:right;">
22.3
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
19.6
</td>
<td style="text-align:right;">
32.8
</td>
<td style="text-align:right;">
23523.8
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q95
</td>
<td style="text-align:right;">
66.4
</td>
<td style="text-align:right;">
40.3
</td>
<td style="text-align:right;">
19.2
</td>
<td style="text-align:right;">
33.7
</td>
<td style="text-align:right;">
24.5
</td>
<td style="text-align:right;">
24.6
</td>
<td style="text-align:right;">
22.7
</td>
<td style="text-align:right;">
21.8
</td>
<td style="text-align:right;">
37.1
</td>
<td style="text-align:right;">
24461.4
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Mean
</td>
<td style="text-align:right;">
59.6
</td>
<td style="text-align:right;">
32.7
</td>
<td style="text-align:right;">
17.8
</td>
<td style="text-align:right;">
17.2
</td>
<td style="text-align:right;">
18.2
</td>
<td style="text-align:right;">
16.7
</td>
<td style="text-align:right;">
15.7
</td>
<td style="text-align:right;">
14.1
</td>
<td style="text-align:right;">
25.5
</td>
<td style="text-align:right;">
19948
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Std
</td>
<td style="text-align:right;">
4.2
</td>
<td style="text-align:right;">
5.2
</td>
<td style="text-align:right;">
1.2
</td>
<td style="text-align:right;">
8.5
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.7
</td>
<td style="text-align:right;">
6.5
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
2637.2
</td>
</tr>
<tr grouplength="9">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>groupe 2</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q5
</td>
<td style="text-align:right;">
50.8
</td>
<td style="text-align:right;">
19.3
</td>
<td style="text-align:right;">
13.9
</td>
<td style="text-align:right;">
6.1
</td>
<td style="text-align:right;">
18.4
</td>
<td style="text-align:right;">
6.6
</td>
<td style="text-align:right;">
17.7
</td>
<td style="text-align:right;">
16.5
</td>
<td style="text-align:right;">
30.7
</td>
<td style="text-align:right;">
12350.5
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q10
</td>
<td style="text-align:right;">
52
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
14.2
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
19.8
</td>
<td style="text-align:right;">
8.7
</td>
<td style="text-align:right;">
20.1
</td>
<td style="text-align:right;">
16.8
</td>
<td style="text-align:right;">
32.8
</td>
<td style="text-align:right;">
12747
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q25
</td>
<td style="text-align:right;">
53.9
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
15.2
</td>
<td style="text-align:right;">
11.2
</td>
<td style="text-align:right;">
22.8
</td>
<td style="text-align:right;">
10.6
</td>
<td style="text-align:right;">
23.6
</td>
<td style="text-align:right;">
19.7
</td>
<td style="text-align:right;">
36.2
</td>
<td style="text-align:right;">
13546
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q50
</td>
<td style="text-align:right;">
56.4
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
16.2
</td>
<td style="text-align:right;">
14.5
</td>
<td style="text-align:right;">
25.2
</td>
<td style="text-align:right;">
13.6
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
24.5
</td>
<td style="text-align:right;">
39.9
</td>
<td style="text-align:right;">
15340
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q75
</td>
<td style="text-align:right;">
58.4
</td>
<td style="text-align:right;">
29.2
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
27.8
</td>
<td style="text-align:right;">
16.9
</td>
<td style="text-align:right;">
33.2
</td>
<td style="text-align:right;">
32.3
</td>
<td style="text-align:right;">
45.9
</td>
<td style="text-align:right;">
16330.5
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q90
</td>
<td style="text-align:right;">
62.9
</td>
<td style="text-align:right;">
33.2
</td>
<td style="text-align:right;">
18.3
</td>
<td style="text-align:right;">
23.5
</td>
<td style="text-align:right;">
31.3
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
38.1
</td>
<td style="text-align:right;">
35.6
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
18140
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q95
</td>
<td style="text-align:right;">
64.3
</td>
<td style="text-align:right;">
37.2
</td>
<td style="text-align:right;">
18.8
</td>
<td style="text-align:right;">
27.1
</td>
<td style="text-align:right;">
32.6
</td>
<td style="text-align:right;">
20.8
</td>
<td style="text-align:right;">
40.3
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
55.2
</td>
<td style="text-align:right;">
19009
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Mean
</td>
<td style="text-align:right;">
56.8
</td>
<td style="text-align:right;">
26.3
</td>
<td style="text-align:right;">
16.2
</td>
<td style="text-align:right;">
15.4
</td>
<td style="text-align:right;">
25.4
</td>
<td style="text-align:right;">
13.8
</td>
<td style="text-align:right;">
28.5
</td>
<td style="text-align:right;">
26.6
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
15401.4
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Std
</td>
<td style="text-align:right;">
4.1
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
6.2
</td>
<td style="text-align:right;">
4.8
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
10.5
</td>
<td style="text-align:right;">
11.3
</td>
<td style="text-align:right;">
2340.4
</td>
</tr>
<tr grouplength="9">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>groupe 3</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q5
</td>
<td style="text-align:right;">
50.2
</td>
<td style="text-align:right;">
28.3
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6.9
</td>
<td style="text-align:right;">
5.2
</td>
<td style="text-align:right;">
5.8
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
6.7
</td>
<td style="text-align:right;">
19036.4
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q10
</td>
<td style="text-align:right;">
51.1
</td>
<td style="text-align:right;">
29.5
</td>
<td style="text-align:right;">
17.5
</td>
<td style="text-align:right;">
6.6
</td>
<td style="text-align:right;">
9.5
</td>
<td style="text-align:right;">
7.2
</td>
<td style="text-align:right;">
6.6
</td>
<td style="text-align:right;">
8.5
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
19509.9
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q25
</td>
<td style="text-align:right;">
53.2
</td>
<td style="text-align:right;">
31.3
</td>
<td style="text-align:right;">
18.6
</td>
<td style="text-align:right;">
9.1
</td>
<td style="text-align:right;">
11.4
</td>
<td style="text-align:right;">
9.4
</td>
<td style="text-align:right;">
7.9
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
9.5
</td>
<td style="text-align:right;">
21632.8
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q50
</td>
<td style="text-align:right;">
55.2
</td>
<td style="text-align:right;">
35.4
</td>
<td style="text-align:right;">
19.3
</td>
<td style="text-align:right;">
12.6
</td>
<td style="text-align:right;">
14.1
</td>
<td style="text-align:right;">
12.4
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
12.9
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
23342
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q75
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:right;">
39.6
</td>
<td style="text-align:right;">
19.8
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
15.7
</td>
<td style="text-align:right;">
13.1
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
14.8
</td>
<td style="text-align:right;">
25932.2
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q90
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
42.9
</td>
<td style="text-align:right;">
20.1
</td>
<td style="text-align:right;">
19.9
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
18.7
</td>
<td style="text-align:right;">
16.3
</td>
<td style="text-align:right;">
17.8
</td>
<td style="text-align:right;">
16.6
</td>
<td style="text-align:right;">
28810.1
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q95
</td>
<td style="text-align:right;">
61.1
</td>
<td style="text-align:right;">
44.4
</td>
<td style="text-align:right;">
20.3
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
19.2
</td>
<td style="text-align:right;">
20.6
</td>
<td style="text-align:right;">
17.6
</td>
<td style="text-align:right;">
19.1
</td>
<td style="text-align:right;">
18.4
</td>
<td style="text-align:right;">
31835.2
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Mean
</td>
<td style="text-align:right;">
55.6
</td>
<td style="text-align:right;">
35.8
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
13.6
</td>
<td style="text-align:right;">
13.8
</td>
<td style="text-align:right;">
12.6
</td>
<td style="text-align:right;">
11.1
</td>
<td style="text-align:right;">
13.1
</td>
<td style="text-align:right;">
12.1
</td>
<td style="text-align:right;">
23999.7
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Std
</td>
<td style="text-align:right;">
3.7
</td>
<td style="text-align:right;">
5.6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
4.2
</td>
<td style="text-align:right;">
4.7
</td>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3870.3
</td>
</tr>
<tr grouplength="9">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>groupe 4</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q5
</td>
<td style="text-align:right;">
44.9
</td>
<td style="text-align:right;">
14.7
</td>
<td style="text-align:right;">
12.7
</td>
<td style="text-align:right;">
8.1
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
12.7
</td>
<td style="text-align:right;">
3.9
</td>
<td style="text-align:right;">
6.7
</td>
<td style="text-align:right;">
10.8
</td>
<td style="text-align:right;">
19391.2
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q10
</td>
<td style="text-align:right;">
46.6
</td>
<td style="text-align:right;">
15.7
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
11.6
</td>
<td style="text-align:right;">
14.9
</td>
<td style="text-align:right;">
13.5
</td>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
12.4
</td>
<td style="text-align:right;">
20257
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q25
</td>
<td style="text-align:right;">
50.3
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
13.8
</td>
<td style="text-align:right;">
16.5
</td>
<td style="text-align:right;">
17.1
</td>
<td style="text-align:right;">
16.1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
15.7
</td>
<td style="text-align:right;">
21963
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q50
</td>
<td style="text-align:right;">
52.6
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
14.7
</td>
<td style="text-align:right;">
24.8
</td>
<td style="text-align:right;">
18.9
</td>
<td style="text-align:right;">
19.3
</td>
<td style="text-align:right;">
8.1
</td>
<td style="text-align:right;">
9.8
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
24090
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q75
</td>
<td style="text-align:right;">
54.8
</td>
<td style="text-align:right;">
25.1
</td>
<td style="text-align:right;">
15.5
</td>
<td style="text-align:right;">
32.3
</td>
<td style="text-align:right;">
20.8
</td>
<td style="text-align:right;">
22.7
</td>
<td style="text-align:right;">
10.9
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
25.4
</td>
<td style="text-align:right;">
26667
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q90
</td>
<td style="text-align:right;">
57.4
</td>
<td style="text-align:right;">
27.5
</td>
<td style="text-align:right;">
16.2
</td>
<td style="text-align:right;">
41.1
</td>
<td style="text-align:right;">
22.3
</td>
<td style="text-align:right;">
27.4
</td>
<td style="text-align:right;">
14.4
</td>
<td style="text-align:right;">
14.7
</td>
<td style="text-align:right;">
30.5
</td>
<td style="text-align:right;">
29891
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q95
</td>
<td style="text-align:right;">
58.9
</td>
<td style="text-align:right;">
28.7
</td>
<td style="text-align:right;">
16.7
</td>
<td style="text-align:right;">
43.4
</td>
<td style="text-align:right;">
22.7
</td>
<td style="text-align:right;">
29.6
</td>
<td style="text-align:right;">
17.4
</td>
<td style="text-align:right;">
16.4
</td>
<td style="text-align:right;">
32.9
</td>
<td style="text-align:right;">
31872.7
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Mean
</td>
<td style="text-align:right;">
52.3
</td>
<td style="text-align:right;">
21.8
</td>
<td style="text-align:right;">
14.7
</td>
<td style="text-align:right;">
25.5
</td>
<td style="text-align:right;">
18.6
</td>
<td style="text-align:right;">
20.1
</td>
<td style="text-align:right;">
8.8
</td>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
21.1
</td>
<td style="text-align:right;">
24761.6
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Std
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
1.2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
3.1
</td>
<td style="text-align:right;">
5.6
</td>
<td style="text-align:right;">
4.2
</td>
<td style="text-align:right;">
3.4
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
4008.7
</td>
</tr>
</tbody>
</table>
<p>Les constats que nous avions faits précédemment sont confirmés par la figure @ref(fig:kmeansI) et le tableau @ref(tab:kmeansK). Nous retrouvons ici les groupes originaux décrits dans l’article de <span class="citation">Gelb et Apparicio (<a href="#ref-2021_4" role="doc-biblioref">2021</a><a href="#ref-2021_4" role="doc-biblioref">b</a>)</span> :</p>
<ul>
<li><strong>Groupe 1</strong> : les espaces interstitiels, formant une périphérie proche du centre et relativement hétérogène sur les variables étudiées, mais caractérisée par des niveaux de bruit importants.</li>
<li><strong>Groupe 2</strong> : les banlieues jeunes et défavorisées, avec des niveaux d’exposition aux pollutions atmosphérique et sonore relativement élevés comparativement à l’ensemble de la région.</li>
<li><strong>Groupe 3</strong> : Les quartiers centraux aisés, mais marqués par les plus hauts niveaux de pollution atmosphérique.</li>
<li><strong>Groupe 4</strong> : les communes rurales, aisées et vieillissantes.</li>
</ul>
<div class="bloc_astuce">
<p><strong>Interprétation interactive</strong></p>
<p>Si comme dans notre exemple, vos données comportent une dimension spatiale, le <em>package</em> <code>geocmeans</code> propose une fonction intéressante appelée <code>sp_clust_explorer</code> démarrant une application permettant d’explorer les résultats de votre classification. Le seul enjeu est de créer un objet de la classe <code>FCMres</code>. Voici un court exemple :</p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="#cb1117-1"></a><span class="co"># création d&#39;une matrice binaire d&#39;appartenance</span></span>
<span id="cb1117-2"><a href="#cb1117-2"></a>kmeans_mat &lt;-<span class="st"> </span><span class="kw">dummy_cols</span>(resultats<span class="op">$</span>cluster, <span class="dt">remove_selected_columns =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1117-3"><a href="#cb1117-3"></a></span>
<span id="cb1117-4"><a href="#cb1117-4"></a><span class="co"># extraction des centres de notre classification</span></span>
<span id="cb1117-5"><a href="#cb1117-5"></a>centres &lt;-<span class="st"> </span>resultats<span class="op">$</span>centers</span>
<span id="cb1117-6"><a href="#cb1117-6"></a></span>
<span id="cb1117-7"><a href="#cb1117-7"></a><span class="co"># création de l&#39;objet FCMres</span></span>
<span id="cb1117-8"><a href="#cb1117-8"></a>kmeansres &lt;-<span class="st"> </span><span class="kw">FCMres</span>(<span class="kw">list</span>(</span>
<span id="cb1117-9"><a href="#cb1117-9"></a>  <span class="st">&quot;Centers&quot;</span> =<span class="st"> </span>centres,</span>
<span id="cb1117-10"><a href="#cb1117-10"></a>  <span class="st">&quot;Belongings&quot;</span> =<span class="st"> </span>kmeans_mat,</span>
<span id="cb1117-11"><a href="#cb1117-11"></a>  <span class="st">&quot;Data&quot;</span> =<span class="st"> </span>X2,</span>
<span id="cb1117-12"><a href="#cb1117-12"></a>  <span class="st">&quot;m&quot;</span> =<span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb1117-13"><a href="#cb1117-13"></a>  <span class="st">&quot;algo&quot;</span> =<span class="st"> &quot;kmeans&quot;</span></span>
<span id="cb1117-14"><a href="#cb1117-14"></a>))</span>
<span id="cb1117-15"><a href="#cb1117-15"></a></span>
<span id="cb1117-16"><a href="#cb1117-16"></a><span class="co"># démarrage de l&#39;application shiny</span></span>
<span id="cb1117-17"><a href="#cb1117-17"></a><span class="kw">sp_clust_explorer</span>(<span class="dt">object =</span> kmeansres, <span class="dt">spatial =</span> LyonIris)</span></code></pre></div>
</div>
</div>
<div id="sect13455" class="section level4">
<h4><span class="header-section-number">12.4.4.5</span> K-médianes et K-médioides</h4>
<p>Nous présentons simplement ici comment effectuer la même analyse en utilisant les variantes du <em>k-means</em>, soit le <em>k-medians</em> et le <em>k-mediods</em>.</p>
<p>Il existe relativement peu d’implémentation du <em>k-medians</em> dans R, nous optons donc ici pour la fonction <code>kGmedian</code> du <em>package</em> <code>Gmedian</code>. Pour le <em>k-mediods</em>, nous avons retenu la fonction <code>pam</code> du <em>package</em> <code>cluster</code>.</p>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1118-1"><a href="#cb1118-1"></a><span class="kw">library</span>(Gmedian)</span>
<span id="cb1118-2"><a href="#cb1118-2"></a>k_median_res &lt;-<span class="st"> </span><span class="kw">kGmedian</span>(X, <span class="dv">4</span>)</span>
<span id="cb1118-3"><a href="#cb1118-3"></a></span>
<span id="cb1118-4"><a href="#cb1118-4"></a><span class="kw">library</span>(cluster)</span>
<span id="cb1118-5"><a href="#cb1118-5"></a>k_mediods_res &lt;-<span class="st"> </span><span class="kw">pam</span>(X,<span class="dv">4</span>)</span></code></pre></div>
<p>Juste pour le plaisir des yeux, nous pouvons cartographier les trois classifications obtenues en nous assurant au préalable de faire coïncider les groupes les plus similaires de nos trois classifications.</p>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="#cb1119-1"></a>matrice_gp_kmeans &lt;-<span class="st"> </span><span class="kw">dummy_cols</span>(resultats<span class="op">$</span>cluster,</span>
<span id="cb1119-2"><a href="#cb1119-2"></a>                                <span class="dt">remove_selected_columns =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1119-3"><a href="#cb1119-3"></a>matrice_gp_kmedians &lt;-<span class="st"> </span><span class="kw">dummy_cols</span>(<span class="kw">as.vector</span>(k_median_res<span class="op">$</span>cluster),</span>
<span id="cb1119-4"><a href="#cb1119-4"></a>                                  <span class="dt">remove_selected_columns =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1119-5"><a href="#cb1119-5"></a>matrice_gp_kmedioids &lt;-<span class="st"> </span><span class="kw">dummy_cols</span>(k_mediods_res<span class="op">$</span>cluster,</span>
<span id="cb1119-6"><a href="#cb1119-6"></a>                                   <span class="dt">remove_selected_columns =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1119-7"><a href="#cb1119-7"></a></span>
<span id="cb1119-8"><a href="#cb1119-8"></a><span class="co"># Appariement des groupes du k-medians avec ceux du kmeans</span></span>
<span id="cb1119-9"><a href="#cb1119-9"></a>matrice_gp_kmedians &lt;-<span class="st"> </span>geocmeans<span class="op">::</span><span class="kw">groups_matching</span>(<span class="kw">as.matrix</span>(matrice_gp_kmeans),</span>
<span id="cb1119-10"><a href="#cb1119-10"></a>                                                 <span class="kw">as.matrix</span>(matrice_gp_kmedians))</span>
<span id="cb1119-11"><a href="#cb1119-11"></a></span>
<span id="cb1119-12"><a href="#cb1119-12"></a><span class="co"># Appariement des groupes du k-medioids avec ceux du kmeans</span></span>
<span id="cb1119-13"><a href="#cb1119-13"></a>matrice_gp_kmedioids &lt;-<span class="st"> </span>geocmeans<span class="op">::</span><span class="kw">groups_matching</span>(<span class="kw">as.matrix</span>(matrice_gp_kmeans),</span>
<span id="cb1119-14"><a href="#cb1119-14"></a>                                                   <span class="kw">as.matrix</span>(matrice_gp_kmedioids))</span>
<span id="cb1119-15"><a href="#cb1119-15"></a></span>
<span id="cb1119-16"><a href="#cb1119-16"></a><span class="co"># ajouts des colonnes nécessaires à LyonIris</span></span>
<span id="cb1119-17"><a href="#cb1119-17"></a><span class="kw">colnames</span>(matrice_gp_kmeans) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;groupe_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb1119-18"><a href="#cb1119-18"></a><span class="kw">colnames</span>(matrice_gp_kmedians) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;groupe_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb1119-19"><a href="#cb1119-19"></a><span class="kw">colnames</span>(matrice_gp_kmedioids) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;groupe_&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb1119-20"><a href="#cb1119-20"></a></span>
<span id="cb1119-21"><a href="#cb1119-21"></a>LyonIris<span class="op">$</span>kmeans &lt;-<span class="st"> </span><span class="kw">colnames</span>(matrice_gp_kmeans)[<span class="kw">max.col</span>(matrice_gp_kmeans)]</span>
<span id="cb1119-22"><a href="#cb1119-22"></a>LyonIris<span class="op">$</span>kmedians &lt;-<span class="st"> </span><span class="kw">colnames</span>(matrice_gp_kmedians)[<span class="kw">max.col</span>(matrice_gp_kmedians)]</span>
<span id="cb1119-23"><a href="#cb1119-23"></a>LyonIris<span class="op">$</span>kmedioids &lt;-<span class="st"> </span><span class="kw">colnames</span>(matrice_gp_kmedioids)[<span class="kw">max.col</span>(matrice_gp_kmedioids)]</span>
<span id="cb1119-24"><a href="#cb1119-24"></a></span>
<span id="cb1119-25"><a href="#cb1119-25"></a><span class="co"># construction de la figure</span></span>
<span id="cb1119-26"><a href="#cb1119-26"></a>couleurs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#EFBE89&quot;</span>, <span class="st">&quot;#4A6A9F&quot;</span>, <span class="st">&quot;#7DB47C&quot;</span>, <span class="st">&quot;#FAF29C&quot;</span>)</span>
<span id="cb1119-27"><a href="#cb1119-27"></a></span>
<span id="cb1119-28"><a href="#cb1119-28"></a>map1 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(LyonIris) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1119-29"><a href="#cb1119-29"></a><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="st">&quot;kmeans&quot;</span>,<span class="dt">palette =</span> couleurs,<span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="fl">0.1</span>)</span>
<span id="cb1119-30"><a href="#cb1119-30"></a>map2 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(LyonIris) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1119-31"><a href="#cb1119-31"></a><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="st">&quot;kmedians&quot;</span>,<span class="dt">palette =</span> couleurs,<span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="fl">0.1</span>)</span>
<span id="cb1119-32"><a href="#cb1119-32"></a>map3 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(LyonIris) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1119-33"><a href="#cb1119-33"></a><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="st">&quot;kmedioids&quot;</span>,<span class="dt">palette =</span> couleurs,<span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="fl">0.1</span>)</span>
<span id="cb1119-34"><a href="#cb1119-34"></a></span>
<span id="cb1119-35"><a href="#cb1119-35"></a><span class="kw">tmap_arrange</span>(map1, map2, map3, </span>
<span id="cb1119-36"><a href="#cb1119-36"></a>             <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeansM-1.png" alt="Comparaison géographique des résultats obtenus pour le k-means, k-medians et k-medoids" width="100%" />
<p class="caption">
(#fig:kmeansM)Comparaison géographique des résultats obtenus pour le k-means, k-medians et k-medoids
</p>
</div>
<p>Les trois cartes sont très similaires (figure @ref(fig:kmeansM)), ce qui signifie que les trois algorithmes tendent à attribuer les observations aux mêmes groupes. Cependant, nous pouvons noter des différences, notamment au nord avec des observations alternant entre les groupes 2 et 3 selon la méthode employée. Ceci peut notamment signifier que ces observations sont « indécises », qu’il est difficile de les attribuer définitivement à une catégorie en particulier. Pour prendre en compte cette forme d’incertitude, il est possible d’opter pour des méthodes de classification en logique floue.</p>
</div>
</div>
<div id="sect1346" class="section level3">
<h3><span class="header-section-number">12.4.5</span> Extensions en logique floue : <em>c-means</em>, <em>c-medoids</em></h3>
<p>Comme nous l’avons mentionné en introduction de cette section, les méthodes de classification floues ont pour objectif d’évaluer le degré d’appartenance de chaque observation à chaque groupe plutôt que d’attribuer chaque observation à un seul groupe. Il est ainsi possible de repérer des observations incertaines, à cheval entre plusieurs groupes. Nous présentons ici deux algorithmes appartenant à cette famille : le <em>c-means</em> et le <em>c-medoids</em>. Il s’agit dans les deux cas d’extensions des <em>k-means</em> et <em>k-medoids</em> vus précédemment.</p>
<p>Pour ces deux méthodes, comme pour le <em>k-means</em>, le nombre de groupes <em>k</em> doit être spécifié. Elles comprennent cependant un paramètre supplémentaire :<em>m</em>, appelé paramètre de floutage qui contrôle à quel point le résultat obtenu sera flou ou strict. Une valeur de 1 produit une classification stricte (chaque observation appartient à un seul groupe) et une valeur plus grande conduit à des classifications de plus en plus floues, jusqu’à ce que chaque observation appartienne à un degré identique à chacun des groupes. Il est recommandé de sélectionner <em>m</em> en même temps que <em>k</em> car ces deux valeurs impactent simultanément la qualité de la classification. La meilleure approche consiste à tester un ensemble de combinaisons de <em>m</em> et de <em>k</em> et comparer les valeurs obtenues pour différents indicateurs de qualité de classification floue. Parmi ces indicateurs, il est notamment recommandé d’utiliser le pourcentage de l’inertie expliquée, l’indice de silhouette pour classification floue, l’indice de Xie et Beni <span class="citation">(<a href="#ref-xie1991validity" role="doc-biblioref">1991</a>)</span>, et de Fukuyama et Sugeno <span class="citation">(Fukuyama <a href="#ref-fukuyama1989" role="doc-biblioref">1989</a>)</span>.</p>
<div id="sect13461" class="section level4">
<h4><span class="header-section-number">12.4.5.1</span> Mise en oeuvre du <em>c-means</em> dans R</h4>
<p>Le <em>package</em> <code>fclust</code> comprend un très grand nombre de méthodes pour effectuer des classifications floues, nous l’utilisons donc en priorité ici en combinaison avec des fonctions d’interprétation du <em>package</em> <code>geocmeans</code>.</p>
<div id="préparation-des-données" class="section level5">
<h5><span class="header-section-number">12.4.5.1.1</span> Préparation des données</h5>
<p>Comme pour le <em>k-means</em>, cette méthode nécessite de disposer d’un jeu de données ne comprenant que des variables quantitatives dans la même échelle. Nous commençons donc à nouveau par standardiser nos données. Pour varier les plaisirs, nous optons cette fois-ci pour une transformation des variables dans une échelle allant de 0 à 100.</p>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1120-1"><a href="#cb1120-1"></a><span class="kw">library</span>(fclust)</span>
<span id="cb1120-2"><a href="#cb1120-2"></a></span>
<span id="cb1120-3"><a href="#cb1120-3"></a><span class="kw">data</span>(LyonIris)</span>
<span id="cb1120-4"><a href="#cb1120-4"></a></span>
<span id="cb1120-5"><a href="#cb1120-5"></a><span class="co"># NB : LyonIris est un objet spatial, il faut donc extraire uniquement son DataFrame</span></span>
<span id="cb1120-6"><a href="#cb1120-6"></a>X &lt;-<span class="st"> </span>LyonIris<span class="op">@</span>data[<span class="kw">c</span>(<span class="st">&quot;Lden&quot;</span>,<span class="st">&quot;NO2&quot;</span>,<span class="st">&quot;PM25&quot;</span>,<span class="st">&quot;VegHautPrt&quot;</span>,<span class="st">&quot;Pct0_14&quot;</span>,<span class="st">&quot;Pct_65&quot;</span>,<span class="st">&quot;Pct_Img&quot;</span>,</span>
<span id="cb1120-7"><a href="#cb1120-7"></a>                     <span class="st">&quot;TxChom1564&quot;</span>,<span class="st">&quot;Pct_brevet&quot;</span>,<span class="st">&quot;NivVieMed&quot;</span>)]</span>
<span id="cb1120-8"><a href="#cb1120-8"></a></span>
<span id="cb1120-9"><a href="#cb1120-9"></a><span class="co"># changement d&#39;échelle des données (0 à 100)</span></span>
<span id="cb1120-10"><a href="#cb1120-10"></a>to_<span class="dv">0</span>_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb1120-11"><a href="#cb1120-11"></a>  <span class="kw">return</span>((x<span class="op">-</span><span class="kw">min</span>(x)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)</span>
<span id="cb1120-12"><a href="#cb1120-12"></a>}</span>
<span id="cb1120-13"><a href="#cb1120-13"></a></span>
<span id="cb1120-14"><a href="#cb1120-14"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="kw">names</span>(X)){</span>
<span id="cb1120-15"><a href="#cb1120-15"></a>  X[[col]] &lt;-<span class="st"> </span><span class="kw">to_0_100</span>(X[[col]])</span>
<span id="cb1120-16"><a href="#cb1120-16"></a>}</span></code></pre></div>
</div>
<div id="sélection-de-k-et-de-m" class="section level5">
<h5><span class="header-section-number">12.4.5.1.2</span> Sélection de <em>k</em> et de <em>m</em></h5>
<p>La seconde étape consiste à sélectionner les valeurs idéales pour <em>k</em> et <em>m</em>. Nous testons ici toutes les valeurs de k entre 2 et 7, et les valeurs de <em>m</em> entre 1,5 et 2,5 (avec des écarts de 0,1).</p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="#cb1121-1"></a><span class="kw">library</span>(e1071)</span>
<span id="cb1121-2"><a href="#cb1121-2"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1121-3"><a href="#cb1121-3"></a>ms &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">1.5</span>,<span class="fl">2.5</span>,<span class="dt">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb1121-4"><a href="#cb1121-4"></a>ks &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">:</span><span class="dv">7</span></span>
<span id="cb1121-5"><a href="#cb1121-5"></a></span>
<span id="cb1121-6"><a href="#cb1121-6"></a></span>
<span id="cb1121-7"><a href="#cb1121-7"></a><span class="co"># calcul de toutes les combinaisons</span></span>
<span id="cb1121-8"><a href="#cb1121-8"></a>combinaisons &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(ms,ks)</span>
<span id="cb1121-9"><a href="#cb1121-9"></a></span>
<span id="cb1121-10"><a href="#cb1121-10"></a>eval_indices &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Explained.inertia&quot;</span>, <span class="st">&quot;Silhouette.index&quot;</span>, <span class="st">&quot;FukuyamaSugeno.index&quot;</span>)</span>
<span id="cb1121-11"><a href="#cb1121-11"></a></span>
<span id="cb1121-12"><a href="#cb1121-12"></a>values &lt;-<span class="st"> </span><span class="kw">apply</span>(combinaisons, <span class="dt">MARGIN =</span> <span class="dv">1</span>, <span class="dt">FUN =</span> <span class="cf">function</span>(row){</span>
<span id="cb1121-13"><a href="#cb1121-13"></a>  m &lt;-<span class="st"> </span>row[[<span class="dv">1</span>]]</span>
<span id="cb1121-14"><a href="#cb1121-14"></a>  k &lt;-<span class="st"> </span>row[[<span class="dv">2</span>]]</span>
<span id="cb1121-15"><a href="#cb1121-15"></a>  resultats &lt;-<span class="st"> </span><span class="kw">FKM</span>(X, k, m)</span>
<span id="cb1121-16"><a href="#cb1121-16"></a>  idx &lt;-<span class="st"> </span>geocmeans<span class="op">::</span><span class="kw">calcqualityIndexes</span>(<span class="kw">as.matrix</span>(X),</span>
<span id="cb1121-17"><a href="#cb1121-17"></a>                                       <span class="kw">as.matrix</span>(resultats<span class="op">$</span>U), </span>
<span id="cb1121-18"><a href="#cb1121-18"></a>                                       <span class="dt">m =</span> m,</span>
<span id="cb1121-19"><a href="#cb1121-19"></a>                                       <span class="dt">indices =</span> eval_indices)</span>
<span id="cb1121-20"><a href="#cb1121-20"></a>  <span class="kw">return</span>(<span class="kw">c</span>(k,m,<span class="kw">unlist</span>(idx)))</span>
<span id="cb1121-21"><a href="#cb1121-21"></a>})</span>
<span id="cb1121-22"><a href="#cb1121-22"></a></span>
<span id="cb1121-23"><a href="#cb1121-23"></a>df_scores &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(values))</span>
<span id="cb1121-24"><a href="#cb1121-24"></a><span class="kw">names</span>(df_scores) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;k&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;inertie&quot;</span>, <span class="st">&quot;silhouette&quot;</span>, <span class="st">&quot;FukuyamaSugeno&quot;</span>)</span>
<span id="cb1121-25"><a href="#cb1121-25"></a></span>
<span id="cb1121-26"><a href="#cb1121-26"></a><span class="co"># changer l&#39;échelle de l&#39;indice pour un graphique plus joli</span></span>
<span id="cb1121-27"><a href="#cb1121-27"></a>df_scores<span class="op">$</span>FukuyamaSugeno &lt;-<span class="st"> </span><span class="kw">round</span>(df_scores<span class="op">$</span>FukuyamaSugeno<span class="op">/</span><span class="dv">10000</span>,<span class="dv">2</span>)</span>
<span id="cb1121-28"><a href="#cb1121-28"></a></span>
<span id="cb1121-29"><a href="#cb1121-29"></a><span class="co"># création de trois figures pour représenter les trois indicateurs</span></span>
<span id="cb1121-30"><a href="#cb1121-30"></a><span class="kw">library</span>(viridis)</span>
<span id="cb1121-31"><a href="#cb1121-31"></a></span>
<span id="cb1121-32"><a href="#cb1121-32"></a>plot1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_scores) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-33"><a href="#cb1121-33"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> m, <span class="dt">fill =</span> inertie)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-34"><a href="#cb1121-34"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-35"><a href="#cb1121-35"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)) <span class="op">+</span></span>
<span id="cb1121-36"><a href="#cb1121-36"></a><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio=</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-37"><a href="#cb1121-37"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_colourbar</span>(<span class="dt">barwidth =</span> <span class="dv">5</span>, <span class="dt">barheight =</span> <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb1121-38"><a href="#cb1121-38"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Inertie expliquée&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-39"><a href="#cb1121-39"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="dt">legend.box =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb1121-40"><a href="#cb1121-40"></a>        <span class="dt">legend.title =</span> <span class="kw">element_text</span>( <span class="dt">size=</span><span class="dv">9</span>), <span class="dt">legend.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">8</span>))</span>
<span id="cb1121-41"><a href="#cb1121-41"></a></span>
<span id="cb1121-42"><a href="#cb1121-42"></a>plot2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_scores) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-43"><a href="#cb1121-43"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> m, <span class="dt">fill =</span> silhouette)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-44"><a href="#cb1121-44"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-45"><a href="#cb1121-45"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)) <span class="op">+</span></span>
<span id="cb1121-46"><a href="#cb1121-46"></a><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio=</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-47"><a href="#cb1121-47"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_colourbar</span>(<span class="dt">barwidth =</span> <span class="dv">5</span>, <span class="dt">barheight =</span> <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb1121-48"><a href="#cb1121-48"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Indice de silhouette&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-49"><a href="#cb1121-49"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="dt">legend.box =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb1121-50"><a href="#cb1121-50"></a>        <span class="dt">legend.title =</span> <span class="kw">element_text</span>( <span class="dt">size=</span><span class="dv">9</span>), <span class="dt">legend.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">8</span>))</span>
<span id="cb1121-51"><a href="#cb1121-51"></a></span>
<span id="cb1121-52"><a href="#cb1121-52"></a>plot3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_scores) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-53"><a href="#cb1121-53"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> m, <span class="dt">fill =</span> FukuyamaSugeno)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-54"><a href="#cb1121-54"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-55"><a href="#cb1121-55"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)) <span class="op">+</span></span>
<span id="cb1121-56"><a href="#cb1121-56"></a><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio=</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-57"><a href="#cb1121-57"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_colourbar</span>(<span class="dt">barwidth =</span> <span class="dv">5</span>, <span class="dt">barheight =</span> <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb1121-58"><a href="#cb1121-58"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Indice de Fukuyama et Sugeno&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1121-59"><a href="#cb1121-59"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="dt">legend.box =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb1121-60"><a href="#cb1121-60"></a>        <span class="dt">legend.title =</span> <span class="kw">element_text</span>( <span class="dt">size=</span><span class="dv">9</span>), <span class="dt">legend.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">8</span>))</span>
<span id="cb1121-61"><a href="#cb1121-61"></a></span>
<span id="cb1121-62"><a href="#cb1121-62"></a><span class="kw">ggarrange</span>(plot1, plot2, plot3, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cmeansB-1.png" alt="Sélection des paramètres k et m pour l'algorithme c-means" width="75%" />
<p class="caption">
(#fig:cmeansB)Sélection des paramètres k et m pour l’algorithme c-means
</p>
</div>
<p>Ces trois graphiques à la figure (figure @ref(fig:cmeansB)) semblent indiquer des solutions différentes. Sans surprise, augmenter le niveau de flou (<em>m</em>) réduit l’inertie expliquée alors qu’augmenter le nombre de groupes (<em>k</em>) augmente l’inertie expliquée. L’indice de Silhouette indique assez clairement que trois groupes serait le meilleur choix, suivi par deux ou quatre groupes, si <em>m</em> est inférieur à 1,8. Cependant, ne retenir que trois groupes ne permet d’expliquer que 30% de l’inertie. Afin de nous rapprocher des résultats de l’article original <span class="citation">(Gelb et Apparicio <a href="#ref-2021_4" role="doc-biblioref">2021</a><a href="#ref-2021_4" role="doc-biblioref">b</a>)</span>, nous allons retenir <code>m = 1,5</code> et <code>k = 4</code>.</p>
</div>
<div id="appliquer-lalgorithme-c-means" class="section level5">
<h5><span class="header-section-number">12.4.5.1.3</span> Appliquer l’algorithme <em>c-means</em></h5>
<p>Avec <em>k</em> et <em>m</em> définis, il ne reste plus qu’à appliquer l’algorithme à nos observations.</p>
<div class="sourceCode" id="cb1122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1122-1"><a href="#cb1122-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1122-2"><a href="#cb1122-2"></a>cmeans_resultats &lt;-<span class="st"> </span><span class="kw">FKM</span>(X, <span class="dv">4</span>, <span class="fl">1.5</span>)</span></code></pre></div>
<p>L’objet obtenu <code>cmeans_resultats</code> contient les résultats de la classification. Plus spécifiquement, <code>cmeans_resultats$U</code> est la matrice d’appartenance, soit une matrice de taille <em>n</em> x <em>k</em>, dont chaque case <span class="math inline">\(U_{ij}\)</span> indique la probabilité pour l’observation <em>i</em> d’appartenir au groupe <em>j</em>. <code>cmeans_resultats$H</code> contient le centre des groupes, et <code>cmeans_resultats$Clus</code> le groupe auquel chaque observation à la plus de chance d’appartenir. Pour comparer plus facilement nos résultats avec ceux du <em>k-means</em>, nous pouvons changer l’ordre des groupes obtenus pour les faire coïncider avec les groupes les plus similaires obtenus avec la méthode <em>k-means</em>.</p>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="#cb1123-1"></a><span class="co"># changeons l&#39;ordre des groupes</span></span>
<span id="cb1123-2"><a href="#cb1123-2"></a>U &lt;-<span class="st"> </span>cmeans_resultats<span class="op">$</span>U</span>
<span id="cb1123-3"><a href="#cb1123-3"></a>U2 &lt;-<span class="st"> </span>geocmeans<span class="op">::</span><span class="kw">groups_matching</span>(<span class="kw">as.matrix</span>(matrice_gp_kmeans), <span class="kw">as.matrix</span>(U))</span>
<span id="cb1123-4"><a href="#cb1123-4"></a></span>
<span id="cb1123-5"><a href="#cb1123-5"></a><span class="co"># mais aussi du centre des classes</span></span>
<span id="cb1123-6"><a href="#cb1123-6"></a>idx &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">gsub</span>(<span class="st">&quot;Clus &quot;</span>,<span class="st">&quot;&quot;</span>,<span class="kw">colnames</span>(U2), <span class="dt">fixed =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1123-7"><a href="#cb1123-7"></a>H2 &lt;-<span class="st"> </span>cmeans_resultats<span class="op">$</span>H[idx,]</span>
<span id="cb1123-8"><a href="#cb1123-8"></a></span>
<span id="cb1123-9"><a href="#cb1123-9"></a><span class="co"># et recalcul du groupe le plus probable</span></span>
<span id="cb1123-10"><a href="#cb1123-10"></a>Clus2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1123-11"><a href="#cb1123-11"></a>  <span class="st">&quot;Cluster&quot;</span> =<span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)[<span class="kw">max.col</span>(U2,<span class="dt">ties.method=</span><span class="st">&quot;first&quot;</span>)],</span>
<span id="cb1123-12"><a href="#cb1123-12"></a>  <span class="st">&quot;Membership degree&quot;</span> =<span class="st"> </span><span class="kw">apply</span>(U2, <span class="dt">MARGIN =</span> <span class="dv">1</span>, max)</span>
<span id="cb1123-13"><a href="#cb1123-13"></a>)</span>
<span id="cb1123-14"><a href="#cb1123-14"></a></span>
<span id="cb1123-15"><a href="#cb1123-15"></a><span class="kw">colnames</span>(U2) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Clus&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb1123-16"><a href="#cb1123-16"></a><span class="kw">rownames</span>(H2) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Clus&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb1123-17"><a href="#cb1123-17"></a></span>
<span id="cb1123-18"><a href="#cb1123-18"></a>cmeans_resultats<span class="op">$</span>U &lt;-<span class="st"> </span>U2</span>
<span id="cb1123-19"><a href="#cb1123-19"></a>cmeans_resultats<span class="op">$</span>H &lt;-<span class="st"> </span>H2</span>
<span id="cb1123-20"><a href="#cb1123-20"></a>cmeans_resultats<span class="op">$</span>Clus &lt;-<span class="st"> </span>Clus2</span></code></pre></div>
</div>
<div id="interpréter-les-résultats" class="section level5">
<h5><span class="header-section-number">12.4.5.1.4</span> Interpréter les résultats</h5>
<p>Globalement, les approches pour interpréter les résultats issus d’une classification obtenue par <em>c-means</em> sont les mêmes que pour une classification obtenue par <em>k-means</em>.</p>
<p>Commençons donc par créer plusieurs cartes des probabilités d’appartenir aux différents groupes.</p>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1124-1"><a href="#cb1124-1"></a>maps &lt;-<span class="st"> </span><span class="kw">mapClusters</span>(LyonIris, cmeans_resultats<span class="op">$</span>U)</span>
<span id="cb1124-2"><a href="#cb1124-2"></a></span>
<span id="cb1124-3"><a href="#cb1124-3"></a><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> maps<span class="op">$</span>ProbaMaps, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">legend =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cmeansD-1.png" alt="Cartographie des probabilités d'appartenir aux quatre groupes identifiés par l'algorithme c-means" width="100%" />
<p class="caption">
(#fig:cmeansD)Cartographie des probabilités d’appartenir aux quatre groupes identifiés par l’algorithme c-means
</p>
</div>
<p>Sur les cartes de la figure @ref(fig:cmeansD), l’intensité de bleu correspond à la probabilité pour chaque IRIS d’appartenir aux différents groupes. Nous pouvons retrouver les principales structures spatiales que nous avions identifiées avec le <em>k-means</em>, cependant, nous pouvons à présent constater que le groupe 1 est bien plus incertain que les autres. Nous pouvons une fois encore générer un graphique en radar pour comparer les profils des quatre groupes.</p>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="#cb1125-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="dt">mai =</span> <span class="kw">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>))</span>
<span id="cb1125-2"><a href="#cb1125-2"></a><span class="kw">spiderPlots</span>(X, cmeans_resultats<span class="op">$</span>U,</span>
<span id="cb1125-3"><a href="#cb1125-3"></a>            <span class="dt">chartcolors =</span> <span class="kw">c</span>(<span class="st">&quot;#EFBE89&quot;</span>, <span class="st">&quot;#4A6A9F&quot;</span>, <span class="st">&quot;#7DB47C&quot;</span>, <span class="st">&quot;#FAF29C&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/cmeansE-1.png" alt="Graphique en radar pour les résultats du c-means" width="100%" />
<p class="caption">
(#fig:cmeansE)Graphique en radar pour les résultats du c-means
</p>
</div>
<p>Sans surprise, nous retrouvons essentiellement les profils que nous avions obtenus avec le <em>k-means</em> dans la figure @ref(fig:cmeansE). Une différence importante peut cependant être notée : le groupe cumulant les désavantages sociaux a aussi cette fois-ci les niveaux de pollution sonore journaliers les plus élevés. Pour compléter la lecture des résultats, il est nécessaire de se pencher sur le tableau des statistiques descriptives des différents groupes. Une fois encore, nous proposons d’utiliser la fonction <code>summarizeClusters</code> du <em>package</em> <code>geocmeans</code>. Notez que cette fonction calcule les statistiques descriptives pondérées en fonction de l’appartenance des observations aux groupes. Ainsi, une observation ayant une faible chance d’appartenir à un groupe ne contribue que faiblement aux statistiques descriptives de ce groupe.</p>
<div style="page-break-after: always;"></div>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1126-1"><a href="#cb1126-1"></a>df &lt;-<span class="st">  </span>LyonIris<span class="op">@</span>data[<span class="kw">c</span>(<span class="st">&quot;Lden&quot;</span>,<span class="st">&quot;NO2&quot;</span>,<span class="st">&quot;PM25&quot;</span>,<span class="st">&quot;VegHautPrt&quot;</span>,<span class="st">&quot;Pct0_14&quot;</span>,<span class="st">&quot;Pct_65&quot;</span>,<span class="st">&quot;Pct_Img&quot;</span>,</span>
<span id="cb1126-2"><a href="#cb1126-2"></a>                       <span class="st">&quot;TxChom1564&quot;</span>,<span class="st">&quot;Pct_brevet&quot;</span>,<span class="st">&quot;NivVieMed&quot;</span>)]</span>
<span id="cb1126-3"><a href="#cb1126-3"></a></span>
<span id="cb1126-4"><a href="#cb1126-4"></a>tableaux &lt;-<span class="st"> </span><span class="kw">summarizeClusters</span>(<span class="dt">data =</span> df, </span>
<span id="cb1126-5"><a href="#cb1126-5"></a>                  <span class="dt">belongmatrix =</span> cmeans_resultats<span class="op">$</span>U,</span>
<span id="cb1126-6"><a href="#cb1126-6"></a>                  <span class="dt">weighted =</span> <span class="ot">TRUE</span>, <span class="dt">dec =</span> <span class="dv">1</span>)</span>
<span id="cb1126-7"><a href="#cb1126-7"></a></span>
<span id="cb1126-8"><a href="#cb1126-8"></a>tableau_tot &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, tableaux)</span></code></pre></div>
<table>
<caption>
(#tab:cmeansG)Statistiques descriptives de quatre groupes obtenus avec la méthode c-means
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Lden
</th>
<th style="text-align:right;">
NO2
</th>
<th style="text-align:right;">
PM25
</th>
<th style="text-align:right;">
VegHautPrt
</th>
<th style="text-align:right;">
Pct014
</th>
<th style="text-align:right;">
Pct65
</th>
<th style="text-align:right;">
PctImg
</th>
<th style="text-align:right;">
TxChom1564
</th>
<th style="text-align:right;">
Pctbrevet
</th>
<th style="text-align:right;">
NivVieMed
</th>
</tr>
</thead>
<tbody>
<tr grouplength="9">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>groupe 1</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q5
</td>
<td style="text-align:right;">
48.7
</td>
<td style="text-align:right;">
16.1
</td>
<td style="text-align:right;">
13.6
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
12.4
</td>
<td style="text-align:right;">
9.9
</td>
<td style="text-align:right;">
4.5
</td>
<td style="text-align:right;">
6.7
</td>
<td style="text-align:right;">
11.1
</td>
<td style="text-align:right;">
16274.1
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q10
</td>
<td style="text-align:right;">
50.6
</td>
<td style="text-align:right;">
18.8
</td>
<td style="text-align:right;">
13.9
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
14.3
</td>
<td style="text-align:right;">
11.4
</td>
<td style="text-align:right;">
5.9
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
13.9
</td>
<td style="text-align:right;">
17857.3
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q25
</td>
<td style="text-align:right;">
52.4
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
14.7
</td>
<td style="text-align:right;">
11.5
</td>
<td style="text-align:right;">
16.9
</td>
<td style="text-align:right;">
14.2
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
9.3
</td>
<td style="text-align:right;">
18.5
</td>
<td style="text-align:right;">
19608
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q50
</td>
<td style="text-align:right;">
54.7
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
15.6
</td>
<td style="text-align:right;">
15.8
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
17.7
</td>
<td style="text-align:right;">
11.3
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
21955.8
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q75
</td>
<td style="text-align:right;">
57.5
</td>
<td style="text-align:right;">
28.6
</td>
<td style="text-align:right;">
16.8
</td>
<td style="text-align:right;">
22.3
</td>
<td style="text-align:right;">
21.3
</td>
<td style="text-align:right;">
21.2
</td>
<td style="text-align:right;">
15.7
</td>
<td style="text-align:right;">
15.2
</td>
<td style="text-align:right;">
29.9
</td>
<td style="text-align:right;">
24068
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q90
</td>
<td style="text-align:right;">
60.7
</td>
<td style="text-align:right;">
33.3
</td>
<td style="text-align:right;">
18.5
</td>
<td style="text-align:right;">
29.7
</td>
<td style="text-align:right;">
23.3
</td>
<td style="text-align:right;">
24.4
</td>
<td style="text-align:right;">
20.3
</td>
<td style="text-align:right;">
18.5
</td>
<td style="text-align:right;">
34.7
</td>
<td style="text-align:right;">
26134.7
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q95
</td>
<td style="text-align:right;">
63.1
</td>
<td style="text-align:right;">
37.7
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
34.6
</td>
<td style="text-align:right;">
25.5
</td>
<td style="text-align:right;">
27.6
</td>
<td style="text-align:right;">
23.6
</td>
<td style="text-align:right;">
22.3
</td>
<td style="text-align:right;">
39.1
</td>
<td style="text-align:right;">
29013
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Mean
</td>
<td style="text-align:right;">
55.1
</td>
<td style="text-align:right;">
25.4
</td>
<td style="text-align:right;">
15.8
</td>
<td style="text-align:right;">
17.5
</td>
<td style="text-align:right;">
18.9
</td>
<td style="text-align:right;">
17.9
</td>
<td style="text-align:right;">
12.4
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
24.7
</td>
<td style="text-align:right;">
21951.6
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Std
</td>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
1.7
</td>
<td style="text-align:right;">
8.6
</td>
<td style="text-align:right;">
4.5
</td>
<td style="text-align:right;">
5.7
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
10.3
</td>
<td style="text-align:right;">
3744.1
</td>
</tr>
<tr grouplength="9">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>groupe 2</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q5
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
19.7
</td>
<td style="text-align:right;">
14.1
</td>
<td style="text-align:right;">
6.4
</td>
<td style="text-align:right;">
14.1
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
8.9
</td>
<td style="text-align:right;">
10.1
</td>
<td style="text-align:right;">
17.1
</td>
<td style="text-align:right;">
12426.6
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q10
</td>
<td style="text-align:right;">
52.3
</td>
<td style="text-align:right;">
21.5
</td>
<td style="text-align:right;">
14.6
</td>
<td style="text-align:right;">
7.9
</td>
<td style="text-align:right;">
16.7
</td>
<td style="text-align:right;">
8.8
</td>
<td style="text-align:right;">
13.4
</td>
<td style="text-align:right;">
13.1
</td>
<td style="text-align:right;">
22.4
</td>
<td style="text-align:right;">
12973.6
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q25
</td>
<td style="text-align:right;">
54.6
</td>
<td style="text-align:right;">
23.3
</td>
<td style="text-align:right;">
15.8
</td>
<td style="text-align:right;">
10.9
</td>
<td style="text-align:right;">
20.3
</td>
<td style="text-align:right;">
11.1
</td>
<td style="text-align:right;">
19.7
</td>
<td style="text-align:right;">
16.8
</td>
<td style="text-align:right;">
30.7
</td>
<td style="text-align:right;">
14108.1
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q50
</td>
<td style="text-align:right;">
57.1
</td>
<td style="text-align:right;">
26.9
</td>
<td style="text-align:right;">
16.6
</td>
<td style="text-align:right;">
14.5
</td>
<td style="text-align:right;">
23.6
</td>
<td style="text-align:right;">
13.9
</td>
<td style="text-align:right;">
25.8
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
37.8
</td>
<td style="text-align:right;">
16010
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q75
</td>
<td style="text-align:right;">
59.5
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
17.8
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
27.1
</td>
<td style="text-align:right;">
17.4
</td>
<td style="text-align:right;">
32.1
</td>
<td style="text-align:right;">
30.1
</td>
<td style="text-align:right;">
44.4
</td>
<td style="text-align:right;">
18568.9
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q90
</td>
<td style="text-align:right;">
63.5
</td>
<td style="text-align:right;">
37.4
</td>
<td style="text-align:right;">
18.8
</td>
<td style="text-align:right;">
25.5
</td>
<td style="text-align:right;">
30.1
</td>
<td style="text-align:right;">
20.7
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
33.9
</td>
<td style="text-align:right;">
49
</td>
<td style="text-align:right;">
21028.3
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q95
</td>
<td style="text-align:right;">
65.2
</td>
<td style="text-align:right;">
39.6
</td>
<td style="text-align:right;">
19.2
</td>
<td style="text-align:right;">
30.8
</td>
<td style="text-align:right;">
32.2
</td>
<td style="text-align:right;">
23.5
</td>
<td style="text-align:right;">
40.6
</td>
<td style="text-align:right;">
37.7
</td>
<td style="text-align:right;">
52.4
</td>
<td style="text-align:right;">
23774.4
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Mean
</td>
<td style="text-align:right;">
57.3
</td>
<td style="text-align:right;">
28.1
</td>
<td style="text-align:right;">
16.7
</td>
<td style="text-align:right;">
15.8
</td>
<td style="text-align:right;">
23.4
</td>
<td style="text-align:right;">
14.4
</td>
<td style="text-align:right;">
25.5
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
36.9
</td>
<td style="text-align:right;">
16658.7
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Std
</td>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
6.6
</td>
<td style="text-align:right;">
1.6
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
9.7
</td>
<td style="text-align:right;">
9.3
</td>
<td style="text-align:right;">
12.3
</td>
<td style="text-align:right;">
3611.9
</td>
</tr>
<tr grouplength="9">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>groupe 3</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q5
</td>
<td style="text-align:right;">
50.6
</td>
<td style="text-align:right;">
27.6
</td>
<td style="text-align:right;">
16.4
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
8.7
</td>
<td style="text-align:right;">
7.1
</td>
<td style="text-align:right;">
6.1
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
17130.3
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q10
</td>
<td style="text-align:right;">
52.2
</td>
<td style="text-align:right;">
28.9
</td>
<td style="text-align:right;">
17.2
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
8.6
</td>
<td style="text-align:right;">
7.1
</td>
<td style="text-align:right;">
8.6
</td>
<td style="text-align:right;">
8.7
</td>
<td style="text-align:right;">
18454.2
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q25
</td>
<td style="text-align:right;">
53.9
</td>
<td style="text-align:right;">
30.9
</td>
<td style="text-align:right;">
18.4
</td>
<td style="text-align:right;">
10.2
</td>
<td style="text-align:right;">
12.6
</td>
<td style="text-align:right;">
10.8
</td>
<td style="text-align:right;">
9.1
</td>
<td style="text-align:right;">
11.1
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
19805.4
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q50
</td>
<td style="text-align:right;">
56.5
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
18.9
</td>
<td style="text-align:right;">
13.4
</td>
<td style="text-align:right;">
15.2
</td>
<td style="text-align:right;">
14.1
</td>
<td style="text-align:right;">
12.3
</td>
<td style="text-align:right;">
13.1
</td>
<td style="text-align:right;">
14.8
</td>
<td style="text-align:right;">
22308.8
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q75
</td>
<td style="text-align:right;">
59.4
</td>
<td style="text-align:right;">
38.7
</td>
<td style="text-align:right;">
19.6
</td>
<td style="text-align:right;">
17.5
</td>
<td style="text-align:right;">
17.9
</td>
<td style="text-align:right;">
17.5
</td>
<td style="text-align:right;">
15.9
</td>
<td style="text-align:right;">
15.5
</td>
<td style="text-align:right;">
21.5
</td>
<td style="text-align:right;">
24515.7
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q90
</td>
<td style="text-align:right;">
62.8
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
24.8
</td>
<td style="text-align:right;">
20.4
</td>
<td style="text-align:right;">
20.5
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
18.4
</td>
<td style="text-align:right;">
27.9
</td>
<td style="text-align:right;">
27620.4
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q95
</td>
<td style="text-align:right;">
64.4
</td>
<td style="text-align:right;">
44.1
</td>
<td style="text-align:right;">
20.2
</td>
<td style="text-align:right;">
30.3
</td>
<td style="text-align:right;">
21.8
</td>
<td style="text-align:right;">
23.2
</td>
<td style="text-align:right;">
21.1
</td>
<td style="text-align:right;">
20.7
</td>
<td style="text-align:right;">
32.1
</td>
<td style="text-align:right;">
29862.2
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Mean
</td>
<td style="text-align:right;">
56.8
</td>
<td style="text-align:right;">
34.9
</td>
<td style="text-align:right;">
18.7
</td>
<td style="text-align:right;">
14.8
</td>
<td style="text-align:right;">
15.3
</td>
<td style="text-align:right;">
14.2
</td>
<td style="text-align:right;">
12.8
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
16.9
</td>
<td style="text-align:right;">
22595.1
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Std
</td>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
5.9
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:right;">
7.2
</td>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
5.2
</td>
<td style="text-align:right;">
5.8
</td>
<td style="text-align:right;">
5.5
</td>
<td style="text-align:right;">
9.1
</td>
<td style="text-align:right;">
3969.2
</td>
</tr>
<tr grouplength="9">
<td colspan="11" style="border-bottom: 1px solid;">
<strong>groupe 4</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q5
</td>
<td style="text-align:right;">
44.8
</td>
<td style="text-align:right;">
14.8
</td>
<td style="text-align:right;">
12.6
</td>
<td style="text-align:right;">
12.2
</td>
<td style="text-align:right;">
12.5
</td>
<td style="text-align:right;">
11.5
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
6.8
</td>
<td style="text-align:right;">
9.7
</td>
<td style="text-align:right;">
18922.4
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q10
</td>
<td style="text-align:right;">
45.8
</td>
<td style="text-align:right;">
15.7
</td>
<td style="text-align:right;">
12.9
</td>
<td style="text-align:right;">
17.7
</td>
<td style="text-align:right;">
14.2
</td>
<td style="text-align:right;">
13.2
</td>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
7.3
</td>
<td style="text-align:right;">
11.2
</td>
<td style="text-align:right;">
20246.9
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q25
</td>
<td style="text-align:right;">
49.5
</td>
<td style="text-align:right;">
18.7
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
24.8
</td>
<td style="text-align:right;">
16.6
</td>
<td style="text-align:right;">
15.8
</td>
<td style="text-align:right;">
5.9
</td>
<td style="text-align:right;">
7.9
</td>
<td style="text-align:right;">
14.3
</td>
<td style="text-align:right;">
22753.9
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q50
</td>
<td style="text-align:right;">
52.3
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
14.7
</td>
<td style="text-align:right;">
30.5
</td>
<td style="text-align:right;">
18.6
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
9.7
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
24950.1
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q75
</td>
<td style="text-align:right;">
55.1
</td>
<td style="text-align:right;">
26.3
</td>
<td style="text-align:right;">
15.9
</td>
<td style="text-align:right;">
37.9
</td>
<td style="text-align:right;">
20.8
</td>
<td style="text-align:right;">
22.4
</td>
<td style="text-align:right;">
10.1
</td>
<td style="text-align:right;">
12.1
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
28806.2
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q90
</td>
<td style="text-align:right;">
58.9
</td>
<td style="text-align:right;">
30.8
</td>
<td style="text-align:right;">
17.1
</td>
<td style="text-align:right;">
42.3
</td>
<td style="text-align:right;">
22.4
</td>
<td style="text-align:right;">
27.3
</td>
<td style="text-align:right;">
14.5
</td>
<td style="text-align:right;">
15.3
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
31426.2
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Q95
</td>
<td style="text-align:right;">
60.8
</td>
<td style="text-align:right;">
34.7
</td>
<td style="text-align:right;">
18.3
</td>
<td style="text-align:right;">
45.5
</td>
<td style="text-align:right;">
23.3
</td>
<td style="text-align:right;">
28.8
</td>
<td style="text-align:right;">
19.2
</td>
<td style="text-align:right;">
18.7
</td>
<td style="text-align:right;">
33.3
</td>
<td style="text-align:right;">
34309
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Mean
</td>
<td style="text-align:right;">
52.3
</td>
<td style="text-align:right;">
22.8
</td>
<td style="text-align:right;">
14.9
</td>
<td style="text-align:right;">
30.3
</td>
<td style="text-align:right;">
18.4
</td>
<td style="text-align:right;">
19.4
</td>
<td style="text-align:right;">
8.8
</td>
<td style="text-align:right;">
10.9
</td>
<td style="text-align:right;">
19.5
</td>
<td style="text-align:right;">
25547.4
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
Std
</td>
<td style="text-align:right;">
5.1
</td>
<td style="text-align:right;">
6.3
</td>
<td style="text-align:right;">
1.7
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
4.1
</td>
<td style="text-align:right;">
5.9
</td>
<td style="text-align:right;">
5.5
</td>
<td style="text-align:right;">
6.2
</td>
<td style="text-align:right;">
9.2
</td>
<td style="text-align:right;">
4603.5
</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="sect13462" class="section level4">
<h4><span class="header-section-number">12.4.5.2</span> Mise en oeuvre du <em>c-medoids</em> dans R</h4>
<p>La méthode du <em>c-medoids</em> dans R peut être mise en oeuvre avec la fonction <code>FKM.med</code> du <em>package</em> <code>fclust</code>. Le processus d’analyse et de validation est identique à celui présenté ci-dessus pour le <em>c-means</em>. Nous ne donnons donc pas un exemple complet de la méthode.</p>
<div class="bloc_aller_loin">
<p><strong>Stabilité des groupes obtenus par les méthodes de nuées dynamiques</strong> :</p>
<p>Puisque la méthode <em>k-means</em> et ses variantes reposent sur une initialisation aléatoire de leur algorithme, les résultats peuvent varier en fonction de cet état de départ. Dans certains contextes, il est possible que les résultats obtenus varient significativement, ce qui signifie que les groupes obtenus ne sont pas représentatifs de la population étudiée. Une solution pour vérifier si ce problème se pose est simplement de relancer l’algorithme un grand nombre de fois (généralement 1 000) et comparer les résultats obtenus au cours de ces réplications.</p>
<p>Cette méthode est rarement implémentée directement et requiert développer sa propre fonction. <code>geocmeans</code> dispose d’une fonction déjà existante, mais ne pouvant être appliquée qu’avec l’algorithme <em>c-means</em>. Nous proposons ici une implémentation pour la méthode <em>k-means</em> qui peut facilement être adaptée aux autres méthodes de classifications heuristiques.</p>
<p>La démarche à suivre est la suivante :</p>
<ol style="list-style-type: decimal">
<li>Appliquer l’algorithme une première fois pour obtenir une classification de référence à laquelle nous comparerons toutes les réplications.</li>
<li>Effectuer 1 000 itérations au cours desquelles :</li>
<li>Une nouvelle classification est calculée</li>
<li>Les groupes obtenus sont comparés à ceux de la classification de références</li>
<li>L’indice de Jacard est calculé entre les groupes des deux classifications</li>
<li>Les valeurs de l’indice de Jacard sont enregistrées</li>
<li>Les centres des groupes sont enregistrés</li>
</ol>
<p>Ainsi, nous obtenons 1 000 valeurs de l’indice de Jacard pour chaque groupe. Cet indice permet de mesurer le degré d’accord entre deux variables (ici les probabilités d’appartenance des observations au même groupe pour deux classifications différentes.) Une valeur moyenne en dessous de 0,5 indique qu’un groupe est très instable, car nous obtenons des résultats très différents lors des réplications. Une valeur entre 0,6 et 0,75 indique qu’un groupe semble bien exister dans les données, bien que marqué par une certaine incertitude. Une valeur au-dessus de 0,8 indique un groupe bien identifié et stable.</p>
<p>Nous obtenons également les centres des groupes des 1 000 classifications. Il est ainsi possible de représenter leurs histogrammes et de déterminer si les centres des groupes sont stables (unimodalité et faible variance) ou incertains (plusieurs modes et/ou forte variances).</p>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1127-1"><a href="#cb1127-1"></a><span class="co"># X sera le jeu de données pour la classification</span></span>
<span id="cb1127-2"><a href="#cb1127-2"></a><span class="co"># clust_ref sera le vecteur indiquant le groupe de chaque observation obtenu par kmeans</span></span>
<span id="cb1127-3"><a href="#cb1127-3"></a><span class="co"># nsim sera le nombre de simulations à effectuer</span></span>
<span id="cb1127-4"><a href="#cb1127-4"></a>kmeans_stability &lt;-<span class="st"> </span><span class="cf">function</span>(X, clust_ref, nsim, <span class="dt">verbose =</span> <span class="ot">TRUE</span>){</span>
<span id="cb1127-5"><a href="#cb1127-5"></a>  </span>
<span id="cb1127-6"><a href="#cb1127-6"></a>  <span class="co"># définition de la matrice d&#39;appartenance originale</span></span>
<span id="cb1127-7"><a href="#cb1127-7"></a>  k &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(clust_ref))</span>
<span id="cb1127-8"><a href="#cb1127-8"></a>  ref_mat &lt;-<span class="st"> </span><span class="kw">dummy_cols</span>(clust_ref, <span class="dt">remove_selected_columns =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1127-9"><a href="#cb1127-9"></a>  <span class="kw">colnames</span>(ref_mat) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;groupe_&quot;</span>,<span class="dv">1</span><span class="op">:</span>k)</span>
<span id="cb1127-10"><a href="#cb1127-10"></a>  </span>
<span id="cb1127-11"><a href="#cb1127-11"></a>  <span class="co"># lancement des itérations</span></span>
<span id="cb1127-12"><a href="#cb1127-12"></a>  sim_resultats &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span>nsim, <span class="cf">function</span>(i){</span>
<span id="cb1127-13"><a href="#cb1127-13"></a>    </span>
<span id="cb1127-14"><a href="#cb1127-14"></a>     <span class="co"># afficher la progression si requis</span></span>
<span id="cb1127-15"><a href="#cb1127-15"></a>    <span class="cf">if</span>(verbose){</span>
<span id="cb1127-16"><a href="#cb1127-16"></a>      <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;iteration numeros : &quot;</span>,i,<span class="st">&quot;/&quot;</span>,nsim))</span>
<span id="cb1127-17"><a href="#cb1127-17"></a>    }</span>
<span id="cb1127-18"><a href="#cb1127-18"></a>    <span class="co"># calculer le kmeans</span></span>
<span id="cb1127-19"><a href="#cb1127-19"></a>    km_res &lt;-<span class="st"> </span><span class="kw">kmeans</span>(X,k)</span>
<span id="cb1127-20"><a href="#cb1127-20"></a>    sim_mat &lt;-<span class="st"> </span><span class="kw">dummy_cols</span>(km_res<span class="op">$</span>cluster, <span class="dt">remove_selected_columns =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1127-21"><a href="#cb1127-21"></a>    </span>
<span id="cb1127-22"><a href="#cb1127-22"></a>    <span class="co"># ajustement de l&#39;ordre des groupes avec geocmeans</span></span>
<span id="cb1127-23"><a href="#cb1127-23"></a>    sim_mat &lt;-<span class="st"> </span><span class="kw">groups_matching</span>(<span class="kw">as.matrix</span>(ref_mat), <span class="kw">as.matrix</span>(sim_mat))</span>
<span id="cb1127-24"><a href="#cb1127-24"></a>    </span>
<span id="cb1127-25"><a href="#cb1127-25"></a>    <span class="co"># calcul des indices de jacard</span></span>
<span id="cb1127-26"><a href="#cb1127-26"></a>    jac_idx &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>k, <span class="cf">function</span>(j){</span>
<span id="cb1127-27"><a href="#cb1127-27"></a>      <span class="kw">calc_jaccard_idx</span>(sim_mat[,j], ref_mat[,j])</span>
<span id="cb1127-28"><a href="#cb1127-28"></a>    })</span>
<span id="cb1127-29"><a href="#cb1127-29"></a>    </span>
<span id="cb1127-30"><a href="#cb1127-30"></a>    <span class="co"># recuperation des centres des groupes</span></span>
<span id="cb1127-31"><a href="#cb1127-31"></a>    idx &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">gsub</span>(<span class="st">&quot;.data_&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="kw">colnames</span>(sim_mat),<span class="dt">fixed =</span> <span class="ot">TRUE</span>))</span>
<span id="cb1127-32"><a href="#cb1127-32"></a>    centers &lt;-<span class="st"> </span><span class="kw">data.frame</span>(km_res<span class="op">$</span>centers)</span>
<span id="cb1127-33"><a href="#cb1127-33"></a>    centers &lt;-<span class="st"> </span>centers[idx,]</span>
<span id="cb1127-34"><a href="#cb1127-34"></a>    centers<span class="op">$</span>groupe &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>k</span>
<span id="cb1127-35"><a href="#cb1127-35"></a>    </span>
<span id="cb1127-36"><a href="#cb1127-36"></a>    <span class="kw">return</span>(<span class="kw">list</span>(</span>
<span id="cb1127-37"><a href="#cb1127-37"></a>      <span class="st">&quot;jac_idx&quot;</span> =<span class="st"> </span>jac_idx,</span>
<span id="cb1127-38"><a href="#cb1127-38"></a>      <span class="st">&quot;centers&quot;</span> =<span class="st"> </span>centers</span>
<span id="cb1127-39"><a href="#cb1127-39"></a>    ))</span>
<span id="cb1127-40"><a href="#cb1127-40"></a>    </span>
<span id="cb1127-41"><a href="#cb1127-41"></a>  })</span>
<span id="cb1127-42"><a href="#cb1127-42"></a>  </span>
<span id="cb1127-43"><a href="#cb1127-43"></a>  <span class="co"># les simulations sont finies, nous pouvons combiner les resultats</span></span>
<span id="cb1127-44"><a href="#cb1127-44"></a>  all_jac_values &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, <span class="kw">lapply</span>(sim_resultats, <span class="cf">function</span>(x){x<span class="op">$</span>jac_idx}))</span>
<span id="cb1127-45"><a href="#cb1127-45"></a>  all_centers &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, <span class="kw">lapply</span>(sim_resultats, <span class="cf">function</span>(x){x<span class="op">$</span>centers}))</span>
<span id="cb1127-46"><a href="#cb1127-46"></a>  <span class="kw">return</span>(<span class="kw">list</span>(</span>
<span id="cb1127-47"><a href="#cb1127-47"></a>    <span class="st">&quot;jacard_values&quot;</span> =<span class="st"> </span>all_jac_values,</span>
<span id="cb1127-48"><a href="#cb1127-48"></a>    <span class="st">&quot;centers&quot;</span> =<span class="st"> </span>all_centers</span>
<span id="cb1127-49"><a href="#cb1127-49"></a>  ))</span>
<span id="cb1127-50"><a href="#cb1127-50"></a>}</span></code></pre></div>
<p>Il ne nous reste plus qu’à utiliser notre nouvelle fonction pour déterminer si les groupes obtenus avec notre <em>k-means</em> sont stables.</p>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="#cb1128-1"></a><span class="kw">data</span>(LyonIris)</span>
<span id="cb1128-2"><a href="#cb1128-2"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1128-3"><a href="#cb1128-3"></a></span>
<span id="cb1128-4"><a href="#cb1128-4"></a><span class="co"># NB : LyonIris est un objet spatial, il faut donc extraire uniquement son DataFrame</span></span>
<span id="cb1128-5"><a href="#cb1128-5"></a>X &lt;-<span class="st"> </span>LyonIris<span class="op">@</span>data[<span class="kw">c</span>(<span class="st">&quot;Lden&quot;</span>,<span class="st">&quot;NO2&quot;</span>,<span class="st">&quot;PM25&quot;</span>,<span class="st">&quot;VegHautPrt&quot;</span>,<span class="st">&quot;Pct0_14&quot;</span>,<span class="st">&quot;Pct_65&quot;</span>,<span class="st">&quot;Pct_Img&quot;</span>,</span>
<span id="cb1128-6"><a href="#cb1128-6"></a>                     <span class="st">&quot;TxChom1564&quot;</span>,<span class="st">&quot;Pct_brevet&quot;</span>,<span class="st">&quot;NivVieMed&quot;</span>)]</span>
<span id="cb1128-7"><a href="#cb1128-7"></a></span>
<span id="cb1128-8"><a href="#cb1128-8"></a><span class="co"># Centrage et réduction de chaque colonne du DataFrame</span></span>
<span id="cb1128-9"><a href="#cb1128-9"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="kw">names</span>(X)){</span>
<span id="cb1128-10"><a href="#cb1128-10"></a>  X[[col]] &lt;-<span class="st"> </span><span class="kw">scale</span>(X[[col]], <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1128-11"><a href="#cb1128-11"></a>}</span>
<span id="cb1128-12"><a href="#cb1128-12"></a></span>
<span id="cb1128-13"><a href="#cb1128-13"></a><span class="co"># calcul du kmeans de référence</span></span>
<span id="cb1128-14"><a href="#cb1128-14"></a>kmeans_ref &lt;-<span class="st"> </span><span class="kw">kmeans</span>(X, <span class="dv">4</span>)</span>
<span id="cb1128-15"><a href="#cb1128-15"></a></span>
<span id="cb1128-16"><a href="#cb1128-16"></a><span class="co"># application de la fonction de stabilité</span></span>
<span id="cb1128-17"><a href="#cb1128-17"></a>stab_results &lt;-<span class="st"> </span><span class="kw">kmeans_stability</span>(X, kmeans_ref<span class="op">$</span>cluster, <span class="dt">nsim =</span> <span class="dv">1000</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>Nous pouvons à présent vérifier la stabilité de nos quatre groupes.</p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1129-1"><a href="#cb1129-1"></a>jacard_values &lt;-<span class="st"> </span><span class="kw">data.frame</span>(stab_results<span class="op">$</span>jacard_values)</span>
<span id="cb1129-2"><a href="#cb1129-2"></a><span class="kw">names</span>(jacard_values) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;groupe&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb1129-3"><a href="#cb1129-3"></a></span>
<span id="cb1129-4"><a href="#cb1129-4"></a>df &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(jacard_values)</span>
<span id="cb1129-5"><a href="#cb1129-5"></a>df<span class="op">$</span>groupes &lt;-<span class="st"> </span><span class="kw">as.factor</span>(df<span class="op">$</span>variable)</span>
<span id="cb1129-6"><a href="#cb1129-6"></a></span>
<span id="cb1129-7"><a href="#cb1129-7"></a><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1129-8"><a href="#cb1129-8"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value), <span class="dt">bins =</span> <span class="dv">30</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1129-9"><a href="#cb1129-9"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(groupes), <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1129-10"><a href="#cb1129-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Indice de Jacard&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeansStab3-1.png" alt="Indices de Jacard obtenus sur 1000 réplications du k-means" width="90%"  />
<p class="caption">
(#fig:kmeansStab3)Indices de Jacard obtenus sur 1000 réplications du k-means
</p>
</div>
<p>La figure @ref(fig:kmeansStab3) indique clairement que les groupes 1 et 2 sont très stables, car les valeurs de Jacard obtenues sont le plus souvent supérieures à 0,75. Le groupe 3 a le plus souvent des valeurs légèrement inférieures aux deux premiers groupes, mais tout de même bien supérieures à 0,5. En revanche, le groupe 4 a un grand nombre de valeurs inférieures à 0,5 indiquant une tendance du groupe à se dissoudre lors des réplications.</p>
<p>Considérant que le dernier groupe est le plus instable, nous décidons d’observer les valeurs des centres qu’il obtient pour les différentes réplications.</p>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="#cb1130-1"></a>centers_groupe4 &lt;-<span class="st"> </span><span class="kw">subset</span>(stab_results<span class="op">$</span>centers, stab_results<span class="op">$</span>centers<span class="op">$</span>groupe <span class="op">==</span><span class="st"> </span><span class="dv">4</span>)</span>
<span id="cb1130-2"><a href="#cb1130-2"></a>centers_groupe4<span class="op">$</span>groupe &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb1130-3"><a href="#cb1130-3"></a></span>
<span id="cb1130-4"><a href="#cb1130-4"></a>df &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(centers_groupe4)</span>
<span id="cb1130-5"><a href="#cb1130-5"></a>df<span class="op">$</span>variable &lt;-<span class="st"> </span><span class="kw">as.factor</span>(df<span class="op">$</span>variable)</span>
<span id="cb1130-6"><a href="#cb1130-6"></a></span>
<span id="cb1130-7"><a href="#cb1130-7"></a><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1130-8"><a href="#cb1130-8"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value), <span class="dt">bins =</span> <span class="dv">30</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1130-9"><a href="#cb1130-9"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(variable), <span class="dt">ncol=</span><span class="dv">3</span>, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1130-10"><a href="#cb1130-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeansStab4-1.png" alt="Distributions des valeurs des centres du groupe 4 sur 1000 itérations" width="90%"  />
<p class="caption">
(#fig:kmeansStab4)Distributions des valeurs des centres du groupe 4 sur 1000 itérations
</p>
</div>
<p>Les différents histogrammes de la figure @ref(fig:kmeansStab4) indiquent clairement que pour plusieurs variables (<code>Lden</code>, <code>NO2</code>, <code>PM25</code>, <code>Pct_Img</code>, et <code>NivVieMed</code>) les caractéristiques du groupe 4 varient grandement sur l’ensemble des réplications. Nous pouvons comparer ce graphique à celui du groupe 2 qui était bien plus stable.</p>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1131-1"><a href="#cb1131-1"></a>centers_groupe2 &lt;-<span class="st"> </span><span class="kw">subset</span>(stab_results<span class="op">$</span>centers, stab_results<span class="op">$</span>centers<span class="op">$</span>groupe <span class="op">==</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb1131-2"><a href="#cb1131-2"></a>centers_groupe2<span class="op">$</span>groupe &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb1131-3"><a href="#cb1131-3"></a></span>
<span id="cb1131-4"><a href="#cb1131-4"></a>df &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(centers_groupe2)</span>
<span id="cb1131-5"><a href="#cb1131-5"></a>df<span class="op">$</span>variable &lt;-<span class="st"> </span><span class="kw">as.factor</span>(df<span class="op">$</span>variable)</span>
<span id="cb1131-6"><a href="#cb1131-6"></a></span>
<span id="cb1131-7"><a href="#cb1131-7"></a><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1131-8"><a href="#cb1131-8"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value), <span class="dt">bins =</span> <span class="dv">30</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1131-9"><a href="#cb1131-9"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(variable), <span class="dt">ncol=</span><span class="dv">3</span>, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1131-10"><a href="#cb1131-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MethodesQuantitScSocialesR_files/figure-html/kmeansStab5-1.png" alt="Distributions des valeurs des centres du groupe 2 sur 1000 itérations" width="90%"  />
<p class="caption">
(#fig:kmeansStab5)Distributions des valeurs des centres du groupe 2 sur 1000 itérations
</p>
</div>
<p>Nous pouvons constater une plus faible variance des résultats obtenus (en regardant notamment l’axe horizontal) pour les centres des groupes à la figure @ref(fig:kmeansStab5).</p>
</div>
</div>
</div>
</div>
<div id="sect135" class="section level2">
<h2><span class="header-section-number">12.5</span> Conclusion sur la cinquième partie</h2>
<p>Dans le cadre de cette cinquième partie du livre, nous avons abordé les principales méthodes factorielles et méthodes de classification non supervisées. Les premières sont des méthodes de réduction de données puisqu’elles permettent de résumer l’information d’un tableau en quelques nouvelles variables synthétiques. Les secondes permettent de regrouper les observations d’un tableau en plusieurs groupes homogènes. Il existe donc une complémentarité évidente entre ces deux groupes de méthodes : si le tableau initial comprend un grand nombre de variables, il est possible de lui appliquer une méthode factorielle produisant de nouvelles variables synthétiques qui sont ensuite utilisées pour calculer une méthode de classification non supervisée.</p>
<div class="figure" style="text-align: center">
<img src="images/classification/AnalysesFactoClassif.png" alt="Complémentarité entre les méthodes factorielles et les méthodes de classification non supervisées" width="50%" />
<p class="caption">
(#fig:MFMCComplementarite)Complémentarité entre les méthodes factorielles et les méthodes de classification non supervisées
</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div id="sect136" class="section level2">
<h2><span class="header-section-number">12.6</span> Quiz de révision du chapitre</h2>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="#cb1132-1"></a>quizz_classif &lt;-<span class="st"> </span><span class="kw">quizz</span>(<span class="st">&quot;quizzs/classification.yml&quot;</span>, <span class="st">&quot;quizz_classif&quot;</span>)</span>
<span id="cb1132-2"><a href="#cb1132-2"></a><span class="kw">render_quizz</span>(quizz_classif)</span></code></pre></div>
<div id="quizz_classif" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js"/>
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans r?ponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_quizz_classif;
  window.onload = function() {
    quizz_quizz_classif = new Quiz('quizz_classif', ['2','1',['1', '4'],['2', '4'],'c-medoids']);
  };</script>
<link rel="stylesheet" type="text/css" src="css/quizlib.min.css"/>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Les méthodes de classification non supervisées sont appelées ainsi puisque :
</div>
<div>
Relisez au besoin la section @ref(sect131)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>le nombre de groupes générés par ces méthodes est déterminé automatiquement</label>
</td>
<td>
<input type="radio" name="q1" value="1"/>
</td>
</tr>
<tr>
<td>
<label>les groupes sont inconnus au préalable et formés automatiquement par ces méthodes</label>
</td>
<td>
<input type="radio" name="q1" value="2"/>
</td>
</tr>
<tr>
<td>
<label>l’exécution de ces algorithmes ne nécessite pas de supervision</label>
</td>
<td>
<input type="radio" name="q1" value="3"/>
</td>
</tr>
<tr>
<td>
<label>aucun paramètre n’est à définir pour exécuter ces méthodes</label>
</td>
<td>
<input type="radio" name="q1" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
En quoi se distinguent les méthodes de classifications strictes et floues?
</div>
<div>
Relisez au besoin la section @ref(sect131)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>les premières attribuent chaque observation à un seul groupe alors que les secondes évaluent le degré d’appartenance des observations à chaque groupe</label>
</td>
<td>
<input type="radio" name="q2" value="1"/>
</td>
</tr>
<tr>
<td>
<label>les méthodes strictes produisent des classifications comportant un moins grand nombre de degrés de liberté</label>
</td>
<td>
<input type="radio" name="q2" value="2"/>
</td>
</tr>
<tr>
<td>
<label>les méthodes strictes produisent toujours les mêmes résultats, alors que les méthodes floues reposent sur un état initial aléatoire pouvant conduire à des résultats différents</label>
</td>
<td>
<input type="radio" name="q2" value="3"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels paramètres doivent être définis pour exécuter l’algorithme c-means?
</div>
<div>
Relisez au besoin la section @ref(sect1344)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>K, soit le nombre de groupes à obtenir</label>
</td>
<td>
<input type="checkbox" name="q3" value="1"/>
</td>
</tr>
<tr>
<td>
<label>Alpha, soit le paramètre contrôlant la vitesse de convergence</label>
</td>
<td>
<input type="checkbox" name="q3" value="2"/>
</td>
</tr>
<tr>
<td>
<label>Lambda, soit la probabilité minimale qu’une observation appartiennent à un groupe</label>
</td>
<td>
<input type="checkbox" name="q3" value="3"/>
</td>
</tr>
<tr>
<td>
<label>M, soit le paramètre controlant le niveau de flou dans une classification floue</label>
</td>
<td>
<input type="checkbox" name="q3" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
La classification ascendante hiérarchique nécessite de calculer :
</div>
<div>
Relisez au besoin la section @ref(sect133)
</div>
<div class="quizlib-question-answers">
<table>
<tr>
<td>
<label>La distance entre chaque observation et ses k plus proches voisins</label>
</td>
<td>
<input type="checkbox" name="q4" value="1"/>
</td>
</tr>
<tr>
<td>
<label>La distance entre l’ensemble des paires d’observations</label>
</td>
<td>
<input type="checkbox" name="q4" value="2"/>
</td>
</tr>
<tr>
<td>
<label>La probabilité pour chaque observation d’appartenir à chaque groupe</label>
</td>
<td>
<input type="checkbox" name="q4" value="3"/>
</td>
</tr>
<tr>
<td>
<label>Un dendrogramme, soit une structure hiérarchique permettant de conserver l’ordre dans lequel les groupes sont formés par l’algorithme</label>
</td>
<td>
<input type="checkbox" name="q4" value="4"/>
</td>
</tr>
</table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour effectuer une classification non supervisée floue utilisant comme centres de groupes de réelles observations plutôt que des moyennes fictives, quelle méthode peut-on utiliser?
</div>
<div>
Relisez au besoin la section @ref(sect1344)
</div>
<div class="quizlib-question-answers">
<p><input type="text" name="q5"/></p>
</div>
</div>
<button type="button" onclick="showResults(quizz_quizz_classif);">
Verifier
</button>
<div id="quiz-result" class="card">
<p>Votre score
<span id="quiz-percent"></span></p>
</div>
</div>
<!--chapter:end:13-MethodeClassification.Rmd-->
</div>
</div>
<div id="conclusion" class="section level1">
<h1><span class="header-section-number">13</span> Conclusion</h1>
<div id="sect141" class="section level2">
<h2><span class="header-section-number">13.1</span> Synthèse des méthodes abordées</h2>
<p><em>Road map method</em></p>
</div>
<div id="sect142" class="section level2">
<h2><span class="header-section-number">13.2</span> Autres méthodes non abordées</h2>
<div id="sect1421" class="section level3">
<h3><span class="header-section-number">13.2.1</span> Régressions par quantile</h3>
</div>
<div id="sect1422" class="section level3">
<h3><span class="header-section-number">13.2.2</span> Régressions par panel</h3>
</div>
<div id="sect1423" class="section level3">
<h3><span class="header-section-number">13.2.3</span> Régressions par Tobit</h3>
</div>
<div id="sect1424" class="section level3">
<h3><span class="header-section-number">13.2.4</span> Analyses de survie</h3>
</div>
<div id="sect1425" class="section level3">
<h3><span class="header-section-number">13.2.5</span> Équations structurelles</h3>
</div>
</div>
<div id="sect143" class="section level2">
<h2><span class="header-section-number">13.3</span> Deux écoles de statistique inférielle : fréquentiste et bayésienne</h2>
</div>
<div id="sect144" class="section level2">
<h2><span class="header-section-number">13.4</span> Éthique en méthodes quantitatives</h2>
<!--chapter:end:14-Conclusion.Rmd-->
</div>
</div>
<div id="annexes" class="section level1">
<h1><span class="header-section-number">14</span> Annexes</h1>
<div id="annexe1" class="section level2">
<h2><span class="header-section-number">14.1</span> Table des valeurs critiques de khi-deux</h2>
<p>La courte syntaxe R ci-dessous permet de générer le tableau @ref(tab:tableCritiqueKhi2) avec les valeurs critiques du khi-deux pour différents degrés de signification (valeurs de <em>p</em>).</p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="#cb1133-1"></a><span class="kw">library</span>(stargazer)</span>
<span id="cb1133-2"><a href="#cb1133-2"></a></span>
<span id="cb1133-3"><a href="#cb1133-3"></a><span class="co"># vecteur pour les degrés de liberté de 1 à 30, puis 40 et 50</span></span>
<span id="cb1133-4"><a href="#cb1133-4"></a>dl &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">500</span>) </span>
<span id="cb1133-5"><a href="#cb1133-5"></a><span class="co"># la fonction qchisq permet d&#39;obtenir la valeur théorique en fonction </span></span>
<span id="cb1133-6"><a href="#cb1133-6"></a><span class="co"># d&#39;une valeur de p et d&#39;un nombre de degrés de liberté</span></span>
<span id="cb1133-7"><a href="#cb1133-7"></a>tableKhi2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(dl,</span>
<span id="cb1133-8"><a href="#cb1133-8"></a>                <span class="dt">p0.10 =</span>  <span class="kw">round</span>(<span class="kw">qchisq</span>(<span class="dt">p=</span><span class="fl">0.90</span>,  <span class="dt">df=</span>dl, <span class="dt">lower.tail =</span> <span class="ot">TRUE</span>),<span class="dv">3</span>),</span>
<span id="cb1133-9"><a href="#cb1133-9"></a>                <span class="dt">p0.05 =</span>  <span class="kw">round</span>(<span class="kw">qchisq</span>(<span class="dt">p=</span><span class="fl">0.95</span>,  <span class="dt">df=</span>dl, <span class="dt">lower.tail =</span> <span class="ot">TRUE</span>),<span class="dv">3</span>),</span>
<span id="cb1133-10"><a href="#cb1133-10"></a>                <span class="dt">p0.01 =</span>  <span class="kw">round</span>(<span class="kw">qchisq</span>(<span class="dt">p=</span><span class="fl">0.99</span>,  <span class="dt">df=</span>dl, <span class="dt">lower.tail =</span> <span class="ot">TRUE</span>),<span class="dv">3</span>),</span>
<span id="cb1133-11"><a href="#cb1133-11"></a>                <span class="dt">p0.001 =</span> <span class="kw">round</span>(<span class="kw">qchisq</span>(<span class="dt">p=</span><span class="fl">0.999</span>, <span class="dt">df=</span>dl, <span class="dt">lower.tail =</span> <span class="ot">TRUE</span>),<span class="dv">3</span>))</span>
<span id="cb1133-12"><a href="#cb1133-12"></a><span class="co"># Impression du tableau avec la library stargazer</span></span>
<span id="cb1133-13"><a href="#cb1133-13"></a><span class="kw">stargazer</span>(tableKhi2, <span class="dt">type=</span><span class="st">&quot;text&quot;</span>, <span class="dt">summary=</span><span class="ot">FALSE</span>, <span class="dt">rownames=</span><span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="ot">TRUE</span>, <span class="dt">digits =</span> <span class="dv">2</span>,</span>
<span id="cb1133-14"><a href="#cb1133-14"></a>           <span class="dt">title=</span><span class="st">&quot;Distribution des valeurs critiques du Khi2&quot;</span>)</span></code></pre></div>
<div style="page-break-after: always;"></div>
<table>
<caption>
(#tab:tableCritiqueKhi2)Distribution des valeurs critiques du khi-deux
</caption>
<thead>
<tr>
<th style="text-align:right;">
dl
</th>
<th style="text-align:right;">
p = 0,10
</th>
<th style="text-align:right;">
p = 0,05
</th>
<th style="text-align:right;">
p = 0,01
</th>
<th style="text-align:right;">
p = 0,001
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2,71
</td>
<td style="text-align:right;">
3,84
</td>
<td style="text-align:right;">
6,64
</td>
<td style="text-align:right;">
10,83
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4,61
</td>
<td style="text-align:right;">
5,99
</td>
<td style="text-align:right;">
9,21
</td>
<td style="text-align:right;">
13,82
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6,25
</td>
<td style="text-align:right;">
7,82
</td>
<td style="text-align:right;">
11,35
</td>
<td style="text-align:right;">
16,27
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7,78
</td>
<td style="text-align:right;">
9,49
</td>
<td style="text-align:right;">
13,28
</td>
<td style="text-align:right;">
18,47
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9,24
</td>
<td style="text-align:right;">
11,07
</td>
<td style="text-align:right;">
15,09
</td>
<td style="text-align:right;">
20,52
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
10,64
</td>
<td style="text-align:right;">
12,59
</td>
<td style="text-align:right;">
16,81
</td>
<td style="text-align:right;">
22,46
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
12,02
</td>
<td style="text-align:right;">
14,07
</td>
<td style="text-align:right;">
18,48
</td>
<td style="text-align:right;">
24,32
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
13,36
</td>
<td style="text-align:right;">
15,51
</td>
<td style="text-align:right;">
20,09
</td>
<td style="text-align:right;">
26,12
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
14,68
</td>
<td style="text-align:right;">
16,92
</td>
<td style="text-align:right;">
21,67
</td>
<td style="text-align:right;">
27,88
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
15,99
</td>
<td style="text-align:right;">
18,31
</td>
<td style="text-align:right;">
23,21
</td>
<td style="text-align:right;">
29,59
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
17,27
</td>
<td style="text-align:right;">
19,68
</td>
<td style="text-align:right;">
24,73
</td>
<td style="text-align:right;">
31,26
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
18,55
</td>
<td style="text-align:right;">
21,03
</td>
<td style="text-align:right;">
26,22
</td>
<td style="text-align:right;">
32,91
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
19,81
</td>
<td style="text-align:right;">
22,36
</td>
<td style="text-align:right;">
27,69
</td>
<td style="text-align:right;">
34,53
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
21,06
</td>
<td style="text-align:right;">
23,68
</td>
<td style="text-align:right;">
29,14
</td>
<td style="text-align:right;">
36,12
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
22,31
</td>
<td style="text-align:right;">
25,00
</td>
<td style="text-align:right;">
30,58
</td>
<td style="text-align:right;">
37,70
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
23,54
</td>
<td style="text-align:right;">
26,30
</td>
<td style="text-align:right;">
32,00
</td>
<td style="text-align:right;">
39,25
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
24,77
</td>
<td style="text-align:right;">
27,59
</td>
<td style="text-align:right;">
33,41
</td>
<td style="text-align:right;">
40,79
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
25,99
</td>
<td style="text-align:right;">
28,87
</td>
<td style="text-align:right;">
34,80
</td>
<td style="text-align:right;">
42,31
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
27,20
</td>
<td style="text-align:right;">
30,14
</td>
<td style="text-align:right;">
36,19
</td>
<td style="text-align:right;">
43,82
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
28,41
</td>
<td style="text-align:right;">
31,41
</td>
<td style="text-align:right;">
37,57
</td>
<td style="text-align:right;">
45,31
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
29,61
</td>
<td style="text-align:right;">
32,67
</td>
<td style="text-align:right;">
38,93
</td>
<td style="text-align:right;">
46,80
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
30,81
</td>
<td style="text-align:right;">
33,92
</td>
<td style="text-align:right;">
40,29
</td>
<td style="text-align:right;">
48,27
</td>
</tr>
<tr>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
32,01
</td>
<td style="text-align:right;">
35,17
</td>
<td style="text-align:right;">
41,64
</td>
<td style="text-align:right;">
49,73
</td>
</tr>
<tr>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
33,20
</td>
<td style="text-align:right;">
36,42
</td>
<td style="text-align:right;">
42,98
</td>
<td style="text-align:right;">
51,18
</td>
</tr>
<tr>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
34,38
</td>
<td style="text-align:right;">
37,65
</td>
<td style="text-align:right;">
44,31
</td>
<td style="text-align:right;">
52,62
</td>
</tr>
<tr>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
35,56
</td>
<td style="text-align:right;">
38,88
</td>
<td style="text-align:right;">
45,64
</td>
<td style="text-align:right;">
54,05
</td>
</tr>
<tr>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
36,74
</td>
<td style="text-align:right;">
40,11
</td>
<td style="text-align:right;">
46,96
</td>
<td style="text-align:right;">
55,48
</td>
</tr>
<tr>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
37,92
</td>
<td style="text-align:right;">
41,34
</td>
<td style="text-align:right;">
48,28
</td>
<td style="text-align:right;">
56,89
</td>
</tr>
<tr>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
39,09
</td>
<td style="text-align:right;">
42,56
</td>
<td style="text-align:right;">
49,59
</td>
<td style="text-align:right;">
58,30
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
40,26
</td>
<td style="text-align:right;">
43,77
</td>
<td style="text-align:right;">
50,89
</td>
<td style="text-align:right;">
59,70
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
51,80
</td>
<td style="text-align:right;">
55,76
</td>
<td style="text-align:right;">
63,69
</td>
<td style="text-align:right;">
73,40
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
63,17
</td>
<td style="text-align:right;">
67,50
</td>
<td style="text-align:right;">
76,15
</td>
<td style="text-align:right;">
86,66
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
118,50
</td>
<td style="text-align:right;">
124,34
</td>
<td style="text-align:right;">
135,81
</td>
<td style="text-align:right;">
149,45
</td>
</tr>
<tr>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
279,05
</td>
<td style="text-align:right;">
287,88
</td>
<td style="text-align:right;">
304,94
</td>
<td style="text-align:right;">
324,83
</td>
</tr>
<tr>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
540,93
</td>
<td style="text-align:right;">
553,13
</td>
<td style="text-align:right;">
576,49
</td>
<td style="text-align:right;">
603,45
</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div id="annexe2" class="section level2">
<h2><span class="header-section-number">14.2</span> Table des valeurs critiques de Fisher</h2>
<p>La courte syntaxe R ci-dessous permet de générer les tableaux @ref(tab:tableCritiqueF1), @ref(tab:tableCritiqueF2) et @ref(tab:tableCritiqueF3) avec les valeurs critiques de <em>F</em> avec <em>p</em> = 0,05.</p>
<div class="sourceCode" id="cb1134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1134-1"><a href="#cb1134-1"></a><span class="kw">library</span>(stargazer)</span>
<span id="cb1134-2"><a href="#cb1134-2"></a></span>
<span id="cb1134-3"><a href="#cb1134-3"></a>dl1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>, <span class="dv">1000</span>)</span>
<span id="cb1134-4"><a href="#cb1134-4"></a>dl2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2000</span>)</span>
<span id="cb1134-5"><a href="#cb1134-5"></a>matrice &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">ncol=</span><span class="kw">length</span>(dl1), <span class="dt">nrow=</span><span class="kw">length</span>(dl2), <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1134-6"><a href="#cb1134-6"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(dl1)){</span>
<span id="cb1134-7"><a href="#cb1134-7"></a>  <span class="cf">for</span>(c <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(dl2)){</span>
<span id="cb1134-8"><a href="#cb1134-8"></a>    matrice[c,r] &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">qf</span>(<span class="dt">p=</span><span class="fl">0.05</span>, dl1[r], dl2[c], <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>),<span class="dv">2</span>)</span>
<span id="cb1134-9"><a href="#cb1134-9"></a>  }</span>
<span id="cb1134-10"><a href="#cb1134-10"></a>}</span>
<span id="cb1134-11"><a href="#cb1134-11"></a></span>
<span id="cb1134-12"><a href="#cb1134-12"></a>tableF_p0<span class="fl">.05</span> &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">dl2 =</span> dl2, matrice)</span>
<span id="cb1134-13"><a href="#cb1134-13"></a><span class="kw">names</span>(tableF_p0<span class="fl">.05</span>) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dl2&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;dl1=&quot;</span>,dl1))</span>
<span id="cb1134-14"><a href="#cb1134-14"></a></span>
<span id="cb1134-15"><a href="#cb1134-15"></a><span class="kw">stargazer</span>(tableF_p0<span class="fl">.05</span>, <span class="dt">type=</span><span class="st">&quot;text&quot;</span>, <span class="dt">summary=</span><span class="ot">FALSE</span>, <span class="dt">rownames=</span><span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="ot">TRUE</span>, <span class="dt">digits =</span> <span class="dv">3</span>,</span>
<span id="cb1134-16"><a href="#cb1134-16"></a>          <span class="dt">title=</span><span class="st">&quot;Distribution des valeurs critiques de F avec p = 0,05&quot;</span>)</span></code></pre></div>
<div style="page-break-after: always;"></div>
<table>
<caption>
(#tab:tableCritiqueF1)Distribution des valeurs critiques de F avec p = 0,05
</caption>
<thead>
<tr>
<th style="text-align:right;">
dl2
</th>
<th style="text-align:right;">
dl1=1
</th>
<th style="text-align:right;">
dl1=2
</th>
<th style="text-align:right;">
dl1=3
</th>
<th style="text-align:right;">
dl1=4
</th>
<th style="text-align:right;">
dl1=5
</th>
<th style="text-align:right;">
dl1=6
</th>
<th style="text-align:right;">
dl1=7
</th>
<th style="text-align:right;">
dl1=8
</th>
<th style="text-align:right;">
dl1=9
</th>
<th style="text-align:right;">
dl1=10
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
161,45
</td>
<td style="text-align:right;">
199,50
</td>
<td style="text-align:right;">
215,71
</td>
<td style="text-align:right;">
224,58
</td>
<td style="text-align:right;">
230,16
</td>
<td style="text-align:right;">
233,99
</td>
<td style="text-align:right;">
236,77
</td>
<td style="text-align:right;">
238,88
</td>
<td style="text-align:right;">
240,54
</td>
<td style="text-align:right;">
241,88
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
18,51
</td>
<td style="text-align:right;">
19,00
</td>
<td style="text-align:right;">
19,16
</td>
<td style="text-align:right;">
19,25
</td>
<td style="text-align:right;">
19,30
</td>
<td style="text-align:right;">
19,33
</td>
<td style="text-align:right;">
19,35
</td>
<td style="text-align:right;">
19,37
</td>
<td style="text-align:right;">
19,38
</td>
<td style="text-align:right;">
19,40
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10,13
</td>
<td style="text-align:right;">
9,55
</td>
<td style="text-align:right;">
9,28
</td>
<td style="text-align:right;">
9,12
</td>
<td style="text-align:right;">
9,01
</td>
<td style="text-align:right;">
8,94
</td>
<td style="text-align:right;">
8,89
</td>
<td style="text-align:right;">
8,85
</td>
<td style="text-align:right;">
8,81
</td>
<td style="text-align:right;">
8,79
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7,71
</td>
<td style="text-align:right;">
6,94
</td>
<td style="text-align:right;">
6,59
</td>
<td style="text-align:right;">
6,39
</td>
<td style="text-align:right;">
6,26
</td>
<td style="text-align:right;">
6,16
</td>
<td style="text-align:right;">
6,09
</td>
<td style="text-align:right;">
6,04
</td>
<td style="text-align:right;">
6,00
</td>
<td style="text-align:right;">
5,96
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6,61
</td>
<td style="text-align:right;">
5,79
</td>
<td style="text-align:right;">
5,41
</td>
<td style="text-align:right;">
5,19
</td>
<td style="text-align:right;">
5,05
</td>
<td style="text-align:right;">
4,95
</td>
<td style="text-align:right;">
4,88
</td>
<td style="text-align:right;">
4,82
</td>
<td style="text-align:right;">
4,77
</td>
<td style="text-align:right;">
4,74
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
5,99
</td>
<td style="text-align:right;">
5,14
</td>
<td style="text-align:right;">
4,76
</td>
<td style="text-align:right;">
4,53
</td>
<td style="text-align:right;">
4,39
</td>
<td style="text-align:right;">
4,28
</td>
<td style="text-align:right;">
4,21
</td>
<td style="text-align:right;">
4,15
</td>
<td style="text-align:right;">
4,10
</td>
<td style="text-align:right;">
4,06
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
5,59
</td>
<td style="text-align:right;">
4,74
</td>
<td style="text-align:right;">
4,35
</td>
<td style="text-align:right;">
4,12
</td>
<td style="text-align:right;">
3,97
</td>
<td style="text-align:right;">
3,87
</td>
<td style="text-align:right;">
3,79
</td>
<td style="text-align:right;">
3,73
</td>
<td style="text-align:right;">
3,68
</td>
<td style="text-align:right;">
3,64
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
5,32
</td>
<td style="text-align:right;">
4,46
</td>
<td style="text-align:right;">
4,07
</td>
<td style="text-align:right;">
3,84
</td>
<td style="text-align:right;">
3,69
</td>
<td style="text-align:right;">
3,58
</td>
<td style="text-align:right;">
3,50
</td>
<td style="text-align:right;">
3,44
</td>
<td style="text-align:right;">
3,39
</td>
<td style="text-align:right;">
3,35
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
5,12
</td>
<td style="text-align:right;">
4,26
</td>
<td style="text-align:right;">
3,86
</td>
<td style="text-align:right;">
3,63
</td>
<td style="text-align:right;">
3,48
</td>
<td style="text-align:right;">
3,37
</td>
<td style="text-align:right;">
3,29
</td>
<td style="text-align:right;">
3,23
</td>
<td style="text-align:right;">
3,18
</td>
<td style="text-align:right;">
3,14
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
4,96
</td>
<td style="text-align:right;">
4,10
</td>
<td style="text-align:right;">
3,71
</td>
<td style="text-align:right;">
3,48
</td>
<td style="text-align:right;">
3,33
</td>
<td style="text-align:right;">
3,22
</td>
<td style="text-align:right;">
3,14
</td>
<td style="text-align:right;">
3,07
</td>
<td style="text-align:right;">
3,02
</td>
<td style="text-align:right;">
2,98
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
4,35
</td>
<td style="text-align:right;">
3,49
</td>
<td style="text-align:right;">
3,10
</td>
<td style="text-align:right;">
2,87
</td>
<td style="text-align:right;">
2,71
</td>
<td style="text-align:right;">
2,60
</td>
<td style="text-align:right;">
2,51
</td>
<td style="text-align:right;">
2,45
</td>
<td style="text-align:right;">
2,39
</td>
<td style="text-align:right;">
2,35
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
4,17
</td>
<td style="text-align:right;">
3,32
</td>
<td style="text-align:right;">
2,92
</td>
<td style="text-align:right;">
2,69
</td>
<td style="text-align:right;">
2,53
</td>
<td style="text-align:right;">
2,42
</td>
<td style="text-align:right;">
2,33
</td>
<td style="text-align:right;">
2,27
</td>
<td style="text-align:right;">
2,21
</td>
<td style="text-align:right;">
2,16
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
4,08
</td>
<td style="text-align:right;">
3,23
</td>
<td style="text-align:right;">
2,84
</td>
<td style="text-align:right;">
2,61
</td>
<td style="text-align:right;">
2,45
</td>
<td style="text-align:right;">
2,34
</td>
<td style="text-align:right;">
2,25
</td>
<td style="text-align:right;">
2,18
</td>
<td style="text-align:right;">
2,12
</td>
<td style="text-align:right;">
2,08
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
4,03
</td>
<td style="text-align:right;">
3,18
</td>
<td style="text-align:right;">
2,79
</td>
<td style="text-align:right;">
2,56
</td>
<td style="text-align:right;">
2,40
</td>
<td style="text-align:right;">
2,29
</td>
<td style="text-align:right;">
2,20
</td>
<td style="text-align:right;">
2,13
</td>
<td style="text-align:right;">
2,07
</td>
<td style="text-align:right;">
2,03
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
4,00
</td>
<td style="text-align:right;">
3,15
</td>
<td style="text-align:right;">
2,76
</td>
<td style="text-align:right;">
2,53
</td>
<td style="text-align:right;">
2,37
</td>
<td style="text-align:right;">
2,25
</td>
<td style="text-align:right;">
2,17
</td>
<td style="text-align:right;">
2,10
</td>
<td style="text-align:right;">
2,04
</td>
<td style="text-align:right;">
1,99
</td>
</tr>
<tr>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
3,98
</td>
<td style="text-align:right;">
3,13
</td>
<td style="text-align:right;">
2,74
</td>
<td style="text-align:right;">
2,50
</td>
<td style="text-align:right;">
2,35
</td>
<td style="text-align:right;">
2,23
</td>
<td style="text-align:right;">
2,14
</td>
<td style="text-align:right;">
2,07
</td>
<td style="text-align:right;">
2,02
</td>
<td style="text-align:right;">
1,97
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
3,96
</td>
<td style="text-align:right;">
3,11
</td>
<td style="text-align:right;">
2,72
</td>
<td style="text-align:right;">
2,49
</td>
<td style="text-align:right;">
2,33
</td>
<td style="text-align:right;">
2,21
</td>
<td style="text-align:right;">
2,13
</td>
<td style="text-align:right;">
2,06
</td>
<td style="text-align:right;">
2,00
</td>
<td style="text-align:right;">
1,95
</td>
</tr>
<tr>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
3,95
</td>
<td style="text-align:right;">
3,10
</td>
<td style="text-align:right;">
2,71
</td>
<td style="text-align:right;">
2,47
</td>
<td style="text-align:right;">
2,32
</td>
<td style="text-align:right;">
2,20
</td>
<td style="text-align:right;">
2,11
</td>
<td style="text-align:right;">
2,04
</td>
<td style="text-align:right;">
1,99
</td>
<td style="text-align:right;">
1,94
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
3,94
</td>
<td style="text-align:right;">
3,09
</td>
<td style="text-align:right;">
2,70
</td>
<td style="text-align:right;">
2,46
</td>
<td style="text-align:right;">
2,31
</td>
<td style="text-align:right;">
2,19
</td>
<td style="text-align:right;">
2,10
</td>
<td style="text-align:right;">
2,03
</td>
<td style="text-align:right;">
1,97
</td>
<td style="text-align:right;">
1,93
</td>
</tr>
<tr>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
3,89
</td>
<td style="text-align:right;">
3,04
</td>
<td style="text-align:right;">
2,65
</td>
<td style="text-align:right;">
2,42
</td>
<td style="text-align:right;">
2,26
</td>
<td style="text-align:right;">
2,14
</td>
<td style="text-align:right;">
2,06
</td>
<td style="text-align:right;">
1,98
</td>
<td style="text-align:right;">
1,93
</td>
<td style="text-align:right;">
1,88
</td>
</tr>
<tr>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
3,87
</td>
<td style="text-align:right;">
3,03
</td>
<td style="text-align:right;">
2,63
</td>
<td style="text-align:right;">
2,40
</td>
<td style="text-align:right;">
2,24
</td>
<td style="text-align:right;">
2,13
</td>
<td style="text-align:right;">
2,04
</td>
<td style="text-align:right;">
1,97
</td>
<td style="text-align:right;">
1,91
</td>
<td style="text-align:right;">
1,86
</td>
</tr>
<tr>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
3,86
</td>
<td style="text-align:right;">
3,01
</td>
<td style="text-align:right;">
2,62
</td>
<td style="text-align:right;">
2,39
</td>
<td style="text-align:right;">
2,23
</td>
<td style="text-align:right;">
2,12
</td>
<td style="text-align:right;">
2,03
</td>
<td style="text-align:right;">
1,96
</td>
<td style="text-align:right;">
1,90
</td>
<td style="text-align:right;">
1,85
</td>
</tr>
<tr>
<td style="text-align:right;">
1 000
</td>
<td style="text-align:right;">
3,85
</td>
<td style="text-align:right;">
3,00
</td>
<td style="text-align:right;">
2,61
</td>
<td style="text-align:right;">
2,38
</td>
<td style="text-align:right;">
2,22
</td>
<td style="text-align:right;">
2,11
</td>
<td style="text-align:right;">
2,02
</td>
<td style="text-align:right;">
1,95
</td>
<td style="text-align:right;">
1,89
</td>
<td style="text-align:right;">
1,84
</td>
</tr>
<tr>
<td style="text-align:right;">
2 000
</td>
<td style="text-align:right;">
3,85
</td>
<td style="text-align:right;">
3,00
</td>
<td style="text-align:right;">
2,61
</td>
<td style="text-align:right;">
2,38
</td>
<td style="text-align:right;">
2,22
</td>
<td style="text-align:right;">
2,10
</td>
<td style="text-align:right;">
2,01
</td>
<td style="text-align:right;">
1,94
</td>
<td style="text-align:right;">
1,88
</td>
<td style="text-align:right;">
1,84
</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<table>
<caption>
(#tab:tableCritiqueF2)Distribution des valeurs critiques de F avec p = 0,05 (suite)
</caption>
<thead>
<tr>
<th style="text-align:right;">
dl2
</th>
<th style="text-align:right;">
dl1=15
</th>
<th style="text-align:right;">
dl1=20
</th>
<th style="text-align:right;">
dl1=30
</th>
<th style="text-align:right;">
dl1=40
</th>
<th style="text-align:right;">
dl1=50
</th>
<th style="text-align:right;">
dl1=60
</th>
<th style="text-align:right;">
dl1=70
</th>
<th style="text-align:right;">
dl1=80
</th>
<th style="text-align:right;">
dl1=90
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
245,95
</td>
<td style="text-align:right;">
248,01
</td>
<td style="text-align:right;">
250,10
</td>
<td style="text-align:right;">
251,14
</td>
<td style="text-align:right;">
251,77
</td>
<td style="text-align:right;">
252,20
</td>
<td style="text-align:right;">
252,50
</td>
<td style="text-align:right;">
252,72
</td>
<td style="text-align:right;">
252,90
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
19,43
</td>
<td style="text-align:right;">
19,45
</td>
<td style="text-align:right;">
19,46
</td>
<td style="text-align:right;">
19,47
</td>
<td style="text-align:right;">
19,48
</td>
<td style="text-align:right;">
19,48
</td>
<td style="text-align:right;">
19,48
</td>
<td style="text-align:right;">
19,48
</td>
<td style="text-align:right;">
19,48
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
8,70
</td>
<td style="text-align:right;">
8,66
</td>
<td style="text-align:right;">
8,62
</td>
<td style="text-align:right;">
8,59
</td>
<td style="text-align:right;">
8,58
</td>
<td style="text-align:right;">
8,57
</td>
<td style="text-align:right;">
8,57
</td>
<td style="text-align:right;">
8,56
</td>
<td style="text-align:right;">
8,56
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5,86
</td>
<td style="text-align:right;">
5,80
</td>
<td style="text-align:right;">
5,75
</td>
<td style="text-align:right;">
5,72
</td>
<td style="text-align:right;">
5,70
</td>
<td style="text-align:right;">
5,69
</td>
<td style="text-align:right;">
5,68
</td>
<td style="text-align:right;">
5,67
</td>
<td style="text-align:right;">
5,67
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4,62
</td>
<td style="text-align:right;">
4,56
</td>
<td style="text-align:right;">
4,50
</td>
<td style="text-align:right;">
4,46
</td>
<td style="text-align:right;">
4,44
</td>
<td style="text-align:right;">
4,43
</td>
<td style="text-align:right;">
4,42
</td>
<td style="text-align:right;">
4,41
</td>
<td style="text-align:right;">
4,41
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3,94
</td>
<td style="text-align:right;">
3,87
</td>
<td style="text-align:right;">
3,81
</td>
<td style="text-align:right;">
3,77
</td>
<td style="text-align:right;">
3,75
</td>
<td style="text-align:right;">
3,74
</td>
<td style="text-align:right;">
3,73
</td>
<td style="text-align:right;">
3,72
</td>
<td style="text-align:right;">
3,72
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3,51
</td>
<td style="text-align:right;">
3,44
</td>
<td style="text-align:right;">
3,38
</td>
<td style="text-align:right;">
3,34
</td>
<td style="text-align:right;">
3,32
</td>
<td style="text-align:right;">
3,30
</td>
<td style="text-align:right;">
3,29
</td>
<td style="text-align:right;">
3,29
</td>
<td style="text-align:right;">
3,28
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
3,22
</td>
<td style="text-align:right;">
3,15
</td>
<td style="text-align:right;">
3,08
</td>
<td style="text-align:right;">
3,04
</td>
<td style="text-align:right;">
3,02
</td>
<td style="text-align:right;">
3,01
</td>
<td style="text-align:right;">
2,99
</td>
<td style="text-align:right;">
2,99
</td>
<td style="text-align:right;">
2,98
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
3,01
</td>
<td style="text-align:right;">
2,94
</td>
<td style="text-align:right;">
2,86
</td>
<td style="text-align:right;">
2,83
</td>
<td style="text-align:right;">
2,80
</td>
<td style="text-align:right;">
2,79
</td>
<td style="text-align:right;">
2,78
</td>
<td style="text-align:right;">
2,77
</td>
<td style="text-align:right;">
2,76
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2,85
</td>
<td style="text-align:right;">
2,77
</td>
<td style="text-align:right;">
2,70
</td>
<td style="text-align:right;">
2,66
</td>
<td style="text-align:right;">
2,64
</td>
<td style="text-align:right;">
2,62
</td>
<td style="text-align:right;">
2,61
</td>
<td style="text-align:right;">
2,60
</td>
<td style="text-align:right;">
2,59
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
2,20
</td>
<td style="text-align:right;">
2,12
</td>
<td style="text-align:right;">
2,04
</td>
<td style="text-align:right;">
1,99
</td>
<td style="text-align:right;">
1,97
</td>
<td style="text-align:right;">
1,95
</td>
<td style="text-align:right;">
1,93
</td>
<td style="text-align:right;">
1,92
</td>
<td style="text-align:right;">
1,91
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
2,01
</td>
<td style="text-align:right;">
1,93
</td>
<td style="text-align:right;">
1,84
</td>
<td style="text-align:right;">
1,79
</td>
<td style="text-align:right;">
1,76
</td>
<td style="text-align:right;">
1,74
</td>
<td style="text-align:right;">
1,72
</td>
<td style="text-align:right;">
1,71
</td>
<td style="text-align:right;">
1,70
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
1,92
</td>
<td style="text-align:right;">
1,84
</td>
<td style="text-align:right;">
1,74
</td>
<td style="text-align:right;">
1,69
</td>
<td style="text-align:right;">
1,66
</td>
<td style="text-align:right;">
1,64
</td>
<td style="text-align:right;">
1,62
</td>
<td style="text-align:right;">
1,61
</td>
<td style="text-align:right;">
1,60
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
1,87
</td>
<td style="text-align:right;">
1,78
</td>
<td style="text-align:right;">
1,69
</td>
<td style="text-align:right;">
1,63
</td>
<td style="text-align:right;">
1,60
</td>
<td style="text-align:right;">
1,58
</td>
<td style="text-align:right;">
1,56
</td>
<td style="text-align:right;">
1,54
</td>
<td style="text-align:right;">
1,53
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
1,84
</td>
<td style="text-align:right;">
1,75
</td>
<td style="text-align:right;">
1,65
</td>
<td style="text-align:right;">
1,59
</td>
<td style="text-align:right;">
1,56
</td>
<td style="text-align:right;">
1,53
</td>
<td style="text-align:right;">
1,52
</td>
<td style="text-align:right;">
1,50
</td>
<td style="text-align:right;">
1,49
</td>
</tr>
<tr>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
1,81
</td>
<td style="text-align:right;">
1,72
</td>
<td style="text-align:right;">
1,62
</td>
<td style="text-align:right;">
1,57
</td>
<td style="text-align:right;">
1,53
</td>
<td style="text-align:right;">
1,50
</td>
<td style="text-align:right;">
1,49
</td>
<td style="text-align:right;">
1,47
</td>
<td style="text-align:right;">
1,46
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
1,79
</td>
<td style="text-align:right;">
1,70
</td>
<td style="text-align:right;">
1,60
</td>
<td style="text-align:right;">
1,54
</td>
<td style="text-align:right;">
1,51
</td>
<td style="text-align:right;">
1,48
</td>
<td style="text-align:right;">
1,46
</td>
<td style="text-align:right;">
1,45
</td>
<td style="text-align:right;">
1,44
</td>
</tr>
<tr>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
1,78
</td>
<td style="text-align:right;">
1,69
</td>
<td style="text-align:right;">
1,59
</td>
<td style="text-align:right;">
1,53
</td>
<td style="text-align:right;">
1,49
</td>
<td style="text-align:right;">
1,46
</td>
<td style="text-align:right;">
1,44
</td>
<td style="text-align:right;">
1,43
</td>
<td style="text-align:right;">
1,42
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
1,77
</td>
<td style="text-align:right;">
1,68
</td>
<td style="text-align:right;">
1,57
</td>
<td style="text-align:right;">
1,52
</td>
<td style="text-align:right;">
1,48
</td>
<td style="text-align:right;">
1,45
</td>
<td style="text-align:right;">
1,43
</td>
<td style="text-align:right;">
1,41
</td>
<td style="text-align:right;">
1,40
</td>
</tr>
<tr>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
1,72
</td>
<td style="text-align:right;">
1,62
</td>
<td style="text-align:right;">
1,52
</td>
<td style="text-align:right;">
1,46
</td>
<td style="text-align:right;">
1,41
</td>
<td style="text-align:right;">
1,39
</td>
<td style="text-align:right;">
1,36
</td>
<td style="text-align:right;">
1,35
</td>
<td style="text-align:right;">
1,33
</td>
</tr>
<tr>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
1,70
</td>
<td style="text-align:right;">
1,61
</td>
<td style="text-align:right;">
1,50
</td>
<td style="text-align:right;">
1,43
</td>
<td style="text-align:right;">
1,39
</td>
<td style="text-align:right;">
1,36
</td>
<td style="text-align:right;">
1,34
</td>
<td style="text-align:right;">
1,32
</td>
<td style="text-align:right;">
1,31
</td>
</tr>
<tr>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
1,69
</td>
<td style="text-align:right;">
1,59
</td>
<td style="text-align:right;">
1,48
</td>
<td style="text-align:right;">
1,42
</td>
<td style="text-align:right;">
1,38
</td>
<td style="text-align:right;">
1,35
</td>
<td style="text-align:right;">
1,32
</td>
<td style="text-align:right;">
1,30
</td>
<td style="text-align:right;">
1,29
</td>
</tr>
<tr>
<td style="text-align:right;">
1 000
</td>
<td style="text-align:right;">
1,68
</td>
<td style="text-align:right;">
1,58
</td>
<td style="text-align:right;">
1,47
</td>
<td style="text-align:right;">
1,41
</td>
<td style="text-align:right;">
1,36
</td>
<td style="text-align:right;">
1,33
</td>
<td style="text-align:right;">
1,31
</td>
<td style="text-align:right;">
1,29
</td>
<td style="text-align:right;">
1,27
</td>
</tr>
<tr>
<td style="text-align:right;">
2 000
</td>
<td style="text-align:right;">
1,67
</td>
<td style="text-align:right;">
1,58
</td>
<td style="text-align:right;">
1,46
</td>
<td style="text-align:right;">
1,40
</td>
<td style="text-align:right;">
1,36
</td>
<td style="text-align:right;">
1,32
</td>
<td style="text-align:right;">
1,30
</td>
<td style="text-align:right;">
1,28
</td>
<td style="text-align:right;">
1,27
</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<table>
<caption>
(#tab:tableCritiqueF3)Distribution des valeurs critiques de F avec p = 0,05 (suite)
</caption>
<thead>
<tr>
<th style="text-align:right;">
dl2
</th>
<th style="text-align:right;">
dl1=100
</th>
<th style="text-align:right;">
dl1=200
</th>
<th style="text-align:right;">
dl1=300
</th>
<th style="text-align:right;">
dl1=400
</th>
<th style="text-align:right;">
dl1=500
</th>
<th style="text-align:right;">
dl1=1000
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
253,04
</td>
<td style="text-align:right;">
253,68
</td>
<td style="text-align:right;">
253,89
</td>
<td style="text-align:right;">
254,00
</td>
<td style="text-align:right;">
254,06
</td>
<td style="text-align:right;">
254,19
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
19,49
</td>
<td style="text-align:right;">
19,49
</td>
<td style="text-align:right;">
19,49
</td>
<td style="text-align:right;">
19,49
</td>
<td style="text-align:right;">
19,49
</td>
<td style="text-align:right;">
19,49
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
8,55
</td>
<td style="text-align:right;">
8,54
</td>
<td style="text-align:right;">
8,54
</td>
<td style="text-align:right;">
8,53
</td>
<td style="text-align:right;">
8,53
</td>
<td style="text-align:right;">
8,53
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5,66
</td>
<td style="text-align:right;">
5,65
</td>
<td style="text-align:right;">
5,64
</td>
<td style="text-align:right;">
5,64
</td>
<td style="text-align:right;">
5,64
</td>
<td style="text-align:right;">
5,63
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4,41
</td>
<td style="text-align:right;">
4,39
</td>
<td style="text-align:right;">
4,38
</td>
<td style="text-align:right;">
4,38
</td>
<td style="text-align:right;">
4,37
</td>
<td style="text-align:right;">
4,37
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3,71
</td>
<td style="text-align:right;">
3,69
</td>
<td style="text-align:right;">
3,68
</td>
<td style="text-align:right;">
3,68
</td>
<td style="text-align:right;">
3,68
</td>
<td style="text-align:right;">
3,67
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3,27
</td>
<td style="text-align:right;">
3,25
</td>
<td style="text-align:right;">
3,24
</td>
<td style="text-align:right;">
3,24
</td>
<td style="text-align:right;">
3,24
</td>
<td style="text-align:right;">
3,23
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
2,97
</td>
<td style="text-align:right;">
2,95
</td>
<td style="text-align:right;">
2,94
</td>
<td style="text-align:right;">
2,94
</td>
<td style="text-align:right;">
2,94
</td>
<td style="text-align:right;">
2,93
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
2,76
</td>
<td style="text-align:right;">
2,73
</td>
<td style="text-align:right;">
2,72
</td>
<td style="text-align:right;">
2,72
</td>
<td style="text-align:right;">
2,72
</td>
<td style="text-align:right;">
2,71
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2,59
</td>
<td style="text-align:right;">
2,56
</td>
<td style="text-align:right;">
2,55
</td>
<td style="text-align:right;">
2,55
</td>
<td style="text-align:right;">
2,55
</td>
<td style="text-align:right;">
2,54
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
1,91
</td>
<td style="text-align:right;">
1,88
</td>
<td style="text-align:right;">
1,86
</td>
<td style="text-align:right;">
1,86
</td>
<td style="text-align:right;">
1,86
</td>
<td style="text-align:right;">
1,85
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1,70
</td>
<td style="text-align:right;">
1,66
</td>
<td style="text-align:right;">
1,65
</td>
<td style="text-align:right;">
1,64
</td>
<td style="text-align:right;">
1,64
</td>
<td style="text-align:right;">
1,63
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
1,59
</td>
<td style="text-align:right;">
1,55
</td>
<td style="text-align:right;">
1,54
</td>
<td style="text-align:right;">
1,53
</td>
<td style="text-align:right;">
1,53
</td>
<td style="text-align:right;">
1,52
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
1,52
</td>
<td style="text-align:right;">
1,48
</td>
<td style="text-align:right;">
1,47
</td>
<td style="text-align:right;">
1,46
</td>
<td style="text-align:right;">
1,46
</td>
<td style="text-align:right;">
1,45
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
1,48
</td>
<td style="text-align:right;">
1,44
</td>
<td style="text-align:right;">
1,42
</td>
<td style="text-align:right;">
1,41
</td>
<td style="text-align:right;">
1,41
</td>
<td style="text-align:right;">
1,40
</td>
</tr>
<tr>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
1,45
</td>
<td style="text-align:right;">
1,40
</td>
<td style="text-align:right;">
1,39
</td>
<td style="text-align:right;">
1,38
</td>
<td style="text-align:right;">
1,37
</td>
<td style="text-align:right;">
1,36
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
1,43
</td>
<td style="text-align:right;">
1,38
</td>
<td style="text-align:right;">
1,36
</td>
<td style="text-align:right;">
1,35
</td>
<td style="text-align:right;">
1,35
</td>
<td style="text-align:right;">
1,34
</td>
</tr>
<tr>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
1,41
</td>
<td style="text-align:right;">
1,36
</td>
<td style="text-align:right;">
1,34
</td>
<td style="text-align:right;">
1,33
</td>
<td style="text-align:right;">
1,33
</td>
<td style="text-align:right;">
1,31
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
1,39
</td>
<td style="text-align:right;">
1,34
</td>
<td style="text-align:right;">
1,32
</td>
<td style="text-align:right;">
1,31
</td>
<td style="text-align:right;">
1,31
</td>
<td style="text-align:right;">
1,30
</td>
</tr>
<tr>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
1,32
</td>
<td style="text-align:right;">
1,26
</td>
<td style="text-align:right;">
1,24
</td>
<td style="text-align:right;">
1,23
</td>
<td style="text-align:right;">
1,22
</td>
<td style="text-align:right;">
1,21
</td>
</tr>
<tr>
<td style="text-align:right;">
300
</td>
<td style="text-align:right;">
1,30
</td>
<td style="text-align:right;">
1,23
</td>
<td style="text-align:right;">
1,21
</td>
<td style="text-align:right;">
1,20
</td>
<td style="text-align:right;">
1,19
</td>
<td style="text-align:right;">
1,17
</td>
</tr>
<tr>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
1,28
</td>
<td style="text-align:right;">
1,21
</td>
<td style="text-align:right;">
1,18
</td>
<td style="text-align:right;">
1,17
</td>
<td style="text-align:right;">
1,16
</td>
<td style="text-align:right;">
1,14
</td>
</tr>
<tr>
<td style="text-align:right;">
1 000
</td>
<td style="text-align:right;">
1,26
</td>
<td style="text-align:right;">
1,19
</td>
<td style="text-align:right;">
1,16
</td>
<td style="text-align:right;">
1,14
</td>
<td style="text-align:right;">
1,13
</td>
<td style="text-align:right;">
1,11
</td>
</tr>
<tr>
<td style="text-align:right;">
2 000
</td>
<td style="text-align:right;">
1,25
</td>
<td style="text-align:right;">
1,18
</td>
<td style="text-align:right;">
1,15
</td>
<td style="text-align:right;">
1,13
</td>
<td style="text-align:right;">
1,12
</td>
<td style="text-align:right;">
1,09
</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div id="annexe3" class="section level2">
<h2><span class="header-section-number">14.3</span> Table des valeurs critiques de <em>t</em></h2>
<p>La courte syntaxe R ci-dessous permet de générer le tableau @ref(tab:tableCritiqueT) avec les valeurs critiques de <em>t</em> avec <em>p</em> = 0,10, 0,05, 0,01 et 0,01.</p>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1135-1"><a href="#cb1135-1"></a><span class="kw">library</span>(stargazer)</span>
<span id="cb1135-2"><a href="#cb1135-2"></a></span>
<span id="cb1135-3"><a href="#cb1135-3"></a><span class="co"># vecteur pour les degrés de liberté de 1 à 30, puis 40 et 50</span></span>
<span id="cb1135-4"><a href="#cb1135-4"></a>dl &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2500</span>) </span>
<span id="cb1135-5"><a href="#cb1135-5"></a><span class="co"># la fonction qchisq permet d&#39;obtenir la valeur théorique en fonction </span></span>
<span id="cb1135-6"><a href="#cb1135-6"></a><span class="co"># d&#39;une valeur de p et d&#39;un nombre de degrés de liberté</span></span>
<span id="cb1135-7"><a href="#cb1135-7"></a>tableT &lt;-<span class="st"> </span><span class="kw">cbind</span>(dl,</span>
<span id="cb1135-8"><a href="#cb1135-8"></a>                <span class="dt">p0.10 =</span>  <span class="kw">round</span>(<span class="kw">qt</span>(<span class="dt">p=</span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="fl">0.10</span><span class="op">/</span><span class="dv">2</span>),  <span class="dt">df=</span>dl),<span class="dv">2</span>),</span>
<span id="cb1135-9"><a href="#cb1135-9"></a>                <span class="dt">p0.05 =</span>  <span class="kw">round</span>(<span class="kw">qt</span>(<span class="dt">p=</span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="fl">0.05</span><span class="op">/</span><span class="dv">2</span>),  <span class="dt">df=</span>dl),<span class="dv">2</span>),</span>
<span id="cb1135-10"><a href="#cb1135-10"></a>                <span class="dt">p0.01 =</span>  <span class="kw">round</span>(<span class="kw">qt</span>(<span class="dt">p=</span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="fl">0.01</span><span class="op">/</span><span class="dv">2</span>),  <span class="dt">df=</span>dl),<span class="dv">2</span>),</span>
<span id="cb1135-11"><a href="#cb1135-11"></a>                <span class="dt">p0.001 =</span> <span class="kw">round</span>(<span class="kw">qt</span>(<span class="dt">p=</span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="fl">0.001</span><span class="op">/</span><span class="dv">2</span>), <span class="dt">df=</span>dl),<span class="dv">2</span>))</span>
<span id="cb1135-12"><a href="#cb1135-12"></a><span class="co"># Impression du tableau avec la library stargazer</span></span>
<span id="cb1135-13"><a href="#cb1135-13"></a><span class="kw">stargazer</span>(tableT, <span class="dt">type=</span><span class="st">&quot;text&quot;</span>, <span class="dt">summary=</span><span class="ot">FALSE</span>, <span class="dt">rownames=</span><span class="ot">FALSE</span>, <span class="dt">align =</span> <span class="ot">TRUE</span>, <span class="dt">digits =</span> <span class="dv">2</span>,</span>
<span id="cb1135-14"><a href="#cb1135-14"></a>          <span class="dt">title=</span><span class="st">&quot;Distribution des valeurs critiques de t&quot;</span>)</span></code></pre></div>
<div style="page-break-after: always;"></div>
<table>
<caption>
(#tab:tableCritiqueT)Distribution des valeurs critiques de t
</caption>
<thead>
<tr>
<th style="text-align:right;">
dl
</th>
<th style="text-align:right;">
p = 0,10
</th>
<th style="text-align:right;">
p = 0,05
</th>
<th style="text-align:right;">
p = 0,01
</th>
<th style="text-align:right;">
p = 0,001
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6,31
</td>
<td style="text-align:right;">
12,71
</td>
<td style="text-align:right;">
63,66
</td>
<td style="text-align:right;">
636,62
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2,92
</td>
<td style="text-align:right;">
4,30
</td>
<td style="text-align:right;">
9,92
</td>
<td style="text-align:right;">
31,60
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2,35
</td>
<td style="text-align:right;">
3,18
</td>
<td style="text-align:right;">
5,84
</td>
<td style="text-align:right;">
12,92
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2,13
</td>
<td style="text-align:right;">
2,78
</td>
<td style="text-align:right;">
4,60
</td>
<td style="text-align:right;">
8,61
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2,02
</td>
<td style="text-align:right;">
2,57
</td>
<td style="text-align:right;">
4,03
</td>
<td style="text-align:right;">
6,87
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1,94
</td>
<td style="text-align:right;">
2,45
</td>
<td style="text-align:right;">
3,71
</td>
<td style="text-align:right;">
5,96
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1,89
</td>
<td style="text-align:right;">
2,36
</td>
<td style="text-align:right;">
3,50
</td>
<td style="text-align:right;">
5,41
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1,86
</td>
<td style="text-align:right;">
2,31
</td>
<td style="text-align:right;">
3,36
</td>
<td style="text-align:right;">
5,04
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1,83
</td>
<td style="text-align:right;">
2,26
</td>
<td style="text-align:right;">
3,25
</td>
<td style="text-align:right;">
4,78
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
1,81
</td>
<td style="text-align:right;">
2,23
</td>
<td style="text-align:right;">
3,17
</td>
<td style="text-align:right;">
4,59
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
1,80
</td>
<td style="text-align:right;">
2,20
</td>
<td style="text-align:right;">
3,11
</td>
<td style="text-align:right;">
4,44
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
1,78
</td>
<td style="text-align:right;">
2,18
</td>
<td style="text-align:right;">
3,05
</td>
<td style="text-align:right;">
4,32
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
1,77
</td>
<td style="text-align:right;">
2,16
</td>
<td style="text-align:right;">
3,01
</td>
<td style="text-align:right;">
4,22
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
1,76
</td>
<td style="text-align:right;">
2,14
</td>
<td style="text-align:right;">
2,98
</td>
<td style="text-align:right;">
4,14
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
1,75
</td>
<td style="text-align:right;">
2,13
</td>
<td style="text-align:right;">
2,95
</td>
<td style="text-align:right;">
4,07
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
1,75
</td>
<td style="text-align:right;">
2,12
</td>
<td style="text-align:right;">
2,92
</td>
<td style="text-align:right;">
4,01
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
1,74
</td>
<td style="text-align:right;">
2,11
</td>
<td style="text-align:right;">
2,90
</td>
<td style="text-align:right;">
3,97
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
1,73
</td>
<td style="text-align:right;">
2,10
</td>
<td style="text-align:right;">
2,88
</td>
<td style="text-align:right;">
3,92
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1,73
</td>
<td style="text-align:right;">
2,09
</td>
<td style="text-align:right;">
2,86
</td>
<td style="text-align:right;">
3,88
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
1,72
</td>
<td style="text-align:right;">
2,09
</td>
<td style="text-align:right;">
2,85
</td>
<td style="text-align:right;">
3,85
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
1,72
</td>
<td style="text-align:right;">
2,08
</td>
<td style="text-align:right;">
2,83
</td>
<td style="text-align:right;">
3,82
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
1,72
</td>
<td style="text-align:right;">
2,07
</td>
<td style="text-align:right;">
2,82
</td>
<td style="text-align:right;">
3,79
</td>
</tr>
<tr>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
1,71
</td>
<td style="text-align:right;">
2,07
</td>
<td style="text-align:right;">
2,81
</td>
<td style="text-align:right;">
3,77
</td>
</tr>
<tr>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
1,71
</td>
<td style="text-align:right;">
2,06
</td>
<td style="text-align:right;">
2,80
</td>
<td style="text-align:right;">
3,75
</td>
</tr>
<tr>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1,71
</td>
<td style="text-align:right;">
2,06
</td>
<td style="text-align:right;">
2,79
</td>
<td style="text-align:right;">
3,73
</td>
</tr>
<tr>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
1,71
</td>
<td style="text-align:right;">
2,06
</td>
<td style="text-align:right;">
2,78
</td>
<td style="text-align:right;">
3,71
</td>
</tr>
<tr>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
1,70
</td>
<td style="text-align:right;">
2,05
</td>
<td style="text-align:right;">
2,77
</td>
<td style="text-align:right;">
3,69
</td>
</tr>
<tr>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
1,70
</td>
<td style="text-align:right;">
2,05
</td>
<td style="text-align:right;">
2,76
</td>
<td style="text-align:right;">
3,67
</td>
</tr>
<tr>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1,70
</td>
<td style="text-align:right;">
2,05
</td>
<td style="text-align:right;">
2,76
</td>
<td style="text-align:right;">
3,66
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1,70
</td>
<td style="text-align:right;">
2,04
</td>
<td style="text-align:right;">
2,75
</td>
<td style="text-align:right;">
3,65
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
1,68
</td>
<td style="text-align:right;">
2,02
</td>
<td style="text-align:right;">
2,70
</td>
<td style="text-align:right;">
3,55
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
1,68
</td>
<td style="text-align:right;">
2,01
</td>
<td style="text-align:right;">
2,68
</td>
<td style="text-align:right;">
3,50
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
1,67
</td>
<td style="text-align:right;">
2,00
</td>
<td style="text-align:right;">
2,66
</td>
<td style="text-align:right;">
3,46
</td>
</tr>
<tr>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
1,67
</td>
<td style="text-align:right;">
1,99
</td>
<td style="text-align:right;">
2,65
</td>
<td style="text-align:right;">
3,44
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
1,66
</td>
<td style="text-align:right;">
1,99
</td>
<td style="text-align:right;">
2,64
</td>
<td style="text-align:right;">
3,42
</td>
</tr>
<tr>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
1,66
</td>
<td style="text-align:right;">
1,99
</td>
<td style="text-align:right;">
2,63
</td>
<td style="text-align:right;">
3,40
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
1,66
</td>
<td style="text-align:right;">
1,98
</td>
<td style="text-align:right;">
2,63
</td>
<td style="text-align:right;">
3,39
</td>
</tr>
<tr>
<td style="text-align:right;">
250
</td>
<td style="text-align:right;">
1,65
</td>
<td style="text-align:right;">
1,97
</td>
<td style="text-align:right;">
2,60
</td>
<td style="text-align:right;">
3,33
</td>
</tr>
<tr>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
1,65
</td>
<td style="text-align:right;">
1,96
</td>
<td style="text-align:right;">
2,59
</td>
<td style="text-align:right;">
3,31
</td>
</tr>
<tr>
<td style="text-align:right;">
1 000
</td>
<td style="text-align:right;">
1,65
</td>
<td style="text-align:right;">
1,96
</td>
<td style="text-align:right;">
2,58
</td>
<td style="text-align:right;">
3,30
</td>
</tr>
<tr>
<td style="text-align:right;">
2 500
</td>
<td style="text-align:right;">
1,65
</td>
<td style="text-align:right;">
1,96
</td>
<td style="text-align:right;">
2,58
</td>
<td style="text-align:right;">
3,29
</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<!--chapter:end:19-Annexes.Rmd-->
<div id="refs" class="references">
<div id="ref-aggarwal2001surprising">
<p>Aggarwal, Charu C, Alexander Hinneburg et Daniel A Keim. 2001. « On the surprising behavior of distance metrics in high dimensional space ». In <em>International conference on database theory</em>, 420‑434. Springer.</p>
</div>
<div id="ref-allcott2017social">
<p>Allcott, Hunt et Matthew Gentzkow. 2017. « Social media and fake news in the 2016 election ». <em>Journal of economic perspectives</em> 31 (2): 211‑36.</p>
</div>
<div id="ref-aly2014reliability">
<p>Aly, Sharif S, Jianyang Zhao, Ben Li et Jiming Jiang. 2014. « Reliability of environmental sampling culture results using the negative binomial intraclass correlation coefficient ». <em>SpringerPlus</em> 3 (1): 40.</p>
</div>
<div id="ref-anastasopoulos2012analysis">
<p>Anastasopoulos, Panagiotis C, John E Haddock, Matthew G Karlaftis et Fred L Mannering. 2012. « Analysis of urban travel times: Hazard-based approach to random parameters ». <em>Transportation research record</em> 2302 (1): 121‑129.</p>
</div>
<div id="ref-TheseApparicio">
<p>Apparicio, Philippe. 2002. « Apport des systèmes d’information géographique à l’étude de l’insertion des HLM dans les quartiers montréalais ». Thèse de doctorat, Université du Maine. <a href="http://www.theses.fr/2002LEMA3007">http://www.theses.fr/2002LEMA3007</a>.</p>
</div>
<div id="ref-2016_1">
<p>Apparicio, Philippe, Mathieu Carrier, Jérémy Gelb, Anne-Marie Séguin et Simon Kingham. 2016. « Cyclists’ exposure to air pollution and road traffic noise in central city neighbourhoods of Montreal ». <em>Journal of Transport Geography</em> 57: 63‑69. <a href="https://doi.org/10.1016/j.jtrangeo.2016.09.014">https://doi.org/10.1016/j.jtrangeo.2016.09.014</a>.</p>
</div>
<div id="ref-apparicio2010accessibilite">
<p>Apparicio, Philippe, Marie-Soleil Cloutier, Anne-Marie Séguin et Josefina Ades. 2010. « Accessibilité spatiale aux parcs urbains pour les enfants et injustice environnementale. Exploration du cas montréalais ». <em>Revue internationale de géomatique</em> 20 (3): 363‑389.</p>
</div>
<div id="ref-2020_1">
<p>Apparicio, Philippe et Jérémy Gelb. 2020. « Cyclists′ exposure to road traffic noise: A comparison of three North American and European cities ». <em>Acoustics</em> 2 (1): 73‑86. <a href="https://doi.org/10.3390/acoustics2010006">https://doi.org/10.3390/acoustics2010006</a>.</p>
</div>
<div id="ref-2018_1">
<p>Apparicio, Philippe, Jérémy Gelb, Mathieu Carrier, Marie-Ève Mathieu et Simon Kingham. 2018a. « Exposure to noise and air pollution by mode of transportation during rush hours in Montreal ». <em>Journal of Transport Geography</em> 70: 182‑192. <a href="https://doi.org/10.1016/j.jtrangeo.2018.06.007">https://doi.org/10.1016/j.jtrangeo.2018.06.007</a>.</p>
</div>
<div id="ref-apparicio2018exposure">
<p>———. 2018b. « Exposure to noise and air pollution by mode of transportation during rush hours in Montreal ». <em>Journal of Transport Geography</em> 70: 182‑192.</p>
</div>
<div id="ref-2017_1">
<p>Apparicio, Philippe, Jérémy Gelb, Anne-Sophie Dubé, Simon Kingham, Lise Gauvin et Éric Robitaille. 2017. « The approaches to measuring the potential spatial access to urban health services revisited: distance types and aggregation-error issues ». <em>International journal of health geographics</em> 16 (1): 32. <a href="https://doi.org/10.1186/s12942-017-0105-9">https://doi.org/10.1186/s12942-017-0105-9</a>.</p>
</div>
<div id="ref-2021_1">
<p>Apparicio, Philippe, Jérémy Gelb, Vincent Jarry et Élaine Lesage-Mann. 2021. « Cycling in one of the most polluted cities in the world: Exposure to noise and air pollution and potential adverse health impacts in Delhi ». <em>International journal of health geographics</em> 20 (1): 1‑16. <a href="https://doi.org/10.1186/s12942-021-00272-2">https://doi.org/10.1186/s12942-021-00272-2</a>.</p>
</div>
<div id="ref-2019_1">
<p>Apparicio, Philippe, Jérémy Gelb et Marie-Ève Mathieu. 2019. « Un atlas-web pour comparer l’exposition individuelle aux pollutions atmosphérique et sonore selon le mode de transport ». <em>Cybergeo: European Journal of Geography</em> 903. <a href="https://doi.org/10.3390/atmos11040422">https://doi.org/10.3390/atmos11040422</a>.</p>
</div>
<div id="ref-apparicio2017disentangling">
<p>Apparicio, Philippe, Shawn Landry, Joseph Lewnard et others. 2017. « Disentangling the effects of urban form and socio-demographic context on street tree cover: A multi-level analysis from Montréal ». <em>Landscape and Urban Planning</em> 157: 422‑433.</p>
</div>
<div id="ref-2021_2">
<p>Apparicio, Philippe, David Maignan et Jérémy Gelb. 2021. « VIFECO: An Open-source software for counting features on a Video ». <em>Journal of Open Research Software</em> 9 (1). <a href="https://doi.org/10.5334/jors.300">https://doi.org/10.5334/jors.300</a>.</p>
</div>
<div id="ref-apparicio2016spatial">
<p>Apparicio, Philippe, Anne-Marie Séguin, Jean Dubé et others. 2016. « Spatial distribution of vegetation in and around city blocks on the Island of Montreal: A double environmental inequity? » <em>Applied Geography</em> 76: 128‑136. <a href="http://dx.doi.org/10.1016/j.apgeog.2016.09.023">http://dx.doi.org/10.1016/j.apgeog.2016.09.023</a>.</p>
</div>
<div id="ref-atkinson2001disentangling">
<p>Atkinson, Rowland et Keith Kintrea. 2001. « Disentangling area effects: Evidence from deprived and non-deprived neighbourhoods ». <em>Urban studies</em> 38 (12): 2277‑2298.</p>
</div>
<div id="ref-audrin2021localisation">
<p>Audrin, Thomas, Philippe Apparicio et Anne-Marie Séguin. 2021. « La localisation des écoles primaires et le bruit aérien dans la région métropolitaine de Toronto: un diagnostic d’équité environnementale et une analyse des impacts sur la réussite scolaire ». <em>Canadian Journal of Regional Science/Revue canadienne des sciences régionales</em> 44 (1): 22‑34.</p>
</div>
<div id="ref-bair2013semi">
<p>Bair, Eric. 2013. « Semi-supervised clustering methods ». <em>Wiley Interdisciplinary Reviews: Computational Statistics</em> 5 (5): 349‑361.</p>
</div>
<div id="ref-bolker2009generalized">
<p>Bolker, Benjamin M, Mollie E Brooks, Connie J Clark, Shane W Geange, John R Poulsen, M Henry H Stevens et Jada-Simone S White. 2009. « Generalized linear mixed models: a practical guide for ecology and evolution ». <em>Trends in ecology &amp; evolution</em> 24 (3): 127‑135.</p>
</div>
<div id="ref-boulos2020geographical">
<p>Boulos, Maged N Kamel et Estella M Geraghty. 2020. « Geographical tracking and mapping of coronavirus disease COVID-19/severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2) epidemic and associated events around the world: how 21st century GIS technologies are supporting the global fight against outbreaks and epidemics ». <em>International journal of health geographics</em> 19 (1): 1‑12.</p>
</div>
<div id="ref-brant1990assessing">
<p>Brant, Rollin. 1990. « Assessing proportionality in the proportional odds model for ordinal logistic regression ». <em>Biometrics</em>: 1171‑1178.</p>
</div>
<div id="ref-bressoux2010">
<p>Bressoux, Pascal. 2010. <em>Modélisation statistique appliquée aux sciences sociales</em>. De boeck Bruxelles.</p>
</div>
<div id="ref-burdenski2000evaluating">
<p>Burdenski, Jr Thomas K. 2000. « Evaluating univariate, bivariate, and multivariate normality using graphical procedures ». <em>ERIC</em>: 1‑62.</p>
</div>
<div id="ref-2020_2">
<p>Buregeya, Jean Marie, Philippe Apparicio et Jérémy Gelb. 2020. « Short-term impact of traffic-related particulate matter and noise exposure on cardiac function ». <em>International Journal of Environmental Research and Public Health</em> 17 (4): 1220. <a href="https://dx.doi.org/10.3390%2Fijerph17041220">https://dx.doi.org/10.3390%2Fijerph17041220</a>.</p>
</div>
<div id="ref-carrier2014">
<p>Carrier, Mathieu, Philippe Apparicio, Anne-Marie Séguin et Dan Crouse. 2014. « Ambient air pollution concentration in Montreal and environmental equity: Are children at risk at school? » <em>Case Studies on Transport Policy</em> 2 (2): 61‑69. <a href="https://doi.org/10.1016/j.cstp.2014.06.003">https://doi.org/10.1016/j.cstp.2014.06.003</a>.</p>
</div>
<div id="ref-chandra1936generalised">
<p>Chandra, Mahalanobis Prasanta. 1936. « On the generalised distance in statistics ». In <em>Proceedings of the National Institute of Sciences of India</em>, 2:49‑55. 1.</p>
</div>
<div id="ref-Chang2018">
<p>Chang, Winston. 2018. <em>R Graphics Cookbook, 2nd edition</em>. CRC Press.</p>
</div>
<div id="ref-cloutier2014carrefours">
<p>Cloutier, Marie-soleil, Mathieu Tremblay, Patrick Morency et Philippe Apparicio. 2014. « Carrefours en milieu urbain: quels risques pour les piétons? Exemple empirique des quartiers centraux de Montréal, Canada ». <em>Recherche Transports Sécurité</em> 30: 3‑20.</p>
</div>
<div id="ref-cohen1992">
<p>Cohen, Jacob. 1992. « A power primer ». <em>Psychological bulletin</em> 112 (1): 155‑159. <a href="https://doi.org/10.1037/0033-2909.112.1.155">https://doi.org/10.1037/0033-2909.112.1.155</a>.</p>
</div>
<div id="ref-cohen2013">
<p>———. 2013. <em>Statistical power analysis for the behavioral sciences</em>. Academic press.</p>
</div>
<div id="ref-de2018accessibilite">
<p>De Alvarenga, Bernardo, Philippe Apparicio et Anne-Marie Séguin. 2018. « L’accessibilité aux aires de jeux dans les parcs de la Communauté métropolitaine de Montréal ». <em>Cahiers de géographie du Québec</em> 62 (176): 229‑246.</p>
</div>
<div id="ref-2019_2">
<p>Delaunay, Déborah, Philippe Apparicio, Anne-Marie Séguin, Jérémy Gelb et Mathieu Carrier. 2019. « L’identification des zones calmes et un diagnostic d’équité environnementale à Montréal ». <em>The Canadian Geographer/Le Géographe canadien</em> 63 (2): 184‑197. <a href="https://doi.org/10.1111/cag.12511">https://doi.org/10.1111/cag.12511</a>.</p>
</div>
<div id="ref-RandomizedResid">
<p>Dunn, Peter K. et Gordon K. Smyth. 1996. « Randomized Quantile Residuals ». <em>Journal of Computational and Graphical Statistics</em> 5 (3): 236‑244. <a href="https://www.tandfonline.com/doi/abs/10.1080/10618600.1996.10474708">https://www.tandfonline.com/doi/abs/10.1080/10618600.1996.10474708</a>.</p>
</div>
<div id="ref-field2012discovering">
<p>Field, Andy P, Jeremy Miles et Zoë Field. 2012. « Discovering statistics using R ». London; Thousand Oaks, Calif.: Sage.</p>
</div>
<div id="ref-fox1992generalized">
<p>Fox, John et Georges Monette. 1992. « Generalized collinearity diagnostics ». <em>Journal of the American Statistical Association</em> 87 (417): 178‑183.</p>
</div>
<div id="ref-frank2008urban">
<p>Frank, Lawrence, Mark Bradley, Sarah Kavage, James Chapman et T Keith Lawton. 2008. « Urban form, travel time, and cost relationships with tour complexity and mode choice ». <em>Transportation</em> 35 (1): 37‑54.</p>
</div>
<div id="ref-fukuyama1989">
<p>Fukuyama, Yoshiki. 1989. « A new method of choosing the number of clusters for the fuzzy c-mean method ». In <em>Proc. 5th Fuzzy Syst. Symp., 1989</em>, 247‑250.</p>
</div>
<div id="ref-2019_3">
<p>Gelb, Jérémy et Philippe Apparicio. 2019. « Noise exposure of cyclists in Ho Chi Minh City: A spatio-temporal analysis using non-linear models ». <em>Applied Acoustics</em> 148: 332‑343. <a href="https://doi.org/10.1016/j.apacoust.2018.12.031">https://doi.org/10.1016/j.apacoust.2018.12.031</a>.</p>
</div>
<div id="ref-2020_3">
<p>Gelb, Jérémy et Philippe Apparicio. 2020. « Modelling cyclists’ multi-exposure to air and noise pollution with low-cost sensors: The case of Paris ». <em>Atmosphere</em> 11 (4): 422. <a href="https://dx.doi.org/10.3390%2Fijerph17041220">https://dx.doi.org/10.3390%2Fijerph17041220</a>.</p>
</div>
<div id="ref-2021_3">
<p>———. 2021a. « Cyclists’ exposure to atmospheric and noise pollution: a systematic literature review ». <em>Transport Reviews</em>: 1‑24. <a href="https://doi.org/10.1080/01441647.2021.1895361">https://doi.org/10.1080/01441647.2021.1895361</a>.</p>
</div>
<div id="ref-2021_4">
<p>———. 2021b. « Apport de la classification floue c-means spatiale en géographie: essai de taxinomie socio-résidentielle et environnementale à Lyon ». <em>Cybergeo: European Journal of Geography</em>. <a href="https://doi.org/10.4000/cybergeo.36414">https://doi.org/10.4000/cybergeo.36414</a>.</p>
</div>
<div id="ref-gelman2005analysis">
<p>Gelman, Andrew. 2005. « Analysis of variance—why it is more important than ever ». <em>The annals of statistics</em> 33 (1): 1‑53.</p>
</div>
<div id="ref-gelman2006data">
<p>Gelman, Andrew et Jennifer Hill. 2006. <em>Data analysis using regression and multilevel/hierarchical models</em>. Cambridge university press.</p>
</div>
<div id="ref-gilles1994elements">
<p>Gilles, Alain et Pierre Maranda. 1994. <em>Éléments de méthodologie et d’analyse statistique pour les sciences sociales</em>. McGraw-Hill.</p>
</div>
<div id="ref-glass1972consequences">
<p>Glass, Gene V, Percy D Peckham et James R Sanders. 1972. « Consequences of failure to meet assumptions underlying the fixed effects analyses of variance and covariance ». <em>Review of educational research</em> 42 (3): 237‑288.</p>
</div>
<div id="ref-gower1971general">
<p>Gower, John C. 1971. « A general coefficient of similarity and some of its properties ». <em>Biometrics</em>: 857‑871.</p>
</div>
<div id="ref-hanck2019introduction">
<p>Hanck, Christoph, Martin Arnold, Alexander Gerber et Martin Schmelzer. 2019. <em>Introduction to econometrics with R</em>. https://www.econometrics-with-r.org/ITER.pdf.</p>
</div>
<div id="ref-harlan2007shade">
<p>Harlan, Sharon L, Anthony J Brazel, G Darrel Jenerette, Nancy S Jones, Larissa Larsen, Lela Prashad et William L Stefanov. 2007. « In the shade of affluence: the inequitable distribution of the urban heat island ». <em>Research in Social Problems and Public Policy</em> 15: 173‑202.</p>
</div>
<div id="ref-hilbe2009logistic">
<p>Hilbe, Joseph M. 2009. <em>Logistic regression models</em>. CRC press.</p>
</div>
<div id="ref-huang2011everyone">
<p>Huang, Ganlin, Weiqi Zhou et ML Cadenasso. 2011. « Is everyone hot in the city? Spatial pattern of land surface temperatures, land cover and neighborhood socioeconomic characteristics in Baltimore, MD ». <em>Journal of environmental management</em> 92 (7): 1753‑1759.</p>
</div>
<div id="ref-ismay2019statistical">
<p>Ismay, Chester et Albert Y Kim. 2019. <em>Statistical inference via data science: a ModernDive into R and the tidyverse</em>. CRC Press.</p>
</div>
<div id="ref-joanes1998comparing">
<p>Joanes, DN et CA Gill. 1998. « Comparing measures of sample skewness and kurtosis ». <em>Journal of the Royal Statistical Society: Series D (The Statistician)</em> 47 (1): 183‑189.</p>
</div>
<div id="ref-lebart1995statistique">
<p>Lebart, Ludovic, Alain Morineau et Marie Piron. 1995. <em>Statistique exploratoire multidimensionnelle</em>. Vol. 3. Dunod Paris.</p>
</div>
<div id="ref-lix1996consequences">
<p>Lix, Lisa M, Joanne C Keselman et HJ Keselman. 1996. « Consequences of assumption violations revisited: A quantitative review of alternatives to the one-way analysis of variance F test ». <em>Review of educational research</em> 66 (4): 579‑619.</p>
</div>
<div id="ref-macqueen1967">
<p>MacQueen, James. 1967. « Some methods for classification and analysis of multivariate observations ». In <em>Proceedings of the fifth Berkeley symposium on mathematical statistics and probability</em>, 1:281‑297. 14. Oakland, CA, USA.</p>
</div>
<div id="ref-mcelreath2020statistical">
<p>McElreath, Richard. 2020. <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em>. CRC press.</p>
</div>
<div id="ref-mcfadden2016examining">
<p>McFadden, Brandon R. 2016. « Examining the gap between science and public opinion about genetically modified food and global warming ». <em>PloS one</em> 11 (11): e0166140.</p>
</div>
<div id="ref-Messerli">
<p>Messerli, Franz H. 2012. « Chocolate consumption, cognitive Function, and Nobel laureates ». <em>The new England Journal of Medicine</em> 367 (16): 1563‑1564. <a href="https://doi.org/10.1056/nejmon1211064">https://doi.org/10.1056/nejmon1211064</a>.</p>
</div>
<div id="ref-mihalcea2004textrank">
<p>Mihalcea, Rada et Paul Tarau. 2004. « Textrank: Bringing order into text ». In <em>Proceedings of the 2004 conference on empirical methods in natural language processing</em>, 404‑411.</p>
</div>
<div id="ref-NakagawaICC">
<p>Nakagawa, Shinichi, Paul C. D. Johnson et Holger Schielzeth. 2017. « The coefficient of determination R2 and intra-class correlation coefficient from generalized linear mixed-effects models revisited and expanded ». <em>Journal of The Royal Society Interface</em> 14 (134): 20170213. <a href="https://royalsocietypublishing.org/doi/abs/10.1098/rsif.2017.0213">https://royalsocietypublishing.org/doi/abs/10.1098/rsif.2017.0213</a>.</p>
</div>
<div id="ref-GLMnelder">
<p>Nelder, John A. et Robert W. M. Wedderburn. 1972. « Generalized Linear Models ». <em>Journal of the Royal Statistical Society. Series A (General)</em> 135 (3): 370‑384. <a href="http://www.jstor.org/stable/2344614">http://www.jstor.org/stable/2344614</a>.</p>
</div>
<div id="ref-NeymanLemma">
<p>Neyman, Jerzy, Egon Sharpe Pearson et Karl Pearson. 1933. « IX. On the problem of the most efficient tests of statistical hypotheses ». <em>Philosophical Transactions of the Royal Society of London. Series A, Containing Papers of a Mathematical or Physical Character</em> 231 (694-706): 289‑337. <a href="https://royalsocietypublishing.org/doi/abs/10.1098/rsta.1933.0009">https://royalsocietypublishing.org/doi/abs/10.1098/rsta.1933.0009</a>.</p>
</div>
<div id="ref-PhamApparicioSeguin2012">
<p>Pham, Thi-Thanh-Hien, Philippe Apparicio, Anne-Marie Séguin, Shawn Landry, Martin Gagnon et others. 2012. « Spatial distribution of vegetation in Montreal: an uneven distribution or environmental inequity? » <em>Landscape and urban planning</em> 107 (3): 214‑224. <a href="http://dx.doi.org/10.1016/j.landurbplan.2012.06.002">http://dx.doi.org/10.1016/j.landurbplan.2012.06.002</a>.</p>
</div>
<div id="ref-philibert2007statistiques">
<p>Philibert, Mathieu D et Philippe Apparicio. 2007. « Statistiques spatiales appliquées à l’analyse de données de santé ». In <em>Géographie de la santé : un panorama</em>, 111‑132. Economica.</p>
</div>
<div id="ref-pumain1994">
<p>Pumain, Denise et Michèle Béguin. 1994. <em>La représentation des données géographiques: statistique et cartographie</em>. Armand Colin.</p>
</div>
<div id="ref-raudenbush2002hierarchical">
<p>Raudenbush, Stephen W et Anthony S Bryk. 2002. <em>Hierarchical linear models: Applications and data analysis methods</em>. Vol. 1. Sage.</p>
</div>
<div id="ref-razali2011power">
<p>Razali, Nornadiah Mohd, Yap Bee Wah et others. 2011. « Power comparisons of Shapiro-Wilk, Kolmogorov-Smirnov, Lilliefors and Anderson-Darling tests ». <em>Journal of statistical modeling and analytics</em> 2 (1): 21‑33.</p>
</div>
<div id="ref-William_pareto_ville">
<p>Reed, William J. 2002. « On the rank-Size distribution for human settlements ». <em>Journal of Regional Science</em> 42 (1): 1‑17. <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/1467-9787.00247">https://onlinelibrary.wiley.com/doi/abs/10.1111/1467-9787.00247</a>.</p>
</div>
<div id="ref-William_pareto">
<p>Reed, William J. et Murray Jorgensen. 2004. « The souble Pareto-Lognormal sistribution: A new parametric model for size distributions ». <em>Communications in Statistics - Theory and Methods</em> 33 (8). Taylor &amp; Francis: 1733‑1753. <a href="https://doi.org/10.1081/STA-120037438">https://doi.org/10.1081/STA-120037438</a>.</p>
</div>
<div id="ref-roback2021beyond">
<p>Roback, Paul et Julie Legler. 2021. <em>Beyond multiple linear regression: Applied generalized linear models and multilevel models in R</em>. CRC Press.</p>
</div>
<div id="ref-sanchez2019cooling">
<p>Sanchez, Lino et Tony G Reames. 2019. « Cooling Detroit: A socio-spatial analysis of equity in green roofs as an urban heat island mitigation strategy ». <em>Urban Forestry &amp; Urban Greening</em> 44: 126331.</p>
</div>
<div id="ref-Sasmultinom">
<p>SAS Institute Inc. 2020a. « SAS/STAT 15.2 User’s Guide Modeling Multinomial Overdispersion ». <a href="https://documentation.sas.com/?docsetId=statug&amp;docsetTarget=statug_fmm_examples04.htm&amp;docsetVersion=15.2&amp;locale=en">https://documentation.sas.com/?docsetId=statug&amp;docsetTarget=statug_fmm_examples04.htm&amp;docsetVersion=15.2&amp;locale=en</a>.</p>
</div>
<div id="ref-Saspoiss">
<p>———. 2020b. « SAS/STAT 15.2 User’s Guide Poisson Regression | SAS Annotated Output ». <a href="https://stats.idre.ucla.edu/sas/output/poisson-regression/">https://stats.idre.ucla.edu/sas/output/poisson-regression/</a>.</p>
</div>
<div id="ref-sawilowsky2009">
<p>Sawilowsky, Shlomo S. 2009. « New effect size rules of thumb ». <em>Journal of Modern Applied Statistical Methods</em> 8 (2): 467‑474. <a href="https://doi.org/10.22237/jmasm/1257035100">https://doi.org/10.22237/jmasm/1257035100</a>.</p>
</div>
<div id="ref-Schwarzkopf2012">
<p>Schwarzkopf, Dietrich, Benjamin de Haas et Geraint Rees. 2012. « Better ways to improve standards in brain-behavior correlation analysis ». <em>Frontiers in Human Neuroscience</em> 6: 200. <a href="https://www.frontiersin.org/articles/10.3389/fnhum.2012.00200">https://www.frontiersin.org/articles/10.3389/fnhum.2012.00200</a>.</p>
</div>
<div id="ref-SeanOwendist">
<p>Sean, Owen. 2018. « Common probability distributions ». <a href="https://medium.com/@srowen/common-probability-distributions-347e6b945ce4">https://medium.com/@srowen/common-probability-distributions-347e6b945ce4</a>.</p>
</div>
<div id="ref-smithson2006better">
<p>Smithson, Michael et Jay Verkuilen. 2006. « A better lemon squeezer? Maximum-likelihood regression with beta-distributed dependent variables. » <em>Psychological methods</em> 11 (1): 54.</p>
</div>
<div id="ref-Sobol1993">
<p>Sobol, IM. 1993. « Sensitivity estimates for nonlinear mathematical models ». <em>Mathematics and Computers in Simulation</em> 1 (4): 407‑414.</p>
</div>
<div id="ref-spyratos2019quantifying">
<p>Spyratos, Spyridon, Michele Vespe, Fabrizio Natale, Ingmar Weber, Emilio Zagheni et Marzia Rango. 2019. « Quantifying international human mobility patterns using Facebook Network data ». <em>PloS one</em> 14 (10): e0224134.</p>
</div>
<div id="ref-stryhn2006interpretation">
<p>Stryhn, H, J Sanchez, P Morley, C Booker et IR Dohoo. 2006. « Interpretation of variance parameters in multilevel Poisson regression models ». In <em>Proceedings of the 11th International Symposium on Veterinary Epidemiology and Economics</em>. Vol. 702.</p>
</div>
<div id="ref-tabachnick2007">
<p>Tabachnick, Barbara G, Linda S Fidell et Jodie B Ullman. 2007. <em>Using multivariate statistics</em>. Vol. 5. Pearson Boston, MA.</p>
</div>
<div id="ref-teubner2017price">
<p>Teubner, Timm, Florian Hawlitschek et David Dann. 2017. « Price determinants on AirBnB: How reputation pays off in the sharing economy. » <em>Journal of Self-Governance &amp; Management Economics</em> 5 (4).</p>
</div>
<div id="ref-tibshirani2001estimating">
<p>Tibshirani, Robert, Guenther Walther et Trevor Hastie. 2001. « Estimating the number of clusters in a data set via the gap statistic ». <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 63 (2): 411‑423.</p>
</div>
<div id="ref-wang2017price">
<p>Wang, Dan et Juan L Nicolau. 2017. « Price determinants of sharing economy based accommodation rental: A study of listings from 33 cities on Airbnb. com ». <em>International Journal of Hospitality Management</em> 62: 120‑131.</p>
</div>
<div id="ref-ward1963hierarchical">
<p>Ward, Joe H. 1963. « Hierarchical grouping to optimize an objective function ». <em>Journal of the American statistical association</em> 58 (301): 236‑244.</p>
</div>
<div id="ref-wickham2010layered">
<p>Wickham, Hadley. 2010. « A layered grammar of graphics ». <em>Journal of Computational and Graphical Statistics</em> 19 (1): 3‑28.</p>
</div>
<div id="ref-wilcox1994percentage">
<p>Wilcox, Rand R. 1994. « The percentage bend correlation coefficient ». <em>Psychometrika</em> 59 (4). Springer: 601‑616.</p>
</div>
<div id="ref-wood2004stable">
<p>Wood, Simon N. 2004. « Stable and efficient multiple smoothing parameter estimation for generalized additive models ». <em>Journal of the American Statistical Association</em> 99 (467): 673‑686.</p>
</div>
<div id="ref-wu2012comparison">
<p>Wu, Sheng, Catherine M Crespi et Weng Kee Wong. 2012. « Comparison of methods for estimating the intraclass correlation coefficient for binary responses in cancer prevention cluster randomized trials ». <em>Contemporary clinical trials</em> 33 (5): 869‑880.</p>
</div>
<div id="ref-xie1991validity">
<p>Xie, Xuanli Lisa et Gerardo Beni. 1991. « A validity measure for fuzzy clustering ». <em>IEEE Transactions on pattern analysis and machine intelligence</em> 13 (8): 841‑847.</p>
</div>
<div id="ref-xie2016bookdown">
<p>Xie, Yihui. 2016. <em>Bookdown: authoring books and technical documents with R markdown</em>. CRC Press.</p>
</div>
<div id="ref-yap2011comparisons">
<p>Yap, Bee Wah et Chiaw Hock Sim. 2011. « Comparisons of various types of normality tests ». <em>Journal of Statistical Computation and Simulation</em> 81 (12): 2141‑2155.</p>
</div>
<div id="ref-zeileis2004econometric">
<p>Zeileis, Achim. 2004. <em>Econometric computing with HC and HAC covariance matrix estimators</em>. Institut für Statistik und Mathematik, WU Vienna University of Economics and ….</p>
</div>
<div id="ref-zhang2017key">
<p>Zhang, Zhihua, Rachel JC Chen, Lee D Han et Lu Yang. 2017. « Key factors affecting the price of Airbnb listings: A geographically weighted approach ». <em>Sustainability</em> 9 (9): 1635.</p>
</div>
</div>
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
